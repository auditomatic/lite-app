import{D as ne,a as oe,j as le}from"./index-rC-Eq4H2.js";import{d as ie,f as N,c as x,o as re,R as u,S as m,k as o,Z as i,l as w,u as f,Y as r,G as d,_ as b,$ as ce,V as v,F as ue,W as de,X as pe}from"./vue-vendor-DPw1dQYc.js";import{t as c}from"./toast-CdlfWUDp.js";import{u as me}from"./useV4Templates-CryMT-5v.js";import{u as fe}from"./useV4TemplateCommands-pgHKiLR0.js";import{u as _e}from"./useV4VariableLists-D_MWKWVU.js";import{u as ye}from"./useCostEstimation-C8YzLQUh.js";import{_ as ve,m as ke,n as ge,P as Te,o as we,T as be,p as Ce,q as he,C as O,r as xe,E as De,s as $e,M as Ve,t as Le,u as Ee,v as Ne,w as Oe,x as S}from"./ui-vendor-IRGmExUJ.js";import"./utils-vendor-B76-F3_P.js";import"./tauri-vendor-CZ7fMPM9.js";import"./useV4LiveQuery-Do0jdBW3.js";import"./useV4CrossTab-XGmcNWBS.js";const Se={class:"templates-view"},Me={class:"view-header"},Ie={class:"header-actions"},Fe={key:0,class:"name-cell"},je={class:"template-name"},Re={key:0,class:"template-description"},qe={key:1,class:"variables-cell"},Ae={key:0,class:"no-variables"},Be={key:1,class:"variable-calculation"},Ue={class:"variable-name"},ze={class:"variable-count"},Pe={key:0,class:"operator"},Ye={class:"total-combinations"},Ge={key:2,class:"token-estimate"},Qe={class:"token-count"},We={key:3,class:"actions-cell-stacked"},Xe=ie({__name:"TemplatesViewV3",setup(Ze){const k=pe(),{templates:D,loading:M}=me(),{variableLists:$}=_e(),{duplicateTemplate:V,deleteTemplate:I,exportTemplates:F,isExecuting:j}=fe(),{calculateTemplateTokens:R}=ye(),g=N(""),C=N(!1),q=x(()=>M.value||j.value),L=x(()=>D.value),A=x(()=>{if(!g.value.trim())return L.value;const t=g.value.toLowerCase();return L.value.filter(e=>e.name.toLowerCase().includes(t)||e.description?.toLowerCase().includes(t)||e.tags.some(a=>a.toLowerCase().includes(t)))}),B=[{title:"Name",key:"name",dataIndex:"name",sorter:(t,e)=>t.name.localeCompare(e.name),width:375,ellipsis:!1},{title:"Variables",key:"variables",width:175},{title:"Tokens",key:"tokens",width:100,align:"center"},{title:"Created",key:"created",dataIndex:"created",sorter:(t,e)=>new Date(t.created).getTime()-new Date(e.created).getTime(),customRender:({value:t})=>new Date(t).toLocaleDateString(),width:100,align:"center"},{title:"Actions",key:"actions",width:90,align:"center"}];function U(t){return Object.keys(t.variables||{}).length}function E(t){const e=[],a=$.value;for(const[s,n]of Object.entries(t.variables||{})){let p=0;n.type==="list"&&n.listId?p=a.find(h=>h.id===n.listId)?.itemCount||0:n.values&&(p=n.values.length),e.push({name:s,count:p})}return e}function z(t){const e=R(t.template,t.variables||{},$.value),a=e.perCallAverage,s=e.combinationCount,n=e.totalTokens;let p=`~${a}/prompt`;return s>1&&(p+=` × ${s} prompts = ~${P(n)} tokens`),{perPrompt:a,prompts:s,total:n,formatted:p}}function P(t){return t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}k`:t.toString()}function Y(t){const e=D.value.map(n=>n.name),a=t.replace(/ \(Modified.*\)$/,"");if(!e.includes(`${a} (Modified)`))return`${a} (Modified)`;let s=2;for(;e.includes(`${a} (Modified ${s})`);)s++;return`${a} (Modified ${s})`}function G(){k.push({name:"template-create"})}async function Q(t){if(t.isDefault){localStorage.getItem("skip-default-edit-message")?await a():S.info({title:"Editing Default Content",content:"To preserve the original defaults, we'll create a personal copy for you to edit.",okText:"Create Copy",onOk:async()=>{localStorage.setItem("skip-default-edit-message","true"),await a()}});async function a(){c.info("Creating editable copy...");const s=Y(t.name),n=await V(t.id,s);n.ok?k.push({name:"template-edit",params:{id:n.value}}):c.error("Failed to create copy: "+n.error.message)}}else k.push({name:"template-edit",params:{id:t.id}})}async function W(t){const e=await V(t.id);e.ok?(c.success("Template duplicated successfully"),k.push({name:"template-edit",params:{id:e.value}})):c.error(`Failed to duplicate template: ${e.error.message}`)}async function X(t){let e=`Are you sure you want to delete "${t.name}"?`;t.isDefault?e+=`

This is a default template. You can restore it later using "Import Standard Lists".`:e+=" This action cannot be undone.",S.confirm({title:"Delete Template",content:e,okText:"Delete",okType:"danger",cancelText:"Cancel",onOk:async()=>{const a=await I(t.id);a.ok?c.success("Template deleted successfully"):c.error(`Failed to delete template: ${a.error.message}`)}})}async function Z(t){const e=await F([t.id]);if(e.ok){const a=new Blob([e.value],{type:"application/json"}),s=URL.createObjectURL(a),n=document.createElement("a");n.href=s,n.download=`${t.name.replace(/[^a-z0-9]/gi,"_")}_template.json`,n.click(),URL.revokeObjectURL(s),c.success("Template exported successfully")}else c.error(`Failed to export template: ${e.error.message}`)}function H(t){k.push({name:"trial-create",query:{designId:t.id,promptSource:"template"}})}function J(t){g.value=t}async function K(){if(!C.value){C.value=!0;try{const t=await ne.importDefaults();if(t.ok){const{templates:e,lists:a}=t.value;e===0&&a===0?c.info("All defaults already exist. No new items imported."):c.success(`Imported ${a} variable lists and ${e} templates`)}else c.error(`Failed to import defaults: ${t.error.message}`)}catch(t){oe.error("Error importing defaults:",t),c.error("An unexpected error occurred while importing defaults")}finally{C.value=!1}}}return re(()=>{}),(t,e)=>{const a=ve,s=ge,n=be,p=he,T=Le,h=Ne,ee=Ve,te=$e,ae=we;return r(),u("div",Se,[m("div",Me,[e[3]||(e[3]=m("h1",null,"Template Prompts",-1)),m("div",Ie,[o(a,{value:g.value,"onUpdate:value":e[0]||(e[0]=_=>g.value=_),placeholder:"Search templates...",class:"search-input",style:{width:"300px"},onSearch:J},null,8,["value"]),o(s,{type:"default",onClick:K,icon:w(f(ke))},{default:i(()=>e[1]||(e[1]=[d(" Import Standard Lists ")])),_:1,__:[1]},8,["icon"]),o(s,{type:"primary",onClick:G,icon:w(f(Te))},{default:i(()=>e[2]||(e[2]=[d(" New Template ")])),_:1,__:[2]},8,["icon"])])]),o(ae,{columns:B,"data-source":A.value,loading:q.value,pagination:!1,scroll:{x:840,y:"calc(100vh - 280px)"},"row-key":_=>_.id,class:"templates-table"},{bodyCell:i(({column:_,record:l})=>[_.key==="name"?(r(),u("div",Fe,[m("div",je,[d(v(l.name)+" ",1),l.isDefault?(r(),ce(p,{key:0,title:"Default template - editing will create a copy"},{default:i(()=>[o(n,{color:"blue",size:"small",style:{"margin-left":"8px"}},{default:i(()=>[o(f(Ce)),e[4]||(e[4]=d(" Default "))]),_:1,__:[4]})]),_:1})):b("",!0)]),l.description?(r(),u("div",Re,v(l.description),1)):b("",!0)])):_.key==="variables"?(r(),u("div",qe,[U(l)===0?(r(),u("span",Ae," No variables ")):(r(),u("div",Be,[(r(!0),u(ue,null,de(E(l),(y,se)=>(r(),u("span",{key:y.name,class:"variable-part"},[m("span",Ue,v(y.name),1),m("span",ze,"("+v(y.count)+")",1),se<E(l).length-1?(r(),u("span",Pe,"×")):b("",!0)]))),128)),e[5]||(e[5]=m("span",{class:"equals"},"=",-1)),m("span",Ye,v(l.combinationCount||0)+" cases",1)]))])):_.key==="tokens"?(r(),u("div",Ge,[o(p,{title:"Total input tokens for all combinations"},{default:i(()=>[m("span",Qe,v(z(l).formatted),1)]),_:2},1024)])):_.key==="actions"?(r(),u("div",We,[o(s,{type:"primary",size:"small",onClick:y=>Q(l),icon:w(l.isDefault?f(O):f(xe)),class:"action-button action-edit"},{default:i(()=>e[6]||(e[6]=[d(" Edit ")])),_:2,__:[6]},1032,["onClick","icon"]),o(s,{type:"primary",size:"small",onClick:y=>H(l),icon:w(f(De)),class:"action-button action-trial"},{default:i(()=>e[7]||(e[7]=[d(" New Trial ")])),_:2,__:[7]},1032,["onClick","icon"]),o(te,null,{overlay:i(()=>[o(ee,null,{default:i(()=>[o(T,{onClick:y=>W(l)},{default:i(()=>[o(f(O)),e[8]||(e[8]=d(" Duplicate "))]),_:2,__:[8]},1032,["onClick"]),o(T,{onClick:y=>Z(l)},{default:i(()=>[o(f(Ee)),e[9]||(e[9]=d(" Export "))]),_:2,__:[9]},1032,["onClick"]),o(h),o(T,{onClick:y=>X(l),class:"danger-item"},{default:i(()=>[o(f(Oe)),e[10]||(e[10]=d(" Delete "))]),_:2,__:[10]},1032,["onClick"])]),_:2},1024)]),default:i(()=>[o(s,{type:"default",size:"small",class:"action-button action-more"},{default:i(()=>e[11]||(e[11]=[d(" More... ")])),_:1,__:[11]})]),_:2},1024)])):b("",!0)]),_:1},8,["data-source","loading","row-key"])])}}}),ct=le(Xe,[["__scopeId","data-v-9310d119"]]);export{ct as default};
