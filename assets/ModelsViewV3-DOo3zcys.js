const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BET_-Wmx.js","assets/index-DNlH0UgC.css"])))=>i.map(i=>d[i]);
import{e as i,I as bt,d as P,as as Ue,r as b,c as W,p as ht,f as ce,t as ze,a as E,h,j as c,i as e,B as G,af as ae,C as f,H as y,F as X,D as oe,am as re,z as M,x as I,y as r,A as $,k as ve,J as kt,v as Be,_ as Te,X as Ne,at as wt,s as Le,au as Ct,av as Mt,a5 as Ot,o as $t,aw as Pt,Q as Dt,ax as At,ay as Re,az as Ve,M as St,aA as Et,ap as xt,R as Lt}from"./index-BET_-Wmx.js";import{u as je}from"./useV4Models-D3S_yGaV.js";import{u as Ge}from"./useV4ProviderParameters-Bu-1N6ly.js";import{O as Rt}from"./OllamaModelManagerV3-CIAaxELJ.js";import{S as Vt}from"./SaveOutlined-CldJO_eH.js";import{detectOllamaIssue as Ft}from"./ollama-fetch-N9udUw2j.js";import{U as Ut}from"./UnorderedListOutlined-CBEIfPtj.js";import"./useV4LiveQuery-D2G1TJgR.js";import"./FilterOutlined-B4xyq78X.js";var zt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};function Fe(D){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?Object(arguments[n]):{},l=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(o).filter(function(p){return Object.getOwnPropertyDescriptor(o,p).enumerable}))),l.forEach(function(p){Bt(D,p,o[p])})}return D}function Bt(D,n,o){return n in D?Object.defineProperty(D,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):D[n]=o,D}var be=function(n,o){var l=Fe({},n,o.attrs);return i(bt,Fe({},l,{icon:zt}),null)};be.displayName="UploadOutlined";be.inheritAttrs=!1;class Tt{async bulkWrite(n,o,l="put"){o.length!==0&&await P.transaction("rw",P[n],async()=>{switch(l){case"put":await P[n].bulkPut(o);break;case"add":await P[n].bulkAdd(o);break;case"update":const p=o.map(_=>P[n].update(_.id,_));await Promise.all(p);break}})}async bulkDelete(n,o){o.length!==0&&await P.transaction("rw",P[n],async()=>{await P[n].bulkDelete(o)})}async conditionalBulkUpdate(n,o,l){let p=0;return await P.transaction("rw",P[n],async()=>{await P[n].toCollection().modify(_=>{o(_)&&(Object.assign(_,l),p++)})}),p}freezeDeep(n){const o=n.map(l=>Object.freeze(l));return Object.freeze(o)}async getAndFreeze(n,o){const l=await P[n].get(o);return l?Object.freeze(l):null}async getAllAndFreeze(n){const o=await P[n].toArray();return this.freezeDeep(o)}}const ue=new Tt;class Nt{async bulkUpsertModels(n){n.length!==0&&await P.transaction("rw",P.models,async()=>{const o=n.map(l=>Object.freeze({...l,enabled:l.enabled??!1,available:l.available??!0}));await P.models.bulkPut(o)})}async clearProviderModels(n){return await P.transaction("rw",P.models,async()=>{const p=(await P.models.where("provider").equals(n).toArray()).map(_=>_.id);return p.length>0&&await P.models.bulkDelete(p),p.length})}async toggleModelEnabled(n,o){return await P.models.update(n,{enabled:o})===1}async toggleProviderModels(n,o){return await ue.conditionalBulkUpdate("models",l=>l.provider===n,{enabled:o})}async toggleAllModels(n){return await ue.conditionalBulkUpdate("models",()=>!0,{enabled:n})}async getModelStatistics(){const n=await P.models.toArray(),o={total:n.length,enabled:0,byProvider:{}};for(const l of n)l.enabled&&o.enabled++,o.byProvider[l.provider]||(o.byProvider[l.provider]={total:0,enabled:0}),o.byProvider[l.provider].total++,l.enabled&&o.byProvider[l.provider].enabled++;return Object.freeze(o)}async updateModelAvailability(n,o){return await ue.conditionalBulkUpdate("models",l=>l.provider===n,{available:o})}async searchModels(n){let o=P.models.toCollection();if(n.provider&&(o=P.models.where("provider").equals(n.provider)),n.enabled!==void 0&&(o=o.and(p=>p.enabled===n.enabled)),n.available!==void 0&&(o=o.and(p=>p.available===n.available)),n.search){const p=n.search.toLowerCase();o=o.and(_=>_.displayName.toLowerCase().includes(p)||_.modelId.toLowerCase().includes(p))}const l=await o.toArray();return ue.freezeDeep(l)}async clearAllModels(){await P.models.clear()}}const jt=new Nt;function Gt(){const D=Ue(),n=b(!1),o=b(null),l=b(!1),p=b(!1);async function _(g,v){n.value=!0,v&&(v.value=!0),o.value=null;try{return{ok:!0,value:await g()}}catch(s){const x=s instanceof Error?s:new Error(String(s));return o.value=x,{ok:!1,error:x}}finally{n.value=!1,v&&(v.value=!1)}}async function B(g){return _(()=>D.discoverModels(g),l)}async function F(g){return _(()=>D.refreshModelSource(g),l)}async function S(g,v){return _(async()=>{await D.toggleModel(g,v)},p)}async function C(g){return _(async()=>{await D.toggleAllModels(g)},p)}async function d(g,v){return _(async()=>{await D.toggleProviderModels(g,v)},p)}async function U(){return _(async()=>{await D.enableOpenRouterFavorites()},p)}async function O(){return _(async()=>{await D.clearAllModels()})}async function u(g,v){return _(async()=>{await jt.updateModelAvailability(g,v)})}return{discoverModels:B,refreshDiscoverySource:F,toggleModel:S,toggleAllModels:C,toggleProviderModels:d,enableOpenRouterFavorites:U,clearAllModels:O,updateModelAvailability:u,isExecuting:n,lastError:o,isDiscovering:l,isTogglingModels:p}}function Ie(){const D=Ue(),n=b([]),o=b(!1),l=b([]);function p(){const F=D.getDiscoveryStatus();n.value=F.map(S=>({id:S.id,status:S.status==="loading"?"loading":S.status==="idle"?"success":S.status,modelCount:S.modelCount,error:S.error})),o.value=D.isDiscovering(),l.value=D.getDiscoveryErrors()}function _(F){return{litellm:"LiteLLM",openrouter:"OpenRouter",ollama:"Ollama",deterministic:"Deterministic"}[F]||F}function B(F){const S=ht.getProvider(F);return(S==null?void 0:S.name)||F}return p(),{discoveryStatus:W(()=>n.value),isDiscovering:W(()=>o.value),discoveryErrors:W(()=>l.value),getSourceDisplayName:_,getProviderDisplayName:B,refreshStatus:p}}const It={class:"model-list"},Kt={class:"model-header"},Wt={class:"model-table"},Ht=["onClick"],Jt={class:"model-name"},Qt={class:"model-source"},qt={class:"model-context"},Xt={key:0},Yt={key:1,class:"text-secondary"},Zt={key:0,class:"model-cost-in"},es={key:0,class:"cost-value"},ts={key:1,class:"text-secondary"},ss={key:1,class:"model-cost-out"},as={key:0,class:"cost-value"},os={key:1,class:"text-secondary"},ls={class:"model-enviro-carbon"},ns={class:"enviro-value"},rs={class:"model-enviro-water"},is={class:"enviro-value"},ds={class:"model-enviro-energy"},us={class:"enviro-value"},cs=ce({__name:"ModelListV3",props:{models:{},providerId:{}},emits:["toggle-model"],setup(D){const n=D,o=ze(),l=b("name"),p=b("asc"),_=W(()=>{if(!n.models||n.models.length===0)return[];const C=n.models.filter(O=>{var u,g;return((u=O.capabilities)==null?void 0:u.inputCostPerToken)||((g=O.capabilities)==null?void 0:g.outputCostPerToken)});return C.length>0?E.info("MODEL_LIST_DEBUG: Models with pricing:",C.map(O=>{var u,g;return{id:O.id,provider:O.provider,modelId:O.modelId,inputCost:(u=O.capabilities)==null?void 0:u.inputCostPerToken,outputCost:(g=O.capabilities)==null?void 0:g.outputCostPerToken}})):E.info("MODEL_LIST_DEBUG: No models have pricing data. Sample model:",n.models[0]),[...n.models].sort((O,u)=>{var v,s,x,L,H,J;let g=0;switch(l.value){case"enabled":g=(O.enabled?1:0)-(u.enabled?1:0);break;case"name":g=O.displayName.localeCompare(u.displayName);break;case"source":g=(O.source||"").localeCompare(u.source||"");break;case"context":const K=((v=O.capabilities)==null?void 0:v.contextWindow)||0,Y=((s=u.capabilities)==null?void 0:s.contextWindow)||0;g=K-Y;break;case"inputCost":const V=((x=O.capabilities)==null?void 0:x.inputCostPerToken)||0,T=((L=u.capabilities)==null?void 0:L.inputCostPerToken)||0;g=V-T;break;case"outputCost":const N=((H=O.capabilities)==null?void 0:H.outputCostPerToken)||0,Z=((J=u.capabilities)==null?void 0:J.outputCostPerToken)||0;g=N-Z;break}return p.value==="asc"?g:-g})});function B(C){l.value===C?p.value=p.value==="asc"?"desc":"asc":(l.value=C,p.value="asc")}function F(C){return C>=1e6?(C/1e6).toFixed(1)+"M":C>=1e3?(C/1e3).toFixed(0)+"K":C.toString()}function S(C){if(!C||C===0)return"0.00";const d=C*1e6;return d<.01?d.toFixed(4):d<1?d.toFixed(3):d<10?d.toFixed(2):d<100?d.toFixed(1):d.toFixed(0)}return(C,d)=>{const U=M("a-switch"),O=M("a-tag");return c(),h("div",It,[e("div",Kt,[e("div",{class:"header-switch sortable",onClick:d[0]||(d[0]=u=>B("enabled"))},[d[7]||(d[7]=e("span",null,"Enabled",-1)),e("span",{class:ae(["sort-indicator",{active:l.value==="enabled"}])},f(l.value==="enabled"&&p.value==="asc"?"▲":"▼"),3)]),e("div",{class:"header-name sortable",onClick:d[1]||(d[1]=u=>B("name"))},[d[8]||(d[8]=e("span",null,"Model",-1)),e("span",{class:ae(["sort-indicator",{active:l.value==="name"}])},f(l.value==="name"&&p.value==="asc"?"▲":"▼"),3)]),e("div",{class:"header-source sortable",onClick:d[2]||(d[2]=u=>B("source"))},[d[9]||(d[9]=e("span",null,"Source",-1)),e("span",{class:ae(["sort-indicator",{active:l.value==="source"}])},f(l.value==="source"&&p.value==="asc"?"▲":"▼"),3)]),e("div",{class:"header-context sortable",onClick:d[3]||(d[3]=u=>B("context"))},[d[10]||(d[10]=e("span",null,"Context",-1)),e("span",{class:ae(["sort-indicator",{active:l.value==="context"}])},f(l.value==="context"&&p.value==="asc"?"▲":"▼"),3)]),y(o).showFinancialCosts.value?(c(),h("div",{key:0,class:"header-cost-in sortable",onClick:d[4]||(d[4]=u=>B("inputCost"))},[d[11]||(d[11]=e("span",null,"Input $/1M",-1)),e("span",{class:ae(["sort-indicator",{active:l.value==="inputCost"}])},f(l.value==="inputCost"&&p.value==="asc"?"▲":"▼"),3)])):G("",!0),y(o).showFinancialCosts.value?(c(),h("div",{key:1,class:"header-cost-out sortable",onClick:d[5]||(d[5]=u=>B("outputCost"))},[d[12]||(d[12]=e("span",null,"Output $/1M",-1)),e("span",{class:ae(["sort-indicator",{active:l.value==="outputCost"}])},f(l.value==="outputCost"&&p.value==="asc"?"▲":"▼"),3)])):G("",!0),d[13]||(d[13]=e("div",{class:"header-enviro-carbon"},[e("span",null,"CO₂")],-1)),d[14]||(d[14]=e("div",{class:"header-enviro-water"},[e("span",null,"💧")],-1)),d[15]||(d[15]=e("div",{class:"header-enviro-energy"},[e("span",null,"⚡")],-1))]),e("div",Wt,[(c(!0),h(X,null,oe(_.value,u=>{var g,v,s;return c(),h("div",{key:u.id,class:"model-row",onClick:x=>C.$emit("toggle-model",u.id,!u.enabled)},[e("div",{class:"model-switch",onClick:d[6]||(d[6]=re(()=>{},["stop"]))},[i(U,{checked:u.enabled,size:"small",onChange:x=>C.$emit("toggle-model",u.id,x),"data-testid":"model-toggle","data-provider":u.provider,"data-model":u.modelId,"aria-label":`${u.enabled?"Disable":"Enable"} model ${u.modelId}`},null,8,["checked","onChange","data-provider","data-model","aria-label"])]),e("div",Jt,[e("code",null,f(u.modelId),1)]),e("div",Qt,[u.source?(c(),I(O,{key:0,size:"small",color:"cyan"},{default:r(()=>[$(f(u.source),1)]),_:2},1024)):G("",!0)]),e("div",qt,[(g=u.capabilities)!=null&&g.contextWindow?(c(),h("span",Xt,f(F(u.capabilities.contextWindow)),1)):(c(),h("span",Yt,"-"))]),y(o).showFinancialCosts.value?(c(),h("div",Zt,[(v=u.capabilities)!=null&&v.inputCostPerToken?(c(),h("span",es," $"+f(S(u.capabilities.inputCostPerToken)),1)):(c(),h("span",ts,"-"))])):G("",!0),y(o).showFinancialCosts.value?(c(),h("div",ss,[(s=u.capabilities)!=null&&s.outputCostPerToken?(c(),h("span",as," $"+f(S(u.capabilities.outputCostPerToken)),1)):(c(),h("span",os,"-"))])):G("",!0),e("div",ls,[e("span",ns,f(y(o).getEnvironmentalCost(u,"carbon")),1)]),e("div",rs,[e("span",is,f(y(o).getEnvironmentalCost(u,"water")),1)]),e("div",ds,[e("span",us,f(y(o).getEnvironmentalCost(u,"energy")),1)])],8,Ht)}),128))])])}}}),vs=ve(cs,[["__scopeId","data-v-2b840b1b"]]),ps={class:"model-preference-manager"},ms={class:"preferences-section"},fs={class:"action-group"},gs={class:"action-group"},ys={class:"status-grid"},_s={class:"status-item"},bs={class:"status-value"},hs={class:"status-item"},ks={class:"status-value"},ws={class:"status-item"},Cs={class:"status-value"},Ms={class:"status-item"},Os={class:"status-value"},$s={class:"status-item"},Ps={class:"status-value"},Ds={class:"status-item"},As={class:"status-value"},Ss={class:"action-group"},Es={class:"provider-grid"},xs={class:"provider-name"},Ls={class:"provider-stats"},Rs={class:"provider-total"},Vs={class:"provider-enabled"},Fs=ce({__name:"ModelPreferenceManagerV3",setup(D){const{models:n,enabledModels:o,modelsByProvider:l}=je(),{discoveryStatus:p}=Ie(),_=ze(),{showFinancialCosts:B,showEnvironmentalCosts:F}=_,S=b([]),C=b(!1),d=b(!1),U=b(""),O=b("");async function u(){C.value=!0,U.value="";try{const v=await _.exportModelPreferences();if(v.ok){const s=new Blob([JSON.stringify(v.value,null,2)],{type:"application/json"}),x=URL.createObjectURL(s),L=document.createElement("a");L.href=x,L.download=`model-preferences-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(x),O.value="Model preferences exported successfully!"}else U.value=v.error.message}catch(v){U.value=`Failed to export preferences: ${v instanceof Error?v.message:"Unknown error"}`}finally{C.value=!1}}async function g(v){d.value=!0,U.value="";try{const s=await v.text(),x=JSON.parse(s),L=await _.importModelPreferences(x);L.ok?O.value="Model preferences imported successfully!":U.value=L.error.message}catch(s){s instanceof SyntaxError?U.value="Invalid JSON file format":U.value=`Failed to import preferences: ${s instanceof Error?s.message:"Unknown error"}`}finally{d.value=!1}return!1}return(v,s)=>{const x=M("a-button"),L=M("a-upload"),H=M("a-space"),J=M("a-divider"),K=M("a-alert"),Y=M("a-collapse-panel"),V=M("a-collapse");return c(),h("div",ps,[i(V,{activeKey:S.value,"onUpdate:activeKey":s[2]||(s[2]=T=>S.value=T),bordered:!1,class:"preferences-collapse"},{default:r(()=>[i(Y,{key:"preferences"},{header:r(()=>s[3]||(s[3]=[e("div",{class:"preferences-header"},[e("strong",null,"🔧 V3 Enhanced Features"),e("span",{class:"preferences-description"},"Advanced model preference management")],-1)])),default:r(()=>{var T,N,Z;return[e("div",ms,[e("div",fs,[s[6]||(s[6]=e("h5",{class:"action-title"},"Model Preferences",-1)),s[7]||(s[7]=e("p",{class:"action-description"}," Export and import your model enabled/disabled preferences for backup or sharing. ",-1)),i(H,null,{default:r(()=>[i(x,{onClick:u,loading:C.value,type:"primary"},{icon:r(()=>[i(y(kt))]),default:r(()=>[s[4]||(s[4]=$(" Export Preferences "))]),_:1,__:[4]},8,["loading"]),i(L,{"before-upload":g,"show-upload-list":!1,accept:".json"},{default:r(()=>[i(x,{loading:d.value},{icon:r(()=>[i(y(be))]),default:r(()=>[s[5]||(s[5]=$(" Import Preferences "))]),_:1,__:[5]},8,["loading"])]),_:1})]),_:1})]),i(J),e("div",gs,[s[14]||(s[14]=e("h5",{class:"action-title"},"V3 System Information",-1)),s[15]||(s[15]=e("p",{class:"action-description"}," Enhanced V3 backend capabilities and status. ",-1)),e("div",ys,[e("div",_s,[s[8]||(s[8]=e("span",{class:"status-label"},"Total Models:",-1)),e("span",bs,f(((T=y(n))==null?void 0:T.length)||0),1)]),e("div",hs,[s[9]||(s[9]=e("span",{class:"status-label"},"Enabled Models:",-1)),e("span",ks,f(((N=y(o))==null?void 0:N.length)||0),1)]),e("div",ws,[s[10]||(s[10]=e("span",{class:"status-label"},"Active Providers:",-1)),e("span",Cs,f(Object.keys(y(l)||{}).length),1)]),e("div",Ms,[s[11]||(s[11]=e("span",{class:"status-label"},"Discovery Sources:",-1)),e("span",Os,f(((Z=y(p))==null?void 0:Z.length)||0),1)]),e("div",$s,[s[12]||(s[12]=e("span",{class:"status-label"},"Cost Display:",-1)),e("span",Ps,f(y(B)?"Enabled":"Disabled"),1)]),e("div",Ds,[s[13]||(s[13]=e("span",{class:"status-label"},"Environmental Display:",-1)),e("span",As,f(y(F)?"Enabled":"Disabled"),1)])])]),i(J),e("div",Ss,[s[16]||(s[16]=e("h5",{class:"action-title"},"Provider Status",-1)),s[17]||(s[17]=e("p",{class:"action-description"}," Real-time provider status and model counts. ",-1)),e("div",Es,[(c(!0),h(X,null,oe(y(l),(te,A)=>(c(),h("div",{key:A,class:"provider-item"},[e("div",xs,f(y(_).getProviderDisplayName(A)),1),e("div",Ls,[e("span",Rs,f(te.length)+" total",1),e("span",Vs,f(te.filter(q=>q.enabled).length)+" enabled",1)])]))),128))])])]),U.value?(c(),I(K,{key:0,type:"error",message:U.value,closable:"",onClose:s[0]||(s[0]=te=>U.value=""),class:"error-alert"},null,8,["message"])):G("",!0),O.value?(c(),I(K,{key:1,type:"success",message:O.value,closable:"",onClose:s[1]||(s[1]=te=>O.value=""),class:"success-alert"},null,8,["message"])):G("",!0)]}),_:1})]),_:1},8,["activeKey"])])}}}),Us=ve(Fs,[["__scopeId","data-v-f4de1453"]]),zs={key:0,class:"loading-state"},Bs={key:1,class:"error-state"},Ts={class:"error-message"},Ns=["onClick"],js={class:"list-header"},Gs={class:"list-info"},Is={class:"list-name"},Ks={class:"list-meta"},Ws={class:"list-actions"},Hs={class:"list-description"},Js={class:"list-preview"},Qs={key:0,class:"more-models"},qs=ce({__name:"ModelListsDropdownV3",props:{currentModels:{},isLoading:{type:Boolean,default:!1}},emits:["apply-list","close"],setup(D,{emit:n}){const o=D,l=n,{getProviderGroup:p}=Ge(),_=b([]),B=b(!0),F=b(""),S=b(!1),C=b("");Be(async()=>{try{B.value=!0,F.value="";const{getModelListManager:v}=await Te(async()=>{const{getModelListManager:L}=await import("./index-BET_-Wmx.js").then(H=>H.b7);return{getModelListManager:L}},__vite__mapDeps([0,1])),x=await v().getLists();_.value=x.filter(L=>["openrouter-favorites","cost-efficient","high-performance"].includes(L.id)),E.info("Model lists loaded:",{lists:_.value.length})}catch(v){E.error("Failed to load model lists:",v),F.value="Failed to load model lists"}finally{B.value=!1}});function d(v){return o.currentModels.some(s=>s.modelId!==v.modelId?!1:v.provider?s.provider===v.provider&&s.enabled:v.providerGroup?p(s.provider)===v.providerGroup&&s.enabled:!1)}function U(v){return v.models.slice(0,3)}function O(v){return v.modelId.replace(/^.*\//,"").replace(/-instruct$/,"").replace(/-preview$/,"")}async function u(v){if(!(S.value||o.isLoading))try{S.value=!0,C.value=v,await new Promise(s=>{l("apply-list",v),setTimeout(()=>{s()},2e3)})}catch(s){E.error("Failed to apply list:",s)}finally{S.value=!1,C.value=""}}function g(v){var s;(s=v.domEvent)==null||s.stopPropagation()}return(v,s)=>{const x=M("a-spin"),L=M("a-button"),H=M("a-menu-item"),J=M("a-menu-divider"),K=M("a-tag"),Y=M("a-menu");return c(),I(Y,{class:"model-lists-menu",onClick:g},{default:r(()=>[B.value?(c(),h("div",zs,[i(x,{size:"small"}),s[0]||(s[0]=e("span",null,"Loading model lists...",-1))])):F.value?(c(),h("div",Bs,[e("span",Ts,f(F.value),1)])):(c(),h(X,{key:2},[s[6]||(s[6]=e("div",{class:"menu-header"},[e("span",null,"Built-in Lists")],-1)),(c(!0),h(X,null,oe(_.value,V=>(c(),I(H,{key:V.id,class:"list-menu-item"},{default:r(()=>[e("div",{class:"list-item",onClick:T=>u(V.id)},[e("div",js,[e("div",Gs,[e("span",Is,f(V.name),1),e("span",Ks,f(V.models.length)+" models",1)]),e("div",Ws,[i(L,{type:"primary",size:"small",loading:S.value&&C.value===V.id,onClick:re(T=>u(V.id),["stop"])},{default:r(()=>s[1]||(s[1]=[$(" Apply ")])),_:2,__:[1]},1032,["loading","onClick"])])]),e("div",Hs,f(V.description),1),e("div",Js,[(c(!0),h(X,null,oe(U(V),(T,N)=>(c(),h("span",{key:`${T.provider||T.providerGroup}-${T.modelId}`,class:ae(["preview-model",{enabled:d(T)}])},f(O(T))+f(N<U(V).length-1?", ":""),3))),128)),V.models.length>3?(c(),h("span",Qs," +"+f(V.models.length-3)+" more ",1)):G("",!0)])],8,Ns)]),_:2},1024))),128)),i(J),i(H,{disabled:"",class:"future-feature"},{default:r(()=>[i(y(Vt)),s[3]||(s[3]=e("span",null,"Save Current Selection...",-1)),i(K,{color:"blue",size:"small"},{default:r(()=>s[2]||(s[2]=[$("Soon")])),_:1,__:[2]})]),_:1,__:[3]}),i(H,{disabled:"",class:"future-feature"},{default:r(()=>[i(y(Ne)),s[5]||(s[5]=e("span",null,"Manage Lists...",-1)),i(K,{color:"blue",size:"small"},{default:r(()=>s[4]||(s[4]=[$("Soon")])),_:1,__:[4]})]),_:1,__:[5]})],64))]),_:1})}}}),Xs=ve(qs,[["__scopeId","data-v-5706641b"]]),Ys={class:"models-view","data-testid":"page-models"},Zs={class:"page-header"},ea={key:3,class:"discovery-status-bar"},ta={class:"source-name"},sa=["onClick","data-testid","aria-label"],aa={class:"search-filter-bar"},oa={class:"control-bar"},la={class:"left-controls"},na={class:"dropdown-item"},ra={class:"dropdown-item"},ia={class:"stats"},da={class:"provider-header"},ua={class:"provider-info"},ca={key:1,class:"provider-summary"},va=ce({__name:"ModelsViewV3",setup(D){const n=Lt(),{models:o,modelsByProvider:l,stats:p}=je(),{getProviderGroup:_,requiresApiKey:B}=Ge(),F=wt(),{hasApiKey:S}=F.secureSettings,{discoverModels:C,refreshDiscoverySource:d,toggleModel:U,toggleAllModels:O,toggleProviderModels:u,clearAllModels:g,isDiscovering:v,isTogglingModels:s}=Gt(),{discoveryStatus:x,getSourceDisplayName:L,getProviderDisplayName:H,refreshStatus:J}=Ie(),K=b(""),Y=b(""),V=b("all"),T=b(!1),N=b({hideOpenRouterFree:!1,hideOpenRouterAuto:!1}),Z=W(()=>{const a={};return Object.keys(l.value||{}).forEach(t=>{const m=_(t),R=B(t),z=S(m);a[t]={hasKey:z,providerGroup:m,requiresKey:R}}),a}),te=b(!1),A=b(""),q=b([]),he=b(null),ke=b([]),Ke=b(!1),ie=b(null),pe=b(!1);let me=null;const We=a=>{me&&clearTimeout(me),me=setTimeout(()=>{Y.value=a},300)},fe=W(()=>{const a={};for(const[t,m]of Object.entries(l.value))a[t]=m.filter(R=>R.enabled).length;return a}),se=b([]),de=W(()=>{const a=Y.value.toLowerCase(),t={},m=Object.keys(l.value);if(se.value.length===0||m.some(R=>!se.value.includes(R))){const R=se.value.filter(k=>m.includes(k)),z=m.filter(k=>!se.value.includes(k)).sort();se.value=[...R,...z]}for(const R of se.value){const z=l.value[R];if(!z)continue;let k=[...z];a&&(k=k.filter(ee=>ee.displayName.toLowerCase().includes(a)||ee.modelId.toLowerCase().includes(a)||R.toLowerCase().includes(a))),V.value==="enabled"?k=k.filter(ee=>ee.enabled):V.value==="disabled"&&(k=k.filter(ee=>!ee.enabled)),k.length>0&&(t[R]=k)}return t}),He=W(()=>{const a=p.value.total;return E.info("ModelsViewV3 V4 totalCount:",a),a}),Je=W(()=>p.value.enabled),Qe=W(()=>{var a;return((a=l.value.openrouter)==null?void 0:a.length)>0}),qe=W(()=>K.value?`No models found matching "${K.value}"`:V.value!=="all"?`No ${V.value} models found`:'No models available. Click "Refresh Models" to discover models.'),ge=W(()=>{if(!A.value)return!1;const a=A.value.toLowerCase();return a.includes("ollama")&&(a.includes("failed to fetch")||a.includes("networkerror when attempting to fetch"))&&!a.includes("litellm")&&!a.includes("openrouter")}),Xe=W(()=>{var m,R;const a=((m=l.value["ollama-chat"])==null?void 0:m.length)>0||((R=l.value["ollama-generate"])==null?void 0:R.length)>0,t=x.value.some(z=>z.id==="ollama");return a||t||ge.value}),ye=W(()=>{const a=se.value.length;return q.value.length===a&&a>0}),Ye=Le(Ct),Ze=Le(Mt);function et(a){return{idle:"default",loading:"processing",success:"success",error:"error"}[a]||"default"}function tt(a){return fe.value[a]||0}function st(a){const t=tt(a),m=(l.value[a]||[]).length;return t===0?"default":t===m?"success":"warning"}function at(a){const t=de.value[a]||[];return t.length>0&&t.every(m=>m.enabled)}function ot(a){const t=de.value[a]||[];return t.length>0&&t.every(m=>!m.enabled)}function lt(a){n.push({path:"/settings",query:a?{provider:a}:void 0})}function nt(){ye.value?q.value=[]:q.value=[...se.value]}async function rt(a,t){const m=await U(a,t);m.ok||(A.value=m.error.message)}async function we(a,t){const m=await u(a,t);m.ok||(A.value=m.error.message)}async function it(){const a=await O(!0);a.ok||(A.value=a.error.message)}async function dt(){const a=await O(!1);a.ok||(A.value=a.error.message)}async function _e(){T.value=!0,A.value="";try{E.info("V4 DEBUG: Starting discovery...");const a=await C({forceRefresh:!0});if(E.info("V4 DEBUG: Discovery result:",a),a.ok){E.info("V4 DEBUG: Discovery successful, models found:",a.value.totalModels),E.info("V4 DEBUG: After discovery, models.value.length =",o.value.length);const t=a.value.errors.filter(m=>!(m.includes("ollama")&&m.includes("not detected")));t.length>0&&(A.value=`Some sources failed: ${t.join("; ")}`)}else E.info("V4 DEBUG: Discovery failed:",a.error),A.value=`Discovery failed: ${a.error.message}`;J()}catch(a){E.error("Failed to refresh models",a),A.value="Failed to refresh models. Please check your connection and try again."}finally{T.value=!1}}async function ut(a){var t,m,R,z;he.value=a,A.value="";try{const k=await d(a);a==="ollama"&&(k.ok&&((m=(t=k.value)==null?void 0:t.errors)==null?void 0:m.some(le=>le.includes("not detected")))||!k.ok&&((z=(R=k.error)==null?void 0:R.message)==null?void 0:z.includes("not detected")))||(k.ok&&k.value.errors.length>0?A.value=`Failed to refresh ${L(a)}: ${k.value.errors.join("; ")}`:k.ok||(A.value=`Failed to refresh ${L(a)}: ${k.error.message}`)),J()}catch(k){E.error("Failed to retry source",k,{sourceId:a}),A.value=`Failed to refresh ${L(a)}: ${k instanceof Error?k.message:"Unknown error"}`}finally{he.value=null}}async function ct(){try{await d("ollama"),J(),Me()}catch(a){E.error("Failed to refresh Ollama models after update",a)}}async function Ce(){E.info("[ModelsView] Saving OpenRouter settings:",N.value),await P.settings.get("main")?(E.info("[ModelsView] Updating existing settings"),await P.settings.update("main",{hideOpenRouterFree:N.value.hideOpenRouterFree,hideOpenRouterAuto:N.value.hideOpenRouterAuto})):(E.info("[ModelsView] Creating new settings"),await P.settings.add({id:"main",version:1,initialized:!0,hideOpenRouterFree:N.value.hideOpenRouterFree,hideOpenRouterAuto:N.value.hideOpenRouterAuto}));const t=await P.settings.get("main");E.info("[ModelsView] Settings after save:",t)}async function Me(){try{(await Ft()).hasIssue?ie.value="not-detected":ie.value=null}catch{}}async function vt(){if(confirm("This will remove all models and re-discover them from scratch. Any custom model configurations will be lost. Continue?")){te.value=!0,A.value="";try{const t=await g();if(!t.ok){A.value=t.error.message;return}const m=await C({forceRefresh:!0});if(m.ok&&m.value.errors.length>0){const R=m.value.errors.filter(z=>!(z.includes("ollama")&&z.includes("not detected")));R.length>0&&(A.value=`Some sources failed: ${R.join("; ")}`)}else m.ok||(A.value=`Discovery failed: ${m.error.message}`);J()}catch(t){E.error("Failed to clear and refresh models",t),A.value="Failed to clear and refresh models. Please check your connection and try again."}finally{te.value=!1}}}async function pt(a){try{E.info("Applying model list:",a);const{getModelListManager:t}=await Te(async()=>{const{getModelListManager:z}=await import("./index-BET_-Wmx.js").then(k=>k.b7);return{getModelListManager:z}},__vite__mapDeps([0,1])),R=await t().applyList(a);E.info("Model list applied:",R),await _e()}catch(t){E.error("Failed to apply model list:",t),A.value=`Failed to apply model list: ${t instanceof Error?t.message:"Unknown error"}`}}Ot(()=>{We(K.value)});const Q=W(()=>s.value);return Be(async()=>{E.info("V4 DEBUG: models.value.length =",o.value.length),E.info("V4 DEBUG: models.value =",o.value),E.info("V4 DEBUG: modelsByProvider.value =",l.value);const a=await P.settings.get("main");a&&(N.value={hideOpenRouterFree:a.hideOpenRouterFree??!1,hideOpenRouterAuto:a.hideOpenRouterAuto??!1}),o.value.length===0&&(E.info("V4 DEBUG: No models found, refreshing..."),_e()),q.value=[],Me()}),$t(()=>{K.value="",q.value=[],A.value=""}),(a,t)=>{const m=M("a-button"),R=M("a-space"),z=M("a-alert"),k=M("a-tag"),ee=M("a-input-search"),le=M("a-radio-button"),mt=M("a-radio-group"),ft=M("a-divider"),Oe=M("a-dropdown"),$e=M("a-checkbox"),Pe=M("a-menu-item"),gt=M("a-menu"),yt=M("a-tooltip"),De=M("a-collapse-panel"),Ae=M("a-collapse"),_t=M("a-empty");return c(),h("div",Ys,[e("div",Zs,[t[13]||(t[13]=e("div",{class:"header-content"},[e("h1",null,"Model Management"),e("p",{class:"description"},"Configure and enable LLM models for testing")],-1)),i(R,null,{default:r(()=>[i(m,{type:"primary",onClick:_e,loading:T.value||y(v),"data-testid":"btn-refresh-models","aria-label":"Refresh available models"},{icon:r(()=>[i(y(Pt))]),default:r(()=>[t[11]||(t[11]=$(" Refresh Models "))]),_:1,__:[11]},8,["loading"]),i(m,{danger:"",onClick:vt,loading:te.value,"data-testid":"btn-clear-refresh-models","aria-label":"Clear all models and refresh"},{icon:r(()=>[i(y(Dt))]),default:r(()=>[t[12]||(t[12]=$(" Clear and Refresh Models "))]),_:1,__:[12]},8,["loading"])]),_:1})]),A.value&&!ge.value?(c(),I(z,{key:0,type:"error",message:A.value,closable:"",onClose:t[0]||(t[0]=w=>A.value=""),class:"error-alert"},null,8,["message"])):G("",!0),ge.value?(c(),I(z,{key:1,type:"info",closable:"",onClose:t[1]||(t[1]=w=>A.value=""),class:"ollama-info-alert"},{message:r(()=>t[14]||(t[14]=[e("div",{class:"ollama-message"},[$(" Ollama is not running on this computer. To audit local LLMs, install "),e("a",{href:"https://ollama.com",target:"_blank",rel:"noopener noreferrer"},"Ollama"),$(". ")],-1)])),_:1})):G("",!0),ie.value?(c(),I(z,{key:2,type:"info",closable:"",onClose:t[2]||(t[2]=w=>ie.value=null),class:"ollama-cors-alert"},{message:r(()=>t[15]||(t[15]=[e("div",{class:"ollama-cors-message"},[e("strong",null,"Ollama not detected: "),e("a",{href:"https://ollama.com",target:"_blank",rel:"noopener noreferrer"},"Ollama"),$(" is an external program for running LLMs on your computer. If Ollama is installed, you must "),e("a",{href:"https://objectgraph.com/blog/ollama-cors/",target:"_blank",rel:"noopener noreferrer"},"configure CORS"),$(' by setting OLLAMA_ORIGINS to "*" or "auditomatic.org". If you do not wish to use Ollama, close and ignore this message. ')],-1)])),_:1})):G("",!0),y(x).length>0?(c(),h("div",ea,[t[16]||(t[16]=e("span",{class:"status-label"},"Sources:",-1)),(c(!0),h(X,null,oe(y(x),w=>(c(),h("div",{key:w.id,class:"source-status-compact"},[e("span",ta,f(y(L)(w.id)),1),i(k,{color:et(w.status),size:"small"},{default:r(()=>[w.status==="success"&&w.modelCount?(c(),h(X,{key:0},[$(f(w.modelCount),1)],64)):w.status==="error"?(c(),h("span",{key:1,onClick:j=>ut(w.id),style:{cursor:"pointer"},"data-testid":`retry-source-${w.id}`,"aria-label":`Retry loading models from ${y(L)(w.id)}`},"⟳ retry",8,sa)):(c(),h(X,{key:2},[$(f(w.status),1)],64))]),_:2},1032,["color"])]))),128))])):G("",!0),e("div",aa,[i(ee,{value:K.value,"onUpdate:value":t[3]||(t[3]=w=>K.value=w),placeholder:"Search models by name, provider, or ID...","allow-clear":"",size:"large",class:"search-input","data-testid":"input-model-search","aria-label":"Search models",loading:K.value!==Y.value},null,8,["value","loading"]),i(mt,{value:V.value,"onUpdate:value":t[4]||(t[4]=w=>V.value=w),"button-style":"solid",size:"large"},{default:r(()=>[i(le,{value:"all"},{default:r(()=>t[17]||(t[17]=[$("All")])),_:1,__:[17]}),i(le,{value:"enabled"},{default:r(()=>t[18]||(t[18]=[$("Enabled")])),_:1,__:[18]}),i(le,{value:"disabled"},{default:r(()=>t[19]||(t[19]=[$("Disabled")])),_:1,__:[19]})]),_:1},8,["value"])]),e("div",oa,[e("div",la,[i(m,{type:"text",size:"small",onClick:nt},{icon:r(()=>[(c(),I(At(ye.value?Ze.value:Ye.value)))]),default:r(()=>[$(" "+f(ye.value?"Collapse All":"Expand All"),1)]),_:1}),i(ft,{type:"vertical"}),i(m,{type:"text",size:"small",onClick:it,loading:Q.value,disabled:Q.value},{icon:r(()=>[i(y(Re))]),default:r(()=>[t[20]||(t[20]=$(" Enable All "))]),_:1,__:[20]},8,["loading","disabled"]),i(m,{type:"text",size:"small",onClick:dt,loading:Q.value,disabled:Q.value},{icon:r(()=>[i(y(Ve))]),default:r(()=>[t[21]||(t[21]=$(" Disable All "))]),_:1,__:[21]},8,["loading","disabled"]),i(Oe,{open:pe.value,"onUpdate:open":t[6]||(t[6]=w=>pe.value=w),placement:"bottomLeft",disabled:Q.value},{overlay:r(()=>[i(Xs,{"current-models":Array.from(y(o)),"is-loading":Q.value,onApplyList:pt,onClose:t[5]||(t[5]=w=>pe.value=!1)},null,8,["current-models","is-loading"])]),default:r(()=>[i(m,{type:"text",size:"small",loading:Q.value,disabled:Q.value},{icon:r(()=>[i(y(Ut))]),default:r(()=>[t[22]||(t[22]=$(" Model Lists ")),i(y(St))]),_:1,__:[22]},8,["loading","disabled"])]),_:1},8,["open","disabled"]),Qe.value?(c(),I(Oe,{key:0},{overlay:r(()=>[i(gt,null,{default:r(()=>[i(Pe,{key:"privacy"},{default:r(()=>[e("div",na,[i($e,{checked:N.value.hideOpenRouterFree,"onUpdate:checked":t[7]||(t[7]=w=>N.value.hideOpenRouterFree=w),onChange:Ce},{default:r(()=>t[23]||(t[23]=[$(" Hide free models (privacy concerns) ")])),_:1,__:[23]},8,["checked"])])]),_:1}),i(Pe,{key:"auto"},{default:r(()=>[e("div",ra,[i($e,{checked:N.value.hideOpenRouterAuto,"onUpdate:checked":t[8]||(t[8]=w=>N.value.hideOpenRouterAuto=w),onChange:Ce},{default:r(()=>t[24]||(t[24]=[$(" Hide Auto Router (unpredictable costs) ")])),_:1,__:[24]},8,["checked"])])]),_:1})]),_:1})]),default:r(()=>[i(m,{type:"text",size:"small"},{icon:r(()=>[i(y(Ne))]),default:r(()=>[t[25]||(t[25]=$(" OpenRouter Settings "))]),_:1,__:[25]})]),_:1})):G("",!0)]),e("div",ia,[e("span",null,f(Je.value)+" of "+f(He.value)+" models enabled",1)])]),i(Ae,{activeKey:q.value,"onUpdate:activeKey":t[9]||(t[9]=w=>q.value=w),bordered:!1,class:"provider-collapse",destroyInactivePanel:!1},{default:r(()=>[(c(!0),h(X,null,oe(de.value,(w,j)=>(c(),I(De,{key:`provider-${j}`},{header:r(()=>{var Se,Ee;return[e("div",da,[e("div",ua,[e("strong",null,f(y(H)(j)),1),(Se=Z.value[j])!=null&&Se.requiresKey&&!((Ee=Z.value[j])!=null&&Ee.hasKey)?(c(),I(yt,{key:0,placement:"top"},{title:r(()=>{var ne;return[$(" API key not set for "+f((ne=Z.value[j])==null?void 0:ne.providerGroup)+". Click to add in settings. ",1)]}),default:r(()=>[i(m,{type:"link",danger:"",size:"small",onClick:re(ne=>{var xe;return lt((xe=Z.value[j])==null?void 0:xe.providerGroup)},["stop"])},{icon:r(()=>[i(y(xt))]),default:r(()=>[t[26]||(t[26]=$(" API Key Missing "))]),_:2,__:[26]},1032,["onClick"])]),_:2},1024)):G("",!0),q.value.includes(j)?(c(),h(X,{key:2},[i(k,{size:"small",color:"blue"},{default:r(()=>[$(f(w.length)+" models",1)]),_:2},1024),i(k,{size:"small",color:st(j)},{default:r(()=>[$(f(fe.value[j]||0)+" enabled ",1)]),_:2},1032,["color"])],64)):(c(),h("span",ca,f(fe.value[j]||0)+" / "+f((y(l)[j]||[]).length)+" enabled ",1))]),i(R,{size:"small"},{default:r(()=>[i(m,{type:"text",size:"small",onClick:re(ne=>we(j,!0),["stop"]),disabled:at(j)||Q.value,loading:Q.value},{icon:r(()=>[i(y(Re))]),default:r(()=>[t[27]||(t[27]=$(" Enable All "))]),_:2,__:[27]},1032,["onClick","disabled","loading"]),i(m,{type:"text",size:"small",onClick:re(ne=>we(j,!1),["stop"]),disabled:ot(j)||Q.value,loading:Q.value},{icon:r(()=>[i(y(Ve))]),default:r(()=>[t[28]||(t[28]=$(" Disable All "))]),_:2,__:[28]},1032,["onClick","disabled","loading"])]),_:2},1024)])]}),default:r(()=>[(c(),I(Et,null,[i(vs,{models:w,"provider-id":j,onToggleModel:rt},null,8,["models","provider-id"])],1024))]),_:2},1024))),128))]),_:1},8,["activeKey"]),Object.keys(de.value).length===0?(c(),I(_t,{key:4,description:qe.value,class:"empty-state"},null,8,["description"])):G("",!0),Xe.value?(c(),I(Ae,{key:5,activeKey:ke.value,"onUpdate:activeKey":t[10]||(t[10]=w=>ke.value=w),bordered:!1,class:"ollama-manager-collapse"},{default:r(()=>[i(De,{key:"ollama"},{header:r(()=>t[29]||(t[29]=[e("div",{class:"ollama-header"},[e("strong",null,"Ollama Model Management"),e("span",{class:"ollama-description"},"Download and manage local Ollama models")],-1)])),default:r(()=>[i(Rt,{onModelsUpdated:ct})]),_:1})]),_:1},8,["activeKey"])):G("",!0),Ke.value?(c(),I(Us,{key:6,class:"enhanced-features"})):G("",!0)])}}}),wa=ve(va,[["__scopeId","data-v-5fbbcd2a"]]);export{wa as default};
