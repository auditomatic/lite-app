const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/trial-bundle.service-DAmw5b9V.js","assets/index-CYHr6_OZ.js","assets/vue-vendor-DPw1dQYc.js","assets/ui-vendor-DDlYs5wr.js","assets/utils-vendor-DcTsQz_8.js","assets/index-cTUJCLSS.css","assets/data-vendor-B7q_-eFq.js","assets/index-D1VCbtMP.js","assets/useCostEstimation-Bw_g6ruR.js","assets/ParserSelector-CgLFffd7.js","assets/parser.store-nNktwsf2.js","assets/ParserSelector-DMLEdzpb.css","assets/trial-stream-manager-v4-BnyAuEcT.js","assets/execution-control-v4-DqPc-XBZ.js","assets/useV4TrialCommands-BXXNX7c6.js","assets/useHeatmapStylingV3-CCIdVOn4.js","assets/useV4Models-DmsVy83z.js","assets/useV4LiveQuery-B-RpOK8L.js"])))=>i.map(i=>d[i]);
var hs=Object.defineProperty;var ys=(l,e,t)=>e in l?hs(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var ke=(l,e,t)=>ys(l,typeof e!="symbol"?e+"":e,t);import{d as oe,f as q,c as U,o as me,b as ye,w as le,R as v,a0 as te,S as s,_ as R,a9 as we,a3 as he,Y as d,y as Ce,aa as bs,ab as _s,ac as Ts,$ as Q,ad as $s,ae as Cs,af as Vt,q as Ot,n as Se,k,Z as F,F as Y,W as ee,a5 as _t,ag as ks,ah as ws,u as j,a4 as st,V as b,G as D,M as Pe,ai as xe,U as Dt,A as Nt,aj as Ss,B as Lt,r as Is,a7 as Es,a1 as Mt,X as je,a6 as at}from"./vue-vendor-DPw1dQYc.js";import{j as re,a as P,u as Rs,b as Tt,y as Oe,z as Fs,x as Ps,d as Re,B as xs,e as $t,C as As,_ as Ie}from"./index-CYHr6_OZ.js";import{aG as Ut,G as zt,aR as Vs,m as pe,P as Os,aS as Bt,aT as Ds,r as pt,ay as Ns,M as ft,t as mt,v as Ls,a0 as jt,J as Ct,aU as Ms,a9 as Us,au as zs,aL as Wt,s as Bs,aH as js,W as Ws,C as vt,q as Hs,w as qs,x as Te,aw as Ht,aM as Fe,T as We,K as He,D as Gs,y as Z,aI as Js,al as qt,a4 as Xs,a5 as Ks,a3 as Gt,aV as Qs,ah as Jt,E as Xt,aj as Ys,ak as Zs,H as ea,n as ta,az as sa,aW as Ye,R as aa,X as na,at as gt,av as oa,aX as ht,l as Kt,$ as ra}from"./ui-vendor-DDlYs5wr.js";import{b as Qt}from"./utils-vendor-DcTsQz_8.js";import{u as qe}from"./useCostEstimation-Bw_g6ruR.js";import{P as la}from"./ParserSelector-CgLFffd7.js";import{u as Ge,a as Yt}from"./trial-stream-manager-v4-BnyAuEcT.js";import{u as ia}from"./parser.store-nNktwsf2.js";import{v as kt,u as ua,a as da,b as ca}from"./useV4TrialCommands-BXXNX7c6.js";import{u as pa}from"./useHeatmapStylingV3-CCIdVOn4.js";import{u as Ze,w as fa}from"./data-vendor-B7q_-eFq.js";import{u as ma}from"./execution-control-v4-DqPc-XBZ.js";import{u as va}from"./useV4Models-DmsVy83z.js";const ga={class:"right-panel"},ha=oe({__name:"ResizablePanelContainer",props:{storageKey:{default:"trial-list-width"},defaultWidth:{default:250},minWidth:{default:200},maxWidth:{default:600},mobileBreakpoint:{default:768}},emits:["resize","mobile-overlay-change"],setup(l,{expose:e,emit:t}){const a=l,o=t,n=q(a.defaultWidth),u=q(!1),p=q(0),c=q(0),m=q(window.innerWidth),g=q(!1),h=U(()=>m.value<a.mobileBreakpoint),$=U(()=>h.value?{width:`${Math.min(m.value*.85,400)}px`}:{width:`${n.value}px`});function I(){const f=localStorage.getItem(a.storageKey);if(f){const i=parseInt(f,10);!isNaN(i)&&i>=a.minWidth&&i<=a.maxWidth&&(n.value=i)}}function T(f){localStorage.setItem(a.storageKey,f.toString()),o("resize",f)}function C(f){u.value=!0,p.value=f.clientX,c.value=n.value,document.addEventListener("mousemove",N),document.addEventListener("mouseup",H),document.body.style.userSelect="none",document.body.style.cursor="col-resize"}function N(f){if(!u.value)return;const i=f.clientX-p.value,O=Math.max(a.minWidth,Math.min(a.maxWidth,c.value+i));n.value=O}function H(){u.value&&(u.value=!1,T(n.value),document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",H),document.body.style.userSelect="",document.body.style.cursor="")}function V(){n.value=a.defaultWidth,T(a.defaultWidth)}function E(){m.value=window.innerWidth,!h.value&&g.value&&(g.value=!1,o("mobile-overlay-change",!1))}function w(){h.value&&(g.value=!g.value,o("mobile-overlay-change",g.value))}function z(){g.value=!1,o("mobile-overlay-change",!1)}return e({toggleMobileOverlay:w,closeMobileOverlay:z}),me(()=>{I(),window.addEventListener("resize",E)}),ye(()=>{window.removeEventListener("resize",E),H()}),le(()=>a.defaultWidth,f=>{n.value===a.defaultWidth&&(n.value=f)}),(f,i)=>(d(),v("div",{class:te(["resizable-panel-container",{"mobile-overlay":h.value}])},[s("div",{class:te(["left-panel",{"overlay-visible":h.value&&g.value}]),style:he($.value)},[we(f.$slots,"left",{},void 0,!0)],6),h.value?R("",!0):(d(),v("div",{key:0,class:te(["resize-handle",{dragging:u.value}]),onMousedown:C,onDblclick:V},i[0]||(i[0]=[s("div",{class:"handle-bar"},null,-1)]),34)),s("div",ga,[we(f.$slots,"right",{},void 0,!0)]),h.value&&g.value?(d(),v("div",{key:1,class:"mobile-overlay-bg",onClick:z})):R("",!0)],2))}}),ya=re(ha,[["__scopeId","data-v-949e1df1"]]);function ba(){var l=window.navigator.userAgent,e=l.indexOf("MSIE ");if(e>0)return parseInt(l.substring(e+5,l.indexOf(".",e)),10);var t=l.indexOf("Trident/");if(t>0){var a=l.indexOf("rv:");return parseInt(l.substring(a+3,l.indexOf(".",a)),10)}var o=l.indexOf("Edge/");return o>0?parseInt(l.substring(o+5,l.indexOf(".",o)),10):-1}let Ne;function nt(){nt.init||(nt.init=!0,Ne=ba()!==-1)}var Je={name:"ResizeObserver",props:{emitOnMount:{type:Boolean,default:!1},ignoreWidth:{type:Boolean,default:!1},ignoreHeight:{type:Boolean,default:!1}},emits:["notify"],mounted(){nt(),Ce(()=>{this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitOnMount&&this.emitSize()});const l=document.createElement("object");this._resizeObject=l,l.setAttribute("aria-hidden","true"),l.setAttribute("tabindex",-1),l.onload=this.addResizeHandlers,l.type="text/html",Ne&&this.$el.appendChild(l),l.data="about:blank",Ne||this.$el.appendChild(l)},beforeUnmount(){this.removeResizeHandlers()},methods:{compareAndNotify(){(!this.ignoreWidth&&this._w!==this.$el.offsetWidth||!this.ignoreHeight&&this._h!==this.$el.offsetHeight)&&(this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitSize())},emitSize(){this.$emit("notify",{width:this._w,height:this._h})},addResizeHandlers(){this._resizeObject.contentDocument.defaultView.addEventListener("resize",this.compareAndNotify),this.compareAndNotify()},removeResizeHandlers(){this._resizeObject&&this._resizeObject.onload&&(!Ne&&this._resizeObject.contentDocument&&this._resizeObject.contentDocument.defaultView.removeEventListener("resize",this.compareAndNotify),this.$el.removeChild(this._resizeObject),this._resizeObject.onload=null,this._resizeObject=null)}}};const _a=Ts();bs("data-v-b329ee4c");const Ta={class:"resize-observer",tabindex:"-1"};_s();const $a=_a((l,e,t,a,o,n)=>(d(),Q("div",Ta)));Je.render=$a;Je.__scopeId="data-v-b329ee4c";Je.__file="src/components/ResizeObserver.vue";function Le(l){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Le=function(e){return typeof e}:Le=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Le(l)}function Ca(l,e){if(!(l instanceof e))throw new TypeError("Cannot call a class as a function")}function ka(l,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(l,a.key,a)}}function wa(l,e,t){return e&&ka(l.prototype,e),l}function wt(l){return Sa(l)||Ia(l)||Ea(l)||Ra()}function Sa(l){if(Array.isArray(l))return ot(l)}function Ia(l){if(typeof Symbol<"u"&&Symbol.iterator in Object(l))return Array.from(l)}function Ea(l,e){if(l){if(typeof l=="string")return ot(l,e);var t=Object.prototype.toString.call(l).slice(8,-1);if(t==="Object"&&l.constructor&&(t=l.constructor.name),t==="Map"||t==="Set")return Array.from(l);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ot(l,e)}}function ot(l,e){(e==null||e>l.length)&&(e=l.length);for(var t=0,a=new Array(e);t<e;t++)a[t]=l[t];return a}function Ra(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Fa(l){var e;return typeof l=="function"?e={callback:l}:e=l,e}function Pa(l,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a,o,n,u=function(c){for(var m=arguments.length,g=new Array(m>1?m-1:0),h=1;h<m;h++)g[h-1]=arguments[h];if(n=g,!(a&&c===o)){var $=t.leading;typeof $=="function"&&($=$(c,o)),(!a||c!==o)&&$&&l.apply(void 0,[c].concat(wt(n))),o=c,clearTimeout(a),a=setTimeout(function(){l.apply(void 0,[c].concat(wt(n))),a=0},e)}};return u._clear=function(){clearTimeout(a),a=null},u}function Zt(l,e){if(l===e)return!0;if(Le(l)==="object"){for(var t in l)if(!Zt(l[t],e[t]))return!1;return!0}return!1}var xa=(function(){function l(e,t,a){Ca(this,l),this.el=e,this.observer=null,this.frozen=!1,this.createObserver(t,a)}return wa(l,[{key:"createObserver",value:function(t,a){var o=this;if(this.observer&&this.destroyObserver(),!this.frozen){if(this.options=Fa(t),this.callback=function(p,c){o.options.callback(p,c),p&&o.options.once&&(o.frozen=!0,o.destroyObserver())},this.callback&&this.options.throttle){var n=this.options.throttleOptions||{},u=n.leading;this.callback=Pa(this.callback,this.options.throttle,{leading:function(c){return u==="both"||u==="visible"&&c||u==="hidden"&&!c}})}this.oldResult=void 0,this.observer=new IntersectionObserver(function(p){var c=p[0];if(p.length>1){var m=p.find(function(h){return h.isIntersecting});m&&(c=m)}if(o.callback){var g=c.isIntersecting&&c.intersectionRatio>=o.threshold;if(g===o.oldResult)return;o.oldResult=g,o.callback(g,c)}},this.options.intersection),Ce(function(){o.observer&&o.observer.observe(o.el)})}}},{key:"destroyObserver",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null),this.callback&&this.callback._clear&&(this.callback._clear(),this.callback=null)}},{key:"threshold",get:function(){return this.options.intersection&&typeof this.options.intersection.threshold=="number"?this.options.intersection.threshold:0}}]),l})();function es(l,e,t){var a=e.value;if(a)if(typeof IntersectionObserver>"u")console.warn("[vue-observe-visibility] IntersectionObserver API is not available in your browser. Please install this polyfill: https://github.com/w3c/IntersectionObserver/tree/master/polyfill");else{var o=new xa(l,a,t);l._vue_visibilityState=o}}function Aa(l,e,t){var a=e.value,o=e.oldValue;if(!Zt(a,o)){var n=l._vue_visibilityState;if(!a){ts(l);return}n?n.createObserver(a,t):es(l,{value:a},t)}}function ts(l){var e=l._vue_visibilityState;e&&(e.destroyObserver(),delete l._vue_visibilityState)}var Va={beforeMount:es,updated:Aa,unmounted:ts},Oa={itemsLimit:1e3},Da=/(auto|scroll)/;function ss(l,e){return l.parentNode===null?e:ss(l.parentNode,e.concat([l]))}var et=function(e,t){return getComputedStyle(e,null).getPropertyValue(t)},Na=function(e){return et(e,"overflow")+et(e,"overflow-y")+et(e,"overflow-x")},La=function(e){return Da.test(Na(e))};function St(l){if(l instanceof HTMLElement||l instanceof SVGElement){for(var e=ss(l.parentNode,[]),t=0;t<e.length;t+=1)if(La(e[t]))return e[t];return document.scrollingElement||document.documentElement}}function rt(l){"@babel/helpers - typeof";return rt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rt(l)}var Ma={items:{type:Array,required:!0},keyField:{type:String,default:"id"},direction:{type:String,default:"vertical",validator:function(e){return["vertical","horizontal"].includes(e)}},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"}};function Ua(){return this.items.length&&rt(this.items[0])!=="object"}var lt=!1;if(typeof window<"u"){lt=!1;try{var za=Object.defineProperty({},"passive",{get:function(){lt=!0}});window.addEventListener("test",null,za)}catch{}}let Ba=0;var Xe={name:"RecycleScroller",components:{ResizeObserver:Je},directives:{ObserveVisibility:Va},props:{...Ma,itemSize:{type:Number,default:null},gridItems:{type:Number,default:void 0},itemSecondarySize:{type:Number,default:void 0},minItemSize:{type:[Number,String],default:null},sizeField:{type:String,default:"size"},typeField:{type:String,default:"type"},buffer:{type:Number,default:200},pageMode:{type:Boolean,default:!1},prerender:{type:Number,default:0},emitUpdate:{type:Boolean,default:!1},updateInterval:{type:Number,default:0},skipHover:{type:Boolean,default:!1},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},listClass:{type:[String,Object,Array],default:""},itemClass:{type:[String,Object,Array],default:""}},emits:["resize","visible","hidden","update","scroll-start","scroll-end"],data(){return{pool:[],totalSize:0,ready:!1,hoverKey:null}},computed:{sizes(){if(this.itemSize===null){const l={"-1":{accumulator:0}},e=this.items,t=this.sizeField,a=this.minItemSize;let o=1e4,n=0,u;for(let p=0,c=e.length;p<c;p++)u=e[p][t]||a,u<o&&(o=u),n+=u,l[p]={accumulator:n,size:u};return this.$_computedMinItemSize=o,l}return[]},simpleArray:Ua,itemIndexByKey(){const{keyField:l,items:e}=this,t={};for(let a=0,o=e.length;a<o;a++)t[e[a][l]]=a;return t}},watch:{items(){this.updateVisibleItems(!0)},pageMode(){this.applyPageMode(),this.updateVisibleItems(!1)},sizes:{handler(){this.updateVisibleItems(!1)},deep:!0},gridItems(){this.updateVisibleItems(!0)},itemSecondarySize(){this.updateVisibleItems(!0)}},created(){this.$_startIndex=0,this.$_endIndex=0,this.$_views=new Map,this.$_unusedViews=new Map,this.$_scrollDirty=!1,this.$_lastUpdateScrollPosition=0,this.prerender&&(this.$_prerender=!0,this.updateVisibleItems(!1)),this.gridItems&&!this.itemSize&&console.error("[vue-recycle-scroller] You must provide an itemSize when using gridItems")},mounted(){this.applyPageMode(),this.$nextTick(()=>{this.$_prerender=!1,this.updateVisibleItems(!0),this.ready=!0})},activated(){const l=this.$_lastUpdateScrollPosition;typeof l=="number"&&this.$nextTick(()=>{this.scrollToPosition(l)})},beforeUnmount(){this.removeListeners()},methods:{addView(l,e,t,a,o){const n=$s({id:Ba++,index:e,used:!0,key:a,type:o}),u=Cs({item:t,position:0,nr:n});return l.push(u),u},unuseView(l,e=!1){const t=this.$_unusedViews,a=l.nr.type;let o=t.get(a);o||(o=[],t.set(a,o)),o.push(l),e||(l.nr.used=!1,l.position=-9999)},handleResize(){this.$emit("resize"),this.ready&&this.updateVisibleItems(!1)},handleScroll(l){if(!this.$_scrollDirty){if(this.$_scrollDirty=!0,this.$_updateTimeout)return;const e=()=>requestAnimationFrame(()=>{this.$_scrollDirty=!1;const{continuous:t}=this.updateVisibleItems(!1,!0);t||(clearTimeout(this.$_refreshTimout),this.$_refreshTimout=setTimeout(this.handleScroll,this.updateInterval+100))});e(),this.updateInterval&&(this.$_updateTimeout=setTimeout(()=>{this.$_updateTimeout=0,this.$_scrollDirty&&e()},this.updateInterval))}},handleVisibilityChange(l,e){this.ready&&(l||e.boundingClientRect.width!==0||e.boundingClientRect.height!==0?(this.$emit("visible"),requestAnimationFrame(()=>{this.updateVisibleItems(!1)})):this.$emit("hidden"))},updateVisibleItems(l,e=!1){const t=this.itemSize,a=this.gridItems||1,o=this.itemSecondarySize||t,n=this.$_computedMinItemSize,u=this.typeField,p=this.simpleArray?null:this.keyField,c=this.items,m=c.length,g=this.sizes,h=this.$_views,$=this.$_unusedViews,I=this.pool,T=this.itemIndexByKey;let C,N,H,V,E;if(!m)C=N=V=E=H=0;else if(this.$_prerender)C=V=0,N=E=Math.min(this.prerender,c.length),H=null;else{const r=this.getScroll();if(e){let _=r.start-this.$_lastUpdateScrollPosition;if(_<0&&(_=-_),t===null&&_<n||_<t)return{continuous:!0}}this.$_lastUpdateScrollPosition=r.start;const B=this.buffer;r.start-=B,r.end+=B;let x=0;if(this.$refs.before&&(x=this.$refs.before.scrollHeight,r.start-=x),this.$refs.after){const _=this.$refs.after.scrollHeight;r.end+=_}if(t===null){let _,L=0,A=m-1,X=~~(m/2),y;do y=X,_=g[X].accumulator,_<r.start?L=X:X<m-1&&g[X+1].accumulator>r.start&&(A=X),X=~~((L+A)/2);while(X!==y);for(X<0&&(X=0),C=X,H=g[m-1].accumulator,N=X;N<m&&g[N].accumulator<r.end;N++);for(N===-1?N=c.length-1:(N++,N>m&&(N=m)),V=C;V<m&&x+g[V].accumulator<r.start;V++);for(E=V;E<m&&x+g[E].accumulator<r.end;E++);}else{C=~~(r.start/t*a);const _=C%a;C-=_,N=Math.ceil(r.end/t*a),V=Math.max(0,Math.floor((r.start-x)/t*a)),E=Math.floor((r.end-x)/t*a),C<0&&(C=0),N>m&&(N=m),V<0&&(V=0),E>m&&(E=m),H=Math.ceil(m/a)*t}}N-C>Oa.itemsLimit&&this.itemsLimitError(),this.totalSize=H;let w;const z=C<=this.$_endIndex&&N>=this.$_startIndex;if(z)for(let r=0,B=I.length;r<B;r++)w=I[r],w.nr.used&&(l&&(w.nr.index=T[w.item[p]]),(w.nr.index==null||w.nr.index<C||w.nr.index>=N)&&this.unuseView(w));const f=z?null:new Map;let i,O,S;for(let r=C;r<N;r++){i=c[r];const B=p?i[p]:i;if(B==null)throw new Error(`Key is ${B} on item (keyField is '${p}')`);if(w=h.get(B),!t&&!g[r].size){w&&this.unuseView(w);continue}O=i[u];let x=$.get(O),_=!1;if(!w)z?x&&x.length?w=x.pop():w=this.addView(I,r,i,B,O):(S=f.get(O)||0,(!x||S>=x.length)&&(w=this.addView(I,r,i,B,O),this.unuseView(w,!0),x=$.get(O)),w=x[S],f.set(O,S+1)),h.delete(w.nr.key),w.nr.used=!0,w.nr.index=r,w.nr.key=B,w.nr.type=O,h.set(B,w),_=!0;else if(!w.nr.used&&(w.nr.used=!0,_=!0,x)){const L=x.indexOf(w);L!==-1&&x.splice(L,1)}w.item=i,_&&(r===c.length-1&&this.$emit("scroll-end"),r===0&&this.$emit("scroll-start")),t===null?(w.position=g[r-1].accumulator,w.offset=0):(w.position=Math.floor(r/a)*t,w.offset=r%a*o)}return this.$_startIndex=C,this.$_endIndex=N,this.emitUpdate&&this.$emit("update",C,N,V,E),clearTimeout(this.$_sortTimer),this.$_sortTimer=setTimeout(this.sortViews,this.updateInterval+300),{continuous:z}},getListenerTarget(){let l=St(this.$el);return window.document&&(l===window.document.documentElement||l===window.document.body)&&(l=window),l},getScroll(){const{$el:l,direction:e}=this,t=e==="vertical";let a;if(this.pageMode){const o=l.getBoundingClientRect(),n=t?o.height:o.width;let u=-(t?o.top:o.left),p=t?window.innerHeight:window.innerWidth;u<0&&(p+=u,u=0),u+p>n&&(p=n-u),a={start:u,end:u+p}}else t?a={start:l.scrollTop,end:l.scrollTop+l.clientHeight}:a={start:l.scrollLeft,end:l.scrollLeft+l.clientWidth};return a},applyPageMode(){this.pageMode?this.addListeners():this.removeListeners()},addListeners(){this.listenerTarget=this.getListenerTarget(),this.listenerTarget.addEventListener("scroll",this.handleScroll,lt?{passive:!0}:!1),this.listenerTarget.addEventListener("resize",this.handleResize)},removeListeners(){this.listenerTarget&&(this.listenerTarget.removeEventListener("scroll",this.handleScroll),this.listenerTarget.removeEventListener("resize",this.handleResize),this.listenerTarget=null)},scrollToItem(l){let e;const t=this.gridItems||1;this.itemSize===null?e=l>0?this.sizes[l-1].accumulator:0:e=Math.floor(l/t)*this.itemSize,this.scrollToPosition(e)},scrollToPosition(l){const e=this.direction==="vertical"?{scroll:"scrollTop",start:"top"}:{scroll:"scrollLeft",start:"left"};let t,a,o;if(this.pageMode){const n=St(this.$el),u=n.tagName==="HTML"?0:n[e.scroll],p=n.getBoundingClientRect(),m=this.$el.getBoundingClientRect()[e.start]-p[e.start];t=n,a=e.scroll,o=l+u+m}else t=this.$el,a=e.scroll,o=l;t[a]=o},itemsLimitError(){throw setTimeout(()=>{this.$el}),new Error("Rendered items limit reached")},sortViews(){this.pool.sort((l,e)=>l.nr.index-e.nr.index)}}};const ja={key:0,ref:"before",class:"vue-recycle-scroller__slot"},Wa={key:1,ref:"after",class:"vue-recycle-scroller__slot"};function Ha(l,e,t,a,o,n){const u=Vt("ResizeObserver"),p=Ot("observe-visibility");return Se((d(),v("div",{class:te(["vue-recycle-scroller",{ready:o.ready,"page-mode":t.pageMode,[`direction-${l.direction}`]:!0}]),onScrollPassive:e[0]||(e[0]=(...c)=>n.handleScroll&&n.handleScroll(...c))},[l.$slots.before?(d(),v("div",ja,[we(l.$slots,"before")],512)):R("v-if",!0),(d(),Q(_t(t.listTag),{ref:"wrapper",style:he({[l.direction==="vertical"?"minHeight":"minWidth"]:o.totalSize+"px"}),class:te(["vue-recycle-scroller__item-wrapper",t.listClass])},{default:F(()=>[(d(!0),v(Y,null,ee(o.pool,c=>(d(),Q(_t(t.itemTag),ks({key:c.nr.id,style:o.ready?{transform:`translate${l.direction==="vertical"?"Y":"X"}(${c.position}px) translate${l.direction==="vertical"?"X":"Y"}(${c.offset}px)`,width:t.gridItems?`${l.direction==="vertical"&&t.itemSecondarySize||t.itemSize}px`:void 0,height:t.gridItems?`${l.direction==="horizontal"&&t.itemSecondarySize||t.itemSize}px`:void 0}:null,class:["vue-recycle-scroller__item-view",[t.itemClass,{hover:!t.skipHover&&o.hoverKey===c.nr.key}]]},ws(t.skipHover?{}:{mouseenter:()=>{o.hoverKey=c.nr.key},mouseleave:()=>{o.hoverKey=null}})),{default:F(()=>[we(l.$slots,"default",{item:c.item,index:c.nr.index,active:c.nr.used})]),_:2},1040,["style","class"]))),128)),we(l.$slots,"empty")]),_:3},8,["style","class"])),l.$slots.after?(d(),v("div",Wa,[we(l.$slots,"after")],512)):R("v-if",!0),k(u,{onNotify:n.handleResize},null,8,["onNotify"])],34)),[[p,n.handleVisibilityChange]])}Xe.render=Ha;Xe.__file="src/components/RecycleScroller.vue";const qa={class:"trial-list-search"},Ga=["value"],Ja=oe({__name:"TrialListSearch",props:{modelValue:{}},emits:["update:modelValue"],setup(l,{emit:e}){const t=e,a=q(),o=Qt(m=>{t("update:modelValue",m)},300);function n(m){const g=m.target.value;o(g)}function u(){t("update:modelValue",""),a.value?.focus()}function p(){a.value?.focus(),a.value?.select()}function c(m){m.type==="focus-trial-search"&&p()}return me(()=>{window.addEventListener("focus-trial-search",c)}),ye(()=>{window.removeEventListener("focus-trial-search",c)}),(m,g)=>(d(),v("div",qa,[k(j(Ut),{class:"search-icon"}),s("input",{ref_key:"searchInput",ref:a,type:"text",class:"search-input",placeholder:"Filter trials...",value:m.modelValue,onInput:n,onKeydown:st(u,["escape"])},null,40,Ga),m.modelValue?(d(),Q(j(zt),{key:0,class:"clear-icon",onClick:u})):R("",!0)]))}}),Xa=re(Ja,[["__scopeId","data-v-3a032c2b"]]),Ka={class:"item-content"},Qa={class:"item-header"},Ya=["title"],Za={key:0,class:"progress-bar"},en={class:"item-metadata"},tn={class:"meta-item"},sn={class:"meta-item"},an={key:0,class:"meta-separator"},nn={key:1,class:"meta-item cost"},on=oe({__name:"TrialListItem",props:{trial:{},selected:{type:Boolean}},emits:["click"],setup(l){const e=l,{calculateTemplateTokens:t,calculatePromptTokens:a,estimateTotalCost:o,sumEstimates:n,formatCost:u}=qe(),p=U(()=>{if(e.trial.progress.total===0)return 0;const h=e.trial.progress.completed+e.trial.progress.failed;return Math.round(h/e.trial.progress.total*100)}),c=U(()=>{const{completed:h,failed:$,total:I}=e.trial.progress;return e.trial.status==="draft"?`${I} tasks`:`${h+$}/${I} tasks`}),m=U(()=>{const h=e.trial.started||e.trial.created;if(!h)return"";const I=new Date().getTime()-h.getTime(),T=Math.floor(I/1e3),C=Math.floor(T/60),N=Math.floor(C/60),H=Math.floor(N/24);return T<60?"now":C<60?`${C}m`:N<24?`${N}h`:`${H}d`}),g=U(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let h=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)h=t(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const T=a(e.trial.spreadsheetConfig.promptPattern),C=e.trial.progress.total/e.trial.configurations.length;h={totalTokens:T*C,combinationCount:C,perCallAverage:T}}else if(e.trial.type==="playground")return null;if(!h||h.totalTokens===0)return null;const $=e.trial.configurations.map(T=>{const C=T.modelSnapshot;return C?o(h.totalTokens,h.combinationCount,C,T.parameters):null}).filter(Boolean);if($.length===0)return null;const I=n($);return`${u(I,"compact")} total`});return(h,$)=>(d(),v("div",{class:te(["trial-list-item",{selected:h.selected,"has-progress":h.trial.status==="running"}]),onClick:$[0]||($[0]=I=>h.$emit("click"))},[s("div",{class:te(["status-indicator",`status-${h.trial.status}`])},null,2),s("div",Ka,[s("div",Qa,[s("span",{class:"trial-name",title:h.trial.name},b(h.trial.name),9,Ya),s("span",{class:te(["status-tag",`status-${h.trial.status}`])},b(h.trial.status.toUpperCase()),3)]),h.trial.status==="running"?(d(),v("div",Za,[s("div",{class:"progress-fill",style:he({width:`${p.value}%`})},null,4)])):R("",!0),s("div",en,[s("span",tn,b(c.value),1),$[1]||($[1]=s("span",{class:"meta-separator"},"•",-1)),s("span",sn,b(m.value),1),g.value?(d(),v("span",an,"•")):R("",!0),g.value?(d(),v("span",nn,b(g.value),1)):R("",!0)])])],2))}}),It=re(on,[["__scopeId","data-v-037b1757"]]),rn={class:"section-title"},ln=oe({__name:"TrialListSection",props:{title:{},background:{type:Boolean}},setup(l){return(e,t)=>(d(),v("div",{class:te(["trial-list-section",{"with-background":e.background}])},[s("span",rn,b(e.title),1)],2))}}),Et=re(ln,[["__scopeId","data-v-07a26c58"]]),un={class:"panel-header"},dn={class:"header-title"},cn={key:0,class:"title-text"},pn={class:"trial-count"},fn={key:0,class:"header-actions"},mn={class:"filter-count"},vn={class:"filter-count"},gn={class:"filter-count"},hn={class:"filter-count"},yn={class:"filter-count"},bn={key:1,class:"status-tabs"},_n={class:"tab-count"},Tn={class:"tab-count"},$n={class:"tab-count"},Cn={class:"trial-list-container"},kn={key:1,class:"trial-list"},wn={key:2,class:"collapsed-list"},Sn=["onClick"],In={class:"collapsed-count"},En={key:3,class:"empty-state"},Rn=oe({__name:"TrialListPanelV3",props:{trials:{},selectedTrialId:{},searchQuery:{},filterStatus:{}},emits:["select-trial","create-trial","import-trial","update-search","update-filter","refresh"],setup(l,{emit:e}){const t=l,a=e,o=q(!1),n=q("all"),u=q(250),p=U(()=>u.value<50),c=U(()=>t.trials.filter(f=>f.status==="running"||f.status==="paused").length),m=U(()=>t.trials.filter(f=>f.status==="completed"||f.status==="failed").length),g=U(()=>{let f=t.trials;if(t.searchQuery){const r=t.searchQuery.toLowerCase();f=f.filter(B=>{const x=B.name.toLowerCase().includes(r),_=B.templateConfig?.template?.toLowerCase().includes(r),L=B.configurations.some(A=>A.modelId.toLowerCase().includes(r)||A.provider.toLowerCase().includes(r));return x||_||L})}t.filterStatus!=="all"&&(f=f.filter(r=>r.status===t.filterStatus)),n.value==="active"?f=f.filter(r=>r.status==="running"||r.status==="paused"):n.value==="done"&&(f=f.filter(r=>r.status==="completed"||r.status==="failed"));const i=f.filter(r=>r.status==="running"),O=f.filter(r=>r.status!=="running"),S=[];return i.length>0&&(S.push({type:"section",title:"RUNNING",background:!0,id:"section-running"}),S.push(...i.sort((r,B)=>(B.started?.getTime()||0)-(r.started?.getTime()||0)))),O.length>0&&(i.length>0&&S.push({type:"section",title:"RECENT",background:!1,id:"section-recent"}),S.push(...O.sort((r,B)=>(B.created?.getTime()||0)-(r.created?.getTime()||0)))),S}),h=U(()=>g.value.map(f=>({...f,height:H(f)}))),$=U(()=>t.trials.filter(f=>n.value==="active"?f.status==="running"||f.status==="paused":n.value==="done"?f.status==="completed"||f.status==="failed":!0)),I=U(()=>t.searchQuery?"No trials found":t.filterStatus==="running"?"No trials are currently running":"No trials found"),T=U(()=>t.searchQuery?"No trials match your search":t.filterStatus!=="all"?`No ${t.filterStatus} trials`:"Create your first trial to get started"),C=U(()=>t.filterStatus==="all"&&!t.searchQuery);function N(f){return t.trials.filter(i=>i.status===f).length}function H(f){if(f.type==="section")return 32;const i=f.status==="running",O=f.configurations?.some(S=>S.repeatCount>1);return i||O?96:80}function V(f){const i=f.progress.completed+f.progress.failed;return f.status==="running"?`${Math.round(i/f.progress.total*100)}%`:i.toString()}async function E(){o.value=!0;try{await new Promise(f=>setTimeout(f,500)),a("refresh")}finally{o.value=!1}}function w({key:f}){a("update-filter",f)}function z(){const f=document.querySelector(".trial-list-panel");f&&(u.value=f.clientWidth)}return me(()=>{z(),window.addEventListener("resize",z);const f=document.querySelector(".trial-list-panel");f&&new ResizeObserver(()=>z()).observe(f)}),ye(()=>{window.removeEventListener("resize",z)}),(f,i)=>{const O=pe,S=mt,r=Ls,B=ft,x=pt;return d(),v("div",{class:te(["trial-list-panel",{collapsed:p.value}])},[s("div",un,[s("div",dn,[k(j(Vs),{class:"title-icon"}),p.value?R("",!0):(d(),v("span",cn,"Trials")),s("span",pn,b(f.trials.length),1)]),p.value?R("",!0):(d(),v("div",fn,[k(O,{type:"primary",size:"small",onClick:i[0]||(i[0]=_=>f.$emit("create-trial"))},{default:F(()=>[k(j(Os)),i[7]||(i[7]=D(" New Trial "))]),_:1,__:[7]}),k(O,{size:"small",onClick:i[1]||(i[1]=_=>f.$emit("import-trial"))},{default:F(()=>[k(j(Bt)),i[8]||(i[8]=D(" Import "))]),_:1,__:[8]}),k(O,{size:"small",onClick:E,loading:o.value},{default:F(()=>[k(j(Ds),{spin:o.value},null,8,["spin"])]),_:1},8,["loading"]),k(x,null,{overlay:F(()=>[k(B,{onClick:w},{default:F(()=>[k(S,{key:"all"},{default:F(()=>i[9]||(i[9]=[s("span",null,"All Trials",-1)])),_:1,__:[9]}),k(r),k(S,{key:"running"},{default:F(()=>[i[10]||(i[10]=s("span",null,"Running Only",-1)),s("span",mn,b(N("running")),1)]),_:1,__:[10]}),k(S,{key:"completed"},{default:F(()=>[i[11]||(i[11]=s("span",null,"Completed Only",-1)),s("span",vn,b(N("completed")),1)]),_:1,__:[11]}),k(S,{key:"failed"},{default:F(()=>[i[12]||(i[12]=s("span",null,"Failed Only",-1)),s("span",gn,b(N("failed")),1)]),_:1,__:[12]}),k(S,{key:"paused"},{default:F(()=>[i[13]||(i[13]=s("span",null,"Paused Only",-1)),s("span",hn,b(N("paused")),1)]),_:1,__:[13]}),k(S,{key:"draft"},{default:F(()=>[i[14]||(i[14]=s("span",null,"Draft Only",-1)),s("span",yn,b(N("draft")),1)]),_:1,__:[14]})]),_:1})]),default:F(()=>[k(O,{size:"small"},{default:F(()=>[k(j(Ns))]),_:1})]),_:1})]))]),p.value?R("",!0):(d(),Q(Xa,{key:0,"model-value":f.searchQuery,"onUpdate:modelValue":i[2]||(i[2]=_=>f.$emit("update-search",_))},null,8,["model-value"])),p.value?R("",!0):(d(),v("div",bn,[s("div",{class:te(["status-tab",{active:n.value==="all"}]),onClick:i[3]||(i[3]=_=>n.value="all")},[i[15]||(i[15]=s("span",{class:"tab-icon"},"📊",-1)),i[16]||(i[16]=s("span",{class:"tab-label"},"ALL",-1)),s("span",_n,b(f.trials.length),1)],2),s("div",{class:te(["status-tab",{active:n.value==="active"}]),onClick:i[4]||(i[4]=_=>n.value="active")},[i[17]||(i[17]=s("span",{class:"tab-icon"},"🟢",-1)),i[18]||(i[18]=s("span",{class:"tab-label"},"Active",-1)),s("span",Tn,b(c.value),1)],2),s("div",{class:te(["status-tab",{active:n.value==="done"}]),onClick:i[5]||(i[5]=_=>n.value="done")},[i[19]||(i[19]=s("span",{class:"tab-icon"},"✅",-1)),i[20]||(i[20]=s("span",{class:"tab-label"},"Done",-1)),s("span",$n,b(m.value),1)],2)])),s("div",Cn,[!p.value&&g.value.length>100?(d(),Q(j(Xe),{key:0,class:"trial-list virtual-list",items:h.value,"size-field":"height","key-field":"id",buffer:10},{default:F(({item:_})=>[_.type==="section"?(d(),Q(Et,{key:0,title:_.title,background:_.background},null,8,["title","background"])):(d(),Q(It,{key:1,trial:_,selected:_.id===f.selectedTrialId,"data-trial-id":_.id,onClick:L=>f.$emit("select-trial",_.id)},null,8,["trial","selected","data-trial-id","onClick"]))]),_:1},8,["items"])):p.value?(d(),v("div",wn,[(d(!0),v(Y,null,ee($.value,_=>(d(),v("div",{key:_.id,class:te(["collapsed-item",{selected:_.id===f.selectedTrialId}]),onClick:L=>f.$emit("select-trial",_.id)},[s("div",{class:te(["status-dot",`status-${_.status}`])},null,2),s("span",In,b(V(_)),1)],10,Sn))),128))])):(d(),v("div",kn,[(d(!0),v(Y,null,ee(g.value,(_,L)=>(d(),v(Y,{key:_.id||`section-${L}`},[_.type==="section"?(d(),Q(Et,{key:0,title:_.title,background:_.background},null,8,["title","background"])):(d(),Q(It,{key:1,trial:_,selected:_.id===f.selectedTrialId,"data-trial-id":_.id,onClick:A=>f.$emit("select-trial",_.id)},null,8,["trial","selected","data-trial-id","onClick"]))],64))),128))])),g.value.length===0&&!p.value?(d(),v("div",En,[k(j(jt),{class:"empty-icon"}),s("h3",null,b(I.value),1),s("p",null,b(T.value),1),C.value?(d(),Q(O,{key:0,type:"primary",size:"large",onClick:i[6]||(i[6]=_=>f.$emit("create-trial"))},{default:F(()=>i[21]||(i[21]=[D(" Create New Trial ")])),_:1,__:[21]})):R("",!0)])):R("",!0)])],2)}}}),Fn=re(Rn,[["__scopeId","data-v-ad2a17cf"]]),Pn={class:"trial-header"},xn={class:"header-main"},An={class:"header-title"},Vn={class:"trial-name"},On={key:0,class:"progress-container"},Dn={class:"progress-bar"},Nn={class:"progress-stats-inline"},Ln={class:"progress-text"},Mn={key:0,class:"progress-stat"},Un={class:"stat-number"},zn={key:1,class:"progress-stat"},Bn={class:"stat-number"},jn={key:2,class:"progress-stat"},Wn={class:"stat-number"},Hn=oe({__name:"TrialHeaderV3",props:{trial:{},progress:{},isExecuting:{type:Boolean}},setup(l){const e=l,t=U(()=>{let T=e.trial.name;return T=T.replace(/\s*-\s*\d{1,2}\/\d{1,2}\/\d{4}$/,""),T=T.replace(/\s*\(Copy\)(\s*\(Copy\))*/g,""),T.trim()}),a=U(()=>!0),o=U(()=>e.progress?e.progress.completed+e.progress.failed:0),n=U(()=>{if(!e.progress||e.progress.total===0)return 0;const T=e.progress.completed+e.progress.failed;return Math.round(T/e.progress.total*100)}),u=U(()=>{const T=e.trial.started||e.trial.created;if(!T)return"0m";let C;if(e.trial.status==="draft")return"0m";e.trial.completed?C=e.trial.completed:C=new Date;const N=C.getTime()-T.getTime(),H=Math.floor(N/(1e3*60*60)),V=Math.floor(N%(1e3*60*60)/(1e3*60));return H>0?`${H}h ${V}m`:`${V}m`}),p=U(()=>{if(!e.progress?.avgLatencyMs)return null;const T=e.progress.avgLatencyMs;return T<1e3?`${Math.round(T)}ms`:`${(T/1e3).toFixed(1)}s`}),{calculateTemplateTokens:c,calculatePromptTokens:m,estimateTotalCost:g,sumEstimates:h,formatCost:$}=qe();U(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let T=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)T=c(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const H=m(e.trial.spreadsheetConfig.promptPattern),E=(e.progress?.total||e.trial.progress.total)/e.trial.configurations.length;T={totalTokens:H*E,combinationCount:E,perCallAverage:H}}else if(e.trial.type==="playground")return null;if(!T||T.totalTokens===0)return null;const C=e.trial.configurations.map(H=>{const V=H.modelSnapshot;return V?g(T.totalTokens,T.combinationCount,V,H.parameters):null}).filter(Boolean);if(C.length===0)return null;const N=h(C);return`${$(N,"compact")} total`});const I=U(()=>{if(e.trial.status!=="running"||!e.progress||e.progress.completed===0)return null;const C=(Date.now()-(e.trial.started?.getTime()||0))/e.progress.completed,N=e.progress.pending*C,H=Math.floor(N/(1e3*60)),V=Math.floor(N%(1e3*60)/1e3);if(H>60){const E=Math.floor(H/60),w=H%60;return`${E}h ${w}m`}return`${H}m ${V}s`});return(T,C)=>(d(),v("div",Pn,[s("div",xn,[s("div",An,[s("h2",Vn,b(t.value),1),s("span",{class:te(["status-tag",`status-${T.trial.status}`])},b(T.trial.status.toUpperCase()),3)]),a.value?(d(),v("div",On,[s("div",Dn,[s("div",{class:"progress-fill",style:he({width:`${n.value}%`})},null,4)]),s("div",Nn,[s("span",Ln,b(o.value)+"/"+b(T.progress?.total||0)+" ("+b(n.value)+"%) ",1),u.value?(d(),v("span",Mn,[C[0]||(C[0]=s("span",{class:"stat-label"},"Duration:",-1)),C[1]||(C[1]=D()),s("span",Un,b(u.value),1)])):R("",!0),p.value?(d(),v("span",zn,[C[2]||(C[2]=s("span",{class:"stat-label"},"Avg:",-1)),C[3]||(C[3]=D()),s("span",Bn,b(p.value),1)])):R("",!0),I.value?(d(),v("span",jn,[C[4]||(C[4]=s("span",{class:"stat-label"},"Remaining:",-1)),C[5]||(C[5]=D()),s("span",Wn,"~"+b(I.value),1)])):R("",!0)])])):R("",!0)]),R("",!0)]))}}),qn=re(Hn,[["__scopeId","data-v-248be564"]]),Gn={class:"trial-actions"},Jn={class:"action-group execution-controls"},Xn={class:"action-group data-actions"},Kn={class:"action-group management-actions"},Qn=oe({__name:"TrialActionsV3",props:{trial:{},isLeader:{type:Boolean},executionState:{}},emits:["start","pause","resume","cancel","duplicate","edit","delete","export-data","export-python","refresh"],setup(l,{emit:e}){const t=l,a=e,o=q(!1),n=q(!1),u=q(!1);U(()=>t.executionState?.currentTrialId===t.trial.id);const p=U(()=>["draft","failed","cancelled"].includes(t.trial.status)),c=U(()=>t.trial.status==="running"),m=U(()=>t.trial.status==="paused"),g=U(()=>["running","paused"].includes(t.trial.status));function h(){a("start")}async function $(){o.value=!0,n.value=!1,a("pause"),setTimeout(()=>{o.value=!1},1e3)}async function I(){n.value=!0,o.value=!1,a("resume"),setTimeout(()=>{n.value=!1},3e3)}function T(){Te.confirm({title:"Cancel trial?",content:"This will stop all pending API calls.",okText:"Cancel Trial",okType:"danger",onOk:()=>a("cancel")})}async function C(){u.value=!0,a("refresh"),setTimeout(()=>{u.value=!1},500)}function N({key:w}){w==="data"?a("export-data"):w==="python"&&a("export-python")}function H(){a("duplicate")}function V(){a("edit")}function E(){const w=t.trial.progress.total;Te.confirm({title:"Delete trial?",content:`Delete trial and all ${w} API calls?`,okText:"Delete",okType:"danger",cancelText:"Cancel",onOk:()=>{a("delete")}})}return(w,z)=>{const f=pe,i=mt,O=ft,S=pt;return d(),v("div",Gn,[s("div",Jn,[p.value?(d(),Q(f,{key:0,type:"primary",size:"large",disabled:!w.isLeader,onClick:h},{default:F(()=>[k(j(Ct)),z[0]||(z[0]=D(" Start Trial "))]),_:1,__:[0]},8,["disabled"])):R("",!0),c.value?(d(),Q(f,{key:1,size:"large",disabled:!w.isLeader,loading:o.value,onClick:$},{default:F(()=>[o.value?R("",!0):(d(),Q(j(Ms),{key:0})),D(" "+b(o.value?"Pausing...":"Pause"),1)]),_:1},8,["disabled","loading"])):R("",!0),m.value?(d(),Q(f,{key:2,type:"primary",size:"large",disabled:!w.isLeader||n.value,loading:n.value,onClick:I},{default:F(()=>[n.value?R("",!0):(d(),Q(j(Ct),{key:0})),D(" "+b(n.value?"Resuming...":"Resume"),1)]),_:1},8,["disabled","loading"])):R("",!0),g.value?(d(),Q(f,{key:3,danger:"",size:"large",disabled:!w.isLeader,onClick:T},{default:F(()=>[k(j(Us)),z[1]||(z[1]=D(" Cancel "))]),_:1,__:[1]},8,["disabled"])):R("",!0)]),s("div",Xn,[k(f,{size:"large",loading:u.value,onClick:C,title:"Refresh trial data from database"},{default:F(()=>[u.value?(d(),Q(j(Wt),{key:1,spin:""})):(d(),Q(j(zs),{key:0})),D(" "+b(u.value?"Refreshing...":"Refresh"),1)]),_:1},8,["loading"]),k(S,null,{overlay:F(()=>[k(O,{onClick:N},{default:F(()=>[k(i,{key:"data"},{default:F(()=>[k(j(js)),z[3]||(z[3]=D(" Export Data "))]),_:1,__:[3]}),k(i,{key:"python"},{default:F(()=>[k(j(Ws)),z[4]||(z[4]=D(" Export Python Script "))]),_:1,__:[4]})]),_:1})]),default:F(()=>[k(f,{size:"large"},{default:F(()=>[z[2]||(z[2]=D(" Export ")),k(j(Bs))]),_:1,__:[2]})]),_:1})]),s("div",Kn,[k(f,{size:"large",disabled:!w.isLeader,onClick:H},{default:F(()=>[k(j(vt)),z[5]||(z[5]=D(" Duplicate "))]),_:1,__:[5]},8,["disabled"]),w.trial.status==="draft"?(d(),Q(f,{key:0,size:"large",disabled:!w.isLeader,onClick:V},{default:F(()=>[k(j(Hs)),z[6]||(z[6]=D(" Edit "))]),_:1,__:[6]},8,["disabled"])):R("",!0),k(f,{danger:"",size:"large",disabled:!w.isLeader,onClick:E},{default:F(()=>[k(j(qs)),z[7]||(z[7]=D(" Delete "))]),_:1,__:[7]},8,["disabled"])])])}}}),Yn=re(Qn,[["__scopeId","data-v-e642c431"]]),Zn={class:"snapshot-debug"},eo={class:"debug-header"},to={class:"status-row"},so={key:0,class:"badge success"},ao={key:1,class:"badge warning"},no={key:0,class:"status-row"},oo={key:0,class:"variables-section"},ro={class:"variable-header"},lo={class:"var-name"},io={class:"var-type"},uo={key:0,class:"snapshot-content"},co={class:"snapshot-meta"},po={key:0},fo={class:"snapshot-items"},mo={class:"items-preview"},vo={class:"item-index"},go={class:"item-value"},ho={key:0,class:"item-attrs"},yo={key:0,class:"more-indicator"},bo={key:1,class:"no-snapshot"},_o={key:0},To={key:1,class:"legacy-warning"},$o={class:"debug-footer"},Co=oe({__name:"SnapshotDebugModal",props:{visible:{type:Boolean},trial:{},migrating:{type:Boolean}},emits:["close","migrate"],setup(l){const e=l,t=U(()=>e.trial.templateConfig?.hasSnapshots===!0),a=U(()=>e.trial.templateConfig?.variables||{});function o(m){return"snapshot"in m&&m.snapshot!=null}function n(m){return m.snapshot}function u(m){return o(m)?`${n(m).source.type} (snapshot)`:m.type==="value"?"Direct values":m.type==="list"?"List reference":"Unknown"}function p(){for(const m of Object.values(a.value))if(o(m)){const g=n(m);if(g.source?.snapshotDate)return new Date(g.source.snapshotDate).toLocaleString()}return"Unknown"}function c(){const m={trialId:e.trial.id,trialName:e.trial.name,hasSnapshots:t.value,variables:a.value};navigator.clipboard.writeText(JSON.stringify(m,null,2)),Z.success("Debug info copied to clipboard")}return(m,g)=>{const h=We,$=He,I=pe,T=Te;return d(),Q(T,{visible:m.visible,title:"Variable Snapshot Debug View",width:"80%",footer:null,onCancel:g[2]||(g[2]=C=>m.$emit("close"))},{default:F(()=>[s("div",Zn,[s("div",eo,[s("div",to,[g[5]||(g[5]=s("span",{class:"label"},"Snapshot Status:",-1)),t.value?(d(),v("span",so,[k(j(Ht)),g[3]||(g[3]=D(" Snapshots Enabled "))])):(d(),v("span",ao,[k(j(Fe)),g[4]||(g[4]=D(" Legacy Mode (No Snapshots) "))]))]),t.value?(d(),v("div",no,[g[6]||(g[6]=s("span",{class:"label"},"Snapshot Date:",-1)),s("span",null,b(p()),1)])):R("",!0)]),t.value?(d(),v("div",oo,[g[8]||(g[8]=s("h3",null,"Variable Snapshots",-1)),(d(!0),v(Y,null,ee(a.value,(C,N)=>(d(),v("div",{key:N,class:"variable-card"},[s("div",ro,[s("span",lo,b(N),1),s("span",io,b(u(C)),1)]),o(C)?(d(),v("div",uo,[s("div",co,[s("span",null,"Source: "+b(n(C).source.type),1),n(C).source.listName?(d(),v("span",po," List: "+b(n(C).source.listName),1)):R("",!0),s("span",null,"Items: "+b(n(C).items.length),1)]),s("div",fo,[s("div",mo,[(d(!0),v(Y,null,ee(n(C).items.slice(0,5),(H,V)=>(d(),v("div",{key:V,class:"item-row"},[s("span",vo,b(V+1)+".",1),s("span",go,b(H.value),1),H.attributes&&Object.keys(H.attributes).length>0?(d(),v("span",ho,[(d(!0),v(Y,null,ee(H.attributes,(E,w)=>(d(),Q(h,{key:w,size:"small"},{default:F(()=>[D(b(w)+": "+b(E),1)]),_:2},1024))),128))])):R("",!0)]))),128)),n(C).items.length>5?(d(),v("div",yo," ... and "+b(n(C).items.length-5)+" more items ",1)):R("",!0)])])])):(d(),v("div",bo,[k(j(Fe)),g[7]||(g[7]=D(" No snapshot - using live reference ")),C.listId?(d(),v("span",_o,"List ID: "+b(C.listId),1)):R("",!0)]))]))),128))])):(d(),v("div",To,[k($,{message:"Legacy Trial",description:"This trial was created before snapshots were implemented. Variable lists are loaded dynamically from the database, which means changes to lists will affect trial duplication.",type:"warning","show-icon":""}),k(I,{type:"primary",onClick:g[0]||(g[0]=C=>m.$emit("migrate")),loading:m.migrating,style:{"margin-top":"16px"}},{default:F(()=>[k(j(Gs)),g[9]||(g[9]=D(" Migrate to Snapshots "))]),_:1,__:[9]},8,["loading"])])),s("div",$o,[k(I,{onClick:c},{default:F(()=>[k(j(vt)),g[10]||(g[10]=D(" Copy Debug Info "))]),_:1,__:[10]}),k(I,{onClick:g[1]||(g[1]=C=>m.$emit("close"))},{default:F(()=>g[11]||(g[11]=[D("Close")])),_:1,__:[11]})])])]),_:1},8,["visible"])}}}),ko=re(Co,[["__scopeId","data-v-726379cc"]]),wo={class:"trial-detail-view"},So={key:0,class:"detail-content"},Io={class:"detail-section"},Eo={class:"detail-grid"},Ro={class:"detail-item"},Fo={key:0,class:"detail-item"},Po={key:1,class:"detail-item"},xo={class:"detail-item"},Ao={class:"detail-item"},Vo={class:"detail-section"},Oo={class:"detail-grid"},Do={key:0,class:"detail-item full-width"},No={key:1,class:"detail-item full-width"},Lo={class:"detail-item"},Mo={class:"detail-item"},Uo={style:{display:"flex","align-items":"center",gap:"8px"}},zo={key:0,class:"snapshot-badge success"},Bo={key:1,class:"snapshot-badge warning"},jo={class:"detail-item"},Wo={key:2,class:"detail-item"},Ho={key:0,class:"detail-section"},qo={class:"detail-grid"},Go={class:"detail-item"},Jo={class:"detail-item"},Xo={class:"detail-item"},Ko={class:"detail-section"},Qo={class:"model-configs"},Yo={class:"config-header"},Zo=["src","alt"],er={class:"provider-name"},tr={class:"config-details"},sr={class:"config-item"},ar={class:"config-params"},nr={class:"param-list"},or={key:0,class:"config-item"},rr={class:"cost"},lr={key:1,class:"config-item"},ir={class:"cost"},ur={class:"config-item"},dr={class:"snapshot-debug"},cr=oe({__name:"TrialDetailView",props:{trial:{},isCollapsed:{type:Boolean}},emits:["toggle-collapse"],setup(l){const e=l,t=q(!1),{calculateTemplateTokens:a,estimateTotalCost:o,formatCost:n}=qe(),u=U(()=>{const f=e.trial.started||e.trial.created,O=(e.trial.completed||new Date).getTime()-f.getTime(),S=Math.floor(O/(1e3*60*60)),r=Math.floor(O%(1e3*60*60)/(1e3*60));return S>0?`${S}h ${r}m`:`${r}m`}),p=U(()=>({draft:"Not started",pending:"Waiting to start",running:"Executing API calls",paused:"Execution paused",completed:"All calls completed",failed:"Execution failed",cancelled:"Execution cancelled"})[e.trial.status]||e.trial.status),c=U(()=>e.trial.type==="template"&&e.trial.templateConfig?.variables?Object.keys(e.trial.templateConfig.variables).length:0),m=U(()=>Math.round(e.trial.progress.total*750)),g=U(()=>e.trial.type==="template"&&e.trial.templateConfig?e.trial.templateConfig.hasSnapshots===!0:!1),h=U(()=>"text"),$=U(()=>1),I=U(()=>e.trial.progress.total/$.value);function T(f){return f?new Date(f).toLocaleString():"N/A"}function C(){if(e.trial.templateConfig?.templateName)return e.trial.templateConfig.templateName;const f=e.trial.templateConfig?.template||"Unknown Template";return f.length>50?f.substring(0,50)+"...":f}function N(){return e.trial.spreadsheetConfig?.datasetId||"Unknown Dataset"}function H(f){return{"openai-chat":"OpenAI","anthropic-messages":"Anthropic",openrouter:"OpenRouter","ollama-chat":"Ollama","ollama-generate":"Ollama"}[f]||f}function V(f){}async function E(){try{Z.info("Migration feature coming soon"),t.value=!1}catch(f){Z.error("Failed to migrate trial"),P.error("Migration error:",f)}}function w(f){const i=f.modelSnapshot;return i?.capabilities?.inputCostPerToken?`$${((i.capabilities.inputCostPerToken+i.capabilities.outputCostPerToken)*1e3).toFixed(8)}/1k tokens`:null}function z(f){if(!e.trial.configurations||!f.modelSnapshot)return null;let i=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)i=a(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else return null;if(!i||i.totalTokens===0)return null;const O=o(i.totalTokens,i.combinationCount,f.modelSnapshot,f.parameters);if(!O.meta.hasValidCost||O.cost.total.expected===-1)return null;const S=(e.trial.repeatCount||1)*O.cost.total.expected;return n({...O,cost:{...O.cost,total:{...O.cost.total,expected:S}}},"compact")}return(f,i)=>{const O=pe;return d(),v("div",wo,[s("div",{class:"detail-header",onClick:i[0]||(i[0]=S=>f.$emit("toggle-collapse"))},[i[3]||(i[3]=s("h3",null,"Trial Details",-1)),k(j(Js),{class:te(["collapse-icon",{rotated:f.isCollapsed}])},null,8,["class"])]),f.isCollapsed?R("",!0):(d(),v("div",So,[s("div",Io,[i[9]||(i[9]=s("h4",null,"Basic Information",-1)),s("div",Eo,[s("div",Ro,[i[4]||(i[4]=s("label",null,"Created:",-1)),s("span",null,b(T(f.trial.created)),1)]),f.trial.started?(d(),v("div",Fo,[i[5]||(i[5]=s("label",null,"Started:",-1)),s("span",null,b(T(f.trial.started)),1)])):R("",!0),f.trial.completed?(d(),v("div",Po,[i[6]||(i[6]=s("label",null,"Completed:",-1)),s("span",null,b(T(f.trial.completed)),1)])):R("",!0),s("div",xo,[i[7]||(i[7]=s("label",null,"Duration:",-1)),s("span",null,b(u.value),1)]),s("div",Ao,[i[8]||(i[8]=s("label",null,"Status:",-1)),s("span",null,b(f.trial.status)+" - "+b(p.value),1)])])]),s("div",Vo,[i[19]||(i[19]=s("h4",null,"Configuration",-1)),s("div",Oo,[f.trial.type==="template"?(d(),v("div",Do,[i[10]||(i[10]=s("label",null,"Template:",-1)),s("span",null,b(C()),1)])):R("",!0),f.trial.type==="spreadsheet"?(d(),v("div",No,[i[11]||(i[11]=s("label",null,"Dataset:",-1)),s("span",null,b(N()),1)])):R("",!0),s("div",Lo,[i[12]||(i[12]=s("label",null,"Variable Lists:",-1)),s("span",null,b(c.value)+" lists",1)]),s("div",Mo,[i[16]||(i[16]=s("label",null,"Data Snapshot:",-1)),s("div",Uo,[g.value?(d(),v("span",zo,[k(j(Ht)),i[13]||(i[13]=D(" Captured "))])):(d(),v("span",Bo,[k(j(Fe)),i[14]||(i[14]=D(" Live Reference "))])),f.trial.type==="template"?(d(),Q(O,{key:2,size:"small",type:"link",onClick:i[1]||(i[1]=S=>t.value=!0)},{default:F(()=>[k(j(qt)),i[15]||(i[15]=D(" Debug "))]),_:1,__:[15]})):R("",!0)])]),s("div",jo,[i[17]||(i[17]=s("label",null,"Token Estimate:",-1)),s("span",null,"~"+b(m.value)+" tokens",1)]),h.value?(d(),v("div",Wo,[i[18]||(i[18]=s("label",null,"Output Type:",-1)),s("span",{class:te(["output-type",`type-${h.value}`])},b(h.value),3)])):R("",!0)])]),$.value>1?(d(),v("div",Ho,[i[23]||(i[23]=s("h4",null,"Repeat Configuration",-1)),s("div",qo,[s("div",Go,[i[20]||(i[20]=s("label",null,"Times per prompt:",-1)),s("span",null,b($.value),1)]),s("div",Jo,[i[21]||(i[21]=s("label",null,"Total combinations:",-1)),s("span",null,b(I.value),1)]),s("div",Xo,[i[22]||(i[22]=s("label",null,"Total API calls:",-1)),s("span",null,b(f.trial.progress.total),1)])])])):R("",!0),s("div",Ko,[i[29]||(i[29]=s("h4",null,"Model Configurations",-1)),s("div",Qo,[(d(!0),v(Y,null,ee(f.trial.configurations,(S,r)=>(d(),v("div",{key:r,class:"model-config-card"},[s("div",Yo,[(S.provider,void 0)?(d(),v("img",{key:0,src:(S.provider,void 0),alt:S.provider,class:"provider-logo"},null,8,Zo)):R("",!0),s("span",er,b(H(S.provider)),1)]),s("div",tr,[s("div",sr,[i[24]||(i[24]=s("label",null,"Model:",-1)),s("span",null,b(S.modelId),1)]),s("div",ar,[i[25]||(i[25]=s("label",null,"Parameters:",-1)),s("div",nr,[(d(!0),v(Y,null,ee(S.parameters,(B,x)=>(d(),v("span",{key:x,class:"param-tag"},b(x)+": "+b(B),1))),128))])]),w(S)?(d(),v("div",or,[i[26]||(i[26]=s("label",null,"Cost Rate:",-1)),s("span",rr,b(w(S)),1)])):R("",!0),z(S)?(d(),v("div",lr,[i[27]||(i[27]=s("label",null,"Total Trial Cost:",-1)),s("span",ir,b(z(S)),1)])):R("",!0),s("div",ur,[i[28]||(i[28]=s("label",null,"Model Snapshot:",-1)),s("pre",dr,b(JSON.stringify(S.modelSnapshot,null,2)),1)])])]))),128))])])])),t.value?(d(),Q(ko,{key:1,visible:t.value,trial:f.trial,onClose:i[2]||(i[2]=S=>t.value=!1),onMigrate:E},null,8,["visible","trial"])):R("",!0)])}}}),pr=re(cr,[["__scopeId","data-v-e677baaf"]]),fr={class:"filter-bar"},mr={class:"search-container"},vr=oe({__name:"TrialResultsFilterBar",props:{statusFilter:{},configFilter:{},searchQuery:{},visibleColumns:{},configurations:{},apiCalls:{},showRepeatColumn:{type:Boolean}},emits:["update:statusFilter","update:configFilter","update:searchQuery","update:visibleColumns","openPostProcessing"],setup(l,{emit:e}){const t=l,a=e,o=U(()=>{const m=[{key:"status",label:"Status"},{key:"configuration",label:"Configuration"},{key:"variables",label:"Variables"},{key:"response",label:"Response"},{key:"parsedResponse",label:"Parsed Response"},{key:"postProcessedResponse",label:"Post-Processed"},{key:"length",label:"Length"},{key:"latency",label:"Latency"}];return t.showRepeatColumn&&m.splice(2,0,{key:"repeat",label:"Repeat Index"}),m}),n=U(()=>{const m={total:t.apiCalls.length,completed:0,failed:0,running:0,pending:0};return t.apiCalls.forEach(g=>{g.status==="completed"?m.completed++:g.status==="failed"?m.failed++:g.status==="running"?m.running++:g.status==="pending"&&m.pending++}),m});function u(m){return m.modelSnapshot?.displayName||`${m.provider} - ${m.modelId}`}const p=Qt(m=>{const g=m.target.value;a("update:searchQuery",g)},300);function c(m){const g=[...t.visibleColumns],h=g.indexOf(m);if(h>-1)g.splice(h,1);else{const $=o.value.map(C=>C.key),I=$.indexOf(m);let T=0;for(let C=0;C<I;C++)g.includes($[C])&&T++;g.splice(T,0,m)}a("update:visibleColumns",g)}return(m,g)=>{const h=Ks,$=Xs,I=Gt,T=pe,C=Jt,N=mt,H=ft,V=pt;return d(),v("div",fr,[k($,{value:m.statusFilter,onChange:g[0]||(g[0]=E=>m.$emit("update:statusFilter",E)),placeholder:"Filter by status",style:{width:"150px"}},{default:F(()=>[k(h,{value:"all"},{default:F(()=>[D(" All ("+b(n.value.total)+") ",1)]),_:1}),k(h,{value:"completed"},{default:F(()=>[D(" Completed ("+b(n.value.completed)+") ",1)]),_:1}),k(h,{value:"failed"},{default:F(()=>[D(" Failed ("+b(n.value.failed)+") ",1)]),_:1}),k(h,{value:"running"},{default:F(()=>[D(" Running ("+b(n.value.running)+") ",1)]),_:1}),k(h,{value:"pending"},{default:F(()=>[D(" Pending ("+b(n.value.pending)+") ",1)]),_:1})]),_:1},8,["value"]),k($,{value:m.configFilter,onChange:g[1]||(g[1]=E=>m.$emit("update:configFilter",E)),mode:"multiple",placeholder:"Filter by configuration",style:{width:"250px"},"max-tag-count":2},{default:F(()=>[k(h,{value:""},{default:F(()=>g[3]||(g[3]=[D("All Configurations")])),_:1,__:[3]}),(d(!0),v(Y,null,ee(m.configurations,(E,w)=>(d(),Q(h,{key:w,value:w.toString()},{default:F(()=>[D(b(u(E)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s("div",mr,[k(I,{value:m.searchQuery,onInput:j(p),placeholder:"Search in variables and responses...",style:{width:"400px"},"allow-clear":""},{prefix:F(()=>[k(j(Ut))]),_:1},8,["value","onInput"])]),k(V,null,{overlay:F(()=>[k(H,null,{default:F(()=>[(d(!0),v(Y,null,ee(o.value,E=>(d(),Q(N,{key:E.key},{default:F(()=>[k(C,{checked:m.visibleColumns.includes(E.key),disabled:E.key==="status",onChange:w=>c(E.key)},{default:F(()=>[D(b(E.label),1)]),_:2},1032,["checked","disabled","onChange"])]),_:2},1024))),128))]),_:1})]),default:F(()=>[k(T,null,{default:F(()=>[k(j(Qs)),g[4]||(g[4]=D(" Columns "))]),_:1,__:[4]})]),_:1}),k(T,{type:"primary",onClick:g[2]||(g[2]=E=>m.$emit("openPostProcessing"))},{default:F(()=>[k(j(Xt)),g[5]||(g[5]=D(" Post-Process "))]),_:1,__:[5]})])}}}),gr=re(vr,[["__scopeId","data-v-e6112af3"]]),hr={class:"modal-content"},yr={class:"section"},br={class:"info-grid"},_r={class:"info-item"},Tr={class:"monospace"},$r={class:"info-item"},Cr={class:"info-item"},kr={key:0,class:"info-item"},wr={class:"info-item"},Sr={key:1,class:"info-item"},Ir={key:2,class:"info-item"},Er={key:3,class:"info-item"},Rr={key:0,class:"info-row"},Fr={class:"monospace"},Pr={key:0,class:"section"},xr={class:"variables-list"},Ar={class:"variable-main"},Vr={class:"variable-label"},Or={class:"variable-value"},Dr={key:0,class:"variable-attributes"},Nr={class:"attribute-label"},Lr={class:"attribute-value"},Mr={class:"section"},Ur={class:"content-box prompt-display"},zr={key:1,class:"section"},Br={key:0,class:"error-result"},jr={key:1,class:"success-result"},Wr={class:"content-box response-content"},Hr={key:0,class:"parsed-content-section"},qr={class:"content-box parsed-content"},Gr={key:1,class:"post-processed-section"},Jr={class:"content-box post-processed-content"},Xr={key:2,class:"refusal-warning"},Kr={key:3,class:"refusal-warning"},Qr={class:"extraction-config-section"},Yr={class:"config-grid"},Zr={key:0,class:"config-item"},el={class:"config-value"},tl={key:1,class:"config-item"},sl={class:"config-value"},al={key:2,class:"config-item"},nl={class:"config-value pattern"},ol={key:3,class:"config-item"},rl={class:"config-value"},ll={key:4,class:"config-item"},il={class:"config-value"},ul={key:5,class:"config-item no-extraction"},dl={key:4,class:"post-processing-config-section"},cl={class:"config-grid"},pl={class:"config-item post-processing-item"},fl={class:"config-value"},ml={key:0,class:"config-item post-processing-item"},vl={class:"config-value"},gl={key:1,class:"config-item post-processing-item"},hl={class:"config-value pattern"},yl={key:2,class:"config-item post-processing-item"},bl={class:"config-value"},_l={key:3,class:"config-item post-processing-item"},Tl={class:"config-value"},$l={key:4,class:"config-item post-processing-item"},Cl={class:"config-value"},kl={key:5,class:"usage-info"},wl={class:"info-grid"},Sl={class:"info-item"},Il={class:"info-item"},El={class:"info-item"},Rl={key:0,class:"info-item"},Fl={class:"raw-data-section"},Pl={class:"raw-data"},xl={key:0},Al={key:1,class:"raw-data"},Vl={key:2},Ol={key:3,class:"raw-data"},Dl={class:"modal-footer"},Nl=oe({__name:"APICallDetailModalV3",props:{visible:{type:Boolean},apiCall:{},trial:{}},emits:["update:visible"],setup(l,{emit:e}){const t=l,a=e,o=Rs(),n=U(()=>{if(t.apiCall.duration!==void 0)return t.apiCall.duration;if(!t.apiCall.completed||!t.apiCall.created)return null;const f=new Date(t.apiCall.created).getTime();return new Date(t.apiCall.completed).getTime()-f}),u=U(()=>{if(t.apiCall.modelName){const i=t.trial.configurations[t.apiCall.configurationIndex];return i?`${i.provider} / ${t.apiCall.modelName}`:t.apiCall.modelName}const f=t.trial.configurations[t.apiCall.configurationIndex];return f?`${f.provider} / ${f.modelId}`:null}),p=U(()=>{if(t.apiCall.cost!==void 0)return t.apiCall.cost;if(!t.apiCall.result?.usage)return null;const f=t.trial.configurations[t.apiCall.configurationIndex];if(!f)return null;const i=o.models.value.find(r=>r.provider===f.provider&&r.modelId===f.modelId);if(!i?.capabilities?.inputCostPerToken&&!i?.capabilities?.outputCostPerToken)return null;const O=(t.apiCall.result.usage.prompt_tokens||0)*(i.capabilities.inputCostPerToken||0),S=(t.apiCall.result.usage.completion_tokens||0)*(i.capabilities.outputCostPerToken||0);return O+S}),c=U(()=>{if(!t.apiCall.request)return"No request data";const f=JSON.parse(JSON.stringify(t.apiCall.request));return f.headers&&Object.keys(f.headers).forEach(i=>{(i.toLowerCase().includes("authorization")||i.toLowerCase().includes("api-key")||i.toLowerCase().includes("x-api-key"))&&(f.headers[i]="[REDACTED]")}),f.body&&typeof f.body=="object"&&(f.body.api_key&&(f.body.api_key="[REDACTED]"),f.body.apiKey&&(f.body.apiKey="[REDACTED]")),JSON.stringify(f,null,2)}),m=U(()=>t.apiCall.parserId?{parserId:t.apiCall.parserId,outputType:t.trial.type==="template"?t.trial.templateConfig?.outputType:void 0,extractPattern:t.trial.type==="template"?t.trial.templateConfig?.extractPattern:void 0,refusalWords:t.trial.type==="template"?t.trial.templateConfig?.refusalWords:void 0,rejectRefusalWords:t.trial.type==="template"?t.trial.templateConfig?.rejectRefusalWords:void 0}:t.trial.type!=="template"||!t.trial.templateConfig?{}:{parserId:t.trial.templateConfig.parserId,outputType:t.trial.templateConfig.outputType,extractPattern:t.trial.templateConfig.extractPattern,refusalWords:t.trial.templateConfig.refusalWords,rejectRefusalWords:t.trial.templateConfig.rejectRefusalWords}),g=U(()=>{const f=m.value;return!!(f.parserId||f.outputType||f.extractPattern||f.refusalWords&&f.refusalWords.length>0)}),h=U(()=>t.trial.postProcessingConfig||null),$=U(()=>t.apiCall.response?JSON.stringify({status:t.apiCall.response.status,headers:t.apiCall.response.headers,body:t.apiCall.response.body,latencyMs:t.apiCall.response.latencyMs},null,2):"No response data available"),I=U(()=>t.apiCall.result?JSON.stringify(t.apiCall.result,null,2):"No processed result available");function T(f){return{completed:"success",failed:"error",running:"processing",pending:"warning"}[f]||"default"}function C(){const f=t.trial.configurations[t.apiCall.configurationIndex];return f?.modelSnapshot?.displayName||f?.modelId||`Configuration ${t.apiCall.configurationIndex+1}`}function N(f){return(typeof f=="string"?new Date(f):f).toLocaleString()}function H(f){return f<1e3?`${f}ms`:f<6e4?`${(f/1e3).toFixed(1)}s`:`${Math.floor(f/6e4)}m ${(f%6e4/1e3).toFixed(0)}s`}function V(f){return f==null?"null":typeof f=="string"?f:typeof f=="number"||typeof f=="boolean"?String(f):JSON.stringify(f,null,2)}function E(f){return{network_error_no_response:"Network Error (No Response)",api_error_received:"API Error Response",parsing_error:"Response Parsing Error",timeout:"Request Timeout",rate_limit:"Rate Limit Exceeded"}[f]||f}function w(){a("update:visible",!1)}async function z(){const f={id:t.apiCall.id,status:t.apiCall.status,configuration:C(),provider:u.value,variables:t.apiCall.variables,variableAttributes:t.apiCall.variableAttributes,prompt:t.apiCall.prompt,fullApiResponse:t.apiCall.response,processedResult:t.apiCall.result,extractionConfig:m.value,postProcessingConfig:h.value,created:t.apiCall.created,completed:t.apiCall.completed,duration:n.value?`${n.value}ms`:null,cost:p.value?`$${p.value.toFixed(4)}`:null},i=JSON.stringify(f,null,2);try{await navigator.clipboard.writeText(i),Z.success("Details copied to clipboard!")}catch(O){P.error("Failed to copy to clipboard",O),Z.error("Failed to copy to clipboard")}}return(f,i)=>{const O=We,S=He,r=Zs,B=Ys,x=pe,_=Te;return d(),Q(_,{open:f.visible,onCancel:i[0]||(i[0]=L=>a("update:visible",!1)),title:"API Call Details",width:1400,footer:null,"body-style":{padding:0,height:"85vh",display:"flex",flexDirection:"column"},centered:!0,"destroy-on-close":!0,class:"api-call-detail-modal"},{default:F(()=>[s("div",hr,[s("div",yr,[i[10]||(i[10]=s("h3",null,"Overview",-1)),s("div",br,[s("div",_r,[i[1]||(i[1]=s("label",null,"Call ID:",-1)),s("span",Tr,b(f.apiCall.id),1)]),s("div",$r,[i[2]||(i[2]=s("label",null,"Status:",-1)),k(O,{color:T(f.apiCall.status)},{default:F(()=>[D(b(f.apiCall.status.toUpperCase()),1)]),_:1},8,["color"])]),s("div",Cr,[i[3]||(i[3]=s("label",null,"Configuration:",-1)),s("span",null,b(C()),1)]),f.apiCall.repeatIndex!==void 0?(d(),v("div",kr,[i[4]||(i[4]=s("label",null,"Repeat:",-1)),s("span",null,"#"+b(f.apiCall.repeatIndex+1),1)])):R("",!0),s("div",wr,[i[5]||(i[5]=s("label",null,"Created:",-1)),s("span",null,b(N(f.apiCall.created)),1)]),f.apiCall.completed?(d(),v("div",Sr,[i[6]||(i[6]=s("label",null,"Completed:",-1)),s("span",null,b(N(f.apiCall.completed)),1)])):R("",!0),n.value?(d(),v("div",Ir,[i[7]||(i[7]=s("label",null,"Duration:",-1)),s("span",null,b(H(n.value)),1)])):R("",!0),f.apiCall.result?.latency?(d(),v("div",Er,[i[8]||(i[8]=s("label",null,"API Latency:",-1)),s("span",null,b(f.apiCall.result.latency)+"ms",1)])):R("",!0)]),u.value?(d(),v("div",Rr,[i[9]||(i[9]=s("label",null,"Provider/Model:",-1)),s("span",Fr,b(u.value),1)])):R("",!0)]),f.apiCall.variables&&Object.keys(f.apiCall.variables).length>0?(d(),v("div",Pr,[i[11]||(i[11]=s("h3",null,"Variables",-1)),s("div",xr,[(d(!0),v(Y,null,ee(f.apiCall.variables,(L,A)=>(d(),v("div",{key:A,class:"variable-group"},[s("div",Ar,[s("label",Vr,b(A)+":",1),s("span",Or,b(L),1)]),f.apiCall.variableAttributes&&f.apiCall.variableAttributes[A]?(d(),v("div",Dr,[(d(!0),v(Y,null,ee(f.apiCall.variableAttributes[A],(X,y)=>(d(),v("div",{key:y,class:"attribute-item"},[s("label",Nr,b(y)+":",1),s("span",Lr,b(X),1)]))),128))])):R("",!0)]))),128))])])):R("",!0),s("div",Mr,[i[12]||(i[12]=s("h3",null,"Resolved Prompt",-1)),s("div",Ur,b(f.apiCall.prompt),1)]),f.apiCall.result?(d(),v("div",zr,[i[35]||(i[35]=s("h3",null,"Response",-1)),f.apiCall.status==="failed"&&f.apiCall.result.error?(d(),v("div",Br,[k(S,{type:"error",message:f.apiCall.result.error,description:f.apiCall.result.errorType?`Error Type: ${E(f.apiCall.result.errorType)}`:void 0,"show-icon":""},null,8,["message","description"])])):f.apiCall.result.content?(d(),v("div",jr,[s("div",Wr,b(f.apiCall.result.content),1),f.apiCall.result.parsedContent!==void 0?(d(),v("div",Hr,[i[13]||(i[13]=s("h4",null,"Extracted Value (Original)",-1)),s("div",qr,b(V(f.apiCall.result.parsedContent)),1)])):R("",!0),f.apiCall.result.postParsedContent!==void 0?(d(),v("div",Gr,[i[14]||(i[14]=s("h4",null,"Post-Processed Value",-1)),s("div",Jr,b(V(f.apiCall.result.postParsedContent)),1)])):R("",!0),f.apiCall.result.refused?(d(),v("div",Xr,[k(S,{type:"warning",message:"Response flagged as refusal (Original Extraction)",description:"This response matched configured refusal patterns","show-icon":""})])):R("",!0),f.apiCall.result.postRefused?(d(),v("div",Kr,[k(S,{type:"warning",message:"Response flagged as refusal (Post-Processing)",description:"This response matched post-processing refusal patterns","show-icon":""})])):R("",!0),s("div",Qr,[i[21]||(i[21]=s("h4",null,"Original Extraction Configuration",-1)),s("div",Yr,[m.value.parserId?(d(),v("div",Zr,[i[15]||(i[15]=s("label",null,"Parser ID:",-1)),s("span",el,b(m.value.parserId),1)])):R("",!0),m.value.outputType?(d(),v("div",tl,[i[16]||(i[16]=s("label",null,"Output Type:",-1)),s("span",sl,b(m.value.outputType),1)])):R("",!0),m.value.extractPattern?(d(),v("div",al,[i[17]||(i[17]=s("label",null,"Extract Pattern:",-1)),s("span",nl,b(m.value.extractPattern),1)])):R("",!0),m.value.refusalWords&&m.value.refusalWords.length>0?(d(),v("div",ol,[i[18]||(i[18]=s("label",null,"Refusal Words:",-1)),s("span",rl,b(m.value.refusalWords.join(", ")),1)])):R("",!0),m.value.rejectRefusalWords!==void 0?(d(),v("div",ll,[i[19]||(i[19]=s("label",null,"Reject on Refusal:",-1)),s("span",il,b(m.value.rejectRefusalWords?"Yes":"No"),1)])):R("",!0),g.value?R("",!0):(d(),v("div",ul,i[20]||(i[20]=[s("span",{class:"no-config-message"},"No extraction configuration set for this trial",-1)])))])]),h.value&&h.value.enabled?(d(),v("div",dl,[i[29]||(i[29]=s("h4",null,"Post-Processing Configuration",-1)),s("div",cl,[s("div",pl,[i[23]||(i[23]=s("label",null,"Status:",-1)),s("span",fl,[k(O,{color:"processing"},{default:F(()=>i[22]||(i[22]=[D("Enabled")])),_:1,__:[22]})])]),h.value.outputType?(d(),v("div",ml,[i[24]||(i[24]=s("label",null,"Output Type:",-1)),s("span",vl,b(h.value.outputType),1)])):R("",!0),h.value.extractPattern?(d(),v("div",gl,[i[25]||(i[25]=s("label",null,"Extract Pattern:",-1)),s("span",hl,b(h.value.extractPattern),1)])):R("",!0),h.value.refusalWords&&h.value.refusalWords.length>0?(d(),v("div",yl,[i[26]||(i[26]=s("label",null,"Refusal Words:",-1)),s("span",bl,b(h.value.refusalWords.join(", ")),1)])):R("",!0),h.value.rejectRefusalWords!==void 0?(d(),v("div",_l,[i[27]||(i[27]=s("label",null,"Reject on Refusal:",-1)),s("span",Tl,b(h.value.rejectRefusalWords?"Yes":"No"),1)])):R("",!0),h.value.updatedAt?(d(),v("div",$l,[i[28]||(i[28]=s("label",null,"Last Updated:",-1)),s("span",Cl,b(N(h.value.updatedAt)),1)])):R("",!0)])])):R("",!0),f.apiCall.result.usage?(d(),v("div",kl,[i[34]||(i[34]=s("h4",null,"Token Usage",-1)),s("div",wl,[s("div",Sl,[i[30]||(i[30]=s("label",null,"Prompt Tokens:",-1)),s("span",null,b(f.apiCall.result.usage.prompt_tokens||0),1)]),s("div",Il,[i[31]||(i[31]=s("label",null,"Completion Tokens:",-1)),s("span",null,b(f.apiCall.result.usage.completion_tokens||0),1)]),s("div",El,[i[32]||(i[32]=s("label",null,"Total Tokens:",-1)),s("span",null,b(f.apiCall.result.usage.total_tokens||0),1)]),p.value?(d(),v("div",Rl,[i[33]||(i[33]=s("label",null,"Cost:",-1)),s("span",null,"$"+b(p.value.toFixed(4)),1)])):R("",!0)])])):R("",!0)])):R("",!0)])):R("",!0),k(B,{ghost:""},{default:F(()=>[k(r,{key:"raw",header:"Raw Data"},{default:F(()=>[s("div",Fl,[i[36]||(i[36]=s("h4",null,"HTTP Request",-1)),s("pre",Pl,b(c.value),1),f.apiCall.response?(d(),v("h4",xl,"Full API Response")):R("",!0),f.apiCall.response?(d(),v("pre",Al,b($.value),1)):R("",!0),f.apiCall.result?(d(),v("h4",Vl,"Processed Result")):R("",!0),f.apiCall.result?(d(),v("pre",Ol,b(I.value),1)):R("",!0)])]),_:1})]),_:1})]),s("div",Dl,[k(x,{onClick:w,size:"large"},{default:F(()=>i[37]||(i[37]=[D(" Close ")])),_:1,__:[37]}),k(x,{type:"primary",onClick:z,size:"large"},{default:F(()=>[k(j(vt)),i[38]||(i[38]=D(" Copy Details "))]),_:1,__:[38]})])]),_:1},8,["open"])}}}),as=re(Nl,[["__scopeId","data-v-72b861dc"]]),Ll={class:"post-processing-modal"},Ml={key:2,class:"current-extraction"},Ul={class:"parser-info"},zl={class:"parser-name"},Bl={key:3,class:"current-post-processing"},jl={class:"parser-info"},Wl={class:"parser-name"},Hl={key:4,class:"test-results"},ql={class:"footer-container"},Gl={key:0,class:"footer-statistics"},Jl={class:"stat-inline"},Xl={class:"stat-inline"},Kl={class:"stat-inline"},Ql={class:"stat-inline"},Yl={key:0,class:"stat-sample-note"},Zl={key:1,class:"footer-progress"},ei={class:"processing-message"},ti={class:"footer-buttons"},si=oe({__name:"PostProcessingModalV2",props:{visible:{type:Boolean},trial:{}},emits:["close"],setup(l,{emit:e}){const t=l,a=e,o=Ge(),n=ia(),u=q(t.visible),p=q(!1),c=q(!1),m=q(!1),g=q(null),h=q({postParserId:null}),$=q(""),I=q(0),T=q([]),C=q(null),N=[{title:"Variables",dataIndex:"variables",key:"variables",width:200,customRender:({text:_})=>Object.entries(_).map(([L,A])=>`${L}: ${A}`).join(", ")},{title:"Original",dataIndex:"original",key:"original",slots:{customRender:"original"}},{title:"Post-Processed",dataIndex:"postProcessed",key:"postProcessed",slots:{customRender:"postProcessed"}},{title:"Changed",dataIndex:"changed",key:"changed",width:100,slots:{customRender:"changed"}}],H=U(()=>t.trial.parserId?n.parsers.find(_=>_.id===t.trial.parserId):null),V=U(()=>t.trial.postParserId?n.parsers.find(_=>_.id===t.trial.postParserId):null);function E(_){switch(_){case"regex":return"blue";case"javascript":return"orange";case"python":return"green";default:return"default"}}function w(_){return _===void 0?"(no match)":_===null?"null":typeof _=="string"&&_.length>50?_.substring(0,50)+"...":String(_)}function z(){c.value=!0}function f(_){g.value=_,m.value=!0}async function i(_,L){if(!_||!L){T.value=[],C.value=null;return}await O(L),await S(L)}async function O(_){const L=o.apiCalls.value.filter(X=>X.result?.content).slice(0,10),A=[];for(const X of L){const y=await Tt.executeParser(X.result.content,_);A.push({id:X.id,variables:X.variables,original:X.result.parsedContent,postProcessed:y.success?y.value:null,changed:y.success&&y.value!==X.result.parsedContent})}T.value=A}async function S(_){if(!o.apiCalls.value.length){C.value=null;return}const L=o.apiCalls.value,A=L.length,X=L.filter(fe=>fe.result?.content),y=X.length,W=Math.min(50,y),J=X.slice(0,W);let K=0,ae=0;for(const fe of J){const Ee=await Tt.executeParser(fe.result.content,_);Ee.success&&Ee.value!==void 0&&(K++,Ee.value!==fe.result.parsedContent&&ae++)}const ne=W<y;if(ne&&W>0){const fe=y/W;K=Math.round(K*fe),ae=Math.round(ae*fe)}C.value={total:A,withContent:y,matches:K,changed:ae,sampled:ne,sampleSize:W}}async function r(){p.value=!0,$.value="Clearing post-processing...";try{const _=await kt.updatePostParserId(t.trial.id,null,!1);if(_.ok)h.value.postParserId=null,T.value=[],C.value=null,Z.success("Post-processing cleared"),await o.refreshFromDatabase(t.trial.id);else throw _.error}catch(_){P.error("Failed to clear post-processing:",_),Z.error("Failed to clear post-processing")}finally{p.value=!1,$.value=""}}async function B(){if(!h.value.postParserId){Z.warning("Please select a parser");return}p.value=!0,I.value=0;try{const _=o.apiCalls.value.filter(y=>y.status==="completed"&&y.result?.content),L=_.length>0;let A=!1;if(L){const J=(n.parsers.find(K=>K.id===h.value.postParserId)?.type||"parser")==="python"?`Apply post-processing to ${_.length} existing calls?

Note: Python parsers may take several minutes for large trials.`:`Apply post-processing to ${_.length} existing calls?`;A=confirm(J)}A?($.value=`Applying to ${_.length} calls...`,I.value=10):($.value="Saving configuration...",I.value=50);const X=await kt.updatePostParserId(t.trial.id,h.value.postParserId,A);if(X.ok)I.value=90,$.value="Refreshing data...",await o.refreshFromDatabase(t.trial.id),I.value=100,$.value="Complete!",Z.success(A?`Post-processing applied to ${_.length} calls`:"Post-processing configured for future calls"),p.value=!1,setTimeout(()=>{x()},1e3);else throw X.error}catch(_){P.error("Failed to apply post-processing:",_),Z.error("Failed to apply post-processing"),p.value=!1,$.value="",I.value=0}}function x(){p.value||a("close")}return me(async()=>{if(await n.initialize(),t.trial.postParserId){h.value.postParserId=t.trial.postParserId;const _=n.parsers.find(L=>L.id===t.trial.postParserId);_&&(await O(_),await S(_))}else t.trial.postProcessingConfig?.enabled&&Z.info("Legacy post-processing config detected. Please select a parser to continue.")}),le(()=>t.visible,_=>{u.value=_}),le(u,_=>{!_&&!p.value&&a("close")}),(_,L)=>{const A=He,X=We,y=ea,W=ta,J=sa,K=pe,ae=Te;return d(),Q(ae,{visible:u.value,"onUpdate:visible":L[1]||(L[1]=ne=>u.value=ne),title:"Post-Process Extraction",width:"80%","mask-closable":!p.value,closable:!p.value,onCancel:x},{footer:F(()=>[s("div",ql,[C.value&&h.value.postParserId&&!p.value?(d(),v("div",Gl,[s("span",Jl,[L[5]||(L[5]=s("span",{class:"stat-label"},"Total:",-1)),L[6]||(L[6]=D()),s("strong",null,b(C.value.total),1)]),L[13]||(L[13]=s("span",{class:"stat-divider"},"|",-1)),s("span",Xl,[L[7]||(L[7]=s("span",{class:"stat-label"},"With Content:",-1)),L[8]||(L[8]=D()),s("strong",null,b(C.value.withContent),1)]),L[14]||(L[14]=s("span",{class:"stat-divider"},"|",-1)),s("span",Kl,[L[9]||(L[9]=s("span",{class:"stat-label"},"Est. Matches:",-1)),L[10]||(L[10]=D()),s("strong",null,b(C.value.matches),1)]),L[15]||(L[15]=s("span",{class:"stat-divider"},"|",-1)),s("span",Ql,[L[11]||(L[11]=s("span",{class:"stat-label"},"Est. Changed:",-1)),L[12]||(L[12]=D()),s("strong",null,b(C.value.changed),1)]),C.value.sampled?(d(),v("span",Yl," ("+b(C.value.sampleSize)+" samples) ",1)):R("",!0)])):R("",!0),p.value?(d(),v("div",Zl,[s("div",ei,b($.value),1),k(J,{percent:I.value,status:I.value===100?"success":"active","stroke-width":4,style:{width:"100%"}},null,8,["percent","status"])])):R("",!0),s("div",ti,[V.value?(d(),Q(K,{key:0,onClick:r,disabled:p.value,danger:""},{default:F(()=>L[16]||(L[16]=[D(" Clear Post-Processing ")])),_:1,__:[16]},8,["disabled"])):R("",!0),k(K,{onClick:x,disabled:p.value},{default:F(()=>[D(b(p.value?"Processing...":"Close"),1)]),_:1},8,["disabled"]),k(K,{type:"primary",onClick:B,loading:p.value,disabled:!h.value.postParserId||h.value.postParserId===_.trial.postParserId},{default:F(()=>[D(b(p.value?$.value:"Apply Post-Processing"),1)]),_:1},8,["loading","disabled"])])])]),default:F(()=>[s("div",Ll,[_.trial.status==="running"?(d(),Q(A,{key:0,message:"Trial is currently running",description:"Post-processing will apply to all completed calls and future results as they arrive.",type:"info","show-icon":"",style:{"margin-bottom":"20px"}})):_.trial.status==="draft"?(d(),Q(A,{key:1,message:"Trial not started",description:"Configure post-processing now. It will apply when the trial runs.",type:"warning","show-icon":"",style:{"margin-bottom":"20px"}})):R("",!0),H.value?(d(),v("div",Ml,[L[2]||(L[2]=s("h4",null,"Current Primary Parser",-1)),s("div",Ul,[s("span",zl,b(H.value.name),1),k(X,{color:E(H.value.type)},{default:F(()=>[D(b(H.value.type),1)]),_:1},8,["color"]),k(X,null,{default:F(()=>[D(b(H.value.outputType),1)]),_:1})])])):R("",!0),V.value?(d(),v("div",Bl,[L[3]||(L[3]=s("h4",null,"Active Post-Processing Parser",-1)),s("div",jl,[s("span",Wl,b(V.value.name),1),k(X,{color:E(V.value.type)},{default:F(()=>[D(b(V.value.type),1)]),_:1},8,["color"]),k(X,null,{default:F(()=>[D(b(V.value.outputType),1)]),_:1})])])):R("",!0),k(y,{label:V.value?"Change Post-Processing Parser":"Select Post-Processing Parser"},{default:F(()=>[k(la,{modelValue:h.value.postParserId,"onUpdate:modelValue":L[0]||(L[0]=ne=>h.value.postParserId=ne),"allow-create":!0,"show-preview":!0,placeholder:"Select or create a parser for post-processing",onCreate:z,onTest:f,onChange:i},null,8,["modelValue"])]),_:1},8,["label"]),T.value.length>0&&h.value.postParserId?(d(),v("div",Hl,[L[4]||(L[4]=s("h4",null,"Preview Results (First 10 calls)",-1)),k(W,{columns:N,"data-source":T.value,pagination:!1,size:"small",scroll:{x:800}},{original:F(({text:ne})=>[s("code",null,b(w(ne)),1)]),postProcessed:F(({text:ne,record:fe})=>[s("code",{class:te({"value-changed":fe.changed})},b(w(ne)),3)]),changed:F(({text:ne})=>[k(X,{color:ne?"green":"default"},{default:F(()=>[D(b(ne?"Changed":"Same"),1)]),_:2},1032,["color"])]),_:1},8,["data-source"])])):R("",!0)])]),_:1},8,["visible","mask-closable","closable"])}}}),ai=re(si,[["__scopeId","data-v-17edda1c"]]),ni={class:"trial-results-table"},oi={class:"table-container"},ri={class:"results-table"},li={key:0,class:"col-status"},ii={key:1,class:"col-configuration"},ui={key:2,class:"col-repeat"},di={key:3,class:"col-variables"},ci={key:4,class:"col-response"},pi={key:5,class:"col-parsed"},fi={key:6,class:"col-post-processed"},mi={key:0,class:"post-process-indicator"},vi={key:7,class:"col-length"},gi={key:8,class:"col-latency"},hi={class:"results-table"},yi=["onClick"],bi={key:0,class:"col-status"},_i={class:"status-cell"},Ti={class:"status-time"},$i={key:1,class:"col-configuration"},Ci={key:2,class:"col-repeat"},ki={key:3,class:"col-variables"},wi={class:"variable-tags"},Si={key:0,class:"var-item"},Ii={key:1,class:"var-item"},Ei={key:2},Ri={key:3},Fi={key:4,class:"col-response"},Pi={class:"response-content"},xi={key:5,class:"col-parsed"},Ai={key:6,class:"col-post-processed"},Vi={key:7,class:"col-length"},Oi={key:8,class:"col-latency"},Di={key:1,class:"results-table"},Ni={key:0,class:"col-status"},Li={key:1,class:"col-configuration"},Mi={key:2,class:"col-repeat"},Ui={key:3,class:"col-variables"},zi={key:4,class:"col-response"},Bi={key:5,class:"col-parsed"},ji={key:6,class:"col-post-processed"},Wi={key:0,class:"post-process-indicator"},Hi={key:7,class:"col-length"},qi={key:8,class:"col-latency"},Gi=["onClick"],Ji={key:0,class:"col-status"},Xi={class:"status-cell"},Ki={class:"status-time"},Qi={key:1,class:"col-configuration"},Yi={key:2,class:"col-repeat"},Zi={key:3,class:"col-variables"},eu={class:"variable-tags"},tu={key:0,class:"var-item"},su={key:1,class:"var-item"},au={key:2},nu={key:3},ou={key:4,class:"col-response"},ru={class:"response-content"},lu={key:5,class:"col-parsed"},iu={key:6,class:"col-post-processed"},uu={key:7,class:"col-length"},du={key:8,class:"col-latency"},cu={key:0},pu=["colspan"],fu={key:0},mu={key:1},Rt="trial-results-visible-columns",vu=oe({__name:"TrialResultsTableV3",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(l){const e=l,t=q("all"),a=q([]),o=q(""),n=q(["status","configuration","variables","response","parsedResponse","postProcessedResponse","length","latency"]),u=q(null),p=q(!1),c=Ge(),m=U(()=>c.apiCalls?.value||[]),g=U(()=>e.apiCalls||m.value);le(g,(x,_)=>{const L=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 calls data changed from ${_?.length||0} to ${x.length} calls`),setTimeout(()=>{const A=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 reactive update completed in ${(A-L).toFixed(1)}ms`)},0)});const h=x=>{if(!o.value)return x;const _=o.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),L=new RegExp(`(${_})`,"gi");return x.replace(L,"<mark>$1</mark>")},$=U(()=>{const x=performance.now();if(!(t.value!=="all"||a.value.length>0||o.value))return performance.now()-x>5&&P.info(`V4_OPTIMIZE: No filtering needed, returning ${g.value.length} calls directly`),g.value;let L=g.value.filter(X=>{if(t.value!=="all"&&X.status!==t.value||a.value.length>0&&!a.value.includes(String(X.configurationIndex)))return!1;if(o.value){const y=o.value.toLowerCase();if(!(X.prompt?.toLowerCase().includes(y)||X.result?.content?.toLowerCase().includes(y)||X.result?.error?.toLowerCase().includes(y)))return!1}return!0});const A=performance.now();return A-x>10&&P.info(`V4_OPTIMIZE: Filtered ${g.value.length} → ${L.length} calls in ${(A-x).toFixed(1)}ms`),L});le($,(x,_)=>{const L=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls changed from ${_?.length||0} to ${x.length} items`),setTimeout(()=>{const A=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls render completed in ${(A-L).toFixed(1)}ms`)},0)});const I=U(()=>g.value),T=U(()=>g.value.length),C=U(()=>e.trial.configurations.some(x=>x.repeatCount>1)),N=U(()=>60);function H(x){}function V(x){const _=e.trial.configurations[x];return _?_.modelSnapshot?.displayName||`${_.modelId}`:`Config ${x+1}`}function E(x){return x.status==="pending"?"Waiting...":x.status==="running"?"Processing...":x.status==="failed"?x.result?.errorType==="refusal_detected"||x.result?.error==="REFUSED"?x.result?.content||"REFUSED":x.result?.error||"Error occurred":x.result?.content||""}function w(x){if(!x.result)return"";if(x.result.parsedContent!==void 0){const _=x.result.parsedContent;return _===null?"null":typeof _=="string"?_:typeof _=="number"||typeof _=="boolean"?String(_):JSON.stringify(_)}return""}function z(x){if(!x.result||x.result.postParsedContent===void 0)return"";const _=x.result.postParsedContent;return _===null?"null":_==="REFUSED"||x.result.postRefused?"REFUSED":typeof _=="string"?_:typeof _=="number"||typeof _=="boolean"?String(_):JSON.stringify(_)}function f(x){const _=x.result?.content||"";if(!_)return"";const L=_.length;return L>1e3?`${(L/1e3).toFixed(1)}k chars`:`${L} chars`}function i(x){return x?x<1e3?`${x}ms`:`${(x/1e3).toFixed(1)}s`:""}function O(x){let _;switch(x.status){case"completed":case"failed":_=x.completed;break;case"running":_=x.started;break;case"pending":case"cancelled":_=x.created;break}if(!_)return"";const L=new Date(_),A=L.getHours().toString().padStart(2,"0"),X=L.getMinutes().toString().padStart(2,"0"),y=L.getSeconds().toString().padStart(2,"0");return`  ${A}:${X}:${y}`}function S(x){return x?x<1e3?"latency-fast":x<5e3?"latency-medium":"latency-slow":""}function r(x){return h(x)}function B(x){u.value=x}return le(n,x=>{localStorage.setItem(Rt,JSON.stringify(x))},{deep:!0}),me(()=>{const x=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 MOUNTED with ${g.value.length} calls`);const _=localStorage.getItem(Rt);if(_)try{n.value=JSON.parse(_)}catch{}Ce(()=>{const L=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 DOM ready in ${(L-x).toFixed(1)}ms`),setTimeout(()=>{const A=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 virtual scrolling ready in ${(A-x).toFixed(1)}ms`)},100)}),setTimeout(()=>{const L=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 mount completed in ${(L-x).toFixed(1)}ms`)},0)}),Pe(()=>{P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 ACTIVATED (cache hit) with ${g.value.length} calls`)}),xe(()=>{P.info("V4_TRIAL_SWITCH: TrialResultsTableV3 DEACTIVATED (cached)")}),ye(()=>{P.info("V4_TRIAL_SWITCH: TrialResultsTableV3 UNMOUNTED (evicted)")}),(x,_)=>{const L=Ot("dompurify-html");return d(),v("div",ni,[k(gr,{"status-filter":t.value,"onUpdate:statusFilter":_[0]||(_[0]=A=>t.value=A),"config-filter":a.value,"onUpdate:configFilter":_[1]||(_[1]=A=>a.value=A),"search-query":o.value,"onUpdate:searchQuery":_[2]||(_[2]=A=>o.value=A),"visible-columns":n.value,"onUpdate:visibleColumns":_[3]||(_[3]=A=>n.value=A),configurations:x.trial.configurations,"api-calls":I.value,"show-repeat-column":C.value,onOpenPostProcessing:_[4]||(_[4]=A=>p.value=!0)},null,8,["status-filter","config-filter","search-query","visible-columns","configurations","api-calls","show-repeat-column"]),s("div",oi,[T.value>100?(d(),Q(j(Xe),{key:0,class:"results-scroller",items:Array.from($.value),"item-size":N.value,"key-field":"id",buffer:10,onVisibleRange:H},{before:F(()=>[s("table",ri,[s("thead",null,[s("tr",null,[n.value.includes("status")?(d(),v("th",li,"Status")):R("",!0),n.value.includes("configuration")?(d(),v("th",ii,"Configuration")):R("",!0),n.value.includes("repeat")&&C.value?(d(),v("th",ui,"Repeat")):R("",!0),n.value.includes("variables")?(d(),v("th",di,"Variables")):R("",!0),n.value.includes("response")?(d(),v("th",ci,"Response")):R("",!0),n.value.includes("parsedResponse")?(d(),v("th",pi,"Parsed Response")):R("",!0),n.value.includes("postProcessedResponse")?(d(),v("th",fi,[_[7]||(_[7]=D(" Post-Processed ")),x.trial.postProcessingConfig?.enabled?(d(),v("span",mi,"✨")):R("",!0)])):R("",!0),n.value.includes("length")?(d(),v("th",vi,"Length")):R("",!0),n.value.includes("latency")?(d(),v("th",gi,"Latency")):R("",!0)])])])]),default:F(({item:A})=>[s("table",hi,[s("tbody",null,[s("tr",{class:te(["result-row",`status-${A.status}`]),onClick:X=>B(A)},[n.value.includes("status")?(d(),v("td",bi,[s("div",_i,[s("span",{class:te(["status-tag",`status-${A.status}`])},b(A.status.toUpperCase()),3),s("span",Ti,b(O(A)),1)])])):R("",!0),n.value.includes("configuration")?(d(),v("td",$i,b(V(A.configurationIndex)),1)):R("",!0),n.value.includes("repeat")&&C.value?(d(),v("td",Ci," #"+b((A.repeatIndex||0)+1),1)):R("",!0),n.value.includes("variables")?(d(),v("td",ki,[s("div",wi,[(d(!0),v(Y,null,ee(Object.entries(A.variables),([X,y],W)=>(d(),v(Y,{key:X},[_[9]||(_[9]=s("span",{class:"var-bullet"},"• ",-1)),Object.keys(A.variables).length<=2?(d(),v("span",Si,b(X)+": "+b(y),1)):(d(),v("span",Ii,b(y),1)),Object.keys(A.variables).length===2&&W===0?(d(),v("span",Ei,_[8]||(_[8]=[s("br",null,null,-1)]))):W<Object.keys(A.variables).length-1?(d(),v("span",Ri,b("  "))):R("",!0)],64))),128))])])):R("",!0),n.value.includes("response")?(d(),v("td",Fi,[Se(s("div",Pi,null,512),[[L,r(E(A)),"apiResponse"]])])):R("",!0),n.value.includes("parsedResponse")?(d(),v("td",xi,b(w(A)),1)):R("",!0),n.value.includes("postProcessedResponse")?(d(),v("td",Ai,b(z(A)),1)):R("",!0),n.value.includes("length")?(d(),v("td",Vi,b(f(A)),1)):R("",!0),n.value.includes("latency")?(d(),v("td",Oi,[s("span",{class:te(S(A.response?.latencyMs))},b(i(A.response?.latencyMs)),3)])):R("",!0)],10,yi)])])]),_:1},8,["items","item-size"])):(d(),v("table",Di,[s("thead",null,[s("tr",null,[n.value.includes("status")?(d(),v("th",Ni,"Status")):R("",!0),n.value.includes("configuration")?(d(),v("th",Li,"Configuration")):R("",!0),n.value.includes("repeat")&&C.value?(d(),v("th",Mi,"Repeat")):R("",!0),n.value.includes("variables")?(d(),v("th",Ui,"Variables")):R("",!0),n.value.includes("response")?(d(),v("th",zi,"Response")):R("",!0),n.value.includes("parsedResponse")?(d(),v("th",Bi,"Parsed Response")):R("",!0),n.value.includes("postProcessedResponse")?(d(),v("th",ji,[_[10]||(_[10]=D(" Post-Processed ")),x.trial.postProcessingConfig?.enabled?(d(),v("span",Wi,"✨")):R("",!0)])):R("",!0),n.value.includes("length")?(d(),v("th",Hi,"Length")):R("",!0),n.value.includes("latency")?(d(),v("th",qi,"Latency")):R("",!0)])]),s("tbody",null,[(d(!0),v(Y,null,ee($.value,A=>(d(),v("tr",{key:A.id,class:te(["result-row",`status-${A.status}`]),onClick:X=>B(A)},[n.value.includes("status")?(d(),v("td",Ji,[s("div",Xi,[s("span",{class:te(["status-tag",`status-${A.status}`])},b(A.status.toUpperCase()),3),s("span",Ki,b(O(A)),1)])])):R("",!0),n.value.includes("configuration")?(d(),v("td",Qi,b(V(A.configurationIndex)),1)):R("",!0),n.value.includes("repeat")&&C.value?(d(),v("td",Yi," #"+b((A.repeatIndex||0)+1),1)):R("",!0),n.value.includes("variables")?(d(),v("td",Zi,[s("div",eu,[(d(!0),v(Y,null,ee(A.variables,(X,y,W)=>(d(),v(Y,{key:y},[_[12]||(_[12]=s("span",{class:"var-bullet"},"• ",-1)),Object.keys(A.variables).length<=2?(d(),v("span",tu,b(y)+": "+b(X),1)):(d(),v("span",su,b(X),1)),Object.keys(A.variables).length===2&&W===0?(d(),v("span",au,_[11]||(_[11]=[s("br",null,null,-1)]))):W<Object.keys(A.variables).length-1?(d(),v("span",nu,b("  "))):R("",!0)],64))),128))])])):R("",!0),n.value.includes("response")?(d(),v("td",ou,[Se(s("div",ru,null,512),[[L,r(E(A)),"apiResponse"]])])):R("",!0),n.value.includes("parsedResponse")?(d(),v("td",lu,b(w(A)),1)):R("",!0),n.value.includes("postProcessedResponse")?(d(),v("td",iu,b(z(A)),1)):R("",!0),n.value.includes("length")?(d(),v("td",uu,b(f(A)),1)):R("",!0),n.value.includes("latency")?(d(),v("td",du,[s("span",{class:te(S(A.response?.latencyMs))},b(i(A.response?.latencyMs)),3)])):R("",!0)],10,Gi))),128)),$.value.length===0?(d(),v("tr",cu,[s("td",{colspan:n.value.length,class:"empty-state"},[m.value.length===0?(d(),v("div",fu," No API calls yet. Start the trial to begin execution. ")):(d(),v("div",mu," No results match your filters. "))],8,pu)])):R("",!0)])]))]),u.value?(d(),Q(as,{key:0,visible:!!u.value,"api-call":u.value,trial:x.trial,"onUpdate:visible":_[5]||(_[5]=A=>u.value=null)},null,8,["visible","api-call","trial"])):R("",!0),p.value?(d(),Q(ai,{key:1,visible:p.value,trial:x.trial,onClose:_[6]||(_[6]=A=>p.value=!1)},null,8,["visible","trial"])):R("",!0)])}}}),gu=re(vu,[["__scopeId","data-v-a566786b"]]),hu={class:"trial-analysis-view"},yu=oe({__name:"TrialAnalysisView",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(l){const e=l;return me(()=>{const t=performance.now();P.info(`V4_TRIAL_SWITCH: TrialAnalysisView MOUNTED for trial ${e.trial.id}`),Ce(()=>{const a=performance.now();P.info(`V4_TRIAL_SWITCH: TrialAnalysisView DOM ready in ${(a-t).toFixed(1)}ms`)}),setTimeout(()=>{const a=performance.now();P.info(`V4_TRIAL_SWITCH: TrialAnalysisView mount completed in ${(a-t).toFixed(1)}ms`)},0)}),Pe(()=>{P.info(`V4_TRIAL_SWITCH: TrialAnalysisView ACTIVATED (cache hit) for trial ${e.trial.id}`)}),xe(()=>{P.info(`V4_TRIAL_SWITCH: TrialAnalysisView DEACTIVATED (cached) for trial ${e.trial.id}`)}),ye(()=>{P.info(`V4_TRIAL_SWITCH: TrialAnalysisView UNMOUNTED (evicted) for trial ${e.trial.id}`)}),(t,a)=>(d(),v("div",hu,[k(gu,{trial:t.trial,progress:t.progress,"is-executing":t.isExecuting,"api-calls":t.apiCalls,"is-streaming":t.isStreaming,"is-loading":t.isLoading},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])]))}}),bu=re(yu,[["__scopeId","data-v-602f5d5a"]]);function _u(l,e){const t=new Set,a=new Set,o=new Set;l.forEach(g=>{g.variables&&Object.keys(g.variables).forEach(h=>t.add(h)),g.variableAttributes&&Object.values(g.variableAttributes).forEach(h=>{h&&Object.keys(h).forEach($=>a.add($))})});const n=Array.from(t).sort(),u=Array.from(a).sort(),p=Array.from(o).sort(),c=[],m=["success","refused","parsed_response",...c,...p];return{categorical:[...n,...u,"model","status","error_type"],numeric:["response_time","total_tokens","prompt_tokens","completion_tokens",...c].sort(),extracted:m}}function Me(l,e,t){switch(e){case"model":return t&&l.configurationIndex<t.configurations.length&&t.configurations[l.configurationIndex].modelId||"Unknown";case"status":return l.status;case"response_time":return Ps(l.response?.latencyMs);case"total_tokens":if(l.response?.body?.usage){const a=l.response.body.usage;return a.total_tokens||Fs(a.prompt_tokens,a.completion_tokens)||Oe(null)}return Oe(null);case"prompt_tokens":return Oe(l.response?.body?.usage?.prompt_tokens||l.response?.body?.usage?.input_tokens);case"completion_tokens":return Oe(l.response?.body?.usage?.completion_tokens||l.response?.body?.usage?.output_tokens);case"error_type":return l.result?.errorType||(l.result?.success===!1?"api_error":"success");case"success":return l.result?.success?1:0;case"refused":return l.result?.refused?1:0;case"parsed_response":if(l.result?.parsedContent!==void 0){const a=l.result.parsedContent;return typeof a=="object"?JSON.stringify(a):a}return null}if(l.variables?.[e]!==void 0)return l.variables[e];if(l.variableAttributes)for(const a of Object.keys(l.variableAttributes)){const o=l.variableAttributes[a];if(o&&o[e]!==void 0)return o[e]}return null}const Ae={count:{label:"Count",calculate:l=>l.length,format:l=>l.toString(),needsNumeric:!1},sum:{label:"Sum",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0):null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},mean:{label:"Mean",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0)/e.length:null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},median:{label:"Median",calculate:l=>{const e=l.map(o=>typeof o=="number"?o:null).filter(o=>o!==null);if(e.length===0)return null;const t=[...e].sort((o,n)=>o-n),a=Math.floor(t.length/2);return t.length%2===0?(t[a-1]+t[a])/2:t[a]},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},mode:{label:"Mode",calculate:l=>{if(l.length===0)return null;const e=new Map;l.forEach(o=>e.set(o,(e.get(o)||0)+1));let t=0,a=null;return e.forEach((o,n)=>{o>t&&(t=o,a=n)}),{value:a,count:t,total:l.length}},format:l=>l?`${l.value} (${l.count}/${l.total})`:"-",needsNumeric:!1},variance:{label:"Variance",calculate:l=>{const e=l.map(o=>typeof o=="number"?o:null).filter(o=>o!==null);if(e.length<=1)return null;const t=e.reduce((o,n)=>o+n,0)/e.length;return e.reduce((o,n)=>o+Math.pow(n-t,2),0)/(e.length-1)},format:l=>l?.toFixed(3)||"-",needsNumeric:!0},std_dev:{label:"Std Dev",calculate:l=>{const e=Ae.variance.calculate(l);return e!==null?Math.sqrt(e):null},format:l=>l?.toFixed(3)||"-",needsNumeric:!0},min:{label:"Min",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.min(...e):null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},max:{label:"Max",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.max(...e):null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},success_rate:{label:"Success Rate",calculate:(l,e)=>{const t=e.filter(a=>a.result?.success).length;return e.length>0?t/e.length:0},format:l=>`${Math.round(l*100)}%`,needsNumeric:!1,usesApiCalls:!0},refusal_rate:{label:"Refusal Rate",calculate:(l,e)=>{const t=e.filter(a=>a.result?.refused).length;return e.length>0?t/e.length:0},format:l=>`${Math.round(l*100)}%`,needsNumeric:!1,usesApiCalls:!0},avg_time:{label:"Avg Time (ms)",calculate:(l,e)=>{const t=e.filter(a=>a.response?.latencyMs).map(a=>a.response.latencyMs);return t.length>0?t.reduce((a,o)=>a+o,0)/t.length:null},format:l=>l?`${Math.round(l)}ms`:"-",needsNumeric:!1,usesApiCalls:!0}};function Ft(l,e,t){const a=performance.now(),o=new Map,n=new Set,u=new Set,p=new Map,c=(E,w)=>{p.has(w)||p.set(w,new Map);const z=p.get(w);return z.has(E)||z.set(E,Me(E,w,t)),z.get(E)};for(const E of l){const w=String(c(E,e.rowField)||"Unknown"),z=String(c(E,e.columnField)||"Unknown");n.add(w),u.add(z),o.has(w)||o.set(w,new Map);const f=o.get(w);f.has(z)||f.set(z,[]),f.get(z).push(E)}const m=performance.now()-a;m>50&&`${l.length}${m.toFixed(1)}`;const g=E=>E.every(z=>!isNaN(Number(z))&&z.trim()!=="")?E.sort((z,f)=>Number(z)-Number(f)):E.sort(),h=(E,w)=>(t&&(t.type,t.type),g(E)),$=e.rowSort==="original"?h(Array.from(n),e.rowField):g(Array.from(n)),I=e.columnSort==="original"?h(Array.from(u),e.columnField):g(Array.from(u)),T=Ae[e.aggregation];function C(E,w=!1){const z=w?E.map(S=>c(S,e.valueField)):E.map(S=>Me(S,e.valueField,t));if(!T||typeof T.calculate!="function")return P.error("Invalid aggregation function:",e.aggregation,T),{value:null,count:E.length,apiCalls:E,rawValues:z,error:"Invalid aggregation function"};const f={nonNumeric:0,nullUndefined:0};return T.needsNumeric&&(f.nonNumeric=z.filter(S=>typeof S!="number").length),f.nullUndefined=z.filter(S=>S==null).length,{value:T.usesApiCalls?T.calculate(z,E):T.calculate(z),count:E.length,apiCalls:E,rawValues:z,excludedCounts:f}}const N=$.map(E=>{const w=[],z=[];return I.forEach(f=>{const i=o.get(E)?.get(f)||[];w.push(i.length>0?C(i,!0):null),z.push(...i)}),{label:E,cells:w,total:C(z,!0)}}),H=I.map(E=>{const w=[];return $.forEach(z=>{const f=o.get(z)?.get(E)||[];w.push(...f)}),C(w,!0)}),V=performance.now()-a;return V>100&&`${V.toFixed(1)}${l.length}`,{rows:N,columns:I,totals:H,grandTotal:C(l,!0)}}function _e(l,e){return!l||l.value===null?"-":Ae[e].format(l.value)}function Tu(l){if(!l||Object.keys(l).length===0)return"";const e=[];return l.temperature!==void 0&&e.push(`T:${l.temperature}`),l.max_tokens!==void 0?e.push(`${l.max_tokens}t`):l.maxTokens!==void 0?e.push(`${l.maxTokens}t`):l.num_predict!==void 0&&e.push(`${l.num_predict}t`),l.top_p!==void 0&&e.push(`p:${l.top_p}`),l.top_k!==void 0&&e.push(`k:${l.top_k}`),e.length>0?`(${e.join(", ")})`:""}function $u(l,e,t,a=q({}),o={}){const{debounceMs:n=100}=o,u=q({rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}}),p=q({categorical:[],numeric:[],extracted:[]}),c=q(!1),m=q(0),g=U(()=>{const T=a.value;return Object.values(T).some(N=>N!=="")?l.value.filter(N=>{if(T.model&&T.model!==""){if(!t.value||N.configurationIndex>=t.value.configurations.length)return!1;const H=t.value.configurations[N.configurationIndex],V=H.modelId||"Unknown",E=Tu(H.parameters);if((E?`${V} ${E}`:V)!==T.model)return!1}if(T.status&&T.status!==""&&N.status!==T.status)return!1;for(const[H,V]of Object.entries(T))if(V&&V!==""&&H!=="model"&&H!=="status"&&N.variables?.[H]!==V)return!1;return!0}):l.value}),h=Ye(()=>{if(g.value.length===0){u.value={rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}};return}c.value=!0;const T=performance.now();try{u.value=Ft(g.value,e.value,t.value);const C=performance.now()-T;m.value=C,P.debug("Pivot data computed (config change)",{apiCallCount:g.value.length,computeTimeMs:C,rowCount:u.value.rows.length,columnCount:u.value.columns.length})}catch(C){P.error("Error computing pivot data",C)}finally{c.value=!1}},n),$=Ye(()=>{if(g.value.length===0){u.value={rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}};return}c.value=!0;const T=performance.now();try{u.value=Ft(g.value,e.value,t.value);const C=performance.now()-T;m.value=C,P.debug("Pivot data computed (stream update)",{apiCallCount:g.value.length,computeTimeMs:C,rowCount:u.value.rows.length,columnCount:u.value.columns.length})}catch(C){P.error("Error computing pivot data",C)}finally{c.value=!1}},100),I=Ye(()=>{p.value=_u(l.value,t.value)},200);return le([e],()=>{h()},{deep:!0}),le(g,(T,C)=>{const N=typeof window<"u"?window.__trialDataStoreV4?.():null;if(N&&N.activeTab?.value!=="pivot"){`${N.activeTab?.value}`;return}const H=C?.length||0,V=T.length;(H!==V||V>0)&&$()},{immediate:!0}),le([l,t],()=>{`${l.value.length}`,I()},{immediate:!0}),I(),{pivotData:U(()=>u.value),availableFields:U(()=>p.value),isComputing:U(()=>c.value),lastComputeTime:U(()=>m.value),formatCellValue:_e,extractFieldValue:Me,aggregationFunctions:Ae}}const Cu={class:"pivot-config-v3"},ku={class:"config-row"},wu={class:"config-group"},Su=["value","aria-label"],Iu={label:"Categorical"},Eu=["value"],Ru={class:"config-group sort-group"},Fu=["value","aria-label"],Pu={class:"config-group"},xu=["value","aria-label"],Au={label:"Categorical"},Vu=["value"],Ou={class:"config-group sort-group"},Du=["value","aria-label"],Nu={class:"config-group"},Lu=["value","aria-label"],Mu={label:"Extracted Values"},Uu=["value"],zu={label:"Numeric Fields"},Bu=["value"],ju={class:"config-group"},Wu=["value","aria-label"],Hu=oe({__name:"PivotConfigurationV3",props:{config:{},availableFields:{}},emits:["update-config"],setup(l,{emit:e}){const t=e;function a(n,u){t("update-config",n,u)}function o(n){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[n]||n.replace(/_/g," ").replace(/\b\w/g,p=>p.toUpperCase())}return(n,u)=>(d(),v("div",Cu,[s("div",ku,[s("div",wu,[u[6]||(u[6]=s("label",{for:"pivot-row-field"},"Rows (Group by):",-1)),s("select",{id:"pivot-row-field",value:n.config.rowField,"aria-label":"Group rows by "+o(n.config.rowField),onChange:u[0]||(u[0]=p=>a("rowField",p.target.value))},[s("optgroup",Iu,[(d(!0),v(Y,null,ee(n.availableFields.categorical,p=>(d(),v("option",{key:p,value:p},b(o(p)),9,Eu))),128))])],40,Su)]),s("div",Ru,[u[8]||(u[8]=s("label",{for:"pivot-row-sort"},"Sort Rows:",-1)),s("select",{id:"pivot-row-sort",value:n.config.rowSort||"original","aria-label":"Sort rows by "+(n.config.rowSort||"original")+" order",onChange:u[1]||(u[1]=p=>a("rowSort",p.target.value))},u[7]||(u[7]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,Fu)]),s("div",Pu,[u[9]||(u[9]=s("label",{for:"pivot-column-field"},"Columns (Group by):",-1)),s("select",{id:"pivot-column-field",value:n.config.columnField,"aria-label":"Group columns by "+o(n.config.columnField),onChange:u[2]||(u[2]=p=>a("columnField",p.target.value))},[s("optgroup",Au,[(d(!0),v(Y,null,ee(n.availableFields.categorical,p=>(d(),v("option",{key:p,value:p},b(o(p)),9,Vu))),128))])],40,xu)]),s("div",Ou,[u[11]||(u[11]=s("label",{for:"pivot-column-sort"},"Sort Columns:",-1)),s("select",{id:"pivot-column-sort",value:n.config.columnSort||"original","aria-label":"Sort columns by "+(n.config.columnSort||"original")+" order",onChange:u[3]||(u[3]=p=>a("columnSort",p.target.value))},u[10]||(u[10]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,Du)]),s("div",Nu,[u[12]||(u[12]=s("label",{for:"pivot-value-field"},"Values (Aggregate):",-1)),s("select",{id:"pivot-value-field",value:n.config.valueField,"aria-label":"Aggregate "+n.config.valueField+" values",onChange:u[4]||(u[4]=p=>a("valueField",p.target.value))},[s("optgroup",Mu,[(d(!0),v(Y,null,ee(n.availableFields.extracted,p=>(d(),v("option",{key:p,value:p},b(p),9,Uu))),128))]),s("optgroup",zu,[(d(!0),v(Y,null,ee(n.availableFields.numeric,p=>(d(),v("option",{key:p,value:p},b(o(p)),9,Bu))),128))])],40,Lu)]),s("div",ju,[u[14]||(u[14]=s("label",{for:"pivot-aggregation"},"Aggregation:",-1)),s("select",{id:"pivot-aggregation",value:n.config.aggregation,"aria-label":"Aggregation method: "+n.config.aggregation,onChange:u[5]||(u[5]=p=>a("aggregation",p.target.value))},u[13]||(u[13]=[Dt('<optgroup label="Statistical" data-v-0d3a0d50><option value="mean" data-v-0d3a0d50>Mean</option><option value="median" data-v-0d3a0d50>Median</option><option value="variance" data-v-0d3a0d50>Variance</option><option value="std_dev" data-v-0d3a0d50>Std Dev</option><option value="min" data-v-0d3a0d50>Min</option><option value="max" data-v-0d3a0d50>Max</option><option value="sum" data-v-0d3a0d50>Sum</option></optgroup><optgroup label="Frequency" data-v-0d3a0d50><option value="count" data-v-0d3a0d50>Count</option><option value="mode" data-v-0d3a0d50>Mode</option></optgroup><optgroup label="Performance" data-v-0d3a0d50><option value="success_rate" data-v-0d3a0d50>Success Rate</option><option value="refusal_rate" data-v-0d3a0d50>Refusal Rate</option><option value="avg_time" data-v-0d3a0d50>Avg Time</option></optgroup>',3)]),40,Wu)])])]))}}),qu=re(Hu,[["__scopeId","data-v-0d3a0d50"]]),Gu={class:"heatmap-controls-v3"},Ju={class:"color-scale-selector"},Xu=["value","aria-label"],Ku={class:"gradient-mode-selector"},Qu={class:"gradient-toggle",role:"group","aria-label":"Gradient mode selector"},Yu=["aria-pressed"],Zu=["aria-pressed"],ed=["aria-pressed"],td=["title","aria-label"],sd=oe({__name:"PivotHeatmapV3",props:{selectedColorScale:{},gradientMode:{},isFullscreen:{type:Boolean}},emits:["update-color-scale","update-gradient-mode","toggle-fullscreen"],setup(l,{emit:e}){const t=e;function a(n){const u=n.target.value;t("update-color-scale",u)}function o(n){t("update-gradient-mode",n)}return(n,u)=>(d(),v("div",Gu,[s("div",Ju,[u[5]||(u[5]=s("label",{for:"heatmap-color-scale"},"Color Scale:",-1)),s("select",{id:"heatmap-color-scale",value:n.selectedColorScale,"aria-label":"Color scale: "+n.selectedColorScale,onChange:a},u[4]||(u[4]=[Dt('<option value="blue-subtle" data-v-dcb6369b>Blue (Subtle)</option><option value="green-red" data-v-dcb6369b>Green-Red (Success)</option><option value="blue-yellow" data-v-dcb6369b>Blue-Yellow (Performance)</option><option value="purple-orange" data-v-dcb6369b>Purple-Orange (General)</option><option value="viridis" data-v-dcb6369b>Viridis</option><option value="inferno" data-v-dcb6369b>Inferno</option><option value="magma" data-v-dcb6369b>Magma</option><option value="plasma" data-v-dcb6369b>Plasma</option><option value="grayscale" data-v-dcb6369b>Grayscale</option>',9)]),40,Xu)]),s("div",Ku,[u[6]||(u[6]=s("label",null,"Gradient Mode:",-1)),s("div",Qu,[s("button",{type:"button",class:te(["toggle-btn",{active:n.gradientMode==="global"}]),"aria-pressed":n.gradientMode==="global",onClick:u[0]||(u[0]=p=>o("global"))}," Global ",10,Yu),s("button",{type:"button",class:te(["toggle-btn",{active:n.gradientMode==="column"}]),"aria-pressed":n.gradientMode==="column",onClick:u[1]||(u[1]=p=>o("column"))}," Per Column ",10,Zu),s("button",{type:"button",class:te(["toggle-btn",{active:n.gradientMode==="row"}]),"aria-pressed":n.gradientMode==="row",onClick:u[2]||(u[2]=p=>o("row"))}," Per Row ",10,ed)])]),s("button",{type:"button",class:"fullscreen-btn",title:n.isFullscreen?"Exit Fullscreen":"Enter Fullscreen","aria-label":n.isFullscreen?"Exit fullscreen mode":"Enter fullscreen mode",onClick:u[3]||(u[3]=p=>n.$emit("toggle-fullscreen"))},b(n.isFullscreen?"⊟":"⊞"),9,td)]))}}),ad=re(sd,[["__scopeId","data-v-dcb6369b"]]),nd={class:"pivot-filters-v3"},od={class:"filters-row"},rd={key:0,class:"filter-group"},ld=["value"],id=["value"],ud=["for"],dd=["id","value","aria-label","onChange"],cd={value:""},pd=["value"],fd={key:1,class:"filter-group"},md=["value"],vd=["value"],gd=oe({__name:"PivotFiltersV3",props:{apiCalls:{},trial:{},activeFilters:{}},emits:["update-filters","clear-filters"],setup(l,{emit:e}){const t=l,a=e,o=q({});let n=0;const u=()=>{if(t.apiCalls.length===0){o.value={};return}const $={};t.apiCalls.forEach(T=>{if(t.trial&&T.configurationIndex<t.trial.configurations.length){const C=t.trial.configurations[T.configurationIndex],N=C.modelId||"Unknown",H=m(C.parameters),V=H?`${N} ${H}`:N;$.model||($.model=new Set),$.model.add(V)}T.status&&($.status||($.status=new Set),$.status.add(T.status)),T.variables&&Object.entries(T.variables).forEach(([C,N])=>{N&&String(N).trim()&&($[C]||($[C]=new Set),$[C].add(String(N)))})});const I={};Object.entries($).forEach(([T,C])=>{I[T]=Array.from(C).sort()}),o.value=I};le(()=>t.apiCalls.length,$=>{($===0||n===0||$-n>=5)&&(u(),n=$)},{immediate:!0});const p=U(()=>{const{model:$,status:I,...T}=o.value;return T}),c=U(()=>Object.values(t.activeFilters).some($=>$!==""));function m($){if(!$||Object.keys($).length===0)return"";const I=[];return $.temperature!==void 0&&I.push(`T:${$.temperature}`),$.max_tokens!==void 0?I.push(`${$.max_tokens}t`):$.maxTokens!==void 0?I.push(`${$.maxTokens}t`):$.num_predict!==void 0&&I.push(`${$.num_predict}t`),$.top_p!==void 0&&I.push(`p:${$.top_p}`),$.top_k!==void 0&&I.push(`k:${$.top_k}`),I.length>0?`(${I.join(", ")})`:""}function g($){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",extracted_value:"Extracted Value"}[$]||$.replace(/_/g," ").replace(/\b\w/g,T=>T.toUpperCase())}function h($,I){const T={...t.activeFilters};I===""?delete T[$]:T[$]=I,a("update-filters",T)}return($,I)=>(d(),v("div",nd,[s("div",od,[o.value.model&&o.value.model.length>1?(d(),v("div",rd,[I[4]||(I[4]=s("label",{for:"filter-model",class:"filter-label"},"Model:",-1)),s("select",{id:"filter-model",value:$.activeFilters.model||"",class:"filter-select","aria-label":"Filter by model",onChange:I[0]||(I[0]=T=>h("model",T.target.value))},[I[3]||(I[3]=s("option",{value:""},"All Models",-1)),(d(!0),v(Y,null,ee(o.value.model,T=>(d(),v("option",{key:T,value:T},b(T),9,id))),128))],40,ld)])):R("",!0),(d(!0),v(Y,null,ee(p.value,(T,C)=>(d(),v("div",{key:C,class:"filter-group"},[s("label",{for:`filter-${C}`,class:"filter-label"},b(g(String(C)))+": ",9,ud),s("select",{id:`filter-${C}`,value:$.activeFilters[C]||"",class:"filter-select","aria-label":`Filter by ${g(String(C))}`,onChange:N=>h(String(C),N.target.value)},[s("option",cd,"All "+b(g(String(C))),1),(d(!0),v(Y,null,ee(T,N=>(d(),v("option",{key:N,value:N},b(N),9,pd))),128))],40,dd)]))),128)),o.value.status&&o.value.status.length>1?(d(),v("div",fd,[I[6]||(I[6]=s("label",{for:"filter-status",class:"filter-label"},"Status:",-1)),s("select",{id:"filter-status",value:$.activeFilters.status||"",class:"filter-select","aria-label":"Filter by status",onChange:I[1]||(I[1]=T=>h("status",T.target.value))},[I[5]||(I[5]=s("option",{value:""},"All Statuses",-1)),(d(!0),v(Y,null,ee(o.value.status,T=>(d(),v("option",{key:T,value:T},b(T),9,vd))),128))],40,md)])):R("",!0),c.value?(d(),v("button",{key:2,type:"button",class:"clear-filters-btn",title:"Clear all filters","aria-label":"Clear all filters",onClick:I[2]||(I[2]=T=>$.$emit("clear-filters"))}," Clear Filters ")):R("",!0)])]))}}),hd=re(gd,[["__scopeId","data-v-d5848163"]]),yd={class:"collapse-icon"},bd={class:"options-content"},_d={class:"controls-row"},Td={key:0,class:"performance-info"},$d={class:"table-view"},Cd={key:0,class:"empty-state","data-testid":"empty-data-message"},kd={key:1,class:"error-state","data-testid":"invalid-aggregation-error"},wd={key:2,class:"loading-state","data-testid":"computing-state"},Sd={key:3,class:"pivot-table-container"},Id={class:"pivot-table-grid responsive-table",role:"table"},Ed={role:"row"},Rd={class:"corner-cell",role:"columnheader"},Fd={key:0,class:"total-header",role:"columnheader"},Pd={class:"row-header",role:"rowheader"},xd=["data-testid","title","aria-label","role","onClick","onKeydown"],Ad={key:0,class:"cell-content"},Vd=["title"],Od={class:"cell-value"},Dd={class:"error-message"},Nd={key:1},Ld=oe({__name:"PivotTableV3",props:{apiCalls:{},trial:{default:null},config:{},maxTableRows:{default:1e4},showTotals:{type:Boolean,default:!0},showPerformanceInfo:{type:Boolean,default:!1}},emits:["config-change","cell-click"],setup(l,{emit:e}){const t=l,a=e,o=q(!1),n=q("blue-yellow"),u=q("global"),p=q(!1),c=q({rowField:t.config?.rowField||"",columnField:t.config?.columnField||"",valueField:t.config?.valueField||"",aggregation:t.config?.aggregation||"mean",rowSort:t.config?.rowSort||"original",columnSort:t.config?.columnSort||"original"});le(()=>t.config,y=>{y&&Object.assign(c.value,y)},{deep:!0});const m=q({}),g=Ge(),h=U(()=>g.apiCalls?g.apiCalls.value||[]:t.apiCalls||[]),$=h,I=U(()=>t.trial),{pivotData:T,availableFields:C,isComputing:N,lastComputeTime:H}=$u($,c,I,m,{debounceMs:750});le(T,(y,W)=>{const J=performance.now(),K=y?.rows?.length||0,ae=y?.columns?.length||0;P.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData computed: ${K}x${ae} matrix`),setTimeout(()=>{const ne=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData render completed in ${(ne-J).toFixed(1)}ms`)},0)}),le(N,y=>{y?P.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING STARTED with ${h.value.length} API calls`):P.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING FINISHED in ${H.value.toFixed(1)}ms`)}),le(h,(y,W)=>{const J=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls changed from ${W?.length||0} to ${y.length} calls`),setTimeout(()=>{const K=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls prop update completed in ${(K-J).toFixed(1)}ms`)},0)});const V=U(()=>T.value.rows.slice(0,t.maxTableRows)),E=U(()=>Object.values(m.value).some(W=>W!=="")?h.value.filter(W=>{if(m.value.model&&m.value.model!==""){if(!t.trial||W.configurationIndex>=t.trial.configurations.length)return!1;const J=t.trial.configurations[W.configurationIndex],K=J.modelId||"Unknown",ae=i(J.parameters);if((ae?`${K} ${ae}`:K)!==m.value.model)return!1}if(m.value.status&&m.value.status!==""&&W.status!==m.value.status)return!1;for(const[J,K]of Object.entries(m.value))if(K&&K!==""&&J!=="model"&&J!=="status"&&W.variables?.[J]!==K)return!1;return!0}).length:h.value.length),{getCellStyle:w,getSummaryStyle:z,styleKey:f}=pa(T,n,u);function i(y){if(!y||Object.keys(y).length===0)return"";const W=[];return y.temperature!==void 0&&W.push(`T:${y.temperature}`),y.max_tokens!==void 0?W.push(`${y.max_tokens}t`):y.maxTokens!==void 0?W.push(`${y.maxTokens}t`):y.num_predict!==void 0&&W.push(`${y.num_predict}t`),y.top_p!==void 0&&W.push(`p:${y.top_p}`),y.top_k!==void 0&&W.push(`k:${y.top_k}`),W.length>0?`(${W.join(", ")})`:""}function O(y){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[y]||y.replace(/_/g," ").replace(/\b\w/g,J=>J.toUpperCase())}function S(y,W,J){if(!J)return`${y} × ${W}: No data`;const K=_e(J,c.value.aggregation);let ae=`${y} × ${W}: ${K} (${J.count} calls)`;if(J.excludedCounts){const ne=[];J.excludedCounts.nonNumeric>0&&ne.push(`${J.excludedCounts.nonNumeric} non-numeric responses excluded`),J.excludedCounts.nullUndefined>0&&ne.push(`${J.excludedCounts.nullUndefined} null/empty responses`),ne.length>0&&(ae+=` | ${ne.join(", ")}`)}return J.error&&(ae+=` - ERROR: ${J.error}`),ae}function r(y,W,J){if(!J)return`${y} by ${W}: No data`;const K=_e(J,c.value.aggregation);return J.error?`${y} by ${W}: ${K} with data integrity error: ${J.error}`:`${y} by ${W}: ${K} from ${J.count} API calls`}function B(y,W){(y==="rowField"||y==="columnField"||y==="valueField"||y==="aggregation"||y==="rowSort"||y==="columnSort")&&(c.value[y]=W),a("config-change",{...c.value})}function x(y){m.value={...y}}function _(){m.value={}}function L(y,W,J){J&&a("cell-click",{row:y,column:W,cell:J})}function A(){p.value=!p.value}function X(){o.value=!o.value,o.value?document.body.style.overflow="hidden":document.body.style.overflow=""}return me(()=>{const y=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 MOUNTED for trial ${t.trial?.id||"unknown"} with ${h.value.length} calls`),Ce(()=>{const W=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 DOM ready in ${(W-y).toFixed(1)}ms`)}),setTimeout(()=>{const W=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 mount completed in ${(W-y).toFixed(1)}ms`)},0)}),Pe(()=>{P.info(`V4_TRIAL_SWITCH: PivotTableV3 ACTIVATED (cache hit) for trial ${t.trial?.id||"unknown"} with ${h.value.length} calls`)}),xe(()=>{P.info(`V4_TRIAL_SWITCH: PivotTableV3 DEACTIVATED (cached) for trial ${t.trial?.id||"unknown"}`)}),ye(()=>{P.info(`V4_TRIAL_SWITCH: PivotTableV3 UNMOUNTED (evicted) for trial ${t.trial?.id||"unknown"}`),o.value&&(document.body.style.overflow="")}),le([C,h],([y])=>{if(h.value.length>0&&(!c.value.rowField||c.value.rowField==="")&&y.categorical.length>0){if(c.value.rowField=y.categorical.find(W=>W!=="model"&&W!=="status"&&W!=="error_type")||y.categorical[0]||"model",c.value.columnField=c.value.columnField||"model",c.value.valueField=c.value.valueField||"parsed_response",!c.value.aggregation||c.value.aggregation===""){const W=h.value.slice(0,3).map(K=>Me(K,c.value.valueField,t.trial)).filter(K=>K!=null),J=W.length>0&&W.every(K=>typeof K=="number");c.value.aggregation=J?"mean":"mode"}a("config-change",{...c.value})}},{immediate:!0}),(y,W)=>(d(),v("div",{class:te(["pivot-table-v3",{fullscreen:o.value}])},[s("div",{class:te(["pivot-options-container",{collapsed:p.value}])},[s("div",{class:"options-header",onClick:A},[W[3]||(W[3]=s("span",{class:"options-title"},"Pivot Table Options",-1)),s("span",yd,b(p.value?"▶":"▼"),1)]),Se(s("div",bd,[Ss([j(C),c.value],()=>(d(),v("div",null,[k(qu,{config:c.value,"available-fields":j(C),onUpdateConfig:B},null,8,["config","available-fields"])])),W,0),s("div",_d,[h.value.length>0?(d(),Q(hd,{key:0,"api-calls":h.value,trial:y.trial,"active-filters":m.value,onUpdateFilters:x,onClearFilters:_},null,8,["api-calls","trial","active-filters"])):R("",!0),k(ad,{"selected-color-scale":n.value,"gradient-mode":u.value,"is-fullscreen":o.value,onUpdateColorScale:W[1]||(W[1]=J=>n.value=J),onUpdateGradientMode:W[2]||(W[2]=J=>u.value=J),onToggleFullscreen:X},null,8,["selected-color-scale","gradient-mode","is-fullscreen"])])],512),[[Nt,!p.value]])],2),y.showPerformanceInfo?(d(),v("div",Td,[s("span",null,"Computing: "+b(j(N)?"Yes":"No"),1),s("span",null,"Last Compute: "+b(j(H).toFixed(1))+"ms",1),s("span",null,"API Calls: "+b(h.value.length),1),s("span",null,"Filtered: "+b(E.value),1)])):R("",!0),s("div",$d,[h.value.length===0?(d(),v("div",Cd,W[4]||(W[4]=[s("p",null,"No data available for pivot table analysis.",-1)]))):c.value.aggregation in j(Ae)?j(N)?(d(),v("div",wd,W[6]||(W[6]=[s("p",null,"Computing pivot table...",-1)]))):(d(),v("div",Sd,[s("table",Id,[s("thead",null,[s("tr",Ed,[s("th",Rd,b(O(c.value.rowField)||"Items")+" / "+b(O(c.value.columnField)||"Aggregated"),1),(d(!0),v(Y,null,ee(j(T).columns,J=>(d(),v("th",{key:J,class:"column-header",role:"columnheader"},b(J),1))),128)),c.value.columnField&&y.showTotals?(d(),v("th",Fd," Total ")):R("",!0)])]),s("tbody",null,[(d(!0),v(Y,null,ee(V.value,J=>(d(),v("tr",{key:`${J.label}-${j(f)}`,class:"data-row",role:"row"},[s("td",Pd,b(J.label),1),(d(!0),v(Y,null,ee(J.cells,(K,ae)=>(d(),v("td",{key:`${ae}-${j(f)}`,class:te(["data-cell",{"error-cell":K?.error}]),"data-testid":K?.error?"pivot-cell-error":"pivot-cell",style:he(j(w)(K,J.label,ae)),title:S(J.label,j(T).columns[ae],K),"aria-label":r(J.label,j(T).columns[ae],K),role:K?.error?"alert":"cell",tabindex:"0",onClick:ne=>L(J.label,j(T).columns[ae],K),onKeydown:[st(ne=>L(J.label,j(T).columns[ae],K),["enter"]),st(Lt(ne=>L(J.label,j(T).columns[ae],K),["prevent"]),["space"])]},[K?.error?(d(),v("div",Ad,[s("span",{class:"error-indicator",title:K.error},"⚠️",8,Vd),s("span",Od,b(K?j(_e)(K,c.value.aggregation):"-"),1),s("div",Dd,b(K.error),1)])):(d(),v("span",Nd,b(K?j(_e)(K,c.value.aggregation):"-"),1))],46,xd))),128)),c.value.columnField&&y.showTotals?(d(),v("td",{key:0,class:"total-cell",style:he(j(z)(J.total)),role:"cell"},b(j(_e)(J.total,c.value.aggregation)),5)):R("",!0)]))),128)),c.value.rowField&&y.showTotals?(d(),v("tr",{key:`totals-${j(f)}`,class:"total-row",role:"row"},[W[7]||(W[7]=s("td",{class:"row-header",role:"rowheader"},"Total",-1)),(d(!0),v(Y,null,ee(j(T).totals,(J,K)=>(d(),v("td",{key:`total-${K}-${j(f)}`,class:"total-cell",style:he(j(z)(J)),role:"cell"},b(j(_e)(J,c.value.aggregation)),5))),128)),c.value.columnField?(d(),v("td",{key:0,class:"grand-total-cell",style:he(j(z)(j(T).grandTotal)),role:"cell"},b(j(_e)(j(T).grandTotal,c.value.aggregation)),5)):R("",!0)])):R("",!0)])])])):(d(),v("div",kd,[s("p",null,"Invalid aggregation function: "+b(c.value.aggregation),1),W[5]||(W[5]=s("p",null,"Please select a valid aggregation method.",-1))]))])],2))}}),Md=re(Ld,[["__scopeId","data-v-edba4039"]]),Ud={class:"modal-content"},zd={class:"modal-header"},Bd={class:"modal-title"},jd={class:"summary-row"},Wd={key:0},Hd={key:0,class:"filter-row"},qd=["onUpdate:modelValue","aria-label"],Gd={value:""},Jd=["value"],Xd={class:"table-container"},Kd={class:"api-calls-table"},Qd=["onClick"],Yd=["title"],Zd=["title"],ec=oe({__name:"PivotCellDetailV3",props:{visible:{type:Boolean},row:{},column:{},apiCalls:{},trial:{},value:{}},emits:["close"],setup(l){const e=l,t=Is({}),a=q(null),{formatSingleCost:o}=qe(),n=U(()=>{const i=new Set;return e.apiCalls.forEach(O=>{O.variables&&Object.keys(O.variables).forEach(S=>i.add(S)),O.attributedVariables&&Object.entries(O.attributedVariables).forEach(([S,r])=>{r&&typeof r=="object"&&Object.keys(r).forEach(B=>{i.add(`${S}.${B}`)})})}),Array.from(i).sort()}),u=U(()=>n.value.map(i=>({title:i,dataIndex:`var_${i}`,key:`var_${i}`,width:150}))),p=[{title:"Status",dataIndex:"status",key:"status",width:100},{title:"Model",dataIndex:"model",key:"model",width:150}],c=[{title:"Response",dataIndex:"response",key:"response",width:300},{title:"Parsed Content",dataIndex:"parsedContent",key:"parsedContent",width:150},{title:"Duration",dataIndex:"duration",key:"duration",width:100},{title:"Cost",dataIndex:"cost",key:"cost",width:100}],m=U(()=>[...p,...u.value,...c]),g=U(()=>`${e.row} × ${e.column} - ${e.apiCalls.length} API Calls`),h=U(()=>e.apiCalls.map(i=>{const O={id:i.id,status:i.status,model:i.modelName||"-",response:i.result?.content||i.result?.error||"-",parsedContent:H(i.result?.parsedContent),duration:i.duration!==void 0?`${i.duration}ms`:"-",cost:i.cost!==void 0?i.cost:"-"};return n.value.forEach(S=>{if(S.includes(".")){const[r,B]=S.split("."),x=i.attributedVariables?.[r]?.[B];O[`var_${S}`]=x!==void 0?String(x):"-"}else O[`var_${S}`]=i.variables?.[S]||"-"}),O})),$=U(()=>Object.values(t).some(i=>i!==void 0&&i!=="")),I=U(()=>$.value?h.value.filter(i=>Object.entries(t).every(([O,S])=>S?i[O]===S:!0)):h.value),T=U(()=>{const i=e.apiCalls.filter(O=>O.status==="completed").length;return Math.round(i/e.apiCalls.length*100)}),C=U(()=>{const i=e.apiCalls.filter(O=>O.duration).map(O=>O.duration);return i.length===0?0:Math.round(i.reduce((O,S)=>O+S,0)/i.length)}),N=U(()=>{const i=e.apiCalls.filter(O=>O.cost!==void 0).map(O=>O.cost);if(i.length!==0)return i.reduce((O,S)=>O+S,0)});function H(i){if(i==null)return"-";if(typeof i=="string")return i;if(typeof i=="number"||typeof i=="boolean")return String(i);if(typeof i=="object")try{return JSON.stringify(i,null,2).substring(0,100)}catch{return"[Object]"}return String(i)}function V(i){switch(i){case"completed":return"status-success";case"failed":return"status-error";case"pending":return"status-warning";case"running":return"status-processing";default:return"status-default"}}function E(i,O=200){if(!i)return"";if(i.length<=O)return i;const S=i.slice(0,100),r=i.slice(-100);return`${S} [...TRUNCATED...] ${r}`}function w(i){const O=new Set;return h.value.forEach(S=>{const r=S[i];r&&r!=="-"&&O.add(r)}),Array.from(O).sort()}function z(){Object.keys(t).forEach(i=>{delete t[i]})}function f(i){const O=e.apiCalls.find(S=>S.id===i.id);O&&(a.value=O)}return(i,O)=>(d(),v(Y,null,[s("div",{class:te(["pivot-cell-detail-modal-v3",{visible:i.visible}]),onClick:O[1]||(O[1]=Lt(S=>i.$emit("close"),["self"]))},[s("div",Ud,[s("div",zd,[s("h3",Bd,b(g.value),1),s("button",{type:"button",class:"close-btn","aria-label":"Close modal",onClick:O[0]||(O[0]=S=>i.$emit("close"))}," × ")]),s("div",jd,[s("span",null,[O[3]||(O[3]=s("b",null,"Total:",-1)),D(" "+b(i.apiCalls.length),1)]),s("span",null,[O[4]||(O[4]=s("b",null,"Success Rate:",-1)),D(" "+b(T.value)+"%",1)]),s("span",null,[O[5]||(O[5]=s("b",null,"Avg Duration:",-1)),D(" "+b(C.value)+"ms",1)]),N.value!==void 0?(d(),v("span",Wd,[O[6]||(O[6]=s("b",null,"Total Cost:",-1)),D(" "+b(j(o)(N.value)),1)])):R("",!0)]),u.value.length>0?(d(),v("div",Hd,[(d(!0),v(Y,null,ee(u.value,S=>(d(),v("div",{key:S.key,class:"variable-filter"},[Se(s("select",{"onUpdate:modelValue":r=>t[S.key]=r,"aria-label":`Filter ${S.title}`,class:"filter-select"},[s("option",Gd,"All "+b(S.title),1),(d(!0),v(Y,null,ee(w(S.key),r=>(d(),v("option",{key:r,value:r},b(r),9,Jd))),128))],8,qd),[[Es,t[S.key]]])]))),128)),$.value?(d(),v("button",{key:0,type:"button",class:"clear-filters-btn",onClick:z}," Clear Filters ")):R("",!0)])):R("",!0),s("div",Xd,[s("table",Kd,[s("thead",null,[s("tr",null,[(d(!0),v(Y,null,ee(m.value,S=>(d(),v("th",{key:S.key,class:"table-header",style:he({width:S.width?`${S.width}px`:"auto"})},b(S.title),5))),128))])]),s("tbody",null,[(d(!0),v(Y,null,ee(I.value,S=>(d(),v("tr",{key:S.id,class:"table-row clickable-row",onClick:r=>f(S)},[(d(!0),v(Y,null,ee(m.value,r=>(d(),v("td",{key:r.key,class:te(["table-cell",{"status-cell":r.key==="status"}])},[r.key==="status"?(d(),v("span",{key:0,class:te(["status-tag",V(S.status)])},b(S.status),3)):r.key==="response"?(d(),v("span",{key:1,class:"response-cell",title:S.response},b(E(S.response)),9,Yd)):r.key==="cost"?(d(),v(Y,{key:2},[D(b(S.cost==="-"?"-":j(o)(S.cost)),1)],64)):r.key.startsWith("var_")?(d(),v("span",{key:3,class:"variable-cell",title:S[r.key]},b(S[r.key]||"-"),9,Zd)):(d(),v(Y,{key:4},[D(b(S[r.key]||"-"),1)],64))],2))),128))],8,Qd))),128))])])])])],2),a.value?(d(),Q(as,{key:0,visible:!!a.value,"api-call":a.value,trial:i.trial,"onUpdate:visible":O[2]||(O[2]=S=>a.value=null)},null,8,["visible","api-call","trial"])):R("",!0)],64))}}),tc=re(ec,[["__scopeId","data-v-ddbda380"]]),sc={class:"trial-tab-content"},ac={class:"tab-pane-content"},nc={class:"tab-pane-content"},oc={key:0,class:"no-data-message"},rc={class:"tab-pane-content"},Pt="trial-details-active-tab",lc=oe({__name:"TrialTabContentV3",props:{trial:{},progress:{},isLeader:{type:Boolean},executionState:{}},setup(l){const e=l,t=Mt(),a=je(),o=Ge(),n=U(()=>o.apiCalls?.value||[]),u=U(()=>o.isStreaming?.value||!1);le(n,(V,E)=>{const w=performance.now();P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls changed from ${E?.length||0} to ${V.length} calls`),setTimeout(()=>{const z=performance.now();P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls reactive update completed in ${(z-w).toFixed(1)}ms`)},0)});const p=U(()=>!1),m=q((()=>{const V=t.query.tab;return V==="status"?"details":V&&["details","tasks","pivot"].includes(V)?V:"tasks"})()),g=q(!1);le(m,V=>{o.setActiveTab(V)},{immediate:!0});const h=q(!1),$=q({row:"",column:"",apiCalls:[],value:null}),I=U(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial.id),T=U(()=>e.trial.progress.completed>0);function C(){localStorage.setItem(Pt,m.value);const V={...t.query};V.tab=m.value,t.query.tab!==m.value&&(a.replace({query:V}),`${m.value}`)}function N(){const V=localStorage.getItem(Pt);V==="status"?m.value="details":V&&["details","tasks","pivot"].includes(V)&&(m.value=V)}function H(V){!V.cell||!V.cell.apiCalls.length||($.value={row:V.row,column:V.column,apiCalls:V.cell.apiCalls,value:V.cell.value},h.value=!0)}return le(m,()=>{C()}),le(()=>t.query.tab,V=>{if(V&&typeof V=="string"){let E=V==="status"?"details":V;["details","tasks","pivot"].includes(E)&&m.value!==E&&(m.value=E)}}),me(()=>{const V=performance.now();if(P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 MOUNTED for trial ${e.trial.id}`),!t.query.tab){const E={...t.query};E.tab=m.value,a.replace({query:E}),`${m.value}`}N(),setTimeout(()=>{const E=performance.now();P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 mount completed in ${(E-V).toFixed(1)}ms`)},0)}),Pe(()=>{P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 ACTIVATED (cache hit) for trial ${e.trial.id}`)}),xe(()=>{P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 DEACTIVATED (cached) for trial ${e.trial.id}`)}),ye(()=>{P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 UNMOUNTED (evicted) for trial ${e.trial.id}`)}),(V,E)=>{const w=na,z=aa;return d(),v("div",sc,[k(z,{activeKey:m.value,"onUpdate:activeKey":E[1]||(E[1]=f=>m.value=f),type:"card",class:"trial-tabs"},{default:F(()=>[k(w,{key:"tasks",tab:"Task View"},{default:F(()=>[s("div",ac,[(d(),Q(at,null,[k(bu,{trial:V.trial,progress:V.progress,"is-executing":I.value,"api-calls":n.value,"is-streaming":u.value,"is-loading":p.value},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])],1024))])]),_:1}),k(w,{key:"pivot",tab:"Pivot Table"},{default:F(()=>[s("div",nc,[(d(),Q(at,null,[T.value&&n.value.length>0?(d(),Q(Md,{key:0,"api-calls":n.value,trial:V.trial,"show-performance-info":!1,onCellClick:H},null,8,["api-calls","trial"])):R("",!0)],1024)),T.value&&n.value.length>0?R("",!0):(d(),v("div",oc,E[3]||(E[3]=[s("p",null,"No completed API calls available for pivot analysis.",-1),s("p",null,"Run the trial to see pivot table data.",-1)])))])]),_:1}),k(w,{key:"details",tab:"Details"},{default:F(()=>[s("div",rc,[k(pr,{trial:V.trial,"is-collapsed":g.value,onToggleCollapse:E[0]||(E[0]=f=>g.value=!g.value)},null,8,["trial","is-collapsed"])])]),_:1})]),_:1},8,["activeKey"]),h.value?(d(),Q(tc,{key:0,visible:h.value,row:$.value.row,column:$.value.column,"api-calls":$.value.apiCalls,trial:V.trial,value:$.value.value,onClose:E[2]||(E[2]=f=>h.value=!1)},null,8,["visible","row","column","api-calls","trial","value"])):R("",!0)])}}}),ic=re(lc,[["__scopeId","data-v-743ec3c1"]]);class de extends Error{constructor(t,a,o){super(a);ke(this,"code");ke(this,"details");this.name="ExportError",this.code=t,this.details=o}}function xt(l){return typeof TextEncoder<"u"?new TextEncoder().encode(l).length:typeof Buffer<"u"?Buffer.byteLength(l,"utf8"):unescape(encodeURIComponent(l)).length}const ie=class ie{async loadTrialForExport(e){try{const t=this.getCachedData(e);if(t)return{ok:!0,value:t};const a=await Re.trials.get(e);if(!a)return{ok:!1,error:new de("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})};const o=await Re.apiCalls.where("trialId").equals(e).toArray(),n={trial:a,apiCalls:o,fieldDefinitions:[],parameterFields:[],totalRecords:o.length};return this.setCachedData(e,n),{ok:!0,value:n}}catch(t){return{ok:!1,error:new de("GENERATION_FAILED",`Failed to load trial data: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateTrialForExport(e){try{return await Re.trials.get(e)?await Re.apiCalls.where("trialId").equals(e).count()===0?{ok:!1,error:new de("GENERATION_FAILED","Trial has no API calls to export",{trialId:e,apiCallCount:0})}:{ok:!0,value:!0}:{ok:!1,error:new de("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})}}catch(t){return{ok:!1,error:new de("GENERATION_FAILED",`Failed to validate trial: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async getApiCallCount(e){try{return await Re.apiCalls.where("trialId").equals(e).count()}catch(t){return P.warn(`Failed to get API call count for trial ${e}:`,t),0}}clearCache(e){ie.cache.delete(e),ie.cacheExpiry.delete(e)}clearAllCache(){ie.cache.clear(),ie.cacheExpiry.clear()}getCachedData(e){const t=ie.cacheExpiry.get(e);return!t||Date.now()>t?(ie.cache.delete(e),ie.cacheExpiry.delete(e),null):ie.cache.get(e)||null}setCachedData(e,t){ie.cache.set(e,t),ie.cacheExpiry.set(e,Date.now()+ie.CACHE_TTL)}};ke(ie,"cache",new Map),ke(ie,"cacheExpiry",new Map),ke(ie,"CACHE_TTL",6e4);let it=ie;const De=new it;class uc{discoverAllParameters(e){const t=new Map;return e.configurations.forEach((a,o)=>{!a.parameters||typeof a.parameters!="object"||Object.entries(a.parameters).forEach(([n,u])=>{const p=`param_${n}`;t.has(p)||t.set(p,{parameterName:n,fieldId:p,usedByConfigurations:[],dataType:this.inferDataType(u),sampleValues:[]});const c=t.get(p);c.usedByConfigurations.push(o),c.sampleValues.length<3&&!c.sampleValues.includes(u)&&c.sampleValues.push(u)})}),Array.from(t.values()).map(a=>this.createParameterFieldDefinition(a,e)).sort((a,o)=>a.id.localeCompare(o.id))}getParameterUsageStats(e){const t=this.discoverAllParameters(e),a={},o=[],n=[];e.configurations.forEach((p,c)=>{const m=p.provider;a[m]||(a[m]=[]),t.forEach(g=>{g.usedByConfigurations.includes(c)&&(a[m].includes(g.parameterName)||a[m].push(g.parameterName))})});const u=Object.keys(a);return t.forEach(p=>{u.filter(m=>a[m].includes(p.parameterName)).length>1?o.push(p.parameterName):n.push(p.parameterName)}),{totalUniqueParameters:t.length,parametersByProvider:a,sharedParameters:o.sort(),providerSpecificParameters:n.sort()}}validateParameterFields(e,t){const o=this.discoverAllParameters(e).map(c=>c.id),n=t.filter(c=>c.startsWith("param_")),u=[],p=[];return n.forEach(c=>{o.includes(c)?u.push(c):p.push(c)}),{validFields:u,invalidFields:p,availableFields:o}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}createParameterFieldDefinition(e,t){const a=e.usedByConfigurations.map(n=>t.configurations[n]?.provider||"unknown").filter((n,u,p)=>p.indexOf(n)===u).sort(),o=this.generateParameterDescription(e,a);return{id:e.fieldId,name:e.parameterName,description:o,group:"parameters",dataType:e.dataType,isRequired:!1,parameterName:e.parameterName,usedByConfigurations:e.usedByConfigurations}}generateParameterDescription(e,t){const a=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(n=>JSON.stringify(n)).join(", ")})`:"";return`${t.length===1?`Used by ${t[0]}`:`Used by ${t.join(", ")}`}${a}. Empty for configurations that don't use this parameter.`}}const Ue=new uc;class dc{discoverAllVariables(e,t){e.id,t.length;const a=new Map,o=new Map;t.forEach(g=>{g.variables&&typeof g.variables=="object"&&Object.entries(g.variables).forEach(([h,$])=>{const I=`var_${h}`;a.has(I)||a.set(I,{variableName:h,fieldId:I,usedByCallCount:0,dataType:this.inferDataType($),sampleValues:[]});const T=a.get(I);T.usedByCallCount++,T.sampleValues.length<3&&!T.sampleValues.includes($)&&T.sampleValues.push($)}),g.variableAttributes&&typeof g.variableAttributes=="object"&&Object.entries(g.variableAttributes).forEach(([h,$])=>{!$||typeof $!="object"||Object.entries($).forEach(([I,T])=>{const C=`attr_${h}_${I}`;o.has(C)||o.set(C,{attributeName:I,fieldId:C,usedByCallCount:0,dataType:this.inferDataType(T),sampleValues:[]});const N=o.get(C);N.usedByCallCount++,N.sampleValues.length<3&&!N.sampleValues.includes(T)&&N.sampleValues.push(T)})})});const n=Array.from(a.values()).map(g=>this.createVariableFieldDefinition(g,t.length)),u=Array.from(o.values()).map(g=>this.createAttributeFieldDefinition(g,t.length)),p=[];t.some(g=>g.variableIndices&&Object.keys(g.variableIndices).length>0)&&Array.from(a.values()).forEach(g=>{const h=g.variableName;p.push({id:`source_${h}_list`,name:`${h} Source List`,description:`Name of the list that provided the value for ${h}`,group:"source",dataType:"string",isRequired:!1}),p.push({id:`source_${h}_index`,name:`${h} Source Index`,description:`Position in the list (0-based) for ${h}`,group:"source",dataType:"number",isRequired:!1})});const m=[...n,...u,...p].sort((g,h)=>g.id.localeCompare(h.id));return n.length,u.length,p.length,m.length,n.map(g=>g.id),u.map(g=>g.id),m}getVariableUsageStats(e,t){const a=this.discoverAllVariables(e,t),o={};a.forEach(p=>{const c=p.name,m=this.getVariableInfo(c,t);o[c]=m.usedByCallCount});const n=Object.entries(o).sort(([,p],[,c])=>c-p).map(([p])=>p),u=t.filter(p=>p.variables&&typeof p.variables=="object"&&Object.keys(p.variables).length>0).length;return{totalUniqueVariables:a.length,variableUsageCounts:o,mostCommonVariables:n.slice(0,10),totalCallsWithVariables:u}}validateVariableFields(e,t,a){const n=this.discoverAllVariables(e,t).map(m=>m.id),u=a.filter(m=>m.startsWith("var_")),p=[],c=[];return u.forEach(m=>{n.includes(m)?p.push(m):c.push(m)}),{validFields:p,invalidFields:c,availableFields:n}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}getVariableInfo(e,t){let a=0;const o=[];return t.forEach(n=>{if(n.variables&&n.variables[e]!==void 0){a++;const u=n.variables[e];o.length<3&&!o.includes(u)&&o.push(u)}}),{attributeName:e,fieldId:`attr_${e}`,usedByCallCount:a,dataType:o.length>0?this.inferDataType(o[0]):"string",sampleValues:o}}createVariableFieldDefinition(e,t){const a=this.generateVariableDescription(e,t);return{id:e.fieldId,name:e.variableName,description:a,group:"content",dataType:e.dataType,isRequired:!1}}createAttributeFieldDefinition(e,t){const a=this.generateAttributeDescription(e,t),o=e.fieldId.replace("attr_","").split("_"),n=o[0],u=o.slice(1).join("_"),p=`${n} attr ${u}`;return{id:e.fieldId,name:p,description:a,group:"content",dataType:e.dataType,isRequired:!1}}generateVariableDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),o=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(n=>JSON.stringify(n)).join(", ")})`:"";return`Template variable used in ${e.usedByCallCount}/${t} calls (${a}%)${o}. Empty for calls that don't use this variable.`}generateAttributeDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),o=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(n=>JSON.stringify(n)).join(", ")})`:"";return`Variable attribute used in ${e.usedByCallCount}/${t} calls (${a}%)${o}. Empty for calls that don't use this attribute.`}}const ns=new dc;class cc{isAuthField(e){return e==="request"}sanitizeFieldValue(e,t,a,o){return!t||t.length===0?t:(t.length,this.isAuthField(e),a.id,e==="request"?this.sanitizeRequestField(t,a,o):t)}sanitizeRequestField(e,t,a){try{const o=JSON.parse(e),n=this.getProviderIdForCall(t,a);if(!n)return t.id,this.sanitizeGenericRequest(e);t.id;const u=xs(o,n);return JSON.stringify(u,null,2)}catch(o){return o instanceof Error?o.message:String(o),t.id,"[MALFORMED_REQUEST_JSON_REDACTED_FOR_SAFETY]"}}sanitizeGenericRequest(e){try{const t=JSON.parse(e);if(t.headers){const a={...t.headers},o=["authorization","api-key","x-api-key","bearer","x-auth-token"];for(const[n,u]of Object.entries(a)){const p=n.toLowerCase();o.some(c=>p.includes(c))&&(a[n]=`${String(u).substring(0,8)}...REDACTED`)}t.headers=a}return JSON.stringify(t,null,2)}catch(t){return t instanceof Error?t.message:String(t),"[REQUEST_JSON_PARSE_FAILED_REDACTED]"}}getProviderIdForCall(e,t){try{return t.configurations[e.configurationIndex]?.provider||null}catch(a){return a instanceof Error?a.message:String(a),e.id,null}}getFieldsRequiringSanitization(){return["request"]}createSanitizationSummary(e){const t=e.filter(a=>this.isAuthField(a));return{sanitizationEnabled:t.length>0,sanitizedFields:t}}}const At=new cc;class pc{extractFieldValue(e,t,a){if(t.startsWith("param_"))return this.extractParameterValue(e,t,a);if(t.startsWith("var_"))return e.id,e.variables,this.extractVariableValue(e,t);if(t.startsWith("attr_")){e.id,e.variableAttributes;const n=this.extractAttributeValue(e,t);return e.id,n}if(t.startsWith("source_"))return this.extractSourceValue(e,t,a);const o=this.extractRawFieldValue(e,t,a);return At.isAuthField(t)?(e.id,At.sanitizeFieldValue(t,o,e,a)):o}extractRawFieldValue(e,t,a){switch(t){case"id":return e.id;case"order":return String(e.order);case"status":return e.status;case"created":return e.created.toISOString();case"completed":return e.completed?.toISOString()||"";case"configuration":return this.getConfigurationName(e,a);case"provider":return a.configurations[e.configurationIndex]?.provider||"";case"modelId":return a.configurations[e.configurationIndex]?.modelId||"";case"parameters":return this.getParametersJson(e,a);case"prompt":return e.prompt;case"variables":return JSON.stringify(e.variables||{});case"response":return e.result?.content||"";case"parsedResponse":return JSON.stringify(e.result?.parsedContent||{});case"latency":return String(e.response?.latencyMs||e.result?.latency||"");case"promptTokens":return String(e.result?.usage?.prompt_tokens||"");case"completionTokens":return String(e.result?.usage?.completion_tokens||"");case"totalTokens":return String(e.result?.usage?.total_tokens||"");case"request":return JSON.stringify(e.request||{});case"response_raw":return JSON.stringify(e.response||{});case"error":return e.result?.error||"";case"repeatIndex":return String(e.repeatIndex||"");case"cost":return e.cost!==void 0?String(e.cost):this.calculateCost(e,a);default:return`UNKNOWN_FIELD: ${t}`}}extractMultipleFields(e,t,a){const o={};return t.forEach(n=>{o[n]=this.extractFieldValue(e,n,a)}),o}getFieldDefinitions(e,t){const a=this.getStandardFieldDefinitions(),o=Ue.discoverAllParameters(e),n=t?ns.discoverAllVariables(e,t):[];return[...a,...o,...n]}getStandardFieldDefinitions(){return[{id:"id",name:"Call ID",description:"Unique identifier for the API call",group:"basic",dataType:"string",isRequired:!0},{id:"order",name:"Order",description:"Execution order of the API call within the trial",group:"basic",dataType:"number",isRequired:!0},{id:"status",name:"Status",description:"Current status of the API call (pending, running, completed, failed, cancelled)",group:"basic",dataType:"string",isRequired:!0},{id:"created",name:"Created Time",description:"When the API call was created (ISO timestamp)",group:"basic",dataType:"date",isRequired:!0},{id:"completed",name:"Completed Time",description:"When the API call was completed (ISO timestamp, empty if not completed)",group:"basic",dataType:"date",isRequired:!1},{id:"configuration",name:"Configuration",description:"Configuration name or model ID used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"provider",name:"Provider",description:"LLM provider used (e.g., openai-chat, anthropic, ollama)",group:"configuration",dataType:"string",isRequired:!0},{id:"modelId",name:"Model ID",description:"Specific model identifier used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"prompt",name:"Prompt",description:"The input prompt sent to the model",group:"content",dataType:"string",isRequired:!0},{id:"response",name:"Response",description:"The text response from the model",group:"content",dataType:"string",isRequired:!1},{id:"parsedResponse",name:"Parsed Response",description:"Structured/parsed response data (JSON)",group:"content",dataType:"json",isRequired:!1},{id:"latency",name:"Latency (ms)",description:"Response time in milliseconds",group:"performance",dataType:"number",isRequired:!1},{id:"promptTokens",name:"Prompt Tokens",description:"Number of tokens in the input prompt",group:"performance",dataType:"number",isRequired:!1},{id:"completionTokens",name:"Completion Tokens",description:"Number of tokens in the model response",group:"performance",dataType:"number",isRequired:!1},{id:"totalTokens",name:"Total Tokens",description:"Total tokens used (prompt + completion)",group:"performance",dataType:"number",isRequired:!1},{id:"request",name:"Full Request",description:"Complete API request sent to the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"response_raw",name:"Raw Response",description:"Full API response from the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"error",name:"Error Details",description:"Error message if the call failed",group:"technical",dataType:"string",isRequired:!1},{id:"repeatIndex",name:"Repeat Index",description:"Index for repeated calls (empty for single calls)",group:"technical",dataType:"number",isRequired:!1},{id:"cost",name:"Cost (USD)",description:"Calculated cost of the API call based on token usage",group:"performance",dataType:"number",isRequired:!1}]}validateFields(e,t){const o=this.getFieldDefinitions(e).map(p=>p.id),n=[],u=[];return t.forEach(p=>{o.includes(p)?n.push(p):u.push(p)}),{validFields:n,invalidFields:u,availableFields:o}}extractParameterValue(e,t,a){const o=t.replace("param_",""),n=a.configurations[e.configurationIndex];if(!n||!n.parameters)return"";const u=n.parameters[o];return u==null?"":typeof u=="object"?JSON.stringify(u):String(u)}getConfigurationName(e,t){const a=t.configurations[e.configurationIndex];return a?a.modelId||`Config ${e.configurationIndex+1}`:`Config ${e.configurationIndex+1}`}getParametersJson(e,t){const a=t.configurations[e.configurationIndex];return!a||!a.parameters?"{}":JSON.stringify(a.parameters)}extractVariableValue(e,t){const a=t.replace("var_","");if(!e.variables||typeof e.variables!="object")return"";const o=e.variables[a];return o==null?"":typeof o=="object"?JSON.stringify(o):String(o)}extractAttributeValue(e,t){const a=t.replace("attr_","").split("_");if(a.length<2)return"";const o=a[0],n=a.slice(1).join("_");if(!e.variableAttributes||typeof e.variableAttributes!="object")return"";const u=e.variableAttributes[o];if(!u||typeof u!="object")return"";const p=u[n];return p==null?"":typeof p=="object"?JSON.stringify(p):String(p)}extractSourceValue(e,t,a){const o=t.replace("source_","").split("_");if(o.length<2)return"";const n=o[o.length-1],u=o.slice(0,-1).join("_");if(!e.variableIndices||typeof e.variableIndices!="object")return"";const p=e.variableIndices[u];if(p==null)return"";if(n==="index")return String(p);if(n==="list"){if(a.type==="template"&&a.templateConfig?.variables){const c=a.templateConfig.variables[u];if(c&&"snapshot"in c&&c.snapshot?.source?.listName)return c.snapshot.source.listName;if(c?.listId)return c.listId}return""}return""}calculateCost(e,t){if(!e.result?.usage)return"0";const a=t.configurations[e.configurationIndex];if(!a)return"0";const o=a.modelSnapshot;if(!o)return"0";const n=e.result.usage.prompt_tokens,u=e.result.usage.completion_tokens,p=$t(n,o.capabilities?.inputCostPerToken),c=$t(u,o.capabilities?.outputCostPerToken);if(p===null||c===null)return"N/A";const m=p+c;return As(m).replace("$","")}}const ve=new pc;class fc{getMimeType(e){switch(e){case"csv":return"text/csv";case"excel":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"tsv":return"text/tab-separated-values";case"json":return"application/json";case"jsonl":return"application/x-jsonlines";case"python":return"text/x-python";case"zip":return"application/zip";default:return"application/octet-stream"}}getFileExtension(e){switch(e){case"csv":return"csv";case"excel":return"xlsx";case"tsv":return"tsv";case"json":return"json";case"jsonl":return"jsonl";case"python":return"py";case"zip":return"zip";default:return"bin"}}generateFilename(e,t,a){const o=this.sanitizeFilename(e),u=(a||new Date).toISOString().split("T")[0],p=this.getFileExtension(t);return`${o}_${t}_${u}.${p}`}estimateFileSize(e,t,a,o=50){let n=e*t*o;switch(a){case"json":n*=2.5;break;case"jsonl":n*=2.2;break;case"csv":n*=1.3;break;case"excel":n*=.8;break;case"tsv":n*=1.1;break;case"python":n=Math.max(n*1.5,5e3);break}return Math.round(n)}formatFileSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:`${(e/(1024*1024*1024)).toFixed(1)} GB`}createDownloadBlob(e,t,a=!1){let o=e;return a&&(o="\uFEFF"+o),new Blob([o],{type:t})}createDownloadBlobFromBase64(e,t){const a=atob(e),o=new Uint8Array(a.length);for(let n=0;n<a.length;n++)o[n]=a.charCodeAt(n);return new Blob([o],{type:t})}triggerDownload(e,t){const a=URL.createObjectURL(e),o=document.createElement("a");o.href=a,o.download=t,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(a),100)}downloadFile(e,t,a,o=!1){const n=this.getMimeType(t),u=this.generateFilename(a,t);let p;t==="excel"?p=this.createDownloadBlobFromBase64(e,n):p=this.createDownloadBlob(e,n,o),this.triggerDownload(p,u)}sanitizeFilename(e){return e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_+/g,"_").substring(0,50).replace(/^_+|_+$/g,"")||"trial"}}const ue=new fc;class mc{validateFormat(e){const t=["csv","tsv","excel","json","jsonl","python"];return t.includes(e)?{isValid:!0,errors:[],warnings:[]}:{isValid:!1,errors:[`Invalid format: ${e}. Supported formats: ${t.join(", ")}`],warnings:[]}}validateFields(e,t,a){if(!t||t.length===0)return{isValid:!1,errors:["No fields selected for export"],warnings:[],unknownFields:[],supportedFields:ve.getFieldDefinitions(e,a).map(m=>m.id)};const o=ve.validateFields(e,t),n=o.invalidFields.filter(m=>!m.startsWith("var_")&&!m.startsWith("attr_")),u={isValid:n.length===0,errors:[],warnings:[],unknownFields:n,supportedFields:o.availableFields};n.length>0&&u.errors.push(`Unknown fields requested: ${n.join(", ")}`),(t.includes("request")||t.includes("response_raw"))&&u.warnings.push("Technical fields (request, response_raw) contain large JSON objects and may significantly increase file size");const p=t.filter(m=>m.startsWith("param_"));p.length>10&&u.warnings.push(`Large number of parameter fields selected (${p.length}). This may result in a very wide export file with many empty cells.`);const c=t.filter(m=>m.startsWith("var_"));return c.length>10&&u.warnings.push(`Large number of variable fields selected (${c.length}). This may result in a very wide export file with many empty cells.`),u}validateExportSize(e,t,a){const o=ue.estimateFileSize(e,t,a),n=o/(1024*1024),u={isValid:!0,errors:[],warnings:[]};return n>500?(u.isValid=!1,u.errors.push(`Export too large: ${ue.formatFileSize(o)}. Maximum allowed: 500MB. Consider reducing the number of fields or using filters.`)):n>100&&u.warnings.push(`Large export: ${ue.formatFileSize(o)}. This may take several minutes to generate and download.`),e>1e5&&u.warnings.push(`Large number of records: ${e.toLocaleString()}. Export generation may take several minutes.`),t>50&&u.warnings.push(`Large number of fields: ${t}. Resulting file will be very wide and may be difficult to work with in spreadsheet applications.`),u}validateExportOptions(e,t,a){const o=[],n=[],u=this.validateFormat(t.format);if(u.isValid||o.push(...u.errors),t.fields){const p=this.validateFields(e,t.fields,a);p.isValid||o.push(...p.errors),n.push(...p.warnings);const c=this.validateExportSize(e.progress?.total||0,t.fields.length,t.format);c.isValid||o.push(...c.errors),n.push(...c.warnings)}return t.format==="python"&&t.fields&&t.fields.length>0&&n.push("Field selection is ignored for Python exports. Python scripts include all available data."),{isValid:o.length===0,errors:o,warnings:n}}getRecommendedFields(e){const t=["order","status","configuration","prompt","response","latency"],a=ve.getFieldDefinitions(e).filter(u=>u.group==="parameters").map(u=>u.id),o=["param_temperature","param_max_tokens","param_top_p"],n=a.filter(u=>o.includes(u));return[...t,...n]}}const tt=new mc;class Ve{validateOptions(e){const t=[],a=[];e.fields&&e.fields.length===0&&t.push("At least one field must be selected");const o=this.getFormatInfo();return e.includeHeaders&&!o.supportsHeaders&&a.push(`${o.name} format does not support headers - ignoring includeHeaders option`),e.addBOM&&!o.supportsBOM&&a.push(`${o.name} format does not support BOM - ignoring addBOM option`),{isValid:t.length===0,errors:t,warnings:a}}prepareFieldList(e,t){if(t&&t.length>0){const p=t.filter(h=>h.startsWith("var_")),c=t.filter(h=>h.startsWith("attr_")),m=t.filter(h=>!h.startsWith("var_")&&!h.startsWith("attr_")),g=ve.validateFields(e,m);return g.invalidFields.length>0&&P.warn("Invalid fields requested:",g.invalidFields),[...g.validFields,...p,...c]}const a=["id","order","status","configuration","provider","modelId","prompt","response","latency"],o=Ue.discoverAllParameters(e),n=["param_temperature","param_max_tokens","param_top_p"],u=o.filter(p=>n.includes(p.id)).map(p=>p.id);return[...a,...u]}prepareDataRows(e,t,a){return e.map(o=>t.map(n=>ve.extractFieldValue(o,n,a)))}prepareHeaderRow(e){return e.map(t=>t.startsWith("param_")?`param_${t.replace("param_","")}`:t.replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase()).trim())}hasParameterFields(e){return e.some(t=>t.startsWith("param_"))}escapeFieldValue(e){return e==null?"":String(e)}}class vc extends Ve{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=[];if(a.includeHeaders!==!1){const m=this.prepareHeaderRow(o).map(g=>this.escapeCSVValue(g)).join(",");n.push(m)}this.prepareDataRows(e,o,t).forEach(c=>{const m=c.map(g=>this.escapeCSVValue(g)).join(",");n.push(m)});let p=n.join(`
`);return a.addBOM&&(p="\uFEFF"+p),p}getFormatInfo(){return{name:"CSV",description:"Comma-separated values format, compatible with Excel and other spreadsheet applications",mimeType:"text/csv",extension:"csv",supportsHeaders:!0,supportsBOM:!0}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];if(e.fields&&e.fields.length>30&&a.push("Large number of columns may make the CSV difficult to work with in spreadsheet applications"),e.fields){const o=["variables","parsedResponse","request","response_raw"];e.fields.some(u=>o.includes(u))&&a.push("JSON fields (variables, parsedResponse, request, response_raw) may not display well in spreadsheet applications")}return{...t,warnings:a}}escapeCSVValue(e){if(e==null)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes(`
`)||t.includes("\r")?`"${t.replace(/"/g,'""')}"`:t}}class gc extends Ve{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=[];if(a.includeHeaders!==!1){const c=this.prepareHeaderRow(o).map(m=>this.escapeTSVValue(m)).join("	");n.push(c)}return this.prepareDataRows(e,o,t).forEach(p=>{const c=p.map(m=>this.escapeTSVValue(m)).join("	");n.push(c)}),n.join(`
`)}getFormatInfo(){return{name:"TSV",description:"Tab-separated values format, useful for data analysis tools and database imports",mimeType:"text/tab-separated-values",extension:"tsv",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return a.push("TSV format may not be directly supported by all spreadsheet applications"),{...t,warnings:a}}escapeTSVValue(e){return e==null?"":String(e).replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}}class hc extends Ve{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=Ze.book_new(),u=[];if(a.includeHeaders!==!1){const h=this.prepareHeaderRow(o);u.push(h)}const p=this.prepareDataRows(e,o,t);u.push(...p);const c=Ze.aoa_to_sheet(u),m=this.calculateColumnWidths(u);return c["!cols"]=m,Ze.book_append_sheet(n,c,"Export Data"),fa(n,{type:"base64",bookType:"xlsx",compression:!0})}getFormatInfo(){return{name:"Excel",description:"Microsoft Excel .xlsx format with proper formatting and auto-sized columns",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",extension:"xlsx",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.fields&&e.fields.length>16384&&a.push("Excel has a limit of 16,384 columns - some fields may not display correctly"),e.addBOM&&a.push("Excel .xlsx format is binary - ignoring addBOM option"),a.push("Excel format provides native spreadsheet functionality with auto-sized columns"),{...t,warnings:a}}calculateColumnWidths(e){if(e.length===0)return[];const t=Math.max(...e.map(o=>o.length)),a=[];for(let o=0;o<t;o++){let n=10;for(const u of e)if(u[o]!==void 0){const p=String(u[o]).length;n=Math.max(n,Math.min(p*1.2,50))}a.push({wch:n})}return a}}class yc extends Ve{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n={metadata:{trialId:t.id,trialName:t.name,trialType:t.type,exportDate:new Date().toISOString(),recordCount:e.length,fieldCount:o.length,hasParameterFields:this.hasParameterFields(o)},trial:{id:t.id,name:t.name,description:t.description,type:t.type,status:t.status,created:t.created.toISOString(),configurations:t.configurations.map((u,p)=>({index:p,provider:u.provider,modelId:u.modelId,parameters:u.parameters||{}}))},fields:o.map(u=>{const p=ve.getFieldDefinitions(t).find(c=>c.id===u);return{id:u,name:p?.name||u,description:p?.description||"",group:p?.group||"unknown",dataType:p?.dataType||"string"}}),apiCalls:e.map(u=>{const p={};return o.forEach(c=>{const m=ve.extractFieldValue(u,c,t);p[c]=this.parseJSONValue(m,c)}),p})};return JSON.stringify(n,null,2)}getFormatInfo(){return{name:"JSON",description:"JavaScript Object Notation format with complete trial metadata and structured data",mimeType:"application/json",extension:"json",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSON format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSON format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("Large number of fields in JSON format may result in large file sizes and memory usage"),{...t,warnings:a}}parseJSONValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const n=Number(e);return isNaN(n)?null:n}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const n=Number(e);if(!isNaN(n))return n;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return e}}class bc extends Ve{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=[];return e.forEach(u=>{const p={};o.forEach(c=>{const m=ve.extractFieldValue(u,c,t);p[c]=this.parseJSONLValue(m,c)}),n.push(JSON.stringify(p))}),n.join(`
`)}getFormatInfo(){return{name:"JSONL",description:"JSON Lines format with one JSON object per line, ideal for streaming and big data processing",mimeType:"application/x-jsonlines",extension:"jsonl",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSONL format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSONL format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("JSONL format handles large datasets well, but many fields may impact readability"),{...t,warnings:a}}parseJSONLValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const u=Number(e);return isNaN(u)?null:u}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const u=Number(e);if(!isNaN(u))return u;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return["created","completed"].includes(t),e}}function _c(l){switch(l){case"csv":return new vc;case"tsv":return new gc;case"excel":return new hc;case"json":return new yc;case"jsonl":return new bc;default:throw new Error(`Unsupported format: ${l}`)}}class Tc{async exportTrialData(e,t){const a=Date.now();t.format;try{const o=await De.loadTrialForExport(e);if(!o.ok){const T=o.error;return{ok:!1,error:new de("GENERATION_FAILED",`Failed to load trial data: ${T.message}`,{trialId:e,originalError:T})}}const{trial:n,apiCalls:u}=o.value;t.format;const p=await this.validateExportOptions(e,t,u);if(!p.ok){const T=p.error;return{ok:!1,error:new de("GENERATION_FAILED",`Validation failed: ${T.message}`,{trialId:e,options:t,originalError:T})}}if(!p.value.isValid)return{ok:!1,error:new de("INVALID_FIELDS",`Export validation failed: ${p.value.errors.join(", ")}`,{errors:p.value.errors})};t.format;const c=_c(t.format);t.format,u.length,t.fields?.length,t.fields,t.fields?.filter(T=>T.startsWith("param_")),t.fields?.filter(T=>T.startsWith("var_")),t.fields?.filter(T=>T.startsWith("attr_"));const m=Date.now(),g=await c.generate(u,n,t);Date.now()-m,g.length,xt(g);const h=t.fields||[],$=Date.now()-a,I={filename:ue.generateFilename(n.name,t.format),mimeType:c.getFormatInfo().mimeType,data:g,metadata:{trialName:n.name,trialId:n.id,exportDate:new Date,callCount:u.length,fieldCount:h.length,format:t.format,estimatedSizeBytes:xt(g)},format:t.format,recordCount:u.length,fieldCount:h.length,hasParameterFields:h.some(T=>T.startsWith("param_")),generationTimeMs:$};return t.format,I.filename,I.metadata.estimatedSizeBytes,I.generationTimeMs,{ok:!0,value:I}}catch(o){const n=o instanceof Error?o:new Error(String(o));return n.message,n.stack,n.name,n.constructor.name,t.format,Date.now()-a,{ok:!1,error:new de("GENERATION_FAILED",`Export generation failed: ${n.message}`,{trialId:e,options:t,originalError:o,generationTimeMs:Date.now()-a})}}}async previewExport(e,t){try{const a=await De.loadTrialForExport(e);if(!a.ok){const $=a.error;return{ok:!1,error:new de("GENERATION_FAILED",`Failed to load trial data: ${$.message}`,{trialId:e,originalError:$})}}const{trial:o,apiCalls:n}=a.value,u=ve.getFieldDefinitions(o),p=Ue.discoverAllParameters(o),c=t.fields||this.getDefaultFields(o),m=t.format||"csv",g=ue.estimateFileSize(n.length,c.length,m);return{ok:!0,value:{fieldCount:c.length,recordCount:n.length,estimatedSizeBytes:g,availableFields:u,parameterFields:p}}}catch(a){return{ok:!1,error:new de("GENERATION_FAILED",`Preview generation failed: ${a instanceof Error?a.message:"Unknown error"}`,{trialId:e,options:t,originalError:a})}}}async getAvailableFields(e){try{const t=await De.loadTrialForExport(e);if(!t.ok){const m=t.error;return{ok:!1,error:new de("GENERATION_FAILED",`Failed to load trial data: ${m.message}`,{trialId:e,originalError:m})}}const{trial:a,apiCalls:o}=t.value,n=ve.getStandardFieldDefinitions(),u=Ue.discoverAllParameters(a),p=ns.discoverAllVariables(a,o),c=tt.getRecommendedFields(a);return{ok:!0,value:{standardFields:n,parameterFields:u,variableFields:p,recommendedFields:c}}}catch(t){return{ok:!1,error:new de("GENERATION_FAILED",`Field discovery failed: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateExportOptions(e,t,a){try{const o=await De.loadTrialForExport(e);if(!o.ok){const p=o.error;return{ok:!1,error:new de("GENERATION_FAILED",`Failed to load trial data: ${p.message}`,{trialId:e,originalError:p})}}const{trial:n}=o.value;return{ok:!0,value:tt.validateExportOptions(n,t,a)}}catch(o){return{ok:!1,error:new de("GENERATION_FAILED",`Validation failed: ${o instanceof Error?o.message:"Unknown error"}`,{trialId:e,options:t,originalError:o})}}}getDefaultFields(e){return tt.getRecommendedFields(e)}}const ut=new Tc;let dt=null,ct=null,ze=!1;try{typeof window<"u"&&("__TAURI__"in window||"__TAURI_INTERNALS__"in window)&&(ze=!0)}catch{}async function $c(){if(!ze)return!1;try{return dt||(dt=await Ie(()=>import("./tauri-vendor-DvKxkFnM.js").then(l=>l.b),[])),ct||(ct=await Ie(()=>import("./tauri-vendor-DvKxkFnM.js").then(l=>l.c),[])),!0}catch(l){return P.warn("Failed to load Tauri modules:",l),ze=!1,!1}}class os{async downloadFile(e,t,a,o=!1){await this.useTauriSaveDialog(e,t,a,o)||this.useBrowserDownload(e,t,a,o)}async useTauriSaveDialog(e,t,a,o){if(!await $c())return!1;try{const n=ue.generateFilename(a,t),u=ue.getFileExtension(t),p=await dt.save({defaultPath:n,filters:[{name:this.getFilterName(t),extensions:[u]}],title:`Save ${this.getFilterName(t)} File`});if(!p)return!0;let c;if(typeof e=="string"){const m=o?"\uFEFF"+e:e;c=new TextEncoder().encode(m)}else c=e;return await ct.writeFile(p,c),`${p}`,!0}catch(n){return P.error("Tauri save dialog error:",n),!1}}useBrowserDownload(e,t,a,o){if(e instanceof Uint8Array&&(t==="zip"||t==="excel")){const h=ue.getMimeType(t),$=ue.generateFilename(a,t),I=new Blob([e],{type:h}),T=window.URL.createObjectURL(I),C=document.createElement("a");C.href=T,C.download=$,document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(T);return}e instanceof Uint8Array&&(e=new TextDecoder().decode(e));const n=ue.getMimeType(t),u=ue.generateFilename(a,t),p=o?"\uFEFF"+e:e,c=new Blob([p],{type:n}),m=window.URL.createObjectURL(c),g=document.createElement("a");g.href=m,g.download=u,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(m)}async downloadExcelFile(e,t){const a=atob(e),o=new Uint8Array(a.length);for(let n=0;n<a.length;n++)o[n]=a.charCodeAt(n);await this.downloadFile(o,"excel",t,!1)}getFilterName(e){switch(e){case"csv":return"CSV";case"excel":return"Excel";case"tsv":return"TSV";case"json":return"JSON";case"jsonl":return"JSON Lines";case"python":return"Python Script";case"zip":return"ZIP Archive";default:return"Binary"}}isInTauri(){return ze}generateFilename(e,t,a){return ue.generateFilename(e,t,a)}getMimeType(e){return ue.getMimeType(e)}getFileExtension(e){return ue.getFileExtension(e)}estimateFileSize(e,t,a,o=50){return ue.estimateFileSize(e,t,a,o)}formatFileSize(e){return ue.formatFileSize(e)}}const Be=new os,Cc=Object.freeze(Object.defineProperty({__proto__:null,TauriDownloadUtilities:os,tauriDownloadUtilities:Be},Symbol.toStringTag,{value:"Module"})),kc={class:"export-content"},wc={class:"section"},Sc={key:0,class:"section"},Ic={class:"bundle-info"},Ec={key:0},Rc={key:1,class:"section"},Fc={class:"field-actions"},Pc={class:"field-groups"},xc={class:"field-group"},Ac={class:"field-list"},Vc={class:"field-group"},Oc={class:"field-list"},Dc={class:"field-group"},Nc={class:"field-list"},Lc={class:"field-group"},Mc={class:"field-list"},Uc={class:"field-group"},zc={class:"field-list"},Bc={key:0,class:"field-group"},jc={class:"field-list"},Wc={key:1,class:"field-group"},Hc={class:"field-list"},qc={class:"section"},Gc={class:"preview-info"},Jc={class:"info-item"},Xc={class:"value"},Kc={class:"info-item"},Qc={class:"value"},Yc={class:"info-item"},Zc={class:"value"},ep={class:"export-actions"},tp=oe({__name:"ExportDataModalV3",props:{visible:{type:Boolean},trial:{}},emits:["update:visible"],setup(l,{emit:e}){const t=l,a=e,o=q("csv"),n=q(["order","status","configuration","prompt","response","latency"]),u=q(!1),p=q("draft"),c=q({}),m=q([]),g=q([]),h=q([]),$=["order","status","configuration","prompt","response","latency"],I=q([]),T=["id","order","status","created","completed","configuration","provider","modelId","parameters","prompt","variables","response","parsedResponse","latency","promptTokens","completionTokens","totalTokens","cost","request","response_raw","error","repeatIndex"],C=U(()=>{const S=t.trial.progress?.completed||0,r=t.trial.progress?.failed||0;return S+r}),N=U(()=>{const r=n.value.length*50*C.value;return r<1024?`${r} B`:r<1024*1024?`${(r/1024).toFixed(1)} KB`:`${(r/(1024*1024)).toFixed(1)} MB`});function H(){I.value.length,I.value.forEach(B=>{c.value[B]=!1}),$.forEach(B=>{c.value[B]=!0});const S=g.value.map(B=>B.id),r=h.value.map(B=>B.id);S.forEach(B=>{c.value[B]=!0}),r.forEach(B=>{c.value[B]=!0}),$.length,S.length,r.length,$.length+S.length+r.length,V()}function V(){n.value=I.value.filter(S=>c.value[S])}function E(S,r){c.value[S]=r,V()}function w(){I.value.forEach(S=>{c.value[S]=!0}),V()}function z(){I.value.forEach(B=>{c.value[B]=!1}),$.forEach(B=>{c.value[B]=!0});const S=g.value.map(B=>B.id),r=h.value.map(B=>B.id);S.forEach(B=>{c.value[B]=!0}),r.forEach(B=>{c.value[B]=!0}),V()}function f(){I.value.forEach(S=>{c.value[S]=!1}),V()}function i(){a("update:visible",!1)}async function O(){if(o.value==="bundle"){u.value=!0;try{const{trialBundleExportService:S}=await Ie(async()=>{const{trialBundleExportService:x}=await import("./trial-bundle.service-DAmw5b9V.js");return{trialBundleExportService:x}},__vite__mapDeps([0,1,2,3,4,5,6])),r=p.value==="completed",B=await S.exportTrialBundle(t.trial.id,{includeResults:r,includeApiCalls:r,format:"json"});B.ok?(Z.success(`Trial bundle exported: ${B.value.filename}`),a("update:visible",!1)):Z.error(`Bundle export failed: ${B.error.message}`)}catch(S){Z.error(`Bundle export failed: ${S instanceof Error?S.message:"Unknown error"}`)}finally{u.value=!1}return}if(n.value.length===0){Z.warning("Please select at least one field to export");return}u.value=!0;try{const S={format:o.value,fields:n.value,includeHeaders:!0,addBOM:o.value==="excel"||o.value==="csv"},r=await ut.exportTrialData(t.trial.id,S);r.ok?(S.format==="excel"&&typeof r.value.data=="string"?await Be.downloadExcelFile(r.value.data,r.value.metadata.trialName):await Be.downloadFile(r.value.data,S.format,r.value.metadata.trialName,S.addBOM),Z.success("Export completed successfully"),a("update:visible",!1)):Z.error(`Export failed: ${r.error.message}`)}catch(S){Z.error("Export failed: "+S.message)}finally{u.value=!1}}return me(async()=>{t.trial.id;const S=await ut.getAvailableFields(t.trial.id);if(S.ok){m.value=S.value.standardFields,g.value=S.value.parameterFields,h.value=(S.value.variableFields||[]).filter(_=>!_.id.startsWith("source_"));const r=S.value.standardFields.map(_=>_.id).filter(_=>_!=="parameters"&&_!=="variables"),B=S.value.parameterFields.map(_=>_.id),x=h.value.map(_=>_.id);I.value=[...r,...B,...x],S.value.standardFields.length,S.value.parameterFields.length,(S.value.variableFields||[]).length,I.value.length,S.value.parameterFields.map(_=>_.id),(S.value.variableFields||[]).map(_=>_.id),I.value}else S.error,I.value=[...T];H()}),(S,r)=>{const B=oa,x=gt,_=ht,L=pe,A=Jt,X=Te;return d(),Q(X,{visible:S.visible,"onUpdate:visible":r[46]||(r[46]=y=>S.$emit("update:visible",y)),title:"Export Trial Data",width:800,footer:null,"destroy-on-close":!0,class:"export-data-modal"},{default:F(()=>[s("div",kc,[s("div",wc,[r[53]||(r[53]=s("h4",null,"Export Format",-1)),k(x,{value:o.value,"onUpdate:value":r[0]||(r[0]=y=>o.value=y),class:"format-options"},{default:F(()=>[k(B,{value:"csv"},{default:F(()=>r[47]||(r[47]=[D("CSV")])),_:1,__:[47]}),k(B,{value:"tsv"},{default:F(()=>r[48]||(r[48]=[D("TSV")])),_:1,__:[48]}),k(B,{value:"excel"},{default:F(()=>r[49]||(r[49]=[D("Excel")])),_:1,__:[49]}),k(B,{value:"json"},{default:F(()=>r[50]||(r[50]=[D("JSON")])),_:1,__:[50]}),k(B,{value:"jsonl"},{default:F(()=>r[51]||(r[51]=[D("JSONL")])),_:1,__:[51]}),k(B,{value:"bundle"},{default:F(()=>r[52]||(r[52]=[D("Auditomatic Trial Format")])),_:1,__:[52]})]),_:1},8,["value"])]),o.value==="bundle"?(d(),v("div",Sc,[r[64]||(r[64]=s("h4",null,"Auditomatic Trial Format",-1)),s("div",Ic,[r[61]||(r[61]=s("p",{style:{"margin-bottom":"16px",color:"var(--color-text-secondary)"}}," Export your trial in Auditomatic's native format to recreate the exact trial on another browser or computer. Perfect for sharing experiments with collaborators or backing up your work. ",-1)),k(x,{value:p.value,"onUpdate:value":r[1]||(r[1]=y=>p.value=y),style:{"margin-bottom":"16px"}},{default:F(()=>[k(_,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:F(()=>r[54]||(r[54]=[s("strong",null,"Export as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Trial configuration only - recreate the trial setup and run a fresh experiment ",-1)])),_:1,__:[54]}),k(_,{value:"completed",style:{display:"block"}},{default:F(()=>r[55]||(r[55]=[s("strong",null,"Export with Results",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Complete trial with all execution results - review past experiments or continue where you left off ",-1)])),_:1,__:[55]})]),_:1},8,["value"]),r[62]||(r[62]=s("p",null,"The exported file contains:",-1)),s("ul",null,[r[56]||(r[56]=s("li",null,"✅ Complete trial configuration",-1)),r[57]||(r[57]=s("li",null,"✅ Template with metadata",-1)),r[58]||(r[58]=s("li",null,"✅ All variable lists",-1)),r[59]||(r[59]=s("li",null,"✅ Model configurations",-1)),p.value==="completed"?(d(),v("li",Ec,"✅ Execution results and API calls")):R("",!0),r[60]||(r[60]=s("li",null,"✅ Variable index tracking for lineage",-1))]),r[63]||(r[63]=s("p",{style:{"margin-top":"12px"}},[s("strong",null,"To import:"),D(' Use the "Import Trial" button on the Trials page to load this file on any Auditomatic instance. ')],-1))])])):(d(),v("div",Rc,[r[97]||(r[97]=s("h4",null,"Fields to Export",-1)),s("div",Fc,[k(L,{size:"small",onClick:w},{default:F(()=>r[65]||(r[65]=[D("Select All")])),_:1,__:[65]}),k(L,{size:"small",onClick:z},{default:F(()=>r[66]||(r[66]=[D("Select Defaults")])),_:1,__:[66]}),k(L,{size:"small",onClick:f},{default:F(()=>r[67]||(r[67]=[D("Clear All")])),_:1,__:[67]})]),s("div",Pc,[s("div",xc,[r[73]||(r[73]=s("h5",null,"Basic Information",-1)),s("div",Ac,[k(A,{checked:c.value.id,"onUpdate:checked":r[2]||(r[2]=y=>c.value.id=y),onChange:r[3]||(r[3]=y=>E("id",y.target.checked))},{default:F(()=>r[68]||(r[68]=[D("Call ID")])),_:1,__:[68]},8,["checked"]),k(A,{checked:c.value.order,"onUpdate:checked":r[4]||(r[4]=y=>c.value.order=y),onChange:r[5]||(r[5]=y=>E("order",y.target.checked))},{default:F(()=>r[69]||(r[69]=[D("Order")])),_:1,__:[69]},8,["checked"]),k(A,{checked:c.value.status,"onUpdate:checked":r[6]||(r[6]=y=>c.value.status=y),onChange:r[7]||(r[7]=y=>E("status",y.target.checked))},{default:F(()=>r[70]||(r[70]=[D("Status")])),_:1,__:[70]},8,["checked"]),k(A,{checked:c.value.created,"onUpdate:checked":r[8]||(r[8]=y=>c.value.created=y),onChange:r[9]||(r[9]=y=>E("created",y.target.checked))},{default:F(()=>r[71]||(r[71]=[D("Created Time")])),_:1,__:[71]},8,["checked"]),k(A,{checked:c.value.completed,"onUpdate:checked":r[10]||(r[10]=y=>c.value.completed=y),onChange:r[11]||(r[11]=y=>E("completed",y.target.checked))},{default:F(()=>r[72]||(r[72]=[D("Completed Time")])),_:1,__:[72]},8,["checked"])])]),s("div",Vc,[r[78]||(r[78]=s("h5",null,"Configuration",-1)),s("div",Oc,[k(A,{checked:c.value.configuration,"onUpdate:checked":r[12]||(r[12]=y=>c.value.configuration=y),onChange:r[13]||(r[13]=y=>E("configuration",y.target.checked))},{default:F(()=>r[74]||(r[74]=[D("Configuration Name")])),_:1,__:[74]},8,["checked"]),k(A,{checked:c.value.provider,"onUpdate:checked":r[14]||(r[14]=y=>c.value.provider=y),onChange:r[15]||(r[15]=y=>E("provider",y.target.checked))},{default:F(()=>r[75]||(r[75]=[D("Provider")])),_:1,__:[75]},8,["checked"]),k(A,{checked:c.value.modelId,"onUpdate:checked":r[16]||(r[16]=y=>c.value.modelId=y),onChange:r[17]||(r[17]=y=>E("modelId",y.target.checked))},{default:F(()=>r[76]||(r[76]=[D("Model ID")])),_:1,__:[76]},8,["checked"]),k(A,{checked:c.value.parameters,"onUpdate:checked":r[18]||(r[18]=y=>c.value.parameters=y),onChange:r[19]||(r[19]=y=>E("parameters",y.target.checked))},{default:F(()=>r[77]||(r[77]=[D("Parameters")])),_:1,__:[77]},8,["checked"])])]),s("div",Dc,[r[83]||(r[83]=s("h5",null,"Content",-1)),s("div",Nc,[k(A,{checked:c.value.prompt,"onUpdate:checked":r[20]||(r[20]=y=>c.value.prompt=y),onChange:r[21]||(r[21]=y=>E("prompt",y.target.checked))},{default:F(()=>r[79]||(r[79]=[D("Prompt")])),_:1,__:[79]},8,["checked"]),k(A,{checked:c.value.variables,"onUpdate:checked":r[22]||(r[22]=y=>c.value.variables=y),onChange:r[23]||(r[23]=y=>E("variables",y.target.checked))},{default:F(()=>r[80]||(r[80]=[D("Variables")])),_:1,__:[80]},8,["checked"]),k(A,{checked:c.value.response,"onUpdate:checked":r[24]||(r[24]=y=>c.value.response=y),onChange:r[25]||(r[25]=y=>E("response",y.target.checked))},{default:F(()=>r[81]||(r[81]=[D("Response")])),_:1,__:[81]},8,["checked"]),k(A,{checked:c.value.parsedResponse,"onUpdate:checked":r[26]||(r[26]=y=>c.value.parsedResponse=y),onChange:r[27]||(r[27]=y=>E("parsedResponse",y.target.checked))},{default:F(()=>r[82]||(r[82]=[D("Parsed Response")])),_:1,__:[82]},8,["checked"])])]),s("div",Lc,[r[89]||(r[89]=s("h5",null,"Performance",-1)),s("div",Mc,[k(A,{checked:c.value.latency,"onUpdate:checked":r[28]||(r[28]=y=>c.value.latency=y),onChange:r[29]||(r[29]=y=>E("latency",y.target.checked))},{default:F(()=>r[84]||(r[84]=[D("Latency (ms)")])),_:1,__:[84]},8,["checked"]),k(A,{checked:c.value.promptTokens,"onUpdate:checked":r[30]||(r[30]=y=>c.value.promptTokens=y),onChange:r[31]||(r[31]=y=>E("promptTokens",y.target.checked))},{default:F(()=>r[85]||(r[85]=[D("Prompt Tokens")])),_:1,__:[85]},8,["checked"]),k(A,{checked:c.value.completionTokens,"onUpdate:checked":r[32]||(r[32]=y=>c.value.completionTokens=y),onChange:r[33]||(r[33]=y=>E("completionTokens",y.target.checked))},{default:F(()=>r[86]||(r[86]=[D("Completion Tokens")])),_:1,__:[86]},8,["checked"]),k(A,{checked:c.value.totalTokens,"onUpdate:checked":r[34]||(r[34]=y=>c.value.totalTokens=y),onChange:r[35]||(r[35]=y=>E("totalTokens",y.target.checked))},{default:F(()=>r[87]||(r[87]=[D("Total Tokens")])),_:1,__:[87]},8,["checked"]),k(A,{checked:c.value.cost,"onUpdate:checked":r[36]||(r[36]=y=>c.value.cost=y),onChange:r[37]||(r[37]=y=>E("cost",y.target.checked))},{default:F(()=>r[88]||(r[88]=[D("Cost (USD)")])),_:1,__:[88]},8,["checked"])])]),s("div",Uc,[r[94]||(r[94]=s("h5",null,"Technical Details",-1)),s("div",zc,[k(A,{checked:c.value.request,"onUpdate:checked":r[38]||(r[38]=y=>c.value.request=y),onChange:r[39]||(r[39]=y=>E("request",y.target.checked))},{default:F(()=>r[90]||(r[90]=[D("Full Request")])),_:1,__:[90]},8,["checked"]),k(A,{checked:c.value.response_raw,"onUpdate:checked":r[40]||(r[40]=y=>c.value.response_raw=y),onChange:r[41]||(r[41]=y=>E("response_raw",y.target.checked))},{default:F(()=>r[91]||(r[91]=[D("Raw Response")])),_:1,__:[91]},8,["checked"]),k(A,{checked:c.value.error,"onUpdate:checked":r[42]||(r[42]=y=>c.value.error=y),onChange:r[43]||(r[43]=y=>E("error",y.target.checked))},{default:F(()=>r[92]||(r[92]=[D("Error Details")])),_:1,__:[92]},8,["checked"]),k(A,{checked:c.value.repeatIndex,"onUpdate:checked":r[44]||(r[44]=y=>c.value.repeatIndex=y),onChange:r[45]||(r[45]=y=>E("repeatIndex",y.target.checked))},{default:F(()=>r[93]||(r[93]=[D("Repeat Index")])),_:1,__:[93]},8,["checked"])])]),g.value.length>0?(d(),v("div",Bc,[r[95]||(r[95]=s("h5",null,"Parameters (Individual Columns)",-1)),s("div",jc,[(d(!0),v(Y,null,ee(g.value,y=>(d(),Q(A,{key:y.id,checked:c.value[y.id],"onUpdate:checked":W=>c.value[y.id]=W,onChange:W=>E(y.id,W.target.checked)},{default:F(()=>[D(b(y.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):R("",!0),h.value.length>0?(d(),v("div",Wc,[r[96]||(r[96]=s("h5",null,"Attributes (Individual Columns)",-1)),s("div",Hc,[(d(!0),v(Y,null,ee(h.value,y=>(d(),Q(A,{key:y.id,checked:c.value[y.id],"onUpdate:checked":W=>c.value[y.id]=W,onChange:W=>E(y.id,W.target.checked)},{default:F(()=>[D(b(y.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):R("",!0)])])),s("div",qc,[r[101]||(r[101]=s("h4",null,"Export Preview",-1)),s("div",Gc,[s("div",Jc,[r[98]||(r[98]=s("span",{class:"label"},"Records:",-1)),s("span",Xc,b(C.value),1)]),s("div",Kc,[r[99]||(r[99]=s("span",{class:"label"},"Fields:",-1)),s("span",Qc,b(n.value.length),1)]),s("div",Yc,[r[100]||(r[100]=s("span",{class:"label"},"Estimated Size:",-1)),s("span",Zc,b(N.value),1)])])]),s("div",ep,[k(L,{onClick:i},{default:F(()=>r[102]||(r[102]=[D("Cancel")])),_:1,__:[102]}),k(L,{type:"primary",onClick:O,loading:u.value,disabled:n.value.length===0},{default:F(()=>[k(j(Kt)),r[103]||(r[103]=D(" Export "))]),_:1,__:[103]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),sp=re(tp,[["__scopeId","data-v-8229d46c"]]),ap={class:"trial-details-panel"},np={key:0,class:"loading-state"},op={key:1,class:"error-state"},rp={class:"error-actions"},lp=oe({__name:"TrialDetailsPanelV3",props:{trial:{},isLeader:{type:Boolean},executionState:{},progress:{}},emits:["start-trial","pause-trial","resume-trial","cancel-trial","duplicate-trial","edit-trial","delete-trial","export-data","export-python"],setup(l){const e=l,t=je(),a=q(!1),o=q(null),n=q(!1),u=Yt(),p=U(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial?.id);function c(){o.value=null}function m(){t.push("/trials")}function g(){n.value=!0}async function h(){if(e.trial){`${e.trial.id}`;try{u.isActive&&u.currentTrialId===e.trial.id&&u.stopStreaming(),await u.loadHistoricalData(e.trial.id),`${e.trial.id}`,(e.trial.status==="running"||e.trial.status==="paused")&&await u.startStreaming(e.trial.id)}catch($){P.error("REFRESH: Failed to refresh trial data:",$)}}}return le(()=>e.trial,($,I)=>{$&&$.id!==I?.id&&(o.value=null,P.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 switching from ${I?.id} to ${$.id}`))}),me(()=>{const $=e.trial?.id;P.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 MOUNTED for trial ${$}`)}),Pe(()=>{const $=e.trial?.id;P.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 ACTIVATED (cache hit) for trial ${$}`)}),xe(()=>{const $=e.trial?.id;P.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 DEACTIVATED (cached) for trial ${$}`)}),ye(()=>{const $=e.trial?.id;P.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 UNMOUNTED (evicted) for trial ${$}`)}),($,I)=>{const T=pe;return d(),v("div",ap,[a.value?(d(),v("div",np,[k(j(Wt),{class:"loading-spinner",spin:""}),I[9]||(I[9]=s("span",null,"Loading trial details...",-1))])):o.value?(d(),v("div",op,[k(j(Fe),{class:"error-icon"}),I[12]||(I[12]=s("h3",null,"Failed to load trial",-1)),s("p",null,b(o.value),1),s("div",rp,[k(T,{onClick:c},{default:F(()=>I[10]||(I[10]=[D("Retry")])),_:1,__:[10]}),k(T,{type:"link",onClick:m},{default:F(()=>I[11]||(I[11]=[D("Go Back")])),_:1,__:[11]})])])):$.trial?(d(),v(Y,{key:2},[k(qn,{trial:$.trial,progress:$.progress,"is-executing":p.value},null,8,["trial","progress","is-executing"]),k(Yn,{trial:$.trial,"is-leader":$.isLeader,"execution-state":$.executionState,onStart:I[0]||(I[0]=C=>$.$emit("start-trial")),onPause:I[1]||(I[1]=C=>$.$emit("pause-trial")),onResume:I[2]||(I[2]=C=>$.$emit("resume-trial")),onCancel:I[3]||(I[3]=C=>$.$emit("cancel-trial")),onDuplicate:I[4]||(I[4]=C=>$.$emit("duplicate-trial",$.trial.id)),onEdit:I[5]||(I[5]=C=>$.$emit("edit-trial",$.trial.id)),onDelete:I[6]||(I[6]=C=>$.$emit("delete-trial",$.trial.id)),onExportData:g,onExportPython:I[7]||(I[7]=C=>$.$emit("export-python",$.trial.id)),onRefresh:h},null,8,["trial","is-leader","execution-state"]),$.trial&&n.value?(d(),Q(sp,{key:0,visible:n.value,trial:$.trial,"onUpdate:visible":I[8]||(I[8]=C=>n.value=!1)},null,8,["visible","trial"])):R("",!0),k(ic,{trial:$.trial,progress:$.progress,"is-leader":$.isLeader,"execution-state":$.executionState},null,8,["trial","progress","is-leader","execution-state"])],64)):R("",!0)])}}}),ip=re(lp,[["__scopeId","data-v-081db72e"]]),up={class:"import-content"},dp={class:"upload-section"},cp={class:"ant-upload-drag-icon"},pp={key:0,class:"preview-section"},fp={class:"bundle-details"},mp={class:"detail-row"},vp={class:"value"},gp={class:"detail-row"},hp={class:"value"},yp={class:"detail-row"},bp={class:"value"},_p={class:"detail-row"},Tp={class:"value"},$p={key:0,style:{color:"green","margin-left":"8px"}},Cp={key:1,style:{color:"orange","margin-left":"8px"}},kp={key:0,class:"detail-row"},wp={class:"value"},Sp={class:"detail-row"},Ip={class:"value"},Ep={class:"import-options"},Rp={key:0,style:{"margin-bottom":"12px"}},Fp={key:1,style:{"margin-bottom":"12px",padding:"8px",background:"#f0f0f0","border-radius":"4px"}},Pp={key:0,class:"warnings"},xp={class:"modal-actions"},Ap=oe({__name:"ImportTrialDialog",props:{visible:{type:Boolean}},emits:["update:visible","trial-imported"],setup(l,{emit:e}){const t=l,a=e,o=je(),n=q([]),u=q(null),p=q(!1),c=q([]),m=q({mode:"draft",namePrefix:"Imported: "}),g=U({get:()=>t.visible,set:E=>a("update:visible",E)}),h=U(()=>u.value?.execution?.apiCalls&&u.value.execution.apiCalls.length>0);function $(E){return!1}async function I(E){const w=E.file.originFileObj||E.file;if(w)try{const z=await T(w),f=JSON.parse(z);c.value=C(f),u.value=f,f.execution?.apiCalls&&f.execution.apiCalls.length>0,m.value.mode="draft"}catch{Z.error("Failed to read bundle file: Invalid JSON format"),u.value=null}}function T(E){return new Promise((w,z)=>{const f=new FileReader;f.onload=i=>w(i.target?.result),f.onerror=z,f.readAsText(E)})}function C(E){const w=[];return E.version||w.push("Bundle version is missing"),E.configuration?.trial||w.push("Trial configuration is missing"),(!E.configuration?.variableLists||E.configuration.variableLists.length===0)&&w.push("No variable lists found in bundle"),E.version!=="1.0"&&w.push(`Bundle version ${E.version} may not be fully compatible`),w}function N(E){return new Date(E).toLocaleString()}function H(){n.value=[],u.value=null,c.value=[],g.value=!1}async function V(){if(!u.value){Z.error("No bundle to import");return}p.value=!0;try{const{trialBundleImportService:E}=await Ie(async()=>{const{trialBundleImportService:f}=await import("./trial-bundle.service-DAmw5b9V.js");return{trialBundleImportService:f}},__vite__mapDeps([0,1,2,3,4,5,6])),w=h.value&&m.value.mode==="completed",z=await E.importTrialBundle(JSON.stringify(u.value),{importResults:w,importAsCompleted:w,namePrefix:m.value.namePrefix||void 0});z.ok?(Z.success("Trial imported successfully!"),o.push(`/trials?trialId=${z.value.trialId}`),a("trial-imported",z.value.trialId),H()):Z.error(`Import failed: ${z.error.message}`)}catch(E){Z.error(`Import failed: ${E instanceof Error?E.message:"Unknown error"}`)}finally{p.value=!1}}return(E,w)=>{const z=ra,f=ht,i=gt,O=Gt,S=He,r=pe,B=Te;return d(),Q(B,{visible:g.value,"onUpdate:visible":w[3]||(w[3]=x=>g.value=x),title:"Import Trial Bundle",width:600,footer:null,"destroy-on-close":!0,class:"import-trial-modal"},{default:F(()=>[s("div",up,[s("div",dp,[k(z,{fileList:n.value,"onUpdate:fileList":w[0]||(w[0]=x=>n.value=x),"before-upload":$,"max-count":1,accept:".json",onChange:I},{default:F(()=>[s("p",cp,[k(j(jt))]),w[4]||(w[4]=s("p",{class:"ant-upload-text"},"Click or drag trial bundle file here",-1)),w[5]||(w[5]=s("p",{class:"ant-upload-hint"}," Supports .json files exported from trials ",-1))]),_:1,__:[4,5]},8,["fileList"])]),u.value?(d(),v("div",pp,[w[17]||(w[17]=s("h3",null,"Bundle Contents",-1)),s("div",fp,[s("div",mp,[w[6]||(w[6]=s("span",{class:"label"},"Trial Name:",-1)),s("span",vp,b(u.value.metadata.trialName),1)]),s("div",gp,[w[7]||(w[7]=s("span",{class:"label"},"Export Date:",-1)),s("span",hp,b(N(u.value.metadata.exportDate)),1)]),s("div",yp,[w[8]||(w[8]=s("span",{class:"label"},"Status:",-1)),s("span",bp,b(u.value.metadata.trialStatus),1)]),s("div",_p,[w[9]||(w[9]=s("span",{class:"label"},"API Calls:",-1)),s("span",Tp,[D(b(u.value.metadata.apiCallCount)+" ",1),h.value?(d(),v("span",$p," (with results) ")):(d(),v("span",Cp," (configuration only) "))])]),u.value.configuration.template?(d(),v("div",kp,[w[10]||(w[10]=s("span",{class:"label"},"Template:",-1)),s("span",wp,b(u.value.configuration.template.name),1)])):R("",!0),s("div",Sp,[w[11]||(w[11]=s("span",{class:"label"},"Variable Lists:",-1)),s("span",Ip,b(u.value.configuration.variableLists?.length||0),1)])]),s("div",Ep,[w[16]||(w[16]=s("h4",null,"Import Options",-1)),h.value?(d(),v("div",Rp,[k(i,{value:m.value.mode,"onUpdate:value":w[1]||(w[1]=x=>m.value.mode=x),style:{display:"block"}},{default:F(()=>[k(f,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:F(()=>w[12]||(w[12]=[s("strong",null,"Import as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Create fresh trial ready to run new experiment ",-1)])),_:1,__:[12]}),k(f,{value:"completed",style:{display:"block"}},{default:F(()=>w[13]||(w[13]=[s("strong",null,"Import as Completed",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Preserve historical results for review/analysis ",-1)])),_:1,__:[13]})]),_:1},8,["value"])])):(d(),v("div",Fp,w[14]||(w[14]=[s("strong",null,"Draft Trial",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px"}}," This bundle contains configuration only - will import as draft ready to run ",-1)]))),k(O,{value:m.value.namePrefix,"onUpdate:value":w[2]||(w[2]=x=>m.value.namePrefix=x),placeholder:"Name prefix (optional)",style:{"margin-top":"8px"}},{prefix:F(()=>w[15]||(w[15]=[D("Name:")])),_:1},8,["value"])]),c.value.length>0?(d(),v("div",Pp,[k(S,{message:"Import Warnings",type:"warning","show-icon":""},{description:F(()=>[s("ul",null,[(d(!0),v(Y,null,ee(c.value,x=>(d(),v("li",{key:x},b(x),1))),128))])]),_:1})])):R("",!0)])):R("",!0),s("div",xp,[k(r,{onClick:H},{default:F(()=>w[18]||(w[18]=[D("Cancel")])),_:1,__:[18]}),k(r,{type:"primary",onClick:V,loading:p.value,disabled:!u.value},{default:F(()=>[k(j(Bt)),w[19]||(w[19]=D(" Import Trial "))]),_:1,__:[19]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),Vp=re(Ap,[["__scopeId","data-v-1d9366d6"]]),Op={class:"option-content"},Dp={class:"option-header"},Np={class:"modal-footer"},Lp=oe({__name:"PythonExportModal",props:{visible:{type:Boolean},trialId:{}},emits:["update:visible"],setup(l,{emit:e}){const t=l,a=e,o=U({get:()=>t.visible,set:c=>a("update:visible",c)}),n=q("script-config-data"),u=q(!1);le(o,c=>{c&&(n.value="script-config-data",u.value=!1)});async function p(){if(n.value){u.value=!0;try{const{reproducibilityBundleService:c}=await Ie(async()=>{const{reproducibilityBundleService:g}=await import("./index-D1VCbtMP.js");return{reproducibilityBundleService:g}},__vite__mapDeps([7,1,2,3,4,5,0,6,8,9,10,11,12,13,14,15,16,17])),m=await c.exportBundle(t.trialId,{bundleType:n.value,includeComments:!0});if(m.ok){const{tauriDownloadUtilities:g}=await Ie(async()=>{const{tauriDownloadUtilities:h}=await Promise.resolve().then(()=>Cc);return{tauriDownloadUtilities:h}},void 0);if(n.value==="script-only"){const h=await m.value.zipBlob.text();await g.downloadFile(h,"python",m.value.filename.replace(".zip",""),!1),Z.success("Python script downloaded successfully")}else{const h=await m.value.zipBlob.arrayBuffer(),$=new Uint8Array(h);await g.downloadFile($,"zip",m.value.filename.replace(".zip",""),!1);const I=n.value==="script-config-data"?"Complete archive bundle":"Reproducibility bundle";Z.success(`${I} downloaded successfully`)}o.value=!1}else throw new Error(m.error?.message||"Export failed")}catch(c){P.error("Export failed:",c),Z.error(`Failed to export: ${c instanceof Error?c.message:"Unknown error"}`)}finally{u.value=!1}}}return(c,m)=>{const g=ht,h=We,$=gt,I=pe,T=Te;return d(),Q(T,{visible:o.value,"onUpdate:visible":m[1]||(m[1]=C=>o.value=C),title:"Export for Reproducibility",width:600,footer:null,"destroy-on-close":!0},{default:F(()=>[m[10]||(m[10]=s("p",{class:"export-description"}," Choose your export format: ",-1)),k($,{value:n.value,"onUpdate:value":m[0]||(m[0]=C=>n.value=C),class:"export-options"},{default:F(()=>[k(g,{value:"script-only",class:"export-option"},{default:F(()=>m[2]||(m[2]=[s("div",{class:"option-content"},[s("div",{class:"option-header"},[s("span",{class:"option-icon"},"📄"),s("strong",{class:"option-title"},"Python Script Only")]),s("div",{class:"option-description"}," Minimal Python script (~200-400 lines) with clear experimental design. "),s("div",{class:"option-files"},"• experiment.py")],-1)])),_:1,__:[2]}),k(g,{value:"script-config",class:"export-option"},{default:F(()=>m[3]||(m[3]=[s("div",{class:"option-content"},[s("div",{class:"option-header"},[s("span",{class:"option-icon"},"📦"),s("strong",{class:"option-title"},"Reproducibility Bundle")]),s("div",{class:"option-description"}," Python script + complete trial configuration. "),s("div",{class:"option-files"}," • experiment.py • trial_config.json • README.md ")],-1)])),_:1,__:[3]}),k(g,{value:"script-config-data",class:"export-option recommended"},{default:F(()=>[s("div",Op,[s("div",Dp,[m[5]||(m[5]=s("span",{class:"option-icon"},"🗂️",-1)),m[6]||(m[6]=s("strong",{class:"option-title"},"Complete Archive Bundle",-1)),k(h,{color:"green",style:{"margin-left":"8px"}},{default:F(()=>m[4]||(m[4]=[D("Recommended")])),_:1,__:[4]})]),m[7]||(m[7]=s("div",{class:"option-description"}," Everything: Python script + configuration + all experimental results. ",-1)),m[8]||(m[8]=s("div",{class:"option-files"}," • experiment.py • trial_config.json • data/results.{csv,xlsx,jsonl} • README.md ",-1))])]),_:1})]),_:1},8,["value"]),s("div",Np,[k(I,{type:"primary",size:"large",disabled:!n.value,loading:u.value,onClick:p},{default:F(()=>[k(j(Kt)),m[9]||(m[9]=D(" Download "))]),_:1,__:[9]},8,["disabled","loading"])])]),_:1,__:[10]},8,["visible"])}}}),Mp=re(Lp,[["__scopeId","data-v-6cec199d"]]),Up={class:"trials-view-v3"},zp={key:0,class:"provider-warning-banner"},Bp={class:"banner-content"},jp={key:1,class:"observer-mode-banner"},Wp={class:"banner-content"},Hp={key:1,class:"loading-left-pane"},qp={key:0,class:"no-selection"},Gp={key:0,class:"observer-note"},Jp=oe({__name:"TrialsViewV3",setup(l){const e=ma(),{trials:t}=ua(),{enabledModels:a}=va(),{duplicateTrial:o,deleteTrial:n}=da(),u=Yt(),p=Mt(),c=je(),m=q(),g=q(!0),h=q(null),$=q(""),I=q("all"),T=q(-1),C=q(!1),N=q(!1),H=q(!1),V=U(()=>a.value.length>0),E=U(()=>!V.value&&!H.value),w=e.isLeader,z=e.execution,{trial:f}=ca(h),i=U(()=>{const M=f.value?.progress;return M?{trialId:h.value||"",...M,lastUpdated:new Date}:null}),O=U(()=>{let M=t.value;if($.value){const G=$.value.toLowerCase();M=M.filter(se=>{const be=se.name.toLowerCase().includes(G),ge=se.templateConfig?.template?.toLowerCase().includes(G),ce=se.configurations.some($e=>$e.modelId.toLowerCase().includes(G)||$e.provider.toLowerCase().includes(G));return be||ge||ce})}return I.value!=="all"&&(M=M.filter(G=>G.status===I.value)),M});async function S(){const M=p.query;if(M.duplicate){const G=M.duplicate,se=await o(G);se.ok?await c.push({path:"/trials/create",query:{duplicate:se.value,edit:M.edit==="true"?"true":void 0}}):Z.error(`Failed to duplicate trial: ${se.error?.message||"Unknown error"}`),await c.replace({query:{}});return}if(M.designId||M.promptSource){await c.push({path:"/trials/create",query:M});return}if(p.query.trialId){const G=p.query.trialId;B(G)}}function r(){if(h.value||t.value.length===0)return;const M=t.value.find(G=>G.status==="running");if(M){B(M.id);return}B(t.value[0].id)}async function B(M){const G=performance.now();P.info(`V4_TRIAL_SWITCH: Starting trial selection: ${M}`),h.value=M;const se=performance.now();if(P.info(`V4_TRIAL_SWITCH: UI updated in ${(se-G).toFixed(1)}ms`),t.value.length>0){const ce=O.value.findIndex($e=>$e.id===M);ce>=0&&(T.value=ce)}const be=performance.now();if(P.info(`V4_TRIAL_SWITCH: Starting stream manager for trial ${M} at ${(be-G).toFixed(1)}ms`),u.startStreaming(M).catch(ce=>{P.error(`V4_TRIAL_SWITCH: Failed to start streaming for trial ${M}`,ce)}),p.query.trialId!==M){const ce={...p.query};ce.trialId=M,ce.tab||(ce.tab="status"),c.push({path:"/trials",query:ce}),P.info(`V4_TRIAL_SWITCH: URL updated to preserve tab '${ce.tab}' at ${(performance.now()-G).toFixed(1)}ms`)}m.value&&m.value.closeMobileOverlay();const ge=performance.now();P.info(`V4_TRIAL_SWITCH: selectTrial() completed in ${(ge-G).toFixed(1)}ms`)}function x(M){$.value=M,T.value=-1}function _(M){I.value=M,T.value=-1}async function L(){Z.info("Refreshing trial list...")}function A(M){const G=O.value;if(G.length!==0){if((M.metaKey||M.ctrlKey)&&M.key==="k"){M.preventDefault(),window.dispatchEvent(new CustomEvent("focus-trial-search"));return}(M.key==="j"||M.key==="ArrowDown")&&(M.preventDefault(),T.value=Math.min(T.value+1,G.length-1),T.value>=0&&(B(G[T.value].id),X(G[T.value].id))),(M.key==="k"||M.key==="ArrowUp")&&(M.preventDefault(),T.value=Math.max(T.value-1,0),B(G[T.value].id),X(G[T.value].id)),M.key==="Enter"&&h.value,M.key==="Escape"&&($.value="",h.value=null,T.value=-1)}}function X(M){Ce(()=>{const G=document.querySelector(`[data-trial-id="${M}"]`);G&&G.scrollIntoView({behavior:"smooth",block:"nearest"})})}function y(M){P.debug("Trial list panel resized",{width:M})}function W(M){P.debug("Mobile overlay changed",{visible:M})}function J(){H.value=!0}async function K(){await c.push("/trials/create")}function ae(){N.value=!0}function ne(M){L(),B(M)}async function fe(){if(h.value&&!C.value){C.value=!0,e.execution?.value,e.execution?.value?.status;try{h.value;const M=await e.startTrialWithStreaming(h.value);if(!M.ok){Z.error(M.error?.message||"Unknown error");return}await u.startStreaming(h.value);const G={...p.query};G.tab="tasks",c.replace({query:G})}finally{C.value=!1}}}async function Ee(){`${h.value}`,`${h.value}`,`${e.execution.value.status}`,`${e.isLeader.value}`;const M=await e.pauseExecution();M?.ok,M.ok?`${e.execution.value.status}`:(M.error.message,Z.error(M.error?.message||"Unknown error"))}async function rs(){if(!h.value)return;`${h.value}`,`${h.value}`,`${e.execution.value.status}`,`${e.isLeader.value}`;const M=e.execution.value?.status||"idle",G=e.execution.value?.currentTrialId;if(M==="paused"&&G===h.value){`${h.value}`;const se=await e.resumeExecution(h.value);se.ok||(se.error.message,Z.error(se.error.message))}else{const se=await e.startTrialWithStreaming(h.value);se.ok?await u.startStreaming(h.value):(se.error.message,Z.error(se.error?.message||"Unknown error"))}}async function ls(){const M=await e.cancelExecution();M.ok||Z.error(M.error?.message||"Unknown error")}async function is(M){const G=await o(M);G.ok?(Z.success("Trial duplicated"),G.value&&B(G.value)):Z.error(G.error?.message||"Unknown error")}async function us(M){await c.push({path:"/trials/create",query:{duplicate:M,edit:"true"}})}async function ds(M){const G=await n(M);G.ok?(Z.success("Trial deleted"),h.value===M&&(h.value=null)):Z.error(G.error?.message||"Unknown error")}async function cs(M,G){const se=await ut.exportTrialData(M,{format:G,fields:void 0,includeHeaders:!0,addBOM:G==="excel"||G==="csv"});se.ok?(await Be.downloadFile(se.value.data,G,se.value.metadata.trialName,G==="excel"||G==="csv"),Z.success(`Exported ${se.value.recordCount} API calls to ${se.value.filename}`)):Z.error(se.error?.message||"Unknown error")}const Ke=q(!1),yt=q("");function ps(M){yt.value=M,Ke.value=!0}return le(()=>p.query.trialId,M=>{M&&M!==h.value&&B(M)}),le(g,(M,G)=>{const se=performance.now();P.info(`V4_TRIAL_SWITCH: isLoadingInitial changed from ${G} to ${M} at ${se}`),M||P.info("V4_TRIAL_SWITCH: Both panes should now be VISIBLE (no longer loading initial)")},{immediate:!0}),le(t,(M,G)=>{const se=performance.now();P.info(`V4_TRIAL_SWITCH: trials array changed from ${G?.length||0} to ${M.length} trials at ${se}`)},{immediate:!0}),me(async()=>{const M=performance.now();P.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() ENTRY at ${M}`);const G=performance.now();P.info(`V4_TRIAL_SWITCH: Starting V4 execution system initialization at ${(G-M).toFixed(1)}ms`);try{await e.initialize();const Qe=performance.now();P.info(`V4_TRIAL_SWITCH: V4 execution system initialized in ${(Qe-G).toFixed(1)}ms`)}catch(Qe){const gs=performance.now();P.error(`V4_TRIAL_SWITCH: V4 initialization failed in ${(gs-G).toFixed(1)}ms:`,Qe)}const se=performance.now();window.addEventListener("keydown",A),P.info(`V4_TRIAL_SWITCH: Keyboard listener added in ${(se-M).toFixed(1)}ms`);const be=performance.now();P.info(`V4_TRIAL_SWITCH: Starting nextTick wait at ${(be-M).toFixed(1)}ms`),await Ce();const ge=performance.now();P.info(`V4_TRIAL_SWITCH: nextTick completed in ${(ge-be).toFixed(1)}ms`);const ce=performance.now();g.value=!1,P.info(`V4_TRIAL_SWITCH: isLoadingInitial set to false at ${(ce-M).toFixed(1)}ms`);const $e=performance.now();P.info(`V4_TRIAL_SWITCH: Starting URL parameter processing at ${($e-M).toFixed(1)}ms`),await S();const fs=performance.now();P.info(`V4_TRIAL_SWITCH: URL parameter processing completed in ${(fs-$e).toFixed(1)}ms`);const bt=performance.now();P.info(`V4_TRIAL_SWITCH: Starting auto-selection at ${(bt-M).toFixed(1)}ms`),r();const ms=performance.now();P.info(`V4_TRIAL_SWITCH: Auto-selection completed in ${(ms-bt).toFixed(1)}ms`);const vs=performance.now();P.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() TOTAL: ${(vs-M).toFixed(1)}ms`)}),ye(()=>{window.removeEventListener("keydown",A),u.destroy()}),(M,G)=>{const se=Vt("router-link"),be=pe;return d(),v("div",Up,[E.value?(d(),v("div",zp,[s("div",Bp,[k(j(Fe),{class:"warning-icon"}),G[3]||(G[3]=s("span",null,"No LLM providers configured. Please add API keys in Settings to run trials.",-1)),k(se,{to:"/settings",class:"settings-link"},{default:F(()=>G[2]||(G[2]=[D("Go to Settings")])),_:1,__:[2]}),k(j(zt),{class:"close-icon",onClick:J})]),G[4]||(G[4]=s("div",{class:"banner-note"},"Note: Ollama doesn't require API keys",-1))])):R("",!0),j(w)?R("",!0):(d(),v("div",jp,[s("div",Wp,[k(j(qt),{class:"observer-icon"}),G[5]||(G[5]=s("span",null,[s("strong",null,"Observer Mode: Multiple Tabs Detected")],-1)),G[6]||(G[6]=s("div",{class:"leader-hint"}," You can only open one Auditomatic tab at a time. Close other tabs, or refresh if this is your only tab. Your templates and trials are safely saved. ",-1))])])),k(ya,{ref_key:"splitPanel",ref:m,"storage-key":"trial-list-width","default-width":250,"min-width":200,"max-width":600,onResize:y,onMobileOverlayChange:W},{left:F(()=>[g.value?(d(),v("div",Hp," Loading trials... ")):(d(),Q(Fn,{key:0,trials:j(t),"selected-trial-id":h.value,"search-query":$.value,"filter-status":I.value,onSelectTrial:B,onCreateTrial:K,onImportTrial:ae,onUpdateSearch:x,onUpdateFilter:_,onRefresh:L},null,8,["trials","selected-trial-id","search-query","filter-status"]))]),right:F(()=>[(d(),Q(at,{max:5},[h.value?(d(),Q(ip,{key:h.value,trial:j(f),"is-leader":j(w),"execution-state":j(z),progress:i.value,onStartTrial:fe,onPauseTrial:Ee,onResumeTrial:rs,onCancelTrial:ls,onDuplicateTrial:is,onEditTrial:us,onDeleteTrial:ds,onExportData:cs,onExportPython:ps},null,8,["trial","is-leader","execution-state","progress"])):R("",!0)],1024)),!h.value||!j(f)?Se((d(),v("div",qp,[k(j(Xt),{class:"empty-icon"}),G[8]||(G[8]=s("h3",null,"Select a trial to view details",-1)),G[9]||(G[9]=s("p",null,"Choose from the list or create a new one",-1)),k(be,{type:"primary",size:"large",disabled:!j(w),onClick:K},{default:F(()=>G[7]||(G[7]=[D(" Create New Trial ")])),_:1,__:[7]},8,["disabled"]),j(w)?R("",!0):(d(),v("div",Gp," Close other tabs to enable trial creation "))],512)),[[Nt,!g.value]]):R("",!0)]),_:1},512),k(Vp,{visible:N.value,"onUpdate:visible":G[0]||(G[0]=ge=>N.value=ge),onTrialImported:ne},null,8,["visible"]),k(Mp,{visible:Ke.value,"onUpdate:visible":G[1]||(G[1]=ge=>Ke.value=ge),"trial-id":yt.value},null,8,["visible","trial-id"])])}}}),Xp=re(Jp,[["__scopeId","data-v-00b3755b"]]),cf=Object.freeze(Object.defineProperty({__proto__:null,default:Xp},Symbol.toStringTag,{value:"Module"}));export{de as E,cf as T,ut as d,xt as g,De as t};
