const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./APICallDetailModal-BGCLw6Ck.js","./vendor-DCf9YP3r.js","./designs-db-BcjIu_Fz.js","./db-CL8uhZCz.js","./index-HyoKRhI9.js","./index-izHpNa_W.css","./defaultData-DyqJdH2z.js","./variables-db-B4ebURAw.js","./logger.service-_k__GSpu.js","./registry-dHxpV8ha.js","./models-db-DCJIrR1U.js","./trials-db-w-1bpsX0.js","./mock-provider.service-BAPeV6CB.js","./settings-db-CbXALxZS.js","./ModelSelectionTable-B7DR3Hn0.js","./cost-formatting-D-OPWEvg.js","./ModelSelectionTable-B2A5b4Ts.css","./BaseModal.vue_vue_type_style_index_0_lang-Br6W_Dvv.js","./BaseModal-DbTyIa7L.css","./APICallDetailModal-BL_o4xQR.css"])))=>i.map(i=>d[i]);
import{j as e,f as a,e as l,_ as t,T as s,R as n,g as r,i,L as o,k as u}from"./index-HyoKRhI9.js";import{c,g as d,i as p,u as v}from"./trials-db-w-1bpsX0.js";import{k as f,d as m,f as y,c as g,a3 as h,B as _,Y as b,F as k,a5 as x,G as C,_ as w,U as R,X as S,W as j,q as T,ac as E,af as I,S as M,a7 as P,u as $,l as O,ab as q,o as D}from"./vendor-DCf9YP3r.js";import{u as z}from"./BaseModal.vue_vue_type_style_index_0_lang-Br6W_Dvv.js";import{A,a as L,_ as N,T as U}from"./APICallDetailModal-BGCLw6Ck.js";import"./db-CL8uhZCz.js";import"./defaultData-DyqJdH2z.js";import"./registry-dHxpV8ha.js";import"./designs-db-BcjIu_Fz.js";import"./variables-db-B4ebURAw.js";import"./logger.service-_k__GSpu.js";import"./mock-provider.service-BAPeV6CB.js";import"./settings-db-CbXALxZS.js";import"./models-db-DCJIrR1U.js";import"./ModelSelectionTable-B7DR3Hn0.js";import"./cost-formatting-D-OPWEvg.js";var F={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"};function B(e){for(var a=1;a<arguments.length;a++){var l=null!=arguments[a]?Object(arguments[a]):{},t=Object.keys(l);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(l).filter(function(e){return Object.getOwnPropertyDescriptor(l,e).enumerable}))),t.forEach(function(a){V(e,a,l[a])})}return e}function V(e,a,l){return a in e?Object.defineProperty(e,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[a]=l,e}var H=function(a,l){var t=B({},a,l.attrs);return f(e,B({},t,{icon:F}),null)};H.displayName="ExportOutlined",H.inheritAttrs=!1;const J={class:"modal-content"},W={class:"modal-header"},K={class:"modal-body"},G={class:"section"},Y={class:"format-options"},X=["value"],Q={class:"format-label"},Z={class:"format-name"},ee={class:"section"},ae={class:"field-groups"},le={class:"field-list"},te=["value"],se={class:"field-label"},ne={class:"field-name"},re={class:"field-desc"},ie={class:"section"},oe={class:"preview-info"},ue={class:"preview-count"},ce={class:"preview-fields"},de={class:"preview-size"},pe={class:"modal-footer"},ve=t(m({__name:"ExportDataModal",props:{trial:{},apiCalls:{}},emits:["close"],setup(e){const t=e,s=[{id:"csv",name:"CSV",description:"Comma-separated values (Excel compatible)"},{id:"tsv",name:"TSV",description:"Tab-separated values"},{id:"excel",name:"Excel",description:"Microsoft Excel (.xlsx)"},{id:"json",name:"JSON",description:"JavaScript Object Notation"},{id:"jsonl",name:"JSONL",description:"JSON Lines (one object per line)"}],n=[{name:"Basic Info",fields:[{id:"id",name:"ID",description:"API call identifier",default:!0},{id:"trial_id",name:"Trial ID",description:"Parent trial identifier",default:!0},{id:"trial_name",name:"Trial Name",description:"Human-readable trial name",default:!0},{id:"status",name:"Status",description:"Call status (completed, failed, etc.)",default:!0},{id:"created",name:"Created",description:"When the call was initiated",default:!0},{id:"completed",name:"Completed",description:"When the call finished",default:!0}]},{name:"Configuration",fields:[{id:"configuration_index",name:"Config Index",description:"Configuration array index",default:!1},{id:"configuration_name",name:"Config Name",description:"Human-readable config name",default:!1},{id:"provider",name:"Provider",description:"LLM service provider",default:!0},{id:"model",name:"Model",description:"Model identifier",default:!0}]},{name:"Content",fields:[{id:"prompt",name:"Prompt",description:"Input prompt text",default:!0},{id:"variables",name:"Variables",description:"Variable substitutions (flattened as separate columns)",default:!0},{id:"result_content",name:"Result Content",description:"LLM response content",default:!0},{id:"result_error",name:"Result Error",description:"Error message if failed",default:!0}]},{name:"Performance",fields:[{id:"response_latency_ms",name:"Latency (ms)",description:"Response time",default:!0},{id:"duration_ms",name:"Duration (ms)",description:"Total processing time",default:!1},{id:"result_success",name:"Success",description:"Whether call succeeded",default:!0}]},{name:"Technical Details",fields:[{id:"request_url",name:"Request URL",description:"API endpoint URL",default:!0},{id:"request_method",name:"Request Method",description:"HTTP method",default:!1},{id:"request_headers",name:"Request Headers",description:"HTTP request headers",default:!1},{id:"request_body",name:"Request Body",description:"Full request payload",default:!1},{id:"response_status",name:"Response Status",description:"HTTP status code",default:!0},{id:"response_headers",name:"Response Headers",description:"HTTP response headers",default:!1},{id:"response_body",name:"Response Body",description:"Full response payload",default:!1}]},{name:"Error Handling",fields:[{id:"network_error_count",name:"Network Errors",description:"Number of network failures",default:!1},{id:"retry_count",name:"Retry Count",description:"Number of retry attempts",default:!1}]}],r=y("csv"),i=y([]),o=n.flatMap(e=>e.fields);i.value=o.filter(e=>e.default).map(e=>e.id);const u=g(()=>{const e=50*i.value.length,a=t.apiCalls.length*e;return a<1024?`${a}B`:a<1048576?`${(a/1024).toFixed(1)}KB`:`${(a/1048576).toFixed(1)}MB`});function c(){i.value=o.map(e=>e.id)}function d(){i.value=o.filter(e=>e.default).map(e=>e.id)}function p(){i.value=[]}function v(){const e=new Set;return i.value.includes("variables")&&t.apiCalls.forEach(a=>{a.variables&&"object"==typeof a.variables&&Object.keys(a.variables).forEach(a=>e.add(a))}),t.apiCalls.map(a=>{const l={};var s,n;if(i.value.includes("id")&&(l.ID=a.id),i.value.includes("trial_id")&&(l["Trial ID"]=a.trialId),i.value.includes("trial_name")&&(l["Trial Name"]=t.trial.name),i.value.includes("status")&&(l.Status=a.status),i.value.includes("created")&&(l.Created=a.created.toISOString()),i.value.includes("completed")&&(l.Completed=a.completed?.toISOString()||""),i.value.includes("configuration_index")&&(l["Configuration Index"]=a.configurationIndex),i.value.includes("configuration_name")&&(l["Configuration Name"]=(s=a.configurationIndex,t.trial.configurationSnapshots[s]&&t.trial.configurationSnapshots[s].name||`Config ${s+1}`)),i.value.includes("provider")&&(l.Provider=(n=a,n.request?.url?.includes("openai.com")?"OpenAI":n.request?.url?.includes("anthropic.com")?"Anthropic":n.request?.url?.includes("openrouter.ai")?"OpenRouter":n.request?.url?.includes("localhost:11434")?"Ollama":"Unknown")),i.value.includes("model")&&(l.Model=function(e){return e.request?.body?.model?e.request.body.model:"Unknown"}(a)),i.value.includes("prompt")&&(l.Prompt=a.prompt),i.value.includes("variables"))for(const t of e)l[`variable_${t}`]=a.variables?.[t]||"";return i.value.includes("result_content")&&(l["Result Content"]=a.result?.content||""),i.value.includes("result_error")&&(l["Result Error"]=a.result?.error||""),i.value.includes("response_latency_ms")&&(l["Response Latency (ms)"]=a.response?.latencyMs||""),i.value.includes("duration_ms")&&(l["Duration (ms)"]=a.completed?a.completed.getTime()-a.created.getTime():""),i.value.includes("result_success")&&(l["Result Success"]=a.result?.success||!1),i.value.includes("request_url")&&(l["Request URL"]=a.request?.url||""),i.value.includes("request_method")&&(l["Request Method"]=a.request?.method||""),i.value.includes("request_headers")&&(l["Request Headers"]=JSON.stringify(a.request?.headers||{})),i.value.includes("request_body")&&(l["Request Body"]=JSON.stringify(a.request?.body||{})),i.value.includes("response_status")&&(l["Response Status"]=a.response?.status||""),i.value.includes("response_headers")&&(l["Response Headers"]=JSON.stringify(a.response?.headers||{})),i.value.includes("response_body")&&(l["Response Body"]=JSON.stringify(a.response?.body||{})),i.value.includes("network_error_count")&&(l["Network Error Count"]=0),i.value.includes("retry_count")&&(l["Retry Count"]=0),l})}async function m(){const e=v(),s=(new Date).toISOString().split("T")[0],n=`${t.trial.name}_${r.value}_${s}`;try{switch(r.value){case"csv":!function(e,a){if(0===e.length)return;const l=Object.keys(e[0]||{}),t=l.filter(e=>!e.startsWith("variable_")),s=l.filter(e=>e.startsWith("variable_")).sort(),n=[...t,...s],r=[n.join(","),...e.map(e=>n.map(a=>`"${String(e[a]||"").replace(/"/g,'""')}"`).join(","))].join("\n");M(r,`${a}.csv`,"text/csv")}(e,n);break;case"tsv":!function(e,a){if(0===e.length)return;const l=Object.keys(e[0]||{}),t=l.filter(e=>!e.startsWith("variable_")),s=l.filter(e=>e.startsWith("variable_")).sort(),n=[...t,...s],r=[n.join("\t"),...e.map(e=>n.map(a=>String(e[a]||"").replace(/\t/g," ")).join("\t"))].join("\n");M(r,`${a}.tsv`,"text/tab-separated-values")}(e,n);break;case"excel":await async function(e,a){const t=await l(()=>import("./xlsx-C4WhbwXR.js"),[],import.meta.url),s=t.utils.book_new(),n=t.utils.json_to_sheet(e),r=Object.keys(e[0]||{}),i=r.map(e=>({wch:Math.min(Math.max(e.length,10),50)}));n["!cols"]=i,t.utils.book_append_sheet(s,n,"Trial Results"),t.writeFile(s,`${a}.xlsx`)}(e,n);break;case"json":!function(e,a){const l=JSON.stringify(e,null,2);M(l,`${a}.json`,"application/json")}(e,n);break;case"jsonl":!function(e,a){const l=e.map(e=>JSON.stringify(e)).join("\n");M(l,`${a}.jsonl`,"application/jsonl")}(e,n)}}catch(i){console.error("Export failed:",i),a.error("Export failed: "+(i instanceof Error?i.message:"Unknown error"))}}function M(e,a,l){let t=e;"text/csv"!==l&&"text/tab-separated-values"!==l||(t="\ufeff"+e);const s=new Blob([t],{type:`${l};charset=utf-8`}),n=URL.createObjectURL(s),r=document.createElement("a");r.href=n,r.download=a,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}return(e,a)=>{const l=R("a-button");return j(),h("div",{class:"modal-overlay",onClick:a[4]||(a[4]=_(a=>e.$emit("close"),["self"]))},[b("div",J,[b("div",W,[a[5]||(a[5]=b("h3",null,"Export Trial Data",-1)),b("button",{onClick:a[0]||(a[0]=a=>e.$emit("close")),class:"close-btn"},"×")]),b("div",K,[b("div",G,[a[6]||(a[6]=b("h4",null,"Export Format",-1)),b("div",Y,[(j(),h(k,null,x(s,e=>b("label",{key:e.id,class:"format-option"},[T(b("input",{type:"radio",value:e.id,"onUpdate:modelValue":a[1]||(a[1]=e=>r.value=e),class:"format-radio"},null,8,X),[[E,r.value]]),b("span",Q,[b("span",Z,w(e.name),1)])])),64))])]),b("div",ee,[b("h4",null,[a[7]||(a[7]=C(" Fields to Export ")),b("div",{class:"field-controls"},[b("button",{onClick:c,class:"control-btn"},"Select All"),b("button",{onClick:d,class:"control-btn"},"Defaults"),b("button",{onClick:p,class:"control-btn"},"Select None")])]),b("div",ae,[(j(),h(k,null,x(n,e=>b("div",{key:e.name,class:"field-group"},[b("h5",null,w(e.name),1),b("div",le,[(j(!0),h(k,null,x(e.fields,e=>(j(),h("label",{key:e.id,class:"field-option"},[T(b("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":a[2]||(a[2]=e=>i.value=e),class:"field-checkbox"},null,8,te),[[I,i.value]]),b("span",se,[b("span",ne,w(e.name),1),b("span",re,w(e.description),1)])]))),128))])])),64))])]),b("div",ie,[a[8]||(a[8]=b("h4",null,"Export Preview",-1)),b("div",oe,[b("span",ue,w(e.apiCalls.length)+" records",1),b("span",ce,w(i.value.length)+" fields",1),b("span",de,"~"+w(u.value),1)])])]),b("div",pe,[f(l,{onClick:a[3]||(a[3]=a=>e.$emit("close")),size:"large",class:"footer-button"},{default:S(()=>a[9]||(a[9]=[C(" Cancel ")])),_:1,__:[9]}),f(l,{type:"primary",onClick:m,disabled:0===i.value.length,size:"large",class:"footer-button footer-button-primary"},{default:S(()=>[C(" Export "+w(r.value.toUpperCase()),1)]),_:1},8,["disabled"])])])])}}}),[["__scopeId","data-v-891b72bd"]]),fe={class:"results-table-container full-width"},me={class:"results-header"},ye={class:"header-actions"},ge={class:"scientific-table-container"},he={class:"scientific-table-wrapper"},_e={key:0,class:"trial-info-cell"},be={class:"trial-header"},ke={class:"trial-name"},xe={class:"trial-design"},Ce={class:"text-secondary"},we={class:"trial-created"},Re={class:"text-secondary"},Se={key:1,class:"progress-summary"},je={class:"progress-stats"},Te={class:"stat successful"},Ee={class:"stat failed"},Ie={class:"stat total"},Me={class:"progress-text"},Pe={key:0,class:"error-indicator"},$e={key:2,class:"success-rate-cell"},Oe={class:"rate-value"},qe={key:3,class:"performance-cell"},De={class:"metric"},ze={class:"metric-value"},Ae={class:"metric"},Le={class:"metric-value"},Ne={key:4,class:"configurations-cell"},Ue={class:"config-details"},Fe={class:"text-secondary"},Be={key:5,class:"cost-summary"},Ve={key:1,class:"text-secondary"},He={key:0,class:"cost-per-call"},Je={key:6,class:"table-actions-grid table-actions-grid-3"},We=t(m({__name:"ResultsTable",props:{trials:{},loading:{type:Boolean,default:!1}},emits:["view-results","export-trial","duplicate-trial","delete-trial","trial-details","refresh-trials","export-all","status-filter-changed"],setup(e,{emit:a}){const l=e,t=a,o=y("all"),u=y(!1),c=y(null),d=y([]),p=[{key:"all",label:"All"},{key:"completed",label:"Completed"},{key:"failed",label:"Failed"},{key:"running",label:"Running"},{key:"cancelled",label:"Cancelled"}],{getVisibleColumns:v,createResultColumns:m}=z(),T=v(m()),E=g(()=>"all"===o.value?l.trials:l.trials.filter(e=>e.status===o.value)),I=g(()=>l.trials.filter(e=>"completed"===e.status));function D(e){o.value=e,t("status-filter-changed",e)}function A(e){t("view-results",e)}function L(e){return"all"===e?l.trials.length:l.trials.filter(a=>a.status===e).length}function N(e){return 0===e.progress.total?0:Math.round(e.progress.completed/e.progress.total*100)}function U(e){if(0===e.progress.completed)return 0;const a=e.progress.completed-e.progress.networkErrors;return Math.round(a/e.progress.completed*100)}function F(e){const a=U(e);return a>=95?"#52c41a":a>=80?"#faad14":"#ff4d4f"}function B(e){return e.progress.completed>0?"1,234":"-"}function V(e){return e.progress.completed>0?"2.5":"-"}function H(e){if(0===e.progress.total||0===e.estimatedCost)return"-";return(Math.abs(e.estimatedCost)/e.progress.total).toFixed(4)}function J(e){const a=[];return"completed"===e.status&&a.push("status-completed"),"failed"===e.status&&a.push("status-failed"),"running"===e.status&&a.push("status-running"),a.join(" ")}function W(e){const a=(new Date).getTime()-e.getTime(),l=Math.floor(a/864e5);return 0===l?"Today":1===l?"Yesterday":l<7?`${l} days ago`:l<30?`${Math.floor(l/7)} weeks ago`:e.toLocaleDateString()}function K(){t("refresh-trials")}async function G(){const e=I.value;if(0!==e.length)try{const a=[];for(const l of e){const e=await i.apiCalls.where("trialId").equals(l.id).toArray();a.push(...e)}c.value={id:"all-trials",name:`All Completed Trials (${e.length} trials)`,status:"completed",created:new Date,updated:new Date,designSnapshot:{originalName:"Multiple Designs"},configurationSnapshots:[],variableSnapshots:{},progress:{completed:a.filter(e=>"completed"===e.status).length,total:a.length,networkErrors:a.filter(e=>"failed"===e.status).length},totalCombinations:a.length,estimatedCost:e.reduce((e,a)=>e+a.estimatedCost,0)},d.value=a,u.value=!0}catch(a){console.error("Failed to load API calls:",a)}}function Y(e){return O("div",{class:"expanded-trial-details"},[O("h4",{style:{margin:"0 0 12px 0",fontSize:"13px"}},"Configuration Breakdown"),O(s,{columns:[{title:"Model",dataIndex:"model",key:"model",width:200},{title:"Parameters",dataIndex:"parameters",key:"parameters",width:300},{title:"Calls",dataIndex:"calls",key:"calls",width:80,align:"center"},{title:"Success Rate",dataIndex:"successRate",key:"successRate",width:100,align:"center"},{title:"Avg Latency",dataIndex:"latency",key:"latency",width:100,align:"center"},{title:"Cost",dataIndex:"cost",key:"cost",width:80,align:"right"}],dataSource:(a=e,(a.configurationSnapshots||[]).map((e,l)=>({id:l,model:`${e.provider}:${e.modelId}`,parameters:Object.entries(e.parameters).map(([e,a])=>`${e}:${a}`).join(", "),calls:Math.floor(a.progress.total/(a.configurationSnapshots?.length||1)),successRate:`${U(a)}%`,latency:B(a)+"ms",cost:`$${H(a)}`}))),pagination:!1,size:"small",rowKey:"id"})]);var a}return(e,a)=>{const l=R("a-button"),s=R("a-space"),v=R("a-tab-pane"),m=R("a-tabs"),y=R("a-tag"),g=R("a-progress"),O=R("a-table");return j(),h("div",fe,[b("div",me,[a[4]||(a[4]=b("div",{class:"header-content"},[b("h2",null,"Trial Results"),b("p",{class:"description"}," Analyze and export completed experimental results ")],-1)),b("div",ye,[f(s,null,{default:S(()=>[f(l,{onClick:K},{icon:S(()=>[f($(n))]),default:S(()=>[a[2]||(a[2]=C(" Refresh "))]),_:1,__:[2]}),f(l,{type:"primary",onClick:G,disabled:0===I.value.length},{icon:S(()=>[f($(r))]),default:S(()=>[a[3]||(a[3]=C(" Export All Data "))]),_:1,__:[3]},8,["disabled"])]),_:1})])]),f(m,{activeKey:o.value,"onUpdate:activeKey":a[0]||(a[0]=e=>o.value=e),size:"small",class:"status-tabs",onChange:D},{default:S(()=>[(j(),h(k,null,x(p,e=>f(v,{key:e.key,tab:`${e.label} (${L(e.key)})`},null,8,["tab"])),64))]),_:1},8,["activeKey"]),b("div",ge,[b("div",he,[f(O,{columns:$(T),"data-source":E.value,pagination:!1,size:"small",scroll:{y:"calc(100vh - 200px)"},"row-key":"id","row-class-name":J,class:"scientific-table",onRowClick:A,"expand-row-by-click":!1,"expanded-row-render":Y},{bodyCell:S(({column:e,record:s})=>{return["trial"===e.key?(j(),h("div",_e,[b("div",be,[b("strong",ke,w(s.name),1),f(y,{color:(r=s.status,{completed:"success",failed:"error",running:"processing",cancelled:"default",draft:"default",pending:"processing",paused:"warning"}[r]||"default"),size:"small",class:"trial-status-tag"},{default:S(()=>[C(w(s.status.toUpperCase()),1)]),_:2},1032,["color"])]),b("div",xe,[b("small",Ce," Design: "+w(s.designSnapshot?.originalName||"Unknown Design"),1)]),b("div",we,[b("small",Re," Created "+w(W(s.created)),1)])])):P("",!0),"progress"===e.key?(j(),h("div",Se,[b("div",je,[b("span",Te,w(s.progress.completed)+" ✓",1),b("span",Ee,w(s.progress.networkErrors)+" ✗",1),b("span",Ie,"/ "+w(s.progress.total),1)]),f(g,{percent:N(s),size:"small",status:(n=s,"failed"===n.status?"exception":"completed"===n.status?"success":n.progress.networkErrors>0?"exception":"normal"),"show-info":!1,class:"progress-bar"},null,8,["percent","status"]),b("div",Me,[C(w(N(s))+"% complete ",1),s.progress.networkErrors>0?(j(),h("span",Pe," ("+w(s.progress.networkErrors)+" errors) ",1)):P("",!0)])])):P("",!0),"success_rate"===e.key?(j(),h("div",$e,[b("div",Oe,w(U(s))+"%",1),f(g,{percent:U(s),size:"small","show-info":!1,"stroke-color":F(s),class:"success-rate-bar"},null,8,["percent","stroke-color"])])):P("",!0),"performance"===e.key?(j(),h("div",qe,[b("div",De,[a[5]||(a[5]=b("small",{class:"metric-label"},"Avg Latency",-1)),b("strong",ze,w(B(s))+"ms",1)]),b("div",Ae,[a[6]||(a[6]=b("small",{class:"metric-label"},"Throughput",-1)),b("strong",Le,w(V(s))+"/min",1)])])):P("",!0),"configurations"===e.key?(j(),h("div",Ne,[f(y,{size:"small",color:"blue"},{default:S(()=>[C(w(s.configurationSnapshots?.length||0)+" configs ",1)]),_:2},1024),s.repeatConfig?.callsPerPrompt&&s.repeatConfig.callsPerPrompt>1?(j(),M(y,{key:0,size:"small",color:"purple",style:{"margin-left":"4px"}},{default:S(()=>[C(w(s.repeatConfig.callsPerPrompt)+"× repeat ",1)]),_:2},1024)):P("",!0),b("div",Ue,[b("small",Fe,w(s.totalCombinations)+" variables ",1)])])):P("",!0),"cost"===e.key?(j(),h("div",Be,[b("span",{class:q(["cost-value",{negative:s.estimatedCost<0}])},[Math.abs(s.estimatedCost)>0?(j(),h(k,{key:0},[C(" $"+w(Math.abs(s.estimatedCost).toFixed(3)),1)],64)):(j(),h("span",Ve,"-"))],2),s.progress.total>0?(j(),h("small",He," $"+w(H(s))+"/call ",1)):P("",!0)])):P("",!0),"actions"===e.key?(j(),h("div",Je,[f(l,{size:"small",onClick:_(e=>function(e){t("view-results",e)}(s),["stop"])},{default:S(()=>a[7]||(a[7]=[C(" View Results ")])),_:2,__:[7]},1032,["onClick"]),f(l,{size:"small",onClick:_(e=>async function(e){c.value=e;try{d.value=await i.apiCalls.where("trialId").equals(e.id).toArray(),u.value=!0}catch(a){console.error("Failed to load API calls:",a)}}(s),["stop"])},{default:S(()=>a[8]||(a[8]=[C(" Data Export ")])),_:2,__:[8]},1032,["onClick"]),f(l,{size:"small",onClick:_(e=>function(e){t("export-trial",e,"python")}(s),["stop"])},{default:S(()=>a[9]||(a[9]=[C(" Python Export ")])),_:2,__:[9]},1032,["onClick"])])):P("",!0)];var n,r}),_:1},8,["columns","data-source"])])]),u.value&&c.value?(j(),M(ve,{key:0,trial:c.value,"api-calls":d.value,onClose:a[1]||(a[1]=e=>u.value=!1)},null,8,["trial","api-calls"])):P("",!0)])}}}),[["__scopeId","data-v-a31ee0a2"]]),Ke={class:"repeat-group"},Ge={class:"group-header"},Ye={class:"prompt-preview"},Xe={class:"prompt-text"},Qe={key:0,class:"group-stats"},Ze={key:0,class:"stats-range"},ea={class:"response-header"},aa={class:"response-index"},la={key:2,class:"latency"},ta={class:"response-content"},sa={key:0,class:"result-content"},na={class:"extracted-value"},ra={key:1,class:"raw-response"},ia={class:"response-text"},oa={key:2,class:"error-content"},ua=t(m({__name:"RepeatGroupResults",props:{calls:{},initialExpanded:{type:Boolean}},setup(e){const a=e,l=y(a.initialExpanded?[a.calls[0]?.id]:[]),t=g(()=>c(a.calls));function s(e,a=150){return e.length<=a?e:e.substring(0,a)+"..."}return(e,a)=>{const n=R("a-tag"),r=R("a-space"),i=R("a-statistic"),o=R("a-col"),u=R("a-row"),c=R("a-alert"),d=R("a-collapse-panel"),p=R("a-collapse");return j(),h("div",Ke,[b("div",Ge,[b("div",Ye,[a[1]||(a[1]=b("strong",null,"Prompt:",-1)),b("span",Xe,w(s(e.calls[0].prompt)),1)]),f(r,null,{default:S(()=>[f(n,{color:"blue"},{default:S(()=>[C(w(e.calls.length)+" responses",1)]),_:1}),100===t.value.consistencyScore?(j(),M(n,{key:0,color:"green"},{default:S(()=>a[2]||(a[2]=[C("Consistent")])),_:1,__:[2]})):t.value.consistencyScore>=80?(j(),M(n,{key:1,color:"orange"},{default:S(()=>a[3]||(a[3]=[C("Mostly Consistent")])),_:1,__:[3]})):(j(),M(n,{key:2,color:"red"},{default:S(()=>a[4]||(a[4]=[C("Varied")])),_:1,__:[4]}))]),_:1})]),e.calls.length>1?(j(),h("div",Qe,[f(u,{gutter:16},{default:S(()=>[f(o,{span:6},{default:S(()=>[f(i,{title:"Consistency",value:t.value.consistencyScore,suffix:"%",precision:1},null,8,["value"])]),_:1}),f(o,{span:6},{default:S(()=>[f(i,{title:"Avg Response Length",value:t.value.avgResponseLength},null,8,["value"])]),_:1}),f(o,{span:6},{default:S(()=>[f(i,{title:"Avg Response Time",value:t.value.avgResponseTime,suffix:"ms"},null,8,["value"])]),_:1}),f(o,{span:6},{default:S(()=>[f(i,{title:"Success Rate",value:t.value.successRate,suffix:"%"},null,8,["value"])]),_:1})]),_:1}),t.value.minResponseTime!==t.value.maxResponseTime?(j(),h("div",Ze,[b("span",null,"Response time range: "+w(t.value.minResponseTime)+"ms - "+w(t.value.maxResponseTime)+"ms",1)])):P("",!0)])):P("",!0),f(p,{activeKey:l.value,"onUpdate:activeKey":a[0]||(a[0]=e=>l.value=e),style:{"margin-top":"16px"}},{default:S(()=>[(j(!0),h(k,null,x(e.calls,(e,l)=>(j(),M(d,{key:e.id},{header:S(()=>[b("div",ea,[b("span",aa,"Response "+w(l+1),1),f(r,{size:"small"},{default:S(()=>[e.result?.success?(j(),M(n,{key:0,color:"success",size:"small"},{default:S(()=>a[5]||(a[5]=[C("Success")])),_:1,__:[5]})):(j(),M(n,{key:1,color:"error",size:"small"},{default:S(()=>a[6]||(a[6]=[C("Failed")])),_:1,__:[6]})),e.response?.latencyMs?(j(),h("span",la,w(e.response.latencyMs)+"ms",1)):P("",!0)]),_:2},1024)])]),default:S(()=>[b("div",ta,[e.result?.content?(j(),h("div",sa,[a[7]||(a[7]=b("h4",null,"Extracted Result:",-1)),b("div",na,w(e.result.content),1)])):P("",!0),e.response?.body?.choices?.[0]?.message?.content?(j(),h("div",ra,[a[8]||(a[8]=b("h4",null,"Full Response:",-1)),b("pre",ia,w(e.response.body.choices[0].message.content),1)])):e.result?.error?(j(),h("div",oa,[f(c,{type:"error","show-icon":""},{message:S(()=>[C(w(e.result.error),1)]),_:2},1024)])):P("",!0)])]),_:2},1024))),128))]),_:1},8,["activeKey"])])}}}),[["__scopeId","data-v-dbf18579"]]),ca={class:"results-table-container"},da={class:"filters-bar"},pa={key:0,class:"grouped-results"},va={key:0,class:"loading-container"},fa={key:1},ma={key:1},ya={key:2,class:"variables-compact"},ga={key:0,class:"text-secondary"},ha={key:1,class:"text-secondary"},_a={key:2,class:"text-error"},ba={key:3,class:"response-content"},ka={key:4,class:"text-secondary"},xa={key:0,class:"length-value"},Ca={key:1,class:"text-secondary"},wa={key:0},Ra={key:1,class:"text-secondary"},Sa=t(m({__name:"TrialResultsTable",props:{trial:{},apiCalls:{},loading:{type:Boolean}},setup(e){const a=e,l=y(""),t=y(""),s=y(""),n=y(!1),r=y(null),i=[{title:"Status",key:"status",width:100,fixed:"left"},{title:"Config",key:"config",width:150},{title:"Variables",key:"variables",width:400},{title:"Response",key:"response",ellipsis:!0},{title:"Length",key:"length",width:80,align:"right"},{title:"Latency",key:"latency",width:80,align:"right"}],u=g(()=>d(c.value)),c=g(()=>{let e=a.apiCalls;if(l.value&&(e=e.filter(e=>e.status===l.value)),""!==t.value&&(e=e.filter(e=>e.configurationIndex===Number(t.value))),s.value){const a=s.value.toLowerCase();e=e.filter(e=>{if(JSON.stringify(e.variables).toLowerCase().includes(a))return!0;if(e.result?.content){if(String(e.result.content).toLowerCase().includes(a))return!0}return!1})}return e});function v(e){const l=a.trial.configurationSnapshots[e];return l?.name||`Config ${e+1}`}return(e,a)=>{const d=R("a-select-option"),m=R("a-select"),y=R("a-input-search"),g=R("a-space"),_=R("a-button"),T=R("a-spin"),E=R("a-tag"),I=R("a-tooltip"),O=R("a-table");return j(),h("div",ca,[b("div",da,[f(g,null,{default:S(()=>[f(m,{value:l.value,"onUpdate:value":a[0]||(a[0]=e=>l.value=e),placeholder:"All Statuses",style:{width:"150px"},size:"small","allow-clear":""},{default:S(()=>[f(d,{value:""},{default:S(()=>a[6]||(a[6]=[C("All Statuses")])),_:1,__:[6]}),f(d,{value:"completed"},{default:S(()=>a[7]||(a[7]=[C("Completed")])),_:1,__:[7]}),f(d,{value:"failed"},{default:S(()=>a[8]||(a[8]=[C("Failed")])),_:1,__:[8]}),f(d,{value:"running"},{default:S(()=>a[9]||(a[9]=[C("Running")])),_:1,__:[9]}),f(d,{value:"pending"},{default:S(()=>a[10]||(a[10]=[C("Pending")])),_:1,__:[10]})]),_:1},8,["value"]),f(m,{value:t.value,"onUpdate:value":a[1]||(a[1]=e=>t.value=e),placeholder:"All Configurations",style:{width:"200px"},size:"small","allow-clear":""},{default:S(()=>[f(d,{value:""},{default:S(()=>a[11]||(a[11]=[C("All Configurations")])),_:1,__:[11]}),(j(!0),h(k,null,x(e.trial.configurationSnapshots,(e,a)=>(j(),M(d,{key:a,value:a},{default:S(()=>[C(w(e.name||`Config ${a+1}`),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),f(y,{value:s.value,"onUpdate:value":a[2]||(a[2]=e=>s.value=e),placeholder:"Search variables or response...",style:{width:"300px"},size:"small","allow-clear":""},null,8,["value"])]),_:1}),f(_,{size:"small",onClick:a[3]||(a[3]=e=>n.value=!0)},{icon:S(()=>[f($(H))]),default:S(()=>[a[12]||(a[12]=C(" Export Data "))]),_:1,__:[12]})]),$(p)(e.trial)?(j(),h("div",pa,[e.loading?(j(),h("div",va,[f(T,{size:"large"})])):(j(),h("div",fa,[(j(!0),h(k,null,x(u.value,([e,a])=>(j(),M(ua,{key:e,calls:a,"initial-expanded":1===u.value.size},null,8,["calls","initial-expanded"]))),128))]))])):(j(),M(O,{key:1,columns:i,"data-source":c.value,loading:e.loading,pagination:!1,scroll:{y:"calc(100vh - 350px)",x:1400},size:"small","row-key":"id",class:"results-table","custom-row":e=>({onClick:()=>{return a=e,void(r.value=a);var a},class:"clickable-row"})},{bodyCell:S(({column:e,record:l})=>{return["status"===e.key?(j(),M(E,{key:0,color:(t=l.status,{completed:"success",failed:"error",running:"processing",pending:"default"}[t]||"default"),size:"small"},{default:S(()=>[C(w(l.status.toUpperCase()),1)]),_:2},1032,["color"])):P("",!0),"config"===e.key?(j(),h("code",ma,w(v(l.configurationIndex)),1)):P("",!0),"variables"===e.key?(j(),h("div",ya,[(j(!0),h(k,null,x(l.variables,(e,a)=>(j(),M(I,{key:a},{title:S(()=>[C(w(a)+": "+w(e),1)]),default:S(()=>[f(E,{size:"small"},{default:S(()=>{return[C(w(a)+": "+w((l=String(e),t=15,l.length<=t?l:l.substring(0,t)+"...")),1)];var l,t}),_:2},1024)]),_:2},1024))),128))])):P("",!0),"response"===e.key?(j(),h(k,{key:3},["pending"===l.status?(j(),h("div",ga," Waiting... ")):"running"===l.status?(j(),h("div",ha,[f($(o)),a[13]||(a[13]=C(" Processing... "))])):"failed"===l.status?(j(),h("div",_a,w(l.result?.error||"API call failed"),1)):l.result?.content?(j(),h("div",ba,[b("span",null,w(String(l.result.content)),1)])):(j(),h("div",ka," No content "))],64)):P("",!0),"length"===e.key?(j(),h(k,{key:4},[l.result?.content?(j(),h("span",xa,w(String(l.result.content).length),1)):(j(),h("span",Ca,"-"))],64)):P("",!0),"latency"===e.key?(j(),h(k,{key:5},[l.response?.latencyMs?(j(),h("span",wa,w(l.response.latencyMs)+"ms ",1)):(j(),h("span",Ra,"-"))],64)):P("",!0)];var t}),_:1},8,["data-source","loading","custom-row"])),n.value?(j(),M(ve,{key:2,trial:e.trial,"api-calls":c.value,onClose:a[4]||(a[4]=e=>n.value=!1)},null,8,["trial","api-calls"])):P("",!0),r.value?(j(),M(A,{key:3,"api-call":r.value,trial:e.trial,onClose:a[5]||(a[5]=e=>r.value=null)},null,8,["api-call","trial"])):P("",!0)])}}}),[["__scopeId","data-v-bd7b561d"]]),ja={class:"trial-analysis"},Ta={class:"stats-summary"},Ea=t(m({__name:"TrialAnalysisView",props:{trial:{},apiCalls:{},loading:{type:Boolean}},emits:["back-to-selection","export-trial"],setup(e){const a=e,l=g(()=>a.apiCalls.filter(e=>"completed"===e.status).length),t=g(()=>a.apiCalls.filter(e=>"failed"===e.status).length),s=g(()=>{const e=l.value+t.value;return 0===e?0:Math.round(l.value/e*100)}),n=g(()=>{const e=a.apiCalls.filter(e=>e.response?.latencyMs);if(0===e.length)return 0;const l=e.reduce((e,a)=>e+(a.response?.latencyMs||0),0);return Math.round(l/e.length)}),r=g(()=>a.trial.progress.completed*(a.trial.estimatedCost/a.trial.progress.total));return(e,a)=>{const i=R("a-statistic"),o=R("a-divider");return j(),h("div",ja,[b("div",Ta,[f(i,{title:"Success Rate",value:s.value,suffix:"%","value-style":{color:s.value>=90?"#52c41a":s.value>=70?"#faad14":"#ff4d4f"}},null,8,["value","value-style"]),f(o,{type:"vertical"}),f(i,{title:"Completed",value:l.value,suffix:`/ ${e.trial.progress.total}`},null,8,["value","suffix"]),f(o,{type:"vertical"}),f(i,{title:"Failed",value:t.value,"value-style":{color:t.value>0?"#ff4d4f":"#52c41a"}},null,8,["value","value-style"]),f(o,{type:"vertical"}),f(i,{title:"Avg Latency",value:n.value,suffix:"ms"},null,8,["value"]),f(o,{type:"vertical"}),f(i,{title:"Total Cost",value:r.value,prefix:"$",precision:4},null,8,["value"])]),f(Sa,{trial:e.trial,"api-calls":e.apiCalls,loading:e.loading},null,8,["trial","api-calls","loading"])])}}}),[["__scopeId","data-v-29db9da1"]]),Ia={class:"results-view full-width"},Ma={key:0,class:"results-table-view"},Pa={key:1,class:"analysis-view"},$a={class:"analysis-header"},Oa={class:"analysis-title"},qa=t(m({__name:"ResultsView",setup(e){const a=v(),t=y("table"),s=y(null),n=y(null),o=y([]),c=y([]),d=y(!1),p=y(!1),m=y("all"),g=y(!1),_=y(!1),k=y(!1),x=y(null),T=y(null);async function E(){d.value=!0;try{await a.initialize(),o.value=a.trials}catch(e){console.error("Failed to load trials:",e)}finally{d.value=!1}}async function I(e){!function(e){s.value=e.id,n.value=e}(e),t.value="analysis",await async function(){if(s.value){p.value=!0;try{c.value=await i.apiCalls.where("trialId").equals(s.value).toArray()}catch(e){console.error("Failed to load results:",e)}finally{p.value=!1}}}()}function O(){t.value="table",s.value=null,n.value=null,c.value=[]}function q(e,a){x.value=e,"python"===a?g.value=!0:W(e)}function z(e){T.value=e,k.value=!0}function A(e){n.value=e,_.value=!0}function F(){}function B(e){m.value=e}function V(e){g.value=!1,x.value=null}function H(){E()}function J(e){k.value=!1,T.value=null,E()}async function W(e){try{const{PythonExportService:a}=await l(async()=>{const{PythonExportService:e}=await import("./APICallDetailModal-BGCLw6Ck.js").then(e=>e.p);return{PythonExportService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]),import.meta.url);await a.downloadPythonScript(e)}catch(a){console.error("Export failed:",a),alert("Export failed: "+(a instanceof Error?a.message:"Unknown error"))}}async function K(e){if(confirm(`Delete trial "${e.name}"? This cannot be undone.`))try{await a.deleteTrial(e.id),s.value===e.id&&O()}catch(l){console.error("Failed to delete trial:",l),alert("Failed to delete trial")}}return D(()=>{E()}),(e,a)=>{const l=R("a-button"),s=R("a-tag"),i=R("a-space");return j(),h("div",Ia,["table"===t.value?(j(),h("div",Ma,[f(We,{trials:o.value,loading:d.value,onViewResults:I,onExportTrial:q,onDuplicateTrial:z,onDeleteTrial:K,onTrialDetails:A,onRefreshTrials:E,onExportAll:F,onStatusFilterChanged:B},null,8,["trials","loading"])])):"analysis"===t.value&&n.value?(j(),h("div",Pa,[b("div",$a,[f(l,{onClick:O,type:"default",class:"back-button"},{icon:S(()=>[f($(u))]),default:S(()=>[a[4]||(a[4]=C(" Back to Results "))]),_:1,__:[4]}),b("div",Oa,[b("h2",null,w(n.value.name),1),f(s,{color:(v=n.value.status,{completed:"success",failed:"error",running:"processing",cancelled:"default",draft:"default",pending:"processing",paused:"warning"}[v]||"default"),size:"small"},{default:S(()=>[C(w(n.value.status.toUpperCase()),1)]),_:1},8,["color"])]),f(i,null,{default:S(()=>[f(l,{class:"btn-success",onClick:a[0]||(a[0]=e=>W(n.value))},{icon:S(()=>[f($(r))]),default:S(()=>[a[5]||(a[5]=C(" Export Results "))]),_:1,__:[5]})]),_:1})]),f(Ea,{trial:n.value,"api-calls":c.value,loading:p.value,onBackToSelection:O,onExportTrial:W},null,8,["trial","api-calls","loading"])])):P("",!0),g.value&&x.value?(j(),M(L,{key:2,trial:x.value,onClose:a[1]||(a[1]=e=>{g.value=!1,x.value=null}),onExported:V},null,8,["trial"])):P("",!0),_.value&&n.value?(j(),M(N,{key:3,trial:n.value,onClose:a[2]||(a[2]=e=>_.value=!1),onUpdated:H},null,8,["trial"])):P("",!0),k.value?(j(),M(U,{key:4,trialToDuplicate:T.value,onClose:a[3]||(a[3]=e=>{k.value=!1,T.value=null}),onCreated:J},null,8,["trialToDuplicate"])):P("",!0)]);var v}}}),[["__scopeId","data-v-78779ebc"]]);export{qa as default};
