const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./PythonExportService-0kEakrrK.js","./index-DWYxkL85.js","./vendor-DdqHZeTC.js","./db-ftwlfnxb.js","./index-zWy5gnVS.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,a,n)=>((t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n)(t,"symbol"!=typeof a?a+"":a,n);import{Y as a,r as n,B as s,i as o,d as l,b as i,e as r,f as c,g as u,m as d,V as p,F as m,D as v,n as g,t as b,w as h,o as y,k as f,X as C,Z as _,v as k,q as x,I as w,u as S,_ as E,$ as M,p as O}from"./vendor-DdqHZeTC.js";import{u as R}from"./runs-DeWMqA4S.js";import{D as P,d as T,_ as I,a as D,u as F,b as V}from"./index-DWYxkL85.js";import{u as $}from"./variableLists-CQERIwvm.js";import"./db-ftwlfnxb.js";const A=class e{constructor(){t(this,"dbService"),this.dbService=P.getInstance()}static getInstance(){return e.instance||(e.instance=new e),e.instance}async calculateExperimentMetrics(e,t=[]){let a=1,n=0,s=0;const o=e.variables||{};for(const[i,r]of Object.entries(o))Array.isArray(r)&&r.length>0&&(a*=r.length,n++);const l=e.variable_list_refs||{};for(const[i,r]of Object.entries(l)){let e=t.find(e=>e.id===r);if(!e){const t=await this.dbService.read("variable_lists",r);t.success&&t.data&&(e=t.data)}e&&e.values&&e.values.length>0&&(a*=e.values.length,s++)}return{totalCombinations:a,variableCount:n+s,simpleVariables:n,compoundVariables:s,estimatedTasks:a}}async estimateExperimentCost(e,t,a=[],n={}){const s=await this.calculateExperimentMetrics(e,a),o=s.totalCombinations*t.length,{estimatedInputTokens:l=100,estimatedOutputTokens:i=50}=n;let r=0;const c={};for(const u of t){const e="openrouter"===u.provider?u.input_cost||0:(u.input_cost||0)/1e6,t="openrouter"===u.provider?u.output_cost||0:(u.output_cost||0)/1e6;console.log(`DEBUG: Model ${u.id}, provider: ${u.provider}`),console.log(`DEBUG: Raw costs - input: ${u.input_cost}, output: ${u.output_cost}`),console.log(`DEBUG: Per-token costs - input: ${e}, output: ${t}`);const a=e*l*s.totalCombinations,n=t*i*s.totalCombinations,o=a+n;console.log(`DEBUG: Final costs - input: ${a}, output: ${n}, total: ${o}`),c[u.id]=o,r+=o}return{totalCost:r,costPerModel:c,costPerTask:o>0?r/o:0,breakdown:{inputTokens:l*o,outputTokens:i*o,requests:o}}}validateExperimentSize(e,t){const a=e.totalCombinations*t,n=[],s=[];return a>1e3&&n.push(`Large experiment: ${a} tasks may take significant time`),a>1e4&&n.push("Very large experiment: Consider running in batches"),a>5e4&&s.push(`Experiment too large: ${a} tasks exceeds maximum of 50,000`),e.totalCombinations>1e5&&s.push(`Too many variable combinations: ${e.totalCombinations} exceeds maximum of 100,000`),{valid:0===s.length,warnings:n,errors:s}}};t(A,"instance");let B=A;function U(e,t){let a=e;for(const[n,s]of Object.entries(t)){const e=new RegExp(`{{\\s*${n}\\s*}}`,"g"),t=Array.isArray(s)?s.join(", "):String(s);a=a.replace(e,t)}return function(e){const t=e.split(/\s+/);let a=0;for(const s of t)0!==s.length&&(s.length<=4?a+=1:s.length<=8?a+=Math.ceil(s.length/4):a+=Math.ceil(s.length/3.5));const n=e.match(/[.,!?;:'"()\[\]{}<>@#$%^&*+=|\\\/~`-]/g);return n&&(a+=.5*n.length),Math.ceil(a)}(a)}const L=class e{constructor(){t(this,"experimentService"),this.experimentService=B.getInstance()}static getInstance(){return e.instance||(e.instance=new e),e.instance}async estimateRunCost(e,t,a,n={}){if(0===t.length)return this.createEmptyResult();const s=await this.experimentService.calculateExperimentMetrics(e,a),o=await this.calculateInputTokens(e,n),l=n.estimatedOutputTokens||25,i=n.repetitionsPerPrompt||1,r=[];let c=0;for(const d of t){const e=this.calculateModelCost(d,o,l,s.totalCombinations,i);r.push(e),c+=e.totalCost}const u=s.totalCombinations*t.length*i;return{totalCost:c,averageCostPerTask:u>0?c/u:0,totalTasks:u,totalCombinations:s.totalCombinations,breakdown:r}}estimateQuickCost(e,t,a,n,s=1){let o=0;for(const l of e){o+=this.calculateModelCost(l,a,n,t,s).totalCost}return o}calculateModelCost(e,t,a,n,s){const o=this.getInputCostPerToken(e)*t+this.getOutputCostPerToken(e)*a,l=o*n*s;return{model:e.name,modelId:e.id,inputTokens:t,outputTokens:a,costPerTask:o,totalCost:l}}getInputCostPerToken(e){return e.input_cost?"openrouter"===e.provider?e.input_cost:e.input_cost/1e6:0}getOutputCostPerToken(e){return e.output_cost?"openrouter"===e.provider?e.output_cost:e.output_cost/1e6:0}async calculateInputTokens(e,t){if(t.estimatedInputTokens)return t.estimatedInputTokens;if(!e.prompt_template)return 100;const a=t.sampleVariables||this.createSampleVariables(e);return U(e.prompt_template,a)}createSampleVariables(e){const t={},a=e.variables||{};for(const[n,s]of Object.entries(a))Array.isArray(s)&&s.length>0?t[n]=s[0]:t[n]="string"==typeof s?s:"sample";return t}createEmptyResult(){return{totalCost:0,averageCostPerTask:0,totalTasks:0,totalCombinations:0,breakdown:[]}}formatCost(e){return e<.001?e.toFixed(6):e<.01?e.toFixed(4):e<1?e.toFixed(3):e.toFixed(2)}formatModelCost(e,t){const a="input"===t?e.input_cost:e.output_cost;if(void 0===a)return"?";const n="openrouter"===e.provider?1e6*a:a;return n<.01?n.toFixed(4):n<1?n.toFixed(3):n<10?n.toFixed(2):n.toFixed(1)}};t(L,"instance");let j=L;const N=class e{constructor(){t(this,"calculationState",n({isCalculating:!1,lastCalculationTime:0,requestId:null})),t(this,"cachedResults",n(new Map)),t(this,"experimentService",B.getInstance()),t(this,"costService",j.getInstance()),t(this,"debounceTimer",null),t(this,"DEBOUNCE_MS",150)}static getInstance(){return e.instance||(e.instance=new e),e.instance}async calculateRunMetrics(e,t,a,n={}){const s=this.generateCacheKey(e,t,n),o=this.cachedResults.value.get(s);if(o&&Date.now()-this.calculationState.value.lastCalculationTime<5e3)return o;if(this.calculationState.value.isCalculating)return console.log("ðŸš« Calculation already in progress, returning cached or default"),o||this.getDefaultResult();const l=Math.random().toString(36).substr(2,9);this.calculationState.value={isCalculating:!0,lastCalculationTime:Date.now(),requestId:l};try{if(!e)return this.getDefaultResult();const o=await this.experimentService.calculateExperimentMetrics(e,a),l=o.totalCombinations*t.length*(n.repetitions_per_prompt||1);let i=0;if(t.length>0){i=(await this.costService.estimateRunCost(e,t,a,{estimatedOutputTokens:n.max_tokens||25,repetitionsPerPrompt:n.repetitions_per_prompt||1})).totalCost}const r={taskCount:l,estimatedCost:i,totalCombinations:o.totalCombinations,error:null};return this.cachedResults.value.set(s,r),r}catch(i){console.error("RunCoordinator calculation failed:",i);return{taskCount:0,estimatedCost:0,totalCombinations:0,error:i instanceof Error?i.message:"Calculation failed"}}finally{this.calculationState.value={isCalculating:!1,lastCalculationTime:Date.now(),requestId:null}}}calculateRunMetricsDebounced(e,t,a,n={}){return new Promise(s=>{this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(async()=>{const o=await this.calculateRunMetrics(e,t,a,n);s(o)},this.DEBOUNCE_MS)})}async updateActiveRun(e,t){try{await T.runs.update(e,{...t,updated_at:(new Date).toISOString()})}catch(a){throw console.error("RunCoordinator: Failed to update active run:",a),a}}async getActiveRunStatus(e){try{return await T.runs.get(e)||null}catch(t){return console.error("RunCoordinator: Failed to get run status:",t),null}}clearCache(){this.cachedResults.value.clear(),console.log("RunCoordinator: Cache cleared")}getCalculationState(){return this.calculationState.value}generateCacheKey(e,t,a){return`${e?.id||"null"}:${t.map(e=>e.id).sort().join(",")}:${JSON.stringify(a)}`}getDefaultResult(){return{taskCount:0,estimatedCost:0,totalCombinations:0,error:null}}};t(N,"instance");const q=N.getInstance();q.calculateRunMetrics.bind(q),q.calculateRunMetricsDebounced.bind(q),q.updateActiveRun.bind(q),q.getActiveRunStatus.bind(q);const Q=class e{static getInstance(){return e.instance||(e.instance=new e),e.instance}getQuickFilters(){return[{id:"all",label:"All Models",filterFn:()=>!0},{id:"openai",label:"OpenAI",filterFn:e=>e.provider.toLowerCase().includes("openai")},{id:"anthropic",label:"Anthropic",filterFn:e=>e.provider.toLowerCase().includes("anthropic")},{id:"budget",label:"Budget",filterFn:e=>(e.input_cost||0)<.001},{id:"premium",label:"Premium",filterFn:e=>(e.input_cost||0)>=.001},{id:"ollama",label:"Ollama",filterFn:e=>e.provider.toLowerCase().includes("ollama")},{id:"openrouter",label:"OpenRouter",filterFn:e=>e.provider.toLowerCase().includes("openrouter")}]}filterModels(e,t={}){const{searchQuery:a="",activeFilterId:n="",sortByProvider:s=!0}=t;let o=[...e];if(a.trim()){const e=a.toLowerCase();o=o.filter(t=>t.name.toLowerCase().includes(e)||t.provider.toLowerCase().includes(e))}if(n&&"all"!==n){const e=this.getQuickFilters().find(e=>e.id===n);e&&(o=o.filter(e.filterFn))}return{models:o,modelsByProvider:this.groupModelsByProvider(o,s),totalCount:e.length,filteredCount:o.length}}groupModelsByProvider(e,t=!0){const a={};if(e.forEach(e=>{a[e.provider]||(a[e.provider]=[]),a[e.provider].push(e)}),Object.keys(a).forEach(e=>{a[e].sort((e,t)=>e.name.localeCompare(t.name))}),t){const e={};return Object.keys(a).sort().forEach(t=>{e[t]=a[t]}),e}return a}smartSort(e){return e.every(e=>!isNaN(Number(e))&&""!==e.trim())?e.sort((e,t)=>Number(e)-Number(t)):e.sort()}getProviderStats(e){const t={},a={};return e.forEach(e=>{t[e.provider]||(t[e.provider]={count:0,avgCost:0},a[e.provider]=[]),t[e.provider].count++,void 0!==e.input_cost&&a[e.provider].push(e.input_cost)}),Object.keys(t).forEach(e=>{const n=a[e];n.length>0&&(t[e].avgCost=n.reduce((e,t)=>e+t,0)/n.length)}),t}filterByCapabilities(e,t){return e.filter(e=>(void 0===t.supportsFunctionCalling||e.supports_function_calling===t.supportsFunctionCalling)&&((void 0===t.supportsJsonMode||e.supports_json_mode===t.supportsJsonMode)&&(!(void 0!==t.minContextWindow&&(e.context_window||0)<t.minContextWindow)&&!(void 0!==t.maxContextWindow&&(e.context_window||0)>t.maxContextWindow))))}getSuggestedModels(e,t){let a=[...e];return"json"===t?.output_format&&(a=a.filter(e=>e.supports_json_mode||e.supports_function_calling)),t?.estimated_cost_budget&&(a=a.filter(e=>(e.input_cost||0)<=t.estimated_cost_budget)),a.sort((e,t)=>{const a={OpenAI:1,Anthropic:2,OpenRouter:3,Ollama:4},n=a[e.provider]||999,s=a[t.provider]||999;return n!==s?n-s:e.name.localeCompare(t.name)}),a.slice(0,10)}};t(Q,"instance");let J=Q;const G={class:"model-search-and-filters"},z={class:"search-and-filters"},W={class:"search-box"},K={class:"quick-filters"},Z=["onClick"],X={class:"selection-summary"},Y={class:"selected-count"},H={key:0,class:"filter-info"},ee=I(l({__name:"ModelSearchAndFilters",props:{searchQuery:{},activeFilter:{},selectedModels:{},allModels:{}},emits:["update:search-query","update:active-filter","clear-selection","expand-providers"],setup(e,{emit:t}){const a=e,l=t,h=J.getInstance(),y=n(a.searchQuery),f=o(()=>h.getQuickFilters()),C=o(()=>{const e=h.filterModels(a.allModels,{searchQuery:a.searchQuery,activeFilterId:a.activeFilter});return{totalCount:e.totalCount,filteredCount:e.filteredCount}});function _(){l("update:search-query",y.value)}function k(e){l("update:active-filter",e.id);const t=function(e){switch(e){case"openai":return["OpenAI"];case"anthropic":return["Anthropic"];case"ollama":return["Ollama"];case"openrouter":return["OpenRouter"];case"all":return Object.keys(h.filterModels(a.allModels,{activeFilterId:"all"}).modelsByProvider);default:return[]}}(e.id);t.length>0&&l("expand-providers",t)}return s(()=>a.searchQuery,e=>{y.value=e}),(e,t)=>(r(),i("div",G,[c("div",z,[c("div",W,[d(c("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>y.value=e),type:"text",class:"search-input",placeholder:"Search models...",onInput:_},null,544),[[p,y.value]])]),c("div",K,[(r(!0),i(m,null,v(f.value,t=>(r(),i("button",{key:t.id,class:g(["filter-btn",{active:e.activeFilter===t.id}]),onClick:e=>k(t)},b(t.label),11,Z))),128))])]),c("div",X,[c("span",Y,b(e.selectedModels.length)+" models selected",1),e.selectedModels.length>0?(r(),i("button",{key:0,class:"clear-btn",onClick:t[1]||(t[1]=t=>e.$emit("clear-selection"))}," Clear All ")):u("",!0)]),C.value.filteredCount!==C.value.totalCount?(r(),i("div",H," Showing "+b(C.value.filteredCount)+" of "+b(C.value.totalCount)+" models ",1)):u("",!0)]))}}),[["__scopeId","data-v-c5ed8196"]]),te={class:"model-provider-grid"},ae=["onClick"],ne={class:"provider-controls"},se={class:"model-count"},oe={key:0,class:"selection-indicator"},le={class:"selected-count"},ie=["onClick"],re={key:0,class:"models-list"},ce=["onClick"],ue={class:"model-info"},de={class:"model-details"},pe={key:0,class:"cost-info"},me={key:1,class:"context-info"},ve={key:2,class:"capabilities"},ge={key:0,class:"capability"},be={key:1,class:"capability"},he={class:"selection-indicator"},ye={key:0},fe=I(l({__name:"ModelProviderGrid",props:{modelsByProvider:{},selectedModels:{},expandedProviders:{},getProviderSelectionStats:{type:Function}},emits:["toggle-model","toggle-provider","select-all-provider"],setup(e){const t=e,a=j.getInstance(),n=o(()=>{const e={};return Object.entries(t.modelsByProvider).forEach(([a,n])=>{const s=t.getProviderSelectionStats(n);e[a]={selected:s.selected,total:s.total}}),e});function s(e){const t=n.value[e];return t?0===t.selected?"Select All":t.selected===t.total?"Deselect All":"Select All":"Select All"}function l(e,t){return a.formatModelCost(e,t)}return(e,t)=>(r(),i("div",te,[(r(!0),i(m,null,v(e.modelsByProvider,(t,a)=>(r(),i("div",{key:a,class:"provider-section"},[c("div",{class:"provider-header",onClick:t=>e.$emit("toggle-provider",a)},[c("h4",null,b(a),1),c("div",ne,[c("span",se,b(t.length)+" models",1),n.value[a]?(r(),i("div",oe,[c("span",le,b(n.value[a].selected)+"/"+b(n.value[a].total),1)])):u("",!0),c("button",{class:"select-all-btn",onClick:h(n=>e.$emit("select-all-provider",a,t),["stop"])},b(s(a)),9,ie),c("span",{class:g(["expand-icon",{expanded:e.expandedProviders.has(a)}])}," â–¼ ",2)])],8,ae),e.expandedProviders.has(a)?(r(),i("div",re,[(r(!0),i(m,null,v(t,t=>{return r(),i("div",{key:t.id,class:g(["model-card",{selected:e.selectedModels.includes(t.id),"cost-available":void 0!==t.input_cost}]),onClick:a=>e.$emit("toggle-model",t.id)},[c("div",ue,[c("h5",null,b(t.name),1),c("div",de,[void 0!==t.input_cost?(r(),i("span",pe," $"+b(l(t,"input"))+"/$"+b(l(t,"output")),1)):u("",!0),t.context_window?(r(),i("span",me,b((a=t.context_window,a>=1e6?`${(a/1e6).toFixed(1)}M`:a>=1e3?`${(a/1e3).toFixed(0)}K`:a.toString()))+" context ",1)):u("",!0),t.supports_function_calling||t.supports_json_mode?(r(),i("div",ve,[t.supports_function_calling?(r(),i("span",ge,"Functions")):u("",!0),t.supports_json_mode?(r(),i("span",be,"JSON")):u("",!0)])):u("",!0)])]),c("div",he,[c("div",{class:g(["checkbox",{checked:e.selectedModels.includes(t.id)}])},[e.selectedModels.includes(t.id)?(r(),i("span",ye,"âœ“")):u("",!0)],2)])],10,ce);var a}),128))])):u("",!0)]))),128))]))}}),[["__scopeId","data-v-095a4d24"]]),Ce={class:"run-modal-proper"},_e={class:"modal-header"},ke={class:"modal-main"},xe={class:"left-panel"},we={class:"option-group"},Se={class:"field"},Ee={class:"field"},Me=["value"],Oe={class:"option-group"},Re={class:"params-grid"},Pe={class:"param-field"},Te={class:"param-field"},Ie={class:"param-field"},De={class:"param-field"},Fe={class:"option-group"},Ve={class:"radio-group"},$e={class:"radio-option"},Ae={class:"radio-option"},Be={key:0,class:"option-group python-options"},Ue={class:"checkbox-grid"},Le={class:"checkbox-option"},je={class:"checkbox-option"},Ne={class:"checkbox-option"},qe={class:"checkbox-option"},Qe={class:"checkbox-option"},Je={class:"params-grid"},Ge={class:"param-field"},ze={class:"param-field"},We={class:"param-field"},Ke={class:"param-field"},Ze={class:"right-panel"},Xe={class:"bottom-summary"},Ye={class:"summary-split"},He={class:"table-section"},et={key:0,class:"models-table-container"},tt={class:"models-table"},at={class:"model-name"},nt={class:"provider"},st={class:"cost"},ot={class:"cost"},lt={class:"tasks"},it={class:"model-cost"},rt={key:1,class:"no-models-message"},ct={class:"summary-section"},ut={class:"totals-card"},dt={class:"total-item"},pt={class:"total-value"},mt={class:"total-item"},vt={class:"total-value"},gt={class:"total-item"},bt={class:"total-value"},ht={class:"total-item highlight"},yt={class:"total-value"},ft={class:"total-item highlight cost"},Ct={class:"total-value"},_t={class:"modal-footer"},kt={class:"footer-left"},xt={key:0,class:"validation-error"},wt={class:"footer-actions"},St=["disabled"],Et=I(l({__name:"RunModalProper",props:{run:{},preselectedModelIds:{},preselectedDesignId:{}},emits:["close","saved"],setup(e,{emit:t}){const l=e,w=t,S=D(),E=F(),M=R(),O=$(),P=J.getInstance(),{formData:T,initializeState:I,updateModelSelection:A}=function(e,t,n){const s=a({name:"",design_id:null,models:[],parameters:{temperature:.7,max_tokens:25,concurrency:3,repetitions_per_prompt:1},executionType:"browser",pythonExportOptions:{outputFormat:"both",enableProgressBar:!0,verboseLogging:!1,enableCheckpointing:!0,maxRetries:3,retryBackoffMultiplier:2,continueOnError:!0,pythonVersion:"3.9+",includeApiLogs:!1}});return{formData:s,initializeState:async a=>{e?(s.name=e.name,s.design_id=e.design_id,s.models=e.models||[],s.parameters={...s.parameters,...e.parameters,repetitions_per_prompt:e.parameters.repetitions_per_prompt??1}):(n&&(s.design_id=n,a&&(s.name=await a(n))),t&&(s.models=[...t]))},updateBasicConfig:e=>{Object.assign(s,e)},updateModelSelection:e=>{s.models=[...e]},updateParameters:e=>{Object.assign(s.parameters,e)},updatePythonOptions:e=>{Object.assign(s.pythonExportOptions,e)},resetState:()=>{s.name="",s.design_id=null,s.models=[],s.parameters={temperature:.7,max_tokens:25,concurrency:3,repetitions_per_prompt:1},s.executionType="browser"}}}(l.run,l.preselectedModelIds,l.preselectedDesignId),B=function(e){const t=o(()=>e.name.trim().length>0),a=o(()=>null!==e.design_id),n=o(()=>e.models.length>0),s=o(()=>{const{temperature:t,max_tokens:a,concurrency:n,repetitions_per_prompt:s}=e.parameters;return t>=0&&t<=2&&a>0&&a<=4e3&&n>0&&n<=10&&s>0&&s<=10}),l=o(()=>t.value&&a.value&&n.value&&s.value),i=o(()=>{const o=[];if(t.value||o.push("Run name is required"),a.value||o.push("Please select a design"),n.value||o.push("Please select at least one model"),!s.value){const{temperature:t,max_tokens:a,concurrency:n,repetitions_per_prompt:s}=e.parameters;(t<0||t>2)&&o.push("Temperature must be between 0 and 2"),(a<=0||a>4e3)&&o.push("Max tokens must be between 1 and 4000"),(n<=0||n>10)&&o.push("Concurrency must be between 1 and 10"),(s<=0||s>10)&&o.push("Repetitions must be between 1 and 10")}return o});return{isNameValid:t,isDesignValid:a,isModelsValid:n,isParametersValid:s,isValid:l,validationMessages:i}}(T),U=n(""),L=n(""),j=n(new Set),N=o(()=>S.designs),Q=o(()=>E.enabledModels),G=o(()=>T.design_id&&N.value.find(e=>e.id===T.design_id)||null),z=o(()=>Q.value.filter(e=>T.models.includes(e.id))),W=o(()=>P.filterModels(Q.value,{searchQuery:U.value,activeFilterId:L.value,sortByProvider:!0}).modelsByProvider),K=function(e,t,a){const o=$(),l=n(0),i=n(0),r=n(0),c=n(!1),u=n(null),d=async()=>{if(!t.value||0===a.value.length)return l.value=0,i.value=0,void(u.value=null);try{c.value=!0,u.value=null;const n=await q.calculateRunMetrics(t.value,a.value,o.variableLists,{max_tokens:e.parameters.max_tokens,repetitions_per_prompt:e.parameters.repetitions_per_prompt});l.value=n.taskCount,i.value=n.estimatedCost,r.value=n.totalCombinations}catch(n){console.error("Async calculation error:",n),u.value=n instanceof Error?n.message:"Calculation failed",l.value=0,i.value=0,r.value=0}finally{c.value=!1}};return s([t,a,()=>e.parameters],()=>{d()},{deep:!0,immediate:!0}),{taskCount:l,estimatedCost:i,variableCombinations:r,isCalculating:c,calculationError:u,triggerCalculation:d}}(T,G,z);function Z(e){const t=[...T.models],a=t.indexOf(e);-1===a?t.push(e):t.splice(a,1),A(t)}function X(e){j.value.has(e)?j.value.delete(e):j.value.add(e)}function Y(e){const t=Q.value.filter(t=>t.provider===e).map(e=>e.id),a=[...T.models];if(t.every(e=>a.includes(e))){const e=a.filter(e=>!t.includes(e));A(e)}else{const e=[...new Set([...a,...t])];A(e)}}function H(){A([])}function te(e){e.forEach(e=>j.value.add(e))}function ae(e){const t=e.filter(e=>T.models.includes(e.id)).length,a=e.length;return{total:a,selected:t,percentage:a>0?t/a*100:0,isFullySelected:t===a&&a>0,isPartiallySelected:t>0&&t<a}}function ne(e){if(!e.input_cost||0===K.taskCount.value)return"0.0000";const t=T.parameters.max_tokens;return(5e-5*e.input_cost*K.taskCount.value+t/1e6*(e.output_cost||0)*K.taskCount.value).toFixed(4)}function se(e){return e?e.toFixed(2):"0.00"}const oe=async e=>{const t=N.value.find(t=>t.id===e);if(!t)return"New Run";const a=M.runs.filter(t=>t.design_id===e).length+1,n=(new Date).toISOString().split("T")[0];return`${t.name} - ${n} #${a}`},le=async()=>{try{if(!T.design_id)return void console.error("Design ID is required");if("python_export"===T.executionType){const{PythonExportService:e}=await V(async()=>{const{PythonExportService:e}=await import("./PythonExportService-0kEakrrK.js");return{PythonExportService:e}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),{downloadBlob:t}=await V(async()=>{const{downloadBlob:e}=await import("./fileDownload-C1JQo-y2.js");return{downloadBlob:e}},[],import.meta.url),a=e.getInstance(),n=await a.exportRunConfiguration(T,T.pythonExportOptions);n.success&&n.blob?(t(n.blob,n.filename),w("close")):console.error("Export failed:",n.error)}else{const e={name:T.name,design_id:T.design_id,models:T.models,parameters:T.parameters,status:"draft"};let t;t=l.run?await M.updateRun(l.run.id,e):await M.createRun(e),w("saved",t),w("close")}}catch(e){console.error("Error saving/exporting run:",e)}};return y(async()=>{if(await Promise.all([S.loadDesigns(),E.loadModels(),O.loadVariableLists()]),await I(oe),T.models.length>0){const e=new Set;z.value.forEach(t=>{e.add(t.provider)}),te(Array.from(e))}}),(e,t)=>(r(),i("div",{class:"modal-overlay",onClick:t[21]||(t[21]=h(t=>e.$emit("close"),["self"]))},[c("div",Ce,[c("div",_e,[c("h2",null,b(e.run?"Edit":"Create")+" Run",1),c("button",{class:"close-btn",onClick:t[0]||(t[0]=t=>e.$emit("close"))}," Ã— ")]),c("div",ke,[c("div",xe,[t[45]||(t[45]=c("h3",null,"Configuration",-1)),c("div",we,[c("div",Se,[t[22]||(t[22]=c("label",null,"Run Name",-1)),d(c("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>f(T).name=e),type:"text",placeholder:"e.g., Product Analysis - 2025-06-26",class:g({error:!f(B).isNameValid.value&&f(T).name})},null,2),[[p,f(T).name]])]),c("div",Ee,[t[24]||(t[24]=c("label",null,"Design",-1)),d(c("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>f(T).design_id=e),class:g({error:!f(B).isDesignValid.value&&null!==f(T).design_id})},[t[23]||(t[23]=c("option",{value:null}," Select a design... ",-1)),(r(!0),i(m,null,v(N.value,e=>(r(),i("option",{key:e.id,value:e.id},b(e.name),9,Me))),128))],2),[[C,f(T).design_id,void 0,{number:!0}]])])]),c("div",Oe,[t[29]||(t[29]=c("h4",null,"Parameters",-1)),c("div",Re,[c("div",Pe,[t[25]||(t[25]=c("label",null,"Temperature",-1)),d(c("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>f(T).parameters.temperature=e),type:"number",min:"0",max:"2",step:"0.1"},null,512),[[p,f(T).parameters.temperature,void 0,{number:!0}]])]),c("div",Te,[t[26]||(t[26]=c("label",null,"Max Tokens",-1)),d(c("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>f(T).parameters.max_tokens=e),type:"number",min:"1",max:"4000"},null,512),[[p,f(T).parameters.max_tokens,void 0,{number:!0}]])]),c("div",Ie,[t[27]||(t[27]=c("label",null,"Concurrency",-1)),d(c("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>f(T).parameters.concurrency=e),type:"number",min:"1",max:"10"},null,512),[[p,f(T).parameters.concurrency,void 0,{number:!0}]])]),c("div",De,[t[28]||(t[28]=c("label",null,"Repetitions",-1)),d(c("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>f(T).parameters.repetitions_per_prompt=e),type:"number",min:"1",max:"10"},null,512),[[p,f(T).parameters.repetitions_per_prompt,void 0,{number:!0}]])])])]),c("div",Fe,[t[32]||(t[32]=c("h4",null,"Execution Type",-1)),c("div",Ve,[c("label",$e,[d(c("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>f(T).executionType=e),type:"radio",value:"browser",name:"execution-type"},null,512),[[_,f(T).executionType]]),t[30]||(t[30]=c("span",null,"Run in Browser",-1))]),c("label",Ae,[d(c("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>f(T).executionType=e),type:"radio",value:"python_export",name:"execution-type"},null,512),[[_,f(T).executionType]]),t[31]||(t[31]=c("span",null,"Export Python Package",-1))])])]),"python_export"===f(T).executionType?(r(),i("div",Be,[t[44]||(t[44]=c("h4",null,"Python Export Options",-1)),c("div",Ue,[c("label",Le,[d(c("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>f(T).pythonExportOptions.enableProgressBar=e),type:"checkbox"},null,512),[[k,f(T).pythonExportOptions.enableProgressBar]]),t[33]||(t[33]=c("span",null,"Progress Bar",-1))]),c("label",je,[d(c("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>f(T).pythonExportOptions.verboseLogging=e),type:"checkbox"},null,512),[[k,f(T).pythonExportOptions.verboseLogging]]),t[34]||(t[34]=c("span",null,"Verbose Logging",-1))]),c("label",Ne,[d(c("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>f(T).pythonExportOptions.enableCheckpointing=e),type:"checkbox"},null,512),[[k,f(T).pythonExportOptions.enableCheckpointing]]),t[35]||(t[35]=c("span",null,"Checkpointing",-1))]),c("label",qe,[d(c("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>f(T).pythonExportOptions.continueOnError=e),type:"checkbox"},null,512),[[k,f(T).pythonExportOptions.continueOnError]]),t[36]||(t[36]=c("span",null,"Continue on Error",-1))]),c("label",Qe,[d(c("input",{"onUpdate:modelValue":t[13]||(t[13]=e=>f(T).pythonExportOptions.includeApiLogs=e),type:"checkbox"},null,512),[[k,f(T).pythonExportOptions.includeApiLogs]]),t[37]||(t[37]=c("span",null,"Include API Logs",-1))])]),c("div",Je,[c("div",Ge,[t[39]||(t[39]=c("label",null,"Output Format",-1)),d(c("select",{"onUpdate:modelValue":t[14]||(t[14]=e=>f(T).pythonExportOptions.outputFormat=e)},t[38]||(t[38]=[c("option",{value:"json"}," JSON ",-1),c("option",{value:"csv"}," CSV ",-1),c("option",{value:"both"}," Both ",-1)]),512),[[C,f(T).pythonExportOptions.outputFormat]])]),c("div",ze,[t[40]||(t[40]=c("label",null,"Max Retries",-1)),d(c("input",{"onUpdate:modelValue":t[15]||(t[15]=e=>f(T).pythonExportOptions.maxRetries=e),type:"number",min:"0",max:"10"},null,512),[[p,f(T).pythonExportOptions.maxRetries,void 0,{number:!0}]])]),c("div",We,[t[41]||(t[41]=c("label",null,"Backoff Multiplier",-1)),d(c("input",{"onUpdate:modelValue":t[16]||(t[16]=e=>f(T).pythonExportOptions.retryBackoffMultiplier=e),type:"number",min:"1",max:"5",step:"0.1"},null,512),[[p,f(T).pythonExportOptions.retryBackoffMultiplier,void 0,{number:!0}]])]),c("div",Ke,[t[43]||(t[43]=c("label",null,"Python Version",-1)),d(c("select",{"onUpdate:modelValue":t[17]||(t[17]=e=>f(T).pythonExportOptions.pythonVersion=e)},t[42]||(t[42]=[c("option",{value:"3.8+"}," 3.8+ ",-1),c("option",{value:"3.9+"}," 3.9+ ",-1),c("option",{value:"3.10+"}," 3.10+ ",-1)]),512),[[C,f(T).pythonExportOptions.pythonVersion]])])])])):u("",!0)]),c("div",Ze,[t[46]||(t[46]=c("h3",null,"Model Selection",-1)),x(ee,{"search-query":U.value,"onUpdate:searchQuery":t[18]||(t[18]=e=>U.value=e),"active-filter":L.value,"onUpdate:activeFilter":t[19]||(t[19]=e=>L.value=e),"selected-models":f(T).models,"all-models":Q.value,onClearSelection:H,onExpandProviders:te},null,8,["search-query","active-filter","selected-models","all-models"]),x(fe,{"models-by-provider":W.value,"selected-models":f(T).models,"expanded-providers":j.value,"get-provider-selection-stats":ae,onToggleModel:Z,onToggleProvider:X,onSelectAllProvider:Y},null,8,["models-by-provider","selected-models","expanded-providers"])])]),c("div",Xe,[c("div",Ye,[c("div",He,[z.value.length>0?(r(),i("div",et,[c("table",tt,[t[47]||(t[47]=c("thead",null,[c("tr",null,[c("th",null,"Model"),c("th",null,"Provider"),c("th",null,"Input Cost/1M"),c("th",null,"Output Cost/1M"),c("th",null,"Tasks"),c("th",null,"Est. Cost")])],-1)),c("tbody",null,[(r(!0),i(m,null,v(z.value,e=>(r(),i("tr",{key:e.id},[c("td",at,b(e.name),1),c("td",nt,b(e.provider),1),c("td",st," $"+b(se(e.input_cost)),1),c("td",ot," $"+b(se(e.output_cost)),1),c("td",lt,b((K.variableCombinations.value?K.variableCombinations.value*T.parameters.repetitions_per_prompt:0).toLocaleString()),1),c("td",it," $"+b(ne(e)),1)]))),128))])])])):(r(),i("div",rt,t[48]||(t[48]=[c("span",null,"No models selected",-1)])))]),c("div",ct,[c("div",ut,[c("div",dt,[t[49]||(t[49]=c("span",{class:"total-label"},"Variable Combinations:",-1)),c("span",pt,b(f(K).variableCombinations.value?.toLocaleString()||"0"),1)]),c("div",mt,[t[50]||(t[50]=c("span",{class:"total-label"},"Models:",-1)),c("span",vt,b(f(T).models.length),1)]),c("div",gt,[t[51]||(t[51]=c("span",{class:"total-label"},"Repetitions:",-1)),c("span",bt,b(f(T).parameters.repetitions_per_prompt),1)]),t[54]||(t[54]=c("div",{class:"divider"},null,-1)),c("div",ht,[t[52]||(t[52]=c("span",{class:"total-label"},"Total Tasks:",-1)),c("span",yt,b(f(K).taskCount.value?.toLocaleString()||"0"),1)]),c("div",ft,[t[53]||(t[53]=c("span",{class:"total-label"},"Total Cost:",-1)),c("span",Ct,"$"+b(f(K).estimatedCost.value?.toFixed(4)||"0.0000"),1)])])])])]),c("div",_t,[c("div",kt,[f(B).validationMessages.value.length>0?(r(),i("div",xt,b(f(B).validationMessages.value[0]),1)):u("",!0)]),c("div",wt,[c("button",{class:"btn btn-secondary",onClick:t[20]||(t[20]=t=>e.$emit("close"))}," Cancel "),c("button",{class:"btn btn-primary",disabled:!f(B).isValid.value||f(K).isCalculating.value,onClick:le},b(l.run?"Update Run":"python_export"===T.executionType?"Export Python Package":"Create Run"),9,St)])])])]))}}),[["__scopeId","data-v-597ccddc"]]),Mt=l({__name:"RunEditorModal",props:{run:{},preselectedModelIds:{},preselectedDesignId:{}},emits:["close","saved"],setup:e=>(e,t)=>(r(),w(Et,{run:e.run,"preselected-model-ids":e.preselectedModelIds,"preselected-design-id":e.preselectedDesignId,onClose:t[0]||(t[0]=t=>e.$emit("close")),onSaved:t[1]||(t[1]=t=>e.$emit("saved",t))},null,8,["run","preselected-model-ids","preselected-design-id"]))}),Ot={class:"runs-view"},Rt={class:"header"},Pt={key:0,class:"loading"},Tt={key:1,class:"empty-state"},It={key:2,class:"runs-container"},Dt={class:"sort-controls"},Ft={class:"runs-table"},Vt={class:"run-main"},$t={class:"run-info"},At={class:"run-header"},Bt={class:"run-name"},Ut={class:"run-meta"},Lt={key:0},jt={key:1},Nt={class:"run-actions"},qt=["onClick"],Qt=["onClick"],Jt=["onClick"],Gt=["onClick"],zt=["onClick"],Wt=["onClick"],Kt=I(l({__name:"RunsView",setup(e){const t=S(),a=E(),s=R(),{runs:l,loading:p}=M(s),h=n(!1),_=n(null),k=n("updated_at"),x=n("desc"),P=o(()=>[...l.value].sort((e,t)=>{let a,n;switch(k.value){case"name":a=e.name.toLowerCase(),n=t.name.toLowerCase();break;case"created_at":a=new Date(e.created_at||0).getTime(),n=new Date(t.created_at||0).getTime();break;case"updated_at":a=new Date(e.updated_at||e.created_at||0).getTime(),n=new Date(t.updated_at||t.created_at||0).getTime();break;case"status":const s={pending:0,running:1,completed:2,failed:3};a=s[e.status]??999,n=s[t.status]??999;break;default:return 0}return a<n?"asc"===x.value?-1:1:a>n?"asc"===x.value?1:-1:0})),T=o(()=>{const e=a.query.create;return e?parseInt(e):null});async function I(e){if(_.value)await s.updateRun(_.value.id,e);else{const a=await s.createRun(e);await s.startRun(a.id),t.push("/active")}D()}function D(){h.value=!1,_.value=null,a.query.create&&("designs"===a.query.from?t.push({name:"designs"}):t.replace({name:"runs"}))}function F(){}function V(){x.value="asc"===x.value?"desc":"asc"}function $(e){return e?new Date(e).toLocaleDateString():"N/A"}return y(()=>{s.loadRuns(),T.value&&(h.value=!0)}),(e,a)=>(r(),i("div",Ot,[c("div",Rt,[a[3]||(a[3]=c("h2",null,"Runs",-1)),c("button",{class:"btn btn-primary",onClick:a[0]||(a[0]=e=>h.value=!0)}," Create Run ")]),f(p)?(r(),i("div",Pt," Loading runs... ")):0===f(l).length?(r(),i("div",Tt,[a[4]||(a[4]=c("p",null,"No runs created yet",-1)),c("button",{class:"btn btn-primary",onClick:a[1]||(a[1]=e=>h.value=!0)}," Create your first run ")])):(r(),i("div",It,[c("div",Dt,[a[6]||(a[6]=c("label",null,"Sort by:",-1)),d(c("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>k.value=e),onChange:F},a[5]||(a[5]=[c("option",{value:"updated_at"}," Last Updated ",-1),c("option",{value:"name"}," Name ",-1),c("option",{value:"created_at"}," Created Date ",-1),c("option",{value:"status"}," Status ",-1)]),544),[[C,k.value]]),c("button",{class:"sort-toggle",onClick:V},b("desc"===x.value?"â†“":"â†‘"),1)]),c("div",Ft,[(r(!0),i(m,null,v(P.value,e=>(r(),i("div",{key:e.id,class:"run-row"},[c("div",Vt,[c("div",$t,[c("div",At,[c("h3",Bt,b(e.name),1),c("span",{class:g(["run-status",`status-${e.status}`])},b(e.status),3)]),c("p",Ut,[O(b(e.total_tasks||0)+" tasks ("+b(e.completed_tasks||0)+" processed",1),e.error_count?(r(),i("span",Lt,", "+b(e.error_count)+" errors",1)):u("",!0),O(") â€¢ Created "+b($(e.created_at))+" ",1),e.updated_at&&e.updated_at!==e.created_at?(r(),i("span",jt," â€¢ Updated "+b($(e.updated_at)),1)):u("",!0)])]),c("div",Nt,["pending"===e.status?(r(),i("button",{key:0,class:"btn btn-primary btn-small",onClick:a=>async function(e){await s.startRun(e.id),t.push("/active")}(e)}," Start ",8,qt)):u("",!0),"running"===e.status?(r(),i("button",{key:1,class:"btn btn-danger btn-small",onClick:t=>async function(e){await s.stopRun(e.id)}(e)}," Stop ",8,Qt)):u("",!0),c("button",{class:"btn btn-secondary btn-small",onClick:a=>function(e){t.push(`/results/${e.id}`)}(e)}," Results ",8,Jt),c("button",{class:"btn btn-secondary btn-small",onClick:t=>async function(e){if(e.id){const t=await s.getRunById(e.id);_.value=t||e}else _.value=e}(e)}," Edit ",8,Gt),c("button",{class:"btn btn-secondary btn-small",onClick:t=>function(e){const t={version:"1.0",exportDate:(new Date).toISOString(),run:e},a=JSON.stringify(t,null,2),n=new Blob([a],{type:"application/json"}),s=URL.createObjectURL(n),o=document.createElement("a");o.href=s,o.download=`run_${e.name.replace(/[^a-zA-Z0-9]/g,"_")}_${(new Date).toISOString().split("T")[0]}.json`,o.click(),URL.revokeObjectURL(s)}(e)}," Export ",8,zt),c("button",{class:"btn btn-danger btn-small",onClick:t=>async function(e){confirm(`Delete run "${e.name}"? This action cannot be undone.`)&&await s.deleteRun(e.id)}(e)}," Delete ",8,Wt)])])]))),128))])])),h.value||_.value?(r(),w(Mt,{key:3,run:_.value||void 0,"preselected-design-id":T.value||void 0,onSaved:I,onClose:D},null,8,["run","preselected-design-id"])):u("",!0)]))}}),[["__scopeId","data-v-06de330d"]]);export{Kt as default};
