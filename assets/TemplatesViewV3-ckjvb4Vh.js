import{D as ae,a as se,j as ne}from"./index--_z_T8lH.js";import{d as le,f as L,c as D,o as oe,R as u,S as p,k as a,Z as i,l as C,u as d,Y as r,G as y,_ as T,$ as ie,V as k,F as re,W as ce,X as ue}from"./vue-vendor-DPw1dQYc.js";import{u as de}from"./useV4Templates-DDuh4xCc.js";import{u as pe}from"./useV4TemplateCommands-CRzHNSN9.js";import{u as me}from"./useV4VariableLists-DSl_d5T7.js";import{_ as _e,l as fe,m as ye,P as ke,n as ve,T as ge,o as we,p as Ce,C as O,q as Te,E as be,r as he,s as De,M as xe,t as $e,u as Ve,v as Ee,w as Le,x as N,y as c}from"./ui-vendor-DDlYs5wr.js";import"./utils-vendor-DcTsQz_8.js";import"./useV4LiveQuery-B-RpOK8L.js";import"./useV4CrossTab-DAQPY6l_.js";const Oe={class:"templates-view"},Ne={class:"view-header"},Me={class:"header-actions"},Se={key:0,class:"name-cell"},Ie={class:"template-name"},Fe={key:0,class:"template-description"},je={key:1,class:"variables-cell"},Re={key:0,class:"no-variables"},qe={key:1,class:"variable-calculation"},Be={class:"variable-name"},Ue={class:"variable-count"},ze={key:0,class:"operator"},Ae={class:"total-combinations"},Pe={key:2,class:"token-estimate"},Ye={class:"token-count"},Ge={key:3,class:"actions-cell"},Qe=le({__name:"TemplatesViewV3",setup(We){const v=ue(),{templates:x,loading:M}=de(),{variableLists:S}=me(),{duplicateTemplate:$,deleteTemplate:I,exportTemplates:F,isExecuting:j}=pe(),g=L(""),b=L(!1),R=D(()=>M.value||j.value),V=D(()=>x.value),q=D(()=>{if(!g.value.trim())return V.value;const t=g.value.toLowerCase();return V.value.filter(e=>e.name.toLowerCase().includes(t)||e.description?.toLowerCase().includes(t)||e.tags.some(s=>s.toLowerCase().includes(t)))}),B=[{title:"Name",key:"name",dataIndex:"name",sorter:(t,e)=>t.name.localeCompare(e.name),width:250,ellipsis:!1},{title:"Variables",key:"variables",width:280},{title:"Tokens",key:"tokens",width:80,align:"center"},{title:"Created",key:"created",dataIndex:"created",sorter:(t,e)=>new Date(t.created).getTime()-new Date(e.created).getTime(),customRender:({value:t})=>new Date(t).toLocaleDateString(),width:100,align:"center"},{title:"Actions",key:"actions",width:90,align:"center"}];function U(t){return Object.keys(t.variables||{}).length}function E(t){const e=[],s=S.value;for(const[l,n]of Object.entries(t.variables||{})){let m=0;n.type==="list"&&n.listId?m=s.find(h=>h.id===n.listId)?.itemCount||0:n.values&&(m=n.values.length),e.push({name:l,count:m})}return e}function z(t){return Math.ceil(t.template.length/4)}function A(t){const e=x.value.map(n=>n.name),s=t.replace(/ \(Modified.*\)$/,"");if(!e.includes(`${s} (Modified)`))return`${s} (Modified)`;let l=2;for(;e.includes(`${s} (Modified ${l})`);)l++;return`${s} (Modified ${l})`}function P(){v.push({name:"template-create"})}async function Y(t){if(t.isDefault){localStorage.getItem("skip-default-edit-message")?await s():N.info({title:"Editing Default Content",content:"To preserve the original defaults, we'll create a personal copy for you to edit.",okText:"Create Copy",onOk:async()=>{localStorage.setItem("skip-default-edit-message","true"),await s()}});async function s(){c.info("Creating editable copy...");const l=A(t.name),n=await $(t.id,l);n.ok?v.push({name:"template-edit",params:{id:n.value}}):c.error("Failed to create copy: "+n.error.message)}}else v.push({name:"template-edit",params:{id:t.id}})}async function G(t){const e=await $(t.id);e.ok?(c.success("Template duplicated successfully"),v.push({name:"template-edit",params:{id:e.value}})):c.error(`Failed to duplicate template: ${e.error.message}`)}async function Q(t){let e=`Are you sure you want to delete "${t.name}"?`;t.isDefault?e+=`

This is a default template. You can restore it later using "Import Standard Lists".`:e+=" This action cannot be undone.",N.confirm({title:"Delete Template",content:e,okText:"Delete",okType:"danger",cancelText:"Cancel",onOk:async()=>{const s=await I(t.id);s.ok?c.success("Template deleted successfully"):c.error(`Failed to delete template: ${s.error.message}`)}})}async function W(t){const e=await F([t.id]);if(e.ok){const s=new Blob([e.value],{type:"application/json"}),l=URL.createObjectURL(s),n=document.createElement("a");n.href=l,n.download=`${t.name.replace(/[^a-z0-9]/gi,"_")}_template.json`,n.click(),URL.revokeObjectURL(l),c.success("Template exported successfully")}else c.error(`Failed to export template: ${e.error.message}`)}function X(t){v.push({name:"trial-create",query:{designId:t.id,promptSource:"template"}})}function Z(t){g.value=t}async function H(){if(!b.value){b.value=!0;try{const t=await ae.importDefaults();if(t.ok){const{templates:e,lists:s}=t.value;e===0&&s===0?c.info("All defaults already exist. No new items imported."):c.success(`Imported ${s} variable lists and ${e} templates`)}else c.error(`Failed to import defaults: ${t.error.message}`)}catch(t){se.error("Error importing defaults:",t),c.error("An unexpected error occurred while importing defaults")}finally{b.value=!1}}}return oe(()=>{}),(t,e)=>{const s=_e,l=ye,n=ge,m=Ce,w=$e,h=Ee,J=xe,K=he,ee=ve;return r(),u("div",Oe,[p("div",Ne,[e[3]||(e[3]=p("h1",null,"Template Prompts",-1)),p("div",Me,[a(s,{value:g.value,"onUpdate:value":e[0]||(e[0]=_=>g.value=_),placeholder:"Search templates...",class:"search-input",style:{width:"300px"},onSearch:Z},null,8,["value"]),a(l,{type:"default",onClick:H,icon:C(d(fe))},{default:i(()=>e[1]||(e[1]=[y(" Import Standard Lists ")])),_:1,__:[1]},8,["icon"]),a(l,{type:"primary",onClick:P,icon:C(d(ke))},{default:i(()=>e[2]||(e[2]=[y(" New Template ")])),_:1,__:[2]},8,["icon"])])]),a(ee,{columns:B,"data-source":q.value,loading:R.value,pagination:!1,scroll:{x:800,y:"calc(100vh - 280px)"},"row-key":_=>_.id,class:"templates-table"},{bodyCell:i(({column:_,record:o})=>[_.key==="name"?(r(),u("div",Se,[p("div",Ie,[y(k(o.name)+" ",1),o.isDefault?(r(),ie(m,{key:0,title:"Default template - editing will create a copy"},{default:i(()=>[a(n,{color:"blue",size:"small",style:{"margin-left":"8px"}},{default:i(()=>[a(d(we)),e[4]||(e[4]=y(" Default "))]),_:1,__:[4]})]),_:1})):T("",!0)]),o.description?(r(),u("div",Fe,k(o.description),1)):T("",!0)])):_.key==="variables"?(r(),u("div",je,[U(o)===0?(r(),u("span",Re," No variables ")):(r(),u("div",qe,[(r(!0),u(re,null,ce(E(o),(f,te)=>(r(),u("span",{key:f.name,class:"variable-part"},[p("span",Be,k(f.name),1),p("span",Ue,"("+k(f.count)+")",1),te<E(o).length-1?(r(),u("span",ze,"Ã—")):T("",!0)]))),128)),e[5]||(e[5]=p("span",{class:"equals"},"=",-1)),p("span",Ae,k(o.combinationCount||0)+" cases",1)]))])):_.key==="tokens"?(r(),u("div",Pe,[a(m,{title:"Estimated tokens per prompt"},{default:i(()=>[p("span",Ye,"~"+k(z(o)),1)]),_:2},1024)])):_.key==="actions"?(r(),u("div",Ge,[a(m,{title:o.isDefault?"Edit (Creates Copy)":"Edit"},{default:i(()=>[a(l,{type:"link",size:"small",onClick:f=>Y(o),icon:C(o.isDefault?d(O):d(Te))},null,8,["onClick","icon"])]),_:2},1032,["title"]),a(m,{title:"New Trial"},{default:i(()=>[a(l,{type:"link",size:"small",onClick:f=>X(o),icon:C(d(be))},null,8,["onClick","icon"])]),_:2},1024),a(K,null,{overlay:i(()=>[a(J,null,{default:i(()=>[a(w,{onClick:f=>G(o)},{default:i(()=>[a(d(O)),e[6]||(e[6]=y(" Duplicate "))]),_:2,__:[6]},1032,["onClick"]),a(w,{onClick:f=>W(o)},{default:i(()=>[a(d(Ve)),e[7]||(e[7]=y(" Export "))]),_:2,__:[7]},1032,["onClick"]),a(h),a(w,{onClick:f=>Q(o),class:"danger-item"},{default:i(()=>[a(d(Le)),e[8]||(e[8]=y(" Delete "))]),_:2,__:[8]},1032,["onClick"])]),_:2},1024)]),default:i(()=>[a(l,{type:"link",size:"small"},{default:i(()=>[e[9]||(e[9]=y(" More ")),a(d(De))]),_:1,__:[9]})]),_:2},1024)])):T("",!0)]),_:1},8,["data-source","loading","row-key"])])}}}),nt=ne(Qe,[["__scopeId","data-v-53b567e5"]]);export{nt as default};
