import{l as g,d as v,a as p}from"./index-BMQrw39p.js";import{u as d}from"./useV4LiveQuery-Do0jdBW3.js";import{u as R}from"./useV4CrossTab-yX5gog34.js";import{c as o}from"./vue-vendor-DPw1dQYc.js";function E(){const{data:b,loading:y,error:h}=d(()=>g(()=>v.template_prompts.orderBy("updated").reverse().toArray()),e=>e,{initialValue:[]}),{data:L,loading:C}=d(()=>g(()=>v.variableLists.toArray()),e=>e,{initialValue:[]}),V=o(()=>y.value||C.value),T=o(()=>h.value),l=o(()=>{if(b.value.length===0)return[];const e=new Map(L.value.map(t=>[t.id,t]));return b.value.map(t=>{const i=Object.keys(t.variables||{}).length;let n=1;const c={},u=[];if(t.variables)for(const[f,r]of Object.entries(t.variables))if(r.type==="list"&&r.listId){const s=e.get(r.listId);s?(c[f]=s,s.category==="simple"&&s.values?n*=s.values.length:s.category==="attributed"&&s.items?n*=s.items.length:s.category==="refusal"&&s.values?n*=s.values.length:s.category==="tabular"&&s.itemCount&&(n*=s.itemCount)):u.push(r.listId)}else r.type==="value"&&r.values&&(n*=r.values.length);return{...t,variableCount:i,combinationCount:n,tokenEstimate:Math.ceil(t.template.length/4),variableListData:Object.keys(c).length>0?c:void 0,missingVariableLists:u.length>0?u:void 0}})}),j=o(()=>{const e={};for(const a of l.value){const t=a.category||"Uncategorized";e[t]||(e[t]=[]),e[t].push(a)}for(const a in e)e[a]=e[a];return e}),O=o(()=>l.value.filter(e=>!e.isDefault)),z=o(()=>l.value.filter(e=>e.isDefault)),w=o(()=>Array.from(new Set(l.value.map(e=>e.category||"Uncategorized"))).sort()),B=o(()=>l.value.filter(e=>e.variableListData)),D=o(()=>l.value.filter(e=>e.missingVariableLists&&e.missingVariableLists.length>0));function k(e){return o(()=>l.value.find(t=>t.id===e)||null)}function W(e){return o(()=>Object.freeze(l.value.filter(a=>(a.category||"Uncategorized")===e)))}function I(e){return o(()=>{if(!e.trim())return l.value;const a=e.toLowerCase(),t=l.value.filter(i=>i.name.toLowerCase().includes(a)||i.description?.toLowerCase().includes(a)||i.template.toLowerCase().includes(a)||i.category?.toLowerCase().includes(a)||i.tags.some(n=>n.toLowerCase().includes(a)));return Object.freeze(t)})}function U(e){return o(()=>{const a=l.value.filter(t=>t.variables?Object.values(t.variables).some(i=>i.type==="list"&&i.listId===e):!1);return Object.freeze(a)})}const P=o(()=>{const e=l.value,a=e.length;if(a===0)return Object.freeze({total:0,byCategory:{},totalVariables:0,avgVariablesPerTemplate:0,templatesWithVariableLists:0,templatesWithBrokenReferences:0,mostPopularCategory:null,totalCombinations:0});const t={};let i=0,n=0,c=0,u=0;for(const r of e){const s=r.category||"Uncategorized";t[s]=(t[s]||0)+1,i+=r.variableCount||0,u+=r.combinationCount||0,r.variableListData&&n++,r.missingVariableLists&&r.missingVariableLists.length>0&&c++}let m=null,f=0;for(const[r,s]of Object.entries(t))s>f&&(f=s,m=r);return Object.freeze({total:a,byCategory:Object.freeze(t),totalVariables:i,avgVariablesPerTemplate:a>0?Math.round(i/a):0,templatesWithVariableLists:n,templatesWithBrokenReferences:c,mostPopularCategory:m,totalCombinations:u})});return R(e=>{e.table==="templates"?p.info("V4 Cross-tab update received for templates:",e.operation):e.table==="variableLists"&&p.info("V4 Cross-tab update received for variableLists (template enrichment):",e.operation)}),{templates:l,templatesByCategory:j,customTemplates:O,defaultTemplates:z,loading:V,error:T,templatesWithVariableListData:B,templatesWithBrokenReferences:D,getTemplateById:k,getTemplatesByCategory:W,searchTemplates:I,getTemplatesUsingVariableList:U,stats:P,categories:w}}export{E as u};
