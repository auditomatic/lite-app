const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BNyV4f0C.js","assets/vue-vendor-DPw1dQYc.js","assets/ui-vendor-IRGmExUJ.js","assets/utils-vendor-B76-F3_P.js","assets/index-DaHEOU6Y.css"])))=>i.map(i=>d[i]);
import{d as $,r as Le,c as wt,u as Re,a as E,j as re,_ as Fe,s as Ct}from"./index-BNyV4f0C.js";import{f as y,c as I,d as ie,R as b,Y as u,S as t,_ as B,a0 as ee,V as f,u as g,F as H,W as se,B as ae,k as r,$ as N,Z as n,G as M,o as Ve,s as Se,h as Mt,b as $t,a5 as Ot,a6 as Pt,X as Dt}from"./vue-vendor-DPw1dQYc.js";import{u as Ue}from"./useV4Models-CU82bXlO.js";import{u as ze}from"./useV4ProviderParameters-BaPF9uQ7.js";import{O as At}from"./OllamaModelManagerV3-BZVlOVO5.js";import{ap as St,T as _e,ak as Te,al as Be,L as Ne,n as ye,m as Et,aq as xt,U as Lt,ar as je,J as Ge,O as Rt,t as Ie,v as Ft,ag as Vt,S as Ke,M as We,as as Ut,at as zt,_ as Tt,au as Bt,s as Nt,y as jt,av as Gt,w as It,aw as Kt,ax as Ee,ay as xe,V as Wt,a8 as qt,ai as Jt,q as Ht,ao as Qt}from"./ui-vendor-IRGmExUJ.js";import{detectOllamaIssue as Xt}from"./ollama-fetch-CrxGUbCE.js";import"./utils-vendor-B76-F3_P.js";import"./useV4LiveQuery-Do0jdBW3.js";class Yt{async bulkWrite(i,o,l="put"){o.length!==0&&await $.transaction("rw",$[i],async()=>{switch(l){case"put":await $[i].bulkPut(o);break;case"add":await $[i].bulkAdd(o);break;case"update":const m=o.map(_=>$[i].update(_.id,_));await Promise.all(m);break}})}async bulkDelete(i,o){o.length!==0&&await $.transaction("rw",$[i],async()=>{await $[i].bulkDelete(o)})}async conditionalBulkUpdate(i,o,l){let m=0;return await $.transaction("rw",$[i],async()=>{await $[i].toCollection().modify(_=>{o(_)&&(Object.assign(_,l),m++)})}),m}freezeDeep(i){const o=i.map(l=>Object.freeze(l));return Object.freeze(o)}async getAndFreeze(i,o){const l=await $[i].get(o);return l?Object.freeze(l):null}async getAllAndFreeze(i){const o=await $[i].toArray();return this.freezeDeep(o)}}const ne=new Yt;class Zt{async bulkUpsertModels(i){i.length!==0&&await $.transaction("rw",$.models,async()=>{const o=i.map(l=>Object.freeze({...l,enabled:l.enabled??!1,available:l.available??!0}));await $.models.bulkPut(o)})}async clearProviderModels(i){return await $.transaction("rw",$.models,async()=>{const m=(await $.models.where("provider").equals(i).toArray()).map(_=>_.id);return m.length>0&&await $.models.bulkDelete(m),m.length})}async toggleModelEnabled(i,o){return await $.models.update(i,{enabled:o})===1}async toggleProviderModels(i,o){return await ne.conditionalBulkUpdate("models",l=>l.provider===i,{enabled:o})}async toggleAllModels(i){return await ne.conditionalBulkUpdate("models",()=>!0,{enabled:i})}async getModelStatistics(){const i=await $.models.toArray(),o={total:i.length,enabled:0,byProvider:{}};for(const l of i)l.enabled&&o.enabled++,o.byProvider[l.provider]||(o.byProvider[l.provider]={total:0,enabled:0}),o.byProvider[l.provider].total++,l.enabled&&o.byProvider[l.provider].enabled++;return Object.freeze(o)}async updateModelAvailability(i,o){return await ne.conditionalBulkUpdate("models",l=>l.provider===i,{available:o})}async searchModels(i){let o=$.models.toCollection();if(i.provider&&(o=$.models.where("provider").equals(i.provider)),i.enabled!==void 0&&(o=o.and(m=>m.enabled===i.enabled)),i.available!==void 0&&(o=o.and(m=>m.available===i.available)),i.search){const m=i.search.toLowerCase();o=o.and(_=>_.displayName.toLowerCase().includes(m)||_.modelId.toLowerCase().includes(m))}const l=await o.toArray();return ne.freezeDeep(l)}async clearAllModels(){await $.models.clear()}}const es=new Zt;function ts(){const F=Le(),i=y(!1),o=y(null),l=y(!1),m=y(!1);async function _(w,c){i.value=!0,c&&(c.value=!0),o.value=null;try{return{ok:!0,value:await w()}}catch(s){const A=s instanceof Error?s:new Error(String(s));return o.value=A,{ok:!1,error:A}}finally{i.value=!1,c&&(c.value=!1)}}async function V(w){return _(()=>F.discoverModels(w),l)}async function x(w){return _(()=>F.refreshModelSource(w),l)}async function D(w,c){return _(async()=>{await F.toggleModel(w,c)},m)}async function h(w){return _(async()=>{await F.toggleAllModels(w)},m)}async function d(w,c){return _(async()=>{await F.toggleProviderModels(w,c)},m)}async function L(){return _(async()=>{await F.enableOpenRouterFavorites()},m)}async function C(){return _(async()=>{await F.clearAllModels()})}async function p(w,c){return _(async()=>{await es.updateModelAvailability(w,c)})}return{discoverModels:V,refreshDiscoverySource:x,toggleModel:D,toggleAllModels:h,toggleProviderModels:d,enableOpenRouterFavorites:L,clearAllModels:C,updateModelAvailability:p,isExecuting:i,lastError:o,isDiscovering:l,isTogglingModels:m}}function qe(){const F=Le(),i=y([]),o=y(!1),l=y([]);function m(){const x=F.getDiscoveryStatus();i.value=x.map(D=>({id:D.id,status:D.status==="loading"?"loading":D.status==="idle"?"success":D.status,modelCount:D.modelCount,error:D.error})),o.value=F.isDiscovering(),l.value=F.getDiscoveryErrors()}function _(x){return{litellm:"LiteLLM",openrouter:"OpenRouter",ollama:"Ollama",deterministic:"Deterministic"}[x]||x}function V(x){return wt.getProvider(x)?.name||x}return m(),{discoveryStatus:I(()=>i.value),isDiscovering:I(()=>o.value),discoveryErrors:I(()=>l.value),getSourceDisplayName:_,getProviderDisplayName:V,refreshStatus:m}}const ss={class:"model-list"},as={class:"model-header"},os={class:"model-table"},ls=["onClick"],ns={class:"model-name"},rs={class:"model-source"},is={class:"model-context"},ds={key:0},us={key:1,class:"text-secondary"},cs={key:0,class:"model-cost-in"},vs={key:0,class:"cost-value"},ps={key:1,class:"text-secondary"},ms={key:1,class:"model-cost-out"},fs={key:0,class:"cost-value"},gs={key:1,class:"text-secondary"},_s={class:"model-enviro-carbon"},ys={class:"enviro-value"},bs={class:"model-enviro-water"},ks={class:"enviro-value"},hs={class:"model-enviro-energy"},ws={class:"enviro-value"},Cs=ie({__name:"ModelListV3",props:{models:{},providerId:{}},emits:["toggle-model"],setup(F){const i=F,o=Re(),l=y("name"),m=y("asc"),_=I(()=>{if(!i.models||i.models.length===0)return[];const h=i.models.filter(C=>C.capabilities?.inputCostPerToken||C.capabilities?.outputCostPerToken);return h.length>0?h.map(C=>({id:C.id,provider:C.provider,modelId:C.modelId,inputCost:C.capabilities?.inputCostPerToken,outputCost:C.capabilities?.outputCostPerToken})):i.models[0],[...i.models].sort((C,p)=>{let w=0;switch(l.value){case"enabled":w=(C.enabled?1:0)-(p.enabled?1:0);break;case"name":w=C.displayName.localeCompare(p.displayName);break;case"source":w=(C.source||"").localeCompare(p.source||"");break;case"context":const c=C.capabilities?.contextWindow||0,s=p.capabilities?.contextWindow||0;w=c-s;break;case"inputCost":const A=C.capabilities?.inputCostPerToken||0,P=p.capabilities?.inputCostPerToken||0;w=A-P;break;case"outputCost":const q=C.capabilities?.outputCostPerToken||0,J=p.capabilities?.outputCostPerToken||0;w=q-J;break}return m.value==="asc"?w:-w})});function V(h){l.value===h?m.value=m.value==="asc"?"desc":"asc":(l.value=h,m.value="asc")}function x(h){return h>=1e6?(h/1e6).toFixed(1)+"M":h>=1e3?(h/1e3).toFixed(0)+"K":h.toString()}function D(h){if(!h||h===0)return"0.00";const d=h*1e6;return d<.01?d.toFixed(4):d<1?d.toFixed(3):d<10?d.toFixed(2):d<100?d.toFixed(1):d.toFixed(0)}return(h,d)=>{const L=St,C=_e;return u(),b("div",ss,[t("div",as,[t("div",{class:"header-switch sortable",onClick:d[0]||(d[0]=p=>V("enabled"))},[d[7]||(d[7]=t("span",null,"Enabled",-1)),t("span",{class:ee(["sort-indicator",{active:l.value==="enabled"}])},f(l.value==="enabled"&&m.value==="asc"?"â–²":"â–¼"),3)]),t("div",{class:"header-name sortable",onClick:d[1]||(d[1]=p=>V("name"))},[d[8]||(d[8]=t("span",null,"Model",-1)),t("span",{class:ee(["sort-indicator",{active:l.value==="name"}])},f(l.value==="name"&&m.value==="asc"?"â–²":"â–¼"),3)]),t("div",{class:"header-source sortable",onClick:d[2]||(d[2]=p=>V("source"))},[d[9]||(d[9]=t("span",null,"Source",-1)),t("span",{class:ee(["sort-indicator",{active:l.value==="source"}])},f(l.value==="source"&&m.value==="asc"?"â–²":"â–¼"),3)]),t("div",{class:"header-context sortable",onClick:d[3]||(d[3]=p=>V("context"))},[d[10]||(d[10]=t("span",null,"Context",-1)),t("span",{class:ee(["sort-indicator",{active:l.value==="context"}])},f(l.value==="context"&&m.value==="asc"?"â–²":"â–¼"),3)]),g(o).showFinancialCosts.value?(u(),b("div",{key:0,class:"header-cost-in sortable",onClick:d[4]||(d[4]=p=>V("inputCost"))},[d[11]||(d[11]=t("span",null,"Input $/1M",-1)),t("span",{class:ee(["sort-indicator",{active:l.value==="inputCost"}])},f(l.value==="inputCost"&&m.value==="asc"?"â–²":"â–¼"),3)])):B("",!0),g(o).showFinancialCosts.value?(u(),b("div",{key:1,class:"header-cost-out sortable",onClick:d[5]||(d[5]=p=>V("outputCost"))},[d[12]||(d[12]=t("span",null,"Output $/1M",-1)),t("span",{class:ee(["sort-indicator",{active:l.value==="outputCost"}])},f(l.value==="outputCost"&&m.value==="asc"?"â–²":"â–¼"),3)])):B("",!0),d[13]||(d[13]=t("div",{class:"header-enviro-carbon"},[t("span",null,"COâ‚‚")],-1)),d[14]||(d[14]=t("div",{class:"header-enviro-water"},[t("span",null,"ðŸ’§")],-1)),d[15]||(d[15]=t("div",{class:"header-enviro-energy"},[t("span",null,"âš¡")],-1))]),t("div",os,[(u(!0),b(H,null,se(_.value,p=>(u(),b("div",{key:p.id,class:"model-row",onClick:w=>h.$emit("toggle-model",p.id,!p.enabled)},[t("div",{class:"model-switch",onClick:d[6]||(d[6]=ae(()=>{},["stop"]))},[r(L,{checked:p.enabled,size:"small",onChange:w=>h.$emit("toggle-model",p.id,w),"data-testid":"model-toggle","data-provider":p.provider,"data-model":p.modelId,"aria-label":`${p.enabled?"Disable":"Enable"} model ${p.modelId}`},null,8,["checked","onChange","data-provider","data-model","aria-label"])]),t("div",ns,[t("code",null,f(p.modelId),1)]),t("div",rs,[p.source?(u(),N(C,{key:0,size:"small",color:"cyan"},{default:n(()=>[M(f(p.source),1)]),_:2},1024)):B("",!0)]),t("div",is,[p.capabilities?.contextWindow?(u(),b("span",ds,f(x(p.capabilities.contextWindow)),1)):(u(),b("span",us,"-"))]),g(o).showFinancialCosts.value?(u(),b("div",cs,[p.capabilities?.inputCostPerToken?(u(),b("span",vs," $"+f(D(p.capabilities.inputCostPerToken)),1)):(u(),b("span",ps,"-"))])):B("",!0),g(o).showFinancialCosts.value?(u(),b("div",ms,[p.capabilities?.outputCostPerToken?(u(),b("span",fs," $"+f(D(p.capabilities.outputCostPerToken)),1)):(u(),b("span",gs,"-"))])):B("",!0),t("div",_s,[t("span",ys,f(g(o).getEnvironmentalCost(p,"carbon")),1)]),t("div",bs,[t("span",ks,f(g(o).getEnvironmentalCost(p,"water")),1)]),t("div",hs,[t("span",ws,f(g(o).getEnvironmentalCost(p,"energy")),1)])],8,ls))),128))])])}}}),Ms=re(Cs,[["__scopeId","data-v-2b840b1b"]]),$s={class:"model-preference-manager"},Os={class:"preferences-section"},Ps={class:"action-group"},Ds={class:"action-group"},As={class:"status-grid"},Ss={class:"status-item"},Es={class:"status-value"},xs={class:"status-item"},Ls={class:"status-value"},Rs={class:"status-item"},Fs={class:"status-value"},Vs={class:"status-item"},Us={class:"status-value"},zs={class:"status-item"},Ts={class:"status-value"},Bs={class:"status-item"},Ns={class:"status-value"},js={class:"action-group"},Gs={class:"provider-grid"},Is={class:"provider-name"},Ks={class:"provider-stats"},Ws={class:"provider-total"},qs={class:"provider-enabled"},Js=ie({__name:"ModelPreferenceManagerV3",setup(F){const{models:i,enabledModels:o,modelsByProvider:l}=Ue(),{discoveryStatus:m}=qe(),_=Re(),{showFinancialCosts:V,showEnvironmentalCosts:x}=_,D=y([]),h=y(!1),d=y(!1),L=y(""),C=y("");async function p(){h.value=!0,L.value="";try{const c=await _.exportModelPreferences();if(c.ok){const s=new Blob([JSON.stringify(c.value,null,2)],{type:"application/json"}),A=URL.createObjectURL(s),P=document.createElement("a");P.href=A,P.download=`model-preferences-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(A),C.value="Model preferences exported successfully!"}else L.value=c.error.message}catch(c){L.value=`Failed to export preferences: ${c instanceof Error?c.message:"Unknown error"}`}finally{h.value=!1}}async function w(c){d.value=!0,L.value="";try{const s=await c.text(),A=JSON.parse(s),P=await _.importModelPreferences(A);P.ok?C.value="Model preferences imported successfully!":L.value=P.error.message}catch(s){s instanceof SyntaxError?L.value="Invalid JSON file format":L.value=`Failed to import preferences: ${s instanceof Error?s.message:"Unknown error"}`}finally{d.value=!1}return!1}return(c,s)=>{const A=ye,P=xt,q=Ne,J=je,K=Ge,Z=Be,R=Te;return u(),b("div",$s,[r(R,{activeKey:D.value,"onUpdate:activeKey":s[2]||(s[2]=U=>D.value=U),bordered:!1,class:"preferences-collapse"},{default:n(()=>[r(Z,{key:"preferences"},{header:n(()=>s[3]||(s[3]=[t("div",{class:"preferences-header"},[t("strong",null,"ðŸ”§ V3 Enhanced Features"),t("span",{class:"preferences-description"},"Advanced model preference management")],-1)])),default:n(()=>[t("div",Os,[t("div",Ps,[s[6]||(s[6]=t("h5",{class:"action-title"},"Model Preferences",-1)),s[7]||(s[7]=t("p",{class:"action-description"}," Export and import your model enabled/disabled preferences for backup or sharing. ",-1)),r(q,null,{default:n(()=>[r(A,{onClick:p,loading:h.value,type:"primary"},{icon:n(()=>[r(g(Et))]),default:n(()=>[s[4]||(s[4]=M(" Export Preferences "))]),_:1,__:[4]},8,["loading"]),r(P,{"before-upload":w,"show-upload-list":!1,accept:".json"},{default:n(()=>[r(A,{loading:d.value},{icon:n(()=>[r(g(Lt))]),default:n(()=>[s[5]||(s[5]=M(" Import Preferences "))]),_:1,__:[5]},8,["loading"])]),_:1})]),_:1})]),r(J),t("div",Ds,[s[14]||(s[14]=t("h5",{class:"action-title"},"V3 System Information",-1)),s[15]||(s[15]=t("p",{class:"action-description"}," Enhanced V3 backend capabilities and status. ",-1)),t("div",As,[t("div",Ss,[s[8]||(s[8]=t("span",{class:"status-label"},"Total Models:",-1)),t("span",Es,f(g(i)?.length||0),1)]),t("div",xs,[s[9]||(s[9]=t("span",{class:"status-label"},"Enabled Models:",-1)),t("span",Ls,f(g(o)?.length||0),1)]),t("div",Rs,[s[10]||(s[10]=t("span",{class:"status-label"},"Active Providers:",-1)),t("span",Fs,f(Object.keys(g(l)||{}).length),1)]),t("div",Vs,[s[11]||(s[11]=t("span",{class:"status-label"},"Discovery Sources:",-1)),t("span",Us,f(g(m)?.length||0),1)]),t("div",zs,[s[12]||(s[12]=t("span",{class:"status-label"},"Cost Display:",-1)),t("span",Ts,f(g(V)?"Enabled":"Disabled"),1)]),t("div",Bs,[s[13]||(s[13]=t("span",{class:"status-label"},"Environmental Display:",-1)),t("span",Ns,f(g(x)?"Enabled":"Disabled"),1)])])]),r(J),t("div",js,[s[16]||(s[16]=t("h5",{class:"action-title"},"Provider Status",-1)),s[17]||(s[17]=t("p",{class:"action-description"}," Real-time provider status and model counts. ",-1)),t("div",Gs,[(u(!0),b(H,null,se(g(l),(U,j)=>(u(),b("div",{key:j,class:"provider-item"},[t("div",Is,f(g(_).getProviderDisplayName(j)),1),t("div",Ks,[t("span",Ws,f(U.length)+" total",1),t("span",qs,f(U.filter(te=>te.enabled).length)+" enabled",1)])]))),128))])])]),L.value?(u(),N(K,{key:0,type:"error",message:L.value,closable:"",onClose:s[0]||(s[0]=U=>L.value=""),class:"error-alert"},null,8,["message"])):B("",!0),C.value?(u(),N(K,{key:1,type:"success",message:C.value,closable:"",onClose:s[1]||(s[1]=U=>C.value=""),class:"success-alert"},null,8,["message"])):B("",!0)]),_:1})]),_:1},8,["activeKey"])])}}}),Hs=re(Js,[["__scopeId","data-v-f4de1453"]]),Qs={key:0,class:"loading-state"},Xs={key:1,class:"error-state"},Ys={class:"error-message"},Zs=["onClick"],ea={class:"list-header"},ta={class:"list-info"},sa={class:"list-name"},aa={class:"list-meta"},oa={class:"list-actions"},la={class:"list-description"},na={class:"list-preview"},ra={key:0,class:"more-models"},ia=ie({__name:"ModelListsDropdownV3",props:{currentModels:{},isLoading:{type:Boolean,default:!1}},emits:["apply-list","close"],setup(F,{emit:i}){const o=F,l=i,{getProviderGroup:m}=ze(),_=y([]),V=y(!0),x=y(""),D=y(!1),h=y("");Ve(async()=>{try{V.value=!0,x.value="";const{getModelListManager:c}=await Fe(async()=>{const{getModelListManager:P}=await import("./index-BNyV4f0C.js").then(q=>q.F);return{getModelListManager:P}},__vite__mapDeps([0,1,2,3,4])),A=await c().getLists();_.value=A.filter(P=>["openrouter-favorites","cost-efficient","high-performance"].includes(P.id)),_.value.length}catch(c){E.error("Failed to load model lists:",c),x.value="Failed to load model lists"}finally{V.value=!1}});function d(c){return o.currentModels.some(s=>s.modelId!==c.modelId?!1:c.provider?s.provider===c.provider&&s.enabled:c.providerGroup?m(s.provider)===c.providerGroup&&s.enabled:!1)}function L(c){return c.models.slice(0,3)}function C(c){return c.modelId.replace(/^.*\//,"").replace(/-instruct$/,"").replace(/-preview$/,"")}async function p(c){if(!(D.value||o.isLoading))try{D.value=!0,h.value=c,await new Promise(s=>{l("apply-list",c),setTimeout(()=>{s()},2e3)})}catch(s){E.error("Failed to apply list:",s)}finally{D.value=!1,h.value=""}}function w(c){c.domEvent?.stopPropagation()}return(c,s)=>{const A=Rt,P=ye,q=Ie,J=Ft,K=_e,Z=We;return u(),N(Z,{class:"model-lists-menu",onClick:w},{default:n(()=>[V.value?(u(),b("div",Qs,[r(A,{size:"small"}),s[0]||(s[0]=t("span",null,"Loading model lists...",-1))])):x.value?(u(),b("div",Xs,[t("span",Ys,f(x.value),1)])):(u(),b(H,{key:2},[s[6]||(s[6]=t("div",{class:"menu-header"},[t("span",null,"Built-in Lists")],-1)),(u(!0),b(H,null,se(_.value,R=>(u(),N(q,{key:R.id,class:"list-menu-item"},{default:n(()=>[t("div",{class:"list-item",onClick:U=>p(R.id)},[t("div",ea,[t("div",ta,[t("span",sa,f(R.name),1),t("span",aa,f(R.models.length)+" models",1)]),t("div",oa,[r(P,{type:"primary",size:"small",loading:D.value&&h.value===R.id,onClick:ae(U=>p(R.id),["stop"])},{default:n(()=>s[1]||(s[1]=[M(" Apply ")])),_:2,__:[1]},1032,["loading","onClick"])])]),t("div",la,f(R.description),1),t("div",na,[(u(!0),b(H,null,se(L(R),(U,j)=>(u(),b("span",{key:`${U.provider||U.providerGroup}-${U.modelId}`,class:ee(["preview-model",{enabled:d(U)}])},f(C(U))+f(j<L(R).length-1?", ":""),3))),128)),R.models.length>3?(u(),b("span",ra," +"+f(R.models.length-3)+" more ",1)):B("",!0)])],8,Zs)]),_:2},1024))),128)),r(J),r(q,{disabled:"",class:"future-feature"},{default:n(()=>[r(g(Vt)),s[3]||(s[3]=t("span",null,"Save Current Selection...",-1)),r(K,{color:"blue",size:"small"},{default:n(()=>s[2]||(s[2]=[M("Soon")])),_:1,__:[2]})]),_:1,__:[3]}),r(q,{disabled:"",class:"future-feature"},{default:n(()=>[r(g(Ke)),s[5]||(s[5]=t("span",null,"Manage Lists...",-1)),r(K,{color:"blue",size:"small"},{default:n(()=>s[4]||(s[4]=[M("Soon")])),_:1,__:[4]})]),_:1,__:[5]})],64))]),_:1})}}}),da=re(ia,[["__scopeId","data-v-5706641b"]]),ua={class:"models-view","data-testid":"page-models"},ca={class:"page-header"},va={key:3,class:"discovery-status-bar"},pa={class:"source-name"},ma=["onClick","data-testid","aria-label"],fa={class:"search-filter-bar"},ga={class:"control-bar"},_a={class:"left-controls"},ya={class:"dropdown-item"},ba={class:"dropdown-item"},ka={class:"stats"},ha={class:"provider-header"},wa={class:"provider-info"},Ca={key:1,class:"provider-summary"},Ma=ie({__name:"ModelsViewV3",setup(F){const i=Dt(),{models:o,modelsByProvider:l,stats:m}=Ue(),{getProviderGroup:_,requiresApiKey:V}=ze(),x=Ct(),{hasApiKey:D}=x.secureSettings,{discoverModels:h,refreshDiscoverySource:d,toggleModel:L,toggleAllModels:C,toggleProviderModels:p,clearAllModels:w,isDiscovering:c,isTogglingModels:s}=ts(),{discoveryStatus:A,getSourceDisplayName:P,getProviderDisplayName:q,refreshStatus:J}=qe(),K=y(""),Z=y(""),R=y("all"),U=y(!1),j=y({hideOpenRouterFree:!1,hideOpenRouterAuto:!1}),te=I(()=>{const a={};return Object.keys(l.value||{}).forEach(e=>{const v=_(e),S=V(e),G=D(v);a[e]={hasKey:G,providerGroup:v,requiresKey:S}}),a}),de=y(!1),O=y(""),Q=y([]),be=y(null),ke=y([]),Je=y(!1),oe=y(null),ue=y(!1);let ce=null;const He=a=>{ce&&clearTimeout(ce),ce=setTimeout(()=>{Z.value=a},300)},ve=I(()=>{const a={};for(const[e,v]of Object.entries(l.value))a[e]=v.filter(S=>S.enabled).length;return a}),X=y([]),le=I(()=>{const a=Z.value.toLowerCase(),e={},v=Object.keys(l.value);if(X.value.length===0||v.some(S=>!X.value.includes(S))){const S=X.value.filter(z=>v.includes(z)),G=v.filter(z=>!X.value.includes(z)).sort();X.value=[...S,...G]}for(const S of X.value){const G=l.value[S];if(!G)continue;let z=[...G];a&&(z=z.filter(Y=>Y.displayName.toLowerCase().includes(a)||Y.modelId.toLowerCase().includes(a)||S.toLowerCase().includes(a))),R.value==="enabled"?z=z.filter(Y=>Y.enabled):R.value==="disabled"&&(z=z.filter(Y=>!Y.enabled)),z.length>0&&(e[S]=z)}return e}),Qe=I(()=>m.value.total),Xe=I(()=>m.value.enabled),Ye=I(()=>l.value.openrouter?.length>0),Ze=I(()=>K.value?`No models found matching "${K.value}"`:R.value!=="all"?`No ${R.value} models found`:'No models available. Click "Refresh Models" to discover models.'),pe=I(()=>{if(!O.value)return!1;const a=O.value.toLowerCase();return a.includes("ollama")&&(a.includes("failed to fetch")||a.includes("networkerror when attempting to fetch"))&&!a.includes("litellm")&&!a.includes("openrouter")}),et=I(()=>{const a=l.value["ollama-chat"]?.length>0||l.value["ollama-generate"]?.length>0,e=A.value.some(v=>v.id==="ollama");return a||e||pe.value}),me=I(()=>{const a=X.value.length;return Q.value.length===a&&a>0}),tt=Se(Ut),st=Se(zt);function at(a){return{idle:"default",loading:"processing",success:"success",error:"error"}[a]||"default"}function ot(a){return ve.value[a]||0}function lt(a){const e=ot(a),v=(l.value[a]||[]).length;return e===0?"default":e===v?"success":"warning"}function nt(a){const e=le.value[a]||[];return e.length>0&&e.every(v=>v.enabled)}function rt(a){const e=le.value[a]||[];return e.length>0&&e.every(v=>!v.enabled)}function it(a){i.push({path:"/settings",query:a?{provider:a}:void 0})}function dt(){me.value?Q.value=[]:Q.value=[...X.value]}async function ut(a,e){const v=await L(a,e);v.ok||(O.value=v.error.message)}async function he(a,e){const v=await p(a,e);v.ok||(O.value=v.error.message)}async function ct(){const a=await C(!0);a.ok||(O.value=a.error.message)}async function vt(){const a=await C(!1);a.ok||(O.value=a.error.message)}async function fe(){U.value=!0,O.value="";try{const a=await h({forceRefresh:!0});if(a.ok){a.value.totalModels,o.value.length;const e=a.value.errors.filter(v=>!(v.includes("ollama")&&v.includes("not detected")));e.length>0&&(O.value=`Some sources failed: ${e.join("; ")}`)}else a.error,O.value=`Discovery failed: ${a.error.message}`;J()}catch(a){E.error("Failed to refresh models",a),O.value="Failed to refresh models. Please check your connection and try again."}finally{U.value=!1}}async function pt(a){be.value=a,O.value="";try{const e=await d(a);a==="ollama"&&(e.ok&&e.value?.errors?.some(S=>S.includes("not detected"))||!e.ok&&e.error?.message?.includes("not detected"))||(e.ok&&e.value.errors.length>0?O.value=`Failed to refresh ${P(a)}: ${e.value.errors.join("; ")}`:e.ok||(O.value=`Failed to refresh ${P(a)}: ${e.error.message}`)),J()}catch(e){E.error("Failed to retry source",e,{sourceId:a}),O.value=`Failed to refresh ${P(a)}: ${e instanceof Error?e.message:"Unknown error"}`}finally{be.value=null}}async function mt(){try{await d("ollama"),J(),Ce()}catch(a){E.error("Failed to refresh Ollama models after update",a)}}async function we(){j.value,await $.settings.get("main")?await $.settings.update("main",{hideOpenRouterFree:j.value.hideOpenRouterFree,hideOpenRouterAuto:j.value.hideOpenRouterAuto}):await $.settings.add({id:"main",version:1,initialized:!0,hideOpenRouterFree:j.value.hideOpenRouterFree,hideOpenRouterAuto:j.value.hideOpenRouterAuto}),await $.settings.get("main")}async function Ce(){try{(await Xt()).hasIssue?oe.value="not-detected":oe.value=null}catch{}}async function ft(){if(confirm("This will remove all models and re-discover them from scratch. Any custom model configurations will be lost. Continue?")){de.value=!0,O.value="";try{const e=await w();if(!e.ok){O.value=e.error.message;return}const v=await h({forceRefresh:!0});if(v.ok&&v.value.errors.length>0){const S=v.value.errors.filter(G=>!(G.includes("ollama")&&G.includes("not detected")));S.length>0&&(O.value=`Some sources failed: ${S.join("; ")}`)}else v.ok||(O.value=`Discovery failed: ${v.error.message}`);J()}catch(e){E.error("Failed to clear and refresh models",e),O.value="Failed to clear and refresh models. Please check your connection and try again."}finally{de.value=!1}}}async function gt(a){try{const{getModelListManager:e}=await Fe(async()=>{const{getModelListManager:G}=await import("./index-BNyV4f0C.js").then(z=>z.F);return{getModelListManager:G}},__vite__mapDeps([0,1,2,3,4])),S=await e().applyList(a);await fe()}catch(e){E.error("Failed to apply model list:",e),O.value=`Failed to apply model list: ${e instanceof Error?e.message:"Unknown error"}`}}Mt(()=>{He(K.value)});const W=I(()=>s.value);return Ve(async()=>{o.value.length,o.value,l.value;const a=await $.settings.get("main");a&&(j.value={hideOpenRouterFree:a.hideOpenRouterFree??!1,hideOpenRouterAuto:a.hideOpenRouterAuto??!1}),o.value.length===0&&fe(),Q.value=[],Ce()}),$t(()=>{K.value="",Q.value=[],O.value=""}),(a,e)=>{const v=ye,S=Ne,G=Ge,z=_e,Y=Tt,ge=Kt,_t=Bt,yt=je,Me=Nt,$e=Jt,Oe=Ie,bt=We,kt=Ht,Pe=Be,De=Te,ht=jt;return u(),b("div",ua,[t("div",ca,[e[13]||(e[13]=t("div",{class:"header-content"},[t("h1",null,"Model Management"),t("p",{class:"description"},"Configure and enable LLM models for testing")],-1)),r(S,null,{default:n(()=>[r(v,{type:"primary",onClick:fe,loading:U.value||g(c),"data-testid":"btn-refresh-models","aria-label":"Refresh available models"},{icon:n(()=>[r(g(Gt))]),default:n(()=>[e[11]||(e[11]=M(" Refresh Models "))]),_:1,__:[11]},8,["loading"]),r(v,{danger:"",onClick:ft,loading:de.value,"data-testid":"btn-clear-refresh-models","aria-label":"Clear all models and refresh"},{icon:n(()=>[r(g(It))]),default:n(()=>[e[12]||(e[12]=M(" Clear and Refresh Models "))]),_:1,__:[12]},8,["loading"])]),_:1})]),O.value&&!pe.value?(u(),N(G,{key:0,type:"error",message:O.value,closable:"",onClose:e[0]||(e[0]=k=>O.value=""),class:"error-alert"},null,8,["message"])):B("",!0),pe.value?(u(),N(G,{key:1,type:"info",closable:"",onClose:e[1]||(e[1]=k=>O.value=""),class:"ollama-info-alert"},{message:n(()=>e[14]||(e[14]=[t("div",{class:"ollama-message"},[M(" Ollama is not running on this computer. To audit local LLMs, install "),t("a",{href:"https://ollama.com",target:"_blank",rel:"noopener noreferrer"},"Ollama"),M(". ")],-1)])),_:1})):B("",!0),oe.value?(u(),N(G,{key:2,type:"info",closable:"",onClose:e[2]||(e[2]=k=>oe.value=null),class:"ollama-cors-alert"},{message:n(()=>e[15]||(e[15]=[t("div",{class:"ollama-cors-message"},[t("strong",null,"Ollama not detected: "),t("a",{href:"https://ollama.com",target:"_blank",rel:"noopener noreferrer"},"Ollama"),M(" is an external program for running LLMs on your computer. If Ollama is installed, you must "),t("a",{href:"https://objectgraph.com/blog/ollama-cors/",target:"_blank",rel:"noopener noreferrer"},"configure CORS"),M(' by setting OLLAMA_ORIGINS to "*" or "auditomatic.org". If you do not wish to use Ollama, close and ignore this message. ')],-1)])),_:1})):B("",!0),g(A).length>0?(u(),b("div",va,[e[16]||(e[16]=t("span",{class:"status-label"},"Sources:",-1)),(u(!0),b(H,null,se(g(A),k=>(u(),b("div",{key:k.id,class:"source-status-compact"},[t("span",pa,f(g(P)(k.id)),1),r(z,{color:at(k.status),size:"small"},{default:n(()=>[k.status==="success"&&k.modelCount?(u(),b(H,{key:0},[M(f(k.modelCount),1)],64)):k.status==="error"?(u(),b("span",{key:1,onClick:T=>pt(k.id),style:{cursor:"pointer"},"data-testid":`retry-source-${k.id}`,"aria-label":`Retry loading models from ${g(P)(k.id)}`},"âŸ³ retry",8,ma)):(u(),b(H,{key:2},[M(f(k.status),1)],64))]),_:2},1032,["color"])]))),128))])):B("",!0),t("div",fa,[r(Y,{value:K.value,"onUpdate:value":e[3]||(e[3]=k=>K.value=k),placeholder:"Search models by name, provider, or ID...","allow-clear":"",size:"large",class:"search-input","data-testid":"input-model-search","aria-label":"Search models",loading:K.value!==Z.value},null,8,["value","loading"]),r(_t,{value:R.value,"onUpdate:value":e[4]||(e[4]=k=>R.value=k),"button-style":"solid",size:"large"},{default:n(()=>[r(ge,{value:"all"},{default:n(()=>e[17]||(e[17]=[M("All")])),_:1,__:[17]}),r(ge,{value:"enabled"},{default:n(()=>e[18]||(e[18]=[M("Enabled")])),_:1,__:[18]}),r(ge,{value:"disabled"},{default:n(()=>e[19]||(e[19]=[M("Disabled")])),_:1,__:[19]})]),_:1},8,["value"])]),t("div",ga,[t("div",_a,[r(v,{type:"text",size:"small",onClick:dt},{icon:n(()=>[(u(),N(Ot(me.value?st.value:tt.value)))]),default:n(()=>[M(" "+f(me.value?"Collapse All":"Expand All"),1)]),_:1}),r(yt,{type:"vertical"}),r(v,{type:"text",size:"small",onClick:ct,loading:W.value,disabled:W.value},{icon:n(()=>[r(g(Ee))]),default:n(()=>[e[20]||(e[20]=M(" Enable All "))]),_:1,__:[20]},8,["loading","disabled"]),r(v,{type:"text",size:"small",onClick:vt,loading:W.value,disabled:W.value},{icon:n(()=>[r(g(xe))]),default:n(()=>[e[21]||(e[21]=M(" Disable All "))]),_:1,__:[21]},8,["loading","disabled"]),r(Me,{open:ue.value,"onUpdate:open":e[6]||(e[6]=k=>ue.value=k),placement:"bottomLeft",disabled:W.value},{overlay:n(()=>[r(da,{"current-models":Array.from(g(o)),"is-loading":W.value,onApplyList:gt,onClose:e[5]||(e[5]=k=>ue.value=!1)},null,8,["current-models","is-loading"])]),default:n(()=>[r(v,{type:"text",size:"small",loading:W.value,disabled:W.value},{icon:n(()=>[r(g(qt))]),default:n(()=>[e[22]||(e[22]=M(" Model Lists ")),r(g(Wt))]),_:1,__:[22]},8,["loading","disabled"])]),_:1},8,["open","disabled"]),Ye.value?(u(),N(Me,{key:0},{overlay:n(()=>[r(bt,null,{default:n(()=>[r(Oe,{key:"privacy"},{default:n(()=>[t("div",ya,[r($e,{checked:j.value.hideOpenRouterFree,"onUpdate:checked":e[7]||(e[7]=k=>j.value.hideOpenRouterFree=k),onChange:we},{default:n(()=>e[23]||(e[23]=[M(" Hide free models (privacy concerns) ")])),_:1,__:[23]},8,["checked"])])]),_:1}),r(Oe,{key:"auto"},{default:n(()=>[t("div",ba,[r($e,{checked:j.value.hideOpenRouterAuto,"onUpdate:checked":e[8]||(e[8]=k=>j.value.hideOpenRouterAuto=k),onChange:we},{default:n(()=>e[24]||(e[24]=[M(" Hide Auto Router (unpredictable costs) ")])),_:1,__:[24]},8,["checked"])])]),_:1})]),_:1})]),default:n(()=>[r(v,{type:"text",size:"small"},{icon:n(()=>[r(g(Ke))]),default:n(()=>[e[25]||(e[25]=M(" OpenRouter Settings "))]),_:1,__:[25]})]),_:1})):B("",!0)]),t("div",ka,[t("span",null,f(Xe.value)+" of "+f(Qe.value)+" models enabled",1)])]),r(De,{activeKey:Q.value,"onUpdate:activeKey":e[9]||(e[9]=k=>Q.value=k),bordered:!1,class:"provider-collapse",destroyInactivePanel:!1},{default:n(()=>[(u(!0),b(H,null,se(le.value,(k,T)=>(u(),N(Pe,{key:`provider-${T}`},{header:n(()=>[t("div",ha,[t("div",wa,[t("strong",null,f(g(q)(T)),1),te.value[T]?.requiresKey&&!te.value[T]?.hasKey?(u(),N(kt,{key:0,placement:"top"},{title:n(()=>[M(" API key not set for "+f(te.value[T]?.providerGroup)+". Click to add in settings. ",1)]),default:n(()=>[r(v,{type:"link",danger:"",size:"small",onClick:ae(Ae=>it(te.value[T]?.providerGroup),["stop"])},{icon:n(()=>[r(g(Qt))]),default:n(()=>[e[26]||(e[26]=M(" API Key Missing "))]),_:2,__:[26]},1032,["onClick"])]),_:2},1024)):B("",!0),Q.value.includes(T)?(u(),b(H,{key:2},[r(z,{size:"small",color:"blue"},{default:n(()=>[M(f(k.length)+" models",1)]),_:2},1024),r(z,{size:"small",color:lt(T)},{default:n(()=>[M(f(ve.value[T]||0)+" enabled ",1)]),_:2},1032,["color"])],64)):(u(),b("span",Ca,f(ve.value[T]||0)+" / "+f((g(l)[T]||[]).length)+" enabled ",1))]),r(S,{size:"small"},{default:n(()=>[r(v,{type:"text",size:"small",onClick:ae(Ae=>he(T,!0),["stop"]),disabled:nt(T)||W.value,loading:W.value},{icon:n(()=>[r(g(Ee))]),default:n(()=>[e[27]||(e[27]=M(" Enable All "))]),_:2,__:[27]},1032,["onClick","disabled","loading"]),r(v,{type:"text",size:"small",onClick:ae(Ae=>he(T,!1),["stop"]),disabled:rt(T)||W.value,loading:W.value},{icon:n(()=>[r(g(xe))]),default:n(()=>[e[28]||(e[28]=M(" Disable All "))]),_:2,__:[28]},1032,["onClick","disabled","loading"])]),_:2},1024)])]),default:n(()=>[(u(),N(Pt,null,[r(Ms,{models:k,"provider-id":T,onToggleModel:ut},null,8,["models","provider-id"])],1024))]),_:2},1024))),128))]),_:1},8,["activeKey"]),Object.keys(le.value).length===0?(u(),N(ht,{key:4,description:Ze.value,class:"empty-state"},null,8,["description"])):B("",!0),et.value?(u(),N(De,{key:5,activeKey:ke.value,"onUpdate:activeKey":e[10]||(e[10]=k=>ke.value=k),bordered:!1,class:"ollama-manager-collapse"},{default:n(()=>[r(Pe,{key:"ollama"},{header:n(()=>e[29]||(e[29]=[t("div",{class:"ollama-header"},[t("strong",null,"Ollama Model Management"),t("span",{class:"ollama-description"},"Download and manage local Ollama models")],-1)])),default:n(()=>[r(At,{onModelsUpdated:mt})]),_:1})]),_:1},8,["activeKey"])):B("",!0),Je.value?(u(),N(Hs,{key:6,class:"enhanced-features"})):B("",!0)])}}}),Ra=re(Ma,[["__scopeId","data-v-5fbbcd2a"]]);export{Ra as default};
