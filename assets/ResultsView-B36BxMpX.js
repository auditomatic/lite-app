const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./APICallDetailModal-DwjcouZb.js","./vendor-DCf9YP3r.js","./designs-db-D4FnITPe.js","./db-CL8uhZCz.js","./index-dQqVkRMY.js","./index-Dgs9Bne1.css","./defaultData-DyqJdH2z.js","./variables-db-BMGRJyAs.js","./logger.service-_k__GSpu.js","./registry-DiQCbBcP.js","./models-db-3pG6m6YE.js","./trials-db-V2RTzc2h.js","./mock-provider.service-BAPeV6CB.js","./settings-db-CBuX-T7S.js","./ModelSelectionTable-svkIGbxX.js","./cost-formatting-Cno2rTOg.js","./ModelSelectionTable-B2A5b4Ts.css","./BaseModal.vue_vue_type_style_index_0_lang-Br6W_Dvv.js","./BaseModal-DbTyIa7L.css","./APICallDetailModal-DBFG6c-d.css"])))=>i.map(i=>d[i]);
import{j as e,f as a,e as t,_ as l,T as s,R as n,g as i,i as r,L as o,k as u}from"./index-dQqVkRMY.js";import{k as c,d,f as p,c as v,a3 as f,B as m,Y as y,F as g,a5 as h,G as _,_ as b,U as k,X as x,W as C,q as w,ac as R,af as S,S as j,a7 as T,u as E,l as I,ab as M,w as P,o as $,V as O}from"./vendor-DCf9YP3r.js";import{c as q,g as D,i as z,u as A}from"./trials-db-V2RTzc2h.js";import{u as L}from"./BaseModal.vue_vue_type_style_index_0_lang-Br6W_Dvv.js";import{A as N,a as U,_ as F,T as B}from"./APICallDetailModal-DwjcouZb.js";import"./db-CL8uhZCz.js";import"./defaultData-DyqJdH2z.js";import"./registry-DiQCbBcP.js";import"./designs-db-D4FnITPe.js";import"./variables-db-BMGRJyAs.js";import"./logger.service-_k__GSpu.js";import"./mock-provider.service-BAPeV6CB.js";import"./settings-db-CBuX-T7S.js";import"./models-db-3pG6m6YE.js";import"./ModelSelectionTable-svkIGbxX.js";import"./cost-formatting-Cno2rTOg.js";var V={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"};function H(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),l.forEach(function(a){J(e,a,t[a])})}return e}function J(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var W=function(a,t){var l=H({},a,t.attrs);return c(e,H({},l,{icon:V}),null)};W.displayName="ExportOutlined",W.inheritAttrs=!1;const K={class:"modal-content"},G={class:"modal-header"},Y={class:"modal-body"},X={class:"section"},Q={class:"format-options"},Z=["value"],ee={class:"format-label"},ae={class:"format-name"},te={class:"section"},le={class:"field-groups"},se={class:"field-list"},ne=["value"],ie={class:"field-label"},re={class:"field-name"},oe={class:"field-desc"},ue={class:"section"},ce={class:"preview-info"},de={class:"preview-count"},pe={class:"preview-fields"},ve={class:"preview-size"},fe={class:"modal-footer"},me=l(d({__name:"ExportDataModal",props:{trial:{},apiCalls:{}},emits:["close"],setup(e){const l=e,s=[{id:"csv",name:"CSV",description:"Comma-separated values (Excel compatible)"},{id:"tsv",name:"TSV",description:"Tab-separated values"},{id:"excel",name:"Excel",description:"Microsoft Excel (.xlsx)"},{id:"json",name:"JSON",description:"JavaScript Object Notation"},{id:"jsonl",name:"JSONL",description:"JSON Lines (one object per line)"}],n=[{name:"Basic Info",fields:[{id:"id",name:"ID",description:"API call identifier",default:!0},{id:"trial_id",name:"Trial ID",description:"Parent trial identifier",default:!0},{id:"trial_name",name:"Trial Name",description:"Human-readable trial name",default:!0},{id:"status",name:"Status",description:"Call status (completed, failed, etc.)",default:!0},{id:"created",name:"Created",description:"When the call was initiated",default:!0},{id:"completed",name:"Completed",description:"When the call finished",default:!0}]},{name:"Configuration",fields:[{id:"configuration_index",name:"Config Index",description:"Configuration array index",default:!1},{id:"configuration_name",name:"Config Name",description:"Human-readable config name",default:!1},{id:"provider",name:"Provider",description:"LLM service provider",default:!0},{id:"model",name:"Model",description:"Model identifier",default:!0}]},{name:"Content",fields:[{id:"prompt",name:"Prompt",description:"Input prompt text",default:!0},{id:"variables",name:"Variables",description:"Variable substitutions (flattened as separate columns)",default:!0},{id:"result_content",name:"Result Content",description:"LLM response content",default:!0},{id:"result_error",name:"Result Error",description:"Error message if failed",default:!0}]},{name:"Performance",fields:[{id:"response_latency_ms",name:"Latency (ms)",description:"Response time",default:!0},{id:"duration_ms",name:"Duration (ms)",description:"Total processing time",default:!1},{id:"result_success",name:"Success",description:"Whether call succeeded",default:!0}]},{name:"Technical Details",fields:[{id:"request_url",name:"Request URL",description:"API endpoint URL",default:!0},{id:"request_method",name:"Request Method",description:"HTTP method",default:!1},{id:"request_headers",name:"Request Headers",description:"HTTP request headers",default:!1},{id:"request_body",name:"Request Body",description:"Full request payload",default:!1},{id:"response_status",name:"Response Status",description:"HTTP status code",default:!0},{id:"response_headers",name:"Response Headers",description:"HTTP response headers",default:!1},{id:"response_body",name:"Response Body",description:"Full response payload",default:!1}]},{name:"Error Handling",fields:[{id:"network_error_count",name:"Network Errors",description:"Number of network failures",default:!1},{id:"retry_count",name:"Retry Count",description:"Number of retry attempts",default:!1}]}],i=p("csv"),r=p([]),o=n.flatMap(e=>e.fields);r.value=o.filter(e=>e.default).map(e=>e.id);const u=v(()=>{const e=50*r.value.length,a=l.apiCalls.length*e;return a<1024?`${a}B`:a<1048576?`${(a/1024).toFixed(1)}KB`:`${(a/1048576).toFixed(1)}MB`});function d(){r.value=o.map(e=>e.id)}function j(){r.value=o.filter(e=>e.default).map(e=>e.id)}function T(){r.value=[]}function E(){const e=new Set;return r.value.includes("variables")&&l.apiCalls.forEach(a=>{a.variables&&"object"==typeof a.variables&&Object.keys(a.variables).forEach(a=>e.add(a))}),l.apiCalls.map(a=>{const t={};var s,n;if(r.value.includes("id")&&(t.ID=a.id),r.value.includes("trial_id")&&(t["Trial ID"]=a.trialId),r.value.includes("trial_name")&&(t["Trial Name"]=l.trial.name),r.value.includes("status")&&(t.Status=a.status),r.value.includes("created")&&(t.Created=a.created.toISOString()),r.value.includes("completed")&&(t.Completed=a.completed?.toISOString()||""),r.value.includes("configuration_index")&&(t["Configuration Index"]=a.configurationIndex),r.value.includes("configuration_name")&&(t["Configuration Name"]=(s=a.configurationIndex,l.trial.configurationSnapshots[s]&&l.trial.configurationSnapshots[s].name||`Config ${s+1}`)),r.value.includes("provider")&&(t.Provider=(n=a,n.request?.url?.includes("openai.com")?"OpenAI":n.request?.url?.includes("anthropic.com")?"Anthropic":n.request?.url?.includes("openrouter.ai")?"OpenRouter":n.request?.url?.includes("localhost:11434")?"Ollama":"Unknown")),r.value.includes("model")&&(t.Model=function(e){return e.request?.body?.model?e.request.body.model:"Unknown"}(a)),r.value.includes("prompt")&&(t.Prompt=a.prompt),r.value.includes("variables"))for(const l of e)t[`variable_${l}`]=a.variables?.[l]||"";return r.value.includes("result_content")&&(t["Result Content"]=a.result?.content||""),r.value.includes("result_error")&&(t["Result Error"]=a.result?.error||""),r.value.includes("response_latency_ms")&&(t["Response Latency (ms)"]=a.response?.latencyMs||""),r.value.includes("duration_ms")&&(t["Duration (ms)"]=a.completed?a.completed.getTime()-a.created.getTime():""),r.value.includes("result_success")&&(t["Result Success"]=a.result?.success||!1),r.value.includes("request_url")&&(t["Request URL"]=a.request?.url||""),r.value.includes("request_method")&&(t["Request Method"]=a.request?.method||""),r.value.includes("request_headers")&&(t["Request Headers"]=JSON.stringify(a.request?.headers||{})),r.value.includes("request_body")&&(t["Request Body"]=JSON.stringify(a.request?.body||{})),r.value.includes("response_status")&&(t["Response Status"]=a.response?.status||""),r.value.includes("response_headers")&&(t["Response Headers"]=JSON.stringify(a.response?.headers||{})),r.value.includes("response_body")&&(t["Response Body"]=JSON.stringify(a.response?.body||{})),r.value.includes("network_error_count")&&(t["Network Error Count"]=0),r.value.includes("retry_count")&&(t["Retry Count"]=0),t})}async function I(){const e=E(),s=(new Date).toISOString().split("T")[0],n=`${l.trial.name}_${i.value}_${s}`;try{switch(i.value){case"csv":!function(e,a){if(0===e.length)return;const t=Object.keys(e[0]||{}),l=t.filter(e=>!e.startsWith("variable_")),s=t.filter(e=>e.startsWith("variable_")).sort(),n=[...l,...s],i=[n.join(","),...e.map(e=>n.map(a=>`"${String(e[a]||"").replace(/"/g,'""')}"`).join(","))].join("\n");M(i,`${a}.csv`,"text/csv")}(e,n);break;case"tsv":!function(e,a){if(0===e.length)return;const t=Object.keys(e[0]||{}),l=t.filter(e=>!e.startsWith("variable_")),s=t.filter(e=>e.startsWith("variable_")).sort(),n=[...l,...s],i=[n.join("\t"),...e.map(e=>n.map(a=>String(e[a]||"").replace(/\t/g," ")).join("\t"))].join("\n");M(i,`${a}.tsv`,"text/tab-separated-values")}(e,n);break;case"excel":await async function(e,a){const l=await t(()=>import("./xlsx-C4WhbwXR.js"),[],import.meta.url),s=l.utils.book_new(),n=l.utils.json_to_sheet(e),i=Object.keys(e[0]||{}),r=i.map(e=>({wch:Math.min(Math.max(e.length,10),50)}));n["!cols"]=r,l.utils.book_append_sheet(s,n,"Trial Results"),l.writeFile(s,`${a}.xlsx`)}(e,n);break;case"json":!function(e,a){const t=JSON.stringify(e,null,2);M(t,`${a}.json`,"application/json")}(e,n);break;case"jsonl":!function(e,a){const t=e.map(e=>JSON.stringify(e)).join("\n");M(t,`${a}.jsonl`,"application/jsonl")}(e,n)}}catch(r){console.error("Export failed:",r),a.error("Export failed: "+(r instanceof Error?r.message:"Unknown error"))}}function M(e,a,t){let l=e;"text/csv"!==t&&"text/tab-separated-values"!==t||(l="\ufeff"+e);const s=new Blob([l],{type:`${t};charset=utf-8`}),n=URL.createObjectURL(s),i=document.createElement("a");i.href=n,i.download=a,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}return(e,a)=>{const t=k("a-button");return C(),f("div",{class:"modal-overlay",onClick:a[4]||(a[4]=m(a=>e.$emit("close"),["self"]))},[y("div",K,[y("div",G,[a[5]||(a[5]=y("h3",null,"Export Trial Data",-1)),y("button",{onClick:a[0]||(a[0]=a=>e.$emit("close")),class:"close-btn"},"×")]),y("div",Y,[y("div",X,[a[6]||(a[6]=y("h4",null,"Export Format",-1)),y("div",Q,[(C(),f(g,null,h(s,e=>y("label",{key:e.id,class:"format-option"},[w(y("input",{type:"radio",value:e.id,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),class:"format-radio"},null,8,Z),[[R,i.value]]),y("span",ee,[y("span",ae,b(e.name),1)])])),64))])]),y("div",te,[y("h4",null,[a[7]||(a[7]=_(" Fields to Export ")),y("div",{class:"field-controls"},[y("button",{onClick:d,class:"control-btn"},"Select All"),y("button",{onClick:j,class:"control-btn"},"Defaults"),y("button",{onClick:T,class:"control-btn"},"Select None")])]),y("div",le,[(C(),f(g,null,h(n,e=>y("div",{key:e.name,class:"field-group"},[y("h5",null,b(e.name),1),y("div",se,[(C(!0),f(g,null,h(e.fields,e=>(C(),f("label",{key:e.id,class:"field-option"},[w(y("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":a[2]||(a[2]=e=>r.value=e),class:"field-checkbox"},null,8,ne),[[S,r.value]]),y("span",ie,[y("span",re,b(e.name),1),y("span",oe,b(e.description),1)])]))),128))])])),64))])]),y("div",ue,[a[8]||(a[8]=y("h4",null,"Export Preview",-1)),y("div",ce,[y("span",de,b(e.apiCalls.length)+" records",1),y("span",pe,b(r.value.length)+" fields",1),y("span",ve,"~"+b(u.value),1)])])]),y("div",fe,[c(t,{onClick:a[3]||(a[3]=a=>e.$emit("close")),size:"large",class:"footer-button"},{default:x(()=>a[9]||(a[9]=[_(" Cancel ")])),_:1,__:[9]}),c(t,{type:"primary",onClick:I,disabled:0===r.value.length,size:"large",class:"footer-button footer-button-primary"},{default:x(()=>[_(" Export "+b(i.value.toUpperCase()),1)]),_:1},8,["disabled"])])])])}}}),[["__scopeId","data-v-891b72bd"]]),ye={class:"results-table-container full-width"},ge={class:"results-header"},he={class:"header-actions"},_e={class:"scientific-table-container"},be={class:"scientific-table-wrapper"},ke={key:0,class:"trial-info-cell"},xe={class:"trial-header"},Ce={class:"trial-name"},we={class:"trial-design"},Re={class:"text-secondary"},Se={class:"trial-created"},je={class:"text-secondary"},Te={key:1,class:"progress-summary"},Ee={class:"progress-stats"},Ie={class:"stat successful"},Me={class:"stat failed"},Pe={class:"stat total"},$e={class:"progress-text"},Oe={key:0,class:"error-indicator"},qe={key:2,class:"success-rate-cell"},De={class:"rate-value"},ze={key:3,class:"performance-cell"},Ae={class:"metric"},Le={class:"metric-value"},Ne={class:"metric"},Ue={class:"metric-value"},Fe={key:4,class:"configurations-cell"},Be={class:"config-details"},Ve={class:"text-secondary"},He={key:5,class:"cost-summary"},Je={key:1,class:"text-secondary"},We={key:0,class:"cost-per-call"},Ke={key:6,class:"table-actions-grid table-actions-grid-3"},Ge=l(d({__name:"ResultsTable",props:{trials:{},loading:{type:Boolean,default:!1}},emits:["view-results","export-trial","duplicate-trial","delete-trial","trial-details","refresh-trials","export-all","status-filter-changed"],setup(e,{emit:a}){const t=e,l=a,o=p("all"),u=p(!1),d=p(null),w=p([]),R=[{key:"all",label:"All"},{key:"completed",label:"Completed"},{key:"failed",label:"Failed"},{key:"running",label:"Running"},{key:"cancelled",label:"Cancelled"}],{getVisibleColumns:S,createResultColumns:P}=L(),$=S(P()),O=v(()=>"all"===o.value?t.trials:t.trials.filter(e=>e.status===o.value)),q=v(()=>t.trials.filter(e=>"completed"===e.status));function D(e){o.value=e,l("status-filter-changed",e)}function z(e){l("view-results",e)}function A(e){return"all"===e?t.trials.length:t.trials.filter(a=>a.status===e).length}function N(e){return 0===e.progress.total?0:Math.round(e.progress.completed/e.progress.total*100)}function U(e){if(0===e.progress.completed)return 0;const a=e.progress.completed-e.progress.networkErrors;return Math.round(a/e.progress.completed*100)}function F(e){const a=U(e);return a>=95?"#52c41a":a>=80?"#faad14":"#ff4d4f"}function B(e){return e.progress.completed>0?"1,234":"-"}function V(e){return e.progress.completed>0?"2.5":"-"}function H(e){if(0===e.progress.total||0===e.estimatedCost)return"-";return(Math.abs(e.estimatedCost)/e.progress.total).toFixed(4)}function J(e){const a=[];return"completed"===e.status&&a.push("status-completed"),"failed"===e.status&&a.push("status-failed"),"running"===e.status&&a.push("status-running"),a.join(" ")}function W(e){const a=(new Date).getTime()-e.getTime(),t=Math.floor(a/864e5);return 0===t?"Today":1===t?"Yesterday":t<7?`${t} days ago`:t<30?`${Math.floor(t/7)} weeks ago`:e.toLocaleDateString()}function K(){l("refresh-trials")}async function G(){const e=q.value;if(0!==e.length)try{const a=[];for(const t of e){const e=await r.apiCalls.where("trialId").equals(t.id).toArray();a.push(...e)}d.value={id:"all-trials",name:`All Completed Trials (${e.length} trials)`,status:"completed",created:new Date,updated:new Date,designSnapshot:{originalName:"Multiple Designs"},configurationSnapshots:[],variableSnapshots:{},progress:{completed:a.filter(e=>"completed"===e.status).length,total:a.length,networkErrors:a.filter(e=>"failed"===e.status).length},totalCombinations:a.length,estimatedCost:e.reduce((e,a)=>e+a.estimatedCost,0)},w.value=a,u.value=!0}catch(a){console.error("Failed to load API calls:",a)}}function Y(e){return I("div",{class:"expanded-trial-details"},[I("h4",{style:{margin:"0 0 12px 0",fontSize:"13px"}},"Configuration Breakdown"),I(s,{columns:[{title:"Model",dataIndex:"model",key:"model",width:200},{title:"Parameters",dataIndex:"parameters",key:"parameters",width:300},{title:"Calls",dataIndex:"calls",key:"calls",width:80,align:"center"},{title:"Success Rate",dataIndex:"successRate",key:"successRate",width:100,align:"center"},{title:"Avg Latency",dataIndex:"latency",key:"latency",width:100,align:"center"},{title:"Cost",dataIndex:"cost",key:"cost",width:80,align:"right"}],dataSource:(a=e,(a.configurationSnapshots||[]).map((e,t)=>({id:t,model:`${e.provider}:${e.modelId}`,parameters:Object.entries(e.parameters).map(([e,a])=>`${e}:${a}`).join(", "),calls:Math.floor(a.progress.total/(a.configurationSnapshots?.length||1)),successRate:`${U(a)}%`,latency:B(a)+"ms",cost:`$${H(a)}`}))),pagination:!1,size:"small",rowKey:"id"})]);var a}return(e,a)=>{const t=k("a-button"),s=k("a-space"),p=k("a-tab-pane"),v=k("a-tabs"),S=k("a-tag"),I=k("a-progress"),P=k("a-table");return C(),f("div",ye,[y("div",ge,[a[4]||(a[4]=y("div",{class:"header-content"},[y("h2",null,"Trial Results"),y("p",{class:"description"}," Analyze and export completed experimental results ")],-1)),y("div",he,[c(s,null,{default:x(()=>[c(t,{onClick:K},{icon:x(()=>[c(E(n))]),default:x(()=>[a[2]||(a[2]=_(" Refresh "))]),_:1,__:[2]}),c(t,{type:"primary",onClick:G,disabled:0===q.value.length},{icon:x(()=>[c(E(i))]),default:x(()=>[a[3]||(a[3]=_(" Export All Data "))]),_:1,__:[3]},8,["disabled"])]),_:1})])]),c(v,{activeKey:o.value,"onUpdate:activeKey":a[0]||(a[0]=e=>o.value=e),size:"small",class:"status-tabs",onChange:D},{default:x(()=>[(C(),f(g,null,h(R,e=>c(p,{key:e.key,tab:`${e.label} (${A(e.key)})`},null,8,["tab"])),64))]),_:1},8,["activeKey"]),y("div",_e,[y("div",be,[c(P,{columns:E($),"data-source":O.value,pagination:!1,size:"small",scroll:{y:"calc(100vh - 200px)"},"row-key":"id","row-class-name":J,class:"scientific-table",onRowClick:z,"expand-row-by-click":!1,"expanded-row-render":Y},{bodyCell:x(({column:e,record:s})=>{return["trial"===e.key?(C(),f("div",ke,[y("div",xe,[y("strong",Ce,b(s.name),1),c(S,{color:(i=s.status,{completed:"success",failed:"error",running:"processing",cancelled:"default",draft:"default",pending:"processing",paused:"warning"}[i]||"default"),size:"small",class:"trial-status-tag"},{default:x(()=>[_(b(s.status.toUpperCase()),1)]),_:2},1032,["color"])]),y("div",we,[y("small",Re," Design: "+b(s.designSnapshot?.originalName||"Unknown Design"),1)]),y("div",Se,[y("small",je," Created "+b(W(s.created)),1)])])):T("",!0),"progress"===e.key?(C(),f("div",Te,[y("div",Ee,[y("span",Ie,b(s.progress.completed)+" ✓",1),y("span",Me,b(s.progress.networkErrors)+" ✗",1),y("span",Pe,"/ "+b(s.progress.total),1)]),c(I,{percent:N(s),size:"small",status:(n=s,"failed"===n.status?"exception":"completed"===n.status?"success":n.progress.networkErrors>0?"exception":"normal"),"show-info":!1,class:"progress-bar"},null,8,["percent","status"]),y("div",$e,[_(b(N(s))+"% complete ",1),s.progress.networkErrors>0?(C(),f("span",Oe," ("+b(s.progress.networkErrors)+" errors) ",1)):T("",!0)])])):T("",!0),"success_rate"===e.key?(C(),f("div",qe,[y("div",De,b(U(s))+"%",1),c(I,{percent:U(s),size:"small","show-info":!1,"stroke-color":F(s),class:"success-rate-bar"},null,8,["percent","stroke-color"])])):T("",!0),"performance"===e.key?(C(),f("div",ze,[y("div",Ae,[a[5]||(a[5]=y("small",{class:"metric-label"},"Avg Latency",-1)),y("strong",Le,b(B(s))+"ms",1)]),y("div",Ne,[a[6]||(a[6]=y("small",{class:"metric-label"},"Throughput",-1)),y("strong",Ue,b(V(s))+"/min",1)])])):T("",!0),"configurations"===e.key?(C(),f("div",Fe,[c(S,{size:"small",color:"blue"},{default:x(()=>[_(b(s.configurationSnapshots?.length||0)+" configs ",1)]),_:2},1024),s.repeatConfig?.callsPerPrompt&&s.repeatConfig.callsPerPrompt>1?(C(),j(S,{key:0,size:"small",color:"purple",style:{"margin-left":"4px"}},{default:x(()=>[_(b(s.repeatConfig.callsPerPrompt)+"× repeat ",1)]),_:2},1024)):T("",!0),y("div",Be,[y("small",Ve,b(s.totalCombinations)+" variables ",1)])])):T("",!0),"cost"===e.key?(C(),f("div",He,[y("span",{class:M(["cost-value",{negative:s.estimatedCost<0}])},[Math.abs(s.estimatedCost)>0?(C(),f(g,{key:0},[_(" $"+b(Math.abs(s.estimatedCost).toFixed(3)),1)],64)):(C(),f("span",Je,"-"))],2),s.progress.total>0?(C(),f("small",We," $"+b(H(s))+"/call ",1)):T("",!0)])):T("",!0),"actions"===e.key?(C(),f("div",Ke,[c(t,{size:"small",onClick:m(e=>function(e){l("view-results",e)}(s),["stop"])},{default:x(()=>a[7]||(a[7]=[_(" View Results ")])),_:2,__:[7]},1032,["onClick"]),c(t,{size:"small",onClick:m(e=>async function(e){d.value=e;try{w.value=await r.apiCalls.where("trialId").equals(e.id).toArray(),u.value=!0}catch(a){console.error("Failed to load API calls:",a)}}(s),["stop"])},{default:x(()=>a[8]||(a[8]=[_(" Data Export ")])),_:2,__:[8]},1032,["onClick"]),c(t,{size:"small",onClick:m(e=>function(e){l("export-trial",e,"python")}(s),["stop"])},{default:x(()=>a[9]||(a[9]=[_(" Python Export ")])),_:2,__:[9]},1032,["onClick"])])):T("",!0)];var n,i}),_:1},8,["columns","data-source"])])]),u.value&&d.value?(C(),j(me,{key:0,trial:d.value,"api-calls":w.value,onClose:a[1]||(a[1]=e=>u.value=!1)},null,8,["trial","api-calls"])):T("",!0)])}}}),[["__scopeId","data-v-a31ee0a2"]]),Ye={class:"repeat-group"},Xe={class:"group-header"},Qe={class:"prompt-preview"},Ze={class:"prompt-text"},ea={key:0,class:"group-stats"},aa={key:0,class:"stats-range"},ta={class:"response-header"},la={class:"response-index"},sa={key:2,class:"latency"},na={class:"response-content"},ia={key:0,class:"result-content"},ra={class:"extracted-value"},oa={key:1,class:"raw-response"},ua={class:"response-text"},ca={key:2,class:"error-content"},da=l(d({__name:"RepeatGroupResults",props:{calls:{},initialExpanded:{type:Boolean}},setup(e){const a=e,t=p(a.initialExpanded?[a.calls[0]?.id]:[]),l=v(()=>q(a.calls));function s(e,a=150){return e.length<=a?e:e.substring(0,a)+"..."}return(e,a)=>{const n=k("a-tag"),i=k("a-space"),r=k("a-statistic"),o=k("a-col"),u=k("a-row"),d=k("a-alert"),p=k("a-collapse-panel"),v=k("a-collapse");return C(),f("div",Ye,[y("div",Xe,[y("div",Qe,[a[1]||(a[1]=y("strong",null,"Prompt:",-1)),y("span",Ze,b(s(e.calls[0].prompt)),1)]),c(i,null,{default:x(()=>[c(n,{color:"blue"},{default:x(()=>[_(b(e.calls.length)+" responses",1)]),_:1}),100===l.value.consistencyScore?(C(),j(n,{key:0,color:"green"},{default:x(()=>a[2]||(a[2]=[_("Consistent")])),_:1,__:[2]})):l.value.consistencyScore>=80?(C(),j(n,{key:1,color:"orange"},{default:x(()=>a[3]||(a[3]=[_("Mostly Consistent")])),_:1,__:[3]})):(C(),j(n,{key:2,color:"red"},{default:x(()=>a[4]||(a[4]=[_("Varied")])),_:1,__:[4]}))]),_:1})]),e.calls.length>1?(C(),f("div",ea,[c(u,{gutter:16},{default:x(()=>[c(o,{span:6},{default:x(()=>[c(r,{title:"Consistency",value:l.value.consistencyScore,suffix:"%",precision:1},null,8,["value"])]),_:1}),c(o,{span:6},{default:x(()=>[c(r,{title:"Avg Response Length",value:l.value.avgResponseLength},null,8,["value"])]),_:1}),c(o,{span:6},{default:x(()=>[c(r,{title:"Avg Response Time",value:l.value.avgResponseTime,suffix:"ms"},null,8,["value"])]),_:1}),c(o,{span:6},{default:x(()=>[c(r,{title:"Success Rate",value:l.value.successRate,suffix:"%"},null,8,["value"])]),_:1})]),_:1}),l.value.minResponseTime!==l.value.maxResponseTime?(C(),f("div",aa,[y("span",null,"Response time range: "+b(l.value.minResponseTime)+"ms - "+b(l.value.maxResponseTime)+"ms",1)])):T("",!0)])):T("",!0),c(v,{activeKey:t.value,"onUpdate:activeKey":a[0]||(a[0]=e=>t.value=e),style:{"margin-top":"16px"}},{default:x(()=>[(C(!0),f(g,null,h(e.calls,(e,t)=>(C(),j(p,{key:e.id},{header:x(()=>[y("div",ta,[y("span",la,"Response "+b(t+1),1),c(i,{size:"small"},{default:x(()=>[e.result?.success?(C(),j(n,{key:0,color:"success",size:"small"},{default:x(()=>a[5]||(a[5]=[_("Success")])),_:1,__:[5]})):(C(),j(n,{key:1,color:"error",size:"small"},{default:x(()=>a[6]||(a[6]=[_("Failed")])),_:1,__:[6]})),e.response?.latencyMs?(C(),f("span",sa,b(e.response.latencyMs)+"ms",1)):T("",!0)]),_:2},1024)])]),default:x(()=>[y("div",na,[e.result?.content?(C(),f("div",ia,[a[7]||(a[7]=y("h4",null,"Extracted Result:",-1)),y("div",ra,b(e.result.content),1)])):T("",!0),e.response?.body?.choices?.[0]?.message?.content?(C(),f("div",oa,[a[8]||(a[8]=y("h4",null,"Full Response:",-1)),y("pre",ua,b(e.response.body.choices[0].message.content),1)])):e.result?.error?(C(),f("div",ca,[c(d,{type:"error","show-icon":""},{message:x(()=>[_(b(e.result.error),1)]),_:2},1024)])):T("",!0)])]),_:2},1024))),128))]),_:1},8,["activeKey"])])}}}),[["__scopeId","data-v-dbf18579"]]),pa={class:"results-table-container"},va={class:"filters-bar"},fa={key:0,class:"grouped-results"},ma={key:0,class:"loading-container"},ya={key:1},ga={key:1},ha={key:2,class:"variables-compact"},_a={key:0,class:"text-secondary"},ba={key:1,class:"text-secondary"},ka={key:2,class:"text-error"},xa={key:3,class:"response-content"},Ca={key:4,class:"text-secondary"},wa={key:0,class:"length-value"},Ra={key:1,class:"text-secondary"},Sa={key:0},ja={key:1,class:"text-secondary"},Ta=l(d({__name:"TrialResultsTable",props:{trial:{},apiCalls:{},loading:{type:Boolean}},setup(e){const a=e,t=p(""),l=p(""),s=p(""),n=p(!1),i=p(null),r=[{title:"Status",key:"status",width:100,fixed:"left"},{title:"Config",key:"config",width:150},{title:"Variables",key:"variables",width:400},{title:"Response",key:"response",ellipsis:!0},{title:"Length",key:"length",width:80,align:"right"},{title:"Latency",key:"latency",width:80,align:"right"}],u=v(()=>D(d.value)),d=v(()=>{let e=a.apiCalls;if(t.value&&(e=e.filter(e=>e.status===t.value)),""!==l.value&&(e=e.filter(e=>e.configurationIndex===Number(l.value))),s.value){const a=s.value.toLowerCase();e=e.filter(e=>{if(JSON.stringify(e.variables).toLowerCase().includes(a))return!0;if(e.result?.content){if(String(e.result.content).toLowerCase().includes(a))return!0}return!1})}return e});function m(e){const t=a.trial.configurationSnapshots[e];return t?.name||`Config ${e+1}`}return(e,a)=>{const p=k("a-select-option"),v=k("a-select"),w=k("a-input-search"),R=k("a-space"),S=k("a-button"),I=k("a-spin"),M=k("a-tag"),P=k("a-tooltip"),$=k("a-table");return C(),f("div",pa,[y("div",va,[c(R,null,{default:x(()=>[c(v,{value:t.value,"onUpdate:value":a[0]||(a[0]=e=>t.value=e),placeholder:"All Statuses",style:{width:"150px"},size:"small","allow-clear":""},{default:x(()=>[c(p,{value:""},{default:x(()=>a[6]||(a[6]=[_("All Statuses")])),_:1,__:[6]}),c(p,{value:"completed"},{default:x(()=>a[7]||(a[7]=[_("Completed")])),_:1,__:[7]}),c(p,{value:"failed"},{default:x(()=>a[8]||(a[8]=[_("Failed")])),_:1,__:[8]}),c(p,{value:"running"},{default:x(()=>a[9]||(a[9]=[_("Running")])),_:1,__:[9]}),c(p,{value:"pending"},{default:x(()=>a[10]||(a[10]=[_("Pending")])),_:1,__:[10]})]),_:1},8,["value"]),c(v,{value:l.value,"onUpdate:value":a[1]||(a[1]=e=>l.value=e),placeholder:"All Configurations",style:{width:"200px"},size:"small","allow-clear":""},{default:x(()=>[c(p,{value:""},{default:x(()=>a[11]||(a[11]=[_("All Configurations")])),_:1,__:[11]}),(C(!0),f(g,null,h(e.trial.configurationSnapshots,(e,a)=>(C(),j(p,{key:a,value:a},{default:x(()=>[_(b(e.name||`Config ${a+1}`),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),c(w,{value:s.value,"onUpdate:value":a[2]||(a[2]=e=>s.value=e),placeholder:"Search variables or response...",style:{width:"300px"},size:"small","allow-clear":""},null,8,["value"])]),_:1}),c(S,{size:"small",onClick:a[3]||(a[3]=e=>n.value=!0)},{icon:x(()=>[c(E(W))]),default:x(()=>[a[12]||(a[12]=_(" Export Data "))]),_:1,__:[12]})]),E(z)(e.trial)?(C(),f("div",fa,[e.loading?(C(),f("div",ma,[c(I,{size:"large"})])):(C(),f("div",ya,[(C(!0),f(g,null,h(u.value,([e,a])=>(C(),j(da,{key:e,calls:a,"initial-expanded":1===u.value.size},null,8,["calls","initial-expanded"]))),128))]))])):(C(),j($,{key:1,columns:r,"data-source":d.value,loading:e.loading,pagination:!1,scroll:{y:"calc(100vh - 350px)",x:1400},size:"small","row-key":"id",class:"results-table","custom-row":e=>({onClick:()=>{return a=e,void(i.value=a);var a},class:"clickable-row"})},{bodyCell:x(({column:e,record:t})=>{return["status"===e.key?(C(),j(M,{key:0,color:(l=t.status,{completed:"success",failed:"error",running:"processing",pending:"default"}[l]||"default"),size:"small"},{default:x(()=>[_(b(t.status.toUpperCase()),1)]),_:2},1032,["color"])):T("",!0),"config"===e.key?(C(),f("code",ga,b(m(t.configurationIndex)),1)):T("",!0),"variables"===e.key?(C(),f("div",ha,[(C(!0),f(g,null,h(t.variables,(e,a)=>(C(),j(P,{key:a},{title:x(()=>[_(b(a)+": "+b(e),1)]),default:x(()=>[c(M,{size:"small"},{default:x(()=>{return[_(b(a)+": "+b((t=String(e),l=15,t.length<=l?t:t.substring(0,l)+"...")),1)];var t,l}),_:2},1024)]),_:2},1024))),128))])):T("",!0),"response"===e.key?(C(),f(g,{key:3},["pending"===t.status?(C(),f("div",_a," Waiting... ")):"running"===t.status?(C(),f("div",ba,[c(E(o)),a[13]||(a[13]=_(" Processing... "))])):"failed"===t.status?(C(),f("div",ka,b(t.result?.error||"API call failed"),1)):t.result?.content?(C(),f("div",xa,[y("span",null,b(String(t.result.content)),1)])):(C(),f("div",Ca," No content "))],64)):T("",!0),"length"===e.key?(C(),f(g,{key:4},[t.result?.content?(C(),f("span",wa,b(String(t.result.content).length),1)):(C(),f("span",Ra,"-"))],64)):T("",!0),"latency"===e.key?(C(),f(g,{key:5},[t.response?.latencyMs?(C(),f("span",Sa,b(t.response.latencyMs)+"ms ",1)):(C(),f("span",ja,"-"))],64)):T("",!0)];var l}),_:1},8,["data-source","loading","custom-row"])),n.value?(C(),j(me,{key:2,trial:e.trial,"api-calls":d.value,onClose:a[4]||(a[4]=e=>n.value=!1)},null,8,["trial","api-calls"])):T("",!0),i.value?(C(),j(N,{key:3,"api-call":i.value,trial:e.trial,onClose:a[5]||(a[5]=e=>i.value=null)},null,8,["api-call","trial"])):T("",!0)])}}}),[["__scopeId","data-v-bd7b561d"]]),Ea={class:"trial-analysis"},Ia={class:"stats-summary"},Ma=l(d({__name:"TrialAnalysisView",props:{trial:{},apiCalls:{},loading:{type:Boolean}},emits:["back-to-selection","export-trial"],setup(e){const a=e,t=v(()=>a.apiCalls.filter(e=>"completed"===e.status).length),l=v(()=>a.apiCalls.filter(e=>"failed"===e.status).length),s=v(()=>{const e=t.value+l.value;return 0===e?0:Math.round(t.value/e*100)}),n=v(()=>{const e=a.apiCalls.filter(e=>e.response?.latencyMs);if(0===e.length)return 0;const t=e.reduce((e,a)=>e+(a.response?.latencyMs||0),0);return Math.round(t/e.length)}),i=v(()=>a.trial.progress.completed*(a.trial.estimatedCost/a.trial.progress.total));return(e,a)=>{const r=k("a-statistic"),o=k("a-divider");return C(),f("div",Ea,[y("div",Ia,[c(r,{title:"Success Rate",value:s.value,suffix:"%","value-style":{color:s.value>=90?"#52c41a":s.value>=70?"#faad14":"#ff4d4f"}},null,8,["value","value-style"]),c(o,{type:"vertical"}),c(r,{title:"Completed",value:t.value,suffix:`/ ${e.trial.progress.total}`},null,8,["value","suffix"]),c(o,{type:"vertical"}),c(r,{title:"Failed",value:l.value,"value-style":{color:l.value>0?"#ff4d4f":"#52c41a"}},null,8,["value","value-style"]),c(o,{type:"vertical"}),c(r,{title:"Avg Latency",value:n.value,suffix:"ms"},null,8,["value"]),c(o,{type:"vertical"}),c(r,{title:"Total Cost",value:i.value,prefix:"$",precision:4},null,8,["value"])]),c(Ta,{trial:e.trial,"api-calls":e.apiCalls,loading:e.loading},null,8,["trial","api-calls","loading"])])}}}),[["__scopeId","data-v-29db9da1"]]),Pa={class:"results-view full-width"},$a={key:0,class:"results-table-view"},Oa={key:1,class:"analysis-view"},qa={class:"analysis-header"},Da={class:"analysis-title"},za=l(d({__name:"ResultsView",setup(e){const a=A(),l=O(),s=p("table"),n=p(null),o=p(null),d=p([]),v=p([]),m=p(!1),g=p(!1),h=p("all"),w=p(!1),R=p(!1),S=p(!1),I=p(null),M=p(null);async function q(){m.value=!0;try{await a.initialize(),d.value=a.trials}catch(e){console.error("Failed to load trials:",e)}finally{m.value=!1}}async function D(e){!function(e){n.value=e.id,o.value=e}(e),s.value="analysis",await async function(){if(n.value){g.value=!0;try{v.value=await r.apiCalls.where("trialId").equals(n.value).toArray()}catch(e){console.error("Failed to load results:",e)}finally{g.value=!1}}}()}function z(){s.value="table",n.value=null,o.value=null,v.value=[]}function L(e,a){I.value=e,"python"===a?w.value=!0:Y(e)}function N(e){M.value=e,S.value=!0}function V(e){o.value=e,R.value=!0}function H(){}function J(e){h.value=e}function W(e){w.value=!1,I.value=null}function K(){q()}function G(e){S.value=!1,M.value=null,q()}async function Y(e){try{const{PythonExportService:a}=await t(async()=>{const{PythonExportService:e}=await import("./APICallDetailModal-DwjcouZb.js").then(e=>e.p);return{PythonExportService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]),import.meta.url);await a.downloadPythonScript(e)}catch(a){console.error("Export failed:",a),alert("Export failed: "+(a instanceof Error?a.message:"Unknown error"))}}async function X(e){if(confirm(`Delete trial "${e.name}"? This cannot be undone.`))try{await a.deleteTrial(e.id),n.value===e.id&&z()}catch(t){console.error("Failed to delete trial:",t),alert("Failed to delete trial")}}return P(d,async e=>{e.length>0&&await async function(){const e=l.query.trialId;if(e&&d.value.length>0){const a=d.value.find(a=>a.id===e);a&&await D(a)}}()},{immediate:!0}),$(async()=>{await q()}),(e,a)=>{const t=k("a-button"),l=k("a-tag"),n=k("a-space");return C(),f("div",Pa,["table"===s.value?(C(),f("div",$a,[c(Ge,{trials:d.value,loading:m.value,onViewResults:D,onExportTrial:L,onDuplicateTrial:N,onDeleteTrial:X,onTrialDetails:V,onRefreshTrials:q,onExportAll:H,onStatusFilterChanged:J},null,8,["trials","loading"])])):"analysis"===s.value&&o.value?(C(),f("div",Oa,[y("div",qa,[c(t,{onClick:z,type:"default",class:"back-button"},{icon:x(()=>[c(E(u))]),default:x(()=>[a[4]||(a[4]=_(" Back to Results "))]),_:1,__:[4]}),y("div",Da,[y("h2",null,b(o.value.name),1),c(l,{color:(r=o.value.status,{completed:"success",failed:"error",running:"processing",cancelled:"default",draft:"default",pending:"processing",paused:"warning"}[r]||"default"),size:"small"},{default:x(()=>[_(b(o.value.status.toUpperCase()),1)]),_:1},8,["color"])]),c(n,null,{default:x(()=>[c(t,{class:"btn-success",onClick:a[0]||(a[0]=e=>Y(o.value))},{icon:x(()=>[c(E(i))]),default:x(()=>[a[5]||(a[5]=_(" Export Results "))]),_:1,__:[5]})]),_:1})]),c(Ma,{trial:o.value,"api-calls":v.value,loading:g.value,onBackToSelection:z,onExportTrial:Y},null,8,["trial","api-calls","loading"])])):T("",!0),w.value&&I.value?(C(),j(U,{key:2,trial:I.value,onClose:a[1]||(a[1]=e=>{w.value=!1,I.value=null}),onExported:W},null,8,["trial"])):T("",!0),R.value&&o.value?(C(),j(F,{key:3,trial:o.value,onClose:a[2]||(a[2]=e=>R.value=!1),onUpdated:K},null,8,["trial"])):T("",!0),S.value?(C(),j(B,{key:4,trialToDuplicate:M.value,onClose:a[3]||(a[3]=e=>{S.value=!1,M.value=null}),onCreated:G},null,8,["trialToDuplicate"])):T("",!0)]);var r}}}),[["__scopeId","data-v-cabae3d6"]]);export{za as default};
