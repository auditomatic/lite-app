const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./APICallDetailModal-DwjcouZb.js","./vendor-DCf9YP3r.js","./designs-db-D4FnITPe.js","./db-CL8uhZCz.js","./index-dQqVkRMY.js","./index-Dgs9Bne1.css","./defaultData-DyqJdH2z.js","./variables-db-BMGRJyAs.js","./logger.service-_k__GSpu.js","./registry-DiQCbBcP.js","./models-db-3pG6m6YE.js","./trials-db-V2RTzc2h.js","./mock-provider.service-BAPeV6CB.js","./settings-db-CBuX-T7S.js","./ModelSelectionTable-svkIGbxX.js","./cost-formatting-Cno2rTOg.js","./ModelSelectionTable-B2A5b4Ts.css","./BaseModal.vue_vue_type_style_index_0_lang-Br6W_Dvv.js","./BaseModal-DbTyIa7L.css","./APICallDetailModal-DBFG6c-d.css"])))=>i.map(i=>d[i]);
import{h as e,_ as a,P as l,E as t,f as s,e as i,i as o,g as r}from"./index-dQqVkRMY.js";import{d as n,f as d,r as c,c as u,S as p,W as v,U as m,X as f,Y as g,a3 as y,a7 as h,k,u as b,a5 as _,F as C,ab as w,_ as x,B as T,G as I,o as P,b as S,a6 as $,n as E,w as j,a8 as z,q as M,ae as D,a4 as L,a9 as O,V as U,Z as F}from"./vendor-DCf9YP3r.js";import{u as N}from"./trials-db-V2RTzc2h.js";import{u as A}from"./settings-db-CBuX-T7S.js";import{A as q,T as R,_ as B,a as V}from"./APICallDetailModal-DwjcouZb.js";import{u as K}from"./designs-db-D4FnITPe.js";import{u as H}from"./variables-db-BMGRJyAs.js";import{u as J}from"./models-db-3pG6m6YE.js";import{p as Y}from"./registry-DiQCbBcP.js";import{a as W}from"./cost-formatting-Cno2rTOg.js";import{l as G}from"./db-CL8uhZCz.js";import{u as Q}from"./BaseModal.vue_vue_type_style_index_0_lang-Br6W_Dvv.js";import"./defaultData-DyqJdH2z.js";import"./mock-provider.service-BAPeV6CB.js";import"./logger.service-_k__GSpu.js";import"./ModelSelectionTable-svkIGbxX.js";const X={class:"modal-content"},Z={class:"models-panel"},ee={class:"panel-header"},ae={class:"models-list"},le={class:"provider-header"},te={class:"provider-name"},se={class:"provider-count"},ie={class:"provider-models"},oe=["onClick"],re={class:"model-info"},ne={class:"model-name"},de={class:"model-cost"},ce={class:"cost-primary"},ue={key:0,class:"config-panel"},pe={class:"config-header"},ve={class:"total-cost"},me={class:"config-content"},fe={key:0,class:"params-section"},ge={key:0,class:"reasoning-model-note"},ye={class:"param-description"},he={class:"param-description"},ke={class:"config-footer"},be=a(n({__name:"ModelSelectorModal",props:{design:{},existingConfigurations:{}},emits:["close","add-configuration"],setup(a,{emit:l}){const t=a,s=l,i=J(),o=d(""),r=d([]),n=d(null),P=d(""),S=c({}),$=u(()=>{let e=i.enabledModels;if(o.value){const a=o.value.toLowerCase();e=e.filter(e=>e.displayName.toLowerCase().includes(a)||e.modelId.toLowerCase().includes(a))}const a={};for(const l of e)a[l.provider]||(a[l.provider]=[]),a[l.provider].push(l);for(const l in a)a[l].sort((e,a)=>e.displayName.localeCompare(a.displayName));return a}),E=u(()=>{let e=1;for(const a of Object.values(t.design.variableBindings))"direct"===a.type?e*=a.values?.length||1:a.listId&&(e*=10);return e}),j=u(()=>{if(!n.value)return{};const e=Y.getParametersForModel(n.value.provider,n.value.modelId),a={},l=(e,t="")=>{Object.entries(e).forEach(([e,s])=>{const i=t?`${t}.${e}`:e;"object"===s.type&&s.properties?l(s.properties,i):a[i]=s})};l(e);const t={};for(const[o,r]of Object.entries(a))r.basic&&(t[o]=r);const s={},i=t.temperature?"temperature":t["options.temperature"]?"options.temperature":null;i&&(s[i]=t[i]);for(const[o,r]of Object.entries(t))o!==i&&(s[o]=r);return s}),z=u(()=>{if(!n.value)return{};if(!Y.getProvider(n.value.provider))return{};const e=Y.getParametersForModel(n.value.provider,n.value.modelId),a={},l=(e,t="")=>{Object.entries(e).forEach(([e,s])=>{const i=t?`${t}.${e}`:e;"object"===s.type&&s.properties?l(s.properties,i):a[i]=s})};l(e);const t={};for(const[s,i]of Object.entries(a))i.basic||(t[s]={...i,label:s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())});return t}),M=u(()=>!!n.value&&(("openai-chat"===n.value.provider||"openai-responses"===n.value.provider)&&n.value.modelId.match(/^o[0-9]/)));function D(e){if(!e.capabilities)return 0;const a=t.design.tokenEstimate?.avgTokens||150,l=S.max_tokens||S.max_completion_tokens||256;return((e.capabilities.inputCostPerToken||0)*a+(e.capabilities.outputCostPerToken||0)*l)*E.value}function L(){if(!n.value)return 0;const e=t.design.tokenEstimate?.avgTokens||150,a=S.max_tokens||S.max_completion_tokens||256;return(n.value.capabilities?.inputCostPerToken||0)*e+(n.value.capabilities?.outputCostPerToken||0)*a}function O(){if(!n.value||!P.value)return;const e=Y.getParametersForModel(n.value.provider,n.value.modelId),a={},l=(e,t="")=>{Object.entries(e).forEach(([e,s])=>{const i=t?`${t}.${e}`:e;"object"===s.type&&s.properties?l(s.properties,i):void 0!==s.default&&(a[i]=s.default)})};l(e);const t={...a,...S},i=Object.entries(t).reduce((e,[a,l])=>((null!=l&&""!==l||!1===l)&&(e[a]=l),e),{});s("add-configuration",{name:P.value,provider:n.value.provider,modelId:n.value.modelId,parameters:i})}return(a,l)=>{const t=m("a-input"),s=m("a-button"),d=m("a-collapse-panel"),c=m("a-collapse"),u=m("a-form-item"),U=m("a-alert"),F=m("a-input-number"),N=m("a-select-option"),A=m("a-select"),q=m("a-col"),R=m("a-row"),B=m("a-switch"),V=m("a-form"),K=m("a-modal");return v(),p(K,{open:!0,title:null,width:"95vw",style:{top:"2.5vh",maxWidth:"1400px"},bodyStyle:{height:"90vh",padding:"0",display:"flex",flexDirection:"column"},footer:null,onCancel:l[4]||(l[4]=e=>a.$emit("close"))},{default:f(()=>[l[11]||(l[11]=g("div",{class:"modal-header"},[g("h2",null,"Select and Configure Model")],-1)),g("div",X,[g("div",Z,[g("div",ee,[l[5]||(l[5]=g("h3",null,"Available Models",-1)),k(t,{value:o.value,"onUpdate:value":l[0]||(l[0]=e=>o.value=e),placeholder:"Search models...",size:"large",allowClear:""},{prefix:f(()=>[k(b(e))]),_:1},8,["value"])]),g("div",ae,[k(c,{activeKey:r.value,"onUpdate:activeKey":l[2]||(l[2]=e=>r.value=e),ghost:""},{default:f(()=>[(v(!0),y(C,null,_($.value,(e,a)=>(v(),p(d,{key:a},{header:f(()=>[g("div",le,[g("span",te,x(a),1),g("span",se,"("+x(e.length)+" models)",1),g("div",{class:"provider-actions",onClick:l[1]||(l[1]=T(()=>{},["stop"]))},[k(s,{size:"small",onClick:e=>function(e){const a=$.value[e]||[],l=o.value?a.filter(e=>e.displayName.toLowerCase().includes(o.value.toLowerCase())||e.modelId.toLowerCase().includes(o.value.toLowerCase())):a;for(const t of l)i.toggleModel(t.id,!0)}(a)},{default:f(()=>l[6]||(l[6]=[I("Enable All")])),_:2,__:[6]},1032,["onClick"]),k(s,{size:"small",onClick:e=>function(e){const a=$.value[e]||[],l=o.value?a.filter(e=>e.displayName.toLowerCase().includes(o.value.toLowerCase())||e.modelId.toLowerCase().includes(o.value.toLowerCase())):a;for(const t of l)i.toggleModel(t.id,!1)}(a)},{default:f(()=>l[7]||(l[7]=[I("Disable All")])),_:2,__:[7]},1032,["onClick"])])])]),default:f(()=>[g("div",ie,[(v(!0),y(C,null,_(e,e=>(v(),y("div",{key:`${e.provider}:${e.modelId}`,class:w(["model-row",{"model-selected":n.value?.id===e.id}]),onClick:a=>function(e){n.value=e,P.value=e.displayName,Object.keys(S).forEach(e=>delete S[e]);const a=(e,l="")=>{Object.entries(e).forEach(([e,t])=>{const s=l?`${l}.${e}`:e;"object"===t.type&&t.properties?a(t.properties,s):void 0!==t.default&&(S[s]=t.default)})},l=Y.getParametersForModel(e.provider,e.modelId);a(l)}(e)},[g("div",re,[g("div",ne,x(e.displayName),1)]),g("div",de,[g("div",ce,x(b(W)(D(e))),1)])],10,oe))),128))])]),_:2},1024))),128))]),_:1},8,["activeKey"])])]),n.value?(v(),y("div",ue,[g("div",pe,[g("h3",null,"Configure: "+x(n.value.displayName),1),g("div",ve,[l[8]||(l[8]=I(" Total cost: ")),g("strong",null,x(b(W)(L()*E.value)),1),I(" ("+x(E.value)+" calls) ",1)])]),g("div",me,[k(V,{layout:"vertical"},{default:f(()=>[k(u,{label:"Configuration Name",required:""},{default:f(()=>[k(t,{value:P.value,"onUpdate:value":l[3]||(l[3]=e=>P.value=e),placeholder:"e.g., GPT-4 Creative",size:"large"},null,8,["value"])]),_:1}),Object.keys(j.value).length>0?(v(),y("div",fe,[l[9]||(l[9]=g("h4",null,"Basic Parameters",-1)),M.value?(v(),y("div",ge,[k(U,{message:"OpenAI O* reasoning models do not support temperature",type:"info","show-icon":"",closable:!1})])):h("",!0),k(R,{gutter:16},{default:f(()=>[(v(!0),y(C,null,_(j.value,(e,a)=>(v(),p(q,{span:12,key:a},{default:f(()=>[k(u,{label:a},{default:f(()=>["number"===e.type?(v(),p(F,{key:0,value:S[a],"onUpdate:value":e=>S[a]=e,min:e.min,max:e.max,step:e.step,placeholder:String(e.default),size:"large",style:{width:"100%"}},null,8,["value","onUpdate:value","min","max","step","placeholder"])):"integer"===e.type?(v(),p(F,{key:1,value:S[a],"onUpdate:value":e=>S[a]=e,min:e.min,max:e.max,placeholder:String(e.default),size:"large",style:{width:"100%"}},null,8,["value","onUpdate:value","min","max","placeholder"])):"string"===e.type&&e.enum?(v(),p(A,{key:2,value:S[a],"onUpdate:value":e=>S[a]=e,placeholder:String(e.default),size:"large",style:{width:"100%"},allowClear:""},{default:f(()=>[(v(!0),y(C,null,_(e.enum,e=>(v(),p(N,{key:e,value:e},{default:f(()=>[I(x(e),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])):(v(),p(t,{key:3,value:S[a],"onUpdate:value":e=>S[a]=e,placeholder:String(e.default),size:"large"},null,8,["value","onUpdate:value","placeholder"])),g("div",ye,x(e.description),1)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})])):h("",!0),k(c,{ghost:""},{default:f(()=>[k(d,{key:"advanced",header:"Advanced Parameters"},{default:f(()=>[k(R,{gutter:[16,16]},{default:f(()=>[(v(!0),y(C,null,_(z.value,(e,a)=>(v(),p(q,{span:12,key:a},{default:f(()=>[k(u,{label:e.label},{default:f(()=>["number"===e.type||"integer"===e.type?(v(),p(F,{key:0,value:S[a],"onUpdate:value":e=>S[a]=e,min:e.min,max:e.max,step:e.step,placeholder:String(e.default),size:"large",style:{width:"100%"}},null,8,["value","onUpdate:value","min","max","step","placeholder"])):"boolean"===e.type?(v(),p(B,{key:1,checked:S[a],"onUpdate:checked":e=>S[a]=e,"checked-children":"true","un-checked-children":"false"},null,8,["checked","onUpdate:checked"])):"string"===e.type&&e.enum?(v(),p(A,{key:2,value:S[a],"onUpdate:value":e=>S[a]=e,placeholder:String(e.default),size:"large",style:{width:"100%"},allowClear:""},{default:f(()=>[(v(!0),y(C,null,_(e.enum,e=>(v(),p(N,{key:e,value:e},{default:f(()=>[I(x(e),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])):(v(),p(t,{key:3,value:S[a],"onUpdate:value":e=>S[a]=e,placeholder:String(e.default),size:"large"},null,8,["value","onUpdate:value","placeholder"])),g("div",he,x(e.description),1)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),g("div",ke,[k(s,{type:"primary",size:"large",onClick:O,disabled:!P.value||!n.value},{default:f(()=>l[10]||(l[10]=[I(" Add Configuration ")])),_:1,__:[10]},8,["disabled"])])])):h("",!0)])]),_:1,__:[11]})}}}),[["__scopeId","data-v-1bb13053"]]),_e=n({__name:"ModelEditModal",props:{configuration:{},design:{}},emits:["close","save"],setup(e,{emit:a}){const l=e,t=a,s=c({...l.configuration,parameters:{...l.configuration.parameters}});function i(){t("save",s),t("close")}return(e,a)=>{const l=m("a-input"),t=m("a-form-item"),o=m("a-slider"),r=m("a-col"),n=m("a-input-number"),d=m("a-row"),c=m("a-form"),u=m("a-modal");return v(),p(u,{open:!0,title:"Edit Configuration",width:600,onOk:i,onCancel:a[3]||(a[3]=a=>e.$emit("close"))},{default:f(()=>[k(c,{layout:"vertical"},{default:f(()=>[k(t,{label:"Configuration Name"},{default:f(()=>[k(l,{value:s.name,"onUpdate:value":a[0]||(a[0]=e=>s.name=e),size:"large"},null,8,["value"])]),_:1}),k(d,{gutter:16},{default:f(()=>[k(r,{span:12},{default:f(()=>[k(t,{label:"Temperature"},{default:f(()=>[k(o,{value:s.parameters.temperature,"onUpdate:value":a[1]||(a[1]=e=>s.parameters.temperature=e),min:0,max:2,step:.1,marks:{0:"0",1:"1",2:"2"}},null,8,["value"])]),_:1})]),_:1}),k(r,{span:12},{default:f(()=>[k(t,{label:"Max Tokens"},{default:f(()=>[k(n,{value:s.parameters.max_tokens,"onUpdate:value":a[2]||(a[2]=e=>s.parameters.max_tokens=e),min:1,max:4096,size:"large",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Ce={class:"streamlined-content"},we={class:"content-section"},xe={class:"section-body"},Te={key:0,class:"design-selector"},Ie={key:0,class:"no-designs-state"},Pe={class:"no-designs-content"},Se={key:1,class:"design-list"},$e=["onClick"],Ee={class:"design-header"},je={class:"design-title-section"},ze={class:"design-name"},Me={key:0,class:"design-inline-description"},De={class:"design-date"},Le=["innerHTML"],Oe={class:"design-stats"},Ue={class:"stat-item"},Fe={class:"stat-value"},Ne={class:"stat-item"},Ae={class:"stat-value"},qe={class:"stat-item"},Re={class:"stat-value"},Be={key:1,class:"selected-design"},Ve={class:"design-display"},Ke={class:"design-header"},He={class:"template-preview"},Je={key:0,class:"content-section"},Ye={class:"section-subtitle"},We={class:"section-body"},Ge={class:"variables-summary"},Qe={class:"variable-name"},Xe={class:"variable-values"},Ze={class:"combinations-total"},ea={key:1,class:"content-section"},aa={class:"section-body"},la={class:"trial-config-table"},ta={class:"config-header-row"},sa={class:"config-trial-info"},ia={class:"trial-name-section"},oa={class:"repeat-section"},ra={class:"quick-add-row"},na={class:"quick-add-section"},da={class:"quick-add-buttons"},ca={class:"quick-cost"},ua={class:"config-table"},pa={class:"col-model"},va={class:"model-name"},ma={class:"model-provider"},fa={class:"col-params"},ga={class:"params-text"},ya={class:"col-calls"},ha={class:"calls-breakdown"},ka={class:"calls-value"},ba={class:"col-cost"},_a={class:"cost-value"},Ca={class:"col-total"},wa={class:"cost-value total-cost"},xa={class:"col-actions"},Ta={key:0,class:"table-summary-row"},Ia={class:"col-model"},Pa={class:"summary-label"},Sa={class:"col-calls"},$a={class:"summary-calls"},Ea={class:"col-total"},ja={class:"summary-cost"},za={class:"modal-footer-buttons"},Ma=a(n({__name:"TrialCreationStreamlined",props:{initialDesignId:{}},emits:["close","created","created-and-started","export-trial"],setup(a,{emit:o}){const r=a,n=o,c=$(),w=K(),T=H(),j=N(),z=A(),M=d(""),D=d(null),L=d([]),O=d(""),U=d(1),F=d(!1),q=d(!1),R=d(null),B=d(0),V=new Map,G=u(()=>{const e=J(),a=e=>z.hasApiKey(e),l=(a,l)=>!!e.enabledModels.find(e=>e.provider===a&&e.modelId===l&&e.enabled),t=[],s=new Set,i=[...j.trials].sort((e,a)=>new Date(a.created).getTime()-new Date(e.created).getTime());for(const u of i){if(t.length>=5)break;for(const e of u.configurationSnapshots||[]){if(t.length>=5)break;const i=`${e.provider}:${e.modelId}:${JSON.stringify(e.parameters)}`;if(!s.has(i)&&a(e.provider)&&l(e.provider,e.modelId)){const a=Y.getParametersForModel(e.provider,e.modelId);if(!a)continue;if(Object.keys(e.parameters).some(e=>!(e in a)))continue;s.add(i),t.push({provider:e.provider,modelId:e.modelId,displayName:e.modelId,parameters:e.parameters,outputType:"text"})}}}const o=(e,a)=>{const l=Y.getParametersForModel(e,a),t={},s=(e,a="")=>{Object.entries(e).forEach(([e,l])=>{const i=a?`${a}.${e}`:e;"object"===l.type&&l.properties?s(l.properties,i):void 0!==l.default&&(t[i]=l.default)})};s(l),t.temperature||t["options.temperature"]||(t.temperature=0);for(const[i,o]of Object.entries(l)){if(o.is_output_length&&!t[i]){t[i]=128;break}}return t},r=[{provider:"openai-chat",modelId:"gpt-4.1-nano",displayName:"gpt-4.1-nano",parameters:o("openai-chat","gpt-4.1-nano"),outputType:"text"},{provider:"openai-responses",modelId:"o4-mini",displayName:"o4-mini",parameters:o("openai-responses","o4-mini"),outputType:"text"},{provider:"anthropic",modelId:"claude-3-haiku-20240307",displayName:"claude-3-haiku-20240307",parameters:o("anthropic","claude-3-haiku-20240307"),outputType:"text"},{provider:"anthropic",modelId:"claude-4-sonnet-20250514",displayName:"claude-4-sonnet-20250514",parameters:o("anthropic","claude-4-sonnet-20250514"),outputType:"text"},{provider:"openrouter",modelId:"meta-llama/llama-3.1-8b-instruct",displayName:"meta-llama/llama-3.1-8b-instruct",parameters:o("openrouter","meta-llama/llama-3.1-8b-instruct"),outputType:"text"},{provider:"openrouter",modelId:"mistralai/mistral-nemo",displayName:"mistralai/mistral-nemo",parameters:o("openrouter","mistralai/mistral-nemo"),outputType:"text"},{provider:"openrouter",modelId:"deepseek/deepseek-chat-v3-0324",displayName:"deepseek/deepseek-chat-v3-0324",parameters:o("openrouter","deepseek/deepseek-chat-v3-0324"),outputType:"text"}],n=new Set(t.map(e=>`${e.provider}:${e.modelId}:${JSON.stringify(e.parameters)}`));for(const u of r){const e=`${u.provider}:${u.modelId}:${JSON.stringify(u.parameters)}`;!n.has(e)&&a(u.provider)&&l(u.provider,u.modelId)&&t.push(u)}const d=[],c=new Set;for(const u of t){const e=`${u.provider}:${u.modelId}`;c.has(e)||(c.add(e),d.push(u))}return d}),Q=u(()=>{const e=w.designs;if(e.length,!M.value)return e;const a=M.value.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(a)||e.promptTemplate.toLowerCase().includes(a))}),X=u(()=>{if(!D.value)return 0;let e=1;for(const a of Object.values(D.value.variableBindings))if("direct"===a.type)e*=a.values?.length||1;else if(a.listId){const l=T.lists.find(e=>e.id===a.listId);e*=l?.itemCount||1}return e}),Z=u(()=>X.value*L.value.length*U.value),ee=u(()=>{let e=0;for(const a of L.value)e+=ge(a)*X.value*U.value;return e});function ae(e){D.value=e,O.value=he()}function le(){D.value=null,L.value=[]}function te(){n("close"),c.push({name:"designs",query:{create:"true"}})}function se(e){return Object.keys(e.variableBindings).length}function ie(e){return e.replace(/\n+/g," ").replace(/\s+/g," ").trim()}function oe(e){const a=new Date,l=a.getTime()-e.getTime(),t=Math.floor(l/864e5);if(0===t)return"Today";if(1===t)return"Yesterday";if(t<7)return`${t} days ago`;if(t<30){const e=Math.floor(t/7);return`${e} week${e>1?"s":""} ago`}return e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:e.getFullYear()!==a.getFullYear()?"numeric":void 0})}function re(e){if(!e.variableBindings)return"1";let a=1;for(const l of Object.values(e.variableBindings))if("direct"===l.type&&l.values)a*=l.values.length;else if("list"===l.type&&l.listId){const e=T.lists.find(e=>e.id===l.listId);a*=e?.itemCount||1}return a>1e3?`${(a/1e3).toFixed(1)}k`:a.toString()}function ne(e){const a=function(e){if(!e.variableBindings)return[{}];const a=[];for(const[l,t]of Object.entries(e.variableBindings))if("direct"===t.type&&t.values)a.push({name:l,values:t.values});else if("list"===t.type&&t.listId){const e=T.lists.find(e=>e.id===t.listId);if(e){let t=[];t="simple"===e.category&&e.values?e.values.slice(0,3):"attributed"===e.category&&e.items?e.items.slice(0,3).map(e=>e.value):[`${l}_sample`],a.push({name:l,values:t})}}if(0===a.length)return[{}];return a.map(e=>e.values).reduce((e,a)=>e.flatMap(e=>a.map(a=>[...e,a])),[[]]).map(e=>{const l={};return a.forEach((a,t)=>{l[a.name]=e[t]}),l})}(e);if(a.length<=1)return de(ie(e.promptTemplate));const l=a[B.value%a.length],t=["variable-highlight-blue","variable-highlight-green","variable-highlight-purple","variable-highlight-orange","variable-highlight-pink","variable-highlight-teal"];let s=e.promptTemplate;Object.keys(e.variableBindings||{}).forEach((e,a)=>{if(void 0!==l[e]){const i=new RegExp(`\\{\\{\\s*${e}\\s*\\}\\}`,"g"),o=`<span class="${t[a%t.length]}">${de(String(l[e]))}</span>`;s=s.replace(i,o)}});let i=de(s);return t.forEach(e=>{i=i.replace(new RegExp(`&lt;span class="${e}"&gt;`,"g"),`<span class="${e}">`).replace(/&lt;\/span&gt;/g,"</span>")}),ie(i)}function de(e){const a=document.createElement("div");return a.textContent=e,a.innerHTML}function ce(e){if("direct"===e.type)return e.values||[];if("list"===e.type&&e.listId){const a=T.lists.find(a=>a.id===e.listId);return a?"simple"===a.category&&a.values?a.values:"attributed"===a.category&&a.items?a.items.map(e=>e.value):[]:[]}return[]}function ue(e){return L.value.some(a=>a.provider===e.provider&&a.modelId===e.modelId&&JSON.stringify(a.parameters)===JSON.stringify(e.parameters))}function pe(e){const a=J().enabledModels.find(a=>a.provider===e.provider&&a.modelId===e.modelId);if(!a)return 0;const l=D.value?.tokenEstimate?.avgTokens||0,t=Y.getParametersForModel(e.provider,e.modelId);let s=0;for(const[i,o]of Object.entries(t))if(o.is_output_length&&e.parameters[i]){s=e.parameters[i];break}if(0===l||0===s)return 0;return((a.capabilities?.inputCostPerToken||0)*l+(a.capabilities?.outputCostPerToken||0)*s)*X.value*U.value}function ve(e){const a=[];for(const[l,t]of Object.entries(e))null!=t&&a.push(`${l}=${t}`);return a.join(", ")||"Default settings"}function me(e){L.value.push(e),q.value=!1,setTimeout(()=>{E(()=>{const e=[".streamlined-content",".ant-modal-body",".ant-modal-wrap .ant-modal-body"];for(const a of e){const e=document.querySelector(a);if(e){e.scrollTo({top:e.scrollHeight,behavior:"smooth"});break}}})},100)}function fe(e){null!==R.value&&(L.value[R.value]=e,R.value=null)}function ge(e){const a=J().enabledModels.find(a=>a.provider===e.provider&&a.modelId===e.modelId);if(!a)return 0;const l=D.value?.tokenEstimate?.avgTokens||0,t=Y.getParametersForModel(e.provider,e.modelId);let s=0;for(const[i,o]of Object.entries(t))if(o.is_output_length&&e.parameters[i]){s=e.parameters[i];break}if(0===l||0===s)return 0;return(a.capabilities?.inputCostPerToken||0)*l+(a.capabilities?.outputCostPerToken||0)*s}function ye(e){return ge(e)*X.value*U.value}function he(){if(!D.value)return"New Trial";const e=(new Date).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return`${D.value.name} - ${e}`}async function ke(){if(D.value&&0!==L.value.length){F.value="start";try{const e=await j.createTrial({name:O.value||he(),designId:D.value.id,configurations:L.value,repeatConfig:U.value>1?{callsPerPrompt:U.value,strategy:"sequential"}:void 0});s.success("Trial created! Starting execution..."),n("created-and-started",e),n("close"),F.value=!1,setTimeout(async()=>{try{await j.executeTrial(e)}catch(a){console.error("Failed to start trial:",a),s.error("Failed to start trial execution")}},100)}catch(e){console.error("Failed to create trial:",e),s.error("Failed to create trial"),F.value=!1}}}async function Ma(){if(D.value&&0!==L.value.length){F.value="export";try{const e=await j.createTrial({name:O.value||he(),designId:D.value.id,configurations:L.value,repeatConfig:U.value>1?{callsPerPrompt:U.value,strategy:"sequential"}:void 0}),a=await j.getTrial(e);if(a){const{PythonExportService:e}=await i(async()=>{const{PythonExportService:e}=await import("./APICallDetailModal-DwjcouZb.js").then(e=>e.p);return{PythonExportService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]),import.meta.url),l=e.validateTrialForExport(a);if(!l.valid)return void s.error(`Cannot export trial: ${l.errors.join(", ")}`);n("export-trial",a)}s.success("Trial created! Opening export options..."),n("created",e),n("close")}catch(e){console.error("Failed to create trial for export:",e),s.error("Failed to create trial for export")}finally{F.value=!1}}}async function Da(){if(D.value&&0!==L.value.length){F.value="draft";try{const e=await j.createTrial({name:O.value||he(),designId:D.value.id,configurations:L.value,repeatConfig:U.value>1?{callsPerPrompt:U.value,strategy:"sequential"}:void 0});s.success("Trial created as draft!"),n("created",e),n("close")}catch(e){console.error("Failed to create draft trial:",e),s.error("Failed to create draft trial")}finally{F.value=!1}}}let La=null;return P(async()=>{if(await Promise.all([w.initialize(),T.initialize(),j.initialize()]),r.initialDesignId){const e=w.designs.find(e=>e.id===r.initialDesignId);e&&ae(e)}La=setInterval(()=>{B.value++},1e3)}),S(()=>{La&&clearInterval(La),V.forEach(e=>clearInterval(e)),V.clear()}),(a,s)=>{const i=m("a-input"),o=m("a-button"),r=m("a-tag"),n=m("a-input-number"),d=m("a-modal");return v(),p(d,{open:!0,title:null,width:"90vw",style:{top:"5vh",maxWidth:"1200px"},bodyStyle:{padding:"0",height:"85vh",display:"flex",flexDirection:"column"},maskClosable:!1,onCancel:s[7]||(s[7]=e=>a.$emit("close"))},{footer:f(()=>[g("div",za,[k(o,{size:"large",onClick:Da,loading:"draft"===F.value,disabled:!D.value||0===L.value.length},{default:f(()=>s[33]||(s[33]=[I(" Create as Draft ")])),_:1,__:[33]},8,["loading","disabled"]),k(o,{size:"large",onClick:Ma,loading:"export"===F.value,disabled:!D.value||0===L.value.length},{default:f(()=>s[34]||(s[34]=[I(" Export to Python ")])),_:1,__:[34]},8,["loading","disabled"]),k(o,{type:"primary",size:"large",onClick:ke,loading:"start"===F.value,disabled:!D.value||0===L.value.length},{default:f(()=>[k(b(t)),s[35]||(s[35]=I(" Create and Start "))]),_:1,__:[35]},8,["loading","disabled"])])]),default:f(()=>[s[36]||(s[36]=g("div",{class:"streamlined-header"},[g("h2",null,"Create New Trial")],-1)),g("div",Ce,[g("section",we,[s[17]||(s[17]=g("h3",null,"What are you testing?",-1)),g("div",xe,[D.value?(v(),y("div",Be,[g("div",Ve,[g("div",Ke,[g("h4",null,x(D.value.name),1),k(o,{onClick:le},{default:f(()=>s[16]||(s[16]=[I("Change")])),_:1,__:[16]})]),g("pre",He,x(D.value.promptTemplate),1)])])):(v(),y("div",Te,[k(i,{value:M.value,"onUpdate:value":s[0]||(s[0]=e=>M.value=e),placeholder:"Search designs...",size:"large",class:"design-search",allowClear:""},{prefix:f(()=>[k(b(e))]),_:1},8,["value"]),0===Q.value.length?(v(),y("div",Ie,[g("div",Pe,[s[9]||(s[9]=g("p",null,"No designs found",-1)),k(o,{onClick:s[1]||(s[1]=()=>b(w).initialize())},{default:f(()=>s[8]||(s[8]=[I("Refresh Designs")])),_:1,__:[8]})])])):(v(),y("div",Se,[(v(!0),y(C,null,_(Q.value,e=>{return v(),y("div",{key:e.id,class:"design-item",onClick:a=>ae(e)},[g("div",Ee,[g("div",je,[g("h4",ze,[I(x(e.name)+" ",1),e.description?(v(),y("span",Me,"- "+x(e.description),1)):h("",!0)])]),g("span",De,x(oe(e.updated)),1)]),g("p",{class:"design-description",innerHTML:ne(e)},null,8,Le),g("div",Oe,[k(r,{size:"small",color:(a=e.outputType,{text:"blue",number:"green",boolean:"purple",json:"orange"}[a]||"default"),class:"output-type-tag"},{default:f(()=>[I(x(e.outputType||"text"),1)]),_:2},1032,["color"]),g("span",Ue,[g("span",Fe,x(se(e)),1),s[10]||(s[10]=g("span",{class:"stat-label"},"vars",-1))]),s[13]||(s[13]=g("span",{class:"stat-divider"},"•",-1)),g("span",Ne,[g("span",Ae,x(re(e)),1),s[11]||(s[11]=g("span",{class:"stat-label"},"combos",-1))]),s[14]||(s[14]=g("span",{class:"stat-divider"},"•",-1)),g("span",qe,[g("span",Re,x(e.tokenEstimate?.avgTokens||"?"),1),s[12]||(s[12]=g("span",{class:"stat-label"},"tokens",-1))])])],8,$e);var a}),128)),g("div",{class:"design-card design-card-create",onClick:te},[k(b(l),{style:{"font-size":"24px"}}),s[15]||(s[15]=g("span",null,"Create New Design",-1))])]))]))])]),D.value?(v(),y("section",Je,[g("h3",null,[s[18]||(s[18]=I("How does it vary? ")),g("span",Ye,x(X.value)+" combinations from variables:",1)]),g("div",We,[g("div",Ge,[(v(!0),y(C,null,_(D.value.variableBindings,(e,a)=>(v(),y("div",{key:a,class:"variable-row"},[g("span",Qe,x(a)+":",1),g("span",Xe,x(ce(e).join(", ")),1)]))),128)),g("div",Ze,[s[19]||(s[19]=I(" = ")),g("strong",null,x(X.value),1),s[20]||(s[20]=I(" unique combinations "))])])])])):h("",!0),D.value?(v(),y("section",ea,[s[32]||(s[32]=g("h3",null,"Trial Configuration",-1)),g("div",aa,[g("div",la,[g("div",ta,[g("div",sa,[g("div",ia,[s[21]||(s[21]=g("label",{class:"inline-label"},"Trial Name:",-1)),k(i,{value:O.value,"onUpdate:value":s[2]||(s[2]=e=>O.value=e),placeholder:"Enter trial name (optional)",class:"trial-name-input"},null,8,["value"])]),g("div",oa,[s[22]||(s[22]=g("label",{class:"inline-label"},"Repeat:",-1)),k(n,{value:U.value,"onUpdate:value":s[3]||(s[3]=e=>U.value=e),min:1,max:10,size:"large",class:"repeat-count-input"},null,8,["value"]),s[23]||(s[23]=g("span",{class:"repeat-suffix"},"times per prompt",-1))])])]),g("div",ra,[k(o,{onClick:s[4]||(s[4]=e=>q.value=!0),type:"primary",size:"large",class:"big-add-model-btn"},{default:f(()=>[k(b(l)),s[24]||(s[24]=I(" Add Model "))]),_:1,__:[24]}),s[26]||(s[26]=g("div",{class:"separator-bar"},null,-1)),g("div",na,[s[25]||(s[25]=g("div",{class:"quick-add-label"},"Quick add recent/popular models (with default temperature=0, max response length = 128):",-1)),g("div",da,[(v(!0),y(C,null,_(G.value,e=>(v(),p(o,{key:`${e.provider}:${e.modelId}:${JSON.stringify(e.parameters)}`,onClick:a=>function(e){ue(e)||(L.value.push({name:e.displayName,provider:e.provider,modelId:e.modelId,parameters:e.parameters}),E(()=>{const e=document.querySelector(".ant-modal-body");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})}))}(e),size:"small",class:"quick-preset-btn",disabled:ue(e)},{default:f(()=>[I(x(e.displayName)+" ",1),g("span",ca,x(b(W)(pe(e))),1)]),_:2},1032,["onClick","disabled"]))),128))])])]),g("div",ua,[s[31]||(s[31]=g("div",{class:"table-header"},[g("div",{class:"col-model"},"Model"),g("div",{class:"col-params"},"Parameters"),g("div",{class:"col-calls"},"API Calls"),g("div",{class:"col-cost"},"Cost per Call"),g("div",{class:"col-total"},"Total Cost"),g("div",{class:"col-actions"},"Actions")],-1)),(v(!0),y(C,null,_(L.value,(e,a)=>(v(),y("div",{key:a,class:"table-row"},[g("div",pa,[g("div",va,x(e.provider)+":"+x(e.modelId),1),g("div",ma,x(e.provider),1)]),g("div",fa,[g("span",ga,x(ve(e.parameters)),1)]),g("div",ya,[g("span",ha,x(X.value)+" × "+x(U.value)+" = ",1),g("span",ka,x(X.value*U.value),1)]),g("div",ba,[g("span",_a,x(b(W)(ge(e))),1)]),g("div",Ca,[g("span",wa,x(b(W)(ye(e))),1)]),g("div",xa,[k(o,{type:"text",size:"small",danger:"",onClick:e=>function(e){L.value.splice(e,1)}(a),class:"remove-btn"},{default:f(()=>s[27]||(s[27]=[I("Remove")])),_:2,__:[27]},1032,["onClick"])])]))),128)),L.value.length>1?(v(),y("div",Ta,[g("div",Ia,[g("div",Pa,"TOTAL ("+x(L.value.length)+" models)",1)]),s[28]||(s[28]=g("div",{class:"col-params"},null,-1)),g("div",Sa,[g("span",$a,x(Z.value),1)]),s[29]||(s[29]=g("div",{class:"col-cost"},null,-1)),g("div",Ea,[g("span",ja,x(b(W)(ee.value)),1)]),s[30]||(s[30]=g("div",{class:"col-actions"},null,-1))])):h("",!0)])])])])):h("",!0)]),q.value&&D.value?(v(),p(be,{key:0,design:D.value,"existing-configurations":L.value,onClose:s[5]||(s[5]=e=>q.value=!1),onAddConfiguration:me},null,8,["design","existing-configurations"])):h("",!0),null!==R.value&&D.value?(v(),p(_e,{key:1,configuration:L.value[R.value],design:D.value,onClose:s[6]||(s[6]=e=>R.value=null),onSave:fe},null,8,["configuration","design"])):h("",!0)]),_:1,__:[36]})}}}),[["__scopeId","data-v-85cd6c0c"]]),Da={class:"execution-monitor"},La={class:"monitor-header"},Oa={class:"header-left"},Ua={key:0,class:"progress-summary"},Fa={class:"progress-bar"},Na={class:"progress-text"},Aa={key:0,class:"network-errors"},qa={key:0,class:"header-stats"},Ra={class:"stat"},Ba={class:"stat pending"},Va={class:"stat running"},Ka={class:"stat completed"},Ha={class:"stat failed"},Ja={key:0,class:"monitor-filters"},Ya={class:"monitor-content"},Wa={key:0,class:"empty-state"},Ga={key:1,class:"empty-state"},Qa={class:"placeholder-content"},Xa={key:2,class:"results-table"},Za={class:"table-body"},el=["onClick"],al={class:"col-status"},ll={class:"col-config"},tl={class:"config-info"},sl={class:"model-name"},il={class:"provider-name"},ol={class:"col-repeat"},rl={key:0,class:"repeat-info"},nl={key:1,class:"repeat-placeholder"},dl={class:"col-variables"},cl={class:"variables-list"},ul={class:"var-key"},pl={class:"var-value"},vl={key:0,class:"separator"},ml={class:"col-response"},fl={key:0,class:"response-placeholder"},gl={key:1,class:"response-placeholder"},yl={key:2,class:"response-error"},hl={key:3,class:"response-content"},kl={key:4,class:"response-placeholder"},bl={class:"col-time"},_l={key:0,class:"time-info"},Cl={class:"duration"},wl={key:0,class:"latency"},xl={key:1,class:"time-placeholder"},Tl=a(n({__name:"ExecutionMonitor",props:{trialId:{}},setup(e){const a=e,l=d(null),t=d([]),s=d("all"),i=d(""),r=d(null),n=d(100),c=d(null),k=d(!1);let b=null,T=null;const $=u(()=>{const e={total:0,pending:0,running:0,completed:0,failed:0};return t.value.forEach(a=>{e.total++,"completed"===a.status?e.completed++:"failed"===a.status?(e.failed++,e.completed++):e[a.status]++}),e}),E=u(()=>l.value&&0!==l.value.progress.total?l.value.progress.completed/l.value.progress.total*100:0),U=u(()=>{let e=t.value;if("all"!==s.value&&(e=e.filter(e=>e.status===s.value)),i.value.trim()){const a=i.value.toLowerCase();e=e.filter(e=>Object.values(e.variables).some(e=>e.toLowerCase().includes(a))||e.result?.content&&String(e.result.content).toLowerCase().includes(a)||e.result?.error&&e.result.error.toLowerCase().includes(a))}return e.sort((e,a)=>a.created.getTime()-e.created.getTime())}),F=u(()=>U.value.slice(0,n.value));function N(e){if(!l.value||!l.value.configurationSnapshots[e])return"Unknown Model";return l.value.configurationSnapshots[e].modelId||"Unknown Model"}function A(e){if(!l.value||!l.value.configurationSnapshots[e])return"Unknown Provider";return l.value.configurationSnapshots[e].provider||"Unknown Provider"}function R(e,a){return e.length<=a?e:e.slice(0,a)+"..."}let B=null;function V(){B&&B.disconnect(),B=new IntersectionObserver(e=>{const[a]=e;a.isIntersecting&&!k.value&&U.value.length>n.value&&(k.value||(k.value=!0,setTimeout(()=>{const e=Math.min(50,Math.max(10,Math.floor(.1*U.value.length)));n.value+=e,k.value=!1},100)))},{rootMargin:"100px",threshold:.1}),c.value&&B.observe(c.value)}function K(){b&&b.unsubscribe(),T&&T.unsubscribe(),b=G(()=>o.trials.get(a.trialId)).subscribe({next:e=>{l.value=e||null},error:e=>{console.error("Trial subscription error:",e)}}),T=G(()=>o.apiCalls.where("trialId").equals(a.trialId).toArray()).subscribe({next:e=>{t.value=e},error:e=>{console.error("API calls subscription error:",e)}})}return j(()=>a.trialId,e=>{e&&K()},{immediate:!0}),j([s,i],()=>{n.value=100,k.value=!1,setTimeout(V,100)}),j(c,e=>{e&&setTimeout(V,100)}),P(()=>{K(),setTimeout(V,100)}),S(()=>{B&&(B.disconnect(),B=null),b&&b.unsubscribe(),T&&T.unsubscribe()}),(e,a)=>{const t=m("a-tag");return v(),y("div",Da,[g("div",La,[g("div",Oa,[g("h3",null,[I(x(l.value?.name||"Select a trial to monitor")+" ",1),l.value?.repeatConfig?.callsPerPrompt&&l.value.repeatConfig.callsPerPrompt>1?(v(),p(t,{key:0,size:"small",color:"purple",style:{"margin-left":"8px"}},{default:f(()=>[I(x(l.value.repeatConfig.callsPerPrompt)+"× repeat ",1)]),_:1})):h("",!0)]),l.value?(v(),y("div",Ua,[g("div",Fa,[g("div",{class:"progress-fill",style:z({width:E.value+"%"})},null,4)]),g("span",Na,[I(x(l.value.progress.completed)+" / "+x(l.value.progress.total)+" completed ",1),l.value.progress.networkErrors>0?(v(),y("span",Aa,"("+x(l.value.progress.networkErrors)+" network errors)",1)):h("",!0)])])):h("",!0)]),l.value?(v(),y("div",qa,[g("span",Ra,x($.value.total)+" total",1),g("span",Ba,x($.value.pending)+" pending",1),g("span",Va,x($.value.running)+" running",1),g("span",Ka,x($.value.completed)+" completed",1),g("span",Ha,x($.value.failed)+" failed",1)])):h("",!0)]),l.value?(v(),y("div",Ja,[M(g("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),class:"filter-select"},a[3]||(a[3]=[L('<option value="all" data-v-42a18f20>All Statuses</option><option value="pending" data-v-42a18f20>Pending</option><option value="running" data-v-42a18f20>Running</option><option value="completed" data-v-42a18f20>Completed</option><option value="failed" data-v-42a18f20>Failed</option>',5)]),512),[[D,s.value]]),M(g("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),type:"text",placeholder:"Search variables or response...",class:"search-input"},null,512),[[O,i.value]])])):h("",!0),g("div",Ya,[l.value?0===U.value.length?(v(),y("div",Ga,[g("div",Qa,[a[5]||(a[5]=g("h4",null,"No API Calls",-1)),g("p",null,x(0===$.value.total?"Start the trial to see API calls here.":"No API calls match the current filters."),1)])])):(v(),y("div",Xa,[a[7]||(a[7]=L('<div class="table-header" data-v-42a18f20><div class="col-status" data-v-42a18f20>Status</div><div class="col-config" data-v-42a18f20>Config</div><div class="col-repeat" data-v-42a18f20>Repeat</div><div class="col-variables" data-v-42a18f20>Variables</div><div class="col-response" data-v-42a18f20>Response</div><div class="col-time" data-v-42a18f20>Time</div></div>',1)),g("div",Za,[(v(!0),y(C,null,_(F.value,e=>{return v(),y("div",{key:e.id,class:w(["table-row",[e.status]]),onClick:a=>function(e){r.value=e}(e)},[g("div",al,[g("span",{class:w(["status-badge",e.status])},x(e.status),3)]),g("div",ll,[g("div",tl,[g("div",sl,x(N(e.configurationIndex)),1),g("div",il,x(A(e.configurationIndex)),1)])]),g("div",ol,[void 0!==e.repeatIndex?(v(),y("span",rl,x(e.repeatIndex+1)+"/"+x(l.value?.repeatConfig?.callsPerPrompt||1),1)):(v(),y("span",nl,"—"))]),g("div",dl,[g("div",cl,[(v(!0),y(C,null,_(Object.entries(e.variables),([a,l],t)=>(v(),y("span",{key:a,class:"variable-pair"},[g("span",ul,x(a)+":",1),g("span",pl,x(R(l,30)),1),t<Object.entries(e.variables).length-1?(v(),y("span",vl,"•")):h("",!0)]))),128))])]),g("div",ml,["pending"===e.status?(v(),y("div",fl," Waiting... ")):"running"===e.status?(v(),y("div",gl," Processing... ")):"failed"===e.status?(v(),y("div",yl,x(e.result?.error||"API call failed"),1)):e.result?.content?(v(),y("div",hl,x(R(String(e.result.content),100)),1)):(v(),y("div",kl," No content "))]),g("div",bl,[e.completed?(v(),y("div",_l,[g("div",Cl,x((a=e.completed.getTime()-e.created.getTime(),a<1e3?`${a}ms`:`${(a/1e3).toFixed(1)}s`)),1),e.response?(v(),y("div",wl,x(e.response.latencyMs)+"ms",1)):h("",!0)])):(v(),y("div",xl,"—"))])],10,el);var a}),128))]),U.value.length>n.value?(v(),y("div",{key:0,ref_key:"scrollSentinel",ref:c,class:"scroll-sentinel"},a[6]||(a[6]=[g("div",{class:"loading-indicator"},[g("div",{class:"spinner"}),g("span",null,"Loading more results...")],-1)]),512)):h("",!0)])):(v(),y("div",Wa,a[4]||(a[4]=[g("div",{class:"placeholder-content"},[g("h4",null,"No Trial Selected"),g("p",null,"Click on a trial card to monitor its execution progress and view results.")],-1)])))]),r.value?(v(),p(q,{key:1,"api-call":r.value,trial:l.value,onClose:a[2]||(a[2]=e=>r.value=null)},null,8,["api-call","trial"])):h("",!0)])}}}),[["__scopeId","data-v-42a18f20"]]),Il={class:"trials-table-container full-width scientific-table-wrapper"},Pl={key:0,class:"trial-name-cell"},Sl={class:"trial-header"},$l={class:"trial-name"},El={class:"trial-design"},jl={class:"text-secondary"},zl={key:1,class:"progress-cell"},Ml={class:"progress-text text-xs"},Dl={key:0,class:"network-errors"},Ll={key:4,class:"api-calls-cell"},Ol={class:"total-calls"},Ul={class:"calls-calculation text-secondary"},Fl={key:0},Nl={key:1,class:"text-secondary"},Al={class:"date-cell"},ql={class:"date-value"},Rl={class:"time-value text-secondary"},Bl={key:7,class:"trial-actions-4"},Vl=a(n({__name:"TrialsTable",props:{trials:{},isLoading:{type:Boolean,default:!1}},emits:["trial-selected","trial-started","trial-paused","trial-resumed","trial-cancelled","trial-exported","trial-duplicated","trial-deleted","trial-viewed","trial-export-data","trial-export-python","trial-edited","trial-retried","status-filter-changed"],setup(e,{emit:a}){const l=e,t=a,s=d("all"),i=[{key:"all",label:"All"},{key:"draft",label:"Draft"},{key:"pending",label:"Pending"},{key:"running",label:"Running"},{key:"paused",label:"Paused"},{key:"completed",label:"Completed"},{key:"failed",label:"Failed"},{key:"cancelled",label:"Cancelled"}],{createTrialColumns:o,getVisibleColumns:n}=Q(),c=n(o()),P=u(()=>"all"===s.value?l.trials:l.trials.filter(e=>e.status===s.value));function S(e){s.value=e,t("status-filter-changed",e)}function $(e){return{onClick:a=>{const l=a.target;l.closest(".ant-btn")||l.closest(".ant-dropdown-trigger")||(e.name,e.id,t("trial-selected",e))}}}function E(e){return"all"===e?l.trials.length:l.trials.filter(a=>a.status===e).length}function j(e){return"failed"===e.status?"exception":"completed"===e.status?"success":e.progress.networkErrors>0?"exception":"normal"}function z(e){const a=[];return"running"===e.status&&a.push("status-running"),"failed"===e.status&&a.push("status-failed"),"completed"===e.status&&a.push("status-completed"),a.join(" ")}function M(e){const a=(new Date).getTime()-e.getTime(),l=Math.floor(a/864e5);return 0===l?"Today":1===l?"Yesterday":l<7?`${l} days ago`:l<30?`${Math.floor(l/7)} weeks ago`:e.toLocaleDateString()}function D(e){const a=Math.abs(e);if(0===a)return"";if(a<.01){const e=a.toFixed(10).match(/0\.0*([1-9])/);if(e){const l=e[0].length-1;return`$${a.toFixed(Math.max(2,l))}`}}return`$${a.toFixed(2)}`}function L(e){t("trial-viewed",e)}function O(e){t("trial-duplicated",e)}return(e,a)=>{const l=m("a-tab-pane"),o=m("a-tabs"),n=m("a-tag"),d=m("a-progress"),u=m("a-tooltip"),U=m("a-button"),F=m("a-menu-item"),N=m("a-menu"),A=m("a-dropdown"),q=m("a-table");return v(),y("div",Il,[k(o,{activeKey:s.value,"onUpdate:activeKey":a[0]||(a[0]=e=>s.value=e),size:"small",class:"status-tabs",onChange:S},{default:f(()=>[(v(),y(C,null,_(i,e=>k(l,{key:e.key,tab:`${e.label} (${E(e.key)})`},null,8,["tab"])),64))]),_:1},8,["activeKey"]),k(q,{columns:b(c),"data-source":P.value,pagination:!1,size:"small",scroll:{y:"calc(100vh - 200px)"},"row-key":"id","row-class-name":z,class:"scientific-table clickable-rows","custom-row":$},{bodyCell:f(({column:e,record:l})=>{return["name"===e.key?(v(),y("div",Pl,[g("div",Sl,[g("strong",$l,x(l.name),1),k(n,{color:(i=l.status,{draft:"default",pending:"processing",running:"processing",paused:"warning",completed:"success",failed:"error",cancelled:"default"}[i]||"default"),size:"small",class:"trial-status-tag"},{default:f(()=>[I(x(l.status.toUpperCase()),1)]),_:2},1032,["color"])]),g("div",El,[g("small",jl," Design: "+x(l.designSnapshot?.originalName||"Unknown Design"),1)]),a[2]||(a[2]=g("div",{class:"click-hint"},[g("small",{class:"text-secondary"},"Click to view live progress")],-1))])):h("",!0),"progress"===e.key?(v(),y("div",zl,[k(d,{percent:(s=l,0===s.progress.total?0:Math.round(s.progress.completed/s.progress.total*100)),size:"small",status:j(l),"show-info":!1,class:"progress-bar"},null,8,["percent","status"]),g("div",Ml,[I(x(l.progress.completed)+" / "+x(l.progress.total)+" ",1),l.progress.networkErrors>0?(v(),y("span",Dl," ("+x(l.progress.networkErrors)+" errors) ",1)):h("",!0)])])):h("",!0),"configurations"===e.key?(v(),y(C,{key:2},[k(u,{title:`${l.configurationSnapshots?.length||0} model configurations`},{default:f(()=>[k(n,{size:"small",color:"blue"},{default:f(()=>[I(x(l.configurationSnapshots?.length||0)+" configs ",1)]),_:2},1024)]),_:2},1032,["title"]),l.repeatConfig?.callsPerPrompt&&l.repeatConfig.callsPerPrompt>1?(v(),p(n,{key:0,size:"small",color:"purple",style:{"margin-left":"4px"}},{default:f(()=>[I(x(l.repeatConfig.callsPerPrompt)+"× repeat ",1)]),_:2},1024)):h("",!0)],64)):h("",!0),"variables"===e.key?(v(),p(u,{key:3,title:`${l.totalCombinations} variable combinations`},{default:f(()=>[k(n,{size:"small",color:"green"},{default:f(()=>[I(x(l.totalCombinations)+" combos ",1)]),_:2},1024)]),_:2},1032,["title"])):h("",!0),"api_calls"===e.key?(v(),y("div",Ll,[g("span",Ol,x(l.progress.total),1),g("small",Ul,[I(x(l.configurationSnapshots?.length||0)+" × "+x(l.totalCombinations),1),l.repeatConfig?.callsPerPrompt&&l.repeatConfig.callsPerPrompt>1?(v(),y("span",Fl," × "+x(l.repeatConfig.callsPerPrompt),1)):h("",!0)])])):h("",!0),"cost"===e.key?(v(),y("span",{key:5,class:w(["cost-cell",{negative:l.estimatedCost<0}])},[D(l.estimatedCost)?(v(),y(C,{key:0},[I(x(D(l.estimatedCost)),1)],64)):(v(),y("span",Nl,"-"))],2)):h("",!0),"created"===e.key?(v(),p(u,{key:6,title:l.created.toLocaleString()},{default:f(()=>{return[g("div",Al,[g("span",ql,x(M(l.created)),1),g("small",Rl,x((e=l.created,e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))),1)])];var e}),_:2},1032,["title"])):h("",!0),"actions"===e.key?(v(),y("div",Bl,["draft"===l.status||"pending"===l.status?(v(),p(U,{key:0,size:"small",type:"primary",onClick:T(e=>function(e){t("trial-started",e)}(l),["stop"])},{default:f(()=>a[3]||(a[3]=[I(" Start ")])),_:2,__:[3]},1032,["onClick"])):"running"===l.status?(v(),p(U,{key:1,size:"small",type:"primary",onClick:T(e=>L(l),["stop"])},{default:f(()=>a[4]||(a[4]=[I(" View Live ")])),_:2,__:[4]},1032,["onClick"])):"completed"===l.status?(v(),p(U,{key:2,size:"small",type:"primary",onClick:T(e=>L(l),["stop"])},{default:f(()=>a[5]||(a[5]=[I(" Results ")])),_:2,__:[5]},1032,["onClick"])):"failed"===l.status?(v(),p(U,{key:3,size:"small",type:"primary",onClick:T(e=>L(l),["stop"])},{default:f(()=>a[6]||(a[6]=[I(" Details ")])),_:2,__:[6]},1032,["onClick"])):"paused"===l.status?(v(),p(U,{key:4,size:"small",type:"primary",onClick:T(e=>function(e){t("trial-resumed",e)}(l),["stop"])},{default:f(()=>a[7]||(a[7]=[I(" Resume ")])),_:2,__:[7]},1032,["onClick"])):h("",!0),"draft"===l.status?(v(),p(U,{key:5,size:"small",onClick:T(e=>function(e){t("trial-edited",e)}(l),["stop"])},{default:f(()=>a[8]||(a[8]=[I(" Edit ")])),_:2,__:[8]},1032,["onClick"])):"running"===l.status?(v(),p(U,{key:6,size:"small",class:"btn-warning",onClick:T(e=>function(e){t("trial-paused",e)}(l),["stop"])},{default:f(()=>a[9]||(a[9]=[I(" Pause ")])),_:2,__:[9]},1032,["onClick"])):"completed"===l.status?(v(),p(U,{key:7,size:"small",onClick:T(e=>O(l),["stop"])},{default:f(()=>a[10]||(a[10]=[I(" Duplicate ")])),_:2,__:[10]},1032,["onClick"])):"failed"===l.status?(v(),p(U,{key:8,size:"small",class:"btn-warning",onClick:T(e=>function(e){t("trial-retried",e)}(l),["stop"])},{default:f(()=>a[11]||(a[11]=[I(" Retry ")])),_:2,__:[11]},1032,["onClick"])):"paused"===l.status?(v(),p(U,{key:9,size:"small",onClick:T(e=>L(l),["stop"])},{default:f(()=>a[12]||(a[12]=[I(" Progress ")])),_:2,__:[12]},1032,["onClick"])):(v(),p(U,{key:10,size:"small",onClick:T(e=>O(l),["stop"])},{default:f(()=>a[13]||(a[13]=[I(" Duplicate ")])),_:2,__:[13]},1032,["onClick"])),k(A,{trigger:"click"},{overlay:f(()=>[k(N,null,{default:f(()=>[k(F,{onClick:e=>function(e){t("trial-export-data",e)}(l)},{default:f(()=>a[15]||(a[15]=[I(" Export Data ")])),_:2,__:[15]},1032,["onClick"]),k(F,{onClick:e=>function(e){t("trial-export-python",e)}(l)},{default:f(()=>a[16]||(a[16]=[I(" Export Python ")])),_:2,__:[16]},1032,["onClick"])]),_:2},1024)]),default:f(()=>[k(U,{size:"small",class:"btn-success",onClick:a[1]||(a[1]=T(()=>{},["stop"]))},{default:f(()=>[a[14]||(a[14]=I(" Export ")),k(b(r))]),_:1,__:[14]})]),_:2},1024),"running"===l.status?(v(),p(U,{key:11,size:"small",danger:"",onClick:T(e=>function(e){t("trial-cancelled",e)}(l),["stop"])},{default:f(()=>a[17]||(a[17]=[I(" Cancel ")])),_:2,__:[17]},1032,["onClick"])):(v(),p(U,{key:12,size:"small",danger:"",onClick:T(e=>function(e){t("trial-deleted",e)}(l),["stop"])},{default:f(()=>a[18]||(a[18]=[I(" Delete ")])),_:2,__:[18]},1032,["onClick"]))])):h("",!0)];var s,i}),_:1},8,["columns","data-source"])])}}}),[["__scopeId","data-v-6411c7ea"]]),Kl={class:"trials-view full-width"},Hl={class:"page-header"},Jl={class:"header-actions"},Yl={class:"main-content"},Wl={key:0,class:"loading-state"},Gl={key:1,class:"empty-state"},Ql={key:2,class:"trials-table-wrapper"},Xl={key:0,class:"monitoring-content"},Zl={key:1,class:"monitoring-placeholder"},et=a(n({__name:"TrialsView",setup(e){const a=N(),l=A(),t=U(),s=$(),o=d(!1),r=d(!0),n=d(null),c=d(null),_=d(!1),C=d(!1),w=d(null),x=d(null),T=d(),S=u(()=>a.isLoading),E=u(()=>[...a.trials]),j=u(()=>l.hasAnyApiKeys||l.isProviderEnabled("ollama-chat")||l.isProviderEnabled("ollama-generate"));function z(e){e.name,e.id,c.value=e,_.value=!0}function M(e){}function D(e){"running"===e.status||"pending"===e.status?z(e):"completed"===e.status?s.push({name:"results",query:{trialId:e.id}}):n.value=e}function L(){r.value=!0,o.value=!0}async function O(e){try{await a.executeTrial(e.id),e.id,z(e)}catch(l){console.error("Failed to start trial:",l),alert("Failed to start trial: "+(l instanceof Error?l.message:"Unknown error"))}}async function q(e){try{await a.pauseTrial(e.id),e.id}catch(l){console.error("Failed to pause trial:",l),alert("Failed to pause trial")}}async function K(e){try{await a.executeTrial(e.id),e.id}catch(l){console.error("Failed to resume trial:",l),alert("Failed to resume trial")}}async function H(e){try{await a.cancelTrial(e.id),e.id}catch(l){console.error("Failed to cancel trial:",l),alert("Failed to cancel trial")}}async function J(e){await W(e)}async function Y(e){alert("Data export functionality coming soon")}async function W(e){try{const{PythonExportService:a}=await i(async()=>{const{PythonExportService:e}=await import("./APICallDetailModal-DwjcouZb.js").then(e=>e.p);return{PythonExportService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]),import.meta.url),l=a.validateTrialForExport(e);if(!l.valid)return void alert(`Cannot export trial:\n${l.errors.join("\n")}`);w.value=e,C.value=!0}catch(a){console.error("Python export failed:",a),alert(`Export failed: ${a instanceof Error?a.message:String(a)}`)}}function G(e){}function Q(e){x.value=e,o.value=!0}async function X(e){if(confirm(`Are you sure you want to delete "${e.name}"? This action cannot be undone.`))try{await a.deleteTrial(e.id)}catch(l){console.error("Failed to delete trial:",l),alert("Failed to delete trial")}}function Z(e){}async function ee(e){await new Promise(e=>setTimeout(e,100));let a=E.value.find(a=>a.id===e),l=0;for(;!a&&l<5;)await new Promise(e=>setTimeout(e,200)),a=E.value.find(a=>a.id===e),l++;a?(c.value=a,_.value=!0):console.warn("Could not find trial for monitoring:",e)}function ae(e){e.id,w.value=e,C.value=!0}function le(){}return P(async()=>{await a.initialize();const e=t.query.designId;e&&(T.value=e,o.value=!0)}),(e,a)=>{const l=m("a-button"),t=m("a-alert"),s=m("a-spin"),i=m("a-empty"),d=m("a-modal");return v(),y("div",Kl,[g("div",Hl,[a[7]||(a[7]=g("div",{class:"header-content"},[g("h1",null,"Trials"),g("p",{class:"description"}," Systematic testing of LLM models with complete reproducibility ")],-1)),g("div",Jl,[k(l,{type:"primary",size:"default",disabled:!j.value,onClick:L},{default:f(()=>a[6]||(a[6]=[I(" Create Trial ")])),_:1,__:[6]},8,["disabled"])])]),j.value?h("",!0):(v(),p(t,{key:0,type:"warning",message:"No LLM providers configured",description:"Add keys for external APIs (local Ollama does not need keys) or enable Ollama provider.","show-icon":"",class:"warning-banner",action:""},{action:f(()=>[k(b(F),{to:"/settings"},{default:f(()=>[k(l,{size:"small",type:"primary"},{default:f(()=>a[8]||(a[8]=[I(" Go to Settings ")])),_:1,__:[8]})]),_:1})]),_:1})),g("div",Yl,[S.value?(v(),y("div",Wl,[k(s,{size:"large"},{tip:f(()=>a[9]||(a[9]=[I("Loading trials...")])),_:1})])):0===E.value.length?(v(),y("div",Gl,[k(i,{description:j.value?"No trials yet":"Configure LLM providers to start creating trials"},{image:f(()=>a[10]||(a[10]=[g("div",{style:{color:"#bfbfbf","font-size":"48px"}},"🧪",-1)])),default:f(()=>[j.value?(v(),p(l,{key:0,type:"primary",onClick:a[0]||(a[0]=e=>o.value=!0)},{default:f(()=>a[11]||(a[11]=[I(" Create Your First Trial ")])),_:1,__:[11]})):h("",!0)]),_:1},8,["description"])])):(v(),y("div",Ql,[k(Vl,{trials:E.value,"is-loading":S.value,onTrialSelected:z,onTrialStarted:O,onTrialPaused:q,onTrialResumed:K,onTrialCancelled:H,onTrialExported:J,onTrialDuplicated:Q,onTrialDeleted:X,onTrialViewed:D,onTrialExportData:Y,onTrialExportPython:W,onStatusFilterChanged:M},null,8,["trials","is-loading"])]))]),k(d,{open:_.value,"onUpdate:open":a[1]||(a[1]=e=>_.value=e),title:`Live Progress: ${c.value?.name||"Trial"}`,width:"95vw",footer:null,"body-style":{padding:0,height:"90vh",overflow:"auto"},"destroy-on-close":!0,centered:!0},{default:f(()=>[c.value?(v(),y("div",Xl,[k(Tl,{"trial-id":c.value.id},null,8,["trial-id"])])):(v(),y("div",Zl,[k(i,{description:"No trial selected for monitoring"})]))]),_:1},8,["open","title"]),o.value&&!r.value?(v(),p(R,{key:1,trialToDuplicate:x.value,initialDesignId:T.value,onClose:a[2]||(a[2]=e=>{o.value=!1,x.value=null,T.value=void 0}),onCreated:Z},null,8,["trialToDuplicate","initialDesignId"])):h("",!0),o.value&&r.value?(v(),p(Ma,{key:2,initialDesignId:T.value,onClose:a[3]||(a[3]=e=>{o.value=!1,T.value=void 0}),onCreated:Z,onCreatedAndStarted:ee,onExportTrial:ae},null,8,["initialDesignId"])):h("",!0),n.value?(v(),p(B,{key:3,trial:n.value,onClose:a[4]||(a[4]=e=>n.value=null),onUpdated:le},null,8,["trial"])):h("",!0),C.value&&w.value?(v(),p(V,{key:4,trial:w.value,onClose:a[5]||(a[5]=e=>{C.value=!1,w.value=null}),onExported:G},null,8,["trial"])):h("",!0)])}}}),[["__scopeId","data-v-50ea9576"]]);export{et as default};
