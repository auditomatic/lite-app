import{a as f,l as V,d as w}from"./index-CMsjb5lT.js";import{u as B}from"./useV4LiveQuery-CU4Hu5jZ.js";import{b as I,c as r}from"./vue-vendor-DPw1dQYc.js";const E="v4-data-updates";let b=null;function v(){return b||(b=new BroadcastChannel(E)),b}function x(a,o){try{const s=v(),i={type:"data-changed",table:a,operation:o,timestamp:Date.now()};s.postMessage(i)}catch(s){f.warn("V4 Cross-tab broadcast failed:",s)}}function P(a){const o=v(),s=i=>{i.data,a(i.data)};return o.addEventListener("message",s),I(()=>{o.removeEventListener("message",s)}),{channel:o,cleanup:()=>o.removeEventListener("message",s)}}function A(){const{data:a,loading:o,error:s}=B(()=>V(()=>w.variableLists.orderBy("updated").reverse().toArray()),e=>Object.freeze(e.map(t=>Object.freeze(t))),{initialValue:[]});P(e=>{e.table==="variableLists"&&e.operation});const i=r(()=>a.value),y=r(()=>Object.freeze(a.value.filter(e=>e.category==="simple"))),L=r(()=>Object.freeze(a.value.filter(e=>e.category==="attributed"))),p=r(()=>Object.freeze(a.value.filter(e=>e.category==="refusal"))),C=r(()=>Object.freeze(a.value.filter(e=>e.category==="tabular")));function h(e){return r(()=>{const t=a.value.find(n=>n.id===e);return t?Object.freeze(t):null})}function j(e){return r(()=>Object.freeze(a.value.filter(t=>t.category===e)))}function z(e){return r(()=>{if(!e.trim())return a.value;const t=e.toLowerCase(),n=a.value.filter(c=>c.name.toLowerCase().includes(t)||c.description?.toLowerCase().includes(t)||c.category.toLowerCase().includes(t));return Object.freeze(n)})}const O=r(()=>{const e=a.value,t=e.length;if(t===0)return Object.freeze({total:0,byCategory:{simple:0,attributed:0,refusal:0,tabular:0},totalItems:0,avgItemsPerList:0,mostPopularCategory:null});const n=e.reduce((l,u)=>(l[u.category]=(l[u.category]||0)+1,l),{}),c={simple:n.simple||0,attributed:n.attributed||0,refusal:n.refusal||0,tabular:n.tabular||0},d=e.reduce((l,u)=>l+(u.itemCount||0),0);let m=null,g=0;for(const[l,u]of Object.entries(c))u>g&&(g=u,m=l);return Object.freeze({total:t,byCategory:Object.freeze(c),totalItems:d,avgItemsPerList:t>0?Math.round(d/t):0,mostPopularCategory:m})});return{variableLists:i,simpleLists:y,attributedLists:L,refusalLists:p,tabularLists:C,loading:r(()=>o.value),error:r(()=>s.value),getListById:h,getListsByCategory:j,searchLists:z,stats:O}}export{A as a,x as b,P as u};
