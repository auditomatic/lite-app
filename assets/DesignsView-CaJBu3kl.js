var e=Object.defineProperty,t=(t,a,s)=>((t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s)(t,"symbol"!=typeof a?a+"":a,s);import{d as a,r as s,i as n,b as l,g as r,e as i,w as o,f as u,p as c,t as d,m as p,U as m,V as v,F as g,D as f,n as b,B as y,o as h,I as _,O as k,W as w,u as x,k as $}from"./vendor-CcR2-GEf.js";import{D as C,_ as S,u as V,a as D}from"./index-BFa6Iu16.js";import{u as I}from"./variableLists-05iWdhAz.js";import{c as j}from"./llm-AfDKCXOd.js";import{s as A}from"./safeJson-BfKuju6h.js";import"./db-ftwlfnxb.js";import"./apiLogger-wE3EW76_.js";const L=class e{constructor(){t(this,"schemas",new Map)}static getInstance(){return e.instance||(e.instance=new e,e.instance.initializeSchemas()),e.instance}initializeSchemas(){this.registerSchema("design",{required:["name","prompt_template"],rules:[{field:"name",type:"string",min:1,max:200,message:"Name must be 1-200 characters"},{field:"prompt_template",type:"string",min:1,message:"Prompt template is required"},{field:"description",type:"string",max:1e3,message:"Description must be under 1000 characters"},{field:"variable_list_refs",type:"array",message:"Variable list refs must be an array"},{field:"compound_variables",type:"array",message:"Compound variables must be an array"},{field:"tags",type:"array",message:"Tags must be an array"},{field:"prompt_template",type:"custom",customValidator:e=>this.validatePromptTemplate(e),message:"Prompt template contains invalid variable syntax"}]}),this.registerSchema("run",{required:["design_id","name","models"],rules:[{field:"design_id",type:"string",min:1,message:"Design ID is required"},{field:"name",type:"string",min:1,max:200,message:"Name must be 1-200 characters"},{field:"models",type:"array",min:1,message:"At least one model is required"},{field:"status",type:"string",message:"Status must be a string"},{field:"status",type:"custom",customValidator:e=>["pending","running","completed","failed","cancelled"].includes(e),message:"Status must be one of: pending, running, completed, failed, cancelled"},{field:"models",type:"custom",customValidator:this.validateModelArray.bind(this),message:"Models array contains invalid entries"}]}),this.registerSchema("task",{required:["run_id","model","prompt"],rules:[{field:"run_id",type:"string",min:1,message:"Run ID is required"},{field:"model",type:"string",min:1,message:"Model is required"},{field:"prompt",type:"string",min:1,message:"Prompt is required"},{field:"status",type:"string",message:"Status must be a string"},{field:"status",type:"custom",customValidator:e=>["pending","running","completed","failed"].includes(e),message:"Status must be one of: pending, running, completed, failed"},{field:"usage",type:"custom",customValidator:this.validateTokenUsage.bind(this),message:"Token usage object is invalid"}]}),this.registerSchema("variable_list",{required:["name","values"],rules:[{field:"name",type:"string",min:1,max:200,message:"Name must be 1-200 characters"},{field:"values",type:"array",min:1,message:"At least one value is required"},{field:"description",type:"string",max:1e3,message:"Description must be under 1000 characters"},{field:"attribution",type:"string",max:500,message:"Attribution must be under 500 characters"},{field:"values",type:"custom",customValidator:this.validateVariableValues.bind(this),message:"Variable values contain invalid entries"}]}),this.registerSchema("model",{required:["id","provider","name"],rules:[{field:"id",type:"string",min:1,message:"Model ID is required"},{field:"provider",type:"string",min:1,message:"Provider is required"},{field:"name",type:"string",min:1,message:"Model name is required"},{field:"enabled",type:"boolean",message:"Enabled must be a boolean"},{field:"context_length",type:"number",min:1,message:"Context length must be positive"},{field:"input_cost",type:"number",min:0,message:"Input cost must be non-negative"},{field:"output_cost",type:"number",min:0,message:"Output cost must be non-negative"}]}),this.registerSchema("provider",{required:["id","name","base_url"],rules:[{field:"id",type:"string",min:1,message:"Provider ID is required"},{field:"name",type:"string",min:1,message:"Provider name is required"},{field:"base_url",type:"url",message:"Base URL must be a valid URL"},{field:"timeout",type:"number",min:1e3,max:3e5,message:"Timeout must be 1-300 seconds"},{field:"rate_limit",type:"number",min:1,message:"Rate limit must be positive"}]})}registerSchema(e,t){this.schemas.set(e,t)}async validateEntity(e,t,a={}){const s=this.schemas.get(e);if(!s)return{valid:!1,errors:[{field:"_schema",value:e,message:`No schema found for entity type: ${e}`,type:"error"}],warnings:[]};const n=[],l=[],r={...t};if(s.required)for(const i of s.required)i in t&&void 0!==t[i]&&null!==t[i]&&""!==t[i]||n.push({field:i,value:t[i],message:`${i} is required`,type:"error"});for(const i of s.rules){const e=t[i.field],s=this.validateField(i,e);s.error&&n.push({field:i.field,value:e,message:s.error,type:"error"}),s.warning&&l.push({field:i.field,value:e,message:s.warning,type:"warning"}),a.coerceTypes&&void 0!==s.coercedValue&&(r[i.field]=s.coercedValue)}if(!a.allowExtraFields){const e=new Set([...s.required||[],...s.optional||[],...s.rules.map(e=>e.field)]);for(const s in t)e.has(s)||(a.stripExtraFields?(delete r[s],l.push({field:s,value:t[s],message:`Extra field '${s}' was stripped`,type:"warning"})):l.push({field:s,value:t[s],message:`Extra field '${s}' is not allowed`,type:"warning"}))}return{valid:0===n.length,errors:n,warnings:l,data:r}}validateField(e,t){if(null==t)return{};switch(e.type){case"required":if(""===t||null==t)return{error:e.message||`${e.field} is required`};break;case"string":if("string"!=typeof t)return{error:e.message||`${e.field} must be a string`};if(void 0!==e.min&&t.length<e.min)return{error:e.message||`${e.field} must be at least ${e.min} characters`};if(void 0!==e.max&&t.length>e.max)return{error:e.message||`${e.field} must be at most ${e.max} characters`};if(e.pattern&&!e.pattern.test(t))return{error:e.message||`${e.field} does not match required pattern`};break;case"number":const a="string"==typeof t?parseFloat(t):t;return isNaN(a)||"number"!=typeof a?{error:e.message||`${e.field} must be a number`}:void 0!==e.min&&a<e.min?{error:e.message||`${e.field} must be at least ${e.min}`}:void 0!==e.max&&a>e.max?{error:e.message||`${e.field} must be at most ${e.max}`}:{coercedValue:a};case"boolean":if("boolean"!=typeof t)return"true"===t||"false"===t?{coercedValue:"true"===t}:{error:e.message||`${e.field} must be a boolean`};break;case"array":if(!Array.isArray(t))return{error:e.message||`${e.field} must be an array`};if(void 0!==e.min&&t.length<e.min)return{error:e.message||`${e.field} must have at least ${e.min} items`};if(void 0!==e.max&&t.length>e.max)return{error:e.message||`${e.field} must have at most ${e.max} items`};break;case"object":if("object"!=typeof t||Array.isArray(t))return{error:e.message||`${e.field} must be an object`};break;case"email":if("string"!=typeof t||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return{error:e.message||`${e.field} must be a valid email address`};break;case"url":try{new URL(t)}catch{return{error:e.message||`${e.field} must be a valid URL`}}break;case"custom":if(e.customValidator){const a=e.customValidator(t);if(!1===a)return{error:e.message||`${e.field} failed custom validation`};if("string"==typeof a)return{error:a}}}return{}}validatePromptTemplate(e){if("string"!=typeof e)return"Prompt template must be a string";if((e.match(/\{\{/g)||[]).length!==(e.match(/\}\}/g)||[]).length)return"Unmatched template braces in prompt template";const t=/\{\{([^}]+)\}\}/g,a=[];let s;for(;null!==(s=t.exec(e));){const e=s[1].trim();/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(e)||a.push(e)}return!(a.length>0)||`Invalid variable names: ${a.join(", ")}`}validateModelArray(e){if(!Array.isArray(e))return"Models must be an array";if(0===e.length)return"At least one model is required";for(const t of e)if("string"!=typeof t||""===t.trim())return"All models must be non-empty strings";return!0}validateTokenUsage(e){if(!e)return!0;if("object"!=typeof e)return"Token usage must be an object";const t=["prompt_tokens","completion_tokens","total_tokens"];for(const a of t)if(!(a in e)||"number"!=typeof e[a]||e[a]<0)return`Token usage.${a} must be a non-negative number`;return e.total_tokens===e.prompt_tokens+e.completion_tokens||"Token usage total_tokens must equal prompt_tokens + completion_tokens"}validateVariableValues(e){if(!Array.isArray(e))return"Variable values must be an array";if(0===e.length)return"At least one variable value is required";for(let t=0;t<e.length;t++){const a=e[t];if("string"!=typeof a||""===a.trim())return`Variable value at index ${t} must be a non-empty string`}return new Set(e).size===e.length||"Variable values must be unique"}async validateMultiple(e,t={}){return await Promise.all(e.map(e=>this.validateEntity(e.type,e.data,t)))}getSchema(e){return this.schemas.get(e)}listSchemas(){return Array.from(this.schemas.keys())}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}isValidUrl(e){try{return new URL(e),!0}catch{return!1}}sanitizeString(e,t=1e3){return e.trim().substring(0,t)}};t(L,"instance");let T=L;T.getInstance();const N=class e{constructor(){t(this,"dbService"),t(this,"validationService"),this.dbService=C.getInstance(),this.validationService=T.getInstance()}static getInstance(){return e.instance||(e.instance=new e),e.instance}async importDesigns(e,t={}){const a={success:!1,designs:[],errors:[],warnings:[],converted:0};try{let n=[];if(Array.isArray(e))n=e;else{if(!e||"object"!=typeof e)return a.errors.push("Invalid import data format"),a;n=[e]}for(let e=0;e<n.length;e++){const l=n[e];try{if(t.convertTemplateFormat&&l.prompt_template){const t=l.prompt_template;l.prompt_template=this.convertTemplateFormat(t),l.prompt_template!==t&&(a.converted++,a.warnings.push(`Converted template format for design "${l.name||`#${e+1}`}"`))}if(l.variables&&"object"==typeof l.variables&&(l.variables=this.normalizeVariableFormat(l.variables)),!t.allowDuplicateNames){const e=await this.dbService.findAll("designs");if(e.success&&e.data){const t=new Set(e.data.map(e=>e.name));t.has(l.name)&&(l.name=await this.generateUniqueName(l.name,t),a.warnings.push(`Renamed design to avoid duplicate: ${l.name}`))}}if(!t.skipValidation){const t=await this.validationService.validateEntity("design",l);if(!t.valid){a.errors.push(`Design #${e+1}: ${t.errors.map(e=>e.message).join(", ")}`);continue}}const s=await this.dbService.create("designs",l);s.success&&s.data?a.designs.push(s.data):a.errors.push(`Failed to create design #${e+1}: ${s.error}`)}catch(s){a.errors.push(`Error processing design #${e+1}: ${s instanceof Error?s.message:"Unknown error"}`)}}return a.success=a.designs.length>0,a}catch(s){return a.errors.push(`Import failed: ${s instanceof Error?s.message:"Unknown error"}`),a}}async exportDesigns(e,t={}){try{const a=[];for(const t of e){const e=await this.dbService.read("designs",t);e.success&&e.data&&a.push(e.data)}if(0===a.length)return{success:!1,error:"No designs found to export"};const s=t.format||"json",n=(new Date).toISOString().slice(0,19).replace(/[:-]/g,"");if("json"===s){const e={exported_at:(new Date).toISOString(),version:"1.0",designs:a.map(e=>this.sanitizeDesignForExport(e,t))};return{success:!0,data:JSON.stringify(e,null,2),filename:`designs_export_${n}.json`}}if("csv"===s){return{success:!0,data:this.convertToCSV(a,t),filename:`designs_export_${n}.csv`}}return{success:!1,error:`Unsupported export format: ${s}`}}catch(a){return{success:!1,error:`Export failed: ${a instanceof Error?a.message:"Unknown error"}`}}}convertTemplateFormat(e){return e.replace(/\{([^{}\s]+)\}/g,"{{$1}}")}normalizeVariableFormat(e){const t={};for(const[a,s]of Object.entries(e))Array.isArray(s)?t[a]=s.map(e=>String(e)):t[a]="string"==typeof s?s.split(",").map(e=>e.trim()).filter(e=>e.length>0):[String(s)];return t}async generateUniqueName(e,t){let a=1,s=`${e} (${a})`;for(;t.has(s);)a++,s=`${e} (${a})`;return s}sanitizeDesignForExport(e,t){const{includeRuns:a=!1}=t;return{name:e.name,description:e.description,prompt_template:e.prompt_template,variables:e.variables,variable_list_refs:e.variable_list_refs,created_at:e.created_at,updated_at:e.updated_at}}convertToCSV(e,t){const a=[["name","description","prompt_template","variables","created_at"].join(",")];for(const s of e){const e=[this.escapeCsvValue(s.name||""),this.escapeCsvValue(s.description||""),this.escapeCsvValue(s.prompt_template||""),this.escapeCsvValue(JSON.stringify(s.variables||{})),this.escapeCsvValue(s.created_at||"")];a.push(e.join(","))}return a.join("\n")}escapeCsvValue(e){return e.includes(",")||e.includes('"')||e.includes("\n")?`"${e.replace(/"/g,'""')}"`:e}};t(N,"instance");let O=N;const U=class e{static getInstance(){return this.instance||(this.instance=new e),this.instance}constructor(){}validateTemplate(e){const t=[],a=[],s=[];if(!e.trim())return t.push("Template cannot be empty"),{isValid:!1,errors:t,warnings:a,detectedVariables:s};const n=e.match(/\{\{\s*([^}]*)\s*\}\}/g)||[],l=new Set;for(const r of n){const e=r.replace(/\{\{\s*|\s*\}\}/g,"").trim();e?/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(e)?(["id","name","template","design"].includes(e.toLowerCase())&&a.push(`Variable "${e}" uses a reserved name and may cause confusion`),l.add(e)):t.push(`Invalid variable name "${e}". Variables must start with a letter or underscore and contain only letters, numbers, and underscores.`):t.push(`Empty variable placeholder found: ${r}`)}return s.push(...Array.from(l)),0===s.length&&a.push("No variables detected. This design will generate the same prompt for all tasks."),s.length>10&&a.push(`Large number of variables (${s.length}). Consider grouping related variables into lists.`),e.includes("{{")&&!e.includes("}}")&&t.push("Unclosed variable placeholder detected"),e.includes("}}")&&!e.includes("{{")&&t.push("Unopened variable placeholder detected"),{isValid:0===t.length,errors:t,warnings:a,detectedVariables:s}}syncVariableArrays(e,t,a){const s={...t},n={...a};for(const l of e)l in s||l in n||(s[l]=[]);for(const l of Object.keys(s))e.includes(l)||delete s[l];for(const l of Object.keys(n))e.includes(l)||delete n[l];return{arrays:s,listRefs:n}}createTestPrompt(e,t,a,s){return e.replace(/\{\{\s*([^}]+)\s*\}\}/g,(e,n)=>{const l=n.trim();if(a[l]){const e=a[l],t=s.find(t=>t.id===e);if(t&&t.values&&t.values.length>0)return t.values[0]}const r=t[l];return r&&r.length>0?r[0]:`test_${l}`})}prepareDesignData(e,t,a,s){const n={};for(const[r,i]of Object.entries(a))t.includes(r)&&i.length>0&&!s[r]&&(n[r]=[...i]);const l={};for(const[r,i]of Object.entries(s))t.includes(r)&&(l[r]=i);return{name:e.name.trim(),description:e.description?.trim()||"",prompt_template:e.prompt_template.trim(),variables:n,variable_list_refs:l,output_format:e.output_format,output_type:e.output_type,extract_pattern:e.extract_pattern}}validateDesignCompleteness(e,t,a){const s=[];for(const n of e){const e=t[n]?.length>0,l=void 0!==a[n];e||l||s.push(n)}return{isComplete:0===s.length,missingVariables:s}}getVariableStats(e,t,a,s){let n=1;const l=[];for(const r of e)if(a[r]){const e=s["string"==typeof a[r]?parseInt(a[r]):a[r]]||0;l.push({name:r,type:"list",count:e}),e>0&&(n*=e)}else{const e=t[r]?.length||0;l.push({name:r,type:"direct",count:e}),e>0&&(n*=e)}return{totalCombinations:n,variableCount:e.length,variableInfo:l}}formatRelativeDate(e){const t=new Date(e),a=(new Date).getTime()-t.getTime(),s=Math.floor(a/864e5);return 0===s?"today":1===s?"yesterday":s<7?`${s} days ago`:t.toLocaleDateString()}};t(U,"instance",null);let E=U;const q={class:"modal-content list-selection-modal"},R={class:"modal-header"},F={class:"modal-body"},M={key:0,class:"list-filters"},P=["value"],z={class:"list-options"},J={key:0,class:"no-lists"},B={key:1,class:"no-results"},K=["onClick"],Z={class:"list-main"},H={key:0,class:"list-description"},W={key:1,class:"list-preview"},Y={class:"preview-values"},G={class:"list-meta"},Q={class:"list-count"},X={class:"list-datetime"},ee=["title"],te={class:"modal-footer"},ae={class:"footer-info"},se={class:"list-count-summary"},ne=S(a({__name:"VariableListSelector",props:{isVisible:{type:Boolean},variableName:{},availableLists:{}},emits:["close","select-list"],setup(e,{emit:t}){const a=e,y=t,h=E.getInstance(),_=s(""),k=s(""),w=n(()=>{const e=new Set;return a.availableLists.forEach(t=>{e.add(t.category||"general")}),Array.from(e).sort()}),x=n(()=>{let e=a.availableLists;if(_.value){const t=_.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||e.values&&e.values.some(e=>e.toLowerCase().includes(t)))}return k.value&&(e=e.filter(e=>(e.category||"general")===k.value)),e});function $(e){return h.formatRelativeDate(e.updated_at||e.created_at)}return(e,t)=>e.isVisible?(i(),l("div",{key:0,class:"modal-overlay nested-modal",onClick:t[4]||(t[4]=o(t=>e.$emit("close"),["self"]))},[u("div",q,[u("div",R,[u("div",null,[t[6]||(t[6]=u("div",{class:"modal-breadcrumb"},[u("span",null,"Create Design"),u("span",{class:"breadcrumb-separator"},"→"),u("span",{class:"breadcrumb-current"},"Select Variable List")],-1)),u("h3",null,[t[5]||(t[5]=c("Select Variable List for ")),u("code",null,d(e.variableName),1)])]),u("button",{class:"close-btn",onClick:t[0]||(t[0]=t=>e.$emit("close"))}," × ")]),u("div",F,[e.availableLists.length>0?(i(),l("div",M,[p(u("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>_.value=e),type:"text",placeholder:"Search lists...",class:"search-input"},null,512),[[m,_.value]]),p(u("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>k.value=e),class:"category-filter"},[t[7]||(t[7]=u("option",{value:""}," All Categories ",-1)),(i(!0),l(g,null,f(w.value,e=>(i(),l("option",{key:e,value:e},d(e),9,P))),128))],512),[[v,k.value]])])):r("",!0),u("div",z,[0===e.availableLists.length?(i(),l("div",J,t[8]||(t[8]=[u("div",{class:"no-lists-content"},[u("h4",null,"No variable lists available"),u("p",null,"Create variable lists in the Variables tab to use them in your designs.")],-1)]))):0===x.value.length?(i(),l("div",B,t[9]||(t[9]=[u("h4",null,"No lists match your search",-1),u("p",null,"Try adjusting your search terms or category filter.",-1)]))):r("",!0),(i(!0),l(g,null,f(x.value,e=>{return i(),l("div",{key:e.id,class:"list-option",onClick:t=>function(e){y("select-list",e)}(e)},[u("div",Z,[u("h4",null,d(e.name),1),e.description?(i(),l("p",H,d(e.description),1)):r("",!0),e.values&&e.values.length>0?(i(),l("div",W,[t[10]||(t[10]=u("span",{class:"preview-label"},"Sample values:",-1)),u("span",Y,d((a=e.values,a.length<=3?a.join(", "):`${a.slice(0,3).join(", ")}, ...`)),1)])):r("",!0)]),u("div",G,[u("span",{class:b(["list-category",`category-${e.category||"general"}`])},d(e.category||"general"),3),u("span",Q,d(e.values?.length||0)+" items ",1),u("span",X,d($(e)),1),e.attribute_keys?.length?(i(),l("span",{key:0,class:"attribute-keys",title:`Attributes: ${e.attribute_keys.join(", ")}`},d(e.attribute_keys.length)+" attributes ",9,ee)):r("",!0)])],8,K);var a}),128))])]),u("div",te,[u("div",ae,[u("span",se,d(x.value.length)+" of "+d(e.availableLists.length)+" lists ",1)]),u("button",{type:"button",class:"btn btn-secondary",onClick:t[3]||(t[3]=t=>e.$emit("close"))}," Cancel ")])])])):r("",!0)}}),[["__scopeId","data-v-300aeae9"]]),le={class:"modal-content compact"},re={class:"modal-header"},ie={class:"modal-body"},oe={class:"info-row"},ue={class:"info-field"},ce={class:"info-field"},de={class:"template-section"},pe={class:"template-header"},me={class:"output-selector"},ve={class:"template-editor"},ge=["innerHTML"],fe={key:0,class:"variables-section"},be={class:"variables-header"},ye={class:"variables-config"},he={class:"variable-name"},_e={key:0,class:"attributed-list-display"},ke={class:"list-header"},we={class:"source-name"},xe={class:"attribute-breakdown"},$e={key:0,class:"separator"},Ce={class:"total-conditions"},Se={key:1,class:"total-conditions"},Ve=["onClick"],De={class:"attributed-chips-container"},Ie={class:"item-name"},je={class:"attributes-wrapper"},Ae={key:1,class:"direct-values"},Le={key:0,class:"source-indicator"},Te={class:"source-name"},Ne={class:"tag-input-wrapper"},Oe={class:"custom-tag-input"},Ue={class:"tag-container"},Ee=["title"],qe=["onClick"],Re=["placeholder","onKeydown"],Fe={key:0,class:"helper-text"},Me=["onClick"],Pe=["onClick"],ze={class:"bottom-panels"},Je={class:"panel extraction-panel"},Be={key:0},Ke={class:"pattern-field"},Ze={class:"pattern-presets"},He=["value"],We={class:"pattern-options"},Ye=["value","checked","onChange"],Ge={class:"radio-option"},Qe=["checked"],Xe={key:1},et={class:"json-config"},tt={class:"panel test-panel"},at={class:"test-controls"},st=["value"],nt=["disabled"],lt={key:0,class:"test-result"},rt={class:"result-row"},it={class:"response"},ot={class:"result-row"},ut={key:0,class:"check"},ct={key:1,class:"test-error"},dt={class:"modal-footer"},pt={class:"footer-info"},mt={class:"footer-actions"},vt=["disabled"],gt=S(a({__name:"DesignEditorModalV2",props:{design:{}},emits:["save","close"],setup(e,{emit:t}){const a=e,x=t,$=[{label:"Match whole response",pattern:"^(.+)$"},{label:"Extract first number",pattern:"\\b(\\d+(?:\\.\\d+)?)\\b"},{label:'After "Answer:"',pattern:"Answer:\\s*(.+?)(?:\\n|$)"}],C=[{name:'After "Score:" (number)',pattern:"Score:\\s*(\\d+(?:\\.\\d+)?)",flags:"i"},{name:'After "Confidence:" (decimal)',pattern:"Confidence:\\s*(0?\\.\\d+|1(?:\\.0)?)",flags:"i"},{name:'After "Category:"',pattern:"Category:\\s*([^\\n,]+)",flags:"i"},{name:"Last number",pattern:".*\\b(\\d+(?:\\.\\d+)?)\\b"},{name:"Number/10 rating",pattern:"(\\d+)\\s*/\\s*10"},{name:"Yes or No",pattern:"\\b(yes|no)\\b",flags:"i"},{name:"Number with $ prefix",pattern:"\\$(\\d+(?:,\\d{3})*(?:\\.\\d{2})?)",replace:"$1"},{name:"Number with % suffix",pattern:"(\\d+(?:\\.\\d+)?)\\s*%"}],S=E.getInstance(),D=I(),A=V(),L=n(()=>!!a.design),T=s(null),N=s(null),O=s(null),U=s({name:"",description:"",prompt_template:"",output_format:"text",output_type:"string",extract_pattern:""}),q=s(""),R=s(""),F=s({}),M=s({}),P=s({}),z=s([]),J=s({}),B=s({}),K=s({}),Z=n(()=>A.models.filter(e=>e.enabled)),H=s(""),W=s(!1),Y=s(null),G=s(""),Q=n(()=>S.validateTemplate(U.value.prompt_template)),X=n(()=>{const{missingVariables:e}=S.validateDesignCompleteness(Q.value.detectedVariables,F.value,M.value);return e}),ee=n(()=>!(!U.value.name.trim()||!U.value.prompt_template.trim())&&(!!Q.value.isValid&&0===X.value.length)),te=n(()=>!(!H.value||!U.value.prompt_template||W.value||0!==X.value.length||"text"===U.value.output_format&&!R.value)),ae=n(()=>{const e=Q.value.detectedVariables;if(0===e.length)return 0;let t=1;for(const a of e){let e=0;if(M.value[a]){const t=M.value[a];e=J.value[t]||0}else e=F.value[a]?.length||0;if(0===e)return 0;t*=e}return t}),se=n(()=>{if(!U.value.prompt_template)return"";let e=U.value.prompt_template.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");return e=e.replace(/(\{\{[^}]+\}\})/g,'<span class="variable-highlight">$1</span>'),e=e.replace(/\n/g,"<br>"),e});function gt(e){const t=M.value[e];if(!t)return{isAttributed:!1,attributeKeys:[],combinations:0};const a="string"==typeof t?parseInt(t):t,s=z.value.find(e=>e.id===a);if(!s)return{isAttributed:!1,attributeKeys:[],combinations:0};return{isAttributed:"attributed"===s.category,attributeKeys:s.attribute_keys||[],combinations:J.value[a]||s.values?.length||0}}function ft(e){const t="string"==typeof e?parseInt(e):e,a=z.value.find(e=>e.id===t);return a?a.name:"Unknown List"}function bt(e){const t=M.value[e];if(!t)return[];const a="string"==typeof t?parseInt(t):t,s=z.value.find(e=>e.id===a);if(!s||"attributed"!==s.category||!s.attributed_items)return[];if(K.value[a])return K.value[a];const n=[...s.attributed_items].sort(()=>Math.random()-.5).slice(0,10);return K.value[a]=n,n}function yt(e){const t=M.value[e];if(!t)return{parts:[],totalItems:0};const a="string"==typeof t?parseInt(t):t,s=z.value.find(e=>e.id===a);if(!s||"attributed"!==s.category)return{parts:[],totalItems:0};const n=J.value[a]||0;if(!B.value[a])return{parts:[],totalItems:n};const l=B.value[a],r=s.attribute_keys||Object.keys(l);if(0===r.length)return{parts:[],totalItems:n};const i=[];for(let o=0;o<r.length;o++){const e=r[o];l[e]&&i.push({text:`${e} (${l[e]} categories)`,colorIndex:o%5})}return{parts:i,totalItems:n}}function ht(e,t){if(F.value[e]=t,P.value[e]){const a=z.value.find(t=>t.id===P.value[e].listId)?.values||[];JSON.stringify(t.sort())!==JSON.stringify(a.sort())&&delete P.value[e]}}function _t(){N.value&&O.value&&(O.value.scrollTop=N.value.scrollTop,O.value.scrollLeft=N.value.scrollLeft,O.value.style.height=N.value.style.height)}function kt(e){T.value&&e.id?("attributed"!==e.category&&e.values&&e.values.length>0?(F.value[T.value]=[...e.values],P.value[T.value]={listId:e.id,listName:e.name},delete M.value[T.value]):"attributed"===e.category&&(M.value[T.value]=e.id,delete F.value[T.value],delete P.value[T.value]),T.value=null):T.value=null}function wt(){const e=C.find(e=>e.name===q.value);e&&(R.value=e.pattern,U.value.extract_pattern=e.replace?{match:e.pattern,replace:e.replace}:e.pattern)}function xt(){const e=S.syncVariableArrays(Q.value.detectedVariables,F.value,M.value);F.value=e.arrays,M.value=e.listRefs}async function $t(){if(te.value){W.value=!0,Y.value=null,G.value="";try{const e=S.createTestPrompt(U.value.prompt_template,F.value,M.value,z.value),t=Z.value.find(e=>e.id===H.value);if(!t)throw new Error("Model not found");const a=await j({model:H.value,prompt:e,temperature:.7,max_tokens:150,output_format:U.value.output_format,output_type:U.value.output_type},t);let s=null;if("text"===U.value.output_format&&R.value){const e=a.content.match(new RegExp(R.value));e&&e[1]&&(s=e[1])}else"text"!==U.value.output_format&&(s=a.extracted_value?String(a.extracted_value):null);Y.value={response:a.content,extracted:s}}catch(e){G.value=e instanceof Error?e.message:"Test failed"}finally{W.value=!1}}}function Ct(){if(!ee.value)return;const e=S.prepareDesignData(U.value,Q.value.detectedVariables,F.value,M.value);x("save",e)}return y(R,e=>{e&&"text"===U.value.output_format&&(U.value.extract_pattern=e)}),h(async()=>{const e=await D.loadVariableLists();z.value=e.sort((e,t)=>{const a=new Date(e.updated_at||e.created_at);return new Date(t.updated_at||t.created_at).getTime()-a.getTime()}),await A.loadModels();for(const t of z.value)if(t.id){const e=await D.getListItems(t.id);if(J.value[t.id]=e.length,"attributed"===t.category&&t.attributed_items&&t.attributed_items.length>0){const e={};for(const s of t.attributed_items)if(s.attributes)for(const[t,a]of Object.entries(s.attributes))e[t]||(e[t]=new Set),e[t].add(String(a));const a={};for(const[t,s]of Object.entries(e))a[t]=s.size;B.value[t.id]=a}}if(a.design){if(U.value={name:a.design.name,description:a.design.description||"",prompt_template:a.design.prompt_template,output_format:a.design.output_format||"text",output_type:a.design.output_type||"string",extract_pattern:a.design.extract_pattern||""},"text"===U.value.output_format&&U.value.extract_pattern&&("string"==typeof U.value.extract_pattern?R.value=U.value.extract_pattern:R.value=U.value.extract_pattern.match),a.design.variable_list_refs)for(const[e,t]of Object.entries(a.design.variable_list_refs)){const a=z.value.find(e=>e.id===t);a?"attributed"===a.category?M.value[e]=t:a.values&&a.values.length>0&&(F.value[e]=[...a.values],P.value[e]={listId:a.id,listName:a.name}):M.value[e]=t}if(a.design.variables)for(const[e,t]of Object.entries(a.design.variables))M.value[e]||P.value[e]||(F.value[e]=Array.isArray(t)?t:[t])}}),(e,t)=>{return i(),l("div",{class:"modal-overlay",onClick:t[13]||(t[13]=o(t=>e.$emit("close"),["self"]))},[u("div",le,[u("div",re,[u("h2",null,d(L.value?"Edit":"Create")+" Design",1),u("button",{class:"close-btn",onClick:t[0]||(t[0]=t=>e.$emit("close"))}," × ")]),u("div",ie,[u("div",oe,[u("div",ue,[t[14]||(t[14]=u("label",null,"Name:",-1)),p(u("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>U.value.name=e),type:"text",required:"",placeholder:"My Design"},null,512),[[m,U.value.name]])]),u("div",ce,[t[15]||(t[15]=u("label",null,"Description:",-1)),p(u("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>U.value.description=e),type:"text",placeholder:"Brief description"},null,512),[[m,U.value.description]])])]),u("div",de,[u("div",pe,[t[18]||(t[18]=u("label",null,"Prompt Template:",-1)),u("div",me,[t[17]||(t[17]=u("label",null,"Output:",-1)),p(u("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>U.value.output_format=e)},t[16]||(t[16]=[u("option",{value:"text"}," Text ",-1),u("option",{value:"function_tool_calling"}," JSON Function ",-1),u("option",{value:"response_format_json_mode"}," JSON Structured ",-1)]),512),[[v,U.value.output_format]])])]),u("div",ve,[u("div",{ref_key:"highlightDiv",ref:O,class:"template-highlight",innerHTML:se.value},null,8,ge),p(u("textarea",{ref_key:"templateTextarea",ref:N,"onUpdate:modelValue":t[4]||(t[4]=e=>U.value.prompt_template=e),required:"",rows:"4",placeholder:"You are a helpful assistant. Please {{action}} the following {{topic}}...",class:"template-input",onInput:xt,onScroll:_t,onResize:_t},null,544),[[m,U.value.prompt_template]])])]),Q.value.detectedVariables.length>0?(i(),l("div",fe,[u("div",be,[t[19]||(t[19]=u("span",null,"Variables Found:",-1)),(i(!0),l(g,null,f(Q.value.detectedVariables,e=>(i(),l("span",{key:e,class:"variable-chip"},d(e),1))),128))]),u("div",ye,[(i(!0),l(g,null,f(Q.value.detectedVariables,e=>(i(),l("div",{key:e,class:"variable-row"},[u("span",he,d(e)+":",1),M.value[e]?(i(),l("div",_e,[u("div",ke,[t[21]||(t[21]=u("span",{class:"source-label"},"From list:",-1)),u("span",we,d(ft(M.value[e])),1),u("div",xe,[yt(e).parts.length>0?(i(),l(g,{key:0},[(i(!0),l(g,null,f(yt(e).parts,(t,a)=>(i(),l(g,{key:a},[u("span",{class:"attribute-part",style:k({backgroundColor:[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}][t.colorIndex].bg,color:[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}][t.colorIndex].text})},d(t.text),5),a<yt(e).parts.length-1?(i(),l("span",$e," × ")):r("",!0)],64))),128)),t[20]||(t[20]=u("span",{class:"arrow"}," → ",-1)),u("span",Ce,d(yt(e).totalItems)+" conditions",1)],64)):(i(),l("span",Se,d(yt(e).totalItems)+" conditions",1))]),u("button",{type:"button",class:"btn-tiny btn-danger",onClick:t=>function(e){delete M.value[e],delete P.value[e],F.value[e]=[]}(e)}," Clear List ",8,Ve)]),u("div",De,[t[24]||(t[24]=u("span",{class:"sample-hint"},"Sample values:",-1)),(i(!0),l(g,null,f(bt(e),a=>{return i(),l("div",{key:a.value,class:"attributed-item-chip"},[u("span",Ie,d(a.value),1),u("span",je,[t[22]||(t[22]=c(" (")),(i(!0),l(g,null,f((s=a.attributes,n=gt(e).attributeKeys,Object.entries(s).map(([e,t])=>({value:t,colorIndex:n.indexOf(e)%5}))),(e,t)=>(i(),l("span",{key:t,class:"attribute-value",style:k({backgroundColor:[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}][e.colorIndex].bg,color:[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}][e.colorIndex].text})},d(e.value),5))),128)),t[23]||(t[23]=c(") "))])]);var s,n}),128))])])):(i(),l("div",Ae,[P.value[e]?(i(),l("div",Le,[t[25]||(t[25]=u("span",{class:"source-label"},"From list:",-1)),u("span",Te,d(P.value[e].listName),1),t[26]||(t[26]=u("span",{class:"source-note"},"(modify chips to break connection)",-1))])):r("",!0),u("div",Ne,[u("div",Oe,[u("div",Ue,[(i(!0),l(g,null,f(F.value[e]||[],(t,a)=>(i(),l("div",{key:`${t}-${a}`,class:"tag"},[u("span",{class:"tag-text",title:t.length>100?t:""},d(t.length>100?t.substring(0,100)+"...":t),9,Ee),u("button",{type:"button",class:"tag-remove",onClick:t=>function(e,t){const a=[...F.value[e]||[]];a.splice(t,1),ht(e,a)}(e,a)}," × ",8,qe)]))),128)),u("input",{placeholder:`Add values for ${e} or replace with list`,class:"tag-input-field",onKeydown:[w(o(t=>function(e,t){const a=t.target,s=a.value.trim();if(!s)return;const n=F.value[e]||[];n.includes(s)||ht(e,[...n,s]),a.value=""}(e,t),["prevent"]),["enter"]),w(t=>function(e,t){if(""===t.target.value){const t=F.value[e]||[];if(t.length>0){const a=[...t];a.pop(),ht(e,a)}}}(e,t),["backspace"])]},null,40,Re)]),F.value[e]?.length>0?(i(),l("div",Fe,d(F.value[e].length)+" values ",1)):r("",!0)]),u("button",{type:"button",class:"btn-tiny btn-primary",onClick:t=>function(e){T.value=e}(e)}," Replace with List ",8,Me),F.value[e]?.length>0?(i(),l("button",{key:0,type:"button",class:"btn-tiny btn-danger",onClick:t=>function(e){F.value[e]=[],delete P.value[e]}(e)}," Clear ",8,Pe)):r("",!0)])]))]))),128))])])):r("",!0),u("div",ze,[u("div",Je,[t[33]||(t[33]=u("h4",null,"Extraction",-1)),"text"===U.value.output_format?(i(),l("div",Be,[u("div",Ke,[t[27]||(t[27]=u("label",null,"Pattern:",-1)),p(u("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>R.value=e),type:"text",class:"pattern-input",placeholder:"(\\d+)",spellcheck:"false"},null,512),[[m,R.value]])]),u("div",Ze,[p(u("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>q.value=e),class:"preset-select",onChange:wt},[t[28]||(t[28]=u("option",{value:""}," Common patterns ",-1)),(i(),l(g,null,f(C,e=>u("option",{key:e.name,value:e.name},d(e.name),9,He)),64))],544),[[v,q.value]])]),u("div",We,[(i(),l(g,null,f($,(e,t)=>u("label",{key:t,class:"radio-option"},[u("input",{type:"radio",value:e.pattern,checked:R.value===e.pattern,onChange:t=>R.value=e.pattern},null,40,Ye),c(" "+d(e.label),1)])),64)),u("label",Ge,[u("input",{type:"radio",value:"custom",checked:!$.find(e=>e.pattern===R.value)},null,8,Qe),t[29]||(t[29]=c(" Custom: ")),$.find(e=>e.pattern===R.value)?r("",!0):p((i(),l("input",{key:0,"onUpdate:modelValue":t[7]||(t[7]=e=>R.value=e),type:"text",class:"custom-input",onClick:t[8]||(t[8]=o(()=>{},["stop"]))},null,512)),[[m,R.value]])])])])):(i(),l("div",Xe,[u("div",et,[t[31]||(t[31]=u("label",null,"Returns:",-1)),p(u("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>U.value.output_type=e)},t[30]||(t[30]=[u("option",{value:"string"}," String ",-1),u("option",{value:"number"}," Number ",-1),u("option",{value:"boolean"}," Boolean ",-1)]),512),[[v,U.value.output_type]])]),t[32]||(t[32]=u("div",{class:"json-note"},' Model will return JSON with "answer" field ',-1))]))]),u("div",tt,[t[38]||(t[38]=u("h4",null,"Live Test",-1)),u("div",at,[t[35]||(t[35]=u("label",null,"Model:",-1)),p(u("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>H.value=e)},[t[34]||(t[34]=u("option",{value:""}," Select... ",-1)),(i(!0),l(g,null,f(Z.value,e=>(i(),l("option",{key:e.id,value:e.id},d(e.name),9,st))),128))],512),[[v,H.value]]),u("button",{type:"button",class:"btn btn-sm btn-primary",disabled:!te.value,onClick:$t}," Test Now ",8,nt)]),Y.value?(i(),l("div",lt,[u("div",rt,[t[36]||(t[36]=u("label",null,"Response:",-1)),u("div",it,d((a=Y.value.response,a.length<=100?a:a.substring(0,100)+"...")),1)]),u("div",ot,[t[37]||(t[37]=u("label",null,"Extracted:",-1)),u("div",{class:b(["extracted",{success:Y.value.extracted,error:!Y.value.extracted}])},[c(d(Y.value.extracted||"(no match)")+" ",1),Y.value.extracted?(i(),l("span",ut,"✓")):r("",!0)],2)])])):G.value?(i(),l("div",ct,d(G.value),1)):r("",!0)])])]),u("div",dt,[u("div",pt,d(Q.value.detectedVariables.length)+" vars • "+d(ae.value.toLocaleString())+" combinations ",1),u("div",mt,[u("button",{type:"button",class:"btn btn-secondary",onClick:t[11]||(t[11]=t=>e.$emit("close"))}," Cancel "),u("button",{type:"submit",class:"btn btn-primary",disabled:!ee.value,onClick:Ct},d(L.value?"Update":"Create"),9,vt)])])]),T.value?(i(),_(ne,{key:0,"is-visible":!0,"variable-name":T.value,"available-lists":z.value,onClose:t[12]||(t[12]=e=>T.value=null),onSelectList:kt},null,8,["variable-name","available-lists"])):r("",!0)]);var a}}}),[["__scopeId","data-v-79aac22f"]]),ft={class:"designs-view"},bt={class:"page-header"},yt={class:"header-actions"},ht=["disabled"],_t={key:0,class:"loading-state"},kt={key:1,class:"empty-state"},wt={key:2,class:"designs-container"},xt={class:"sort-controls"},$t={class:"designs-table"},Ct={class:"design-main"},St={class:"design-info"},Vt={class:"design-header"},Dt={class:"design-name"},It={class:"design-output"},jt={key:0,class:"design-description"},At={class:"design-meta"},Lt={key:0},Tt={class:"design-actions"},Nt=["onClick"],Ot=["onClick"],Ut=["onClick"],Et=["onClick"],qt=["onClick"],Rt=S(a({__name:"DesignsView",setup(e){const t=x(),a=D(),o=I(),m=s([]),b=s([]),y=s(!1),k=s(null),w=s("updated_at"),C=s("desc"),S=n(()=>[...m.value].sort((e,t)=>{let a,s;switch(w.value){case"name":a=e.name.toLowerCase(),s=t.name.toLowerCase();break;case"created_at":a=new Date(e.created_at||0).getTime(),s=new Date(t.created_at||0).getTime();break;case"updated_at":a=new Date(e.updated_at||e.created_at||0).getTime(),s=new Date(t.updated_at||t.created_at||0).getTime();break;default:return 0}return a<s?"asc"===C.value?-1:1:a>s?"asc"===C.value?1:-1:0}));async function V(){m.value=await a.loadDesigns()}async function j(e){try{k.value?.id?await a.updateDesign(k.value.id,e):await a.createDesign(e),await V(),L()}catch(t){console.error("Failed to save design:",t),alert(`Failed to save design: ${t instanceof Error?t.message:String(t)}`)}}function L(){y.value=!1,k.value=null}function T(){const e={version:"1.0",exportDate:(new Date).toISOString(),designs:m.value},t=JSON.stringify(e,null,2),a=new Blob([t],{type:"application/json"}),s=URL.createObjectURL(a),n=document.createElement("a");n.href=s,n.download=`auditomatic_designs_${(new Date).getTime()}.json`,n.click(),URL.revokeObjectURL(s)}async function N(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{const t=e.target.files?.[0];if(t)try{const e=await t.text(),a=A(e);if(null===a)throw new SyntaxError("Invalid JSON format in imported file");const s=O.getInstance(),n=await s.importDesigns(a,{convertTemplateFormat:!0,allowDuplicateNames:!1,skipValidation:!1});if(!n.success&&n.errors.length>0)return void alert(`Import failed: ${n.errors.join(", ")}`);const l=n.designs.length;if(0===l)return void alert("No valid designs found to import");const r=`Import ${l} design${l>1?"s":""}? This will not affect existing designs.`;if(!confirm(r))return;await V();let i=[`Successfully imported ${n.designs.length} design${n.designs.length>1?"s":""}`];n.converted>0&&i.push(`${n.converted} template format${n.converted>1?"s":""} converted`),n.warnings.length>0&&i.push(`Warnings: ${n.warnings.join(", ")}`),alert(i.join(". "))}catch(a){console.error("Import error:",a);let e="Failed to import designs. ";a instanceof SyntaxError?e+="Invalid JSON format.":a instanceof Error&&a.message?e+=a.message:e+="Please check the file format.",alert(e)}},e.click()}function U(){}function E(){C.value="asc"===C.value?"desc":"asc"}function q(e){return e?new Date(e).toLocaleDateString():"N/A"}function R(e){const t=e.variables||{},a=e.variable_list_refs||{};if(0===Object.keys(t).length&&0===Object.keys(a).length)return"0 variables";const s=[];let n=1;for(const[l,r]of Object.entries(t))Array.isArray(r)&&r.length>0&&(s.push(`${l} (${r.length})`),n*=r.length);for(const[l,r]of Object.entries(a)){const e=b.value.find(e=>e.id===r);e&&e.values?.length>0&&(s.push(`${l} (${e.values.length})`),n*=e.values.length)}return 0===s.length?"0 variables":1===s.length?`${s[0]} = ${n} conditions`:`${s.join(" × ")} = ${n} conditions`}return h(async()=>{await V(),await async function(){b.value=await o.loadVariableLists()}()}),(e,s)=>(i(),l("div",ft,[u("div",bt,[s[2]||(s[2]=u("h2",null,"Prompt Designs",-1)),u("div",yt,[u("button",{class:"btn btn-secondary",onClick:N}," Import "),u("button",{class:"btn btn-secondary",disabled:0===m.value.length,onClick:T}," Export All ",8,ht),u("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=e=>y.value=!0)}," New Design ")])]),$(a).loading?(i(),l("div",_t,s[3]||(s[3]=[u("div",{class:"loading-spinner"},null,-1),u("p",null,"Loading designs...",-1)]))):0===m.value.length?(i(),l("div",kt,s[4]||(s[4]=[u("p",null,"No designs yet. Create your first design!",-1)]))):(i(),l("div",wt,[u("div",xt,[s[6]||(s[6]=u("label",null,"Sort by:",-1)),p(u("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>w.value=e),onChange:U},s[5]||(s[5]=[u("option",{value:"updated_at"}," Last Edited ",-1),u("option",{value:"name"}," Name ",-1),u("option",{value:"created_at"}," Created Date ",-1)]),544),[[v,w.value]]),u("button",{class:"sort-toggle",onClick:E},d("desc"===C.value?"↓":"↑"),1)]),u("div",$t,[(i(!0),l(g,null,f(S.value,e=>(i(),l("div",{key:e.id,class:"design-row"},[u("div",Ct,[u("div",St,[u("div",Vt,[u("h3",Dt,d(e.name),1),u("span",It,d(e.output_format||"text"),1),e.description?(i(),l("span",jt,d(e.description),1)):r("",!0)]),u("p",At,[c(d(R(e))+" • Created "+d(q(e.created_at))+" ",1),e.updated_at&&e.updated_at!==e.created_at?(i(),l("span",Lt," • Updated "+d(q(e.updated_at)),1)):r("",!0)])]),u("div",Tt,[u("button",{class:"btn btn-secondary btn-small",onClick:t=>async function(e){if(e.id){const t=await a.getDesignById(e.id);k.value=t||e}else k.value=e}(e)}," Edit ",8,Nt),u("button",{class:"btn btn-secondary btn-small",onClick:t=>function(e){const t={...e,id:void 0,name:`${e.name} (Copy)`,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};k.value=t}(e)}," Copy ",8,Ot),u("button",{class:"btn btn-primary btn-small",onClick:a=>{return s=e.id,void t.push({name:"runs",query:{create:s.toString(),from:"designs"}});var s}}," Run ",8,Ut),u("button",{class:"btn btn-secondary btn-small",onClick:t=>function(e){const t={version:"1.0",exportDate:(new Date).toISOString(),design:e},a=JSON.stringify(t,null,2),s=new Blob([a],{type:"application/json"}),n=URL.createObjectURL(s),l=document.createElement("a");l.href=n,l.download=`design_${e.name.replace(/[^a-zA-Z0-9]/g,"_")}_${(new Date).toISOString().split("T")[0]}.json`,l.click(),URL.revokeObjectURL(n)}(e)}," Export ",8,Et),u("button",{class:"btn btn-danger btn-small",onClick:t=>async function(e){confirm("Are you sure you want to delete this design?")&&(await a.deleteDesign(e),await V())}(e.id)}," Delete ",8,qt)])])]))),128))])])),y.value||k.value?(i(),_(gt,{key:3,design:k.value,onSave:j,onClose:L},null,8,["design"])):r("",!0)]))}}),[["__scopeId","data-v-510bdf82"]]);export{Rt as default};
