import{r as q,c as U,a as H,d as ge,f as Q,t as oe,o as ye,w as G,h,ae as ne,A as j,af as Ce,e as u,i as e,y as B,x as $,B as g,ag as _e,aj as be,F as ee,C as te,j as c,z as O,G as P,aH as ce,k as Z,aI as pe,T as he,P as ae,ad as ke,a6 as $e,v as Y,N as Te,p as we,aJ as Ie,aK as Pe,$ as Se,aL as xe,ao as De,aM as Ne,aN as Ve,Z as Ee,Q as Me,D as se}from"./index-BjcyMJf8.js";import{u as Oe}from"./useV4Templates-iQJVUPAq.js";import{a as me}from"./useV4VariableLists-3fbn6QRF.js";import{u as le}from"./useV4Models-LvYBsRZc.js";import{u as re,a as Ae,b as Le,F as ze,c as ve,C as Re}from"./useCostEstimation-C-Vl_bjA.js";import{G as je}from"./GenericModelSelectorModalV3-PdM63vhP.js";import{S as fe}from"./SaveOutlined-D7qSgBP_.js";import"./useV4LiveQuery-CHMCjA-b.js";import"./useV4ProviderParameters-D1fGYCe8.js";import"./InboxOutlined-CX9GbWIz.js";function Be(W){const{templates:D}=Oe(),{variableLists:s}=me(),{enabledModels:w}=le(),{runningTrials:v}=re(),I=Le(),{createTrial:C}=Ae(),r=q(null),y=q(""),N=q(""),V=q(1),x=q([]),z=q(!1),A=q(!1),p=U(()=>D.value||[]),o=U(()=>[]),S=U(()=>{var l,_;if(!r.value)return 0;if(r.value.type==="template"){const b=r.value;if(!b.variables)return 1;let T=1;for(const[,M]of Object.entries(b.variables))if(M.type==="value"&&M.values)T*=M.values.length;else if(M.type==="list"&&M.listId){const K=s.value.find(X=>X.id===M.listId);K&&(K.category==="simple"?T*=((l=K.values)==null?void 0:l.length)||0:K.category==="attributed"?T*=((_=K.items)==null?void 0:_.length)||0:K.category==="tabular"&&(T*=K.itemCount||0))}return T}else return 0}),L=U(()=>S.value*x.value.length*V.value),R=U(()=>{let l=0;for(const _ of x.value){const b=n(_);l+=b*S.value*V.value}return l}),E=U(()=>r.value!==null&&x.value.length>0&&y.value.trim()!=="");function k(l){r.value=l,y.value=J(l)}function J(l){const _=l||r.value;if(!_)return"New Trial";const b=new Date().toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return`${_.name} - ${b}`}function n(l){var X,de;if(!r.value)return 0;const _=w.value.find(ue=>ue.provider===l.provider&&ue.modelId===l.modelId);if(!(_!=null&&_.capabilities))return 0;const b=t(),T=((X=l.parameters)==null?void 0:X.max_tokens)||((de=l.parameters)==null?void 0:de.maxTokens)||256,M=(_.capabilities.inputCostPerToken||0)*b,K=(_.capabilities.outputCostPerToken||0)*T;return M+K}function t(){return r.value&&r.value.type==="template"?150:100}function a(l){x.value.push(l)}function i(l){x.value.splice(l,1)}async function d(){if(E.value){z.value=!0;try{const l=JSON.parse(JSON.stringify(r.value)),_={name:y.value,description:"",type:l.type,configurations:JSON.parse(JSON.stringify(x.value)),repeatCount:V.value,templateConfig:l.type==="template"?{template:l.template,variables:l.variables,outputType:l.outputType,extractPattern:l.extractPattern,refusalWords:l.refusalWords,rejectRefusalWords:l.rejectRefusalWords}:void 0,spreadsheetConfig:l.type==="spreadsheet"?{promptPattern:l.promptPattern,datasetId:l.datasetId}:void 0},b=await C(_);if(b.ok)return b.value;throw b.error}finally{z.value=!1}}}async function f(){const l=await d();if(l)return v.value.length>0?{trialId:l,needsConfirmation:!0,runningTrial:v.value[0]}:await F(l)}async function F(l){H.info("V4: Creation view starting trial via V4 execution control",l);const _=await I.startTrialWithStreaming(l);if(_.ok){H.info("V4: Trial started successfully via V4 execution control");const b=_.value.progress$.subscribe({next:M=>{H.info("V4: Creation view received progress update:",M.type)},error:M=>{H.error("V4: Creation view stream error:",M)}}),T=_.value.calls$.subscribe({next:M=>{H.info("V4: Creation view received batch of",M.length,"calls")},error:M=>{H.error("V4: Creation view calls stream error:",M)}});return H.info("V4: Creation view subscribed to BOTH streams, execution started, navigating to trials view"),setTimeout(()=>{b.unsubscribe(),T.unsubscribe(),H.info("V4: Creation view unsubscribed from streams after navigation")},1e3),{trialId:l,needsConfirmation:!1}}else throw _.error}async function m(){var l,_;try{await I.initialize(),H.info("V4: Execution control initialized in creation view")}catch(b){H.error("V4: Failed to initialize execution control in creation view:",b)}if(W.value.type==="duplicate"&&W.value.sourceTrialId){const b=await ge.trials.get(W.value.sourceTrialId);if(b){if(y.value=`Copy of ${b.name}`,V.value=b.repeatCount||1,b.configurations&&(x.value=b.configurations.map(T=>{var M;return{name:((M=T.modelSnapshot)==null?void 0:M.displayName)||T.modelId,provider:T.provider,modelId:T.modelId,parameters:T.parameters||{}}})),b.type==="template"&&((l=b.templateConfig)!=null&&l.template)){const T=p.value.find(M=>{var K;return M.template===((K=b.templateConfig)==null?void 0:K.template)});T&&k(T)}else if(b.type==="spreadsheet"&&((_=b.spreadsheetConfig)!=null&&_.datasetId)){const T=o.value.find(M=>{var K;return M.datasetId===((K=b.spreadsheetConfig)==null?void 0:K.datasetId)});T&&k(T)}}}}return{selectedPrompt:r,trialName:y,description:N,repeatCount:V,configurations:x,creating:z,showModelSelector:A,templates:p,spreadsheets:o,variableLists:s,enabledModels:w,runningTrials:v,totalCombinations:S,totalExperiments:L,totalCost:R,canProceed:E,selectPrompt:k,generateTrialName:J,addConfiguration:a,removeConfiguration:i,getConfigCostPerCall:n,createTrialAsDraft:d,createAndStartTrial:f,initialize:m}}const Ue={key:0,class:"preview-controls"},Fe={class:"template-name"},Je={key:0,class:"cycle-info"},qe={key:1,class:"variable-legend"},We={class:"variable-value"},Ke=Q({__name:"TemplatePreviewV3",props:{template:{},variableLists:{default:()=>[]},cycling:{type:Boolean,default:!0},cyclingSpeed:{default:1e3},showControls:{type:Boolean,default:!1},displayMode:{default:"block"},showLegend:{type:Boolean,default:!1},maxLines:{default:0}},emits:["update:paused","back-to-select"],setup(W,{emit:D}){const s=W,w=D,v=q(0),I=q(!1);let C=null;const r=["variable-highlight-blue","variable-highlight-green","variable-highlight-purple","variable-highlight-orange","variable-highlight-pink","variable-highlight-teal"],y=U(()=>s.template.type==="template"?s.template.template:s.template.type==="spreadsheet"?s.template.promptPattern:""),N=U(()=>{var a;if(s.template.type==="spreadsheet"){const i=s.template,d=s.variableLists.find(f=>f.id===i.datasetId);return(d==null?void 0:d.category)==="tabular"&&((a=d.tabularData)!=null&&a.rows)?d.tabularData.rows.map(f=>{const F={};return Object.keys(f).forEach(m=>{let l=m.replace(/[^a-zA-Z0-9_]/g,"_");/^[a-zA-Z]/.test(l)||(l="col_"+l),l=l.replace(/_+/g,"_").replace(/_+$/,""),F[l]=String(f[m]||"")}),F}):[]}const k=[];if(s.template.variables){for(const[i,d]of Object.entries(s.template.variables))if(d.type==="value"&&d.values)k.push({name:i,values:[...d.values]});else if(d.type==="list"&&d.listId){const f=s.variableLists.find(F=>F.id===d.listId);f&&(f.category==="simple"&&f.values?k.push({name:i,values:[...f.values]}):f.category==="attributed"&&f.items&&k.push({name:i,values:f.items.map(F=>F.value)}))}}if(k.length===0)return[];const J=i=>i.reduce((d,f)=>d.flatMap(F=>f.map(m=>[...F,m])),[[]]),n=k.map(i=>i.values);return J(n).map(i=>{const d={};return k.forEach((f,F)=>{d[f.name]=i[F]}),d})}),V=U(()=>N.value.length),x=U(()=>N.value.length===0?null:N.value[v.value]||N.value[0]),z=U(()=>{const k=y.value;if(!k)return"";const J=x.value;if(!J||Object.keys(J).length===0)return o(k).replace(/\n/g,"<br>");let n=o(k);if(Object.keys(J).sort((a,i)=>i.length-a.length).forEach((a,i)=>{const d=J[a],f=o(d),F=p(i),m=new RegExp(`{{\\s*${S(a)}\\s*}}`,"g");n=n.replace(m,`<span class="${F} variable-value">${f}</span>`)}),n=n.replace(/\n/g,"<br>"),s.maxLines>0){const a=n.split("<br>");a.length>s.maxLines&&(n=a.slice(0,s.maxLines).join("<br>")+'<br><span class="line-clamp-indicator">...</span>')}return n}),A=U(()=>s.displayMode==="inline"&&s.maxLines>0?{display:"-webkit-box","-webkit-line-clamp":s.maxLines,"-webkit-box-orient":"vertical",overflow:"hidden"}:{});function p(k){return r[k%r.length]}function o(k){const J=document.createElement("div");return J.textContent=k,J.innerHTML}function S(k){return k.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function L(){I.value=!I.value,w("update:paused",I.value)}function R(){!s.cycling||I.value||V.value<=1||(C=setInterval(()=>{v.value=(v.value+1)%V.value},s.cyclingSpeed))}function E(){C&&(clearInterval(C),C=null)}return oe(()=>{s.cycling&&!I.value&&R()}),ye(()=>{E()}),G(()=>I.value,k=>{k||!s.cycling?E():R()}),G(()=>s.cycling,k=>{k?I.value||R():(E(),v.value=0)}),G(()=>s.cyclingSpeed,()=>{s.cycling&&!I.value&&(E(),R())}),G(V,()=>{v.value=0}),(k,J)=>{const n=B("a-button"),t=B("a-tag"),a=_e("dompurify-html");return c(),h("div",{class:ne(["template-preview",[`preview-${k.displayMode}`,{"preview-cycling":k.cycling&&!I.value}]])},[k.showControls?(c(),h("div",Ue,[u(n,{type:"link",onClick:J[0]||(J[0]=i=>k.$emit("back-to-select")),class:"back-to-select"},{default:$(()=>[u(P(ce)),J[1]||(J[1]=O(" Back to Select Template "))]),_:1,__:[1]}),e("h3",Fe,g(s.template.name),1),u(n,{onClick:L,size:"small",type:I.value?"default":"primary",disabled:!k.cycling||V.value<=1},{default:$(()=>[O(g(I.value?"Start":"Pause")+" Variable Selection ",1)]),_:1},8,["type","disabled"]),k.cycling&&V.value>1?(c(),h("span",Je,g(v.value+1)+" / "+g(V.value),1)):j("",!0),u(t,{color:s.template.type==="template"?"blue":"green",class:"source-badge"},{default:$(()=>[O(g(s.template.type==="template"?"Prompt Design":"Spreadsheet Design"),1)]),_:1},8,["color"])])):j("",!0),Ce(e("div",{class:"preview-content",style:be(A.value)},null,4),[[a,z.value,"template"]]),k.showLegend&&x.value&&Object.keys(x.value).length>0?(c(),h("div",qe,[(c(!0),h(ee,null,te(x.value,(i,d,f)=>(c(),h("div",{key:d,class:"legend-item"},[e("span",{class:ne(p(f))},g(d),3),e("span",We,g(i),1)]))),128))])):j("",!0)],2)}}}),ie=Z(Ke,[["__scopeId","data-v-1ad1228f"]]),He={class:"design-selection"},Ye={class:"design-selector","data-testid":"template-design-selector"},Ge={key:0,class:"no-designs-state"},Qe={class:"no-designs-content"},Ze={key:1,class:"no-designs-state"},Xe={class:"no-designs-content"},et={key:2,class:"design-list","data-testid":"design-list"},tt=["data-template-id","data-template-name","onClick"],at={class:"design-header"},st={class:"design-title-section"},nt={class:"design-name"},it={key:0,class:"design-inline-description"},ot={class:"design-date"},lt={class:"design-stats"},rt={class:"stat-item"},dt={class:"stat-value"},ut={class:"stat-item"},pt={class:"stat-value"},ct={class:"stat-item"},mt={class:"stat-value"},vt={class:"design-selector","data-testid":"spreadsheet-design-selector"},ft={key:0,class:"no-designs-state"},gt={class:"no-designs-content"},yt={key:1,class:"design-list","data-testid":"design-list"},Ct=["data-spreadsheet-id","data-spreadsheet-name","onClick"],_t={class:"design-header"},bt={class:"design-title-section"},ht={class:"design-name"},kt={key:0,class:"design-inline-description"},$t={class:"design-date"},Tt={class:"design-stats"},wt={class:"stat-item"},It={class:"stat-value"},Pt={class:"stat-item"},St={class:"stat-value"},xt={class:"stat-item"},Dt={class:"stat-value"},Nt=Q({__name:"TrialDesignSelectionV3",props:{templates:{},spreadsheets:{},variableLists:{}},emits:["select","create-template","create-spreadsheet"],setup(W){const D=ke(),s=W,w=q("template"),v=q(""),I=q(""),C=U(()=>{if(!v.value)return s.templates;const p=v.value.toLowerCase();return s.templates.filter(o=>o.name.toLowerCase().includes(p)||(o.description||"").toLowerCase().includes(p))}),r=U(()=>{if(!I.value)return s.spreadsheets;const p=I.value.toLowerCase();return s.spreadsheets.filter(o=>o.name.toLowerCase().includes(p)||(o.description||"").toLowerCase().includes(p))});function y(p){const o=typeof p=="string"?new Date(p):p,L=new Date().getTime()-o.getTime(),R=Math.floor(L/(1e3*60*60*24));if(R===0){const E=Math.floor(L/36e5);if(E===0){const k=Math.floor(L/6e4);return k<=1?"just now":`${k} min ago`}return E===1?"1 hour ago":`${E} hours ago`}else return R===1?"yesterday":R<7?`${R} days ago`:o.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function N(p){return p.variables?Object.keys(p.variables).length:0}function V(p){var S,L;if(!p.variables)return 1;let o=1;for(const[,R]of Object.entries(p.variables))if(R.type==="value"&&R.values)o*=R.values.length;else if(R.type==="list"&&R.listId){const E=s.variableLists.find(k=>k.id===R.listId);E&&(E.category==="simple"?o*=((S=E.values)==null?void 0:S.length)||0:E.category==="attributed"?o*=((L=E.items)==null?void 0:L.length)||0:E.category==="tabular"&&(o*=E.itemCount||0))}return o}function x(p){const o=s.variableLists.find(S=>S.id===p.datasetId);return(o==null?void 0:o.itemCount)||0}function z(p){var S;const o=s.variableLists.find(L=>L.id===p.datasetId);return(o==null?void 0:o.category)==="tabular"&&((S=o.tabularData)!=null&&S.columns)?o.tabularData.columns.length:0}function A(p){if(!p)return"???";try{if("template"in p&&p.template)return`~${D.estimateTokens(p.template)}`;if("promptPattern"in p&&p.promptPattern)return`~${D.estimateTokens(p.promptPattern)}`}catch(o){H.warn("Failed to estimate tokens:",o)}return"???"}return(p,o)=>{const S=B("a-input"),L=B("a-spin"),R=B("a-button"),E=B("a-tag"),k=B("a-tab-pane"),J=B("a-tabs");return c(),h("div",He,[u(J,{activeKey:w.value,"onUpdate:activeKey":o[6]||(o[6]=n=>w.value=n),size:"large"},{default:$(()=>[u(k,{key:"template",tab:"Prompt Designs (one API call per combination)"},{default:$(()=>[e("div",Ye,[u(S,{value:v.value,"onUpdate:value":o[0]||(o[0]=n=>v.value=n),placeholder:"Search prompt designs...",size:"large",class:"design-search","data-testid":"input-template-search",allowClear:""},{prefix:$(()=>[u(P(pe))]),_:1},8,["value"]),!p.templates||p.templates.length===0?(c(),h("div",Ge,[e("div",Qe,[u(L,{size:"large",tip:"Loading templates..."})])])):C.value.length===0?(c(),h("div",Ze,[e("div",Xe,[o[8]||(o[8]=e("p",null,"No prompt designs found",-1)),u(R,{type:"primary",onClick:o[1]||(o[1]=n=>p.$emit("create-template"))},{default:$(()=>[u(P(he)),o[7]||(o[7]=O(" Create Prompt Design "))]),_:1,__:[7]})])])):(c(),h("div",et,[(c(!0),h(ee,null,te(C.value,n=>(c(),h("div",{key:n.id,class:"design-item","data-testid":"template-item","data-template-id":n.id,"data-template-name":n.name,onClick:t=>p.$emit("select",n)},[e("div",at,[e("div",st,[e("h4",nt,[O(g(n.name)+" ",1),n.description?(c(),h("span",it,"- "+g(n.description),1)):j("",!0)])]),e("span",ot,g(y(n.updated)),1)]),u(ie,{template:n,"variable-lists":p.variableLists,cycling:!0,"show-controls":!1,"display-mode":"inline","max-lines":5,class:"design-preview"},null,8,["template","variable-lists"]),e("div",lt,[u(E,{size:"small",color:"blue",class:"output-type-tag"},{default:$(()=>[O(g(n.outputType||"text"),1)]),_:2},1024),e("span",rt,[e("span",dt,g(N(n)),1),o[9]||(o[9]=e("span",{class:"stat-label"},"vars",-1))]),o[12]||(o[12]=e("span",{class:"stat-divider"},"•",-1)),e("span",ut,[e("span",pt,g(V(n)),1),o[10]||(o[10]=e("span",{class:"stat-label"},"combos",-1))]),o[13]||(o[13]=e("span",{class:"stat-divider"},"•",-1)),e("span",ct,[e("span",mt,g(A(n)),1),o[11]||(o[11]=e("span",{class:"stat-label"},"tokens",-1))])])],8,tt))),128)),e("div",{class:"design-item design-item-create","data-testid":"btn-create-design",onClick:o[2]||(o[2]=n=>p.$emit("create-template"))},[u(P(ae),{style:{"font-size":"24px"}}),o[14]||(o[14]=e("span",null,"Create New Design",-1))])]))])]),_:1}),u(k,{key:"spreadsheet",tab:"Spreadsheet Designs (one API call per row)"},{default:$(()=>[e("div",vt,[u(S,{value:I.value,"onUpdate:value":o[3]||(o[3]=n=>I.value=n),placeholder:"Search spreadsheet designs...",size:"large",class:"design-search","data-testid":"input-spreadsheet-search",allowClear:""},{prefix:$(()=>[u(P(pe))]),_:1},8,["value"]),r.value.length===0?(c(),h("div",ft,[e("div",gt,[o[16]||(o[16]=e("p",null,"No spreadsheet designs found",-1)),u(R,{type:"primary",onClick:o[4]||(o[4]=n=>p.$emit("create-spreadsheet"))},{default:$(()=>[u(P(ze)),o[15]||(o[15]=O(" Create Spreadsheet Design "))]),_:1,__:[15]})])])):(c(),h("div",yt,[(c(!0),h(ee,null,te(r.value,n=>(c(),h("div",{key:n.id,class:"design-item","data-testid":"spreadsheet-item","data-spreadsheet-id":n.id,"data-spreadsheet-name":n.name,onClick:t=>p.$emit("select",n)},[e("div",_t,[e("div",bt,[e("h4",ht,[O(g(n.name)+" ",1),n.description?(c(),h("span",kt,"- "+g(n.description),1)):j("",!0)])]),e("span",$t,g(y(n.updated)),1)]),u(ie,{template:n,"variable-lists":p.variableLists,cycling:!0,"show-controls":!1,"display-mode":"inline","max-lines":5,class:"design-preview"},null,8,["template","variable-lists"]),e("div",Tt,[u(E,{size:"small",color:"green",class:"output-type-tag"},{default:$(()=>[O(g(n.outputType||"text"),1)]),_:2},1024),e("span",wt,[e("span",It,g(x(n)),1),o[17]||(o[17]=e("span",{class:"stat-label"},"rows",-1))]),o[20]||(o[20]=e("span",{class:"stat-divider"},"•",-1)),e("span",Pt,[e("span",St,g(z(n)),1),o[18]||(o[18]=e("span",{class:"stat-label"},"cols",-1))]),o[21]||(o[21]=e("span",{class:"stat-divider"},"•",-1)),e("span",xt,[e("span",Dt,g(A(n)),1),o[19]||(o[19]=e("span",{class:"stat-label"},"tokens",-1))])])],8,Ct))),128)),e("div",{class:"design-item design-item-create","data-testid":"btn-create-spreadsheet",onClick:o[5]||(o[5]=n=>p.$emit("create-spreadsheet"))},[u(P(ae),{style:{"font-size":"24px"}}),o[22]||(o[22]=e("span",null,"Create New Spreadsheet Design",-1))])]))])]),_:1})]),_:1},8,["activeKey"])])}}}),Vt=Z(Nt,[["__scopeId","data-v-db101528"]]),Et={class:"trial-metadata-form"},Mt=Q({__name:"TrialMetadataV3",props:{name:{},repeatCount:{default:1},description:{default:""},totalCombinations:{default:0}},emits:["update:name","update:repeatCount","update:description"],setup(W,{emit:D}){const s=W,w=D,v=$e({name:s.name,repeatCount:s.repeatCount,description:s.description||""}),I=U(()=>{if(s.totalCombinations>0&&v.repeatCount>1){const r=s.totalCombinations*v.repeatCount;return`Each prompt will be run ${v.repeatCount} times (${r} total calls)`}return"Number of times to run each prompt"});function C(){w("update:name",v.name),w("update:repeatCount",v.repeatCount),w("update:description",v.description)}return G(()=>s.name,r=>{v.name=r}),G(()=>s.repeatCount,r=>{v.repeatCount=r}),G(()=>s.description,r=>{v.description=r||""}),(r,y)=>{const N=B("a-input"),V=B("a-form-item"),x=B("a-col"),z=B("a-input-number"),A=B("a-row"),p=B("a-textarea"),o=B("a-form");return c(),h("div",Et,[u(o,{layout:"vertical",model:v},{default:$(()=>[u(A,{gutter:24},{default:$(()=>[u(x,{span:18},{default:$(()=>[u(V,{label:"Trial Name",rules:[{required:!0,message:"Please enter a trial name"}]},{default:$(()=>[u(N,{value:v.name,"onUpdate:value":y[0]||(y[0]=S=>v.name=S),size:"large",placeholder:"e.g., GPT-4 Performance Test",onChange:C},null,8,["value"])]),_:1})]),_:1}),u(x,{span:6},{default:$(()=>[u(V,{label:"Repeat Count",help:I.value},{default:$(()=>[u(z,{value:v.repeatCount,"onUpdate:value":y[1]||(y[1]=S=>v.repeatCount=S),min:1,max:100,size:"large",style:{width:"100%"},onChange:C},null,8,["value"])]),_:1},8,["help"])]),_:1})]),_:1}),u(V,{label:"Description (Optional)"},{default:$(()=>[u(p,{value:v.description,"onUpdate:value":y[2]||(y[2]=S=>v.description=S),placeholder:"Add any notes about this trial...",rows:2,onChange:C},null,8,["value"])]),_:1})]),_:1},8,["model"])])}}}),Ot=Z(Mt,[["__scopeId","data-v-b945eb57"]]),At={class:"model-configuration"},Lt={key:0,class:"quick-add-section"},zt={class:"quick-add-models"},Rt={class:"provider-name"},jt={class:"model-name"},Bt={key:0,class:"param-info"},Ut={class:"configuration-table"},Ft={class:"table-header"},Jt={style:{display:"inline-flex","align-items":"center",gap:"0"}},qt={key:0,class:"model-name-cell"},Wt={class:"model-name"},Kt={class:"model-id"},Ht={key:1,class:"parameter-tags"},Yt={key:2,class:"cost-cell"},Gt={class:"cost-value"},Qt={key:0,class:"cost-total"},Zt={key:0,class:"cost-summary"},Xt={class:"cost-summary-item"},ea={class:"cost-summary-item"},ta={class:"total-cost"},aa=Q({__name:"ModelConfigurationV3",props:{configurations:{},totalCombinations:{},repeatCount:{},avgTokens:{default:150}},emits:["add-configuration","remove-configuration"],setup(W,{emit:D}){const s=W,w=D,{models:v}=le(),{trials:I}=re(),{estimateCost:C,formatCost:r}=ve(),y=q(!1),N=U(()=>{var F;const t=new Map;if(I.value&&I.value.length>0){const m=I.value.filter(l=>l.status!=="draft").slice(0,10);for(const l of m)if(l.configurations){for(const _ of l.configurations){const b=JSON.stringify(_.parameters||{}),T=`${_.provider}-${_.modelId}-${b}`;if(t.has(T)||t.set(T,_),t.size>=15)break}if(t.size>=15)break}}const a=new Set(s.configurations.map(m=>{const l=JSON.stringify(m.parameters||{});return`${m.provider}-${m.modelId}-${l}`})),i=Array.from(t.values()).filter(m=>{var T;const l=JSON.stringify(m.parameters||{}),_=`${m.provider}-${m.modelId}-${l}`;if(a.has(_))return!1;const b=(T=v.value)==null?void 0:T.find(M=>M.provider===m.provider&&M.modelId===m.modelId);return!(!b||!b.enabled)}),d=[{provider:"openai-chat",modelId:"gpt-4o-mini",params:{temperature:0,max_completion_tokens:1e3}},{provider:"openai-chat",modelId:"gpt-4.1-nano",params:{temperature:0,max_completion_tokens:500}},{provider:"anthropic",modelId:"claude-3-5-haiku-latest",params:{temperature:0,max_tokens:1e3}},{provider:"openrouter",modelId:"meta-llama/llama-4-maverick",params:{temperature:.8,max_tokens:2e3}},{provider:"openrouter",modelId:"mistralai/mistral-nemo",params:{temperature:.7,max_tokens:1500}},{provider:"ollama-generate",modelId:"qwen2.5:0.5b",params:{temperature:0,num_predict:500,stream:!1}},{provider:"ollama-generate",modelId:"llama3.2:1b",params:{temperature:0,num_predict:1e3,stream:!1}}],f=[];for(const m of d){const l=JSON.stringify(m.params),_=`${m.provider}-${m.modelId}-${l}`;if(!a.has(_)&&!t.has(_)){const b=(F=v.value)==null?void 0:F.find(T=>T.provider===m.provider&&T.modelId===m.modelId);b&&b.enabled&&f.push({provider:m.provider,modelId:m.modelId,parameters:m.params,providerSnapshot:{},modelSnapshot:b})}}return[...i,...f].slice(0,10)}),V=[{title:"Model",key:"name",width:"35%"},{title:"Parameters",key:"parameters",width:"35%"},{title:"Cost",key:"cost",width:"20%"},{title:"",key:"actions",width:"10%"}],x=U(()=>s.configurations.map((t,a)=>({key:`${t.provider}-${t.modelId}-${a}`,...t,costPerCall:p(t)}))),z=U(()=>s.totalCombinations*s.configurations.length*s.repeatCount),A=U(()=>s.configurations.reduce((t,a)=>{const i=p(a);return t+i*s.totalCombinations*s.repeatCount},0));function p(t){var d;const a=(d=v.value)==null?void 0:d.find(f=>f.provider===t.provider&&f.modelId===t.modelId);return a?C(s.avgTokens,a,t.parameters).cost.total.expected:0}function o(t){var d;const a=(d=v.value)==null?void 0:d.find(f=>f.provider===t.provider&&f.modelId===t.modelId);if(!a)return"No pricing data";const i=C(s.avgTokens,a,t.parameters);return r(i,"range")}function S(t){return t===0?"0.00":t<.01?"<0.01":t<1?t.toFixed(2):t<10?t.toFixed(1):Math.round(t).toString()}function L(t){const a={},i=["temperature","max_tokens","max_completion_tokens","num_predict","maxTokens","top_p","top_k","reasoning_effort"];for(const d of i)t[d]!==void 0&&t[d]!==null&&(a[d]=t[d]);for(const[d,f]of Object.entries(t))f!=null&&!i.includes(d)&&(a[d]=f);return a}function R(t){return t.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}function E(t){if(!t||Object.keys(t).length===0)return"";const a=[];return t.temperature!==void 0&&a.push(`T:${t.temperature}`),t.max_tokens!==void 0?a.push(`${t.max_tokens}t`):t.maxTokens!==void 0?a.push(`${t.maxTokens}t`):t.num_predict!==void 0&&a.push(`${t.num_predict}t`),t.top_p!==void 0&&a.push(`p:${t.top_p}`),a.length>0?`(${a.join(", ")})`:""}function k(t){var d,f;const a=we.validateParameters(t.provider,t.modelId,t.parameters||{});if(!a.valid){H.error("Quick Add validation failed:",{provider:t.provider,modelId:t.modelId,parameters:t.parameters,errors:a.errors}),alert(`Cannot add model configuration: ${((d=a.errors)==null?void 0:d.join(", "))||"Invalid parameters"}`);return}const i={name:((f=t.modelSnapshot)==null?void 0:f.displayName)||t.modelId,provider:t.provider,modelId:t.modelId,parameters:{...t.parameters}};w("add-configuration",i)}function J(t){w("add-configuration",t),y.value=!1}function n(t){w("remove-configuration",t)}return(t,a)=>{const i=B("a-button"),d=B("a-tooltip"),f=B("a-tag"),F=B("a-table");return c(),h("div",At,[N.value.length>0?(c(),h("div",Lt,[a[2]||(a[2]=e("h4",null,"Quick Add Recent Models",-1)),e("div",zt,[(c(!0),h(ee,null,te(N.value,m=>{var l;return c(),Y(i,{key:`${m.provider}-${m.modelId}-${JSON.stringify(m.parameters)}`,size:"small",onClick:_=>k(m),class:"quick-add-button",title:`Add ${((l=m.modelSnapshot)==null?void 0:l.displayName)||m.modelId} (${m.provider}) with recent parameters`},{default:$(()=>{var _;return[u(P(ae)),e("span",Rt,g(m.provider)+"/",1),e("span",jt,g(((_=m.modelSnapshot)==null?void 0:_.displayName)||m.modelId),1),E(m.parameters)?(c(),h("span",Bt,g(E(m.parameters)),1)):j("",!0)]}),_:2},1032,["onClick","title"])}),128))])])):j("",!0),e("div",Ut,[e("div",Ft,[e("h3",Jt,[u(d,{placement:"topLeft"},{title:$(()=>a[3]||(a[3]=[O(" Add models to test with your template and configure their parameters like temperature, max tokens, etc. ")])),default:$(()=>[a[4]||(a[4]=e("span",null,"Model Configurations to Test",-1))]),_:1,__:[4]}),a[6]||(a[6]=e("span",null,"  ",-1)),u(i,{type:"primary",size:"small",onClick:a[0]||(a[0]=m=>y.value=!0)},{default:$(()=>[u(P(ae)),a[5]||(a[5]=O(" Add Model "))]),_:1,__:[5]})])]),u(F,{columns:V,"data-source":x.value,pagination:!1,locale:{emptyText:"No models configured. Add at least one model to proceed."},"row-key":"key"},{bodyCell:$(({column:m,record:l,index:_})=>[m.key==="name"?(c(),h("div",qt,[e("span",Wt,g(l.name),1),e("span",Kt,g(l.provider)+":"+g(l.modelId),1)])):m.key==="parameters"?(c(),h("div",Ht,[(c(!0),h(ee,null,te(L(l.parameters),(b,T)=>(c(),Y(f,{key:T},{default:$(()=>[O(g(R(T))+": "+g(b),1)]),_:2},1024))),128))])):m.key==="cost"?(c(),h("div",Yt,[e("span",Gt,g(o(l)),1),a[7]||(a[7]=e("span",{class:"cost-label"},"per call",-1)),t.totalCombinations>1?(c(),h("div",Qt," Total: ~$"+g(S(l.costPerCall*t.totalCombinations*t.repeatCount)),1)):j("",!0)])):m.key==="actions"?(c(),Y(i,{key:3,type:"text",danger:"",size:"small",onClick:b=>n(_)},{default:$(()=>[u(P(Te))]),_:2},1032,["onClick"])):j("",!0)]),_:1},8,["data-source"]),t.configurations.length>0?(c(),h("div",Zt,[e("div",Xt,[a[8]||(a[8]=e("span",null,"Total experiments:",-1)),e("strong",null,g(z.value),1)]),e("div",ea,[a[9]||(a[9]=e("span",null,"Estimated total cost:",-1)),e("strong",ta,"$"+g(S(A.value)),1)])])):j("",!0)]),u(je,{visible:y.value,"onUpdate:visible":a[1]||(a[1]=m=>y.value=m),mode:"trial","trial-context":{totalCombinations:t.totalCombinations,avgTokens:t.avgTokens},"existing-configurations":t.configurations,onAddConfiguration:J},null,8,["visible","trial-context","existing-configurations"])])}}}),sa=Z(aa,[["__scopeId","data-v-4a97f1c0"]]),na={class:"trial-configuration"},ia={class:"configuration-sections"},oa={class:"config-section"},la={class:"config-section"},ra=["aria-expanded"],da={class:"section-title"},ua={class:"expand-hint"},pa={key:0,class:"design-info"},ca={class:"design-stats"},ma={class:"stat"},va={class:"stat-value"},fa={class:"stat"},ga={class:"stat-value"},ya={class:"config-section"},Ca=Q({__name:"TrialConfiguration",setup(W){const D=Ie("trialCreation"),s=q(!1),w=q(!1),v=U(()=>D.selectedPrompt.value),I=U(()=>v.value.type==="template"?150:100);return(C,r)=>{var y;return c(),h("div",na,[e("div",ia,[e("section",oa,[r[6]||(r[6]=e("h2",{class:"section-title"},"Trial Details",-1)),u(Ot,{name:P(D).trialName.value,"repeat-count":P(D).repeatCount.value,description:((y=P(D).description)==null?void 0:y.value)||"","total-combinations":P(D).totalCombinations.value,"onUpdate:name":r[0]||(r[0]=N=>P(D).trialName.value=N),"onUpdate:repeatCount":r[1]||(r[1]=N=>P(D).repeatCount.value=N),"onUpdate:description":r[2]||(r[2]=N=>P(D).description.value=N)},null,8,["name","repeat-count","description","total-combinations"])]),e("section",la,[e("button",{class:"collapsible-header",onClick:r[3]||(r[3]=N=>s.value=!s.value),"aria-expanded":s.value},[u(P(Pe),{class:ne([{expanded:s.value},"expand-icon"])},null,8,["class"]),e("h2",da,[r[7]||(r[7]=O("Selected Design Preview ")),e("span",ua,"(click to "+g(s.value?"collapse":"expand")+")",1)])],8,ra),s.value?(c(),h("div",pa,[u(ie,{template:v.value,"variable-lists":P(D).variableLists.value,cycling:w.value,"show-controls":!0,"display-mode":"block","show-legend":!0,"onUpdate:paused":r[4]||(r[4]=N=>w.value=!N),onBackToSelect:r[5]||(r[5]=N=>C.$emit("back"))},null,8,["template","variable-lists","cycling"]),e("div",ca,[e("div",ma,[r[8]||(r[8]=e("span",{class:"stat-label"},"Total Combinations:",-1)),e("span",va,g(P(D).totalCombinations.value),1)]),e("div",fa,[r[9]||(r[9]=e("span",{class:"stat-label"},"Estimated Tokens:",-1)),e("span",ga,"~"+g(I.value)+" per call",1)])])])):j("",!0)]),e("section",ya,[r[10]||(r[10]=e("h2",{class:"section-title"},"Add Models and Set Parameters",-1)),u(sa,{configurations:P(D).configurations.value,"total-combinations":P(D).totalCombinations.value,"repeat-count":P(D).repeatCount.value,"avg-tokens":I.value,onAddConfiguration:P(D).addConfiguration,onRemoveConfiguration:P(D).removeConfiguration},null,8,["configurations","total-combinations","repeat-count","avg-tokens","onAddConfiguration","onRemoveConfiguration"])])])])}}}),_a=Z(Ca,[["__scopeId","data-v-c95afe8d"]]),ba={class:"trial-submission"},ha={class:"review-section"},ka={class:"summary-card"},$a={class:"summary-item"},Ta={class:"value"},wa={class:"summary-item"},Ia={class:"value"},Pa={class:"summary-item"},Sa={class:"value"},xa={key:0,class:"summary-item"},Da={class:"value"},Na={key:1,class:"summary-item"},Va={class:"value"},Ea={class:"summary-item"},Ma={class:"value"},Oa={key:2,class:"summary-item"},Aa={class:"value"},La={class:"summary-item"},za={class:"value highlight"},Ra={key:3,class:"summary-item"},ja={key:0,class:"value highlight"},Ba={key:1,class:"value"},Ua={class:"configurations-review"},Fa={class:"config-header"},Ja={class:"config-name"},qa={class:"config-model"},Wa={class:"config-params"},Ka={key:0,class:"running-trials-warning"},Ha={class:"action-buttons"},Ya={key:0},Ga={key:1},Qa={key:2},Za=Q({__name:"TrialSubmission",props:{trialConfig:{},design:{}},emits:["back","create-draft","create-and-start","export-python"],setup(W,{emit:D}){const s=W,w=D,{runningTrials:v}=re(),{variableLists:I}=me(),{models:C}=le(),{calculateTemplateTokens:r,estimateCost:y,sumEstimates:N,multiplyEstimate:V}=ve(),x=q(null),z=q(!1),A=q(!1),p=U(()=>v.value.length>0),o=U(()=>v.value.length),S=U(()=>{var d,f,F,m;if(!s.trialConfig.configurations)return 0;let a=1;if(s.design.type==="template"&&s.design.variables)for(const[,l]of Object.entries(s.design.variables)){const _=l;if(_.type==="value"&&_.values)a*=_.values.length;else if(_.type==="list"&&_.listId){const b=(d=I.value)==null?void 0:d.find(T=>T.id===_.listId);b&&(b.category==="simple"?a*=((f=b.values)==null?void 0:f.length)||0:b.category==="attributed"?a*=((F=b.items)==null?void 0:F.length)||0:b.category==="tabular"&&(a*=b.itemCount||0))}}else if(s.design.type==="spreadsheet"){const l=(m=I.value)==null?void 0:m.find(_=>_.id===s.design.datasetId);a=(l==null?void 0:l.itemCount)||0}const i=s.trialConfig.repeatCount||1;return a*s.trialConfig.configurations.length*i}),L=U(()=>{var F,m,l,_,b;if(!s.trialConfig.configurations||s.trialConfig.configurations.length===0)return-1;let a=0;if(s.design.type==="template"){const T=((F=s.trialConfig.templateConfig)==null?void 0:F.template)||s.design.template||"",M=((m=s.trialConfig.templateConfig)==null?void 0:m.variables)||s.design.variables||{};a=r(T,M,I.value)}else if(s.design.type==="spreadsheet"){const T=((l=s.trialConfig.spreadsheetConfig)==null?void 0:l.promptPattern)||s.design.promptPattern||"";a=r(T,{},I.value)}if(a===0)return H.error("TrialSubmission: No prompt content found for cost estimation",{type:s.design.type,hasTemplate:!!((_=s.trialConfig.templateConfig)!=null&&_.template)||!!s.design.template,hasPromptPattern:!!((b=s.trialConfig.spreadsheetConfig)!=null&&b.promptPattern)||!!s.design.promptPattern}),-1;const i=s.trialConfig.configurations.map(T=>{var K;const M=(K=C.value)==null?void 0:K.find(X=>X.provider===T.provider&&X.modelId===T.modelId);return M?y(a,M,T.parameters):null}).filter(Boolean);if(i.length===0)return-1;const d=N(i);return V(d,S.value).cost.total.expected});function R(a){const i=[];"temperature"in a&&i.push(`temperature=${a.temperature}`),"max_tokens"in a&&i.push(`max_tokens=${a.max_tokens}`),"top_p"in a&&i.push(`top_p=${a.top_p}`);const d=Object.keys(a).length-i.length;return d>0&&i.push(`+${d} more`),i.join(", ")}function E(){return{name:s.trialConfig.name||"",description:s.trialConfig.description,type:s.design.type,configurations:s.trialConfig.configurations||[],repeatCount:s.trialConfig.repeatCount||1,templateConfig:s.trialConfig.templateConfig,spreadsheetConfig:s.trialConfig.spreadsheetConfig}}async function k(){x.value="draft";try{const a=E();w("create-draft",a)}finally{x.value=null}}async function J(){z.value=!0;try{const a=E();w("export-python",a)}finally{z.value=!1}}function n(){p.value||L.value>10&&L.value!==-1?A.value=!0:t()}async function t(){A.value=!1,x.value="start";try{const a=E();w("create-and-start",a)}finally{x.value=null}}return(a,i)=>{var m;const d=B("a-button"),f=B("a-alert"),F=B("a-modal");return c(),h("div",ba,[u(d,{type:"link",onClick:i[0]||(i[0]=l=>a.$emit("back")),class:"back-button"},{default:$(()=>[u(P(Se)),i[3]||(i[3]=O(" Back to Configuration "))]),_:1,__:[3]}),e("div",ha,[i[15]||(i[15]=e("h2",null,"Review & Create Trial",-1)),e("div",ka,[i[13]||(i[13]=e("h3",null,"Trial Summary",-1)),e("div",$a,[i[4]||(i[4]=e("span",{class:"label"},"Name:",-1)),e("span",Ta,g(a.trialConfig.name),1)]),e("div",wa,[i[5]||(i[5]=e("span",{class:"label"},"Type:",-1)),e("span",Ia,g(a.design.type==="template"?"Template":"Spreadsheet"),1)]),e("div",Pa,[i[6]||(i[6]=e("span",{class:"label"},"Design:",-1)),e("span",Sa,g(a.design.name),1)]),a.design.type==="template"?(c(),h("div",xa,[i[7]||(i[7]=e("span",{class:"label"},"Variables:",-1)),e("span",Da,g(Object.keys(a.design.variables||{}).length)+" variables configured ",1)])):j("",!0),a.design.type==="spreadsheet"?(c(),h("div",Na,[i[8]||(i[8]=e("span",{class:"label"},"Dataset:",-1)),e("span",Va,g(a.design.rowCount)+" rows",1)])):j("",!0),e("div",Ea,[i[9]||(i[9]=e("span",{class:"label"},"Model Configurations:",-1)),e("span",Ma,g(((m=a.trialConfig.configurations)==null?void 0:m.length)||0)+" models",1)]),a.trialConfig.repeatCount&&a.trialConfig.repeatCount>1?(c(),h("div",Oa,[i[10]||(i[10]=e("span",{class:"label"},"Repeat Count:",-1)),e("span",Aa,g(a.trialConfig.repeatCount)+" times per prompt",1)])):j("",!0),e("div",La,[i[11]||(i[11]=e("span",{class:"label"},"Total API Calls:",-1)),e("span",za,g(S.value),1)]),L.value!==-1?(c(),h("div",Ra,[i[12]||(i[12]=e("span",{class:"label"},"Estimated Cost:",-1)),L.value>0?(c(),h("span",ja,"$"+g(L.value.toFixed(4)),1)):(c(),h("span",Ba,"Unable to estimate (no prompt content)"))])):j("",!0)]),e("div",Ua,[i[14]||(i[14]=e("h3",null,"Model Configurations",-1)),(c(!0),h(ee,null,te(a.trialConfig.configurations,(l,_)=>(c(),h("div",{key:`review-config-${_}`,class:"config-review-item"},[e("div",Fa,[e("span",Ja,g(l.name||l.modelId),1),e("span",qa,g(l.provider)+":"+g(l.modelId),1)]),e("div",Wa,g(R(l.parameters)),1)]))),128))]),p.value?(c(),h("div",Ka,[u(f,{message:"Running Trials Detected",description:`You have ${o.value} trial(s) currently running. Starting a new trial may affect performance.`,type:"warning","show-icon":""},null,8,["description"])])):j("",!0)]),e("div",Ha,[u(d,{size:"large",onClick:k,loading:x.value==="draft"},{default:$(()=>[u(P(fe)),i[16]||(i[16]=O(" Create as Draft "))]),_:1,__:[16]},8,["loading"]),u(d,{size:"large",onClick:J,loading:z.value},{default:$(()=>[u(P(Re)),i[17]||(i[17]=O(" Export to Python "))]),_:1,__:[17]},8,["loading"]),u(d,{type:"primary",size:"large",onClick:n,loading:x.value==="start"},{default:$(()=>[u(P(xe)),i[18]||(i[18]=O(" Create and Start "))]),_:1,__:[18]},8,["loading"])]),u(F,{visible:A.value,"onUpdate:visible":i[1]||(i[1]=l=>A.value=l),title:"Confirm Trial Creation",onOk:t,onCancel:i[2]||(i[2]=l=>A.value=!1)},{default:$(()=>[i[19]||(i[19]=e("p",null,"You are about to create and start a trial with:",-1)),e("ul",null,[e("li",null,g(S.value)+" API calls",1),L.value>0?(c(),h("li",Ya,"Estimated cost: $"+g(L.value.toFixed(4)),1)):L.value===-1?(c(),h("li",Ga,"Cost estimation unavailable")):j("",!0),p.value?(c(),h("li",Qa,g(o.value)+" other trial(s) running",1)):j("",!0)]),i[20]||(i[20]=e("p",null,"Do you want to proceed?",-1))]),_:1,__:[19,20]},8,["visible"])])}}}),Xa=Z(Za,[["__scopeId","data-v-d9a6ff21"]]),es={class:"conflict-content"},ts={class:"warning-section"},as={class:"warning-text"},ss={class:"trial-info"},ns={class:"summary-grid"},is={class:"summary-item"},os={class:"value"},ls={class:"summary-item"},rs={class:"value"},ds={key:0,class:"summary-item"},us={class:"value"},ps={class:"modal-footer"},cs=Q({__name:"TrialConflictModal",props:{visible:{type:Boolean},runningTrial:{},trialConfig:{},totalApiCalls:{},estimatedCost:{}},emits:["update:visible","cancel","create-draft"],setup(W,{emit:D}){const s=W,w=D,v=q(!1);function I(){w("update:visible",!1),w("cancel")}async function C(){if(s.trialConfig){v.value=!0;try{w("create-draft",s.trialConfig),w("update:visible",!1)}finally{v.value=!1}}}return(r,y)=>{const N=B("a-button"),V=B("a-modal");return c(),Y(V,{visible:r.visible,title:"Running Trial Detected",closable:!1,"mask-closable":!1,width:"600px",onCancel:I},{footer:$(()=>[e("div",ps,[u(N,{onClick:I,disabled:v.value},{default:$(()=>y[8]||(y[8]=[O(" Cancel ")])),_:1,__:[8]},8,["disabled"]),u(N,{type:"primary",onClick:C,loading:v.value},{default:$(()=>[u(P(fe)),y[9]||(y[9]=O(" Create Draft "))]),_:1,__:[9]},8,["loading"])])]),default:$(()=>{var x,z;return[e("div",es,[e("div",ts,[u(P(De),{class:"warning-icon"}),e("div",as,[y[2]||(y[2]=e("h3",null,"Another trial is currently running",-1)),e("p",null,[y[0]||(y[0]=O(' The trial "')),e("strong",null,g((x=r.runningTrial)==null?void 0:x.name),1),y[1]||(y[1]=O('" is currently executing. You can only run one trial at a time. '))])])]),y[7]||(y[7]=e("div",{class:"message-section"},[e("p",null,"You can only run one trial at a time. Your new trial will be saved as a draft and you can start it manually after the current trial finishes, or you can pause or cancel the running trial, then start your new draft trial.")],-1)),e("div",ss,[y[6]||(y[6]=e("h4",null,"New Trial Summary:",-1)),e("div",ns,[e("div",is,[y[3]||(y[3]=e("span",{class:"label"},"Name:",-1)),e("span",os,g((z=r.trialConfig)==null?void 0:z.name),1)]),e("div",ls,[y[4]||(y[4]=e("span",{class:"label"},"API Calls:",-1)),e("span",rs,g(r.totalApiCalls),1)]),r.estimatedCost>0?(c(),h("div",ds,[y[5]||(y[5]=e("span",{class:"label"},"Estimated Cost:",-1)),e("span",us,"$"+g(r.estimatedCost.toFixed(4)),1)])):j("",!0)])])])]}),_:1},8,["visible"])}}}),ms=Z(cs,[["__scopeId","data-v-6c2d242e"]]),vs={class:"trial-creation-content"},fs={class:"step-content"},gs={key:1,class:"modal-footer"},ys={key:2,class:"create-actions"},Cs={key:2,class:"view-footer"},_s={key:0,class:"validation-errors"},bs={class:"create-actions"},hs=Q({__name:"TrialCreationContent",props:{mode:{},initialData:{}},emits:["cancel","create-template","create-spreadsheet","created","created-and-started","export-python"],setup(W,{expose:D,emit:s}){const w=W,v=s,I=U(()=>{var n,t;return{type:((n=w.initialData)==null?void 0:n.type)||"create",sourceTrialId:(t=w.initialData)==null?void 0:t.sourceTrialId}}),C=Be(Ne(I));Ve("trialCreation",C);const r=q(0),y=q(!1),N=q(null),V=q(null),x=q(null);D({currentStep:r});const z=U(()=>{if(w.mode==="view")return C.selectedPrompt.value!==null&&C.canProceed.value&&C.configurations.value.length>0;switch(r.value){case 0:return C.selectedPrompt.value!==null;case 1:return C.canProceed.value;default:return!0}}),A=U(()=>{const n=[];return C.selectedPrompt.value||n.push("Select a template or spreadsheet"),C.configurations.value.length===0&&n.push("Add at least one model configuration"),C.trialName.value.trim()===""&&n.push("Enter a trial name"),n.join(" • ")});function p(){var t;const n=JSON.parse(JSON.stringify(C.selectedPrompt.value));return{name:C.trialName.value,description:((t=C.description)==null?void 0:t.value)||"",type:n.type,configurations:JSON.parse(JSON.stringify(C.configurations.value)),repeatCount:C.repeatCount.value,templateConfig:n.type==="template"?{template:n.template,variables:n.variables,outputType:n.outputType,extractPattern:n.extractPattern,refusalWords:n.refusalWords,rejectRefusalWords:n.rejectRefusalWords}:void 0,spreadsheetConfig:n.type==="spreadsheet"?{promptPattern:n.promptPattern,datasetId:n.datasetId}:void 0}}function o(n){C.selectPrompt(n),w.mode==="view"&&(r.value=1)}async function S(){try{const n=await C.createTrialAsDraft();n&&v("created",n)}catch(n){H.error("Failed to create draft trial:",n)}}async function L(){try{const n=await C.createAndStartTrial();n&&(n.needsConfirmation?(N.value=p(),V.value=n.trialId,x.value="runningTrial"in n?n.runningTrial:null,y.value=!0):v("created-and-started",n.trialId))}catch(n){H.error("Failed to create and start trial:",n)}}async function R(){v("export-python",p())}function E(){J()}async function k(){try{V.value&&v("created",V.value),J()}catch(n){H.error("Failed to handle draft creation:",n)}}function J(){y.value=!1,N.value=null,V.value=null,x.value=null}return oe(async()=>{var n,t;if(await C.initialize(),(n=w.initialData)!=null&&n.templateId&&((t=w.initialData)==null?void 0:t.promptSource)==="template"){const a=()=>{const i=C.templates.value.find(d=>{var f;return d.id===((f=w.initialData)==null?void 0:f.templateId)});return i?(C.selectPrompt(i),r.value=1,!0):!1};if(!a()){const i=G(()=>C.templates.value,()=>{a()&&i()},{immediate:!0});setTimeout(()=>i(),3e3)}}}),G(r,()=>{w.mode==="view"&&window.scrollTo(0,0)}),(n,t)=>{const a=B("a-step"),i=B("a-steps"),d=B("a-button");return c(),h("div",vs,[n.mode==="modal"?(c(),Y(i,{key:0,current:r.value,class:"creation-steps"},{default:$(()=>[u(a,{title:"Select Design"}),u(a,{title:"Configure Trial"}),u(a,{title:"Review & Create"})]),_:1},8,["current"])):j("",!0),e("div",fs,[r.value===0?(c(),Y(Vt,{key:0,templates:P(C).templates.value,spreadsheets:P(C).spreadsheets.value,"variable-lists":P(C).variableLists.value,onSelect:o,onCreateTemplate:t[0]||(t[0]=f=>n.$emit("create-template")),onCreateSpreadsheet:t[1]||(t[1]=f=>n.$emit("create-spreadsheet"))},null,8,["templates","spreadsheets","variable-lists"])):r.value===1?(c(),Y(_a,{key:1,onBack:t[2]||(t[2]=f=>r.value--)})):r.value===2?(c(),Y(Xa,{key:2,"trial-config":p(),design:P(C).selectedPrompt.value,onBack:t[3]||(t[3]=f=>r.value--),onCreateDraft:S,onCreateAndStart:L,onExportPython:R},null,8,["trial-config","design"])):j("",!0)]),w.mode==="modal"?(c(),h("div",gs,[u(d,{onClick:t[4]||(t[4]=f=>n.$emit("cancel"))},{default:$(()=>t[8]||(t[8]=[O("Cancel")])),_:1,__:[8]}),r.value>0?(c(),Y(d,{key:0,onClick:t[5]||(t[5]=f=>r.value--)},{default:$(()=>t[9]||(t[9]=[O(" Back ")])),_:1,__:[9]})):j("",!0),r.value<2?(c(),Y(d,{key:1,type:"primary",disabled:!z.value,onClick:t[6]||(t[6]=f=>r.value++)},{default:$(()=>t[10]||(t[10]=[O(" Next ")])),_:1,__:[10]},8,["disabled"])):j("",!0),r.value===2?(c(),h("div",ys,[u(d,{type:"primary",disabled:!z.value,onClick:S},{default:$(()=>t[11]||(t[11]=[O(" Create Draft ")])),_:1,__:[11]},8,["disabled"]),u(d,{type:"primary",disabled:!z.value,onClick:L},{default:$(()=>t[12]||(t[12]=[O(" Create & Start ")])),_:1,__:[12]},8,["disabled"])])):j("",!0)])):j("",!0),w.mode==="view"?(c(),h("div",Cs,[z.value?j("",!0):(c(),h("div",_s,g(A.value),1)),e("div",bs,[u(d,{size:"large",disabled:!z.value,onClick:R},{default:$(()=>t[13]||(t[13]=[O(" Export Python ")])),_:1,__:[13]},8,["disabled"]),u(d,{type:"primary",size:"large",disabled:!z.value,onClick:S},{default:$(()=>t[14]||(t[14]=[O(" Create Draft ")])),_:1,__:[14]},8,["disabled"]),u(d,{type:"primary",size:"large",disabled:!z.value,onClick:L},{default:$(()=>t[15]||(t[15]=[O(" Create & Start ")])),_:1,__:[15]},8,["disabled"])])])):j("",!0),u(ms,{visible:y.value,"onUpdate:visible":t[7]||(t[7]=f=>y.value=f),"running-trial":x.value,"trial-config":N.value,"total-api-calls":P(C).totalExperiments.value,"estimated-cost":P(C).totalCost.value,onCancel:E,onCreateDraft:k},null,8,["visible","running-trial","trial-config","total-api-calls","estimated-cost"])])}}}),ks=Z(hs,[["__scopeId","data-v-483a6718"]]),$s={class:"trial-creation-view"},Ts={class:"creation-header"},ws={class:"header-title"},Is={class:"creation-content"},Ps=Q({__name:"TrialCreationV3",setup(W){const D=Ee(),s=Me(),w=q(),v=q(null);async function I(){const A=D.query;if(A.duplicate){const p=A.duplicate;w.value={type:"duplicate",sourceTrialId:p}}else A.designId&&A.promptSource==="template"&&(w.value={type:"create",templateId:A.designId,promptSource:"template"})}function C(){s.push("/trials")}function r(){v.value&&(v.value.currentStep=0)}async function y(A){se.success("Trial created as draft"),s.push({path:"/trials",query:{trialId:A,tab:"details"}})}async function N(A){se.success("Trial created and started"),s.push({path:"/trials",query:{trialId:A,tab:"tasks"}})}async function V(){se.info("Python export not yet implemented")}function x(){s.push("/templates/new")}function z(){s.push("/spreadsheet")}return oe(()=>{I()}),(A,p)=>{var S;const o=B("a-button");return c(),h("div",$s,[e("div",Ts,[e("div",ws,[p[1]||(p[1]=e("h1",null,"Create New Trial",-1)),((S=v.value)==null?void 0:S.currentStep)===1?(c(),Y(o,{key:0,type:"link",class:"back-button",onClick:r},{default:$(()=>[u(P(ce)),p[0]||(p[0]=O(" Back to Select Template "))]),_:1,__:[0]})):j("",!0)]),u(o,{onClick:C},{default:$(()=>p[2]||(p[2]=[O("Cancel")])),_:1,__:[2]})]),e("div",Is,[u(ks,{ref_key:"creationContentRef",ref:v,mode:"view","initial-data":w.value,onCancel:C,onCreated:y,onCreatedAndStarted:N,onExportPython:V,onCreateTemplate:x,onCreateSpreadsheet:z},null,8,["initial-data"])])])}}}),zs=Z(Ps,[["__scopeId","data-v-38a5dd3b"]]);export{zs as default};
