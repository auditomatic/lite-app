const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-nY7SO6jw.js","assets/index-CTKTabXV.css"])))=>i.map(i=>d[i]);
import{e as i,I as _t,d as P,ao as Fe,r as _,c as G,p as bt,f as ce,u as Ue,a as x,h as b,j as c,i as e,z as j,ab as se,A as f,E as y,F as Y,B as ae,ai as ne,x as C,t as I,v as r,y as $,_ as ve,G as ht,q as ze,ap as Be,V as Ne,an as kt,s as xe,aq as wt,ar as Ct,a3 as Mt,o as Ot,as as $t,M as Pt,at as Dt,au as Le,av as Re,K as At,aw as Et,al as St,N as xt}from"./index-nY7SO6jw.js";import{u as Te}from"./useV4Models-CyTzjl8n.js";import{u as je}from"./useV4ProviderParameters-Cg88Jm7P.js";import{O as Lt}from"./OllamaModelManagerV3-BmgIWjSB.js";import{S as Rt}from"./SaveOutlined-BNdj_gEu.js";import{detectOllamaIssue as Vt}from"./ollama-fetch-Cm4u9WF2.js";import{U as Ft}from"./UnorderedListOutlined-C7K1fnPN.js";import"./useV4LiveQuery-DCvW8B3Q.js";import"./FilterOutlined-Cq6iPCPj.js";var Ut={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};function Ve(A){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?Object(arguments[n]):{},l=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(o).filter(function(p){return Object.getOwnPropertyDescriptor(o,p).enumerable}))),l.forEach(function(p){zt(A,p,o[p])})}return A}function zt(A,n,o){return n in A?Object.defineProperty(A,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):A[n]=o,A}var be=function(n,o){var l=Ve({},n,o.attrs);return i(_t,Ve({},l,{icon:Ut}),null)};be.displayName="UploadOutlined";be.inheritAttrs=!1;class Bt{async bulkWrite(n,o,l="put"){o.length!==0&&await P.transaction("rw",P[n],async()=>{switch(l){case"put":await P[n].bulkPut(o);break;case"add":await P[n].bulkAdd(o);break;case"update":const p=o.map(k=>P[n].update(k.id,k));await Promise.all(p);break}})}async bulkDelete(n,o){o.length!==0&&await P.transaction("rw",P[n],async()=>{await P[n].bulkDelete(o)})}async conditionalBulkUpdate(n,o,l){let p=0;return await P.transaction("rw",P[n],async()=>{await P[n].toCollection().modify(k=>{o(k)&&(Object.assign(k,l),p++)})}),p}freezeDeep(n){const o=n.map(l=>Object.freeze(l));return Object.freeze(o)}async getAndFreeze(n,o){const l=await P[n].get(o);return l?Object.freeze(l):null}async getAllAndFreeze(n){const o=await P[n].toArray();return this.freezeDeep(o)}}const ue=new Bt;class Nt{async bulkUpsertModels(n){n.length!==0&&await P.transaction("rw",P.models,async()=>{const o=n.map(l=>Object.freeze({...l,enabled:l.enabled??!1,available:l.available??!0}));await P.models.bulkPut(o)})}async clearProviderModels(n){return await P.transaction("rw",P.models,async()=>{const p=(await P.models.where("provider").equals(n).toArray()).map(k=>k.id);return p.length>0&&await P.models.bulkDelete(p),p.length})}async toggleModelEnabled(n,o){return await P.models.update(n,{enabled:o})===1}async toggleProviderModels(n,o){return await ue.conditionalBulkUpdate("models",l=>l.provider===n,{enabled:o})}async toggleAllModels(n){return await ue.conditionalBulkUpdate("models",()=>!0,{enabled:n})}async getModelStatistics(){const n=await P.models.toArray(),o={total:n.length,enabled:0,byProvider:{}};for(const l of n)l.enabled&&o.enabled++,o.byProvider[l.provider]||(o.byProvider[l.provider]={total:0,enabled:0}),o.byProvider[l.provider].total++,l.enabled&&o.byProvider[l.provider].enabled++;return Object.freeze(o)}async updateModelAvailability(n,o){return await ue.conditionalBulkUpdate("models",l=>l.provider===n,{available:o})}async searchModels(n){let o=P.models.toCollection();if(n.provider&&(o=P.models.where("provider").equals(n.provider)),n.enabled!==void 0&&(o=o.and(p=>p.enabled===n.enabled)),n.available!==void 0&&(o=o.and(p=>p.available===n.available)),n.search){const p=n.search.toLowerCase();o=o.and(k=>k.displayName.toLowerCase().includes(p)||k.modelId.toLowerCase().includes(p))}const l=await o.toArray();return ue.freezeDeep(l)}async clearAllModels(){await P.models.clear()}}const Tt=new Nt;function jt(){const A=Fe(),n=_(!1),o=_(null),l=_(!1),p=_(!1);async function k(g,v){n.value=!0,v&&(v.value=!0),o.value=null;try{return{ok:!0,value:await g()}}catch(s){const E=s instanceof Error?s:new Error(String(s));return o.value=E,{ok:!1,error:E}}finally{n.value=!1,v&&(v.value=!1)}}async function N(g){return k(()=>A.discoverModels(g),l)}async function V(g){return k(()=>A.refreshModelSource(g),l)}async function S(g,v){return k(async()=>{await A.toggleModel(g,v)},p)}async function w(g){return k(async()=>{await A.toggleAllModels(g)},p)}async function d(g,v){return k(async()=>{await A.toggleProviderModels(g,v)},p)}async function F(){return k(async()=>{await A.enableOpenRouterFavorites()},p)}async function D(){return k(async()=>{await A.clearAllModels()})}async function u(g,v){return k(async()=>{await Tt.updateModelAvailability(g,v)})}return{discoverModels:N,refreshDiscoverySource:V,toggleModel:S,toggleAllModels:w,toggleProviderModels:d,enableOpenRouterFavorites:F,clearAllModels:D,updateModelAvailability:u,isExecuting:n,lastError:o,isDiscovering:l,isTogglingModels:p}}function Ge(){const A=Fe(),n=_([]),o=_(!1),l=_([]);function p(){const V=A.getDiscoveryStatus();n.value=V.map(S=>({id:S.id,status:S.status==="loading"?"loading":S.status==="idle"?"success":S.status,modelCount:S.modelCount,error:S.error})),o.value=A.isDiscovering(),l.value=A.getDiscoveryErrors()}function k(V){return{litellm:"LiteLLM",openrouter:"OpenRouter",ollama:"Ollama",deterministic:"Deterministic"}[V]||V}function N(V){const S=bt.getProvider(V);return(S==null?void 0:S.name)||V}return p(),{discoveryStatus:G(()=>n.value),isDiscovering:G(()=>o.value),discoveryErrors:G(()=>l.value),getSourceDisplayName:k,getProviderDisplayName:N,refreshStatus:p}}const Gt={class:"model-list"},It={class:"model-header"},Kt={class:"model-table"},Wt=["onClick"],qt={class:"model-name"},Ht={class:"model-source"},Jt={class:"model-context"},Qt={key:0},Xt={key:1,class:"text-secondary"},Yt={key:0,class:"model-cost-in"},Zt={key:0,class:"cost-value"},es={key:1,class:"text-secondary"},ts={key:1,class:"model-cost-out"},ss={key:0,class:"cost-value"},as={key:1,class:"text-secondary"},os={class:"model-enviro-carbon"},ls={class:"enviro-value"},ns={class:"model-enviro-water"},rs={class:"enviro-value"},is={class:"model-enviro-energy"},ds={class:"enviro-value"},us=ce({__name:"ModelListV3",props:{models:{},providerId:{}},emits:["toggle-model"],setup(A){const n=A,o=Ue(),l=_("name"),p=_("asc"),k=G(()=>{if(!n.models||n.models.length===0)return[];const w=n.models.filter(D=>{var u,g;return((u=D.capabilities)==null?void 0:u.inputCostPerToken)||((g=D.capabilities)==null?void 0:g.outputCostPerToken)});return w.length>0?x.info("MODEL_LIST_DEBUG: Models with pricing:",w.map(D=>{var u,g;return{id:D.id,provider:D.provider,modelId:D.modelId,inputCost:(u=D.capabilities)==null?void 0:u.inputCostPerToken,outputCost:(g=D.capabilities)==null?void 0:g.outputCostPerToken}})):x.info("MODEL_LIST_DEBUG: No models have pricing data. Sample model:",n.models[0]),[...n.models].sort((D,u)=>{var v,s,E,U,K,W;let g=0;switch(l.value){case"enabled":g=(D.enabled?1:0)-(u.enabled?1:0);break;case"name":g=D.displayName.localeCompare(u.displayName);break;case"source":g=(D.source||"").localeCompare(u.source||"");break;case"context":const J=((v=D.capabilities)==null?void 0:v.contextWindow)||0,q=((s=u.capabilities)==null?void 0:s.contextWindow)||0;g=J-q;break;case"inputCost":const B=((E=D.capabilities)==null?void 0:E.inputCostPerToken)||0,L=((U=u.capabilities)==null?void 0:U.inputCostPerToken)||0;g=B-L;break;case"outputCost":const Q=((K=D.capabilities)==null?void 0:K.outputCostPerToken)||0,ee=((W=u.capabilities)==null?void 0:W.outputCostPerToken)||0;g=Q-ee;break}return p.value==="asc"?g:-g})});function N(w){l.value===w?p.value=p.value==="asc"?"desc":"asc":(l.value=w,p.value="asc")}function V(w){return w>=1e6?(w/1e6).toFixed(1)+"M":w>=1e3?(w/1e3).toFixed(0)+"K":w.toString()}function S(w){if(!w||w===0)return"0.00";const d=w*1e6;return d<.01?d.toFixed(4):d<1?d.toFixed(3):d<10?d.toFixed(2):d<100?d.toFixed(1):d.toFixed(0)}return(w,d)=>{const F=C("a-switch"),D=C("a-tag");return c(),b("div",Gt,[e("div",It,[e("div",{class:"header-switch sortable",onClick:d[0]||(d[0]=u=>N("enabled"))},[d[7]||(d[7]=e("span",null,"Enabled",-1)),e("span",{class:se(["sort-indicator",{active:l.value==="enabled"}])},f(l.value==="enabled"&&p.value==="asc"?"â–²":"â–¼"),3)]),e("div",{class:"header-name sortable",onClick:d[1]||(d[1]=u=>N("name"))},[d[8]||(d[8]=e("span",null,"Model",-1)),e("span",{class:se(["sort-indicator",{active:l.value==="name"}])},f(l.value==="name"&&p.value==="asc"?"â–²":"â–¼"),3)]),e("div",{class:"header-source sortable",onClick:d[2]||(d[2]=u=>N("source"))},[d[9]||(d[9]=e("span",null,"Source",-1)),e("span",{class:se(["sort-indicator",{active:l.value==="source"}])},f(l.value==="source"&&p.value==="asc"?"â–²":"â–¼"),3)]),e("div",{class:"header-context sortable",onClick:d[3]||(d[3]=u=>N("context"))},[d[10]||(d[10]=e("span",null,"Context",-1)),e("span",{class:se(["sort-indicator",{active:l.value==="context"}])},f(l.value==="context"&&p.value==="asc"?"â–²":"â–¼"),3)]),y(o).showFinancialCosts.value?(c(),b("div",{key:0,class:"header-cost-in sortable",onClick:d[4]||(d[4]=u=>N("inputCost"))},[d[11]||(d[11]=e("span",null,"Input $/1M",-1)),e("span",{class:se(["sort-indicator",{active:l.value==="inputCost"}])},f(l.value==="inputCost"&&p.value==="asc"?"â–²":"â–¼"),3)])):j("",!0),y(o).showFinancialCosts.value?(c(),b("div",{key:1,class:"header-cost-out sortable",onClick:d[5]||(d[5]=u=>N("outputCost"))},[d[12]||(d[12]=e("span",null,"Output $/1M",-1)),e("span",{class:se(["sort-indicator",{active:l.value==="outputCost"}])},f(l.value==="outputCost"&&p.value==="asc"?"â–²":"â–¼"),3)])):j("",!0),d[13]||(d[13]=e("div",{class:"header-enviro-carbon"},[e("span",null,"COâ‚‚")],-1)),d[14]||(d[14]=e("div",{class:"header-enviro-water"},[e("span",null,"ðŸ’§")],-1)),d[15]||(d[15]=e("div",{class:"header-enviro-energy"},[e("span",null,"âš¡")],-1))]),e("div",Kt,[(c(!0),b(Y,null,ae(k.value,u=>{var g,v,s;return c(),b("div",{key:u.id,class:"model-row",onClick:E=>w.$emit("toggle-model",u.id,!u.enabled)},[e("div",{class:"model-switch",onClick:d[6]||(d[6]=ne(()=>{},["stop"]))},[i(F,{checked:u.enabled,size:"small",onChange:E=>w.$emit("toggle-model",u.id,E),"data-testid":"model-toggle","data-provider":u.provider,"data-model":u.modelId,"aria-label":`${u.enabled?"Disable":"Enable"} model ${u.modelId}`},null,8,["checked","onChange","data-provider","data-model","aria-label"])]),e("div",qt,[e("code",null,f(u.modelId),1)]),e("div",Ht,[u.source?(c(),I(D,{key:0,size:"small",color:"cyan"},{default:r(()=>[$(f(u.source),1)]),_:2},1024)):j("",!0)]),e("div",Jt,[(g=u.capabilities)!=null&&g.contextWindow?(c(),b("span",Qt,f(V(u.capabilities.contextWindow)),1)):(c(),b("span",Xt,"-"))]),y(o).showFinancialCosts.value?(c(),b("div",Yt,[(v=u.capabilities)!=null&&v.inputCostPerToken?(c(),b("span",Zt," $"+f(S(u.capabilities.inputCostPerToken)),1)):(c(),b("span",es,"-"))])):j("",!0),y(o).showFinancialCosts.value?(c(),b("div",ts,[(s=u.capabilities)!=null&&s.outputCostPerToken?(c(),b("span",ss," $"+f(S(u.capabilities.outputCostPerToken)),1)):(c(),b("span",as,"-"))])):j("",!0),e("div",os,[e("span",ls,f(y(o).getEnvironmentalCost(u,"carbon")),1)]),e("div",ns,[e("span",rs,f(y(o).getEnvironmentalCost(u,"water")),1)]),e("div",is,[e("span",ds,f(y(o).getEnvironmentalCost(u,"energy")),1)])],8,Wt)}),128))])])}}}),cs=ve(us,[["__scopeId","data-v-2b840b1b"]]),vs={class:"model-preference-manager"},ps={class:"preferences-section"},ms={class:"action-group"},fs={class:"action-group"},gs={class:"status-grid"},ys={class:"status-item"},_s={class:"status-value"},bs={class:"status-item"},hs={class:"status-value"},ks={class:"status-item"},ws={class:"status-value"},Cs={class:"status-item"},Ms={class:"status-value"},Os={class:"status-item"},$s={class:"status-value"},Ps={class:"status-item"},Ds={class:"status-value"},As={class:"action-group"},Es={class:"provider-grid"},Ss={class:"provider-name"},xs={class:"provider-stats"},Ls={class:"provider-total"},Rs={class:"provider-enabled"},Vs=ce({__name:"ModelPreferenceManagerV3",setup(A){const{models:n,enabledModels:o,modelsByProvider:l,showFinancialCosts:p,showEnvironmentalCosts:k}=Te(),{discoveryStatus:N}=Ge(),V=Ue(),S=_([]),w=_(!1),d=_(!1),F=_(""),D=_("");async function u(){w.value=!0,F.value="";try{const v=await V.exportModelPreferences();if(v.ok){const s=new Blob([JSON.stringify(v.value,null,2)],{type:"application/json"}),E=URL.createObjectURL(s),U=document.createElement("a");U.href=E,U.download=`model-preferences-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(E),D.value="Model preferences exported successfully!"}else F.value=v.error.message}catch(v){F.value=`Failed to export preferences: ${v instanceof Error?v.message:"Unknown error"}`}finally{w.value=!1}}async function g(v){d.value=!0,F.value="";try{const s=await v.text(),E=JSON.parse(s),U=await V.importModelPreferences(E);U.ok?D.value="Model preferences imported successfully!":F.value=U.error.message}catch(s){s instanceof SyntaxError?F.value="Invalid JSON file format":F.value=`Failed to import preferences: ${s instanceof Error?s.message:"Unknown error"}`}finally{d.value=!1}return!1}return(v,s)=>{const E=C("a-button"),U=C("a-upload"),K=C("a-space"),W=C("a-divider"),J=C("a-alert"),q=C("a-collapse-panel"),B=C("a-collapse");return c(),b("div",vs,[i(B,{activeKey:S.value,"onUpdate:activeKey":s[2]||(s[2]=L=>S.value=L),bordered:!1,class:"preferences-collapse"},{default:r(()=>[i(q,{key:"preferences"},{header:r(()=>s[3]||(s[3]=[e("div",{class:"preferences-header"},[e("strong",null,"ðŸ”§ V3 Enhanced Features"),e("span",{class:"preferences-description"},"Advanced model preference management")],-1)])),default:r(()=>{var L,Q,ee;return[e("div",ps,[e("div",ms,[s[6]||(s[6]=e("h5",{class:"action-title"},"Model Preferences",-1)),s[7]||(s[7]=e("p",{class:"action-description"}," Export and import your model enabled/disabled preferences for backup or sharing. ",-1)),i(K,null,{default:r(()=>[i(E,{onClick:u,loading:w.value,type:"primary"},{icon:r(()=>[i(y(ht))]),default:r(()=>[s[4]||(s[4]=$(" Export Preferences "))]),_:1,__:[4]},8,["loading"]),i(U,{"before-upload":g,"show-upload-list":!1,accept:".json"},{default:r(()=>[i(E,{loading:d.value},{icon:r(()=>[i(y(be))]),default:r(()=>[s[5]||(s[5]=$(" Import Preferences "))]),_:1,__:[5]},8,["loading"])]),_:1})]),_:1})]),i(W),e("div",fs,[s[14]||(s[14]=e("h5",{class:"action-title"},"V3 System Information",-1)),s[15]||(s[15]=e("p",{class:"action-description"}," Enhanced V3 backend capabilities and status. ",-1)),e("div",gs,[e("div",ys,[s[8]||(s[8]=e("span",{class:"status-label"},"Total Models:",-1)),e("span",_s,f(((L=y(n))==null?void 0:L.length)||0),1)]),e("div",bs,[s[9]||(s[9]=e("span",{class:"status-label"},"Enabled Models:",-1)),e("span",hs,f(((Q=y(o))==null?void 0:Q.length)||0),1)]),e("div",ks,[s[10]||(s[10]=e("span",{class:"status-label"},"Active Providers:",-1)),e("span",ws,f(Object.keys(y(l)||{}).length),1)]),e("div",Cs,[s[11]||(s[11]=e("span",{class:"status-label"},"Discovery Sources:",-1)),e("span",Ms,f(((ee=y(N))==null?void 0:ee.length)||0),1)]),e("div",Os,[s[12]||(s[12]=e("span",{class:"status-label"},"Cost Display:",-1)),e("span",$s,f(y(p)?"Enabled":"Disabled"),1)]),e("div",Ps,[s[13]||(s[13]=e("span",{class:"status-label"},"Environmental Display:",-1)),e("span",Ds,f(y(k)?"Enabled":"Disabled"),1)])])]),i(W),e("div",As,[s[16]||(s[16]=e("h5",{class:"action-title"},"Provider Status",-1)),s[17]||(s[17]=e("p",{class:"action-description"}," Real-time provider status and model counts. ",-1)),e("div",Es,[(c(!0),b(Y,null,ae(y(l),(M,X)=>(c(),b("div",{key:X,class:"provider-item"},[e("div",Ss,f(y(V).getProviderDisplayName(X)),1),e("div",xs,[e("span",Ls,f(M.length)+" total",1),e("span",Rs,f(M.filter(re=>re.enabled).length)+" enabled",1)])]))),128))])])]),F.value?(c(),I(J,{key:0,type:"error",message:F.value,closable:"",onClose:s[0]||(s[0]=M=>F.value=""),class:"error-alert"},null,8,["message"])):j("",!0),D.value?(c(),I(J,{key:1,type:"success",message:D.value,closable:"",onClose:s[1]||(s[1]=M=>D.value=""),class:"success-alert"},null,8,["message"])):j("",!0)]}),_:1})]),_:1},8,["activeKey"])])}}}),Fs=ve(Vs,[["__scopeId","data-v-65aaac20"]]),Us={key:0,class:"loading-state"},zs={key:1,class:"error-state"},Bs={class:"error-message"},Ns=["onClick"],Ts={class:"list-header"},js={class:"list-info"},Gs={class:"list-name"},Is={class:"list-meta"},Ks={class:"list-actions"},Ws={class:"list-description"},qs={class:"list-preview"},Hs={key:0,class:"more-models"},Js=ce({__name:"ModelListsDropdownV3",props:{currentModels:{},isLoading:{type:Boolean,default:!1}},emits:["apply-list","close"],setup(A,{emit:n}){const o=A,l=n,{getProviderGroup:p}=je(),k=_([]),N=_(!0),V=_(""),S=_(!1),w=_("");ze(async()=>{try{N.value=!0,V.value="";const{getModelListManager:v}=await Be(async()=>{const{getModelListManager:U}=await import("./index-nY7SO6jw.js").then(K=>K.b6);return{getModelListManager:U}},__vite__mapDeps([0,1])),E=await v().getLists();k.value=E.filter(U=>["openrouter-favorites","cost-efficient","high-performance"].includes(U.id)),x.info("Model lists loaded:",{lists:k.value.length})}catch(v){x.error("Failed to load model lists:",v),V.value="Failed to load model lists"}finally{N.value=!1}});function d(v){return o.currentModels.some(s=>s.modelId!==v.modelId?!1:v.provider?s.provider===v.provider&&s.enabled:v.providerGroup?p(s.provider)===v.providerGroup&&s.enabled:!1)}function F(v){return v.models.slice(0,3)}function D(v){return v.modelId.replace(/^.*\//,"").replace(/-instruct$/,"").replace(/-preview$/,"")}async function u(v){if(!(S.value||o.isLoading))try{S.value=!0,w.value=v,await new Promise((s,E)=>{l("apply-list",v),setTimeout(()=>{s()},2e3)})}catch(s){x.error("Failed to apply list:",s)}finally{S.value=!1,w.value=""}}function g(v){var s;(s=v.domEvent)==null||s.stopPropagation()}return(v,s)=>{const E=C("a-spin"),U=C("a-button"),K=C("a-menu-item"),W=C("a-menu-divider"),J=C("a-tag"),q=C("a-menu");return c(),I(q,{class:"model-lists-menu",onClick:g},{default:r(()=>[N.value?(c(),b("div",Us,[i(E,{size:"small"}),s[0]||(s[0]=e("span",null,"Loading model lists...",-1))])):V.value?(c(),b("div",zs,[e("span",Bs,f(V.value),1)])):(c(),b(Y,{key:2},[s[6]||(s[6]=e("div",{class:"menu-header"},[e("span",null,"Built-in Lists")],-1)),(c(!0),b(Y,null,ae(k.value,B=>(c(),I(K,{key:B.id,class:"list-menu-item"},{default:r(()=>[e("div",{class:"list-item",onClick:L=>u(B.id)},[e("div",Ts,[e("div",js,[e("span",Gs,f(B.name),1),e("span",Is,f(B.models.length)+" models",1)]),e("div",Ks,[i(U,{type:"primary",size:"small",loading:S.value&&w.value===B.id,onClick:ne(L=>u(B.id),["stop"])},{default:r(()=>s[1]||(s[1]=[$(" Apply ")])),_:2,__:[1]},1032,["loading","onClick"])])]),e("div",Ws,f(B.description),1),e("div",qs,[(c(!0),b(Y,null,ae(F(B),(L,Q)=>(c(),b("span",{key:`${L.provider||L.providerGroup}-${L.modelId}`,class:se(["preview-model",{enabled:d(L)}])},f(D(L))+f(Q<F(B).length-1?", ":""),3))),128)),B.models.length>3?(c(),b("span",Hs," +"+f(B.models.length-3)+" more ",1)):j("",!0)])],8,Ns)]),_:2},1024))),128)),i(W),i(K,{disabled:"",class:"future-feature"},{default:r(()=>[i(y(Rt)),s[3]||(s[3]=e("span",null,"Save Current Selection...",-1)),i(J,{color:"blue",size:"small"},{default:r(()=>s[2]||(s[2]=[$("Soon")])),_:1,__:[2]})]),_:1,__:[3]}),i(K,{disabled:"",class:"future-feature"},{default:r(()=>[i(y(Ne)),s[5]||(s[5]=e("span",null,"Manage Lists...",-1)),i(J,{color:"blue",size:"small"},{default:r(()=>s[4]||(s[4]=[$("Soon")])),_:1,__:[4]})]),_:1,__:[5]})],64))]),_:1})}}}),Qs=ve(Js,[["__scopeId","data-v-e613a393"]]),Xs={class:"models-view","data-testid":"page-models"},Ys={class:"page-header"},Zs={key:3,class:"discovery-status-bar"},ea={class:"source-name"},ta=["onClick","data-testid","aria-label"],sa={class:"search-filter-bar"},aa={class:"control-bar"},oa={class:"left-controls"},la={class:"dropdown-item"},na={class:"dropdown-item"},ra={class:"stats"},ia={class:"provider-header"},da={class:"provider-info"},ua={key:1,class:"provider-summary"},ca=ce({__name:"ModelsViewV3",setup(A){const n=xt(),{models:o,modelsByProvider:l,stats:p}=Te(),{getProviderGroup:k,requiresApiKey:N}=je(),{hasApiKey:V}=kt(),{discoverModels:S,refreshDiscoverySource:w,toggleModel:d,toggleAllModels:F,toggleProviderModels:D,clearAllModels:u,isDiscovering:g,isTogglingModels:v}=jt(),{discoveryStatus:s,getSourceDisplayName:E,getProviderDisplayName:U,refreshStatus:K}=Ge(),W=_(""),J=_(""),q=_("all"),B=_(!1),L=_({hideOpenRouterFree:!1,hideOpenRouterAuto:!1}),Q=G(()=>{const a={};return Object.keys(l.value||{}).forEach(t=>{const m=k(t),R=N(t),z=V(m);a[t]={hasKey:z,providerGroup:m,requiresKey:R}}),a}),ee=_(!1),M=_(""),X=_([]),re=_(null),he=_([]),Ie=_(!1),ie=_(null),pe=_(!1);let me=null;const Ke=a=>{me&&clearTimeout(me),me=setTimeout(()=>{J.value=a},300)},fe=G(()=>{const a={};for(const[t,m]of Object.entries(l.value))a[t]=m.filter(R=>R.enabled).length;return a}),te=_([]),de=G(()=>{const a=J.value.toLowerCase(),t={},m=Object.keys(l.value);if(te.value.length===0||m.some(R=>!te.value.includes(R))){const R=te.value.filter(O=>m.includes(O)),z=m.filter(O=>!te.value.includes(O)).sort();te.value=[...R,...z]}for(const R of te.value){const z=l.value[R];if(!z)continue;let O=[...z];a&&(O=O.filter(Z=>Z.displayName.toLowerCase().includes(a)||Z.modelId.toLowerCase().includes(a)||R.toLowerCase().includes(a))),q.value==="enabled"?O=O.filter(Z=>Z.enabled):q.value==="disabled"&&(O=O.filter(Z=>!Z.enabled)),O.length>0&&(t[R]=O)}return t}),We=G(()=>{const a=p.value.total;return x.info("ModelsViewV3 V4 totalCount:",a),a}),qe=G(()=>p.value.enabled),He=G(()=>{var a;return((a=l.value.openrouter)==null?void 0:a.length)>0}),Je=G(()=>W.value?`No models found matching "${W.value}"`:q.value!=="all"?`No ${q.value} models found`:'No models available. Click "Refresh Models" to discover models.'),ge=G(()=>{if(!M.value)return!1;const a=M.value.toLowerCase();return a.includes("ollama")&&(a.includes("failed to fetch")||a.includes("networkerror when attempting to fetch"))&&!a.includes("litellm")&&!a.includes("openrouter")}),Qe=G(()=>{var m,R;const a=((m=l.value["ollama-chat"])==null?void 0:m.length)>0||((R=l.value["ollama-generate"])==null?void 0:R.length)>0,t=s.value.some(z=>z.id==="ollama");return a||t||ge.value});G(()=>!!l.value.openrouter);const ye=G(()=>{const a=te.value.length;return X.value.length===a&&a>0}),Xe=xe(wt),Ye=xe(Ct);function Ze(a){return{idle:"default",loading:"processing",success:"success",error:"error"}[a]||"default"}function et(a){return fe.value[a]||0}function tt(a){const t=et(a),m=(l.value[a]||[]).length;return t===0?"default":t===m?"success":"warning"}function st(a){const t=de.value[a]||[];return t.length>0&&t.every(m=>m.enabled)}function at(a){const t=de.value[a]||[];return t.length>0&&t.every(m=>!m.enabled)}function ot(a){n.push({path:"/settings",query:a?{provider:a}:void 0})}function lt(){ye.value?X.value=[]:X.value=[...te.value]}async function nt(a,t){const m=await d(a,t);m.ok||(M.value=m.error.message)}async function ke(a,t){const m=await D(a,t);m.ok||(M.value=m.error.message)}async function rt(){const a=await F(!0);a.ok||(M.value=a.error.message)}async function it(){const a=await F(!1);a.ok||(M.value=a.error.message)}async function _e(){B.value=!0,M.value="";try{x.info("V4 DEBUG: Starting discovery...");const a=await S({forceRefresh:!0});if(x.info("V4 DEBUG: Discovery result:",a),a.ok){x.info("V4 DEBUG: Discovery successful, models found:",a.value.totalModels),x.info("V4 DEBUG: After discovery, models.value.length =",o.value.length);const t=a.value.errors.filter(m=>!(m.includes("ollama")&&m.includes("not detected")));t.length>0&&(M.value=`Some sources failed: ${t.join("; ")}`)}else x.info("V4 DEBUG: Discovery failed:",a.error),M.value=`Discovery failed: ${a.error.message}`;K()}catch(a){x.error("Failed to refresh models",a),M.value="Failed to refresh models. Please check your connection and try again."}finally{B.value=!1}}async function dt(a){var t,m,R,z;re.value=a,M.value="";try{const O=await w(a);a==="ollama"&&(((m=(t=O.value)==null?void 0:t.errors)==null?void 0:m.some(oe=>oe.includes("not detected")))||((z=(R=O.error)==null?void 0:R.message)==null?void 0:z.includes("not detected")))||(O.ok&&O.value.errors.length>0?M.value=`Failed to refresh ${E(a)}: ${O.value.errors.join("; ")}`:O.ok||(M.value=`Failed to refresh ${E(a)}: ${O.error.message}`)),K()}catch(O){x.error("Failed to retry source",O,{sourceId:a}),M.value=`Failed to refresh ${E(a)}: ${O instanceof Error?O.message:"Unknown error"}`}finally{re.value=null}}async function ut(){try{await w("ollama"),K(),Ce()}catch(a){x.error("Failed to refresh Ollama models after update",a)}}async function we(){x.info("[ModelsView] Saving OpenRouter settings:",L.value),await P.settings.get("main")?(x.info("[ModelsView] Updating existing settings"),await P.settings.update("main",{hideOpenRouterFree:L.value.hideOpenRouterFree,hideOpenRouterAuto:L.value.hideOpenRouterAuto})):(x.info("[ModelsView] Creating new settings"),await P.settings.add({id:"main",version:1,initialized:!0,hideOpenRouterFree:L.value.hideOpenRouterFree,hideOpenRouterAuto:L.value.hideOpenRouterAuto}));const t=await P.settings.get("main");x.info("[ModelsView] Settings after save:",t)}async function Ce(){try{(await Vt()).hasIssue?ie.value="not-detected":ie.value=null}catch{}}async function ct(){if(confirm("This will remove all models and re-discover them from scratch. Any custom model configurations will be lost. Continue?")){ee.value=!0,M.value="";try{const t=await u();if(!t.ok){M.value=t.error.message;return}const m=await S({forceRefresh:!0});if(m.ok&&m.value.errors.length>0){const R=m.value.errors.filter(z=>!(z.includes("ollama")&&z.includes("not detected")));R.length>0&&(M.value=`Some sources failed: ${R.join("; ")}`)}else m.ok||(M.value=`Discovery failed: ${m.error.message}`);K()}catch(t){x.error("Failed to clear and refresh models",t),M.value="Failed to clear and refresh models. Please check your connection and try again."}finally{ee.value=!1}}}async function vt(a){try{x.info("Applying model list:",a);const{getModelListManager:t}=await Be(async()=>{const{getModelListManager:z}=await import("./index-nY7SO6jw.js").then(O=>O.b6);return{getModelListManager:z}},__vite__mapDeps([0,1])),R=await t().applyList(a);x.info("Model list applied:",R),await _e()}catch(t){x.error("Failed to apply model list:",t),M.value=`Failed to apply model list: ${t instanceof Error?t.message:"Unknown error"}`}}Mt(()=>{Ke(W.value)});const H=G(()=>v.value);return ze(async()=>{x.info("V4 DEBUG: models.value.length =",o.value.length),x.info("V4 DEBUG: models.value =",o.value),x.info("V4 DEBUG: modelsByProvider.value =",l.value);const a=await P.settings.get("main");a&&(L.value={hideOpenRouterFree:a.hideOpenRouterFree??!1,hideOpenRouterAuto:a.hideOpenRouterAuto??!1}),o.value.length===0&&(x.info("V4 DEBUG: No models found, refreshing..."),_e()),X.value=[],Ce()}),Ot(()=>{W.value="",X.value=[],M.value=""}),(a,t)=>{const m=C("a-button"),R=C("a-space"),z=C("a-alert"),O=C("a-tag"),Z=C("a-input-search"),oe=C("a-radio-button"),pt=C("a-radio-group"),mt=C("a-divider"),Me=C("a-dropdown"),Oe=C("a-checkbox"),$e=C("a-menu-item"),ft=C("a-menu"),gt=C("a-tooltip"),Pe=C("a-collapse-panel"),De=C("a-collapse"),yt=C("a-empty");return c(),b("div",Xs,[e("div",Ys,[t[13]||(t[13]=e("div",{class:"header-content"},[e("h1",null,"Model Management"),e("p",{class:"description"},"Configure and enable LLM models for testing")],-1)),i(R,null,{default:r(()=>[i(m,{type:"primary",onClick:_e,loading:B.value||y(g),"data-testid":"btn-refresh-models","aria-label":"Refresh available models"},{icon:r(()=>[i(y($t))]),default:r(()=>[t[11]||(t[11]=$(" Refresh Models "))]),_:1,__:[11]},8,["loading"]),i(m,{danger:"",onClick:ct,loading:ee.value,"data-testid":"btn-clear-refresh-models","aria-label":"Clear all models and refresh"},{icon:r(()=>[i(y(Pt))]),default:r(()=>[t[12]||(t[12]=$(" Clear and Refresh Models "))]),_:1,__:[12]},8,["loading"])]),_:1})]),M.value&&!ge.value?(c(),I(z,{key:0,type:"error",message:M.value,closable:"",onClose:t[0]||(t[0]=h=>M.value=""),class:"error-alert"},null,8,["message"])):j("",!0),ge.value?(c(),I(z,{key:1,type:"info",closable:"",onClose:t[1]||(t[1]=h=>M.value=""),class:"ollama-info-alert"},{message:r(()=>t[14]||(t[14]=[e("div",{class:"ollama-message"},[$(" Ollama is not running on this computer. To audit local LLMs, install "),e("a",{href:"https://ollama.com",target:"_blank",rel:"noopener noreferrer"},"Ollama"),$(". ")],-1)])),_:1})):j("",!0),ie.value?(c(),I(z,{key:2,type:"info",closable:"",onClose:t[2]||(t[2]=h=>ie.value=null),class:"ollama-cors-alert"},{message:r(()=>t[15]||(t[15]=[e("div",{class:"ollama-cors-message"},[e("strong",null,"Ollama not detected: "),e("a",{href:"https://ollama.com",target:"_blank",rel:"noopener noreferrer"},"Ollama"),$(" is an external program for running LLMs on your computer. If Ollama is installed, you must "),e("a",{href:"https://objectgraph.com/blog/ollama-cors/",target:"_blank",rel:"noopener noreferrer"},"configure CORS"),$(' by setting OLLAMA_ORIGINS to "*" or "auditomatic.org". If you do not wish to use Ollama, close and ignore this message. ')],-1)])),_:1})):j("",!0),y(s).length>0?(c(),b("div",Zs,[t[16]||(t[16]=e("span",{class:"status-label"},"Sources:",-1)),(c(!0),b(Y,null,ae(y(s),h=>(c(),b("div",{key:h.id,class:"source-status-compact"},[e("span",ea,f(y(E)(h.id)),1),i(O,{color:Ze(h.status),size:"small"},{default:r(()=>[h.status==="success"&&h.modelCount?(c(),b(Y,{key:0},[$(f(h.modelCount),1)],64)):h.status==="error"?(c(),b("span",{key:1,onClick:T=>dt(h.id),style:{cursor:"pointer"},"data-testid":`retry-source-${h.id}`,"aria-label":`Retry loading models from ${y(E)(h.id)}`},"âŸ³ retry",8,ta)):(c(),b(Y,{key:2},[$(f(h.status),1)],64))]),_:2},1032,["color"])]))),128))])):j("",!0),e("div",sa,[i(Z,{value:W.value,"onUpdate:value":t[3]||(t[3]=h=>W.value=h),placeholder:"Search models by name, provider, or ID...","allow-clear":"",size:"large",class:"search-input","data-testid":"input-model-search","aria-label":"Search models",loading:W.value!==J.value},null,8,["value","loading"]),i(pt,{value:q.value,"onUpdate:value":t[4]||(t[4]=h=>q.value=h),"button-style":"solid",size:"large"},{default:r(()=>[i(oe,{value:"all"},{default:r(()=>t[17]||(t[17]=[$("All")])),_:1,__:[17]}),i(oe,{value:"enabled"},{default:r(()=>t[18]||(t[18]=[$("Enabled")])),_:1,__:[18]}),i(oe,{value:"disabled"},{default:r(()=>t[19]||(t[19]=[$("Disabled")])),_:1,__:[19]})]),_:1},8,["value"])]),e("div",aa,[e("div",oa,[i(m,{type:"text",size:"small",onClick:lt},{icon:r(()=>[(c(),I(Dt(ye.value?Ye.value:Xe.value)))]),default:r(()=>[$(" "+f(ye.value?"Collapse All":"Expand All"),1)]),_:1}),i(mt,{type:"vertical"}),i(m,{type:"text",size:"small",onClick:rt,loading:H.value,disabled:H.value},{icon:r(()=>[i(y(Le))]),default:r(()=>[t[20]||(t[20]=$(" Enable All "))]),_:1,__:[20]},8,["loading","disabled"]),i(m,{type:"text",size:"small",onClick:it,loading:H.value,disabled:H.value},{icon:r(()=>[i(y(Re))]),default:r(()=>[t[21]||(t[21]=$(" Disable All "))]),_:1,__:[21]},8,["loading","disabled"]),i(Me,{open:pe.value,"onUpdate:open":t[6]||(t[6]=h=>pe.value=h),placement:"bottomLeft",disabled:H.value},{overlay:r(()=>[i(Qs,{"current-models":Array.from(y(o)),"is-loading":H.value,onApplyList:vt,onClose:t[5]||(t[5]=h=>pe.value=!1)},null,8,["current-models","is-loading"])]),default:r(()=>[i(m,{type:"text",size:"small",loading:H.value,disabled:H.value},{icon:r(()=>[i(y(Ft))]),default:r(()=>[t[22]||(t[22]=$(" Model Lists ")),i(y(At))]),_:1,__:[22]},8,["loading","disabled"])]),_:1},8,["open","disabled"]),He.value?(c(),I(Me,{key:0},{overlay:r(()=>[i(ft,null,{default:r(()=>[i($e,{key:"privacy"},{default:r(()=>[e("div",la,[i(Oe,{checked:L.value.hideOpenRouterFree,"onUpdate:checked":t[7]||(t[7]=h=>L.value.hideOpenRouterFree=h),onChange:we},{default:r(()=>t[23]||(t[23]=[$(" Hide free models (privacy concerns) ")])),_:1,__:[23]},8,["checked"])])]),_:1}),i($e,{key:"auto"},{default:r(()=>[e("div",na,[i(Oe,{checked:L.value.hideOpenRouterAuto,"onUpdate:checked":t[8]||(t[8]=h=>L.value.hideOpenRouterAuto=h),onChange:we},{default:r(()=>t[24]||(t[24]=[$(" Hide Auto Router (unpredictable costs) ")])),_:1,__:[24]},8,["checked"])])]),_:1})]),_:1})]),default:r(()=>[i(m,{type:"text",size:"small"},{icon:r(()=>[i(y(Ne))]),default:r(()=>[t[25]||(t[25]=$(" OpenRouter Settings "))]),_:1,__:[25]})]),_:1})):j("",!0)]),e("div",ra,[e("span",null,f(qe.value)+" of "+f(We.value)+" models enabled",1)])]),i(De,{activeKey:X.value,"onUpdate:activeKey":t[9]||(t[9]=h=>X.value=h),bordered:!1,class:"provider-collapse",destroyInactivePanel:!1},{default:r(()=>[(c(!0),b(Y,null,ae(de.value,(h,T)=>(c(),I(Pe,{key:`provider-${T}`},{header:r(()=>{var Ae,Ee;return[e("div",ia,[e("div",da,[e("strong",null,f(y(U)(T)),1),(Ae=Q.value[T])!=null&&Ae.requiresKey&&!((Ee=Q.value[T])!=null&&Ee.hasKey)?(c(),I(gt,{key:0,placement:"top"},{title:r(()=>{var le;return[$(" API key not set for "+f((le=Q.value[T])==null?void 0:le.providerGroup)+". Click to add in settings. ",1)]}),default:r(()=>[i(m,{type:"link",danger:"",size:"small",onClick:ne(le=>{var Se;return ot((Se=Q.value[T])==null?void 0:Se.providerGroup)},["stop"])},{icon:r(()=>[i(y(St))]),default:r(()=>[t[26]||(t[26]=$(" API Key Missing "))]),_:2,__:[26]},1032,["onClick"])]),_:2},1024)):j("",!0),X.value.includes(T)?(c(),b(Y,{key:2},[i(O,{size:"small",color:"blue"},{default:r(()=>[$(f(h.length)+" models",1)]),_:2},1024),i(O,{size:"small",color:tt(T)},{default:r(()=>[$(f(fe.value[T]||0)+" enabled ",1)]),_:2},1032,["color"])],64)):(c(),b("span",ua,f(fe.value[T]||0)+" / "+f((y(l)[T]||[]).length)+" enabled ",1))]),i(R,{size:"small"},{default:r(()=>[i(m,{type:"text",size:"small",onClick:ne(le=>ke(T,!0),["stop"]),disabled:st(T)||H.value,loading:H.value},{icon:r(()=>[i(y(Le))]),default:r(()=>[t[27]||(t[27]=$(" Enable All "))]),_:2,__:[27]},1032,["onClick","disabled","loading"]),i(m,{type:"text",size:"small",onClick:ne(le=>ke(T,!1),["stop"]),disabled:at(T)||H.value,loading:H.value},{icon:r(()=>[i(y(Re))]),default:r(()=>[t[28]||(t[28]=$(" Disable All "))]),_:2,__:[28]},1032,["onClick","disabled","loading"])]),_:2},1024)])]}),default:r(()=>[(c(),I(Et,null,[i(cs,{models:h,"provider-id":T,onToggleModel:nt},null,8,["models","provider-id"])],1024))]),_:2},1024))),128))]),_:1},8,["activeKey"]),Object.keys(de.value).length===0?(c(),I(yt,{key:4,description:Je.value,class:"empty-state"},null,8,["description"])):j("",!0),Qe.value?(c(),I(De,{key:5,activeKey:he.value,"onUpdate:activeKey":t[10]||(t[10]=h=>he.value=h),bordered:!1,class:"ollama-manager-collapse"},{default:r(()=>[i(Pe,{key:"ollama"},{header:r(()=>t[29]||(t[29]=[e("div",{class:"ollama-header"},[e("strong",null,"Ollama Model Management"),e("span",{class:"ollama-description"},"Download and manage local Ollama models")],-1)])),default:r(()=>[i(Lt,{onModelsUpdated:ut})]),_:1})]),_:1},8,["activeKey"])):j("",!0),Ie.value?(c(),I(Fs,{key:6,class:"enhanced-features"})):j("",!0)])}}}),ka=ve(ca,[["__scopeId","data-v-7de48652"]]);export{ka as default};
