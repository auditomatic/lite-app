var e=Object.defineProperty,t=(t,a,s)=>((t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s)(t,"symbol"!=typeof a?a+"":a,s);import{d as a,r as s,j as n,b as l,e as r,f as i,g as o,q as u,m as c,U as d,s as p,F as m,D as v,t as g,V as f,W as b,w as y,i as h,B as _,X as x,o as k,p as w,k as $,n as S,u as V,I as E}from"./vendor-DdqHZeTC.js";import{D,_ as j,u as C,a as I}from"./index-DIrm_-GH.js";import{u as A}from"./variableLists-BqJwWkuy.js";import{t as N,V as T}from"./VariableResolutionService-C2fssTba.js";import{s as O}from"./safeJson-BfKuju6h.js";import"./db-ftwlfnxb.js";import"./apiLogger-wE3EW76_.js";const L=class e{constructor(){t(this,"schemas",new Map)}static getInstance(){return e.instance||(e.instance=new e,e.instance.initializeSchemas()),e.instance}initializeSchemas(){this.registerSchema("design",{required:["name","prompt_template"],rules:[{field:"name",type:"string",min:1,max:200,message:"Name must be 1-200 characters"},{field:"prompt_template",type:"string",min:1,message:"Prompt template is required"},{field:"description",type:"string",max:1e3,message:"Description must be under 1000 characters"},{field:"variable_list_refs",type:"array",message:"Variable list refs must be an array"},{field:"compound_variables",type:"array",message:"Compound variables must be an array"},{field:"tags",type:"array",message:"Tags must be an array"},{field:"prompt_template",type:"custom",customValidator:e=>this.validatePromptTemplate(e),message:"Prompt template contains invalid variable syntax"}]}),this.registerSchema("run",{required:["design_id","name","models"],rules:[{field:"design_id",type:"string",min:1,message:"Design ID is required"},{field:"name",type:"string",min:1,max:200,message:"Name must be 1-200 characters"},{field:"models",type:"array",min:1,message:"At least one model is required"},{field:"status",type:"string",message:"Status must be a string"},{field:"status",type:"custom",customValidator:e=>["pending","running","completed","failed","cancelled"].includes(e),message:"Status must be one of: pending, running, completed, failed, cancelled"},{field:"models",type:"custom",customValidator:this.validateModelArray.bind(this),message:"Models array contains invalid entries"}]}),this.registerSchema("task",{required:["run_id","model","prompt"],rules:[{field:"run_id",type:"string",min:1,message:"Run ID is required"},{field:"model",type:"string",min:1,message:"Model is required"},{field:"prompt",type:"string",min:1,message:"Prompt is required"},{field:"status",type:"string",message:"Status must be a string"},{field:"status",type:"custom",customValidator:e=>["pending","running","completed","failed"].includes(e),message:"Status must be one of: pending, running, completed, failed"},{field:"usage",type:"custom",customValidator:this.validateTokenUsage.bind(this),message:"Token usage object is invalid"}]}),this.registerSchema("variable_list",{required:["name","values"],rules:[{field:"name",type:"string",min:1,max:200,message:"Name must be 1-200 characters"},{field:"values",type:"array",min:1,message:"At least one value is required"},{field:"description",type:"string",max:1e3,message:"Description must be under 1000 characters"},{field:"attribution",type:"string",max:500,message:"Attribution must be under 500 characters"},{field:"values",type:"custom",customValidator:this.validateVariableValues.bind(this),message:"Variable values contain invalid entries"}]}),this.registerSchema("model",{required:["id","provider","name"],rules:[{field:"id",type:"string",min:1,message:"Model ID is required"},{field:"provider",type:"string",min:1,message:"Provider is required"},{field:"name",type:"string",min:1,message:"Model name is required"},{field:"enabled",type:"boolean",message:"Enabled must be a boolean"},{field:"context_length",type:"number",min:1,message:"Context length must be positive"},{field:"input_cost",type:"number",min:0,message:"Input cost must be non-negative"},{field:"output_cost",type:"number",min:0,message:"Output cost must be non-negative"}]}),this.registerSchema("provider",{required:["id","name","base_url"],rules:[{field:"id",type:"string",min:1,message:"Provider ID is required"},{field:"name",type:"string",min:1,message:"Provider name is required"},{field:"base_url",type:"url",message:"Base URL must be a valid URL"},{field:"timeout",type:"number",min:1e3,max:3e5,message:"Timeout must be 1-300 seconds"},{field:"rate_limit",type:"number",min:1,message:"Rate limit must be positive"}]})}registerSchema(e,t){this.schemas.set(e,t)}async validateEntity(e,t,a={}){const s=this.schemas.get(e);if(!s)return{valid:!1,errors:[{field:"_schema",value:e,message:`No schema found for entity type: ${e}`,type:"error"}],warnings:[]};const n=[],l=[],r={...t};if(s.required)for(const i of s.required)i in t&&void 0!==t[i]&&null!==t[i]&&""!==t[i]||n.push({field:i,value:t[i],message:`${i} is required`,type:"error"});for(const i of s.rules){const e=t[i.field],s=this.validateField(i,e);s.error&&n.push({field:i.field,value:e,message:s.error,type:"error"}),s.warning&&l.push({field:i.field,value:e,message:s.warning,type:"warning"}),a.coerceTypes&&void 0!==s.coercedValue&&(r[i.field]=s.coercedValue)}if(!a.allowExtraFields){const e=new Set([...s.required||[],...s.optional||[],...s.rules.map(e=>e.field)]);for(const s in t)e.has(s)||(a.stripExtraFields?(delete r[s],l.push({field:s,value:t[s],message:`Extra field '${s}' was stripped`,type:"warning"})):l.push({field:s,value:t[s],message:`Extra field '${s}' is not allowed`,type:"warning"}))}return{valid:0===n.length,errors:n,warnings:l,data:r}}validateField(e,t){if(null==t)return{};switch(e.type){case"required":if(""===t||null==t)return{error:e.message||`${e.field} is required`};break;case"string":if("string"!=typeof t)return{error:e.message||`${e.field} must be a string`};if(void 0!==e.min&&t.length<e.min)return{error:e.message||`${e.field} must be at least ${e.min} characters`};if(void 0!==e.max&&t.length>e.max)return{error:e.message||`${e.field} must be at most ${e.max} characters`};if(e.pattern&&!e.pattern.test(t))return{error:e.message||`${e.field} does not match required pattern`};break;case"number":const a="string"==typeof t?parseFloat(t):t;return isNaN(a)||"number"!=typeof a?{error:e.message||`${e.field} must be a number`}:void 0!==e.min&&a<e.min?{error:e.message||`${e.field} must be at least ${e.min}`}:void 0!==e.max&&a>e.max?{error:e.message||`${e.field} must be at most ${e.max}`}:{coercedValue:a};case"boolean":if("boolean"!=typeof t)return"true"===t||"false"===t?{coercedValue:"true"===t}:{error:e.message||`${e.field} must be a boolean`};break;case"array":if(!Array.isArray(t))return{error:e.message||`${e.field} must be an array`};if(void 0!==e.min&&t.length<e.min)return{error:e.message||`${e.field} must have at least ${e.min} items`};if(void 0!==e.max&&t.length>e.max)return{error:e.message||`${e.field} must have at most ${e.max} items`};break;case"object":if("object"!=typeof t||Array.isArray(t))return{error:e.message||`${e.field} must be an object`};break;case"email":if("string"!=typeof t||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return{error:e.message||`${e.field} must be a valid email address`};break;case"url":try{new URL(t)}catch{return{error:e.message||`${e.field} must be a valid URL`}}break;case"custom":if(e.customValidator){const a=e.customValidator(t);if(!1===a)return{error:e.message||`${e.field} failed custom validation`};if("string"==typeof a)return{error:a}}}return{}}validatePromptTemplate(e){if("string"!=typeof e)return"Prompt template must be a string";if((e.match(/\{\{/g)||[]).length!==(e.match(/\}\}/g)||[]).length)return"Unmatched template braces in prompt template";const t=/\{\{([^}]+)\}\}/g,a=[];let s;for(;null!==(s=t.exec(e));){const e=s[1].trim();/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(e)||a.push(e)}return!(a.length>0)||`Invalid variable names: ${a.join(", ")}`}validateModelArray(e){if(!Array.isArray(e))return"Models must be an array";if(0===e.length)return"At least one model is required";for(const t of e)if("string"!=typeof t||""===t.trim())return"All models must be non-empty strings";return!0}validateTokenUsage(e){if(!e)return!0;if("object"!=typeof e)return"Token usage must be an object";const t=["prompt_tokens","completion_tokens","total_tokens"];for(const a of t)if(!(a in e)||"number"!=typeof e[a]||e[a]<0)return`Token usage.${a} must be a non-negative number`;return e.total_tokens===e.prompt_tokens+e.completion_tokens||"Token usage total_tokens must equal prompt_tokens + completion_tokens"}validateVariableValues(e){if(!Array.isArray(e))return"Variable values must be an array";if(0===e.length)return"At least one variable value is required";for(let t=0;t<e.length;t++){const a=e[t];if("string"!=typeof a||""===a.trim())return`Variable value at index ${t} must be a non-empty string`}return new Set(e).size===e.length||"Variable values must be unique"}async validateMultiple(e,t={}){return await Promise.all(e.map(e=>this.validateEntity(e.type,e.data,t)))}getSchema(e){return this.schemas.get(e)}listSchemas(){return Array.from(this.schemas.keys())}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}isValidUrl(e){try{return new URL(e),!0}catch{return!1}}sanitizeString(e,t=1e3){return e.trim().substring(0,t)}};t(L,"instance");let U=L;U.getInstance();const R=class e{constructor(){t(this,"dbService"),t(this,"validationService"),this.dbService=D.getInstance(),this.validationService=U.getInstance()}static getInstance(){return e.instance||(e.instance=new e),e.instance}async importDesigns(e,t={}){const a={success:!1,designs:[],errors:[],warnings:[],converted:0};try{let n=[];if(Array.isArray(e))n=e;else{if(!e||"object"!=typeof e)return a.errors.push("Invalid import data format"),a;n=[e]}for(let e=0;e<n.length;e++){const l=n[e];try{if(t.convertTemplateFormat&&l.prompt_template){const t=l.prompt_template;l.prompt_template=this.convertTemplateFormat(t),l.prompt_template!==t&&(a.converted++,a.warnings.push(`Converted template format for design "${l.name||`#${e+1}`}"`))}if(l.variables&&"object"==typeof l.variables&&(l.variables=this.normalizeVariableFormat(l.variables)),!t.allowDuplicateNames){const e=await this.dbService.findAll("designs");if(e.success&&e.data){const t=new Set(e.data.map(e=>e.name));t.has(l.name)&&(l.name=await this.generateUniqueName(l.name,t),a.warnings.push(`Renamed design to avoid duplicate: ${l.name}`))}}if(!t.skipValidation){const t=await this.validationService.validateEntity("design",l);if(!t.valid){a.errors.push(`Design #${e+1}: ${t.errors.map(e=>e.message).join(", ")}`);continue}}const s=await this.dbService.create("designs",l);s.success&&s.data?a.designs.push(s.data):a.errors.push(`Failed to create design #${e+1}: ${s.error}`)}catch(s){a.errors.push(`Error processing design #${e+1}: ${s instanceof Error?s.message:"Unknown error"}`)}}return a.success=a.designs.length>0,a}catch(s){return a.errors.push(`Import failed: ${s instanceof Error?s.message:"Unknown error"}`),a}}async exportDesigns(e,t={}){try{const a=[];for(const t of e){const e=await this.dbService.read("designs",t);e.success&&e.data&&a.push(e.data)}if(0===a.length)return{success:!1,error:"No designs found to export"};const s=t.format||"json",n=(new Date).toISOString().slice(0,19).replace(/[:-]/g,"");if("json"===s){const e={exported_at:(new Date).toISOString(),version:"1.0",designs:a.map(e=>this.sanitizeDesignForExport(e,t))};return{success:!0,data:JSON.stringify(e,null,2),filename:`designs_export_${n}.json`}}if("csv"===s){return{success:!0,data:this.convertToCSV(a,t),filename:`designs_export_${n}.csv`}}return{success:!1,error:`Unsupported export format: ${s}`}}catch(a){return{success:!1,error:`Export failed: ${a instanceof Error?a.message:"Unknown error"}`}}}convertTemplateFormat(e){return e.replace(/\{([^{}\s]+)\}/g,"{{$1}}")}normalizeVariableFormat(e){const t={};for(const[a,s]of Object.entries(e))Array.isArray(s)?t[a]=s.map(e=>String(e)):t[a]="string"==typeof s?s.split(",").map(e=>e.trim()).filter(e=>e.length>0):[String(s)];return t}async generateUniqueName(e,t){let a=1,s=`${e} (${a})`;for(;t.has(s);)a++,s=`${e} (${a})`;return s}sanitizeDesignForExport(e,t){const{includeRuns:a=!1}=t;return{name:e.name,description:e.description,prompt_template:e.prompt_template,variables:e.variables,variable_list_refs:e.variable_list_refs,created_at:e.created_at,updated_at:e.updated_at}}convertToCSV(e,t){const a=[["name","description","prompt_template","variables","created_at"].join(",")];for(const s of e){const e=[this.escapeCsvValue(s.name||""),this.escapeCsvValue(s.description||""),this.escapeCsvValue(s.prompt_template||""),this.escapeCsvValue(JSON.stringify(s.variables||{})),this.escapeCsvValue(s.created_at||"")];a.push(e.join(","))}return a.join("\n")}escapeCsvValue(e){return e.includes(",")||e.includes('"')||e.includes("\n")?`"${e.replace(/"/g,'""')}"`:e}};t(R,"instance");let q=R;const P={class:"tag-input"},F={class:"tag-container"},J={class:"tag-text"},M=["aria-label","onClick"],z=["placeholder","onKeydown"],B={key:0,class:"helper-text"},G=j(a({__name:"TagInput",props:{modelValue:{},placeholder:{},helperText:{},allowDuplicates:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,h=t,_=s(),x=s(""),k=s(null);function w(){const e=x.value.trim();if(e){if(!a.allowDuplicates&&a.modelValue.includes(e)){const t=a.modelValue.indexOf(e),s=document.querySelectorAll(".tag");return s[t]?.classList.add("tag-flash"),k.value&&clearTimeout(k.value),k.value=window.setTimeout(()=>{s[t]?.classList.remove("tag-flash")},300),void(x.value="")}h("update:modelValue",[...a.modelValue,e]),x.value=""}}function $(e){const t=[...a.modelValue];t.splice(e,1),h("update:modelValue",t)}function S(){""===x.value&&a.modelValue.length>0&&$(a.modelValue.length-1)}function V(e){e.preventDefault();const t=e.clipboardData?.getData("text");if(!t)return;const s=t.split(/[\n,\t]+/).map(e=>e.trim()).filter(e=>e),n=a.allowDuplicates?[...a.modelValue,...s]:[...a.modelValue,...s.filter(e=>!a.modelValue.includes(e))];h("update:modelValue",n)}return n(()=>{k.value&&clearTimeout(k.value)}),(e,t)=>(r(),l("div",P,[i("div",F,[u(d,{name:"tag-list",tag:"div",class:"tags"},{default:p(()=>[(r(!0),l(m,null,v(e.modelValue,(e,t)=>(r(),l("div",{key:`${e}-${t}`,class:"tag"},[i("span",J,g(e),1),i("button",{type:"button",class:"tag-remove","aria-label":`Remove ${e}`,onClick:e=>$(t)}," × ",8,M)]))),128))]),_:1}),c(i("input",{ref_key:"inputRef",ref:_,"onUpdate:modelValue":t[0]||(t[0]=e=>x.value=e),placeholder:e.placeholder,class:"tag-input-field",onKeydown:[b(y(w,["prevent"]),["enter"]),b(S,["backspace"])],onPaste:V},null,40,z),[[f,x.value]])]),e.helperText?(r(),l("div",B,g(e.helperText),1)):o("",!0)]))}}),[["__scopeId","data-v-f7f8d7d3"]]),W={class:"regex-builder"},Z={class:"regex-header"},Y={class:"header-controls"},K={key:0,class:"regex-presets"},X={class:"preset-grid"},H=["onClick"],Q={class:"preset-name"},ee={class:"preset-pattern"},te={class:"regex-input-group"},ae={key:0,class:"simple-mode"},se={key:1,class:"advanced-mode"},ne={class:"advanced-field"},le={class:"advanced-field"},re=["disabled"],ie={key:1,class:"regex-error"},oe={class:"regex-test-section"},ue={key:2,class:"test-results"},ce={class:"match-list"},de={class:"match-label"},pe={class:"match-value"},me={key:3,class:"api-test-section"},ve={class:"api-test-controls"},ge=["value"],fe=["disabled"],be={key:0,class:"api-result"},ye={class:"api-response"},he={class:"api-extracted"},_e=j(a({__name:"RegexBuilder",props:{modelValue:{},promptTemplate:{},showApiTest:{type:Boolean},variables:{},variableListRefs:{}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,n=t,u=C(),d=s("object"==typeof a.modelValue),p=s("object"==typeof a.modelValue?a.modelValue.match:a.modelValue||""),b=s("object"==typeof a.modelValue&&a.modelValue.replace||""),y=s(""),k=s([]),w=s(""),$=s(!1),S=s(""),V=s(!1),E=s(null),D=h(()=>(d.value,p.value)),j=h(()=>u.models.filter(e=>e.enabled)),I=[{name:"Simple Answer",pattern:"(?:Answer|Response|Result)\\s*[:\\s]\\s*(.+?)(?:\\n|$)",description:'Extracts text after "Answer:", "Response:", or "Result:"'},{name:"Score/Rating Answer",pattern:"(?:Score|Rating)\\s*[:\\s]\\s*(\\d+(?:\\.\\d+)?)",description:"Extracts numeric scores or ratings"},{name:"First Number",pattern:"\\b(\\d+(?:\\.\\d+)?)\\b",description:"Extracts the first number (integer or decimal)"},{name:"Last Number",pattern:".*\\b(\\d+(?:\\.\\d+)?)\\b(?!.*\\b\\d+(?:\\.\\d+)?\\b)",description:"Extracts the last number in the text"},{name:"Dollar Amount",pattern:"\\$?([0-9]{1,3}(?:,[0-9]{3})*(?:\\.[0-9]{2})?)",description:"Extracts dollar amounts (e.g., $150,000.00) - includes commas"},{name:"Dollar Amount (Clean)",pattern:"\\$([0-9,]+)",replace:"$1",description:"Extracts dollar amounts, strips $ symbol (keeps commas for readability)"},{name:"Number (No Commas)",pattern:"([0-9,]+)",replace:"$1",description:"Extracts numbers and removes commas (e.g., 150,000 → 150000)"},{name:"Phone Number (Digits)",pattern:"(?:\\(?([0-9]{3})\\)?[-. ]?)?([0-9]{3})[-. ]?([0-9]{4})",replace:"$1$2$3",description:"Extracts phone numbers as digits only (e.g., (555) 123-4567 → 5551234567)"},{name:"Yes/No",pattern:"\\b((?:yes|no|YES|NO|Yes|No))\\b",description:"Extracts yes or no responses (case insensitive)"},{name:"JSON Value",pattern:'"result"\\s*:\\s*"([^"]+)"',description:"Extracts value from JSON result field"},{name:"Rating (1-5)",pattern:"\\b([1-5])(?:/5)?\\b",description:"Extracts ratings from 1 to 5"},{name:"Percentage",pattern:"\\b(\\d+(?:\\.\\d+)?)%",description:"Extracts percentage values"},{name:"First Word",pattern:"^\\s*(\\S+)",description:"Extracts the first word (non-whitespace sequence)"},{name:"Last Word",pattern:"(\\S+)\\s*$",description:"Extracts the last word in the text"},{name:"Text Until Punctuation",pattern:"^([^.!?;:,]+)",description:"Extracts text from start until first punctuation mark"},{name:"Text After Last Punctuation",pattern:"[.!?;:,]\\s*([^.!?;:,]+)\\s*$",description:"Extracts text after the last punctuation mark"},{name:"First Line",pattern:"^(.+?)(?:\\n|$)",description:"Extracts the first line of text"},{name:"Last Line",pattern:"(?:^|\\n)([^\\n]+)\\s*$",description:"Extracts the last line of text"},{name:"Between Quotes",pattern:'"([^"]+)"',description:"Extracts text between double quotes"},{name:"Category/Label",pattern:"(?:category|label|class|type)\\s*[:\\s]\\s*([^\\n\\r,.!?]+)",description:"Extracts category or label values (stops at punctuation)"},{name:"Everything",pattern:"^\\s*(.+?)\\s*$",description:"Extracts all text (removes leading/trailing whitespace)"},{name:"Main Content",pattern:"(?:^|\\n)\\s*([^\\n]+?)\\s*(?:\\n|$)",description:"Extracts the main line of content (ignores empty lines)"}];function A(){d.value&&b.value?n("update:modelValue",{match:p.value,replace:b.value}):n("update:modelValue",p.value),y.value&&O()}function T(){d.value=!d.value,A()}function O(){if(!p.value||!y.value)return k.value=[],void(w.value="");try{const e=d.value&&b.value?{match:p.value,replace:b.value}:p.value,t=U(y.value,e);t.length>=100?w.value="Showing first 100 matches (pattern matched more)":w.value="",k.value=t}catch(e){k.value=[],w.value=`Invalid regex: ${e instanceof Error?e.message:"Unknown error"}`}}async function L(){if(S.value&&a.promptTemplate&&!V.value){V.value=!0,E.value=null;try{const e=function(e){if(!a.variables)return e.replace(/\{\{\s*([^}]+)\s*\}\}/g,"test");return e.replace(/\{\{\s*([^}]+)\s*\}\}/g,(e,t)=>{const s=t.trim(),n=a.variables?.[s];return n&&n.length>0?n[0]:`test_${s}`})}(a.promptTemplate),t=await N(S.value,e,{temperature:.7,max_tokens:150,output_format:"text"}),s=U(t,D.value);E.value={response:t,extracted:s.length>0?s.join(", "):null}}catch(e){console.error("API test failed:",e),E.value={response:`Error: ${e instanceof Error?e.message:"Unknown error"}`,extracted:null}}finally{V.value=!1}}}function U(e,t){if(!t||!e)return[];try{const a="string"==typeof t?{match:t,replace:void 0}:t,s=new RegExp(a.match,"gm"),n=[];let l,r=0;const i=1e3,o=10;for(;null!==(l=s.exec(e))&&r<i&&n.length<o;)if(r++,l.index===s.lastIndex&&s.lastIndex++,l.groups){const e=Object.values(l.groups).filter(e=>void 0!==e);e.length>0&&n.push(e.join(" | "))}else if(l.length>1){const e=l.slice(1).filter(e=>void 0!==e);1===e.length?n.push(e[0]):e.length>1&&n.push(e.join(" | "))}else n.push(l[0]);return a.replace?n.map(e=>{try{const t=new RegExp(a.match,"g");return e.replace(t,a.replace)}catch(t){return console.warn("Error applying replace pattern:",t),e}}):n}catch(a){return console.error("Extraction failed:",a),[]}}return _(()=>a.modelValue,e=>{"object"==typeof e?(d.value=!0,p.value=e.match,b.value=e.replace||""):(p.value=e||"",b.value="")}),(e,t)=>(r(),l("div",W,[i("div",Z,[t[6]||(t[6]=i("h4",null,"Extract Pattern",-1)),i("div",Y,[i("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:T},g(d.value?"Simple":"Advanced"),1),i("button",{type:"button",class:"btn btn-sm btn-secondary",onClick:t[0]||(t[0]=e=>$.value=!$.value)},g($.value?"Hide":"Show")+" Presets ",1)])]),$.value?(r(),l("div",K,[t[7]||(t[7]=i("h5",null,"Common Patterns",-1)),i("div",X,[(r(),l(m,null,v(I,e=>i("button",{key:e.name,type:"button",class:"preset-button",onClick:t=>function(e){p.value=e.pattern,"replace"in e?(b.value=e.replace||"",d.value=!0):b.value="",A()}(e)},[i("span",Q,g(e.name),1),i("code",ee,g(e.pattern),1)],8,H)),64))])])):o("",!0),i("div",te,[d.value?(r(),l("div",se,[i("div",ne,[t[8]||(t[8]=i("label",null,"Match Pattern:",-1)),c(i("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e),type:"text",class:"regex-input",placeholder:"e.g., \\$?([0-9,]+)",spellcheck:"false",onInput:A},null,544),[[f,p.value]])]),i("div",le,[t[9]||(t[9]=i("label",null,"Replace Pattern (optional):",-1)),c(i("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>b.value=e),type:"text",class:"regex-input",placeholder:"e.g., $1 (strips $ and commas)",spellcheck:"false",onInput:A},null,544),[[f,b.value]])])])):(r(),l("div",ae,[c(i("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>p.value=e),type:"text",class:"regex-input",placeholder:"e.g., Answer: (.+)",spellcheck:"false",onInput:A},null,544),[[f,p.value]])])),i("button",{type:"button",class:"btn btn-sm btn-primary",disabled:!p.value||!y.value,onClick:O}," Test ",8,re)]),w.value?(r(),l("div",ie,g(w.value),1)):o("",!0),i("div",oe,[t[10]||(t[10]=i("label",null,"Test Text",-1)),c(i("textarea",{"onUpdate:modelValue":t[4]||(t[4]=e=>y.value=e),rows:"3",placeholder:"Paste sample output to test your regex pattern",class:"test-textarea",onInput:O},null,544),[[f,y.value]])]),k.value.length>0?(r(),l("div",ue,[t[11]||(t[11]=i("h5",null,"Matches Found",-1)),i("div",ce,[(r(!0),l(m,null,v(k.value,(e,t)=>(r(),l("div",{key:t,class:"match-item"},[i("span",de,"Match "+g(t+1)+":",1),i("code",pe,g(e),1)]))),128))])])):o("",!0),e.showApiTest?(r(),l("div",me,[t[15]||(t[15]=i("h5",null,"Test with API",-1)),i("div",ve,[c(i("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>S.value=e),class:"model-select"},[t[12]||(t[12]=i("option",{value:""}," Select a model ",-1)),(r(!0),l(m,null,v(j.value,e=>(r(),l("option",{key:e.id,value:e.id},g(e.name),9,ge))),128))],512),[[x,S.value]]),i("button",{type:"button",class:"btn btn-sm btn-primary",disabled:!S.value||!e.promptTemplate||V.value,onClick:L},g(V.value?"Testing...":"Test with Model"),9,fe)]),E.value?(r(),l("div",be,[t[13]||(t[13]=i("h6",null,"Model Response:",-1)),i("pre",ye,g(E.value.response),1),t[14]||(t[14]=i("h6",null,"Extracted Value:",-1)),i("code",he,g(E.value.extracted||"(no match)"),1)])):o("",!0)])):o("",!0)]))}}),[["__scopeId","data-v-a320e708"]]);const xe={class:"modal-content"},ke={class:"modal-header"},we={class:"modal-body"},$e={class:"form-group"},Se={class:"form-group"},Ve={class:"form-group"},Ee={key:0,class:"extraction-errors"},De={class:"error-list"},je={key:1,class:"extraction-warnings"},Ce={class:"warning-list"},Ie={key:2,class:"variables-section"},Ae={class:"detected-variables"},Ne={class:"variable-header"},Te={class:"variable-name"},Oe={class:"variable-actions"},Le=["onClick"],Ue=["onClick"],Re={key:0,class:"list-reference"},qe={class:"list-info"},Pe={class:"list-count"},Fe={key:1,class:"variable-values"},Je={class:"form-group"},Me={key:3,class:"form-group"},ze={class:"json-test-section"},Be={class:"json-test-controls"},Ge=["value"],We=["disabled"],Ze={key:0,class:"json-api-result"},Ye={class:"json-api-response"},Ke={key:4,class:"form-group"},Xe={class:"modal-footer"},He={class:"modal-content list-selection-modal"},Qe={class:"modal-header"},et={class:"modal-body"},tt={class:"list-options"},at={key:0,class:"no-lists"},st=["onClick"],nt={class:"list-main"},lt={key:0},rt={class:"list-meta"},it={class:"list-category"},ot={class:"list-count"},ut={class:"list-datetime"},ct=["title"],dt={class:"modal-footer"},pt=j(a({__name:"DesignEditorModal",props:{design:{}},emits:["save","close"],setup(e,{emit:t}){const a=e,d=t,p=h(()=>!!a.design),b=s({name:"",description:"",prompt_template:"",output_format:"text",output_type:"string",extract_pattern:""}),V=A(),E=C(),D=s({}),j=s({}),I=s([]),L=s({}),U=s(null),R=s(""),q=s(!1),P=s(null),F=h(()=>E.models.filter(e=>e.enabled)),J=h(()=>b.value.prompt_template),{detectedVariables:M,extractionErrors:z,extractionWarnings:B}=function(e){const t=s([]),a=s([]),n=s([]),l=()=>{const s=[],l=[],u=new Set,c=e.value||"",d=(c.match(/\{\{/g)||[]).length,p=(c.match(/\}\}/g)||[]).length;d!==p&&s.push(`Unmatched braces: ${d} opening {{ but ${p} closing }}`);const m=T.getInstance().extractTemplateVariables(c);for(const e of m)r(e)?e.includes("{{")||e.includes("}}")?s.push(`Nested variables not supported: "${e}"`):(i(e)&&l.push(`"${e}" is a reserved name and may cause issues`),u.add(e)):s.push(`Invalid variable name: "${e}"`);const v=o(c);l.push(...v);const g={variables:Array.from(u).sort(),errors:s,warnings:l};return t.value=g.variables,a.value=g.errors,n.value=g.warnings,g},r=e=>/^[a-zA-Z_][a-zA-Z0-9_]*(?:\.[a-zA-Z_][a-zA-Z0-9_]*)*$/.test(e)&&e.length<=50,i=e=>["id","index","length","toString","valueOf","constructor","prototype"].includes(e.toLowerCase()),o=e=>{const t=[];return e.includes("{")&&!e.includes("{{")&&t.push("Found single braces { } - use double braces {{ }} for variables"),(/\{\s+\{/.test(e)||/\}\s+\}/.test(e))&&t.push("Found spaces between braces - use {{variable}} not { {variable} }"),(/\{\{\{/.test(e)||/\}\}\}/.test(e))&&t.push("Found triple braces - use double braces {{ }} for variables"),/\{\{\s*\}\}/.test(e)&&t.push("Found empty variable placeholder {{ }}"),t};return _(e,l,{immediate:!0}),{detectedVariables:h(()=>t.value),extractionErrors:h(()=>a.value),extractionWarnings:h(()=>n.value),extractVariables:l,isValidVariableName:r}}(J),W=h(()=>M.value.filter(e=>e in D.value||e in j.value)),Z=()=>{console.log("=== SYNC VARIABLE ARRAYS ==="),console.log("Detected variables:",M.value),console.log("Current variableArrays:",Object.keys(D.value)),console.log("Current variableListRefs:",Object.keys(j.value));for(const e of M.value)e in D.value||e in j.value||(D.value[e]=[],console.log(`Added new variable array: ${e}`));for(const e of Object.keys(D.value))M.value.includes(e)||(delete D.value[e],console.log(`Removed unused variable array: ${e}`));for(const e of Object.keys(j.value))M.value.includes(e)||(delete j.value[e],console.log(`Removed unused variable list ref: ${e}`));console.log("Final variableArrays:",Object.keys(D.value)),console.log("Final variableListRefs:",Object.keys(j.value))};_(M,Z,{immediate:!0});const Y=e=>{"Escape"===e.key&&d("close")};function K(e){const t="string"==typeof e?parseInt(e):e,a=I.value.find(e=>e.id===t);return a?.name||"Unknown List"}function X(e){const t="string"==typeof e?parseInt(e):e;return L.value[t]||0}function H(e){const t=new Date(e.updated_at||e.created_at),a=(new Date).getTime()-t.getTime(),s=Math.floor(a/864e5);return 0===s?"today":1===s?"yesterday":s<7?`${s} days ago`:t.toLocaleDateString()}async function Q(){if(R.value&&b.value.prompt_template&&!q.value){q.value=!0,P.value=null;try{const t=b.value.prompt_template.replace(/\{\{\s*([^}]+)\s*\}\}/g,(e,t)=>{const a=t.trim();if(j.value[a]){const e=j.value[a],t=I.value.find(t=>t.id===e);if(t&&t.values&&t.values.length>0)return t.values[0]}const s=D.value[a];return s&&s.length>0?s[0]:`test_${a}`}),a=await N(R.value,t,{temperature:.7,max_tokens:150,output_format:"json",output_type:b.value.output_type});let s,n=null;try{const e=O(a);if(null===e)throw new SyntaxError("Invalid JSON format in API response");n=e&&"object"==typeof e&&"answer"in e?JSON.stringify(e.answer,null,2):JSON.stringify(e,null,2)}catch(e){s=`JSON Parse Error: ${e instanceof Error?e.message:"Invalid JSON"}`}P.value={response:a,parsed:n,parseError:s}}catch(e){console.error("JSON API test failed:",e),P.value={response:`Error: ${e instanceof Error?e.message:"Unknown error"}`,parsed:null,parseError:"API call failed"}}finally{q.value=!1}}}function ee(){Z();const e={};for(const[s,n]of Object.entries(D.value))M.value.includes(s)&&n.length>0&&!j.value[s]&&(e[s]=n);const t={};for(const[s,n]of Object.entries(j.value))M.value.includes(s)&&(t[s]=n);const a={name:b.value.name,description:b.value.description,prompt_template:b.value.prompt_template,variables:JSON.parse(JSON.stringify(e)),variable_list_refs:JSON.parse(JSON.stringify(t)),output_format:b.value.output_format,output_type:b.value.output_type,extract_pattern:b.value.extract_pattern};console.log("=== SAVING DESIGN ==="),console.log("Design data being saved:",a),console.log("Variables:",a.variables),console.log("Variable list refs:",a.variable_list_refs),console.log("Variable list refs keys:",Object.keys(a.variable_list_refs||{})),d("save",a)}return k(async()=>{document.addEventListener("keydown",Y);const e=await V.loadVariableLists();I.value=e.sort((e,t)=>{const a=new Date(e.updated_at||e.created_at);return new Date(t.updated_at||t.created_at).getTime()-a.getTime()}),await E.loadModels(),console.log("=== DESIGN EDITOR MOUNTED ==="),console.log("Available lists loaded:",I.value);for(const t of I.value)if(t.id){const e=await V.getListItems(t.id);L.value[t.id]=e.length}if(a.design&&(console.log("=== LOADING EXISTING DESIGN ==="),console.log("Props design:",a.design),console.log("variable_list_refs from props:",a.design.variable_list_refs),b.value={name:a.design.name,description:a.design.description||"",prompt_template:a.design.prompt_template,output_format:a.design.output_format||"text",output_type:a.design.output_type||"string",extract_pattern:a.design.extract_pattern||""},a.design.variable_list_refs&&(j.value={...a.design.variable_list_refs},console.log("Loaded variableListRefs:",j.value)),a.design.variables))for(const[t,s]of Object.entries(a.design.variables))j.value[t]||(D.value[t]=Array.isArray(s)?s:[s])}),n(()=>{document.removeEventListener("keydown",Y)}),(e,t)=>(r(),l(m,null,[i("div",{class:"modal-overlay",onClick:t[9]||(t[9]=y(t=>e.$emit("close"),["self"]))},[i("div",xe,[i("div",ke,[i("h2",null,g(p.value?"Edit":"Create")+" Design",1),i("button",{class:"close-btn",onClick:t[0]||(t[0]=t=>e.$emit("close"))}," × ")]),i("div",we,[i("form",{onSubmit:y(ee,["prevent"])},[i("div",$e,[t[13]||(t[13]=i("label",{for:"design-name"},"Name",-1)),c(i("input",{id:"design-name","onUpdate:modelValue":t[1]||(t[1]=e=>b.value.name=e),type:"text",required:"",placeholder:"My Design"},null,512),[[f,b.value.name]])]),i("div",Se,[t[14]||(t[14]=i("label",{for:"design-description"},"Description (optional)",-1)),c(i("input",{id:"design-description","onUpdate:modelValue":t[2]||(t[2]=e=>b.value.description=e),type:"text",placeholder:"Brief description of this design"},null,512),[[f,b.value.description]])]),i("div",Ve,[t[15]||(t[15]=i("label",{for:"design-template"},[w(" Prompt Template "),i("span",{class:"label-hint"},"Use {{variable}} for placeholders")],-1)),c(i("textarea",{id:"design-template","onUpdate:modelValue":t[3]||(t[3]=e=>b.value.prompt_template=e),required:"",rows:"6",placeholder:"You are a helpful assistant. Please {{action}} the following {{topic}}...",onInput:Z},null,544),[[f,b.value.prompt_template]])]),$(z).length>0?(r(),l("div",Ee,[t[16]||(t[16]=i("h4",null,"Template Errors",-1)),i("div",De,[(r(!0),l(m,null,v($(z),e=>(r(),l("div",{key:e,class:"error-item"},g(e),1))),128))])])):o("",!0),$(B).length>0?(r(),l("div",je,[t[17]||(t[17]=i("h4",null,"Template Warnings",-1)),i("div",Ce,[(r(!0),l(m,null,v($(B),e=>(r(),l("div",{key:e,class:"warning-item"},g(e),1))),128))])])):o("",!0),W.value.length>0?(r(),l("div",Ie,[t[20]||(t[20]=i("h3",null,"Detected Variables",-1)),i("div",Ae,[(r(!0),l(m,null,v(W.value,e=>(r(),l("div",{key:e,class:"variable-item"},[i("div",Ne,[i("span",Te,g(e),1),i("div",Oe,[j.value[e]?(r(),l("button",{key:1,type:"button",class:"btn btn-sm btn-danger",onClick:t=>function(e){delete j.value[e],D.value[e]=[]}(e)}," Remove List ",8,Ue)):(r(),l("button",{key:0,type:"button",class:"btn btn-sm btn-secondary",onClick:t=>function(e){U.value=e}(e)}," Use List ",8,Le))])]),j.value[e]?(r(),l("div",Re,[i("div",qe,[t[18]||(t[18]=i("strong",null,"Using list:",-1)),w(" "+g(K(j.value[e]))+" ",1),i("small",Pe,"("+g(X(j.value[e]))+" items)",1)])])):(r(),l("div",Fe,[t[19]||(t[19]=i("label",null,"Values:",-1)),u(G,{modelValue:D.value[e],"onUpdate:modelValue":t=>D.value[e]=t,placeholder:`Add values for ${e}`,"helper-text":"Press Enter to add each value"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]))]))),128))])])):o("",!0),i("div",Je,[t[22]||(t[22]=i("label",{for:"output-format"},"Output Format",-1)),c(i("select",{id:"output-format","onUpdate:modelValue":t[4]||(t[4]=e=>b.value.output_format=e)},t[21]||(t[21]=[i("option",{value:"text"}," Text ",-1),i("option",{value:"json"}," JSON function calling parser ",-1)]),512),[[x,b.value.output_format]])]),"json"===b.value.output_format?(r(),l("div",Me,[t[28]||(t[28]=i("label",{for:"output-type"},"JSON Output Type",-1)),c(i("select",{id:"output-type","onUpdate:modelValue":t[5]||(t[5]=e=>b.value.output_type=e)},t[23]||(t[23]=[i("option",{value:"string"}," String ",-1),i("option",{value:"number"}," Number ",-1),i("option",{value:"boolean"}," Boolean ",-1)]),512),[[x,b.value.output_type]]),t[29]||(t[29]=i("p",{class:"form-hint"},' The response will be structured as JSON with an "answer" field containing this type of value. ',-1)),i("div",ze,[t[27]||(t[27]=i("h5",null,"Test with Live Model",-1)),i("div",Be,[c(i("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>R.value=e),class:"model-select"},[t[24]||(t[24]=i("option",{value:""}," Select a model ",-1)),(r(!0),l(m,null,v(F.value,e=>(r(),l("option",{key:e.id,value:e.id},g(e.name),9,Ge))),128))],512),[[x,R.value]]),i("button",{type:"button",class:"btn btn-sm btn-primary",disabled:!R.value||!b.value.prompt_template||q.value,onClick:Q},g(q.value?"Testing...":"Test JSON Parser"),9,We)]),P.value?(r(),l("div",Ze,[t[25]||(t[25]=i("h6",null,"Model Response:",-1)),i("pre",Ye,g(P.value.response),1),t[26]||(t[26]=i("h6",null,"Parsed JSON:",-1)),i("code",{class:S(["json-api-parsed",{error:P.value.parseError}])},g(P.value.parseError||P.value.parsed||"(no valid JSON)"),3)])):o("",!0)])])):o("",!0),"text"===b.value.output_format?(r(),l("div",Ke,[u(_e,{modelValue:b.value.extract_pattern,"onUpdate:modelValue":t[7]||(t[7]=e=>b.value.extract_pattern=e),"prompt-template":b.value.prompt_template,"show-api-test":!0,variables:D.value},null,8,["modelValue","prompt-template","variables"])])):o("",!0)],32)]),i("div",Xe,[i("button",{type:"button",class:"btn btn-secondary",onClick:t[8]||(t[8]=t=>e.$emit("close"))}," Cancel "),i("button",{type:"submit",class:"btn btn-primary",onClick:ee},g(p.value?"Update":"Create")+" Design ",1)])])]),U.value?(r(),l("div",{key:0,class:"modal-overlay nested-modal",onClick:t[12]||(t[12]=y(e=>U.value=null,["self"]))},[i("div",He,[i("div",Qe,[i("div",null,[t[31]||(t[31]=i("div",{class:"modal-breadcrumb"},[i("span",null,"Create Design"),i("span",{class:"breadcrumb-separator"},"→"),i("span",{class:"breadcrumb-current"},"Select Variable List")],-1)),i("h3",null,[t[30]||(t[30]=w("Select Variable List for ")),i("code",null,g(U.value),1)])]),i("button",{class:"close-btn",onClick:t[10]||(t[10]=e=>U.value=null)}," × ")]),i("div",et,[i("div",tt,[0===I.value.length?(r(),l("div",at," No variable lists available. Create one in the Variables tab. ")):o("",!0),(r(!0),l(m,null,v(I.value,e=>(r(),l("div",{key:e.id,class:"list-option",onClick:t=>async function(e){if(console.log("=== ASSIGNING VARIABLE LIST ==="),console.log("Variable:",U.value),console.log("List:",e),console.log("List ID:",e.id),U.value&&e.id&&(j.value[U.value]=e.id,delete D.value[U.value],console.log("Updated variableListRefs:",j.value),!(e.id in L.value))){const t=await V.getListItems(e.id);L.value[e.id]=t.length}U.value=null}(e)},[i("div",nt,[i("h4",null,g(e.name),1),e.description?(r(),l("p",lt,g(e.description),1)):o("",!0)]),i("div",rt,[i("span",it,g(e.category||"general"),1),i("span",ot,g(e.values?.length||0)+" items",1),i("span",ut,g(H(e)),1),e.attribute_keys?.length?(r(),l("span",{key:0,class:"attribute-keys",title:e.attribute_keys.join(", ")},g(e.attribute_keys.join(", ")),9,ct)):o("",!0)])],8,st))),128))])]),i("div",dt,[i("button",{type:"button",class:"btn btn-secondary",onClick:t[11]||(t[11]=e=>U.value=null)}," Cancel ")])])])):o("",!0)],64))}}),[["__scopeId","data-v-c5d97462"]]),mt={class:"designs-view"},vt={class:"page-header"},gt={class:"header-actions"},ft=["disabled"],bt={key:0,class:"empty-state"},yt={key:1,class:"designs-container"},ht={class:"sort-controls"},_t={class:"designs-table"},xt={class:"design-main"},kt={class:"design-info"},wt={class:"design-header"},$t={class:"design-name"},St={class:"design-output"},Vt={key:0,class:"design-description"},Et={class:"design-meta"},Dt={key:0},jt={class:"design-actions"},Ct=["onClick"],It=["onClick"],At=["onClick"],Nt=["onClick"],Tt=["onClick"],Ot=j(a({__name:"DesignsView",setup(e){const t=V(),a=I(),n=A(),u=s([]),d=s([]),p=s(!1),f=s(null),b=s("updated_at"),y=s("desc"),_=h(()=>[...u.value].sort((e,t)=>{let a,s;switch(b.value){case"name":a=e.name.toLowerCase(),s=t.name.toLowerCase();break;case"created_at":a=new Date(e.created_at||0).getTime(),s=new Date(t.created_at||0).getTime();break;case"updated_at":a=new Date(e.updated_at||e.created_at||0).getTime(),s=new Date(t.updated_at||t.created_at||0).getTime();break;default:return 0}return a<s?"asc"===y.value?-1:1:a>s?"asc"===y.value?1:-1:0}));async function $(){u.value=await a.loadDesigns()}async function S(e){try{f.value?.id?await a.updateDesign(f.value.id,e):await a.createDesign(e),await $(),D()}catch(t){console.error("Failed to save design:",t),alert(`Failed to save design: ${t instanceof Error?t.message:String(t)}`)}}function D(){p.value=!1,f.value=null}function j(){const e={version:"1.0",exportDate:(new Date).toISOString(),designs:u.value},t=JSON.stringify(e,null,2),a=new Blob([t],{type:"application/json"}),s=URL.createObjectURL(a),n=document.createElement("a");n.href=s,n.download=`auditomatic_designs_${(new Date).getTime()}.json`,n.click(),URL.revokeObjectURL(s)}async function C(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{const t=e.target.files?.[0];if(t)try{const e=await t.text(),a=O(e);if(null===a)throw new SyntaxError("Invalid JSON format in imported file");const s=q.getInstance(),n=await s.importDesigns(a,{convertTemplateFormat:!0,allowDuplicateNames:!1,skipValidation:!1});if(!n.success&&n.errors.length>0)return void alert(`Import failed: ${n.errors.join(", ")}`);const l=n.designs.length;if(0===l)return void alert("No valid designs found to import");const r=`Import ${l} design${l>1?"s":""}? This will not affect existing designs.`;if(!confirm(r))return;await $();let i=[`Successfully imported ${n.designs.length} design${n.designs.length>1?"s":""}`];n.converted>0&&i.push(`${n.converted} template format${n.converted>1?"s":""} converted`),n.warnings.length>0&&i.push(`Warnings: ${n.warnings.join(", ")}`),alert(i.join(". "))}catch(a){console.error("Import error:",a);let e="Failed to import designs. ";a instanceof SyntaxError?e+="Invalid JSON format.":a instanceof Error&&a.message?e+=a.message:e+="Please check the file format.",alert(e)}},e.click()}function N(){}function T(){y.value="asc"===y.value?"desc":"asc"}function L(e){return e?new Date(e).toLocaleDateString():"N/A"}function U(e){const t=e.variables||{},a=e.variable_list_refs||{};if(0===Object.keys(t).length&&0===Object.keys(a).length)return"0 variables";const s=[];let n=1;for(const[l,r]of Object.entries(t))Array.isArray(r)&&r.length>0&&(s.push(`${l} (${r.length})`),n*=r.length);for(const[l,r]of Object.entries(a)){const e=d.value.find(e=>e.id===r);e&&e.values?.length>0&&(s.push(`${l} (${e.values.length})`),n*=e.values.length)}return 0===s.length?"0 variables":1===s.length?`${s[0]} = ${n} conditions`:`${s.join(" × ")} = ${n} conditions`}return k(async()=>{await $(),await async function(){d.value=await n.loadVariableLists()}()}),(e,s)=>(r(),l("div",mt,[i("div",vt,[s[2]||(s[2]=i("h2",null,"Prompt Designs",-1)),i("div",gt,[i("button",{class:"btn btn-secondary",onClick:C}," Import "),i("button",{class:"btn btn-secondary",disabled:0===u.value.length,onClick:j}," Export All ",8,ft),i("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=e=>p.value=!0)}," New Design ")])]),0===u.value.length?(r(),l("div",bt,s[3]||(s[3]=[i("p",null,"No designs yet. Create your first design!",-1)]))):(r(),l("div",yt,[i("div",ht,[s[5]||(s[5]=i("label",null,"Sort by:",-1)),c(i("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>b.value=e),onChange:N},s[4]||(s[4]=[i("option",{value:"updated_at"}," Last Edited ",-1),i("option",{value:"name"}," Name ",-1),i("option",{value:"created_at"}," Created Date ",-1)]),544),[[x,b.value]]),i("button",{class:"sort-toggle",onClick:T},g("desc"===y.value?"↓":"↑"),1)]),i("div",_t,[(r(!0),l(m,null,v(_.value,e=>(r(),l("div",{key:e.id,class:"design-row"},[i("div",xt,[i("div",kt,[i("div",wt,[i("h3",$t,g(e.name),1),i("span",St,g(e.output_format||"text"),1),e.description?(r(),l("span",Vt,g(e.description),1)):o("",!0)]),i("p",Et,[w(g(U(e))+" • Created "+g(L(e.created_at))+" ",1),e.updated_at&&e.updated_at!==e.created_at?(r(),l("span",Dt," • Updated "+g(L(e.updated_at)),1)):o("",!0)])]),i("div",jt,[i("button",{class:"btn btn-secondary btn-small",onClick:t=>async function(e){if(e.id){const t=await a.getDesignById(e.id);f.value=t||e}else f.value=e}(e)}," Edit ",8,Ct),i("button",{class:"btn btn-secondary btn-small",onClick:t=>function(e){const t={...e,id:void 0,name:`${e.name} (Copy)`,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};f.value=t}(e)}," Copy ",8,It),i("button",{class:"btn btn-primary btn-small",onClick:a=>{return s=e.id,void t.push({name:"runs",query:{create:s.toString(),from:"designs"}});var s}}," Run ",8,At),i("button",{class:"btn btn-secondary btn-small",onClick:t=>function(e){const t={version:"1.0",exportDate:(new Date).toISOString(),design:e},a=JSON.stringify(t,null,2),s=new Blob([a],{type:"application/json"}),n=URL.createObjectURL(s),l=document.createElement("a");l.href=n,l.download=`design_${e.name.replace(/[^a-zA-Z0-9]/g,"_")}_${(new Date).toISOString().split("T")[0]}.json`,l.click(),URL.revokeObjectURL(n)}(e)}," Export ",8,Nt),i("button",{class:"btn btn-danger btn-small",onClick:t=>async function(e){confirm("Are you sure you want to delete this design?")&&(await a.deleteDesign(e),await $())}(e.id)}," Delete ",8,Tt)])])]))),128))])])),p.value||f.value?(r(),E(pt,{key:2,design:f.value,onSave:S,onClose:D},null,8,["design"])):o("",!0)]))}}),[["__scopeId","data-v-82650b18"]]);export{Ot as default};
