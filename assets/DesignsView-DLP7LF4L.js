import{u as e,t as a,p as t,a as l}from"./designs-db-DO9a-1L6.js";import{u as s}from"./variables-db-Dn2EawqK.js";import{_ as r,b as i,D as o,P as n,E as u,c as d,C as c,e as v}from"./index-D7qu21q1.js";import{r as p,f,c as m,w as b,d as g,a2 as y,W as h,a3 as k,Y as _,G as x,a5 as w,a6 as L,q as V,a7 as C,F as S,a4 as R,n as W,k as T,X as I,S as A,a8 as E,B as U,a9 as D,o as j,u as z,aa as P,ab as $,U as F}from"./vendor-BxfGckcK.js";import{_ as N,a as B}from"./BaseButton.vue_vue_type_style_index_0_lang-CyPrUoDq.js";import{M}from"./ModelSelectionTable-Cso9g2q-.js";import{u as O}from"./models-db-CnjekPDE.js";import{defaultDesigns as K,defaultVariableLists as q}from"./defaultData-JIxMKZuK.js";import"./db-COX2g2xv.js";import"./registry-CUN7XnFI.js";const H=[{label:"Full Response (default)",value:"",description:"Extract the entire response"},{label:"First Number",value:"\\d+",description:"Extract the first number found"},{label:"Last Number",value:"\\d+(?!.*\\d)",description:"Extract the last number found"},{label:"First Number After Colon",value:":\\s*(\\d+)",description:"Extract first number after a colon"},{label:"Last Number After Colon",value:":\\s*(\\d+)(?!.*:\\s*\\d)",description:"Extract last number after a colon"},{label:"First Word",value:"\\b\\w+\\b",description:"Extract the first word"},{label:"First Phrase (before punctuation)",value:"^[^.!?]+",description:"Extract text before first punctuation"},{label:"First Full Sentence",value:"^[^.!?]+[.!?]",description:"Extract the first complete sentence"},{label:"First Word After Colon",value:":\\s*(\\w+)",description:"Extract first word after a colon"},{label:"First Phrase After Colon",value:":\\s*([^.!?]+)",description:"Extract phrase after colon before punctuation"},{label:"First Sentence After Colon",value:":\\s*([^.!?]+[.!?])",description:"Extract complete sentence after colon"},{label:"Last Word",value:"\\b\\w+\\b(?!.*\\b\\w+\\b)",description:"Extract the last word"},{label:"Last Phrase",value:"[^.!?]+(?=[.!?]$)",description:"Extract the last phrase before final punctuation"},{label:"Last Full Sentence",value:"[^.!?]+[.!?](?!.*[.!?])",description:"Extract the last complete sentence"}];const J={class:"template-editor"},Y={key:0,class:"editor-label"},G={key:0,class:"required"},X=["innerHTML"],Q=["placeholder","rows"],Z={class:"editor-footer"},ee={key:0,class:"detected-variables"},ae={key:1,class:"no-variables"},te=r(g({__name:"TemplateEditor",props:{modelValue:{},label:{},placeholder:{default:"Enter your prompt template..."},required:{type:Boolean},rows:{default:6},variables:{default:()=>[]}},emits:["update:modelValue"],setup(e,{expose:a,emit:t}){const l=e,s=t,r=f(),i=f(),o=f(!1),n=m({get:()=>l.modelValue,set:e=>s("update:modelValue",e)}),u=m(()=>{let e=d(n.value);return e=e.replace(/\{\{(\w+)\}\}/g,(e,a)=>`<span class="${/^\w+$/.test(a)?"variable-highlight":"variable-error"}">${d(e)}</span>`),e=e.replace(/\n/g,"<br>"),e=e.replace(/  /g," &nbsp;"),e.endsWith("<br>")||(e+="<br>"),e});function d(e){const a=document.createElement("div");return a.textContent=e,a.innerHTML}function c(){r.value&&i.value&&(i.value.scrollTop=r.value.scrollTop,i.value.scrollLeft=r.value.scrollLeft)}return b(n,async()=>{await W(),c()}),a({focus:()=>r.value?.focus()}),(e,a)=>(h(),y("div",J,[e.label?(h(),y("label",Y,[x(w(e.label)+" ",1),e.required?(h(),y("span",G,"*")):k("",!0)])):k("",!0),_("div",{class:L(["editor-container",{focused:o.value}])},[_("div",{ref_key:"highlightRef",ref:i,class:"editor-highlight",innerHTML:u.value,"aria-hidden":"true"},null,8,X),V(_("textarea",{ref_key:"textareaRef",ref:r,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),class:"editor-textarea",placeholder:e.placeholder,rows:e.rows,onFocus:a[1]||(a[1]=e=>o.value=!0),onBlur:a[2]||(a[2]=e=>o.value=!1),onScroll:c},null,40,Q),[[C,n.value]])],2),_("div",Z,[e.variables.length>0?(h(),y("div",ee,[a[3]||(a[3]=_("span",{class:"variables-label"},"Variables:",-1)),(h(!0),y(S,null,R(e.variables,e=>(h(),y("span",{key:e,class:"variable-tag"},w(e),1))),128))])):(h(),y("div",ae,a[4]||(a[4]=[x(" Use "),_("code",null,"{{variable}}",-1),x(" to add variables ")])))])]))}}),[["__scopeId","data-v-699bf98b"]]),le={class:"variable-chip-input"},se={key:0,class:"attributed-list-display"},re={class:"list-header"},ie={class:"source-name"},oe={key:0,class:"attribute-breakdown"},ne={key:0,class:"separator"},ue={class:"total-conditions"},de={class:"attributed-chips-container"},ce={class:"item-name"},ve={key:0,class:"attributes-wrapper"},pe={key:1,class:"direct-values"},fe={key:0,class:"source-indicator"},me={class:"source-name"},be={class:"tag-input-wrapper"},ge={class:"custom-tag-input"},ye={class:"tag-container"},he=["title"],ke=["onClick"],_e=["placeholder","onKeydown"],xe={key:0,class:"helper-text"},we=r(g({__name:"VariableChipInput",props:{values:{},listRef:{},listName:{},source:{},placeholder:{},attributedSamples:{},attributeBreakdown:{},attributeKeys:{}},emits:["update:values","clear-source","clear-list","select-list"],setup(e,{emit:a}){const t=e,l=a,s=f(""),r=f();function i(e){l("update:values",e),t.source&&l("clear-source")}function o(){const e=s.value.trim();e&&(t.values.includes(e)||i([...t.values,e]),s.value="")}function n(){if(""===s.value&&t.values.length>0){const e=[...t.values];e.pop(),i(e)}}function u(){i([]),t.source&&l("clear-source")}return(e,a)=>(h(),y("div",le,[e.listRef?(h(),y("div",se,[_("div",re,[a[5]||(a[5]=_("span",{class:"source-label"},"From list:",-1)),_("span",ie,w(e.listName||"Unknown List"),1),e.attributeBreakdown&&e.attributeBreakdown.parts.length>0?(h(),y("div",oe,[(h(!0),y(S,null,R(e.attributeBreakdown.parts,(a,t)=>(h(),y(S,{key:t},[_("span",{class:"attribute-part",style:D({backgroundColor:[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}][a.colorIndex].bg,color:[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}][a.colorIndex].text})},w(a.text),5),t<e.attributeBreakdown.parts.length-1?(h(),y("span",ne," × ")):k("",!0)],64))),128)),a[3]||(a[3]=_("span",{class:"arrow"}," → ",-1)),_("span",ue,w(e.attributeBreakdown.totalItems)+" conditions",1)])):k("",!0),T(N,{variant:"ghost",size:"small",onClick:a[0]||(a[0]=a=>e.$emit("clear-list"))},{default:I(()=>a[4]||(a[4]=[x(" Clear List ")])),_:1,__:[4]})]),_("div",de,[a[8]||(a[8]=_("span",{class:"sample-hint"},"Sample values:",-1)),(h(!0),y(S,null,R(e.attributedSamples,e=>{return h(),y("div",{key:e.value,class:"attributed-item-chip"},[_("span",ce,w(e.value),1),e.attributes?(h(),y("span",ve,[a[6]||(a[6]=x(" (")),(h(!0),y(S,null,R((l=e.attributes,t.attributeKeys?Object.entries(l).map(([e,a])=>({value:a,colorIndex:t.attributeKeys.indexOf(e)%5})):[]),(e,a)=>(h(),y("span",{key:a,class:"attribute-value",style:D({backgroundColor:[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}][e.colorIndex].bg,color:[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}][e.colorIndex].text})},w(e.value),5))),128)),a[7]||(a[7]=x(") "))])):k("",!0)]);var l}),128))])])):(h(),y("div",pe,[e.source?(h(),y("div",fe,[a[9]||(a[9]=_("span",{class:"source-label"},"From list:",-1)),_("span",me,w(e.source.listName),1),a[10]||(a[10]=_("span",{class:"source-note"},"(modify chips to break connection)",-1))])):k("",!0),_("div",be,[_("div",ge,[_("div",ye,[(h(!0),y(S,null,R(e.values,(e,a)=>(h(),y("div",{key:`${e}-${a}`,class:"tag"},[_("span",{class:"tag-text",title:e.length>100?e:""},w(e.length>100?e.substring(0,100)+"...":e),9,he),_("button",{type:"button",class:"tag-remove",onClick:e=>function(e){const a=[...t.values];a.splice(e,1),i(a)}(a)}," × ",8,ke)]))),128)),V(_("input",{ref_key:"inputField",ref:r,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value=e),placeholder:e.placeholder,class:"tag-input-field",onKeydown:[E(U(o,["prevent"]),["enter"]),E(n,["backspace"])]},null,40,_e),[[C,s.value]])]),e.values.length>0?(h(),y("div",xe,w(e.values.length)+" values ",1)):k("",!0)]),T(N,{variant:"secondary",size:"small",onClick:a[2]||(a[2]=a=>e.$emit("select-list"))},{default:I(()=>a[11]||(a[11]=[x(" Replace with List ")])),_:1,__:[11]}),e.values.length>0?(h(),A(N,{key:0,variant:"danger",size:"small",onClick:u},{default:I(()=>a[12]||(a[12]=[x(" Clear ")])),_:1,__:[12]})):k("",!0)])]))]))}}),[["__scopeId","data-v-bdfb91ea"]]),Le={class:"list-selector"},Ve={class:"list-grid"},Ce=["onClick"],Se={class:"list-header"},Re={class:"item-count"},We={key:0,class:"list-description"},Te={class:"list-preview"},Ie={key:0,class:"preview-more"},Ae={key:1,class:"attributed-badge"},Ee={key:0,class:"empty-state"},Ue=r(g({__name:"ListSelector",props:{modelValue:{type:Boolean},listType:{}},emits:["update:modelValue","select"],setup(e,{emit:a}){const t=e,l=a,r=s(),i=m(()=>"all"===t.listType?r.lists:"simple"===t.listType?r.simpleLists:"refusal"===t.listType?r.refusalLists:[]),o=e=>"attributed"===e.category&&e.items?e.items.slice(0,5).map(e=>e.value):e.values?.slice(0,5)??[];return(e,a)=>(h(),A(B,{"model-value":e.modelValue,title:"Select List",size:"medium","onUpdate:modelValue":a[1]||(a[1]=a=>e.$emit("update:modelValue",a))},{footer:I(()=>[T(N,{variant:"ghost",onClick:a[0]||(a[0]=a=>e.$emit("update:modelValue",!1))},{default:I(()=>a[2]||(a[2]=[x(" Cancel ")])),_:1,__:[2]})]),default:I(()=>[_("div",Le,[_("div",Ve,[(h(!0),y(S,null,R(i.value,e=>(h(),y("div",{key:e.id,class:"list-option",onClick:a=>(e=>{l("select",e),l("update:modelValue",!1)})(e)},[_("div",Se,[_("h4",null,w(e.name),1),_("span",Re,w(e.itemCount)+" items",1)]),e.description?(h(),y("p",We,w(e.description),1)):k("",!0),_("div",Te,[(h(!0),y(S,null,R(o(e),(e,a)=>(h(),y("span",{key:a,class:"preview-value"},w(e),1))),128)),e.itemCount>5?(h(),y("span",Ie," +"+w(e.itemCount-5)+" more ",1)):k("",!0)]),"attributed"===e.category?(h(),y("div",Ae," Attributed List ")):k("",!0)],8,Ce))),128))]),0===i.value.length?(h(),y("div",Ee," No "+w(e.listType)+" lists available ",1)):k("",!0)])]),_:1},8,["model-value"]))}}),[["__scopeId","data-v-b6e2244c"]]),De={class:"variable-mapper"},je={class:"variable-header"},ze={class:"variable-content"},Pe=r(g({__name:"VariableMapper",props:{variables:{},variableArrays:{},variableListRefs:{},variableListSources:{}},emits:["update:variableArrays","update:variableListRefs","update:variableListSources"],setup(e,{emit:a}){const t=e,l=a,r=f(null),i=s(),o=f({}),n=e=>t.variableArrays[e]||[],u=e=>{const a=t.variableListRefs[e];if(!a)return;const l=i.lists.find(e=>e.id===a);return l?.name},d=e=>{const a=t.variableListRefs[e];if(!a)return;const l=i.lists.find(e=>e.id===a);if(!l||"attributed"!==l.category||!l.items)return;const s=`${e}-${a}`;if(o.value[s])return o.value[s];const r=[...l.items].sort(()=>Math.random()-.5).slice(0,10);return o.value[s]=r,r},c=e=>{const a=t.variableListRefs[e];if(!a)return;const l=i.lists.find(e=>e.id===a);if(!l||"attributed"!==l.category)return;const s=l.itemCount||0,r=[];if(l.attributeKeys){const e={};if(l.items)for(const a of l.items)if(a.attributes)for(const[t,l]of Object.entries(a.attributes))e[t]||(e[t]=new Set),e[t].add(String(l));for(let a=0;a<l.attributeKeys.length;a++){const t=l.attributeKeys[a],s=e[t]?.size||0;s>0&&r.push({text:`${t} (${s} categories)`,colorIndex:a%5})}}return{parts:r,totalItems:s}},v=e=>{const a=t.variableListRefs[e];if(!a)return;const l=i.lists.find(e=>e.id===a);return l?.attributeKeys},p=e=>{if(!r.value)return;const a=r.value;if("attributed"!==e.category&&e.values&&e.values.length>0){const s={...t.variableArrays};s[a]=[...e.values],l("update:variableArrays",s);const r={...t.variableListSources};r[a]={listId:e.id,listName:e.name},l("update:variableListSources",r);const i={...t.variableListRefs};delete i[a],l("update:variableListRefs",i)}else if("attributed"===e.category){const s=t.variableListRefs[a];if(s&&s!==e.id){const e=`${a}-${s}`;delete o.value[e]}const r={...t.variableListRefs};r[a]=e.id,l("update:variableListRefs",r);const i={...t.variableArrays};delete i[a],l("update:variableArrays",i);const n={...t.variableListSources};delete n[a],l("update:variableListSources",n)}r.value=null};return(e,a)=>(h(),y(S,null,[_("div",De,[(h(!0),y(S,null,R(e.variables,a=>(h(),y("div",{key:a,class:"variable-row"},[_("div",je,[_("h4",null,w(a),1)]),_("div",ze,[T(we,{values:n(a),"list-ref":e.variableListRefs[a],"list-name":u(a),source:e.variableListSources[a],placeholder:`Enter values for ${a}...`,"attributed-samples":d(a),"attribute-breakdown":c(a),"attribute-keys":v(a),"onUpdate:values":e=>((e,a)=>{const s={...t.variableArrays};s[e]=a,l("update:variableArrays",s)})(a,e),onClearSource:e=>(e=>{const a={...t.variableListSources};delete a[e],l("update:variableListSources",a)})(a),onClearList:e=>(e=>{const a=t.variableListRefs[e],s={...t.variableListRefs};delete s[e],l("update:variableListRefs",s);const r={...t.variableArrays};if(r[e]=[],l("update:variableArrays",r),a){const t=`${e}-${a}`;delete o.value[t]}})(a),onSelectList:e=>(e=>{r.value=e})(a)},null,8,["values","list-ref","list-name","source","placeholder","attributed-samples","attribute-breakdown","attribute-keys","onUpdate:values","onClearSource","onClearList","onSelectList"])])]))),128))]),r.value?(h(),A(Ue,{key:0,"model-value":!!r.value,"list-type":"all","onUpdate:modelValue":a[0]||(a[0]=e=>!e&&(r.value=null)),onSelect:p},null,8,["model-value"])):k("",!0)],64))}}),[["__scopeId","data-v-d6411a4c"]]),$e={class:"form-section"},Fe={class:"form-group"},Ne={class:"form-group"},Be={class:"form-section"},Me={key:0,class:"error-message"},Oe={key:0,class:"form-section"},Ke={class:"form-section"},qe={class:"form-group"},He={class:"form-group"},Je={class:"extract-pattern-input"},Ye=["value"],Ge={key:0,class:"preset-description"},Xe={class:"form-group"},Qe={class:"form-checkbox"},Ze={key:1,class:"error-banner"},ea={class:"footer-content"},aa={class:"stats"},ta={key:0},la={key:1,class:"warning"},sa={class:"actions"},ra={class:"pricing-modal-content"},ia={class:"token-info"},oa={key:0,class:"accuracy-badge"},na={key:0,class:"token-stats"},ua={class:"stat"},da={class:"value"},ca={class:"stat"},va={class:"value"},pa={class:"stat"},fa={class:"value"},ma={class:"stat"},ba={class:"value"},ga={key:1,class:"calculating"},ya={class:"progress-info"},ha={key:0},ka={key:0},_a={key:1},xa={key:2,class:"error"},wa={class:"model-costs"},La=r(g({__name:"DesignEditor",props:{modelValue:{type:Boolean},designId:{}},emits:["update:modelValue","saved"],setup(r,{emit:i}){const o=r,n=i,u=function(l){const r=e(),i=s(),o=p({name:"",description:"",promptTemplate:"",outputType:"text",extractPattern:"",refusalWords:[],refusalWordsListRef:"",refusalWordsSource:null,rejectRefusalWords:!1}),n=f({}),u=f({}),d=f({}),c=f(!1),v=f(!1),g=f([]),y=m(()=>a.extractVariables(o.promptTemplate)),h=m(()=>a.validateTemplate(o.promptTemplate)),k=m(()=>{const e=[];o.name.trim()||e.push("Name is required"),o.promptTemplate.trim()||e.push("Template is required"),h.value.isValid||e.push(...h.value.errors);const a=y.value.filter(e=>{const a=(n.value[e]?.length??0)>0,t=!!u.value[e];return!a&&!t});return a.length&&e.push(`Missing values for variables: ${a.join(", ")}`),{isValid:0===e.length,errors:e}}),_=m(()=>{const e={};for(const a of y.value)if(u.value[a]){const t=i.lists.find(e=>e.id===u.value[a]);e[a]=t?.itemCount??0}else e[a]=n.value[a]?.length??0;return e}),x=m(()=>t.getPermutationInfo(_.value));return b(()=>o.promptTemplate,()=>{const e=y.value;for(const a in n.value)e.includes(a)||(delete n.value[a],delete u.value[a],delete d.value[a]);for(const a of e)a in n.value||a in u.value||(n.value[a]=[])}),b(k,e=>{g.value=e.errors}),l&&async function(){if(l){v.value=!0;try{const e=await r.getDesign(l);if(!e)return;if(o.name=e.name,o.description=e.description||"",o.promptTemplate=e.promptTemplate,o.outputType=e.outputType,o.extractPattern="string"==typeof e.extractPattern?e.extractPattern:"",o.rejectRefusalWords=e.rejectRefusalWords??!1,o.refusalWords=e.refusalWords||[],o.refusalWordsListRef=e.refusalWordsListRef||"",o.refusalWordsSource=e.refusalWordsSource||null,e.variableBindings)for(const[a,t]of Object.entries(e.variableBindings))"list"===t.type&&t.listId?u.value[a]=t.listId:"direct"===t.type&&t.values&&(n.value[a]=[...t.values],t.source&&(d.value[a]=t.source))}finally{v.value=!1}}}(),{form:o,variableArrays:n,variableListRefs:u,variableListSources:d,detectedVariables:y,templateValidation:h,validation:k,errors:g,variableCounts:_,permutationInfo:x,isSaving:c,isLoading:v,saveDesign:async function(e){if(k.value.isValid){c.value=!0;try{const a={};for(const e of y.value)if(u.value[e]){const t=i.lists.find(a=>a.id===u.value[e]);a[e]={type:"list",listId:u.value[e],listName:t?.name}}else n.value[e]?.length>0&&(a[e]={type:"direct",values:[...n.value[e]],source:d.value[e]?{...d.value[e]}:void 0});const t={name:o.name,description:o.description,promptTemplate:o.promptTemplate,outputType:o.outputType,extractPattern:o.extractPattern,variableBindings:JSON.parse(JSON.stringify(a)),refusalWords:[...o.refusalWords],refusalWordsListRef:o.refusalWordsListRef||void 0,refusalWordsSource:o.refusalWordsSource?{...o.refusalWordsSource}:void 0,rejectRefusalWords:o.rejectRefusalWords};return e&&(t.tokenEstimate=e),l?(await r.updateDesign(l,t),l):await r.createDesign(t)}finally{c.value=!1}}}}}(o.designId),d=s(),c=O(),v=f(!1),g=f(null),L=f(!1),W=f(null),E=f(!1),D=m(()=>c.allModels),K=m(()=>{const e={};for(const a of u.detectedVariables.value)if(u.variableListRefs.value[a]){const t=d.lists.find(e=>e.id===u.variableListRefs.value[a]);e[a]={type:"list",listId:u.variableListRefs.value[a],listName:t?.name}}else u.variableArrays.value[a]&&u.variableArrays.value[a].length>0&&(e[a]={type:"direct",values:[...u.variableArrays.value[a]]});return{id:o.designId||"temp",name:u.form.name,description:u.form.description,promptTemplate:u.form.promptTemplate,variableBindings:e,tokenEstimate:g.value||void 0,outputType:u.form.outputType,extractPattern:u.form.extractPattern,refusalWords:u.form.refusalWords,refusalWordsListRef:u.form.refusalWordsListRef,rejectRefusalWords:u.form.rejectRefusalWords,created:new Date,updated:new Date}});b(v,async e=>{if(e&&!g.value){L.value=!0,W.value=null;try{g.value=await l.calculateDesignTokensAccurate(K.value,e=>{W.value={current:e.current,total:e.total,message:e.message}})}catch(a){console.error("Failed to calculate tokens:",a),g.value=await l.calculateDesignTokens(K.value)}finally{L.value=!1,W.value=null}}}),j(async()=>{await d.initialize()});const q=f(!1),J=f(""),Y=m(()=>{const e=H.find(e=>e.value===u.form.extractPattern);return e?.description||""}),G=()=>{u.form.extractPattern=J.value};b(()=>u.form.extractPattern,e=>{const a=H.find(a=>a.value===e);J.value=a?a.value:""},{immediate:!0});const X=()=>{if(!u.form.refusalWordsListRef)return;const e=d.lists.find(e=>e.id===u.form.refusalWordsListRef);return e?.name},Q=()=>{if(!u.form.refusalWordsListRef)return;const e=d.lists.find(e=>e.id===u.form.refusalWordsListRef);return e?"attributed"===e.category&&e.items?e.items.slice(0,10).map(e=>e.value):e.values?.slice(0,10):void 0},Z=()=>{if(!u.form.refusalWordsListRef)return;const e=d.lists.find(e=>e.id===u.form.refusalWordsListRef);return e?.itemCount},ee=e=>{"attributed"!==e.category&&e.values&&e.values.length>0?(u.form.refusalWords=[...e.values],u.form.refusalWordsSource={listId:e.id,listName:e.name},u.form.refusalWordsListRef=""):"attributed"===e.category&&(u.form.refusalWordsListRef=e.id,u.form.refusalWords=[],u.form.refusalWordsSource=null),q.value=!1};async function ae(){try{const e=await u.saveDesign(g.value?.isAccurate?g.value:void 0);e&&(n("saved",e),n("update:modelValue",!1))}catch(e){console.error("Failed to save design:",e)}}return(e,a)=>{const t=F("a-spin");return h(),y(S,null,[T(B,{"model-value":e.modelValue,title:e.designId?"Edit Design":"Create Design",size:"full","onUpdate:modelValue":a[16]||(a[16]=a=>e.$emit("update:modelValue",a))},{footer:I(()=>[_("div",ea,[_("div",aa,[z(u).detectedVariables.value.length>0?(h(),y("span",ta,w(z(u).detectedVariables.value.length)+" variables • "+w(z(u).permutationInfo.value.formatted)+" combinations ",1)):k("",!0),z(u).permutationInfo.value.warning?(h(),y("span",la,w(z(u).permutationInfo.value.warning),1)):k("",!0)]),_("div",sa,[T(N,{variant:"ghost",onClick:a[14]||(a[14]=a=>e.$emit("update:modelValue",!1))},{default:I(()=>a[34]||(a[34]=[x(" Cancel ")])),_:1,__:[34]}),z(u).detectedVariables.value.length>0?(h(),A(N,{key:0,variant:"secondary",onClick:a[15]||(a[15]=e=>v.value=!0)},{default:I(()=>a[35]||(a[35]=[x(" Calculate Pricing ")])),_:1,__:[35]})):k("",!0),T(N,{type:"submit",loading:z(u).isSaving.value,disabled:!z(u).validation.value.isValid,onClick:ae},{default:I(()=>[x(w(e.designId?"Update":"Create"),1)]),_:1},8,["loading","disabled"])])])]),default:I(()=>[_("form",{onSubmit:U(ae,["prevent"])},[_("div",$e,[a[22]||(a[22]=_("h3",null,"Basic Information",-1)),_("div",Fe,[a[20]||(a[20]=_("label",{for:"name",class:"form-label"},[x(" Name "),_("span",{class:"required"},"*")],-1)),V(_("input",{id:"name","onUpdate:modelValue":a[0]||(a[0]=e=>z(u).form.name=e),type:"text",class:"form-input",placeholder:"Enter design name",required:""},null,512),[[C,z(u).form.name]])]),_("div",Ne,[a[21]||(a[21]=_("label",{for:"description",class:"form-label"},"Description",-1)),V(_("textarea",{id:"description","onUpdate:modelValue":a[1]||(a[1]=e=>z(u).form.description=e),class:"form-input",rows:"2",placeholder:"Optional description"},null,512),[[C,z(u).form.description]])])]),_("div",Be,[a[23]||(a[23]=_("h3",null,"Prompt Template",-1)),T(te,{modelValue:z(u).form.promptTemplate,"onUpdate:modelValue":a[2]||(a[2]=e=>z(u).form.promptTemplate=e),variables:z(u).detectedVariables.value,label:"Template",placeholder:"Hello {{name}}, tell me about {{topic}}...",required:""},null,8,["modelValue","variables"]),z(u).templateValidation.value.isValid?k("",!0):(h(),y("div",Me,[_("ul",null,[(h(!0),y(S,null,R(z(u).templateValidation.value.errors,e=>(h(),y("li",{key:e},w(e),1))),128))])]))]),z(u).detectedVariables.value.length>0?(h(),y("div",Oe,[a[24]||(a[24]=_("h3",null,"Variable Configuration",-1)),a[25]||(a[25]=_("div",{class:"variables-info"},[_("p",null,"Configure how each variable will be populated during trials.")],-1)),T(Pe,{variables:z(u).detectedVariables.value,"variable-arrays":z(u).variableArrays.value,"variable-list-refs":z(u).variableListRefs.value,"variable-list-sources":z(u).variableListSources.value,"onUpdate:variableArrays":a[3]||(a[3]=e=>z(u).variableArrays.value=e),"onUpdate:variableListRefs":a[4]||(a[4]=e=>z(u).variableListRefs.value=e),"onUpdate:variableListSources":a[5]||(a[5]=e=>z(u).variableListSources.value=e)},null,8,["variables","variable-arrays","variable-list-refs","variable-list-sources"])])):k("",!0),_("div",Ke,[a[32]||(a[32]=_("h3",null,"Output Configuration",-1)),_("div",qe,[a[27]||(a[27]=_("label",{for:"outputType",class:"form-label"},"Output Type",-1)),V(_("select",{id:"outputType","onUpdate:modelValue":a[6]||(a[6]=e=>z(u).form.outputType=e),class:"form-input"},a[26]||(a[26]=[_("option",{value:"text"},"Text",-1),_("option",{value:"number"},"Number",-1),_("option",{value:"boolean"},"Boolean",-1)]),512),[[P,z(u).form.outputType]])]),_("div",He,[a[29]||(a[29]=_("label",{for:"extractPattern",class:"form-label"},[x(" Extract Pattern "),_("span",{class:"helper-text"},"(Regex to extract specific content)")],-1)),_("div",Je,[V(_("select",{"onUpdate:modelValue":a[7]||(a[7]=e=>J.value=e),class:"form-select",onChange:G},[a[28]||(a[28]=_("option",{value:""},"Select a preset...",-1)),(h(!0),y(S,null,R(z(H),e=>(h(),y("option",{key:e.value,value:e.value},w(e.label),9,Ye))),128))],544),[[P,J.value]]),V(_("input",{id:"extractPattern","onUpdate:modelValue":a[8]||(a[8]=e=>z(u).form.extractPattern=e),type:"text",class:"form-input",placeholder:"Leave blank for full response"},null,512),[[C,z(u).form.extractPattern]])]),Y.value?(h(),y("div",Ge,w(Y.value),1)):k("",!0)]),_("div",Xe,[a[31]||(a[31]=_("label",{for:"refusalWords",class:"form-label"},[x(" Refusal Words "),_("span",{class:"helper-text"},"(Words indicating model refusal)")],-1)),T(we,{values:z(u).form.refusalWords,"list-ref":z(u).form.refusalWordsListRef,"list-name":X(),source:z(u).form.refusalWordsSource||void 0,placeholder:"Add refusal words (e.g., cannot, unable, refuse)...","preview-values":Q(),"total-count":Z(),"onUpdate:values":a[9]||(a[9]=e=>z(u).form.refusalWords=e),onClearSource:a[10]||(a[10]=e=>z(u).form.refusalWordsSource=null),onClearList:a[11]||(a[11]=e=>(u.form.refusalWordsListRef="",void(u.form.refusalWords=[]))),onSelectList:a[12]||(a[12]=e=>q.value=!0)},null,8,["values","list-ref","list-name","source","preview-values","total-count"]),_("div",Qe,[_("label",null,[V(_("input",{"onUpdate:modelValue":a[13]||(a[13]=e=>z(u).form.rejectRefusalWords=e),type:"checkbox"},null,512),[[$,z(u).form.rejectRefusalWords]]),a[30]||(a[30]=x(" Reject outputs containing refusal words "))])])])]),z(u).errors.value.length>0?(h(),y("div",Ze,[a[33]||(a[33]=_("strong",null,"Please fix the following errors:",-1)),_("ul",null,[(h(!0),y(S,null,R(z(u).errors.value,e=>(h(),y("li",{key:e},w(e),1))),128))])])):k("",!0)],32)]),_:1},8,["model-value","title"]),T(Ue,{modelValue:q.value,"onUpdate:modelValue":a[17]||(a[17]=e=>q.value=e),"list-type":"refusal",onSelect:ee},null,8,["modelValue"]),T(B,{modelValue:v.value,"onUpdate:modelValue":a[19]||(a[19]=e=>v.value=e),title:"Cost Estimation",size:"full"},{footer:I(()=>[T(N,{onClick:a[18]||(a[18]=e=>v.value=!1)},{default:I(()=>a[42]||(a[42]=[x(" Close ")])),_:1,__:[42]})]),default:I(()=>[_("div",ra,[_("div",ia,[_("h4",null,[a[36]||(a[36]=x("Token Analysis ")),g.value?.isAccurate?(h(),y("span",oa,"Accurate")):k("",!0)]),g.value?(h(),y("div",na,[_("div",ua,[a[37]||(a[37]=_("span",{class:"label"},"Min tokens/prompt:",-1)),_("span",da,w(g.value.minTokens),1)]),_("div",ca,[a[38]||(a[38]=_("span",{class:"label"},"Max tokens/prompt:",-1)),_("span",va,w(g.value.maxTokens),1)]),_("div",pa,[a[39]||(a[39]=_("span",{class:"label"},"Avg tokens/prompt:",-1)),_("span",fa,w(g.value.avgTokens),1)]),_("div",ma,[a[40]||(a[40]=_("span",{class:"label"},"Sample size:",-1)),_("span",ba,w(g.value.sampleSize),1)])])):L.value?(h(),y("div",ga,[a[41]||(a[41]=_("div",{class:"warning-box"},[_("strong",null,"Note:"),x(" Using accurate tiktoken encoding. This may take a moment for designs with many variables. ")],-1)),_("div",ya,[T(t,{size:"small"}),W.value?(h(),y("span",ha,[x(w(W.value.message)+" ",1),W.value.total>0?(h(),y("span",ka," ("+w(W.value.current)+"/"+w(W.value.total)+") ",1)):k("",!0)])):(h(),y("span",_a,"Initializing..."))])])):(h(),y("div",xa," Failed to calculate token counts "))]),_("div",wa,[_("h4",null,"Cost per Model ("+w(z(u).permutationInfo.value.formatted)+" combinations)",1),T(M,{models:D.value,"is-loading":E.value,"total-calls":z(u).permutationInfo.value.total,design:K.value,"model-params":{}},null,8,["models","is-loading","total-calls","design"])])])]),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-3b7e0bf8"]]),Va={class:"import-defaults-content"},Ca={class:"section-header"},Sa={class:"item-content"},Ra={class:"item-header"},Wa={class:"item-description"},Ta={class:"item-meta"},Ia={class:"section-header"},Aa={class:"item-content"},Ea={class:"item-header"},Ua={class:"item-description"},Da={class:"item-meta"},ja={class:"import-actions"},za=r(g({__name:"ImportDefaultsModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","imported"],setup(a,{emit:t}){const l=a,r=t,o=e(),n=s(),u=m({get:()=>l.modelValue,set:e=>r("update:modelValue",e)}),d=f("designs"),c=f(!1),v=f(!1),p=f(new Set),g=f(new Set),L=f({}),V=f({}),C=f(!1),W=f(!1),E=m(()=>K),U=m(()=>q),D=m(()=>{const e=Object.values(L.value).some(e=>e),a=Object.values(V.value).some(e=>e);return e||a});async function z(){c.value=!0;try{const e=await o.getAllDesigns(),a=await n.getAllLists();p.value=new Set(e.map(e=>e.name)),g.value=new Set(a.map(e=>e.name)),L.value={},V.value={},K.forEach(e=>{L.value[e.name]=!1}),q.forEach(e=>{V.value[e.name]=!1})}finally{c.value=!1}}function P(){K.forEach(e=>{p.value.has(e.name)||(L.value[e.name]=C.value)})}function $(){q.forEach(e=>{g.value.has(e.name)||(V.value[e.name]=W.value)})}async function N(){v.value=!0;try{const e={};let a=0;for(const s of q)if(V.value[s.name]){const t=await n.createList({...s});e[s.name]=t,a++}else if(g.value.has(s.name)){const a=(await n.getAllLists()).find(e=>e.name===s.name);a&&(e[s.name]=a.id)}else{const a=(await n.getAllLists()).find(e=>e.name===s.name);a&&(e[s.name]=a.id)}let t=0;for(const s of K)if(L.value[s.name]){const a={...s.variableBindings};for(const[,t]of Object.entries(a))"list"===t.type&&t.listName&&(t.listId=e[t.listName]||"");let l=s.refusalWordsListRef;!l&&s.refusalWords&&(l=e["Standard Refusal Patterns"]),await o.createDesign({...s,variableBindings:a,refusalWordsListRef:l}),t++}const l=[];t>0&&l.push(`${t} designs`),a>0&&l.push(`${a} variable lists`),l.length>0?i.success(`Successfully imported ${l.join(" and ")}`):i.info("No items were selected for import"),r("imported"),B()}catch(e){console.error("Import failed:",e),i.error("Failed to import selected items")}finally{v.value=!1}}function B(){u.value=!1}function M(e){switch(e){case"attributed":return"blue";case"refusal":return"red";default:return"green"}}return j(async()=>{await z()}),b(()=>l.modelValue,e=>{e&&z()}),(e,a)=>{const t=F("a-alert"),l=F("a-checkbox"),s=F("a-tag"),r=F("a-list-item"),i=F("a-list"),o=F("a-tab-pane"),n=F("a-tabs"),f=F("a-button"),m=F("a-space"),b=F("a-modal");return h(),A(b,{open:u.value,"onUpdate:open":a[3]||(a[3]=e=>u.value=e),title:"Import Default Designs & Variables",width:"95vw",footer:null,onCancel:B,centered:!0,"body-style":{height:"90vh",overflow:"auto"}},{default:I(()=>[_("div",Va,[T(t,{type:"info",message:"Import pre-configured designs and variable lists",description:"Select which default designs and variable lists you want to import. These are carefully crafted templates for common AI bias testing scenarios.","show-icon":!0,style:{"margin-bottom":"24px"}}),T(n,{activeKey:d.value,"onUpdate:activeKey":a[2]||(a[2]=e=>d.value=e)},{default:I(()=>[T(o,{key:"designs",tab:"Designs"},{default:I(()=>[_("div",Ca,[a[5]||(a[5]=_("h4",null,"Available Designs",-1)),T(l,{checked:C.value,"onUpdate:checked":a[0]||(a[0]=e=>C.value=e),onChange:P},{default:I(()=>a[4]||(a[4]=[x(" Select All ")])),_:1,__:[4]},8,["checked"])]),T(i,{"data-source":E.value,loading:c.value,size:"small",class:"import-list"},{renderItem:I(({item:e})=>[T(r,null,{default:I(()=>[T(l,{checked:L.value[e.name],"onUpdate:checked":a=>L.value[e.name]=a,disabled:p.value.has(e.name)},{default:I(()=>[_("div",Sa,[_("div",Ra,[_("strong",null,w(e.name),1),p.value.has(e.name)?(h(),A(s,{key:0,size:"small",color:"orange"},{default:I(()=>a[6]||(a[6]=[x(" Already Exists ")])),_:1,__:[6]})):k("",!0)]),_("div",Wa,w(e.description),1),_("div",Ta,[(h(!0),y(S,null,R(Object.keys(e.variableBindings),e=>(h(),A(s,{key:e,size:"small"},{default:I(()=>[x(w(e),1)]),_:2},1024))),128))])])]),_:2},1032,["checked","onUpdate:checked","disabled"])]),_:2},1024)]),_:1},8,["data-source","loading"])]),_:1}),T(o,{key:"variables",tab:"Variable Lists"},{default:I(()=>[_("div",Ia,[a[8]||(a[8]=_("h4",null,"Available Variable Lists",-1)),T(l,{checked:W.value,"onUpdate:checked":a[1]||(a[1]=e=>W.value=e),onChange:$},{default:I(()=>a[7]||(a[7]=[x(" Select All ")])),_:1,__:[7]},8,["checked"])]),T(i,{"data-source":U.value,loading:c.value,size:"small",class:"import-list"},{renderItem:I(({item:e})=>[T(r,null,{default:I(()=>[T(l,{checked:V.value[e.name],"onUpdate:checked":a=>V.value[e.name]=a,disabled:g.value.has(e.name)},{default:I(()=>[_("div",Aa,[_("div",Ea,[_("strong",null,w(e.name),1),T(s,{size:"small",color:M(e.category)},{default:I(()=>[x(w(e.category),1)]),_:2},1032,["color"]),g.value.has(e.name)?(h(),A(s,{key:0,size:"small",color:"orange"},{default:I(()=>a[9]||(a[9]=[x(" Already Exists ")])),_:1,__:[9]})):k("",!0)]),_("div",Ua,w(e.description),1),_("div",Da,w(e.itemCount)+" items ",1)])]),_:2},1032,["checked","onUpdate:checked","disabled"])]),_:2},1024)]),_:1},8,["data-source","loading"])]),_:1})]),_:1},8,["activeKey"]),_("div",ja,[T(m,null,{default:I(()=>[T(f,{onClick:B},{default:I(()=>a[10]||(a[10]=[x("Cancel")])),_:1,__:[10]}),T(f,{type:"primary",onClick:N,loading:v.value,disabled:!D.value},{default:I(()=>a[11]||(a[11]=[x(" Import Selected ")])),_:1,__:[11]},8,["loading","disabled"])]),_:1})])])]),_:1},8,["open"])}}}),[["__scopeId","data-v-b9a38185"]]),Pa={class:"designs-view"},$a={class:"page-header"},Fa={key:0,class:"design-info"},Na={class:"design-name"},Ba={class:"design-meta"},Ma={class:"text-secondary"},Oa={key:1,class:"variables-list"},Ka={key:0,class:"text-secondary"},qa={key:0,class:"token-info"},Ha={class:"token-count"},Ja={key:0,class:"approx-indicator",title:"Approximated"},Ya={key:1,class:"text-secondary"},Ga={key:3,class:"stats-info"},Xa=r(g({__name:"DesignsView",setup(t){const l=e(),r=s(),i=f(!1),p=f(),m=f(!1),b=[{title:"Design",key:"name",width:350},{title:"Variables",key:"variables",width:300},{title:"Token Est.",key:"tokens",width:120,align:"center"},{title:"Usage",key:"stats",width:150,align:"center"},{title:"Created",key:"created",width:120,sorter:(e,a)=>e.created.getTime()-a.created.getTime()},{title:"Actions",key:"actions",width:150,align:"center"}];function g(e){p.value=e,i.value=!0}function L(){p.value=void 0,i.value=!1}function V(){m.value=!1}function C(e,a){switch(e){case"duplicate":!async function(e){try{g(await l.duplicateDesign(e))}catch(a){console.error("Failed to duplicate design:",a)}}(a.id);break;case"delete":!async function(e){if(confirm("Are you sure you want to delete this design?"))try{await l.deleteDesign(e)}catch(a){console.error("Failed to delete design:",a),alert(a instanceof Error?a.message:"Failed to delete design")}}(a.id)}}function W(e){if(!e.promptTemplate)return[];return a.extractVariables(e.promptTemplate).map(e=>`{{${e}}}`)}return j(async()=>{await l.initialize(),await r.initialize()}),(e,a)=>{const t=F("a-button"),s=F("a-space"),r=F("a-spin"),f=F("a-alert"),E=F("a-empty"),U=F("a-tag"),D=F("a-menu-item"),j=F("a-menu-divider"),P=F("a-menu"),$=F("a-dropdown"),N=F("a-table");return h(),y("div",Pa,[_("div",$a,[a[8]||(a[8]=_("div",{class:"header-content"},[_("h1",null,"Prompt Designs"),_("p",{class:"description"},"Create and manage prompt templates for systematic testing")],-1)),T(s,null,{default:I(()=>[T(t,{onClick:a[0]||(a[0]=e=>m.value=!0)},{icon:I(()=>[T(z(o))]),default:I(()=>[a[6]||(a[6]=x(" Import Defaults "))]),_:1,__:[6]}),T(t,{type:"primary",onClick:a[1]||(a[1]=e=>i.value=!0)},{icon:I(()=>[T(z(n))]),default:I(()=>[a[7]||(a[7]=x(" Create Design "))]),_:1,__:[7]})]),_:1})]),z(l).isLoading?(h(),A(r,{key:0,size:"large",tip:"Loading designs..."},{default:I(()=>a[9]||(a[9]=[_("div",{style:{"min-height":"200px"}},null,-1)])),_:1,__:[9]})):z(l).error?(h(),A(f,{key:1,type:"error",message:z(l).error,class:"error-alert"},null,8,["message"])):0===z(l).designs.length?(h(),A(E,{key:2,description:"No designs yet. Create your first prompt design to start testing."},{image:I(()=>a[10]||(a[10]=[_("div",{style:{color:"#bfbfbf","font-size":"48px"}},"📝",-1)])),default:I(()=>[T(t,{type:"primary",onClick:a[2]||(a[2]=e=>i.value=!0)},{default:I(()=>a[11]||(a[11]=[x(" Create Your First Design ")])),_:1,__:[11]})]),_:1})):(h(),A(N,{key:3,columns:b,"data-source":z(l).designsWithStats,pagination:!1,size:"small",scroll:{y:"calc(100vh - 180px)"},"row-key":"id",class:"designs-table"},{bodyCell:I(({column:e,record:l})=>{return["name"===e.key?(h(),y("div",Fa,[_("strong",Na,w(l.name),1),_("div",Ba,[_("small",Ma,w(l.description||"No description"),1)])])):k("",!0),"variables"===e.key?(h(),y("div",Oa,[(h(!0),y(S,null,R(W(l),e=>(h(),A(U,{key:e,size:"small",color:"blue"},{default:I(()=>[x(w(e),1)]),_:2},1024))),128)),0===W(l).length?(h(),y("span",Ka,"None")):k("",!0)])):k("",!0),"tokens"===e.key?(h(),y(S,{key:2},[l.tokenEstimate?(h(),y("div",qa,[_("span",Ha,"~"+w(l.tokenEstimate.avgTokens),1),l.tokenEstimate.isAccurate?k("",!0):(h(),y("span",Ja,"*"))])):(h(),y("span",Ya,"-"))],64)):k("",!0),"stats"===e.key?(h(),y("div",Ga,[_("span",null,w(l.usedInTrials||0)+" trials",1),a[12]||(a[12]=_("span",{class:"separator"},"•",-1)),_("span",null,w(l.totalApiCalls||0)+" calls",1)])):k("",!0),"created"===e.key?(h(),y(S,{key:4},[x(w((r=l.created,r.toLocaleDateString())),1)],64)):k("",!0),"actions"===e.key?(h(),A(s,{key:5,size:"small"},{default:I(()=>[T(t,{size:"small",onClick:e=>g(l.id)},{icon:I(()=>[T(z(u))]),default:I(()=>[a[13]||(a[13]=x(" Edit "))]),_:2,__:[13]},1032,["onClick"]),T($,{trigger:["click"]},{overlay:I(()=>[T(P,{onClick:e=>C(e.key,l)},{default:I(()=>[T(D,{key:"duplicate"},{default:I(()=>[T(z(c)),a[15]||(a[15]=x(" Duplicate "))]),_:1,__:[15]}),T(j),T(D,{key:"delete",danger:""},{default:I(()=>[T(z(v)),a[16]||(a[16]=x(" Delete "))]),_:1,__:[16]})]),_:2},1032,["onClick"])]),default:I(()=>[T(t,{size:"small"},{default:I(()=>[a[14]||(a[14]=x(" More ")),T(z(d))]),_:1,__:[14]})]),_:2},1024)]),_:2},1024)):k("",!0)];var r}),_:1},8,["data-source"])),i.value?(h(),A(La,{key:4,modelValue:i.value,"onUpdate:modelValue":[a[3]||(a[3]=e=>i.value=e),a[4]||(a[4]=e=>{e||(p.value=void 0)})],"design-id":p.value,onSaved:L},null,8,["modelValue","design-id"])):k("",!0),T(za,{modelValue:m.value,"onUpdate:modelValue":a[5]||(a[5]=e=>m.value=e),onImported:V},null,8,["modelValue"])])}}}),[["__scopeId","data-v-3007efc0"]]);export{Xa as default};
