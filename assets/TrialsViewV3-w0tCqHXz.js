const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/trial-bundle.service-qByMZ3OU.js","assets/index-BCXGKdWh.js","assets/vue-vendor-DPw1dQYc.js","assets/ui-vendor-IRGmExUJ.js","assets/utils-vendor-B76-F3_P.js","assets/index-DaHEOU6Y.css","assets/data-vendor-BIyl9aCN.js","assets/index-BPEpZwZF.js","assets/toast-CdlfWUDp.js","assets/useCostEstimation-BcnLfgfc.js","assets/ParserSelector-n9LFzuUv.js","assets/parser.store-RrtULxQD.js","assets/ParserSelector-DMLEdzpb.css","assets/trial-stream-manager-v4-CCMDvXc-.js","assets/execution-control-v4-BFcvTg8y.js","assets/useV4TrialCommands-CbCetzDS.js","assets/useHeatmapStylingV3-CCIdVOn4.js","assets/useV4Models-CshYo1LC.js","assets/useV4LiveQuery-Do0jdBW3.js"])))=>i.map(i=>d[i]);
var ws=Object.defineProperty;var ks=(l,e,t)=>e in l?ws(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var De=(l,e,t)=>ks(l,typeof e!="symbol"?e+"":e,t);import{d as re,f as q,c as M,o as $e,b as Fe,w as ie,R as f,a0 as se,S as s,_ as R,a9 as Ne,a3 as pe,Y as r,y as Oe,aa as Ss,ab as Is,ac as Es,$ as Q,ad as Fs,ae as Rs,af as Zt,q as es,n as Le,k as S,Z as x,F as Z,W as te,a5 as Vt,ag as xs,ah as Ps,u as W,a4 as ht,V as b,G as D,M as je,ai as He,U as ts,B as Ie,A as ss,aj as As,r as Vs,a7 as Os,a1 as as,X as ot,a6 as yt}from"./vue-vendor-DPw1dQYc.js";import{t as _e}from"./toast-CdlfWUDp.js";import{j as ue,a as P,u as Ds,b as Ot,I as Qe,J as Ns,H as Ls,_ as Me,d as ze,K as Ms,e as Dt,L as Us}from"./index-BCXGKdWh.js";import{aH as ns,z as os,aS as zs,n as we,P as Bs,aT as ls,aU as Ws,s as Et,az as js,M as Ft,t as Rt,v as Hs,a1 as is,I as Nt,aV as qs,aa as Gs,av as Js,aM as rs,V as Xs,aI as Ks,X as Ys,C as xt,r as Qs,w as Zs,x as Ae,ax as us,aN as Be,T as lt,J as it,D as ea,N as le,aJ as ta,am as ds,a5 as sa,a6 as aa,a4 as cs,aW as na,ai as ps,E as fs,ak as oa,al as la,G as ia,o as ra,aA as ua,aX as Lt,R as da,Y as ca,au as Pt,aw as pa,aY as At,m as ms,a0 as fa}from"./ui-vendor-IRGmExUJ.js";import{b as vs}from"./utils-vendor-B76-F3_P.js";import{u as rt}from"./useCostEstimation-BcnLfgfc.js";import{P as ma}from"./ParserSelector-n9LFzuUv.js";import{u as ut,a as gs}from"./trial-stream-manager-v4-CCMDvXc-.js";import{u as va}from"./parser.store-RrtULxQD.js";import{v as Mt,u as ga,a as ha,b as ya}from"./useV4TrialCommands-CbCetzDS.js";import{u as ba}from"./useHeatmapStylingV3-CCIdVOn4.js";import{u as mt,w as _a}from"./data-vendor-BIyl9aCN.js";import{u as Ta}from"./execution-control-v4-BFcvTg8y.js";import{u as Ca}from"./useV4Models-CshYo1LC.js";const $a={class:"right-panel"},wa=re({__name:"ResizablePanelContainer",props:{storageKey:{default:"trial-list-width"},defaultWidth:{default:250},minWidth:{default:200},maxWidth:{default:600},mobileBreakpoint:{default:768}},emits:["resize","mobile-overlay-change"],setup(l,{expose:e,emit:t}){const a=l,o=t,n=q(a.defaultWidth),u=q(!1),d=q(0),p=q(0),c=q(window.innerWidth),g=q(!1),_=M(()=>c.value<a.mobileBreakpoint),h=M(()=>_.value?{width:`${Math.min(c.value*.85,400)}px`}:{width:`${n.value}px`});function k(){const $=localStorage.getItem(a.storageKey);if($){const m=parseInt($,10);!isNaN(m)&&m>=a.minWidth&&m<=a.maxWidth&&(n.value=m)}}function C($){localStorage.setItem(a.storageKey,$.toString()),o("resize",$)}function T($){u.value=!0,d.value=$.clientX,p.value=n.value,document.addEventListener("mousemove",U),document.addEventListener("mouseup",N),document.body.style.userSelect="none",document.body.style.cursor="col-resize"}function U($){if(!u.value)return;const m=$.clientX-d.value,L=Math.max(a.minWidth,Math.min(a.maxWidth,p.value+m));n.value=L}function N(){u.value&&(u.value=!1,C(n.value),document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",N),document.body.style.userSelect="",document.body.style.cursor="")}function V(){n.value=a.defaultWidth,C(a.defaultWidth)}function I(){c.value=window.innerWidth,!_.value&&g.value&&(g.value=!1,o("mobile-overlay-change",!1))}function w(){_.value&&(g.value=!g.value,o("mobile-overlay-change",g.value))}function O(){g.value=!1,o("mobile-overlay-change",!1)}return e({toggleMobileOverlay:w,closeMobileOverlay:O}),$e(()=>{k(),window.addEventListener("resize",I)}),Fe(()=>{window.removeEventListener("resize",I),N()}),ie(()=>a.defaultWidth,$=>{n.value===a.defaultWidth&&(n.value=$)}),($,m)=>(r(),f("div",{class:se(["resizable-panel-container",{"mobile-overlay":_.value}])},[s("div",{class:se(["left-panel",{"overlay-visible":_.value&&g.value}]),style:pe(h.value)},[Ne($.$slots,"left",{},void 0,!0)],6),_.value?R("",!0):(r(),f("div",{key:0,class:se(["resize-handle",{dragging:u.value}]),onMousedown:T,onDblclick:V},m[0]||(m[0]=[s("div",{class:"handle-bar"},null,-1)]),34)),s("div",$a,[Ne($.$slots,"right",{},void 0,!0)]),_.value&&g.value?(r(),f("div",{key:1,class:"mobile-overlay-bg",onClick:O})):R("",!0)],2))}}),ka=ue(wa,[["__scopeId","data-v-949e1df1"]]);function Sa(){var l=window.navigator.userAgent,e=l.indexOf("MSIE ");if(e>0)return parseInt(l.substring(e+5,l.indexOf(".",e)),10);var t=l.indexOf("Trident/");if(t>0){var a=l.indexOf("rv:");return parseInt(l.substring(a+3,l.indexOf(".",a)),10)}var o=l.indexOf("Edge/");return o>0?parseInt(l.substring(o+5,l.indexOf(".",o)),10):-1}let et;function bt(){bt.init||(bt.init=!0,et=Sa()!==-1)}var dt={name:"ResizeObserver",props:{emitOnMount:{type:Boolean,default:!1},ignoreWidth:{type:Boolean,default:!1},ignoreHeight:{type:Boolean,default:!1}},emits:["notify"],mounted(){bt(),Oe(()=>{this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitOnMount&&this.emitSize()});const l=document.createElement("object");this._resizeObject=l,l.setAttribute("aria-hidden","true"),l.setAttribute("tabindex",-1),l.onload=this.addResizeHandlers,l.type="text/html",et&&this.$el.appendChild(l),l.data="about:blank",et||this.$el.appendChild(l)},beforeUnmount(){this.removeResizeHandlers()},methods:{compareAndNotify(){(!this.ignoreWidth&&this._w!==this.$el.offsetWidth||!this.ignoreHeight&&this._h!==this.$el.offsetHeight)&&(this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitSize())},emitSize(){this.$emit("notify",{width:this._w,height:this._h})},addResizeHandlers(){this._resizeObject.contentDocument.defaultView.addEventListener("resize",this.compareAndNotify),this.compareAndNotify()},removeResizeHandlers(){this._resizeObject&&this._resizeObject.onload&&(!et&&this._resizeObject.contentDocument&&this._resizeObject.contentDocument.defaultView.removeEventListener("resize",this.compareAndNotify),this.$el.removeChild(this._resizeObject),this._resizeObject.onload=null,this._resizeObject=null)}}};const Ia=Es();Ss("data-v-b329ee4c");const Ea={class:"resize-observer",tabindex:"-1"};Is();const Fa=Ia((l,e,t,a,o,n)=>(r(),Q("div",Ea)));dt.render=Fa;dt.__scopeId="data-v-b329ee4c";dt.__file="src/components/ResizeObserver.vue";function tt(l){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?tt=function(e){return typeof e}:tt=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tt(l)}function Ra(l,e){if(!(l instanceof e))throw new TypeError("Cannot call a class as a function")}function xa(l,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(l,a.key,a)}}function Pa(l,e,t){return e&&xa(l.prototype,e),l}function Ut(l){return Aa(l)||Va(l)||Oa(l)||Da()}function Aa(l){if(Array.isArray(l))return _t(l)}function Va(l){if(typeof Symbol<"u"&&Symbol.iterator in Object(l))return Array.from(l)}function Oa(l,e){if(l){if(typeof l=="string")return _t(l,e);var t=Object.prototype.toString.call(l).slice(8,-1);if(t==="Object"&&l.constructor&&(t=l.constructor.name),t==="Map"||t==="Set")return Array.from(l);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _t(l,e)}}function _t(l,e){(e==null||e>l.length)&&(e=l.length);for(var t=0,a=new Array(e);t<e;t++)a[t]=l[t];return a}function Da(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Na(l){var e;return typeof l=="function"?e={callback:l}:e=l,e}function La(l,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a,o,n,u=function(p){for(var c=arguments.length,g=new Array(c>1?c-1:0),_=1;_<c;_++)g[_-1]=arguments[_];if(n=g,!(a&&p===o)){var h=t.leading;typeof h=="function"&&(h=h(p,o)),(!a||p!==o)&&h&&l.apply(void 0,[p].concat(Ut(n))),o=p,clearTimeout(a),a=setTimeout(function(){l.apply(void 0,[p].concat(Ut(n))),a=0},e)}};return u._clear=function(){clearTimeout(a),a=null},u}function hs(l,e){if(l===e)return!0;if(tt(l)==="object"){for(var t in l)if(!hs(l[t],e[t]))return!1;return!0}return!1}var Ma=(function(){function l(e,t,a){Ra(this,l),this.el=e,this.observer=null,this.frozen=!1,this.createObserver(t,a)}return Pa(l,[{key:"createObserver",value:function(t,a){var o=this;if(this.observer&&this.destroyObserver(),!this.frozen){if(this.options=Na(t),this.callback=function(d,p){o.options.callback(d,p),d&&o.options.once&&(o.frozen=!0,o.destroyObserver())},this.callback&&this.options.throttle){var n=this.options.throttleOptions||{},u=n.leading;this.callback=La(this.callback,this.options.throttle,{leading:function(p){return u==="both"||u==="visible"&&p||u==="hidden"&&!p}})}this.oldResult=void 0,this.observer=new IntersectionObserver(function(d){var p=d[0];if(d.length>1){var c=d.find(function(_){return _.isIntersecting});c&&(p=c)}if(o.callback){var g=p.isIntersecting&&p.intersectionRatio>=o.threshold;if(g===o.oldResult)return;o.oldResult=g,o.callback(g,p)}},this.options.intersection),Oe(function(){o.observer&&o.observer.observe(o.el)})}}},{key:"destroyObserver",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null),this.callback&&this.callback._clear&&(this.callback._clear(),this.callback=null)}},{key:"threshold",get:function(){return this.options.intersection&&typeof this.options.intersection.threshold=="number"?this.options.intersection.threshold:0}}]),l})();function ys(l,e,t){var a=e.value;if(a)if(typeof IntersectionObserver>"u")console.warn("[vue-observe-visibility] IntersectionObserver API is not available in your browser. Please install this polyfill: https://github.com/w3c/IntersectionObserver/tree/master/polyfill");else{var o=new Ma(l,a,t);l._vue_visibilityState=o}}function Ua(l,e,t){var a=e.value,o=e.oldValue;if(!hs(a,o)){var n=l._vue_visibilityState;if(!a){bs(l);return}n?n.createObserver(a,t):ys(l,{value:a},t)}}function bs(l){var e=l._vue_visibilityState;e&&(e.destroyObserver(),delete l._vue_visibilityState)}var za={beforeMount:ys,updated:Ua,unmounted:bs},Ba={itemsLimit:1e3},Wa=/(auto|scroll)/;function _s(l,e){return l.parentNode===null?e:_s(l.parentNode,e.concat([l]))}var vt=function(e,t){return getComputedStyle(e,null).getPropertyValue(t)},ja=function(e){return vt(e,"overflow")+vt(e,"overflow-y")+vt(e,"overflow-x")},Ha=function(e){return Wa.test(ja(e))};function zt(l){if(l instanceof HTMLElement||l instanceof SVGElement){for(var e=_s(l.parentNode,[]),t=0;t<e.length;t+=1)if(Ha(e[t]))return e[t];return document.scrollingElement||document.documentElement}}function Tt(l){"@babel/helpers - typeof";return Tt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tt(l)}var qa={items:{type:Array,required:!0},keyField:{type:String,default:"id"},direction:{type:String,default:"vertical",validator:function(e){return["vertical","horizontal"].includes(e)}},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"}};function Ga(){return this.items.length&&Tt(this.items[0])!=="object"}var Ct=!1;if(typeof window<"u"){Ct=!1;try{var Ja=Object.defineProperty({},"passive",{get:function(){Ct=!0}});window.addEventListener("test",null,Ja)}catch{}}let Xa=0;var ct={name:"RecycleScroller",components:{ResizeObserver:dt},directives:{ObserveVisibility:za},props:{...qa,itemSize:{type:Number,default:null},gridItems:{type:Number,default:void 0},itemSecondarySize:{type:Number,default:void 0},minItemSize:{type:[Number,String],default:null},sizeField:{type:String,default:"size"},typeField:{type:String,default:"type"},buffer:{type:Number,default:200},pageMode:{type:Boolean,default:!1},prerender:{type:Number,default:0},emitUpdate:{type:Boolean,default:!1},updateInterval:{type:Number,default:0},skipHover:{type:Boolean,default:!1},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},listClass:{type:[String,Object,Array],default:""},itemClass:{type:[String,Object,Array],default:""}},emits:["resize","visible","hidden","update","scroll-start","scroll-end"],data(){return{pool:[],totalSize:0,ready:!1,hoverKey:null}},computed:{sizes(){if(this.itemSize===null){const l={"-1":{accumulator:0}},e=this.items,t=this.sizeField,a=this.minItemSize;let o=1e4,n=0,u;for(let d=0,p=e.length;d<p;d++)u=e[d][t]||a,u<o&&(o=u),n+=u,l[d]={accumulator:n,size:u};return this.$_computedMinItemSize=o,l}return[]},simpleArray:Ga,itemIndexByKey(){const{keyField:l,items:e}=this,t={};for(let a=0,o=e.length;a<o;a++)t[e[a][l]]=a;return t}},watch:{items(){this.updateVisibleItems(!0)},pageMode(){this.applyPageMode(),this.updateVisibleItems(!1)},sizes:{handler(){this.updateVisibleItems(!1)},deep:!0},gridItems(){this.updateVisibleItems(!0)},itemSecondarySize(){this.updateVisibleItems(!0)}},created(){this.$_startIndex=0,this.$_endIndex=0,this.$_views=new Map,this.$_unusedViews=new Map,this.$_scrollDirty=!1,this.$_lastUpdateScrollPosition=0,this.prerender&&(this.$_prerender=!0,this.updateVisibleItems(!1)),this.gridItems&&!this.itemSize&&console.error("[vue-recycle-scroller] You must provide an itemSize when using gridItems")},mounted(){this.applyPageMode(),this.$nextTick(()=>{this.$_prerender=!1,this.updateVisibleItems(!0),this.ready=!0})},activated(){const l=this.$_lastUpdateScrollPosition;typeof l=="number"&&this.$nextTick(()=>{this.scrollToPosition(l)})},beforeUnmount(){this.removeListeners()},methods:{addView(l,e,t,a,o){const n=Fs({id:Xa++,index:e,used:!0,key:a,type:o}),u=Rs({item:t,position:0,nr:n});return l.push(u),u},unuseView(l,e=!1){const t=this.$_unusedViews,a=l.nr.type;let o=t.get(a);o||(o=[],t.set(a,o)),o.push(l),e||(l.nr.used=!1,l.position=-9999)},handleResize(){this.$emit("resize"),this.ready&&this.updateVisibleItems(!1)},handleScroll(l){if(!this.$_scrollDirty){if(this.$_scrollDirty=!0,this.$_updateTimeout)return;const e=()=>requestAnimationFrame(()=>{this.$_scrollDirty=!1;const{continuous:t}=this.updateVisibleItems(!1,!0);t||(clearTimeout(this.$_refreshTimout),this.$_refreshTimout=setTimeout(this.handleScroll,this.updateInterval+100))});e(),this.updateInterval&&(this.$_updateTimeout=setTimeout(()=>{this.$_updateTimeout=0,this.$_scrollDirty&&e()},this.updateInterval))}},handleVisibilityChange(l,e){this.ready&&(l||e.boundingClientRect.width!==0||e.boundingClientRect.height!==0?(this.$emit("visible"),requestAnimationFrame(()=>{this.updateVisibleItems(!1)})):this.$emit("hidden"))},updateVisibleItems(l,e=!1){const t=this.itemSize,a=this.gridItems||1,o=this.itemSecondarySize||t,n=this.$_computedMinItemSize,u=this.typeField,d=this.simpleArray?null:this.keyField,p=this.items,c=p.length,g=this.sizes,_=this.$_views,h=this.$_unusedViews,k=this.pool,C=this.itemIndexByKey;let T,U,N,V,I;if(!c)T=U=V=I=N=0;else if(this.$_prerender)T=V=0,U=I=Math.min(this.prerender,p.length),N=null;else{const i=this.getScroll();if(e){let A=i.start-this.$_lastUpdateScrollPosition;if(A<0&&(A=-A),t===null&&A<n||A<t)return{continuous:!0}}this.$_lastUpdateScrollPosition=i.start;const j=this.buffer;i.start-=j,i.end+=j;let Y=0;if(this.$refs.before&&(Y=this.$refs.before.scrollHeight,i.start-=Y),this.$refs.after){const A=this.$refs.after.scrollHeight;i.end+=A}if(t===null){let A,X=0,v=c-1,y=~~(c/2),E;do E=y,A=g[y].accumulator,A<i.start?X=y:y<c-1&&g[y+1].accumulator>i.start&&(v=y),y=~~((X+v)/2);while(y!==E);for(y<0&&(y=0),T=y,N=g[c-1].accumulator,U=y;U<c&&g[U].accumulator<i.end;U++);for(U===-1?U=p.length-1:(U++,U>c&&(U=c)),V=T;V<c&&Y+g[V].accumulator<i.start;V++);for(I=V;I<c&&Y+g[I].accumulator<i.end;I++);}else{T=~~(i.start/t*a);const A=T%a;T-=A,U=Math.ceil(i.end/t*a),V=Math.max(0,Math.floor((i.start-Y)/t*a)),I=Math.floor((i.end-Y)/t*a),T<0&&(T=0),U>c&&(U=c),V<0&&(V=0),I>c&&(I=c),N=Math.ceil(c/a)*t}}U-T>Ba.itemsLimit&&this.itemsLimitError(),this.totalSize=N;let w;const O=T<=this.$_endIndex&&U>=this.$_startIndex;if(O)for(let i=0,j=k.length;i<j;i++)w=k[i],w.nr.used&&(l&&(w.nr.index=C[w.item[d]]),(w.nr.index==null||w.nr.index<T||w.nr.index>=U)&&this.unuseView(w));const $=O?null:new Map;let m,L,F;for(let i=T;i<U;i++){m=p[i];const j=d?m[d]:m;if(j==null)throw new Error(`Key is ${j} on item (keyField is '${d}')`);if(w=_.get(j),!t&&!g[i].size){w&&this.unuseView(w);continue}L=m[u];let Y=h.get(L),A=!1;if(!w)O?Y&&Y.length?w=Y.pop():w=this.addView(k,i,m,j,L):(F=$.get(L)||0,(!Y||F>=Y.length)&&(w=this.addView(k,i,m,j,L),this.unuseView(w,!0),Y=h.get(L)),w=Y[F],$.set(L,F+1)),_.delete(w.nr.key),w.nr.used=!0,w.nr.index=i,w.nr.key=j,w.nr.type=L,_.set(j,w),A=!0;else if(!w.nr.used&&(w.nr.used=!0,A=!0,Y)){const X=Y.indexOf(w);X!==-1&&Y.splice(X,1)}w.item=m,A&&(i===p.length-1&&this.$emit("scroll-end"),i===0&&this.$emit("scroll-start")),t===null?(w.position=g[i-1].accumulator,w.offset=0):(w.position=Math.floor(i/a)*t,w.offset=i%a*o)}return this.$_startIndex=T,this.$_endIndex=U,this.emitUpdate&&this.$emit("update",T,U,V,I),clearTimeout(this.$_sortTimer),this.$_sortTimer=setTimeout(this.sortViews,this.updateInterval+300),{continuous:O}},getListenerTarget(){let l=zt(this.$el);return window.document&&(l===window.document.documentElement||l===window.document.body)&&(l=window),l},getScroll(){const{$el:l,direction:e}=this,t=e==="vertical";let a;if(this.pageMode){const o=l.getBoundingClientRect(),n=t?o.height:o.width;let u=-(t?o.top:o.left),d=t?window.innerHeight:window.innerWidth;u<0&&(d+=u,u=0),u+d>n&&(d=n-u),a={start:u,end:u+d}}else t?a={start:l.scrollTop,end:l.scrollTop+l.clientHeight}:a={start:l.scrollLeft,end:l.scrollLeft+l.clientWidth};return a},applyPageMode(){this.pageMode?this.addListeners():this.removeListeners()},addListeners(){this.listenerTarget=this.getListenerTarget(),this.listenerTarget.addEventListener("scroll",this.handleScroll,Ct?{passive:!0}:!1),this.listenerTarget.addEventListener("resize",this.handleResize)},removeListeners(){this.listenerTarget&&(this.listenerTarget.removeEventListener("scroll",this.handleScroll),this.listenerTarget.removeEventListener("resize",this.handleResize),this.listenerTarget=null)},scrollToItem(l){let e;const t=this.gridItems||1;this.itemSize===null?e=l>0?this.sizes[l-1].accumulator:0:e=Math.floor(l/t)*this.itemSize,this.scrollToPosition(e)},scrollToPosition(l){const e=this.direction==="vertical"?{scroll:"scrollTop",start:"top"}:{scroll:"scrollLeft",start:"left"};let t,a,o;if(this.pageMode){const n=zt(this.$el),u=n.tagName==="HTML"?0:n[e.scroll],d=n.getBoundingClientRect(),c=this.$el.getBoundingClientRect()[e.start]-d[e.start];t=n,a=e.scroll,o=l+u+c}else t=this.$el,a=e.scroll,o=l;t[a]=o},itemsLimitError(){throw setTimeout(()=>{this.$el}),new Error("Rendered items limit reached")},sortViews(){this.pool.sort((l,e)=>l.nr.index-e.nr.index)}}};const Ka={key:0,ref:"before",class:"vue-recycle-scroller__slot"},Ya={key:1,ref:"after",class:"vue-recycle-scroller__slot"};function Qa(l,e,t,a,o,n){const u=Zt("ResizeObserver"),d=es("observe-visibility");return Le((r(),f("div",{class:se(["vue-recycle-scroller",{ready:o.ready,"page-mode":t.pageMode,[`direction-${l.direction}`]:!0}]),onScrollPassive:e[0]||(e[0]=(...p)=>n.handleScroll&&n.handleScroll(...p))},[l.$slots.before?(r(),f("div",Ka,[Ne(l.$slots,"before")],512)):R("v-if",!0),(r(),Q(Vt(t.listTag),{ref:"wrapper",style:pe({[l.direction==="vertical"?"minHeight":"minWidth"]:o.totalSize+"px"}),class:se(["vue-recycle-scroller__item-wrapper",t.listClass])},{default:x(()=>[(r(!0),f(Z,null,te(o.pool,p=>(r(),Q(Vt(t.itemTag),xs({key:p.nr.id,style:o.ready?{transform:`translate${l.direction==="vertical"?"Y":"X"}(${p.position}px) translate${l.direction==="vertical"?"X":"Y"}(${p.offset}px)`,width:t.gridItems?`${l.direction==="vertical"&&t.itemSecondarySize||t.itemSize}px`:void 0,height:t.gridItems?`${l.direction==="horizontal"&&t.itemSecondarySize||t.itemSize}px`:void 0}:null,class:["vue-recycle-scroller__item-view",[t.itemClass,{hover:!t.skipHover&&o.hoverKey===p.nr.key}]]},Ps(t.skipHover?{}:{mouseenter:()=>{o.hoverKey=p.nr.key},mouseleave:()=>{o.hoverKey=null}})),{default:x(()=>[Ne(l.$slots,"default",{item:p.item,index:p.nr.index,active:p.nr.used})]),_:2},1040,["style","class"]))),128)),Ne(l.$slots,"empty")]),_:3},8,["style","class"])),l.$slots.after?(r(),f("div",Ya,[Ne(l.$slots,"after")],512)):R("v-if",!0),S(u,{onNotify:n.handleResize},null,8,["onNotify"])],34)),[[d,n.handleVisibilityChange]])}ct.render=Qa;ct.__file="src/components/RecycleScroller.vue";const Za={class:"trial-list-search"},en=["value"],tn=re({__name:"TrialListSearch",props:{modelValue:{}},emits:["update:modelValue"],setup(l,{emit:e}){const t=e,a=q(),o=vs(c=>{t("update:modelValue",c)},300);function n(c){const g=c.target.value;o(g)}function u(){t("update:modelValue",""),a.value?.focus()}function d(){a.value?.focus(),a.value?.select()}function p(c){c.type==="focus-trial-search"&&d()}return $e(()=>{window.addEventListener("focus-trial-search",p)}),Fe(()=>{window.removeEventListener("focus-trial-search",p)}),(c,g)=>(r(),f("div",Za,[S(W(ns),{class:"search-icon"}),s("input",{ref_key:"searchInput",ref:a,type:"text",class:"search-input",placeholder:"Filter trials...",value:c.modelValue,onInput:n,onKeydown:ht(u,["escape"])},null,40,en),c.modelValue?(r(),Q(W(os),{key:0,class:"clear-icon",onClick:u})):R("",!0)]))}}),sn=ue(tn,[["__scopeId","data-v-3a032c2b"]]),an={class:"item-content"},nn={class:"item-header"},on=["title"],ln={key:0,class:"progress-bar"},rn={class:"item-metadata"},un={class:"meta-item"},dn={class:"meta-item"},cn={key:0,class:"meta-separator"},pn={key:1,class:"meta-item cost"},fn=re({__name:"TrialListItem",props:{trial:{},selected:{type:Boolean}},emits:["click"],setup(l){const e=l,{calculateTemplateTokens:t,calculatePromptTokens:a,estimateTotalCost:o,sumEstimates:n,formatCost:u}=rt(),d=M(()=>{if(e.trial.progress.total===0)return 0;const _=e.trial.progress.completed+e.trial.progress.failed;return Math.round(_/e.trial.progress.total*100)}),p=M(()=>{const{completed:_,failed:h,total:k}=e.trial.progress;return e.trial.status==="draft"?`${k} tasks`:`${_+h}/${k} tasks`}),c=M(()=>{const _=e.trial.started||e.trial.created;if(!_)return"";const k=new Date().getTime()-_.getTime(),C=Math.floor(k/1e3),T=Math.floor(C/60),U=Math.floor(T/60),N=Math.floor(U/24);return C<60?"now":T<60?`${T}m`:U<24?`${U}h`:`${N}d`}),g=M(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let _=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)_=t(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const C=a(e.trial.spreadsheetConfig.promptPattern),T=e.trial.progress.total/e.trial.configurations.length;_={totalTokens:C*T,combinationCount:T,perCallAverage:C}}else if(e.trial.type==="playground")return null;if(!_||_.totalTokens===0)return null;const h=e.trial.configurations.map(C=>{const T=C.modelSnapshot;return T?o(_.totalTokens,_.combinationCount,T,C.parameters):null}).filter(Boolean);if(h.length===0)return null;const k=n(h);return`${u(k,"compact")} total`});return(_,h)=>(r(),f("div",{class:se(["trial-list-item",{selected:_.selected,"has-progress":_.trial.status==="running"}]),onClick:h[0]||(h[0]=k=>_.$emit("click"))},[s("div",{class:se(["status-indicator",`status-${_.trial.status}`])},null,2),s("div",an,[s("div",nn,[s("span",{class:"trial-name",title:_.trial.name},b(_.trial.name),9,on),s("span",{class:se(["status-tag",`status-${_.trial.status}`])},b(_.trial.status.toUpperCase()),3)]),_.trial.status==="running"?(r(),f("div",ln,[s("div",{class:"progress-fill",style:pe({width:`${d.value}%`})},null,4)])):R("",!0),s("div",rn,[s("span",un,b(p.value),1),h[1]||(h[1]=s("span",{class:"meta-separator"},"â€¢",-1)),s("span",dn,b(c.value),1),g.value?(r(),f("span",cn,"â€¢")):R("",!0),g.value?(r(),f("span",pn,b(g.value),1)):R("",!0)])])],2))}}),Bt=ue(fn,[["__scopeId","data-v-037b1757"]]),mn={class:"section-title"},vn=re({__name:"TrialListSection",props:{title:{},background:{type:Boolean}},setup(l){return(e,t)=>(r(),f("div",{class:se(["trial-list-section",{"with-background":e.background}])},[s("span",mn,b(e.title),1)],2))}}),Wt=ue(vn,[["__scopeId","data-v-07a26c58"]]),gn={class:"panel-header"},hn={class:"header-title"},yn={key:0,class:"title-text"},bn={class:"trial-count"},_n={key:0,class:"header-actions"},Tn={class:"filter-count"},Cn={class:"filter-count"},$n={class:"filter-count"},wn={class:"filter-count"},kn={class:"filter-count"},Sn={key:1,class:"status-tabs"},In={class:"tab-count"},En={class:"tab-count"},Fn={class:"tab-count"},Rn={class:"trial-list-container"},xn={key:1,class:"trial-list"},Pn={key:2,class:"collapsed-list"},An=["onClick"],Vn={class:"collapsed-count"},On={key:3,class:"empty-state"},Dn=re({__name:"TrialListPanelV3",props:{trials:{},selectedTrialId:{},searchQuery:{},filterStatus:{}},emits:["select-trial","create-trial","import-trial","update-search","update-filter","refresh"],setup(l,{emit:e}){const t=l,a=e,o=q(!1),n=q("all"),u=q(250),d=M(()=>u.value<50),p=M(()=>t.trials.filter($=>$.status==="running"||$.status==="paused").length),c=M(()=>t.trials.filter($=>$.status==="completed"||$.status==="failed").length),g=M(()=>{let $=t.trials;if(t.searchQuery){const i=t.searchQuery.toLowerCase();$=$.filter(j=>{const Y=j.name.toLowerCase().includes(i),A=j.templateConfig?.template?.toLowerCase().includes(i),X=j.configurations.some(v=>v.modelId.toLowerCase().includes(i)||v.provider.toLowerCase().includes(i));return Y||A||X})}t.filterStatus!=="all"&&($=$.filter(i=>i.status===t.filterStatus)),n.value==="active"?$=$.filter(i=>i.status==="running"||i.status==="paused"):n.value==="done"&&($=$.filter(i=>i.status==="completed"||i.status==="failed"));const m=$.filter(i=>i.status==="running"),L=$.filter(i=>i.status!=="running"),F=[];return m.length>0&&(F.push({type:"section",title:"RUNNING",background:!0,id:"section-running"}),F.push(...m.sort((i,j)=>(j.started?.getTime()||0)-(i.started?.getTime()||0)))),L.length>0&&(m.length>0&&F.push({type:"section",title:"RECENT",background:!1,id:"section-recent"}),F.push(...L.sort((i,j)=>(j.created?.getTime()||0)-(i.created?.getTime()||0)))),F}),_=M(()=>g.value.map($=>({...$,height:N($)}))),h=M(()=>t.trials.filter($=>n.value==="active"?$.status==="running"||$.status==="paused":n.value==="done"?$.status==="completed"||$.status==="failed":!0)),k=M(()=>t.searchQuery?"No trials found":t.filterStatus==="running"?"No trials are currently running":"No trials found"),C=M(()=>t.searchQuery?"No trials match your search":t.filterStatus!=="all"?`No ${t.filterStatus} trials`:"Create your first trial to get started"),T=M(()=>t.filterStatus==="all"&&!t.searchQuery);function U($){return t.trials.filter(m=>m.status===$).length}function N($){if($.type==="section")return 32;const m=$.status==="running",L=$.configurations?.some(F=>F.repeatCount>1);return m||L?96:80}function V($){const m=$.progress.completed+$.progress.failed;return $.status==="running"?`${Math.round(m/$.progress.total*100)}%`:m.toString()}async function I(){o.value=!0;try{await new Promise($=>setTimeout($,500)),a("refresh")}finally{o.value=!1}}function w({key:$}){a("update-filter",$)}function O(){const $=document.querySelector(".trial-list-panel");$&&(u.value=$.clientWidth)}return $e(()=>{O(),window.addEventListener("resize",O);const $=document.querySelector(".trial-list-panel");$&&new ResizeObserver(()=>O()).observe($)}),Fe(()=>{window.removeEventListener("resize",O)}),($,m)=>{const L=we,F=Rt,i=Hs,j=Ft,Y=Et;return r(),f("div",{class:se(["trial-list-panel",{collapsed:d.value}])},[s("div",gn,[s("div",hn,[S(W(zs),{class:"title-icon"}),d.value?R("",!0):(r(),f("span",yn,"Trials")),s("span",bn,b($.trials.length),1)]),d.value?R("",!0):(r(),f("div",_n,[S(L,{type:"primary",size:"small",onClick:m[0]||(m[0]=A=>$.$emit("create-trial"))},{default:x(()=>[S(W(Bs)),m[7]||(m[7]=D(" New Trial "))]),_:1,__:[7]}),S(L,{size:"small",onClick:m[1]||(m[1]=A=>$.$emit("import-trial"))},{default:x(()=>[S(W(ls)),m[8]||(m[8]=D(" Import "))]),_:1,__:[8]}),S(L,{size:"small",onClick:I,loading:o.value},{default:x(()=>[S(W(Ws),{spin:o.value},null,8,["spin"])]),_:1},8,["loading"]),S(Y,null,{overlay:x(()=>[S(j,{onClick:w},{default:x(()=>[S(F,{key:"all"},{default:x(()=>m[9]||(m[9]=[s("span",null,"All Trials",-1)])),_:1,__:[9]}),S(i),S(F,{key:"running"},{default:x(()=>[m[10]||(m[10]=s("span",null,"Running Only",-1)),s("span",Tn,b(U("running")),1)]),_:1,__:[10]}),S(F,{key:"completed"},{default:x(()=>[m[11]||(m[11]=s("span",null,"Completed Only",-1)),s("span",Cn,b(U("completed")),1)]),_:1,__:[11]}),S(F,{key:"failed"},{default:x(()=>[m[12]||(m[12]=s("span",null,"Failed Only",-1)),s("span",$n,b(U("failed")),1)]),_:1,__:[12]}),S(F,{key:"paused"},{default:x(()=>[m[13]||(m[13]=s("span",null,"Paused Only",-1)),s("span",wn,b(U("paused")),1)]),_:1,__:[13]}),S(F,{key:"draft"},{default:x(()=>[m[14]||(m[14]=s("span",null,"Draft Only",-1)),s("span",kn,b(U("draft")),1)]),_:1,__:[14]})]),_:1})]),default:x(()=>[S(L,{size:"small"},{default:x(()=>[S(W(js))]),_:1})]),_:1})]))]),d.value?R("",!0):(r(),Q(sn,{key:0,"model-value":$.searchQuery,"onUpdate:modelValue":m[2]||(m[2]=A=>$.$emit("update-search",A))},null,8,["model-value"])),d.value?R("",!0):(r(),f("div",Sn,[s("div",{class:se(["status-tab",{active:n.value==="all"}]),onClick:m[3]||(m[3]=A=>n.value="all")},[m[15]||(m[15]=s("span",{class:"tab-icon"},"ðŸ“Š",-1)),m[16]||(m[16]=s("span",{class:"tab-label"},"ALL",-1)),s("span",In,b($.trials.length),1)],2),s("div",{class:se(["status-tab",{active:n.value==="active"}]),onClick:m[4]||(m[4]=A=>n.value="active")},[m[17]||(m[17]=s("span",{class:"tab-icon"},"ðŸŸ¢",-1)),m[18]||(m[18]=s("span",{class:"tab-label"},"Active",-1)),s("span",En,b(p.value),1)],2),s("div",{class:se(["status-tab",{active:n.value==="done"}]),onClick:m[5]||(m[5]=A=>n.value="done")},[m[19]||(m[19]=s("span",{class:"tab-icon"},"âœ…",-1)),m[20]||(m[20]=s("span",{class:"tab-label"},"Done",-1)),s("span",Fn,b(c.value),1)],2)])),s("div",Rn,[!d.value&&g.value.length>100?(r(),Q(W(ct),{key:0,class:"trial-list virtual-list",items:_.value,"size-field":"height","key-field":"id",buffer:10},{default:x(({item:A})=>[A.type==="section"?(r(),Q(Wt,{key:0,title:A.title,background:A.background},null,8,["title","background"])):(r(),Q(Bt,{key:1,trial:A,selected:A.id===$.selectedTrialId,"data-trial-id":A.id,onClick:X=>$.$emit("select-trial",A.id)},null,8,["trial","selected","data-trial-id","onClick"]))]),_:1},8,["items"])):d.value?(r(),f("div",Pn,[(r(!0),f(Z,null,te(h.value,A=>(r(),f("div",{key:A.id,class:se(["collapsed-item",{selected:A.id===$.selectedTrialId}]),onClick:X=>$.$emit("select-trial",A.id)},[s("div",{class:se(["status-dot",`status-${A.status}`])},null,2),s("span",Vn,b(V(A)),1)],10,An))),128))])):(r(),f("div",xn,[(r(!0),f(Z,null,te(g.value,(A,X)=>(r(),f(Z,{key:A.id||`section-${X}`},[A.type==="section"?(r(),Q(Wt,{key:0,title:A.title,background:A.background},null,8,["title","background"])):(r(),Q(Bt,{key:1,trial:A,selected:A.id===$.selectedTrialId,"data-trial-id":A.id,onClick:v=>$.$emit("select-trial",A.id)},null,8,["trial","selected","data-trial-id","onClick"]))],64))),128))])),g.value.length===0&&!d.value?(r(),f("div",On,[S(W(is),{class:"empty-icon"}),s("h3",null,b(k.value),1),s("p",null,b(C.value),1),T.value?(r(),Q(L,{key:0,type:"primary",size:"large",onClick:m[6]||(m[6]=A=>$.$emit("create-trial"))},{default:x(()=>m[21]||(m[21]=[D(" Create New Trial ")])),_:1,__:[21]})):R("",!0)])):R("",!0)])],2)}}}),Nn=ue(Dn,[["__scopeId","data-v-ad2a17cf"]]),Ln={class:"trial-header"},Mn={class:"header-main"},Un={class:"header-title"},zn={class:"trial-name"},Bn={key:0,class:"progress-container"},Wn={class:"progress-bar"},jn={class:"progress-stats-inline"},Hn={class:"progress-text"},qn={key:0,class:"progress-stat"},Gn={class:"stat-number"},Jn={key:1,class:"progress-stat"},Xn={class:"stat-number"},Kn={key:2,class:"progress-stat"},Yn={class:"stat-number"},Qn=re({__name:"TrialHeaderV3",props:{trial:{},progress:{},isExecuting:{type:Boolean}},setup(l){const e=l,t=M(()=>{let C=e.trial.name;return C=C.replace(/\s*-\s*\d{1,2}\/\d{1,2}\/\d{4}$/,""),C=C.replace(/\s*\(Copy\)(\s*\(Copy\))*/g,""),C.trim()}),a=M(()=>!0),o=M(()=>e.progress?e.progress.completed+e.progress.failed:0),n=M(()=>{if(!e.progress||e.progress.total===0)return 0;const C=e.progress.completed+e.progress.failed;return Math.round(C/e.progress.total*100)}),u=M(()=>{const C=e.trial.started||e.trial.created;if(!C)return"0m";let T;if(e.trial.status==="draft")return"0m";e.trial.completed?T=e.trial.completed:T=new Date;const U=T.getTime()-C.getTime(),N=Math.floor(U/(1e3*60*60)),V=Math.floor(U%(1e3*60*60)/(1e3*60));return N>0?`${N}h ${V}m`:`${V}m`}),d=M(()=>{if(!e.progress?.avgLatencyMs)return null;const C=e.progress.avgLatencyMs;return C<1e3?`${Math.round(C)}ms`:`${(C/1e3).toFixed(1)}s`}),{calculateTemplateTokens:p,calculatePromptTokens:c,estimateTotalCost:g,sumEstimates:_,formatCost:h}=rt();M(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let C=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)C=p(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const N=c(e.trial.spreadsheetConfig.promptPattern),I=(e.progress?.total||e.trial.progress.total)/e.trial.configurations.length;C={totalTokens:N*I,combinationCount:I,perCallAverage:N}}else if(e.trial.type==="playground")return null;if(!C||C.totalTokens===0)return null;const T=e.trial.configurations.map(N=>{const V=N.modelSnapshot;return V?g(C.totalTokens,C.combinationCount,V,N.parameters):null}).filter(Boolean);if(T.length===0)return null;const U=_(T);return`${h(U,"compact")} total`});const k=M(()=>{if(e.trial.status!=="running"||!e.progress||e.progress.completed===0)return null;const T=(Date.now()-(e.trial.started?.getTime()||0))/e.progress.completed,U=e.progress.pending*T,N=Math.floor(U/(1e3*60)),V=Math.floor(U%(1e3*60)/1e3);if(N>60){const I=Math.floor(N/60),w=N%60;return`${I}h ${w}m`}return`${N}m ${V}s`});return(C,T)=>(r(),f("div",Ln,[s("div",Mn,[s("div",Un,[s("h2",zn,b(t.value),1),s("span",{class:se(["status-tag",`status-${C.trial.status}`])},b(C.trial.status.toUpperCase()),3)]),a.value?(r(),f("div",Bn,[s("div",Wn,[s("div",{class:"progress-fill",style:pe({width:`${n.value}%`})},null,4)]),s("div",jn,[s("span",Hn,b(o.value)+"/"+b(C.progress?.total||0)+" ("+b(n.value)+"%) ",1),u.value?(r(),f("span",qn,[T[0]||(T[0]=s("span",{class:"stat-label"},"Duration:",-1)),T[1]||(T[1]=D()),s("span",Gn,b(u.value),1)])):R("",!0),d.value?(r(),f("span",Jn,[T[2]||(T[2]=s("span",{class:"stat-label"},"Avg:",-1)),T[3]||(T[3]=D()),s("span",Xn,b(d.value),1)])):R("",!0),k.value?(r(),f("span",Kn,[T[4]||(T[4]=s("span",{class:"stat-label"},"Remaining:",-1)),T[5]||(T[5]=D()),s("span",Yn,"~"+b(k.value),1)])):R("",!0)])])):R("",!0)]),R("",!0)]))}}),Zn=ue(Qn,[["__scopeId","data-v-248be564"]]),eo={class:"trial-actions"},to={class:"action-group execution-controls"},so={class:"action-group data-actions"},ao={class:"action-group management-actions"},no=re({__name:"TrialActionsV3",props:{trial:{},isLeader:{type:Boolean},executionState:{}},emits:["start","pause","resume","cancel","duplicate","edit","delete","export-data","export-python","refresh"],setup(l,{emit:e}){const t=l,a=e,o=q(!1),n=q(!1),u=q(!1);M(()=>t.executionState?.currentTrialId===t.trial.id);const d=M(()=>["draft","failed","cancelled"].includes(t.trial.status)),p=M(()=>t.trial.status==="running"),c=M(()=>t.trial.status==="paused"),g=M(()=>["running","paused"].includes(t.trial.status));function _(){a("start")}async function h(){o.value=!0,n.value=!1,a("pause"),setTimeout(()=>{o.value=!1},1e3)}async function k(){n.value=!0,o.value=!1,a("resume"),setTimeout(()=>{n.value=!1},3e3)}function C(){Ae.confirm({title:"Cancel trial?",content:"This will stop all pending API calls.",okText:"Cancel Trial",okType:"danger",onOk:()=>a("cancel")})}async function T(){u.value=!0,a("refresh"),setTimeout(()=>{u.value=!1},500)}function U({key:w}){w==="data"?a("export-data"):w==="python"&&a("export-python")}function N(){a("duplicate")}function V(){a("edit")}function I(){const w=t.trial.progress.total;Ae.confirm({title:"Delete trial?",content:`Delete trial and all ${w} API calls?`,okText:"Delete",okType:"danger",cancelText:"Cancel",onOk:()=>{a("delete")}})}return(w,O)=>{const $=we,m=Rt,L=Ft,F=Et;return r(),f("div",eo,[s("div",to,[d.value?(r(),Q($,{key:0,type:"primary",size:"large",disabled:!w.isLeader,onClick:_},{default:x(()=>[S(W(Nt)),O[0]||(O[0]=D(" Start Trial "))]),_:1,__:[0]},8,["disabled"])):R("",!0),p.value?(r(),Q($,{key:1,size:"large",disabled:!w.isLeader,loading:o.value,onClick:h},{default:x(()=>[o.value?R("",!0):(r(),Q(W(qs),{key:0})),D(" "+b(o.value?"Pausing...":"Pause"),1)]),_:1},8,["disabled","loading"])):R("",!0),c.value?(r(),Q($,{key:2,type:"primary",size:"large",disabled:!w.isLeader||n.value,loading:n.value,onClick:k},{default:x(()=>[n.value?R("",!0):(r(),Q(W(Nt),{key:0})),D(" "+b(n.value?"Resuming...":"Resume"),1)]),_:1},8,["disabled","loading"])):R("",!0),g.value?(r(),Q($,{key:3,danger:"",size:"large",disabled:!w.isLeader,onClick:C},{default:x(()=>[S(W(Gs)),O[1]||(O[1]=D(" Cancel "))]),_:1,__:[1]},8,["disabled"])):R("",!0)]),s("div",so,[S($,{size:"large",loading:u.value,onClick:T,title:"Refresh trial data from database"},{default:x(()=>[u.value?(r(),Q(W(rs),{key:1,spin:""})):(r(),Q(W(Js),{key:0})),D(" "+b(u.value?"Refreshing...":"Refresh"),1)]),_:1},8,["loading"]),S(F,null,{overlay:x(()=>[S(L,{onClick:U},{default:x(()=>[S(m,{key:"data"},{default:x(()=>[S(W(Ks)),O[3]||(O[3]=D(" Export Data "))]),_:1,__:[3]}),S(m,{key:"python"},{default:x(()=>[S(W(Ys)),O[4]||(O[4]=D(" Export Python Script "))]),_:1,__:[4]})]),_:1})]),default:x(()=>[S($,{size:"large"},{default:x(()=>[O[2]||(O[2]=D(" Export ")),S(W(Xs))]),_:1,__:[2]})]),_:1})]),s("div",ao,[S($,{size:"large",disabled:!w.isLeader,onClick:N},{default:x(()=>[S(W(xt)),O[5]||(O[5]=D(" Duplicate "))]),_:1,__:[5]},8,["disabled"]),w.trial.status==="draft"?(r(),Q($,{key:0,size:"large",disabled:!w.isLeader,onClick:V},{default:x(()=>[S(W(Qs)),O[6]||(O[6]=D(" Edit "))]),_:1,__:[6]},8,["disabled"])):R("",!0),S($,{danger:"",size:"large",disabled:!w.isLeader,onClick:I},{default:x(()=>[S(W(Zs)),O[7]||(O[7]=D(" Delete "))]),_:1,__:[7]},8,["disabled"])])])}}}),oo=ue(no,[["__scopeId","data-v-e642c431"]]),lo={class:"snapshot-debug"},io={class:"debug-header"},ro={class:"status-row"},uo={key:0,class:"badge success"},co={key:1,class:"badge warning"},po={key:0,class:"status-row"},fo={key:0,class:"variables-section"},mo={class:"variable-header"},vo={class:"var-name"},go={class:"var-type"},ho={key:0,class:"snapshot-content"},yo={class:"snapshot-meta"},bo={key:0},_o={class:"snapshot-items"},To={class:"items-preview"},Co={class:"item-index"},$o={class:"item-value"},wo={key:0,class:"item-attrs"},ko={key:0,class:"more-indicator"},So={key:1,class:"no-snapshot"},Io={key:0},Eo={key:1,class:"legacy-warning"},Fo={class:"debug-footer"},Ro=re({__name:"SnapshotDebugModal",props:{visible:{type:Boolean},trial:{},migrating:{type:Boolean}},emits:["close","migrate"],setup(l){const e=l,t=M(()=>e.trial.templateConfig?.hasSnapshots===!0),a=M(()=>e.trial.templateConfig?.variables||{});function o(c){return"snapshot"in c&&c.snapshot!=null}function n(c){return c.snapshot}function u(c){return o(c)?`${n(c).source.type} (snapshot)`:c.type==="value"?"Direct values":c.type==="list"?"List reference":"Unknown"}function d(){for(const c of Object.values(a.value))if(o(c)){const g=n(c);if(g.source?.snapshotDate)return new Date(g.source.snapshotDate).toLocaleString()}return"Unknown"}function p(){const c={trialId:e.trial.id,trialName:e.trial.name,hasSnapshots:t.value,variables:a.value};navigator.clipboard.writeText(JSON.stringify(c,null,2)),le.success("Debug info copied to clipboard")}return(c,g)=>{const _=lt,h=it,k=we,C=Ae;return r(),Q(C,{visible:c.visible,title:"Variable Snapshot Debug View",width:"80%",footer:null,onCancel:g[2]||(g[2]=T=>c.$emit("close"))},{default:x(()=>[s("div",lo,[s("div",io,[s("div",ro,[g[5]||(g[5]=s("span",{class:"label"},"Snapshot Status:",-1)),t.value?(r(),f("span",uo,[S(W(us)),g[3]||(g[3]=D(" Snapshots Enabled "))])):(r(),f("span",co,[S(W(Be)),g[4]||(g[4]=D(" Legacy Mode (No Snapshots) "))]))]),t.value?(r(),f("div",po,[g[6]||(g[6]=s("span",{class:"label"},"Snapshot Date:",-1)),s("span",null,b(d()),1)])):R("",!0)]),t.value?(r(),f("div",fo,[g[8]||(g[8]=s("h3",null,"Variable Snapshots",-1)),(r(!0),f(Z,null,te(a.value,(T,U)=>(r(),f("div",{key:U,class:"variable-card"},[s("div",mo,[s("span",vo,b(U),1),s("span",go,b(u(T)),1)]),o(T)?(r(),f("div",ho,[s("div",yo,[s("span",null,"Source: "+b(n(T).source.type),1),n(T).source.listName?(r(),f("span",bo," List: "+b(n(T).source.listName),1)):R("",!0),s("span",null,"Items: "+b(n(T).items.length),1)]),s("div",_o,[s("div",To,[(r(!0),f(Z,null,te(n(T).items.slice(0,5),(N,V)=>(r(),f("div",{key:V,class:"item-row"},[s("span",Co,b(V+1)+".",1),s("span",$o,b(N.value),1),N.attributes&&Object.keys(N.attributes).length>0?(r(),f("span",wo,[(r(!0),f(Z,null,te(N.attributes,(I,w)=>(r(),Q(_,{key:w,size:"small"},{default:x(()=>[D(b(w)+": "+b(I),1)]),_:2},1024))),128))])):R("",!0)]))),128)),n(T).items.length>5?(r(),f("div",ko," ... and "+b(n(T).items.length-5)+" more items ",1)):R("",!0)])])])):(r(),f("div",So,[S(W(Be)),g[7]||(g[7]=D(" No snapshot - using live reference ")),T.listId?(r(),f("span",Io,"List ID: "+b(T.listId),1)):R("",!0)]))]))),128))])):(r(),f("div",Eo,[S(h,{message:"Legacy Trial",description:"This trial was created before snapshots were implemented. Variable lists are loaded dynamically from the database, which means changes to lists will affect trial duplication.",type:"warning","show-icon":""}),S(k,{type:"primary",onClick:g[0]||(g[0]=T=>c.$emit("migrate")),loading:c.migrating,style:{"margin-top":"16px"}},{default:x(()=>[S(W(ea)),g[9]||(g[9]=D(" Migrate to Snapshots "))]),_:1,__:[9]},8,["loading"])])),s("div",Fo,[S(k,{onClick:p},{default:x(()=>[S(W(xt)),g[10]||(g[10]=D(" Copy Debug Info "))]),_:1,__:[10]}),S(k,{onClick:g[1]||(g[1]=T=>c.$emit("close"))},{default:x(()=>g[11]||(g[11]=[D("Close")])),_:1,__:[11]})])])]),_:1},8,["visible"])}}}),xo=ue(Ro,[["__scopeId","data-v-726379cc"]]),Po={class:"trial-detail-view"},Ao={key:0,class:"detail-content"},Vo={class:"detail-section"},Oo={class:"detail-grid"},Do={class:"detail-item"},No={key:0,class:"detail-item"},Lo={key:1,class:"detail-item"},Mo={class:"detail-item"},Uo={class:"detail-item"},zo={class:"detail-section"},Bo={class:"detail-grid"},Wo={key:0,class:"detail-item full-width"},jo={key:1,class:"detail-item full-width"},Ho={class:"detail-item"},qo={class:"detail-item"},Go={style:{display:"flex","align-items":"center",gap:"8px"}},Jo={key:0,class:"snapshot-badge success"},Xo={key:1,class:"snapshot-badge warning"},Ko={class:"detail-item"},Yo={key:2,class:"detail-item"},Qo={key:0,class:"detail-section"},Zo={class:"detail-grid"},el={class:"detail-item"},tl={class:"detail-item"},sl={class:"detail-item"},al={class:"detail-section"},nl={class:"model-configs"},ol={class:"config-header"},ll=["src","alt"],il={class:"provider-name"},rl={class:"config-details"},ul={class:"config-item"},dl={class:"config-params"},cl={class:"param-list"},pl={key:0,class:"config-item"},fl={class:"cost"},ml={key:1,class:"config-item"},vl={class:"cost"},gl={class:"config-item"},hl={class:"snapshot-debug"},yl=re({__name:"TrialDetailView",props:{trial:{},isCollapsed:{type:Boolean}},emits:["toggle-collapse"],setup(l){const e=l,t=q(!1),{calculateTemplateTokens:a,estimateTotalCost:o,formatCost:n}=rt(),u=M(()=>{const $=e.trial.started||e.trial.created,L=(e.trial.completed||new Date).getTime()-$.getTime(),F=Math.floor(L/(1e3*60*60)),i=Math.floor(L%(1e3*60*60)/(1e3*60));return F>0?`${F}h ${i}m`:`${i}m`}),d=M(()=>({draft:"Not started",pending:"Waiting to start",running:"Executing API calls",paused:"Execution paused",completed:"All calls completed",failed:"Execution failed",cancelled:"Execution cancelled"})[e.trial.status]||e.trial.status),p=M(()=>e.trial.type==="template"&&e.trial.templateConfig?.variables?Object.keys(e.trial.templateConfig.variables).length:0),c=M(()=>Math.round(e.trial.progress.total*750)),g=M(()=>e.trial.type==="template"&&e.trial.templateConfig?e.trial.templateConfig.hasSnapshots===!0:!1),_=M(()=>"text"),h=M(()=>1),k=M(()=>e.trial.progress.total/h.value);function C($){return $?new Date($).toLocaleString():"N/A"}function T(){if(e.trial.templateConfig?.templateName)return e.trial.templateConfig.templateName;const $=e.trial.templateConfig?.template||"Unknown Template";return $.length>50?$.substring(0,50)+"...":$}function U(){return e.trial.spreadsheetConfig?.datasetId||"Unknown Dataset"}function N($){return{"openai-chat":"OpenAI","anthropic-messages":"Anthropic",openrouter:"OpenRouter","ollama-chat":"Ollama","ollama-generate":"Ollama"}[$]||$}function V($){}async function I(){try{le.info("Migration feature coming soon"),t.value=!1}catch($){le.error("Failed to migrate trial"),P.error("Migration error:",$)}}function w($){const m=$.modelSnapshot;return m?.capabilities?.inputCostPerToken?`$${((m.capabilities.inputCostPerToken+m.capabilities.outputCostPerToken)*1e3).toFixed(8)}/1k tokens`:null}function O($){if(!e.trial.configurations||!$.modelSnapshot)return null;let m=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)m=a(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else return null;if(!m||m.totalTokens===0)return null;const L=o(m.totalTokens,m.combinationCount,$.modelSnapshot,$.parameters);if(!L.meta.hasValidCost||L.cost.total.expected===-1)return null;const F=(e.trial.repeatCount||1)*L.cost.total.expected;return n({...L,cost:{...L.cost,total:{...L.cost.total,expected:F}}},"compact")}return($,m)=>{const L=we;return r(),f("div",Po,[s("div",{class:"detail-header",onClick:m[0]||(m[0]=F=>$.$emit("toggle-collapse"))},[m[3]||(m[3]=s("h3",null,"Trial Details",-1)),S(W(ta),{class:se(["collapse-icon",{rotated:$.isCollapsed}])},null,8,["class"])]),$.isCollapsed?R("",!0):(r(),f("div",Ao,[s("div",Vo,[m[9]||(m[9]=s("h4",null,"Basic Information",-1)),s("div",Oo,[s("div",Do,[m[4]||(m[4]=s("label",null,"Created:",-1)),s("span",null,b(C($.trial.created)),1)]),$.trial.started?(r(),f("div",No,[m[5]||(m[5]=s("label",null,"Started:",-1)),s("span",null,b(C($.trial.started)),1)])):R("",!0),$.trial.completed?(r(),f("div",Lo,[m[6]||(m[6]=s("label",null,"Completed:",-1)),s("span",null,b(C($.trial.completed)),1)])):R("",!0),s("div",Mo,[m[7]||(m[7]=s("label",null,"Duration:",-1)),s("span",null,b(u.value),1)]),s("div",Uo,[m[8]||(m[8]=s("label",null,"Status:",-1)),s("span",null,b($.trial.status)+" - "+b(d.value),1)])])]),s("div",zo,[m[19]||(m[19]=s("h4",null,"Configuration",-1)),s("div",Bo,[$.trial.type==="template"?(r(),f("div",Wo,[m[10]||(m[10]=s("label",null,"Template:",-1)),s("span",null,b(T()),1)])):R("",!0),$.trial.type==="spreadsheet"?(r(),f("div",jo,[m[11]||(m[11]=s("label",null,"Dataset:",-1)),s("span",null,b(U()),1)])):R("",!0),s("div",Ho,[m[12]||(m[12]=s("label",null,"Variable Lists:",-1)),s("span",null,b(p.value)+" lists",1)]),s("div",qo,[m[16]||(m[16]=s("label",null,"Data Snapshot:",-1)),s("div",Go,[g.value?(r(),f("span",Jo,[S(W(us)),m[13]||(m[13]=D(" Captured "))])):(r(),f("span",Xo,[S(W(Be)),m[14]||(m[14]=D(" Live Reference "))])),$.trial.type==="template"?(r(),Q(L,{key:2,size:"small",type:"link",onClick:m[1]||(m[1]=F=>t.value=!0)},{default:x(()=>[S(W(ds)),m[15]||(m[15]=D(" Debug "))]),_:1,__:[15]})):R("",!0)])]),s("div",Ko,[m[17]||(m[17]=s("label",null,"Token Estimate:",-1)),s("span",null,"~"+b(c.value)+" tokens",1)]),_.value?(r(),f("div",Yo,[m[18]||(m[18]=s("label",null,"Output Type:",-1)),s("span",{class:se(["output-type",`type-${_.value}`])},b(_.value),3)])):R("",!0)])]),h.value>1?(r(),f("div",Qo,[m[23]||(m[23]=s("h4",null,"Repeat Configuration",-1)),s("div",Zo,[s("div",el,[m[20]||(m[20]=s("label",null,"Times per prompt:",-1)),s("span",null,b(h.value),1)]),s("div",tl,[m[21]||(m[21]=s("label",null,"Total combinations:",-1)),s("span",null,b(k.value),1)]),s("div",sl,[m[22]||(m[22]=s("label",null,"Total API calls:",-1)),s("span",null,b($.trial.progress.total),1)])])])):R("",!0),s("div",al,[m[29]||(m[29]=s("h4",null,"Model Configurations",-1)),s("div",nl,[(r(!0),f(Z,null,te($.trial.configurations,(F,i)=>(r(),f("div",{key:i,class:"model-config-card"},[s("div",ol,[(F.provider,void 0)?(r(),f("img",{key:0,src:(F.provider,void 0),alt:F.provider,class:"provider-logo"},null,8,ll)):R("",!0),s("span",il,b(N(F.provider)),1)]),s("div",rl,[s("div",ul,[m[24]||(m[24]=s("label",null,"Model:",-1)),s("span",null,b(F.modelId),1)]),s("div",dl,[m[25]||(m[25]=s("label",null,"Parameters:",-1)),s("div",cl,[(r(!0),f(Z,null,te(F.parameters,(j,Y)=>(r(),f("span",{key:Y,class:"param-tag"},b(Y)+": "+b(j),1))),128))])]),w(F)?(r(),f("div",pl,[m[26]||(m[26]=s("label",null,"Cost Rate:",-1)),s("span",fl,b(w(F)),1)])):R("",!0),O(F)?(r(),f("div",ml,[m[27]||(m[27]=s("label",null,"Total Trial Cost:",-1)),s("span",vl,b(O(F)),1)])):R("",!0),s("div",gl,[m[28]||(m[28]=s("label",null,"Model Snapshot:",-1)),s("pre",hl,b(JSON.stringify(F.modelSnapshot,null,2)),1)])])]))),128))])])])),t.value?(r(),Q(xo,{key:1,visible:t.value,trial:$.trial,onClose:m[2]||(m[2]=F=>t.value=!1),onMigrate:I},null,8,["visible","trial"])):R("",!0)])}}}),bl=ue(yl,[["__scopeId","data-v-e677baaf"]]),_l={class:"filter-bar"},Tl={class:"search-container"},Cl=re({__name:"TrialResultsFilterBar",props:{statusFilter:{},configFilter:{},searchQuery:{},visibleColumns:{},configurations:{},apiCalls:{},showRepeatColumn:{type:Boolean}},emits:["update:statusFilter","update:configFilter","update:searchQuery","update:visibleColumns","openPostProcessing"],setup(l,{emit:e}){const t=l,a=e,o=M(()=>{const c=[{key:"status",label:"Status"},{key:"configuration",label:"Configuration"},{key:"variables",label:"Variables"},{key:"response",label:"Response"},{key:"parsedResponse",label:"Parsed Response"},{key:"postProcessedResponse",label:"Post-Processed"},{key:"length",label:"Length"},{key:"latency",label:"Latency"}];return t.showRepeatColumn&&c.splice(2,0,{key:"repeat",label:"Repeat Index"}),c}),n=M(()=>{const c={total:t.apiCalls.length,completed:0,failed:0,running:0,pending:0};return t.apiCalls.forEach(g=>{g.status==="completed"?c.completed++:g.status==="failed"?c.failed++:g.status==="running"?c.running++:g.status==="pending"&&c.pending++}),c});function u(c){return c.modelSnapshot?.displayName||`${c.provider} - ${c.modelId}`}const d=vs(c=>{const g=c.target.value;a("update:searchQuery",g)},300);function p(c){const g=[...t.visibleColumns],_=g.indexOf(c);if(_>-1)g.splice(_,1);else{const h=o.value.map(T=>T.key),k=h.indexOf(c);let C=0;for(let T=0;T<k;T++)g.includes(h[T])&&C++;g.splice(C,0,c)}a("update:visibleColumns",g)}return(c,g)=>{const _=aa,h=sa,k=cs,C=we,T=ps,U=Rt,N=Ft,V=Et;return r(),f("div",_l,[S(h,{value:c.statusFilter,onChange:g[0]||(g[0]=I=>c.$emit("update:statusFilter",I)),placeholder:"Filter by status",style:{width:"150px"}},{default:x(()=>[S(_,{value:"all"},{default:x(()=>[D(" All ("+b(n.value.total)+") ",1)]),_:1}),S(_,{value:"completed"},{default:x(()=>[D(" Completed ("+b(n.value.completed)+") ",1)]),_:1}),S(_,{value:"failed"},{default:x(()=>[D(" Failed ("+b(n.value.failed)+") ",1)]),_:1}),S(_,{value:"running"},{default:x(()=>[D(" Running ("+b(n.value.running)+") ",1)]),_:1}),S(_,{value:"pending"},{default:x(()=>[D(" Pending ("+b(n.value.pending)+") ",1)]),_:1})]),_:1},8,["value"]),S(h,{value:c.configFilter,onChange:g[1]||(g[1]=I=>c.$emit("update:configFilter",I)),mode:"multiple",placeholder:"Filter by configuration",style:{width:"250px"},"max-tag-count":2},{default:x(()=>[S(_,{value:""},{default:x(()=>g[3]||(g[3]=[D("All Configurations")])),_:1,__:[3]}),(r(!0),f(Z,null,te(c.configurations,(I,w)=>(r(),Q(_,{key:w,value:w.toString()},{default:x(()=>[D(b(u(I)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s("div",Tl,[S(k,{value:c.searchQuery,onInput:W(d),placeholder:"Search in variables and responses...",style:{width:"400px"},"allow-clear":""},{prefix:x(()=>[S(W(ns))]),_:1},8,["value","onInput"])]),S(V,null,{overlay:x(()=>[S(N,null,{default:x(()=>[(r(!0),f(Z,null,te(o.value,I=>(r(),Q(U,{key:I.key},{default:x(()=>[S(T,{checked:c.visibleColumns.includes(I.key),disabled:I.key==="status",onChange:w=>p(I.key)},{default:x(()=>[D(b(I.label),1)]),_:2},1032,["checked","disabled","onChange"])]),_:2},1024))),128))]),_:1})]),default:x(()=>[S(C,null,{default:x(()=>[S(W(na)),g[4]||(g[4]=D(" Columns "))]),_:1,__:[4]})]),_:1}),S(C,{type:"primary",onClick:g[2]||(g[2]=I=>c.$emit("openPostProcessing"))},{default:x(()=>[S(W(fs)),g[5]||(g[5]=D(" Post-Process "))]),_:1,__:[5]})])}}}),$l=ue(Cl,[["__scopeId","data-v-e6112af3"]]),wl={class:"modal-content"},kl={class:"section"},Sl={class:"info-grid"},Il={class:"info-item"},El={class:"monospace"},Fl={class:"info-item"},Rl={class:"info-item"},xl={key:0,class:"info-item"},Pl={class:"info-item"},Al={key:1,class:"info-item"},Vl={key:2,class:"info-item"},Ol={key:3,class:"info-item"},Dl={key:0,class:"info-row"},Nl={class:"monospace"},Ll={key:0,class:"section"},Ml={class:"variables-list"},Ul={class:"variable-main"},zl={class:"variable-label"},Bl={class:"variable-value"},Wl={key:0,class:"variable-attributes"},jl={class:"attribute-label"},Hl={class:"attribute-value"},ql={class:"section"},Gl={class:"content-box prompt-display"},Jl={key:1,class:"section"},Xl={key:0,class:"error-result"},Kl={key:1,class:"success-result"},Yl={class:"content-box response-content"},Ql={key:0,class:"parsed-content-section"},Zl={class:"content-box parsed-content"},ei={key:1,class:"post-processed-section"},ti={class:"content-box post-processed-content"},si={key:2,class:"refusal-warning"},ai={key:3,class:"refusal-warning"},ni={class:"extraction-config-section"},oi={class:"config-grid"},li={key:0,class:"config-item"},ii={class:"config-value"},ri={key:1,class:"config-item"},ui={class:"config-value"},di={key:2,class:"config-item"},ci={class:"config-value pattern"},pi={key:3,class:"config-item"},fi={class:"config-value"},mi={key:4,class:"config-item"},vi={class:"config-value"},gi={key:5,class:"config-item"},hi={class:"config-value"},yi={key:6,class:"config-item no-extraction"},bi={key:4,class:"post-processing-config-section"},_i={class:"config-grid"},Ti={class:"config-item post-processing-item"},Ci={class:"config-value"},$i={key:0,class:"config-item post-processing-item"},wi={class:"config-value"},ki={key:1,class:"config-item post-processing-item"},Si={class:"config-value pattern"},Ii={key:2,class:"config-item post-processing-item"},Ei={class:"config-value"},Fi={key:3,class:"config-item post-processing-item"},Ri={class:"config-value"},xi={key:4,class:"config-item post-processing-item"},Pi={class:"config-value"},Ai={key:5,class:"usage-info"},Vi={class:"info-grid"},Oi={class:"info-item"},Di={class:"info-item"},Ni={class:"info-item"},Li={key:0,class:"info-item"},Mi={class:"raw-data-section"},Ui={class:"raw-data"},zi={key:0},Bi={key:1,class:"raw-data"},Wi={key:2},ji={key:3,class:"raw-data"},Hi={class:"modal-footer"},qi={key:0,class:"footer-left"},Gi={class:"position-indicator"},Ji={class:"footer-right"},Xi=re({__name:"APICallDetailModalV3",props:{visible:{type:Boolean},apiCall:{},trial:{},allApiCalls:{}},emits:["update:visible","navigate"],setup(l,{emit:e}){const t=l,a=e,o=Ds(),n=M(()=>t.allApiCalls?t.allApiCalls.findIndex(v=>v.id===t.apiCall.id):-1),u=M(()=>t.allApiCalls?.length||0),d=M(()=>n.value>0),p=M(()=>n.value>=0&&n.value<u.value-1),c=M(()=>!d.value||!t.allApiCalls?null:t.allApiCalls[n.value-1]),g=M(()=>!p.value||!t.allApiCalls?null:t.allApiCalls[n.value+1]),_=M(()=>{if(t.apiCall.duration!==void 0)return t.apiCall.duration;if(!t.apiCall.completed||!t.apiCall.created)return null;const v=new Date(t.apiCall.created).getTime();return new Date(t.apiCall.completed).getTime()-v}),h=M(()=>{if(t.apiCall.modelName){const y=t.trial.configurations[t.apiCall.configurationIndex];return y?`${y.provider} / ${t.apiCall.modelName}`:t.apiCall.modelName}const v=t.trial.configurations[t.apiCall.configurationIndex];return v?`${v.provider} / ${v.modelId}`:null}),k=M(()=>{if(t.apiCall.cost!==void 0)return t.apiCall.cost;if(!t.apiCall.result?.usage)return null;const v=t.trial.configurations[t.apiCall.configurationIndex];if(!v)return null;const y=o.models.value.find(ne=>ne.provider===v.provider&&ne.modelId===v.modelId);if(!y?.capabilities?.inputCostPerToken&&!y?.capabilities?.outputCostPerToken)return null;const E=(t.apiCall.result.usage.prompt_tokens||0)*(y.capabilities.inputCostPerToken||0),H=(t.apiCall.result.usage.completion_tokens||0)*(y.capabilities.outputCostPerToken||0);return E+H}),C=M(()=>{if(!t.apiCall.request)return"No request data";const v=JSON.parse(JSON.stringify(t.apiCall.request));return v.headers&&Object.keys(v.headers).forEach(y=>{(y.toLowerCase().includes("authorization")||y.toLowerCase().includes("api-key")||y.toLowerCase().includes("x-api-key"))&&(v.headers[y]="[REDACTED]")}),v.body&&typeof v.body=="object"&&(v.body.api_key&&(v.body.api_key="[REDACTED]"),v.body.apiKey&&(v.body.apiKey="[REDACTED]")),JSON.stringify(v,null,2)}),T=M(()=>t.apiCall.parserId?{parserId:t.apiCall.parserId,outputType:t.trial.type==="template"?t.trial.templateConfig?.outputType:void 0,extractPattern:t.trial.type==="template"?t.trial.templateConfig?.extractPattern:void 0,refusalWords:t.trial.type==="template"?t.trial.templateConfig?.refusalWords:void 0,refusalMode:t.trial.type==="template"?t.trial.templateConfig?.refusalMode:void 0,rejectRefusalWords:t.trial.type==="template"?t.trial.templateConfig?.rejectRefusalWords:void 0}:t.trial.type!=="template"||!t.trial.templateConfig?{}:{parserId:t.trial.templateConfig.parserId,outputType:t.trial.templateConfig.outputType,extractPattern:t.trial.templateConfig.extractPattern,refusalWords:t.trial.templateConfig.refusalWords,refusalMode:t.trial.templateConfig.refusalMode,rejectRefusalWords:t.trial.templateConfig.rejectRefusalWords}),U=M(()=>{const v=T.value;return!!(v.parserId||v.outputType||v.extractPattern||v.refusalWords&&v.refusalWords.length>0)}),N=M(()=>t.trial.postProcessingConfig||null),V=M(()=>t.apiCall.response?JSON.stringify({status:t.apiCall.response.status,headers:t.apiCall.response.headers,body:t.apiCall.response.body,latencyMs:t.apiCall.response.latencyMs},null,2):"No response data available"),I=M(()=>t.apiCall.result?JSON.stringify(t.apiCall.result,null,2):"No processed result available");function w(v){return{completed:"success",failed:"error",running:"processing",pending:"warning"}[v]||"default"}function O(){const v=t.trial.configurations[t.apiCall.configurationIndex];return v?.modelSnapshot?.displayName||v?.modelId||`Configuration ${t.apiCall.configurationIndex+1}`}function $(v){return(typeof v=="string"?new Date(v):v).toLocaleString()}function m(v){return v<1e3?`${v}ms`:v<6e4?`${(v/1e3).toFixed(1)}s`:`${Math.floor(v/6e4)}m ${(v%6e4/1e3).toFixed(0)}s`}function L(v){return v==null?"null":typeof v=="string"?v:typeof v=="number"||typeof v=="boolean"?String(v):JSON.stringify(v,null,2)}function F(v){return{network_error_no_response:"Network Error (No Response)",api_error_received:"API Error Response",parsing_error:"Response Parsing Error",timeout:"Request Timeout",rate_limit:"Rate Limit Exceeded"}[v]||v}function i(){a("update:visible",!1)}function j(){c.value&&a("navigate",c.value)}function Y(){g.value&&a("navigate",g.value)}function A(v){if(t.visible)switch(v.key){case"ArrowLeft":v.preventDefault(),j();break;case"ArrowRight":v.preventDefault(),Y();break;case"Escape":v.preventDefault(),i();break}}$e(()=>{document.addEventListener("keydown",A)}),Fe(()=>{document.removeEventListener("keydown",A)});async function X(){const v={id:t.apiCall.id,status:t.apiCall.status,configuration:O(),provider:h.value,variables:t.apiCall.variables,variableAttributes:t.apiCall.variableAttributes,prompt:t.apiCall.prompt,fullApiResponse:t.apiCall.response,processedResult:t.apiCall.result,extractionConfig:T.value,postProcessingConfig:N.value,created:t.apiCall.created,completed:t.apiCall.completed,duration:_.value?`${_.value}ms`:null,cost:k.value?`$${k.value.toFixed(4)}`:null},y=JSON.stringify(v,null,2);try{await navigator.clipboard.writeText(y),le.success("Details copied to clipboard!")}catch(E){P.error("Failed to copy to clipboard",E),le.error("Failed to copy to clipboard")}}return(v,y)=>{const E=lt,H=it,ne=la,oe=oa,de=we,fe=Ae;return r(),Q(fe,{open:v.visible,onCancel:y[0]||(y[0]=me=>a("update:visible",!1)),title:"API Call Details",width:1400,footer:null,"body-style":{padding:0,height:"85vh",display:"flex",flexDirection:"column"},centered:!0,"destroy-on-close":!0,class:"api-call-detail-modal"},{default:x(()=>[s("div",wl,[s("div",kl,[y[10]||(y[10]=s("h3",null,"Overview",-1)),s("div",Sl,[s("div",Il,[y[1]||(y[1]=s("label",null,"Call ID:",-1)),s("span",El,b(v.apiCall.id),1)]),s("div",Fl,[y[2]||(y[2]=s("label",null,"Status:",-1)),S(E,{color:w(v.apiCall.status)},{default:x(()=>[D(b(v.apiCall.status.toUpperCase()),1)]),_:1},8,["color"])]),s("div",Rl,[y[3]||(y[3]=s("label",null,"Configuration:",-1)),s("span",null,b(O()),1)]),v.apiCall.repeatIndex!==void 0?(r(),f("div",xl,[y[4]||(y[4]=s("label",null,"Repeat:",-1)),s("span",null,"#"+b(v.apiCall.repeatIndex+1),1)])):R("",!0),s("div",Pl,[y[5]||(y[5]=s("label",null,"Created:",-1)),s("span",null,b($(v.apiCall.created)),1)]),v.apiCall.completed?(r(),f("div",Al,[y[6]||(y[6]=s("label",null,"Completed:",-1)),s("span",null,b($(v.apiCall.completed)),1)])):R("",!0),_.value?(r(),f("div",Vl,[y[7]||(y[7]=s("label",null,"Duration:",-1)),s("span",null,b(m(_.value)),1)])):R("",!0),v.apiCall.result?.latency?(r(),f("div",Ol,[y[8]||(y[8]=s("label",null,"API Latency:",-1)),s("span",null,b(v.apiCall.result.latency)+"ms",1)])):R("",!0)]),h.value?(r(),f("div",Dl,[y[9]||(y[9]=s("label",null,"Provider/Model:",-1)),s("span",Nl,b(h.value),1)])):R("",!0)]),v.apiCall.variables&&Object.keys(v.apiCall.variables).length>0?(r(),f("div",Ll,[y[11]||(y[11]=s("h3",null,"Variables",-1)),s("div",Ml,[(r(!0),f(Z,null,te(v.apiCall.variables,(me,Te)=>(r(),f("div",{key:Te,class:"variable-group"},[s("div",Ul,[s("label",zl,b(Te)+":",1),s("span",Bl,b(me),1)]),v.apiCall.variableAttributes&&v.apiCall.variableAttributes[Te]?(r(),f("div",Wl,[(r(!0),f(Z,null,te(v.apiCall.variableAttributes[Te],(Ue,Pe)=>(r(),f("div",{key:Pe,class:"attribute-item"},[s("label",jl,b(Pe)+":",1),s("span",Hl,b(Ue),1)]))),128))])):R("",!0)]))),128))])])):R("",!0),s("div",ql,[y[12]||(y[12]=s("h3",null,"Resolved Prompt",-1)),s("div",Gl,b(v.apiCall.prompt),1)]),v.apiCall.result?(r(),f("div",Jl,[y[36]||(y[36]=s("h3",null,"Response",-1)),v.apiCall.status==="failed"&&v.apiCall.result.error?(r(),f("div",Xl,[S(H,{type:"error",message:v.apiCall.result.error,description:v.apiCall.result.errorType?`Error Type: ${F(v.apiCall.result.errorType)}`:void 0,"show-icon":""},null,8,["message","description"])])):v.apiCall.result.content?(r(),f("div",Kl,[s("div",Yl,b(v.apiCall.result.content),1),v.apiCall.result.parsedContent!==void 0?(r(),f("div",Ql,[y[13]||(y[13]=s("h4",null,"Extracted Value (Original)",-1)),s("div",Zl,b(L(v.apiCall.result.parsedContent)),1)])):R("",!0),v.apiCall.result.postParsedContent!==void 0?(r(),f("div",ei,[y[14]||(y[14]=s("h4",null,"Post-Processed Value",-1)),s("div",ti,b(L(v.apiCall.result.postParsedContent)),1)])):R("",!0),v.apiCall.result.refused?(r(),f("div",si,[S(H,{type:"warning",message:"Response flagged as refusal (Original Extraction)",description:"This response matched configured refusal patterns","show-icon":""})])):R("",!0),v.apiCall.result.postRefused?(r(),f("div",ai,[S(H,{type:"warning",message:"Response flagged as refusal (Post-Processing)",description:"This response matched post-processing refusal patterns","show-icon":""})])):R("",!0),s("div",ni,[y[22]||(y[22]=s("h4",null,"Original Extraction Configuration",-1)),s("div",oi,[T.value.parserId?(r(),f("div",li,[y[15]||(y[15]=s("label",null,"Parser ID:",-1)),s("span",ii,b(T.value.parserId),1)])):R("",!0),T.value.outputType?(r(),f("div",ri,[y[16]||(y[16]=s("label",null,"Output Type:",-1)),s("span",ui,b(T.value.outputType),1)])):R("",!0),T.value.extractPattern?(r(),f("div",di,[y[17]||(y[17]=s("label",null,"Extract Pattern:",-1)),s("span",ci,b(T.value.extractPattern),1)])):R("",!0),T.value.refusalWords&&T.value.refusalWords.length>0?(r(),f("div",pi,[y[18]||(y[18]=s("label",null,"Refusal Words:",-1)),s("span",fi,b(T.value.refusalWords.join(", ")),1)])):R("",!0),T.value.refusalMode?(r(),f("div",mi,[y[19]||(y[19]=s("label",null,"Refusal Mode:",-1)),s("span",vi,b(T.value.refusalMode==="parse_anyway"?"Parse normally":"Replace with REFUSED"),1)])):T.value.rejectRefusalWords!==void 0?(r(),f("div",gi,[y[20]||(y[20]=s("label",null,"Reject on Refusal (Legacy):",-1)),s("span",hi,b(T.value.rejectRefusalWords?"Yes":"No"),1)])):R("",!0),U.value?R("",!0):(r(),f("div",yi,y[21]||(y[21]=[s("span",{class:"no-config-message"},"No extraction configuration set for this trial",-1)])))])]),N.value&&N.value.enabled?(r(),f("div",bi,[y[30]||(y[30]=s("h4",null,"Post-Processing Configuration",-1)),s("div",_i,[s("div",Ti,[y[24]||(y[24]=s("label",null,"Status:",-1)),s("span",Ci,[S(E,{color:"processing"},{default:x(()=>y[23]||(y[23]=[D("Enabled")])),_:1,__:[23]})])]),N.value.outputType?(r(),f("div",$i,[y[25]||(y[25]=s("label",null,"Output Type:",-1)),s("span",wi,b(N.value.outputType),1)])):R("",!0),N.value.extractPattern?(r(),f("div",ki,[y[26]||(y[26]=s("label",null,"Extract Pattern:",-1)),s("span",Si,b(N.value.extractPattern),1)])):R("",!0),N.value.refusalWords&&N.value.refusalWords.length>0?(r(),f("div",Ii,[y[27]||(y[27]=s("label",null,"Refusal Words:",-1)),s("span",Ei,b(N.value.refusalWords.join(", ")),1)])):R("",!0),N.value.rejectRefusalWords!==void 0?(r(),f("div",Fi,[y[28]||(y[28]=s("label",null,"Reject on Refusal:",-1)),s("span",Ri,b(N.value.rejectRefusalWords?"Yes":"No"),1)])):R("",!0),N.value.updatedAt?(r(),f("div",xi,[y[29]||(y[29]=s("label",null,"Last Updated:",-1)),s("span",Pi,b($(N.value.updatedAt)),1)])):R("",!0)])])):R("",!0),v.apiCall.result.usage?(r(),f("div",Ai,[y[35]||(y[35]=s("h4",null,"Token Usage",-1)),s("div",Vi,[s("div",Oi,[y[31]||(y[31]=s("label",null,"Prompt Tokens:",-1)),s("span",null,b(v.apiCall.result.usage.prompt_tokens||0),1)]),s("div",Di,[y[32]||(y[32]=s("label",null,"Completion Tokens:",-1)),s("span",null,b(v.apiCall.result.usage.completion_tokens||0),1)]),s("div",Ni,[y[33]||(y[33]=s("label",null,"Total Tokens:",-1)),s("span",null,b(v.apiCall.result.usage.total_tokens||0),1)]),k.value?(r(),f("div",Li,[y[34]||(y[34]=s("label",null,"Cost:",-1)),s("span",null,"$"+b(k.value.toFixed(4)),1)])):R("",!0)])])):R("",!0)])):R("",!0)])):R("",!0),S(oe,{ghost:""},{default:x(()=>[S(ne,{key:"raw",header:"Raw Data"},{default:x(()=>[s("div",Mi,[y[37]||(y[37]=s("h4",null,"HTTP Request",-1)),s("pre",Ui,b(C.value),1),v.apiCall.response?(r(),f("h4",zi,"Full API Response")):R("",!0),v.apiCall.response?(r(),f("pre",Bi,b(V.value),1)):R("",!0),v.apiCall.result?(r(),f("h4",Wi,"Processed Result")):R("",!0),v.apiCall.result?(r(),f("pre",ji,b(I.value),1)):R("",!0)])]),_:1})]),_:1})]),s("div",Hi,[v.allApiCalls&&u.value>1?(r(),f("div",qi,[S(de,{onClick:j,disabled:!d.value,size:"large",class:"nav-button"},{default:x(()=>y[38]||(y[38]=[D(" â† Previous ")])),_:1,__:[38]},8,["disabled"]),s("span",Gi,b(n.value+1)+" of "+b(u.value),1),S(de,{onClick:Y,disabled:!p.value,size:"large",class:"nav-button"},{default:x(()=>y[39]||(y[39]=[D(" Next â†’ ")])),_:1,__:[39]},8,["disabled"])])):R("",!0),s("div",Ji,[S(de,{onClick:i,size:"large"},{default:x(()=>y[40]||(y[40]=[D(" Close ")])),_:1,__:[40]}),S(de,{type:"primary",onClick:X,size:"large"},{default:x(()=>[S(W(xt)),y[41]||(y[41]=D(" Copy Details "))]),_:1,__:[41]})])])]),_:1},8,["open"])}}}),Ts=ue(Xi,[["__scopeId","data-v-f7da98a4"]]),Ki={class:"post-processing-modal"},Yi={key:2,class:"current-extraction"},Qi={class:"parser-info"},Zi={class:"parser-name"},er={key:3,class:"current-post-processing"},tr={class:"parser-info"},sr={class:"parser-name"},ar={key:4,class:"test-results"},nr={class:"footer-container"},or={key:0,class:"footer-statistics"},lr={class:"stat-inline"},ir={class:"stat-inline"},rr={class:"stat-inline"},ur={class:"stat-inline"},dr={key:0,class:"stat-sample-note"},cr={key:1,class:"footer-progress"},pr={class:"processing-message"},fr={class:"footer-buttons"},mr=re({__name:"PostProcessingModalV2",props:{visible:{type:Boolean},trial:{}},emits:["close"],setup(l,{emit:e}){const t=l,a=e,o=ut(),n=va(),u=q(t.visible),d=q(!1),p=q(!1),c=q(!1),g=q(null),_=q({postParserId:null}),h=q(""),k=q(0),C=q([]),T=q(null),U=[{title:"Variables",dataIndex:"variables",key:"variables",width:200,customRender:({text:A})=>Object.entries(A).map(([X,v])=>`${X}: ${v}`).join(", ")},{title:"Original",dataIndex:"original",key:"original",slots:{customRender:"original"}},{title:"Post-Processed",dataIndex:"postProcessed",key:"postProcessed",slots:{customRender:"postProcessed"}},{title:"Changed",dataIndex:"changed",key:"changed",width:100,slots:{customRender:"changed"}}],N=M(()=>t.trial.parserId?n.parsers.find(A=>A.id===t.trial.parserId):null),V=M(()=>t.trial.postParserId?n.parsers.find(A=>A.id===t.trial.postParserId):null);function I(A){switch(A){case"regex":return"blue";case"javascript":return"orange";case"python":return"green";default:return"default"}}function w(A){return A===void 0?"(no match)":A===null?"null":typeof A=="string"&&A.length>50?A.substring(0,50)+"...":String(A)}function O(){p.value=!0}function $(A){g.value=A,c.value=!0}async function m(A,X){if(!A||!X){C.value=[],T.value=null;return}await L(X),await F(X)}async function L(A){const X=o.apiCalls.value.filter(y=>y.result?.content).slice(0,10),v=[];for(const y of X){const E=await Ot.executeParser(y.result.content,A);v.push({id:y.id,variables:y.variables,original:y.result.parsedContent,postProcessed:E.success?E.value:null,changed:E.success&&E.value!==y.result.parsedContent})}C.value=v}async function F(A){if(!o.apiCalls.value.length){T.value=null;return}const X=o.apiCalls.value,v=X.length,y=X.filter(me=>me.result?.content),E=y.length,H=Math.min(50,E),ne=y.slice(0,H);let oe=0,de=0;for(const me of ne){const Te=await Ot.executeParser(me.result.content,A);Te.success&&Te.value!==void 0&&(oe++,Te.value!==me.result.parsedContent&&de++)}const fe=H<E;if(fe&&H>0){const me=E/H;oe=Math.round(oe*me),de=Math.round(de*me)}T.value={total:v,withContent:E,matches:oe,changed:de,sampled:fe,sampleSize:H}}async function i(){d.value=!0,h.value="Clearing post-processing...";try{const A=await Mt.updatePostParserId(t.trial.id,null,!1);if(A.ok)_.value.postParserId=null,C.value=[],T.value=null,le.success("Post-processing cleared"),await o.refreshFromDatabase(t.trial.id);else throw A.error}catch(A){P.error("Failed to clear post-processing:",A),le.error("Failed to clear post-processing")}finally{d.value=!1,h.value=""}}async function j(){if(!_.value.postParserId){le.warning("Please select a parser");return}d.value=!0,k.value=0;try{const A=o.apiCalls.value.filter(E=>E.status==="completed"&&E.result?.content),X=A.length>0;let v=!1;if(X){const ne=(n.parsers.find(oe=>oe.id===_.value.postParserId)?.type||"parser")==="python"?`Apply post-processing to ${A.length} existing calls?

Note: Python parsers may take several minutes for large trials.`:`Apply post-processing to ${A.length} existing calls?`;v=confirm(ne)}v?(h.value=`Applying to ${A.length} calls...`,k.value=10):(h.value="Saving configuration...",k.value=50);const y=await Mt.updatePostParserId(t.trial.id,_.value.postParserId,v);if(y.ok)k.value=90,h.value="Refreshing data...",await o.refreshFromDatabase(t.trial.id),k.value=100,h.value="Complete!",le.success(v?`Post-processing applied to ${A.length} calls`:"Post-processing configured for future calls"),d.value=!1,setTimeout(()=>{Y()},1e3);else throw y.error}catch(A){P.error("Failed to apply post-processing:",A),le.error("Failed to apply post-processing"),d.value=!1,h.value="",k.value=0}}function Y(){d.value||a("close")}return $e(async()=>{if(await n.initialize(),t.trial.postParserId){_.value.postParserId=t.trial.postParserId;const A=n.parsers.find(X=>X.id===t.trial.postParserId);A&&(await L(A),await F(A))}else t.trial.postProcessingConfig?.enabled&&le.info("Legacy post-processing config detected. Please select a parser to continue.")}),ie(()=>t.visible,A=>{u.value=A}),ie(u,A=>{!A&&!d.value&&a("close")}),(A,X)=>{const v=it,y=lt,E=ia,H=ra,ne=ua,oe=we,de=Ae;return r(),Q(de,{visible:u.value,"onUpdate:visible":X[1]||(X[1]=fe=>u.value=fe),title:"Post-Process Extraction",width:"80%","mask-closable":!d.value,closable:!d.value,onCancel:Y},{footer:x(()=>[s("div",nr,[T.value&&_.value.postParserId&&!d.value?(r(),f("div",or,[s("span",lr,[X[5]||(X[5]=s("span",{class:"stat-label"},"Total:",-1)),X[6]||(X[6]=D()),s("strong",null,b(T.value.total),1)]),X[13]||(X[13]=s("span",{class:"stat-divider"},"|",-1)),s("span",ir,[X[7]||(X[7]=s("span",{class:"stat-label"},"With Content:",-1)),X[8]||(X[8]=D()),s("strong",null,b(T.value.withContent),1)]),X[14]||(X[14]=s("span",{class:"stat-divider"},"|",-1)),s("span",rr,[X[9]||(X[9]=s("span",{class:"stat-label"},"Est. Matches:",-1)),X[10]||(X[10]=D()),s("strong",null,b(T.value.matches),1)]),X[15]||(X[15]=s("span",{class:"stat-divider"},"|",-1)),s("span",ur,[X[11]||(X[11]=s("span",{class:"stat-label"},"Est. Changed:",-1)),X[12]||(X[12]=D()),s("strong",null,b(T.value.changed),1)]),T.value.sampled?(r(),f("span",dr," ("+b(T.value.sampleSize)+" samples) ",1)):R("",!0)])):R("",!0),d.value?(r(),f("div",cr,[s("div",pr,b(h.value),1),S(ne,{percent:k.value,status:k.value===100?"success":"active","stroke-width":4,style:{width:"100%"}},null,8,["percent","status"])])):R("",!0),s("div",fr,[V.value?(r(),Q(oe,{key:0,onClick:i,disabled:d.value,danger:""},{default:x(()=>X[16]||(X[16]=[D(" Clear Post-Processing ")])),_:1,__:[16]},8,["disabled"])):R("",!0),S(oe,{onClick:Y,disabled:d.value},{default:x(()=>[D(b(d.value?"Processing...":"Close"),1)]),_:1},8,["disabled"]),S(oe,{type:"primary",onClick:j,loading:d.value,disabled:!_.value.postParserId||_.value.postParserId===A.trial.postParserId},{default:x(()=>[D(b(d.value?h.value:"Apply Post-Processing"),1)]),_:1},8,["loading","disabled"])])])]),default:x(()=>[s("div",Ki,[A.trial.status==="running"?(r(),Q(v,{key:0,message:"Trial is currently running",description:"Post-processing will apply to all completed calls and future results as they arrive.",type:"info","show-icon":"",style:{"margin-bottom":"20px"}})):A.trial.status==="draft"?(r(),Q(v,{key:1,message:"Trial not started",description:"Configure post-processing now. It will apply when the trial runs.",type:"warning","show-icon":"",style:{"margin-bottom":"20px"}})):R("",!0),N.value?(r(),f("div",Yi,[X[2]||(X[2]=s("h4",null,"Current Primary Parser",-1)),s("div",Qi,[s("span",Zi,b(N.value.name),1),S(y,{color:I(N.value.type)},{default:x(()=>[D(b(N.value.type),1)]),_:1},8,["color"]),S(y,null,{default:x(()=>[D(b(N.value.outputType),1)]),_:1})])])):R("",!0),V.value?(r(),f("div",er,[X[3]||(X[3]=s("h4",null,"Active Post-Processing Parser",-1)),s("div",tr,[s("span",sr,b(V.value.name),1),S(y,{color:I(V.value.type)},{default:x(()=>[D(b(V.value.type),1)]),_:1},8,["color"]),S(y,null,{default:x(()=>[D(b(V.value.outputType),1)]),_:1})])])):R("",!0),S(E,{label:V.value?"Change Post-Processing Parser":"Select Post-Processing Parser"},{default:x(()=>[S(ma,{modelValue:_.value.postParserId,"onUpdate:modelValue":X[0]||(X[0]=fe=>_.value.postParserId=fe),"allow-create":!0,"show-preview":!0,placeholder:"Select or create a parser for post-processing",onCreate:O,onTest:$,onChange:m},null,8,["modelValue"])]),_:1},8,["label"]),C.value.length>0&&_.value.postParserId?(r(),f("div",ar,[X[4]||(X[4]=s("h4",null,"Preview Results (First 10 calls)",-1)),S(H,{columns:U,"data-source":C.value,pagination:!1,size:"small",scroll:{x:800}},{original:x(({text:fe})=>[s("code",null,b(w(fe)),1)]),postProcessed:x(({text:fe,record:me})=>[s("code",{class:se({"value-changed":me.changed})},b(w(fe)),3)]),changed:x(({text:fe})=>[S(y,{color:fe?"green":"default"},{default:x(()=>[D(b(fe?"Changed":"Same"),1)]),_:2},1032,["color"])]),_:1},8,["data-source"])])):R("",!0)])]),_:1},8,["visible","mask-closable","closable"])}}}),vr=ue(mr,[["__scopeId","data-v-17edda1c"]]),gr={class:"trial-results-table"},hr={class:"table-container"},yr={class:"virtual-header"},br={key:0,class:"col-status header-cell"},_r={key:1,class:"col-configuration header-cell"},Tr={key:2,class:"col-repeat header-cell"},Cr={key:3,class:"col-variables header-cell"},$r={key:4,class:"col-response header-cell"},wr={key:5,class:"col-parsed header-cell"},kr={key:6,class:"col-post-processed header-cell"},Sr={key:0,class:"post-process-indicator"},Ir={key:7,class:"col-length header-cell"},Er={key:8,class:"col-latency header-cell"},Fr=["onClick"],Rr={key:0,class:"col-status cell"},xr={class:"status-cell"},Pr={class:"status-time"},Ar={key:1,class:"col-configuration cell"},Vr={key:2,class:"col-repeat cell"},Or={key:3,class:"col-variables cell"},Dr={class:"variable-tags"},Nr={key:0,class:"var-item"},Lr={key:1,class:"var-item"},Mr={key:2},Ur={key:3},zr={key:4,class:"col-response cell"},Br={class:"response-content"},Wr={key:5,class:"col-parsed cell"},jr={class:"parsed-content"},Hr={key:6,class:"col-post-processed cell"},qr={class:"parsed-content"},Gr={key:7,class:"col-length cell"},Jr={key:8,class:"col-latency cell"},Xr={key:1,class:"results-table"},Kr={key:0,class:"col-status"},Yr={key:1,class:"col-configuration"},Qr={key:2,class:"col-repeat"},Zr={key:3,class:"col-variables"},eu={key:4,class:"col-response"},tu={key:5,class:"col-parsed"},su={key:6,class:"col-post-processed"},au={key:0,class:"post-process-indicator"},nu={key:7,class:"col-length"},ou={key:8,class:"col-latency"},lu=["onClick"],iu={key:0,class:"col-status"},ru={class:"status-cell"},uu={class:"status-time"},du={key:1,class:"col-configuration"},cu={key:2,class:"col-repeat"},pu={key:3,class:"col-variables"},fu={class:"variable-tags"},mu={key:0,class:"var-item"},vu={key:1,class:"var-item"},gu={key:2},hu={key:3},yu={key:4,class:"col-response"},bu={class:"response-content"},_u={key:5,class:"col-parsed"},Tu={class:"parsed-content"},Cu={key:6,class:"col-post-processed"},$u={class:"parsed-content"},wu={key:7,class:"col-length"},ku={key:8,class:"col-latency"},Su={key:0},Iu=["colspan"],Eu={key:0},Fu={key:1},jt="trial-results-visible-columns",Ru=re({__name:"TrialResultsTableV3",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(l){const e=l,t=q("all"),a=q([]),o=q(""),n=q(["status","configuration","variables","response","parsedResponse","length","latency"]),u=q(null),d=q(!1),p=ut(),c=M(()=>p.apiCalls?.value||[]),g=M(()=>e.apiCalls||c.value);ie(g,(v,y)=>{const E=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 calls data changed from ${y?.length||0} to ${v.length} calls`),setTimeout(()=>{const H=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 reactive update completed in ${(H-E).toFixed(1)}ms`)},0)});const _=v=>{if(!o.value)return v;const y=o.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),E=new RegExp(`(${y})`,"gi");return v.replace(E,"<mark>$1</mark>")},h=M(()=>{const v=performance.now();if(!(t.value!=="all"||a.value.length>0||o.value))return performance.now()-v>5&&P.info(`V4_OPTIMIZE: No filtering needed, returning ${g.value.length} calls directly`),g.value;let E=g.value.filter(ne=>{if(t.value!=="all"&&ne.status!==t.value||a.value.length>0&&!a.value.includes(String(ne.configurationIndex)))return!1;if(o.value){const oe=o.value.toLowerCase();if(!(ne.prompt?.toLowerCase().includes(oe)||ne.result?.content?.toLowerCase().includes(oe)||ne.result?.error?.toLowerCase().includes(oe)))return!1}return!0});const H=performance.now();return H-v>10&&P.info(`V4_OPTIMIZE: Filtered ${g.value.length} â†’ ${E.length} calls in ${(H-v).toFixed(1)}ms`),E});ie(h,(v,y)=>{const E=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls changed from ${y?.length||0} to ${v.length} items`),setTimeout(()=>{const H=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls render completed in ${(H-E).toFixed(1)}ms`)},0)});const k=M(()=>g.value),C=M(()=>g.value.length),T=M(()=>e.trial.configurations.some(v=>v.repeatCount>1)),U=M(()=>60);function N(v){}function V(v){const y=e.trial.configurations[v];return y?y.modelSnapshot?.displayName||`${y.modelId}`:`Config ${v+1}`}function I(v){return v.status==="pending"?"Waiting...":v.status==="running"?"Processing...":v.status==="failed"?v.result?.errorType==="refusal_detected"||v.result?.error==="REFUSED"?v.result?.content||"REFUSED":v.result?.error||"Error occurred":v.result?.content||""}function w(v){if(!v.result)return"";if(v.result.parsedContent!==void 0){const y=v.result.parsedContent;return y===null?"null":typeof y=="string"?y:typeof y=="number"||typeof y=="boolean"?String(y):JSON.stringify(y)}return""}function O(v){if(!v.result||v.result.postParsedContent===void 0)return"";const y=v.result.postParsedContent;return y===null?"null":y==="REFUSED"||v.result.postRefused?"REFUSED":typeof y=="string"?y:typeof y=="number"||typeof y=="boolean"?String(y):JSON.stringify(y)}function $(v){const y=v.result?.content||"";if(!y)return"";const E=y.length;return E>1e3?`${(E/1e3).toFixed(1)}k chars`:`${E} chars`}function m(v){return v?v<1e3?`${v}ms`:`${(v/1e3).toFixed(1)}s`:""}function L(v){return v.status==="completed"&&v.result?.refused?"REFUSED":v.status.toUpperCase()}function F(v){return v.status==="completed"&&v.result?.refused?"status-refused":`status-${v.status}`}function i(v){let y;switch(v.status){case"completed":case"failed":y=v.completed;break;case"running":y=v.started;break;case"pending":case"cancelled":y=v.created;break}if(!y)return"";const E=new Date(y),H=E.getHours().toString().padStart(2,"0"),ne=E.getMinutes().toString().padStart(2,"0"),oe=E.getSeconds().toString().padStart(2,"0");return`Â Â ${H}:${ne}:${oe}`}function j(v){return v?v<1e3?"latency-fast":v<5e3?"latency-medium":"latency-slow":""}function Y(v){return _(v)}function A(v){u.value=v}function X(v){u.value=v}return ie(n,v=>{localStorage.setItem(jt,JSON.stringify(v))},{deep:!0}),$e(()=>{const v=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 MOUNTED with ${g.value.length} calls`);const y=localStorage.getItem(jt);if(y)try{n.value=JSON.parse(y)}catch{}Oe(()=>{const E=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 DOM ready in ${(E-v).toFixed(1)}ms`),setTimeout(()=>{const H=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 virtual scrolling ready in ${(H-v).toFixed(1)}ms`)},100)}),setTimeout(()=>{const E=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 mount completed in ${(E-v).toFixed(1)}ms`)},0)}),je(()=>{P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 ACTIVATED (cache hit) with ${g.value.length} calls`)}),He(()=>{P.info("V4_TRIAL_SWITCH: TrialResultsTableV3 DEACTIVATED (cached)")}),Fe(()=>{P.info("V4_TRIAL_SWITCH: TrialResultsTableV3 UNMOUNTED (evicted)")}),(v,y)=>{const E=es("dompurify-html");return r(),f("div",gr,[S($l,{"status-filter":t.value,"onUpdate:statusFilter":y[0]||(y[0]=H=>t.value=H),"config-filter":a.value,"onUpdate:configFilter":y[1]||(y[1]=H=>a.value=H),"search-query":o.value,"onUpdate:searchQuery":y[2]||(y[2]=H=>o.value=H),"visible-columns":n.value,"onUpdate:visibleColumns":y[3]||(y[3]=H=>n.value=H),configurations:v.trial.configurations,"api-calls":k.value,"show-repeat-column":T.value,onOpenPostProcessing:y[4]||(y[4]=H=>d.value=!0)},null,8,["status-filter","config-filter","search-query","visible-columns","configurations","api-calls","show-repeat-column"]),s("div",hr,[C.value>100?(r(),Q(W(ct),{key:0,class:"results-scroller",items:Array.from(h.value),"item-size":U.value,"key-field":"id",buffer:10,onVisibleRange:N},{before:x(()=>[s("div",yr,[n.value.includes("status")?(r(),f("div",br,"Status")):R("",!0),n.value.includes("configuration")?(r(),f("div",_r,"Configuration")):R("",!0),n.value.includes("repeat")&&T.value?(r(),f("div",Tr,"Repeat")):R("",!0),n.value.includes("variables")?(r(),f("div",Cr,"Variables")):R("",!0),n.value.includes("response")?(r(),f("div",$r,"Response")):R("",!0),n.value.includes("parsedResponse")?(r(),f("div",wr,"Parsed Response")):R("",!0),n.value.includes("postProcessedResponse")?(r(),f("div",kr,[y[7]||(y[7]=D(" Post-Processed ")),v.trial.postProcessingConfig?.enabled?(r(),f("span",Sr,"âœ¨")):R("",!0)])):R("",!0),n.value.includes("length")?(r(),f("div",Ir,"Length")):R("",!0),n.value.includes("latency")?(r(),f("div",Er,"Latency")):R("",!0)])]),default:x(({item:H})=>[s("div",{class:se(["result-row virtual-row",`status-${H.status}`]),onClick:ne=>A(H)},[n.value.includes("status")?(r(),f("div",Rr,[s("div",xr,[s("span",{class:se(["status-tag",F(H)])},b(L(H)),3),s("span",Pr,b(i(H)),1)])])):R("",!0),n.value.includes("configuration")?(r(),f("div",Ar,b(V(H.configurationIndex)),1)):R("",!0),n.value.includes("repeat")&&T.value?(r(),f("div",Vr," #"+b((H.repeatIndex||0)+1),1)):R("",!0),n.value.includes("variables")?(r(),f("div",Or,[s("div",Dr,[(r(!0),f(Z,null,te(Object.entries(H.variables),([ne,oe],de)=>(r(),f(Z,{key:ne},[y[9]||(y[9]=s("span",{class:"var-bullet"},"â€¢ ",-1)),Object.keys(H.variables).length<=2?(r(),f("span",Nr,b(ne)+": "+b(oe),1)):(r(),f("span",Lr,b(oe),1)),Object.keys(H.variables).length===2&&de===0?(r(),f("span",Mr,y[8]||(y[8]=[s("br",null,null,-1)]))):de<Object.keys(H.variables).length-1?(r(),f("span",Ur,b("Â Â "))):R("",!0)],64))),128))])])):R("",!0),n.value.includes("response")?(r(),f("div",zr,[Le(s("div",Br,null,512),[[E,Y(I(H)),"apiResponse"]])])):R("",!0),n.value.includes("parsedResponse")?(r(),f("div",Wr,[s("div",jr,b(w(H)),1)])):R("",!0),n.value.includes("postProcessedResponse")?(r(),f("div",Hr,[s("div",qr,b(O(H)),1)])):R("",!0),n.value.includes("length")?(r(),f("div",Gr,b($(H)),1)):R("",!0),n.value.includes("latency")?(r(),f("div",Jr,[s("span",{class:se(j(H.response?.latencyMs))},b(m(H.response?.latencyMs)),3)])):R("",!0)],10,Fr)]),_:1},8,["items","item-size"])):(r(),f("table",Xr,[s("thead",null,[s("tr",null,[n.value.includes("status")?(r(),f("th",Kr,"Status")):R("",!0),n.value.includes("configuration")?(r(),f("th",Yr,"Configuration")):R("",!0),n.value.includes("repeat")&&T.value?(r(),f("th",Qr,"Repeat")):R("",!0),n.value.includes("variables")?(r(),f("th",Zr,"Variables")):R("",!0),n.value.includes("response")?(r(),f("th",eu,"Response")):R("",!0),n.value.includes("parsedResponse")?(r(),f("th",tu,"Parsed Response")):R("",!0),n.value.includes("postProcessedResponse")?(r(),f("th",su,[y[10]||(y[10]=D(" Post-Processed ")),v.trial.postProcessingConfig?.enabled?(r(),f("span",au,"âœ¨")):R("",!0)])):R("",!0),n.value.includes("length")?(r(),f("th",nu,"Length")):R("",!0),n.value.includes("latency")?(r(),f("th",ou,"Latency")):R("",!0)])]),s("tbody",null,[(r(!0),f(Z,null,te(h.value,H=>(r(),f("tr",{key:H.id,class:se(["result-row",`status-${H.status}`]),onClick:ne=>A(H)},[n.value.includes("status")?(r(),f("td",iu,[s("div",ru,[s("span",{class:se(["status-tag",F(H)])},b(L(H)),3),s("span",uu,b(i(H)),1)])])):R("",!0),n.value.includes("configuration")?(r(),f("td",du,b(V(H.configurationIndex)),1)):R("",!0),n.value.includes("repeat")&&T.value?(r(),f("td",cu," #"+b((H.repeatIndex||0)+1),1)):R("",!0),n.value.includes("variables")?(r(),f("td",pu,[s("div",fu,[(r(!0),f(Z,null,te(H.variables,(ne,oe,de)=>(r(),f(Z,{key:oe},[y[12]||(y[12]=s("span",{class:"var-bullet"},"â€¢ ",-1)),Object.keys(H.variables).length<=2?(r(),f("span",mu,b(oe)+": "+b(ne),1)):(r(),f("span",vu,b(ne),1)),Object.keys(H.variables).length===2&&de===0?(r(),f("span",gu,y[11]||(y[11]=[s("br",null,null,-1)]))):de<Object.keys(H.variables).length-1?(r(),f("span",hu,b("Â Â "))):R("",!0)],64))),128))])])):R("",!0),n.value.includes("response")?(r(),f("td",yu,[Le(s("div",bu,null,512),[[E,Y(I(H)),"apiResponse"]])])):R("",!0),n.value.includes("parsedResponse")?(r(),f("td",_u,[s("div",Tu,b(w(H)),1)])):R("",!0),n.value.includes("postProcessedResponse")?(r(),f("td",Cu,[s("div",$u,b(O(H)),1)])):R("",!0),n.value.includes("length")?(r(),f("td",wu,b($(H)),1)):R("",!0),n.value.includes("latency")?(r(),f("td",ku,[s("span",{class:se(j(H.response?.latencyMs))},b(m(H.response?.latencyMs)),3)])):R("",!0)],10,lu))),128)),h.value.length===0?(r(),f("tr",Su,[s("td",{colspan:n.value.length,class:"empty-state"},[c.value.length===0?(r(),f("div",Eu," No API calls yet. Start the trial to begin execution. ")):(r(),f("div",Fu," No results match your filters. "))],8,Iu)])):R("",!0)])]))]),u.value?(r(),Q(Ts,{key:0,visible:!!u.value,"api-call":u.value,trial:v.trial,"all-api-calls":k.value,"onUpdate:visible":y[5]||(y[5]=H=>u.value=null),onNavigate:X},null,8,["visible","api-call","trial","all-api-calls"])):R("",!0),d.value?(r(),Q(vr,{key:1,visible:d.value,trial:v.trial,onClose:y[6]||(y[6]=H=>d.value=!1)},null,8,["visible","trial"])):R("",!0)])}}}),xu=ue(Ru,[["__scopeId","data-v-e8330c79"]]),Pu={class:"trial-analysis-view"},Au=re({__name:"TrialAnalysisView",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(l){const e=l;return $e(()=>{const t=performance.now();P.info(`V4_TRIAL_SWITCH: TrialAnalysisView MOUNTED for trial ${e.trial.id}`),Oe(()=>{const a=performance.now();P.info(`V4_TRIAL_SWITCH: TrialAnalysisView DOM ready in ${(a-t).toFixed(1)}ms`)}),setTimeout(()=>{const a=performance.now();P.info(`V4_TRIAL_SWITCH: TrialAnalysisView mount completed in ${(a-t).toFixed(1)}ms`)},0)}),je(()=>{P.info(`V4_TRIAL_SWITCH: TrialAnalysisView ACTIVATED (cache hit) for trial ${e.trial.id}`)}),He(()=>{P.info(`V4_TRIAL_SWITCH: TrialAnalysisView DEACTIVATED (cached) for trial ${e.trial.id}`)}),Fe(()=>{P.info(`V4_TRIAL_SWITCH: TrialAnalysisView UNMOUNTED (evicted) for trial ${e.trial.id}`)}),(t,a)=>(r(),f("div",Pu,[S(xu,{trial:t.trial,progress:t.progress,"is-executing":t.isExecuting,"api-calls":t.apiCalls,"is-streaming":t.isStreaming,"is-loading":t.isLoading},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])]))}}),Vu=ue(Au,[["__scopeId","data-v-602f5d5a"]]);function Ht(l,e){const t=new Set,a=new Set,o=new Set;l.forEach(g=>{g.variables&&Object.keys(g.variables).forEach(_=>t.add(_)),g.variableAttributes&&Object.values(g.variableAttributes).forEach(_=>{_&&Object.keys(_).forEach(h=>a.add(h))})});const n=Array.from(t).sort(),u=Array.from(a).sort(),d=Array.from(o).sort(),p=[],c=["success","refused","parsed_response",...p,...d];return{categorical:[...n,...u,"model","status","error_type"],numeric:["response_time","total_tokens","prompt_tokens","completion_tokens",...p].sort(),extracted:c}}function $t(l,e,t){switch(e){case"model":return t&&l.configurationIndex<t.configurations.length&&t.configurations[l.configurationIndex].modelId||"Unknown";case"status":return l.status;case"response_time":return Ls(l.response?.latencyMs);case"total_tokens":if(l.response?.body?.usage){const a=l.response.body.usage;return a.total_tokens||Ns(a.prompt_tokens,a.completion_tokens)||Qe(null)}return Qe(null);case"prompt_tokens":return Qe(l.response?.body?.usage?.prompt_tokens||l.response?.body?.usage?.input_tokens);case"completion_tokens":return Qe(l.response?.body?.usage?.completion_tokens||l.response?.body?.usage?.output_tokens);case"error_type":return l.result?.errorType||(l.result?.success===!1?"api_error":"success");case"success":return l.result?.success?1:0;case"refused":return l.result?.refused?1:0;case"parsed_response":if(l.result?.parsedContent!==void 0){const a=l.result.parsedContent;return typeof a=="object"?JSON.stringify(a):a}return null}if(l.variables?.[e]!==void 0)return l.variables[e];if(l.variableAttributes)for(const a of Object.keys(l.variableAttributes)){const o=l.variableAttributes[a];if(o&&o[e]!==void 0)return o[e]}return null}const qe={count:{label:"Count",calculate:l=>l.length,format:l=>l.toString(),needsNumeric:!1},sum:{label:"Sum",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0):null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},mean:{label:"Mean",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0)/e.length:null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},median:{label:"Median",calculate:l=>{const e=l.map(o=>typeof o=="number"?o:null).filter(o=>o!==null);if(e.length===0)return null;const t=[...e].sort((o,n)=>o-n),a=Math.floor(t.length/2);return t.length%2===0?(t[a-1]+t[a])/2:t[a]},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},mode:{label:"Mode",calculate:l=>{if(l.length===0)return null;const e=new Map;l.forEach(o=>e.set(o,(e.get(o)||0)+1));let t=0,a=null;return e.forEach((o,n)=>{o>t&&(t=o,a=n)}),{value:a,count:t,total:l.length}},format:l=>l?`${l.value} (${l.count}/${l.total})`:"-",needsNumeric:!1},variance:{label:"Variance",calculate:l=>{const e=l.map(o=>typeof o=="number"?o:null).filter(o=>o!==null);if(e.length<=1)return null;const t=e.reduce((o,n)=>o+n,0)/e.length;return e.reduce((o,n)=>o+Math.pow(n-t,2),0)/(e.length-1)},format:l=>l?.toFixed(3)||"-",needsNumeric:!0},std_dev:{label:"Std Dev",calculate:l=>{const e=qe.variance.calculate(l);return e!==null?Math.sqrt(e):null},format:l=>l?.toFixed(3)||"-",needsNumeric:!0},min:{label:"Min",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.min(...e):null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},max:{label:"Max",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.max(...e):null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},success_rate:{label:"Success Rate",calculate:(l,e)=>{const t=e.filter(a=>a.result?.success).length;return e.length>0?t/e.length:0},format:l=>`${Math.round(l*100)}%`,needsNumeric:!1,usesApiCalls:!0},refusal_rate:{label:"Refusal Rate",calculate:(l,e)=>{const t=e.filter(a=>a.result?.refused).length;return e.length>0?t/e.length:0},format:l=>`${Math.round(l*100)}%`,needsNumeric:!1,usesApiCalls:!0},avg_time:{label:"Avg Time (ms)",calculate:(l,e)=>{const t=e.filter(a=>a.response?.latencyMs).map(a=>a.response.latencyMs);return t.length>0?t.reduce((a,o)=>a+o,0)/t.length:null},format:l=>l?`${Math.round(l)}ms`:"-",needsNumeric:!1,usesApiCalls:!0},percent_non_numeric:{label:"% Non-Numeric",calculate:l=>l.length===0?0:l.filter(t=>!!(t==null||typeof t!="number"||Number.isNaN(t)||!Number.isFinite(t))).length/l.length*100,format:l=>`${Math.round(l)}%`,needsNumeric:!1}};function Ou(l,e,t){const a=performance.now(),o=new Map,n=new Set,u=new Set,d=new Map,p=(I,w)=>{d.has(w)||d.set(w,new Map);const O=d.get(w);return O.has(I)||O.set(I,$t(I,w,t)),O.get(I)};for(const I of l){const w=String(p(I,e.rowField)||"Unknown"),O=String(p(I,e.columnField)||"Unknown");n.add(w),u.add(O),o.has(w)||o.set(w,new Map);const $=o.get(w);$.has(O)||$.set(O,[]),$.get(O).push(I)}const c=performance.now()-a;c>50&&`${l.length}${c.toFixed(1)}`;const g=I=>I.every(O=>!isNaN(Number(O))&&O.trim()!=="")?I.sort((O,$)=>Number(O)-Number($)):I.sort(),_=(I,w)=>(t&&(t.type,t.type),g(I)),h=e.rowSort==="original"?_(Array.from(n),e.rowField):g(Array.from(n)),k=e.columnSort==="original"?_(Array.from(u),e.columnField):g(Array.from(u)),C=qe[e.aggregation];function T(I,w=!1){const O=w?I.map(F=>p(F,e.valueField)):I.map(F=>$t(F,e.valueField,t));if(!C||typeof C.calculate!="function")return P.error("Invalid aggregation function:",e.aggregation,C),{value:null,count:I.length,apiCalls:I,rawValues:O,error:"Invalid aggregation function"};const $={nonNumeric:0,nullUndefined:0};return C.needsNumeric&&($.nonNumeric=O.filter(F=>typeof F!="number").length),$.nullUndefined=O.filter(F=>F==null).length,{value:C.usesApiCalls?C.calculate(O,I):C.calculate(O),count:I.length,apiCalls:I,rawValues:O,excludedCounts:$}}const U=h.map(I=>{const w=[],O=[];return k.forEach($=>{const m=o.get(I)?.get($)||[];w.push(m.length>0?T(m,!0):null),O.push(...m)}),{label:I,cells:w,total:T(O,!0)}}),N=k.map(I=>{const w=[];return h.forEach(O=>{const $=o.get(O)?.get(I)||[];w.push(...$)}),T(w,!0)}),V=performance.now()-a;return V>100&&`${V.toFixed(1)}${l.length}`,{rows:U,columns:k,totals:N,grandTotal:T(l,!0)}}function ye(l,e){return!l||l.value===null?"-":qe[e].format(l.value)}function Du(l){if(!l||Object.keys(l).length===0)return"";const e=[];return l.temperature!==void 0&&e.push(`T:${l.temperature}`),l.max_tokens!==void 0?e.push(`${l.max_tokens}t`):l.maxTokens!==void 0?e.push(`${l.maxTokens}t`):l.num_predict!==void 0&&e.push(`${l.num_predict}t`),l.top_p!==void 0&&e.push(`p:${l.top_p}`),l.top_k!==void 0&&e.push(`k:${l.top_k}`),e.length>0?`(${e.join(", ")})`:""}function Nu(l,e,t,a=q({}),o={}){const n=q({rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}}),u=q({categorical:[],numeric:[],extracted:[]}),d=q(!1),p=q(0),c=q(!1),g=q(0),_=M(()=>{const N=a.value;return Object.values(N).some(I=>I!=="")?l.value.filter(I=>{if(N.model&&N.model!==""){if(!t.value||I.configurationIndex>=t.value.configurations.length)return!1;const w=t.value.configurations[I.configurationIndex],O=w.modelId||"Unknown",$=Du(w.parameters);if(($?`${O} ${$}`:O)!==N.model)return!1}if(N.status&&N.status!==""&&I.status!==N.status)return!1;for(const[w,O]of Object.entries(N))if(O&&O!==""&&w!=="model"&&w!=="status"&&I.variables?.[w]!==O)return!1;return!0}):l.value});let h=null;const k=N=>{h&&h.cancel();let V;switch(N){case"trial":V=0;break;case"tab":V=0;break;case"stream":V=100;break;case"config":V=300;break;default:V=100}h=Lt(()=>{if(_.value.length===0){n.value={rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}};return}d.value=!0;const I=performance.now();try{n.value=Ou(_.value,e.value,t.value);const w=performance.now()-I;p.value=w,P.debug(`Pivot computed from ${N}`,{apiCallCount:_.value.length,computeTimeMs:w,rowCount:n.value.rows.length,columnCount:n.value.columns.length,source:N})}catch(w){P.error("Error computing pivot data",w)}finally{d.value=!1,(N==="tab"||N==="stream")&&(c.value=!1)}},V),h()},C=Lt(()=>{u.value=Ht(l.value,t.value)},200),T=typeof window<"u"?window.__trialDataStoreV4?.():null;ie([e],()=>{k("config")},{deep:!0}),ie(_,(N,V)=>{if(T&&T.activeTab?.value!=="pivot"){c.value=!0,g.value=N.length,`${N.length}`;return}const I=V?.length||0,w=N.length;c.value&&(c.value=!1),(I!==w||w>0)&&k("stream")},{immediate:!0}),T&&ie(()=>T.activeTab?.value,(N,V)=>{N==="pivot"&&V!=="pivot"&&c.value&&(`${g.value}`,k("tab"))});let U=null;return ie([l,t],([N,V])=>{const I=V?.id!==U;U=V?.id||null,I?(`${V?.id}`,u.value=Ht(N),k("trial")):(`${N.length}`,C())},{immediate:!0}),C(),{pivotData:M(()=>n.value),availableFields:M(()=>u.value),isComputing:M(()=>d.value),lastComputeTime:M(()=>p.value),formatCellValue:ye,extractFieldValue:$t,aggregationFunctions:qe}}class Lu{getMimeType(e){switch(e){case"csv":return"text/csv";case"excel":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"tsv":return"text/tab-separated-values";case"json":return"application/json";case"jsonl":return"application/x-jsonlines";case"python":return"text/x-python";case"zip":return"application/zip";default:return"application/octet-stream"}}getFileExtension(e){switch(e){case"csv":return"csv";case"excel":return"xlsx";case"tsv":return"tsv";case"json":return"json";case"jsonl":return"jsonl";case"python":return"py";case"zip":return"zip";default:return"bin"}}generateFilename(e,t,a){const o=this.sanitizeFilename(e),u=(a||new Date).toISOString().split("T")[0],d=this.getFileExtension(t);return`${o}_${t}_${u}.${d}`}estimateFileSize(e,t,a,o=50){let n=e*t*o;switch(a){case"json":n*=2.5;break;case"jsonl":n*=2.2;break;case"csv":n*=1.3;break;case"excel":n*=.8;break;case"tsv":n*=1.1;break;case"python":n=Math.max(n*1.5,5e3);break}return Math.round(n)}formatFileSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:`${(e/(1024*1024*1024)).toFixed(1)} GB`}createDownloadBlob(e,t,a=!1){let o=e;return a&&(o="\uFEFF"+o),new Blob([o],{type:t})}createDownloadBlobFromBase64(e,t){const a=atob(e),o=new Uint8Array(a.length);for(let n=0;n<a.length;n++)o[n]=a.charCodeAt(n);return new Blob([o],{type:t})}triggerDownload(e,t){const a=URL.createObjectURL(e),o=document.createElement("a");o.href=a,o.download=t,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(a),100)}downloadFile(e,t,a,o=!1){const n=this.getMimeType(t),u=this.generateFilename(a,t);let d;t==="excel"?d=this.createDownloadBlobFromBase64(e,n):d=this.createDownloadBlob(e,n,o),this.triggerDownload(d,u)}sanitizeFilename(e){return e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_+/g,"_").substring(0,50).replace(/^_+|_+$/g,"")||"trial"}}const he=new Lu;let wt=null,kt=null,st=!1;try{typeof window<"u"&&("__TAURI__"in window||"__TAURI_INTERNALS__"in window)&&(st=!0)}catch{}async function Mu(){if(!st)return!1;try{return wt||(wt=await Me(()=>import("./tauri-vendor-DvKxkFnM.js").then(l=>l.b),[])),kt||(kt=await Me(()=>import("./tauri-vendor-DvKxkFnM.js").then(l=>l.c),[])),!0}catch(l){return P.warn("Failed to load Tauri modules:",l),st=!1,!1}}class Cs{async downloadFile(e,t,a,o=!1){await this.useTauriSaveDialog(e,t,a,o)||this.useBrowserDownload(e,t,a,o)}async useTauriSaveDialog(e,t,a,o){if(!await Mu())return!1;try{const n=he.generateFilename(a,t),u=he.getFileExtension(t),d=await wt.save({defaultPath:n,filters:[{name:this.getFilterName(t),extensions:[u]}],title:`Save ${this.getFilterName(t)} File`});if(!d)return!0;let p;if(typeof e=="string"){const c=o?"\uFEFF"+e:e;p=new TextEncoder().encode(c)}else p=e;return await kt.writeFile(d,p),`${d}`,!0}catch(n){return P.error("Tauri save dialog error:",n),!1}}useBrowserDownload(e,t,a,o){if(e instanceof Uint8Array&&(t==="zip"||t==="excel")){const _=he.getMimeType(t),h=he.generateFilename(a,t),k=new Blob([e],{type:_}),C=window.URL.createObjectURL(k),T=document.createElement("a");T.href=C,T.download=h,document.body.appendChild(T),T.click(),document.body.removeChild(T),window.URL.revokeObjectURL(C);return}e instanceof Uint8Array&&(e=new TextDecoder().decode(e));const n=he.getMimeType(t),u=he.generateFilename(a,t),d=o?"\uFEFF"+e:e,p=new Blob([d],{type:n}),c=window.URL.createObjectURL(p),g=document.createElement("a");g.href=c,g.download=u,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(c)}async downloadExcelFile(e,t){const a=atob(e),o=new Uint8Array(a.length);for(let n=0;n<a.length;n++)o[n]=a.charCodeAt(n);await this.downloadFile(o,"excel",t,!1)}getFilterName(e){switch(e){case"csv":return"CSV";case"excel":return"Excel";case"tsv":return"TSV";case"json":return"JSON";case"jsonl":return"JSON Lines";case"python":return"Python Script";case"zip":return"ZIP Archive";default:return"Binary"}}isInTauri(){return st}generateFilename(e,t,a){return he.generateFilename(e,t,a)}getMimeType(e){return he.getMimeType(e)}getFileExtension(e){return he.getFileExtension(e)}estimateFileSize(e,t,a,o=50){return he.estimateFileSize(e,t,a,o)}formatFileSize(e){return he.formatFileSize(e)}}const We=new Cs,Uu=Object.freeze(Object.defineProperty({__proto__:null,TauriDownloadUtilities:Cs,tauriDownloadUtilities:We},Symbol.toStringTag,{value:"Module"}));async function zu(l,e,t,a={}){if(!l||!l.rows.length||!l.columns.length)throw new Error("No data available to export");const{includeHeaders:o=!0,includeTotals:n=!0,addBOM:u=!0}=a,d=[];if(o){const h=[],k=at(e.rowField)||"Row",C=at(e.columnField)||"Column";h.push(xe(`${k} / ${C}`)),l.columns.forEach(T=>{h.push(xe(T))}),n&&e.columnField&&h.push(xe("Total")),d.push(h.join(","))}if(l.rows.forEach(h=>{const k=[];if(k.push(xe(h.label)),h.cells.forEach(C=>{const T=ye(C,e.aggregation);k.push(xe(T))}),n&&e.columnField&&h.total){const C=ye(h.total,e.aggregation);k.push(xe(C))}d.push(k.join(","))}),n&&e.rowField&&l.totals){const h=[];if(h.push(xe("Total")),l.totals.forEach(k=>{const C=ye(k,e.aggregation);h.push(xe(C))}),e.columnField&&l.grandTotal){const k=ye(l.grandTotal,e.aggregation);h.push(xe(k))}d.push(h.join(","))}const p=d.join(`
`),g=`pivot_${e.rowField}_by_${e.columnField}_${e.aggregation}`.replace(/[^a-zA-Z0-9_-]/g,"_").substring(0,50),_=`${t}_${g}`;await We.downloadFile(p,"csv",_,u)}function at(l){return l?{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[l]||l.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()):""}function xe(l){if(l==null)return"";const e=String(l);return e.includes(",")||e.includes('"')||e.includes(`
`)||e.includes("\r")?`"${e.replace(/"/g,'""')}"`:e}async function Bu(l,e,t={}){if(!l||!l.rows.length||!l.columns.length)throw new Error("No data available to copy");const{includeHeaders:a=!0,includeTotals:o=!0}=t,n=[];if(a){const d=[],p=at(e.rowField)||"Row",c=at(e.columnField)||"Column";d.push(`${p} / ${c}`),l.columns.forEach(g=>{d.push(g)}),o&&e.columnField&&d.push("Total"),n.push(d.join("	"))}if(l.rows.forEach(d=>{const p=[];if(p.push(d.label),d.cells.forEach(c=>{const g=ye(c,e.aggregation);p.push(g)}),o&&e.columnField&&d.total){const c=ye(d.total,e.aggregation);p.push(c)}n.push(p.join("	"))}),o&&e.rowField&&l.totals){const d=[];if(d.push("Total"),l.totals.forEach(p=>{const c=ye(p,e.aggregation);d.push(c)}),e.columnField&&l.grandTotal){const p=ye(l.grandTotal,e.aggregation);d.push(p)}n.push(d.join("	"))}const u=n.join(`
`);try{await navigator.clipboard.writeText(u)}catch{const p=document.createElement("textarea");p.value=u,p.style.position="fixed",p.style.opacity="0",document.body.appendChild(p),p.select(),document.execCommand("copy"),document.body.removeChild(p)}}const Wu={class:"pivot-config-v3"},ju={class:"config-row"},Hu={class:"config-group"},qu=["value","aria-label"],Gu={label:"Categorical"},Ju=["value"],Xu={class:"config-group sort-group"},Ku=["value","aria-label"],Yu={class:"config-group"},Qu=["value","aria-label"],Zu={label:"Categorical"},ed=["value"],td={class:"config-group sort-group"},sd=["value","aria-label"],ad={class:"config-group"},nd=["value","aria-label"],od={label:"Extracted Values"},ld=["value"],id={label:"Numeric Fields"},rd=["value"],ud={class:"config-group"},dd=["value","aria-label"],cd=re({__name:"PivotConfigurationV3",props:{config:{},availableFields:{}},emits:["update-config"],setup(l,{emit:e}){const t=e;function a(n,u){t("update-config",n,u)}function o(n){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[n]||n.replace(/_/g," ").replace(/\b\w/g,d=>d.toUpperCase())}return(n,u)=>(r(),f("div",Wu,[s("div",ju,[s("div",Hu,[u[6]||(u[6]=s("label",{for:"pivot-row-field"},"Rows (Group by):",-1)),s("select",{id:"pivot-row-field",value:n.config.rowField,"aria-label":"Group rows by "+o(n.config.rowField),onChange:u[0]||(u[0]=d=>a("rowField",d.target.value))},[s("optgroup",Gu,[(r(!0),f(Z,null,te(n.availableFields.categorical,d=>(r(),f("option",{key:d,value:d},b(o(d)),9,Ju))),128))])],40,qu)]),s("div",Xu,[u[8]||(u[8]=s("label",{for:"pivot-row-sort"},"Sort Rows:",-1)),s("select",{id:"pivot-row-sort",value:n.config.rowSort||"original","aria-label":"Sort rows by "+(n.config.rowSort||"original")+" order",onChange:u[1]||(u[1]=d=>a("rowSort",d.target.value))},u[7]||(u[7]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,Ku)]),s("div",Yu,[u[9]||(u[9]=s("label",{for:"pivot-column-field"},"Columns (Group by):",-1)),s("select",{id:"pivot-column-field",value:n.config.columnField,"aria-label":"Group columns by "+o(n.config.columnField),onChange:u[2]||(u[2]=d=>a("columnField",d.target.value))},[s("optgroup",Zu,[(r(!0),f(Z,null,te(n.availableFields.categorical,d=>(r(),f("option",{key:d,value:d},b(o(d)),9,ed))),128))])],40,Qu)]),s("div",td,[u[11]||(u[11]=s("label",{for:"pivot-column-sort"},"Sort Columns:",-1)),s("select",{id:"pivot-column-sort",value:n.config.columnSort||"original","aria-label":"Sort columns by "+(n.config.columnSort||"original")+" order",onChange:u[3]||(u[3]=d=>a("columnSort",d.target.value))},u[10]||(u[10]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,sd)]),s("div",ad,[u[12]||(u[12]=s("label",{for:"pivot-value-field"},"Values (Aggregate):",-1)),s("select",{id:"pivot-value-field",value:n.config.valueField,"aria-label":"Aggregate "+n.config.valueField+" values",onChange:u[4]||(u[4]=d=>a("valueField",d.target.value))},[s("optgroup",od,[(r(!0),f(Z,null,te(n.availableFields.extracted,d=>(r(),f("option",{key:d,value:d},b(d),9,ld))),128))]),s("optgroup",id,[(r(!0),f(Z,null,te(n.availableFields.numeric,d=>(r(),f("option",{key:d,value:d},b(o(d)),9,rd))),128))])],40,nd)]),s("div",ud,[u[14]||(u[14]=s("label",{for:"pivot-aggregation"},"Aggregation:",-1)),s("select",{id:"pivot-aggregation",value:n.config.aggregation,"aria-label":"Aggregation method: "+n.config.aggregation,onChange:u[5]||(u[5]=d=>a("aggregation",d.target.value))},u[13]||(u[13]=[ts('<optgroup label="Statistical" data-v-2f1516e5><option value="mean" data-v-2f1516e5>Mean</option><option value="median" data-v-2f1516e5>Median</option><option value="variance" data-v-2f1516e5>Variance</option><option value="std_dev" data-v-2f1516e5>Std Dev</option><option value="min" data-v-2f1516e5>Min</option><option value="max" data-v-2f1516e5>Max</option><option value="sum" data-v-2f1516e5>Sum</option></optgroup><optgroup label="Frequency" data-v-2f1516e5><option value="count" data-v-2f1516e5>Count</option><option value="mode" data-v-2f1516e5>Mode</option></optgroup><optgroup label="Data Quality" data-v-2f1516e5><option value="percent_non_numeric" data-v-2f1516e5>% Non-Numeric</option></optgroup><optgroup label="Performance" data-v-2f1516e5><option value="success_rate" data-v-2f1516e5>Success Rate</option><option value="refusal_rate" data-v-2f1516e5>Refusal Rate</option><option value="avg_time" data-v-2f1516e5>Avg Time</option></optgroup>',4)]),40,dd)])])]))}}),pd=ue(cd,[["__scopeId","data-v-2f1516e5"]]),fd={class:"heatmap-controls-v3"},md={class:"control-row"},vd=["value","aria-label"],gd={class:"control-row"},hd=["value","aria-label"],yd=re({__name:"PivotHeatmapV3",props:{selectedColorScale:{},gradientMode:{}},emits:["update-color-scale","update-gradient-mode"],setup(l,{emit:e}){const t=e;function a(n){const u=n.target.value;t("update-color-scale",u)}function o(n){const u=n.target.value;t("update-gradient-mode",u)}return(n,u)=>(r(),f("div",fd,[s("div",md,[u[1]||(u[1]=s("label",{for:"heatmap-color-scale",class:"control-label"},"Color Scale:",-1)),s("select",{id:"heatmap-color-scale",class:"color-scale-select",value:n.selectedColorScale,"aria-label":"Color scale: "+n.selectedColorScale,onChange:a},u[0]||(u[0]=[ts('<option value="blue-subtle" data-v-c3794a0d>Blue (Subtle)</option><option value="green-red" data-v-c3794a0d>Green-Red (Success)</option><option value="blue-yellow" data-v-c3794a0d>Blue-Yellow (Performance)</option><option value="purple-orange" data-v-c3794a0d>Purple-Orange (General)</option><option value="viridis" data-v-c3794a0d>Viridis</option><option value="inferno" data-v-c3794a0d>Inferno</option><option value="magma" data-v-c3794a0d>Magma</option><option value="plasma" data-v-c3794a0d>Plasma</option><option value="grayscale" data-v-c3794a0d>Grayscale</option>',9)]),40,vd)]),s("div",gd,[u[3]||(u[3]=s("label",{for:"gradient-mode",class:"control-label"},"Gradient Mode:",-1)),s("select",{id:"gradient-mode",class:"gradient-mode-select",value:n.gradientMode,"aria-label":"Gradient mode: "+n.gradientMode,onChange:o},u[2]||(u[2]=[s("option",{value:"global"},"Global",-1),s("option",{value:"column"},"Per Column",-1),s("option",{value:"row"},"Per Row",-1)]),40,hd)])]))}}),bd=ue(yd,[["__scopeId","data-v-c3794a0d"]]),_d={class:"pivot-filters-v3"},Td={class:"filters-row"},Cd={key:0,class:"filter-group"},$d=["value"],wd=["value"],kd=["for"],Sd=["id","value","aria-label","onChange"],Id={value:""},Ed=["value"],Fd={key:1,class:"filter-group"},Rd=["value"],xd=["value"],Pd=re({__name:"PivotFiltersV3",props:{apiCalls:{},trial:{},activeFilters:{}},emits:["update-filters","clear-filters"],setup(l,{emit:e}){const t=l,a=e,o=q({});let n=0;const u=()=>{if(t.apiCalls.length===0){o.value={};return}const h={};t.apiCalls.forEach(C=>{if(t.trial&&C.configurationIndex<t.trial.configurations.length){const T=t.trial.configurations[C.configurationIndex],U=T.modelId||"Unknown",N=c(T.parameters),V=N?`${U} ${N}`:U;h.model||(h.model=new Set),h.model.add(V)}C.status&&(h.status||(h.status=new Set),h.status.add(C.status)),C.variables&&Object.entries(C.variables).forEach(([T,U])=>{U&&String(U).trim()&&(h[T]||(h[T]=new Set),h[T].add(String(U)))})});const k={};Object.entries(h).forEach(([C,T])=>{k[C]=Array.from(T).sort()}),o.value=k};ie(()=>t.apiCalls.length,h=>{(h===0||n===0||h-n>=5)&&(u(),n=h)},{immediate:!0});const d=M(()=>{const{model:h,status:k,...C}=o.value;return C}),p=M(()=>Object.values(t.activeFilters).some(h=>h!==""));function c(h){if(!h||Object.keys(h).length===0)return"";const k=[];return h.temperature!==void 0&&k.push(`T:${h.temperature}`),h.max_tokens!==void 0?k.push(`${h.max_tokens}t`):h.maxTokens!==void 0?k.push(`${h.maxTokens}t`):h.num_predict!==void 0&&k.push(`${h.num_predict}t`),h.top_p!==void 0&&k.push(`p:${h.top_p}`),h.top_k!==void 0&&k.push(`k:${h.top_k}`),k.length>0?`(${k.join(", ")})`:""}function g(h){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",extracted_value:"Extracted Value"}[h]||h.replace(/_/g," ").replace(/\b\w/g,C=>C.toUpperCase())}function _(h,k){const C={...t.activeFilters};k===""?delete C[h]:C[h]=k,a("update-filters",C)}return(h,k)=>(r(),f("div",_d,[s("div",Td,[o.value.model&&o.value.model.length>1?(r(),f("div",Cd,[k[4]||(k[4]=s("label",{for:"filter-model",class:"filter-label"},"Model:",-1)),s("select",{id:"filter-model",value:h.activeFilters.model||"",class:"filter-select","aria-label":"Filter by model",onChange:k[0]||(k[0]=C=>_("model",C.target.value))},[k[3]||(k[3]=s("option",{value:""},"All Models",-1)),(r(!0),f(Z,null,te(o.value.model,C=>(r(),f("option",{key:C,value:C},b(C),9,wd))),128))],40,$d)])):R("",!0),(r(!0),f(Z,null,te(d.value,(C,T)=>(r(),f("div",{key:T,class:"filter-group"},[s("label",{for:`filter-${T}`,class:"filter-label"},b(g(String(T)))+": ",9,kd),s("select",{id:`filter-${T}`,value:h.activeFilters[T]||"",class:"filter-select","aria-label":`Filter by ${g(String(T))}`,onChange:U=>_(String(T),U.target.value)},[s("option",Id,"All "+b(g(String(T))),1),(r(!0),f(Z,null,te(C,U=>(r(),f("option",{key:U,value:U},b(U),9,Ed))),128))],40,Sd)]))),128)),o.value.status&&o.value.status.length>1?(r(),f("div",Fd,[k[6]||(k[6]=s("label",{for:"filter-status",class:"filter-label"},"Status:",-1)),s("select",{id:"filter-status",value:h.activeFilters.status||"",class:"filter-select","aria-label":"Filter by status",onChange:k[1]||(k[1]=C=>_("status",C.target.value))},[k[5]||(k[5]=s("option",{value:""},"All Statuses",-1)),(r(!0),f(Z,null,te(o.value.status,C=>(r(),f("option",{key:C,value:C},b(C),9,xd))),128))],40,Rd)])):R("",!0),p.value?(r(),f("button",{key:2,type:"button",class:"clear-filters-btn",title:"Clear all filters","aria-label":"Clear all filters",onClick:k[2]||(k[2]=C=>h.$emit("clear-filters"))}," Clear Filters ")):R("",!0)])]))}}),Ad=ue(Pd,[["__scopeId","data-v-d5848163"]]),Vd={class:"options-header"},Od={class:"header-left"},Dd={class:"header-buttons"},Nd=["disabled"],Ld=["disabled"],Md={class:"header-controls"},Ud={class:"fit-toggles"},zd=["title"],Bd=["title"],Wd={class:"zoom-controls"},jd=["disabled"],Hd={class:"zoom-level"},qd=["disabled"],Gd=["title","aria-label"],Jd={class:"options-content"},Xd={class:"controls-row"},Kd={key:0,class:"performance-info"},Yd={class:"table-view"},Qd={key:0,class:"empty-state","data-testid":"empty-data-message"},Zd={key:1,class:"error-state","data-testid":"invalid-aggregation-error"},ec={key:2,class:"loading-state","data-testid":"computing-state"},tc=["onMousedown"],sc={class:"header-resize-row"},ac=["colspan"],nc={class:"row-header",role:"rowheader"},oc=["data-testid","title","aria-label","role","onClick","onKeydown"],lc={key:0,class:"cell-content"},ic=["title"],rc={class:"cell-value"},uc={class:"error-message"},dc={key:1},cc=80,qt=150,pc=32,Gt=.5,Jt=2,Xt=.1,fc=re({__name:"PivotTableV3",props:{apiCalls:{},trial:{default:null},config:{},maxTableRows:{default:1e4},showTotals:{type:Boolean,default:!0},showPerformanceInfo:{type:Boolean,default:!1}},emits:["config-change","cell-click"],setup(l,{emit:e}){const t=l,a=e,o=q(!1),n=q("blue-yellow"),u=q("global"),d=q(!1),p=q("ðŸ“‹ Copy"),c=q({rowField:t.config?.rowField||"",columnField:t.config?.columnField||"",valueField:t.config?.valueField||"",aggregation:t.config?.aggregation||"mean",rowSort:t.config?.rowSort||"original",columnSort:t.config?.columnSort||"original"}),g=q({}),_=q(null),h=q(45),k=q(null),C=q("scroll"),T=q("scroll"),U=q(1),N=M(()=>C.value!=="fit"||!i.value.columns?"auto":`${100/(i.value.columns.length+1+(c.value.columnField&&t.showTotals?1:0))}%`),V=M(()=>{if(C.value!=="fit"||!i.value.columns)return 1;const z=i.value.columns.length;return z>20?.7:z>15?.8:z>10?.9:1}),I=M(()=>`${13*V.value*U.value}px`),w=M(()=>{const K=h.value-16,ee=Math.floor(K/20);return Math.max(1,ee)});ie(()=>t.config,z=>{z&&Object.assign(c.value,z)},{deep:!0}),ie(()=>t.trial?.id,(z,J)=>{z&&z!==J&&(P.info(`PIVOT_FIX: Trial changed from ${J} to ${z}, resetting configuration`),c.value={rowField:"",columnField:"",valueField:"",aggregation:"mean",rowSort:"original",columnSort:"original"},O.value={})});const O=q({}),$=ut(),m=M(()=>$.apiCalls?$.apiCalls.value||[]:t.apiCalls||[]),L=m,F=M(()=>t.trial),{pivotData:i,availableFields:j,isComputing:Y,lastComputeTime:A}=Nu(L,c,F,O,{});ie(i,(z,J)=>{const K=performance.now(),ee=z?.rows?.length||0;z?.columns&&ft();const ce=z?.columns?.length||0;P.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData computed: ${ee}x${ce} matrix`),setTimeout(()=>{const Ce=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData render completed in ${(Ce-K).toFixed(1)}ms`)},0)}),ie(Y,z=>{z?P.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING STARTED with ${m.value.length} API calls`):P.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING FINISHED in ${A.value.toFixed(1)}ms`)}),ie(m,(z,J)=>{const K=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls changed from ${J?.length||0} to ${z.length} calls`),setTimeout(()=>{const ee=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls prop update completed in ${(ee-K).toFixed(1)}ms`)},0)});const X=M(()=>i.value.rows.slice(0,t.maxTableRows)),v=M(()=>Object.values(O.value).some(J=>J!=="")?m.value.filter(J=>{if(O.value.model&&O.value.model!==""){if(!t.trial||J.configurationIndex>=t.trial.configurations.length)return!1;const K=t.trial.configurations[J.configurationIndex],ee=K.modelId||"Unknown",ce=ne(K.parameters);if((ce?`${ee} ${ce}`:ee)!==O.value.model)return!1}if(O.value.status&&O.value.status!==""&&J.status!==O.value.status)return!1;for(const[K,ee]of Object.entries(O.value))if(ee&&ee!==""&&K!=="model"&&K!=="status"&&J.variables?.[K]!==ee)return!1;return!0}).length:m.value.length),{getCellStyle:y,getSummaryStyle:E,styleKey:H}=ba(i,n,u);function ne(z){if(!z||Object.keys(z).length===0)return"";const J=[];return z.temperature!==void 0&&J.push(`T:${z.temperature}`),z.max_tokens!==void 0?J.push(`${z.max_tokens}t`):z.maxTokens!==void 0?J.push(`${z.maxTokens}t`):z.num_predict!==void 0&&J.push(`${z.num_predict}t`),z.top_p!==void 0&&J.push(`p:${z.top_p}`),z.top_k!==void 0&&J.push(`k:${z.top_k}`),J.length>0?`(${J.join(", ")})`:""}function oe(z){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[z]||z.replace(/_/g," ").replace(/\b\w/g,K=>K.toUpperCase())}function de(z,J,K){if(!K)return`${z} Ã— ${J}: No data`;const ee=ye(K,c.value.aggregation);let ce=`${z} Ã— ${J}: ${ee} (${K.count} calls)`;if(K.excludedCounts){const Ce=[];K.excludedCounts.nonNumeric>0&&Ce.push(`${K.excludedCounts.nonNumeric} non-numeric responses excluded`),K.excludedCounts.nullUndefined>0&&Ce.push(`${K.excludedCounts.nullUndefined} null/empty responses`),Ce.length>0&&(ce+=` | ${Ce.join(", ")}`)}return K.error&&(ce+=` - ERROR: ${K.error}`),ce}function fe(z,J,K){if(!K)return`${z} by ${J}: No data`;const ee=ye(K,c.value.aggregation);return K.error?`${z} by ${J}: ${ee} with data integrity error: ${K.error}`:`${z} by ${J}: ${ee} from ${K.count} API calls`}function me(z,J){(z==="rowField"||z==="columnField"||z==="valueField"||z==="aggregation"||z==="rowSort"||z==="columnSort")&&(c.value[z]=J),a("config-change",{...c.value})}function Te(z){O.value={...z}}function Ue(){O.value={}}function Pe(z,J,K){K&&a("cell-click",{row:z,column:J,cell:K})}function pt(){d.value=!d.value}function ft(){const z={};z.corner=200,i.value.columns.forEach(J=>{g.value[J]?z[J]=g.value[J]:z[J]=qt}),c.value.columnField&&t.showTotals&&(z.total=100),g.value=z}function Je(z,J){J.preventDefault(),J.stopPropagation(),_.value={column:z,startX:J.pageX,startWidth:g.value[z]||qt},document.addEventListener("mousemove",Xe),document.addEventListener("mouseup",Ve),document.body.classList.add("resizing-column")}function Xe(z){if(!_.value)return;const J=z.pageX-_.value.startX,K=Math.max(cc,_.value.startWidth+J);g.value[_.value.column]=K}function Ve(){_.value=null,document.removeEventListener("mousemove",Xe),document.removeEventListener("mouseup",Ve),document.body.classList.remove("resizing-column")}function Ke(z){z.preventDefault(),z.stopPropagation(),k.value={startY:z.pageY,startHeight:h.value},document.addEventListener("mousemove",Ye),document.addEventListener("mouseup",B),document.body.classList.add("resizing-header")}function Ye(z){if(!k.value)return;const J=z.pageY-k.value.startY,K=Math.max(pc,k.value.startHeight+J);h.value=K}function B(){k.value=null,document.removeEventListener("mousemove",Ye),document.removeEventListener("mouseup",B),document.body.classList.remove("resizing-header")}function G(){U.value=Math.min(Jt,Math.round((U.value+Xt)*10)/10)}function ae(){U.value=Math.max(Gt,Math.round((U.value-Xt)*10)/10)}function Se(){U.value=1}function ke(){o.value=!o.value,o.value?document.body.style.overflow="hidden":document.body.style.overflow=""}async function ve(){try{const z=t.trial?.name||"pivot_table";await zu(i.value,c.value,z,{includeHeaders:!0,includeTotals:t.showTotals,addBOM:!0}),P.info("Pivot table exported successfully")}catch(z){P.error("Failed to export pivot table:",z),alert("Failed to export pivot table: "+z.message)}}async function Re(){try{await Bu(i.value,c.value,{includeHeaders:!0,includeTotals:t.showTotals}),p.value="âœ“ Copied!",P.info("Pivot table copied to clipboard"),setTimeout(()=>{p.value="ðŸ“‹ Copy"},2e3)}catch(z){P.error("Failed to copy pivot table:",z),p.value="âŒ Failed",setTimeout(()=>{p.value="ðŸ“‹ Copy"},2e3)}}return $e(()=>{const z=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 MOUNTED for trial ${t.trial?.id||"unknown"} with ${m.value.length} calls`),Oe(()=>{const J=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 DOM ready in ${(J-z).toFixed(1)}ms`)}),setTimeout(()=>{const J=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 mount completed in ${(J-z).toFixed(1)}ms`)},0)}),je(()=>{P.info(`V4_TRIAL_SWITCH: PivotTableV3 ACTIVATED (cache hit) for trial ${t.trial?.id||"unknown"} with ${m.value.length} calls`)}),He(()=>{P.info(`V4_TRIAL_SWITCH: PivotTableV3 DEACTIVATED (cached) for trial ${t.trial?.id||"unknown"}`)}),Fe(()=>{P.info(`V4_TRIAL_SWITCH: PivotTableV3 UNMOUNTED (evicted) for trial ${t.trial?.id||"unknown"}`),o.value&&(document.body.style.overflow=""),_.value&&Ve(),k.value&&B()}),ie([j,m],([z])=>{const J=!c.value.rowField&&!c.value.columnField&&!c.value.valueField;m.value.length>0&&J&&z.categorical.length>0&&(P.info("PIVOT_FIX: Auto-initializing empty config"),c.value.rowField=z.categorical.find(K=>K!=="model"&&K!=="status"&&K!=="error_type")||z.categorical[0]||"model",c.value.columnField="model",c.value.valueField="parsed_response",c.value.aggregation="mean",a("config-change",{...c.value}))},{immediate:!0}),(z,J)=>(r(),f("div",{class:se(["pivot-table-v3",{fullscreen:o.value}])},[s("div",{class:se(["pivot-options-container",{collapsed:d.value}])},[s("div",Vd,[s("div",Od,[J[6]||(J[6]=s("span",{class:"options-title"},"Pivot Table Options",-1)),s("button",{type:"button",class:"collapse-btn",onClick:pt},b(d.value?"Expand":"Collapse"),1)]),s("div",Dd,[s("button",{type:"button",class:"copy-btn",disabled:!W(i)||W(i).rows.length===0,title:"Copy table to clipboard (paste into Excel/Sheets)",onClick:Ie(Re,["stop"])},b(p.value),9,Nd),s("button",{type:"button",class:"export-btn",disabled:!W(i)||W(i).rows.length===0,title:"Export pivot table to CSV",onClick:Ie(ve,["stop"])}," â¬‡ Export CSV ",8,Ld)]),s("div",Md,[s("div",Ud,[s("button",{type:"button",class:se(["fit-toggle-btn",{active:C.value==="fit"}]),title:C.value==="fit"?"Allow horizontal scroll":"Fit to width",onClick:J[0]||(J[0]=Ie(K=>C.value=C.value==="fit"?"scroll":"fit",["stop"]))},b(C.value==="fit"?"â†” Fitted":"â†” Scroll"),11,zd),s("button",{type:"button",class:se(["fit-toggle-btn",{active:T.value==="fit"}]),title:T.value==="fit"?"Allow vertical scroll":"Fit to height",onClick:J[1]||(J[1]=Ie(K=>T.value=T.value==="fit"?"scroll":"fit",["stop"]))},b(T.value==="fit"?"â†• Fitted":"â†• Scroll"),11,Bd)]),s("div",Wd,[s("button",{type:"button",class:"zoom-btn",disabled:U.value<=Gt,title:"Zoom out",onClick:Ie(ae,["stop"])}," âˆ’ ",8,jd),s("span",Hd,b(Math.round(U.value*100))+"%",1),s("button",{type:"button",class:"zoom-btn",disabled:U.value>=Jt,title:"Zoom in",onClick:Ie(G,["stop"])}," + ",8,qd),s("button",{type:"button",class:"zoom-btn reset",title:"Reset zoom",onClick:Ie(Se,["stop"])}," â†º ")]),s("button",{type:"button",class:"fullscreen-btn",title:o.value?"Exit Fullscreen":"Enter Fullscreen","aria-label":o.value?"Exit fullscreen mode":"Enter fullscreen mode",onClick:Ie(ke,["stop"])},b(o.value?"âŠŸ Exit Fullscreen":"âŠž Fullscreen"),9,Gd)])]),Le(s("div",Jd,[As([W(j),c.value],()=>(r(),f("div",null,[S(pd,{config:c.value,"available-fields":W(j),onUpdateConfig:me},null,8,["config","available-fields"])])),J,2),s("div",Xd,[m.value.length>0?(r(),Q(Ad,{key:0,"api-calls":m.value,trial:z.trial,"active-filters":O.value,onUpdateFilters:Te,onClearFilters:Ue},null,8,["api-calls","trial","active-filters"])):R("",!0),S(bd,{"selected-color-scale":n.value,"gradient-mode":u.value,onUpdateColorScale:J[3]||(J[3]=K=>n.value=K),onUpdateGradientMode:J[4]||(J[4]=K=>u.value=K)},null,8,["selected-color-scale","gradient-mode"])])],512),[[ss,!d.value]])],2),z.showPerformanceInfo?(r(),f("div",Kd,[s("span",null,"Computing: "+b(W(Y)?"Yes":"No"),1),s("span",null,"Last Compute: "+b(W(A).toFixed(1))+"ms",1),s("span",null,"API Calls: "+b(m.value.length),1),s("span",null,"Filtered: "+b(v.value),1)])):R("",!0),s("div",Yd,[m.value.length===0?(r(),f("div",Qd,J[7]||(J[7]=[s("p",null,"No data available for pivot table analysis.",-1)]))):c.value.aggregation in W(qe)?W(Y)?(r(),f("div",ec,J[9]||(J[9]=[s("p",null,"Computing pivot table...",-1)]))):(r(),f("div",{key:3,class:se(["pivot-table-container",{"fit-horizontal":C.value==="fit","fit-vertical":T.value==="fit"}])},[s("table",{class:se(["pivot-table-grid responsive-table resizable-table",{"fit-width":C.value==="fit"}]),style:pe({fontSize:I.value}),role:"table"},[s("colgroup",null,[s("col",{style:pe(C.value==="scroll"?{width:g.value.corner+"px"}:{width:N.value})},null,4),(r(!0),f(Z,null,te(W(i).columns,K=>(r(),f("col",{key:"col-"+K,style:pe(C.value==="scroll"?{width:g.value[K]+"px"}:{width:N.value})},null,4))),128)),c.value.columnField&&z.showTotals?(r(),f("col",{key:0,style:pe(C.value==="scroll"?{width:g.value.total+"px"}:{width:N.value})},null,4)):R("",!0)]),s("thead",null,[s("tr",{role:"row",style:pe({height:h.value+"px"})},[s("th",{class:"corner-cell",role:"columnheader",style:pe({height:h.value+"px"})},[s("div",{class:"header-content",style:pe({"-webkit-line-clamp":w.value})},b(oe(c.value.rowField)||"Items")+" / "+b(oe(c.value.columnField)||"Aggregated"),5),C.value==="scroll"?(r(),f("div",{key:0,class:"resize-handle",onMousedown:J[5]||(J[5]=K=>Je("corner",K))},null,32)):R("",!0)],4),(r(!0),f(Z,null,te(W(i).columns,K=>(r(),f("th",{key:K,class:"column-header",role:"columnheader",style:pe({height:h.value+"px"})},[s("div",{class:"header-content",style:pe({"-webkit-line-clamp":w.value})},b(K),5),C.value==="scroll"?(r(),f("div",{key:0,class:"resize-handle",onMousedown:ee=>Je(K,ee)},null,40,tc)):R("",!0)],4))),128)),c.value.columnField&&z.showTotals?(r(),f("th",{key:0,class:"total-header",role:"columnheader",style:pe({height:h.value+"px"})},[s("div",{class:"header-content",style:pe({"-webkit-line-clamp":w.value})},"Total",4)],4)):R("",!0)],4),s("tr",sc,[s("td",{colspan:W(i).columns.length+1+(c.value.columnField&&z.showTotals?1:0)},[s("div",{class:"header-resize-handle",onMousedown:Ke},null,32)],8,ac)])]),s("tbody",null,[(r(!0),f(Z,null,te(X.value,K=>(r(),f("tr",{key:`${K.label}-${W(H)}`,class:"data-row",role:"row"},[s("td",nc,b(K.label),1),(r(!0),f(Z,null,te(K.cells,(ee,ce)=>(r(),f("td",{key:`${ce}-${W(H)}`,class:se(["data-cell",{"error-cell":ee?.error}]),"data-testid":ee?.error?"pivot-cell-error":"pivot-cell",style:pe(W(y)(ee,K.label,ce)),title:de(K.label,W(i).columns[ce],ee),"aria-label":fe(K.label,W(i).columns[ce],ee),role:ee?.error?"alert":"cell",tabindex:"0",onClick:Ce=>Pe(K.label,W(i).columns[ce],ee),onKeydown:[ht(Ce=>Pe(K.label,W(i).columns[ce],ee),["enter"]),ht(Ie(Ce=>Pe(K.label,W(i).columns[ce],ee),["prevent"]),["space"])]},[ee?.error?(r(),f("div",lc,[s("span",{class:"error-indicator",title:ee.error},"âš ï¸",8,ic),s("span",rc,b(ee?W(ye)(ee,c.value.aggregation):"-"),1),s("div",uc,b(ee.error),1)])):(r(),f("span",dc,b(ee?W(ye)(ee,c.value.aggregation):"-"),1))],46,oc))),128)),c.value.columnField&&z.showTotals?(r(),f("td",{key:0,class:"total-cell",style:pe(W(E)(K.total)),role:"cell"},b(W(ye)(K.total,c.value.aggregation)),5)):R("",!0)]))),128)),c.value.rowField&&z.showTotals?(r(),f("tr",{key:`totals-${W(H)}`,class:"total-row",role:"row"},[J[10]||(J[10]=s("td",{class:"row-header",role:"rowheader"},"Total",-1)),(r(!0),f(Z,null,te(W(i).totals,(K,ee)=>(r(),f("td",{key:`total-${ee}-${W(H)}`,class:"total-cell",style:pe(W(E)(K)),role:"cell"},b(W(ye)(K,c.value.aggregation)),5))),128)),c.value.columnField?(r(),f("td",{key:0,class:"grand-total-cell",style:pe(W(E)(W(i).grandTotal)),role:"cell"},b(W(ye)(W(i).grandTotal,c.value.aggregation)),5)):R("",!0)])):R("",!0)])],6)],2)):(r(),f("div",Zd,[s("p",null,"Invalid aggregation function: "+b(c.value.aggregation),1),J[8]||(J[8]=s("p",null,"Please select a valid aggregation method.",-1))]))])],2))}}),mc=ue(fc,[["__scopeId","data-v-dfebd82a"]]),vc={class:"modal-content"},gc={class:"modal-header"},hc={class:"modal-title"},yc={class:"summary-row"},bc={key:0},_c={key:0,class:"filter-row"},Tc=["onUpdate:modelValue","aria-label"],Cc={value:""},$c=["value"],wc={class:"table-container"},kc={class:"api-calls-table"},Sc=["onClick"],Ic=["title"],Ec=["title"],Fc=re({__name:"PivotCellDetailV3",props:{visible:{type:Boolean},row:{},column:{},apiCalls:{},trial:{},value:{}},emits:["close"],setup(l){const e=l,t=Vs({}),a=q(null),{formatSingleCost:o}=rt(),n=M(()=>{const m=new Set;return e.apiCalls.forEach(L=>{L.variables&&Object.keys(L.variables).forEach(F=>m.add(F)),L.attributedVariables&&Object.entries(L.attributedVariables).forEach(([F,i])=>{i&&typeof i=="object"&&Object.keys(i).forEach(j=>{m.add(`${F}.${j}`)})})}),Array.from(m).sort()}),u=M(()=>n.value.map(m=>({title:m,dataIndex:`var_${m}`,key:`var_${m}`,width:150}))),d=[{title:"Status",dataIndex:"status",key:"status",width:100},{title:"Model",dataIndex:"model",key:"model",width:150}],p=[{title:"Response",dataIndex:"response",key:"response",width:300},{title:"Parsed Content",dataIndex:"parsedContent",key:"parsedContent",width:150},{title:"Duration",dataIndex:"duration",key:"duration",width:100},{title:"Cost",dataIndex:"cost",key:"cost",width:100}],c=M(()=>[...d,...u.value,...p]),g=M(()=>`${e.row} Ã— ${e.column} - ${e.apiCalls.length} API Calls`),_=M(()=>e.apiCalls.map(m=>{const L={id:m.id,status:m.status,model:m.modelName||"-",response:m.result?.content||m.result?.error||"-",parsedContent:N(m.result?.parsedContent),duration:m.duration!==void 0?`${m.duration}ms`:"-",cost:m.cost!==void 0?m.cost:"-"};return n.value.forEach(F=>{if(F.includes(".")){const[i,j]=F.split("."),Y=m.attributedVariables?.[i]?.[j];L[`var_${F}`]=Y!==void 0?String(Y):"-"}else L[`var_${F}`]=m.variables?.[F]||"-"}),L})),h=M(()=>Object.values(t).some(m=>m!==void 0&&m!=="")),k=M(()=>h.value?_.value.filter(m=>Object.entries(t).every(([L,F])=>F?m[L]===F:!0)):_.value),C=M(()=>{const m=e.apiCalls.filter(L=>L.status==="completed").length;return Math.round(m/e.apiCalls.length*100)}),T=M(()=>{const m=e.apiCalls.filter(L=>L.duration).map(L=>L.duration);return m.length===0?0:Math.round(m.reduce((L,F)=>L+F,0)/m.length)}),U=M(()=>{const m=e.apiCalls.filter(L=>L.cost!==void 0).map(L=>L.cost);if(m.length!==0)return m.reduce((L,F)=>L+F,0)});function N(m){if(m==null)return"-";if(typeof m=="string")return m;if(typeof m=="number"||typeof m=="boolean")return String(m);if(typeof m=="object")try{return JSON.stringify(m,null,2).substring(0,100)}catch{return"[Object]"}return String(m)}function V(m){switch(m){case"completed":return"status-success";case"failed":return"status-error";case"pending":return"status-warning";case"running":return"status-processing";default:return"status-default"}}function I(m,L=200){if(!m)return"";if(m.length<=L)return m;const F=m.slice(0,100),i=m.slice(-100);return`${F} [...TRUNCATED...] ${i}`}function w(m){const L=new Set;return _.value.forEach(F=>{const i=F[m];i&&i!=="-"&&L.add(i)}),Array.from(L).sort()}function O(){Object.keys(t).forEach(m=>{delete t[m]})}function $(m){const L=e.apiCalls.find(F=>F.id===m.id);L&&(a.value=L)}return(m,L)=>(r(),f(Z,null,[s("div",{class:se(["pivot-cell-detail-modal-v3",{visible:m.visible}]),onClick:L[1]||(L[1]=Ie(F=>m.$emit("close"),["self"]))},[s("div",vc,[s("div",gc,[s("h3",hc,b(g.value),1),s("button",{type:"button",class:"close-btn","aria-label":"Close modal",onClick:L[0]||(L[0]=F=>m.$emit("close"))}," Ã— ")]),s("div",yc,[s("span",null,[L[3]||(L[3]=s("b",null,"Total:",-1)),D(" "+b(m.apiCalls.length),1)]),s("span",null,[L[4]||(L[4]=s("b",null,"Success Rate:",-1)),D(" "+b(C.value)+"%",1)]),s("span",null,[L[5]||(L[5]=s("b",null,"Avg Duration:",-1)),D(" "+b(T.value)+"ms",1)]),U.value!==void 0?(r(),f("span",bc,[L[6]||(L[6]=s("b",null,"Total Cost:",-1)),D(" "+b(W(o)(U.value)),1)])):R("",!0)]),u.value.length>0?(r(),f("div",_c,[(r(!0),f(Z,null,te(u.value,F=>(r(),f("div",{key:F.key,class:"variable-filter"},[Le(s("select",{"onUpdate:modelValue":i=>t[F.key]=i,"aria-label":`Filter ${F.title}`,class:"filter-select"},[s("option",Cc,"All "+b(F.title),1),(r(!0),f(Z,null,te(w(F.key),i=>(r(),f("option",{key:i,value:i},b(i),9,$c))),128))],8,Tc),[[Os,t[F.key]]])]))),128)),h.value?(r(),f("button",{key:0,type:"button",class:"clear-filters-btn",onClick:O}," Clear Filters ")):R("",!0)])):R("",!0),s("div",wc,[s("table",kc,[s("thead",null,[s("tr",null,[(r(!0),f(Z,null,te(c.value,F=>(r(),f("th",{key:F.key,class:"table-header",style:pe({width:F.width?`${F.width}px`:"auto"})},b(F.title),5))),128))])]),s("tbody",null,[(r(!0),f(Z,null,te(k.value,F=>(r(),f("tr",{key:F.id,class:"table-row clickable-row",onClick:i=>$(F)},[(r(!0),f(Z,null,te(c.value,i=>(r(),f("td",{key:i.key,class:se(["table-cell",{"status-cell":i.key==="status"}])},[i.key==="status"?(r(),f("span",{key:0,class:se(["status-tag",V(F.status)])},b(F.status),3)):i.key==="response"?(r(),f("span",{key:1,class:"response-cell",title:F.response},b(I(F.response)),9,Ic)):i.key==="cost"?(r(),f(Z,{key:2},[D(b(F.cost==="-"?"-":W(o)(F.cost)),1)],64)):i.key.startsWith("var_")?(r(),f("span",{key:3,class:"variable-cell",title:F[i.key]},b(F[i.key]||"-"),9,Ec)):(r(),f(Z,{key:4},[D(b(F[i.key]||"-"),1)],64))],2))),128))],8,Sc))),128))])])])])],2),a.value?(r(),Q(Ts,{key:0,visible:!!a.value,"api-call":a.value,trial:m.trial,"onUpdate:visible":L[2]||(L[2]=F=>a.value=null)},null,8,["visible","api-call","trial"])):R("",!0)],64))}}),Rc=ue(Fc,[["__scopeId","data-v-ddbda380"]]),xc={class:"trial-tab-content"},Pc={class:"tab-pane-content"},Ac={class:"tab-pane-content"},Vc={key:0,class:"no-data-message"},Oc={class:"tab-pane-content"},Kt="trial-details-active-tab",Dc=re({__name:"TrialTabContentV3",props:{trial:{},progress:{},isLeader:{type:Boolean},executionState:{}},setup(l){const e=l,t=as(),a=ot(),o=ut(),n=M(()=>o.apiCalls?.value||[]),u=M(()=>o.isStreaming?.value||!1);ie(n,(V,I)=>{const w=performance.now();P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls changed from ${I?.length||0} to ${V.length} calls`),setTimeout(()=>{const O=performance.now();P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls reactive update completed in ${(O-w).toFixed(1)}ms`)},0)});const d=M(()=>!1),c=q((()=>{const V=t.query.tab;return V==="status"?"details":V&&["details","tasks","pivot"].includes(V)?V:"tasks"})()),g=q(!1);ie(c,V=>{o.setActiveTab(V)},{immediate:!0});const _=q(!1),h=q({row:"",column:"",apiCalls:[],value:null}),k=M(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial.id),C=M(()=>e.trial.progress.completed>0);function T(){localStorage.setItem(Kt,c.value);const V={...t.query};V.tab=c.value,t.query.tab!==c.value&&(a.replace({query:V}),`${c.value}`)}function U(){const V=localStorage.getItem(Kt);V==="status"?c.value="details":V&&["details","tasks","pivot"].includes(V)&&(c.value=V)}function N(V){!V.cell||!V.cell.apiCalls.length||(h.value={row:V.row,column:V.column,apiCalls:V.cell.apiCalls,value:V.cell.value},_.value=!0)}return ie(c,()=>{T()}),ie(()=>t.query.tab,V=>{if(V&&typeof V=="string"){let I=V==="status"?"details":V;["details","tasks","pivot"].includes(I)&&c.value!==I&&(c.value=I)}}),$e(()=>{const V=performance.now();if(P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 MOUNTED for trial ${e.trial.id}`),!t.query.tab){const I={...t.query};I.tab=c.value,a.replace({query:I}),`${c.value}`}U(),setTimeout(()=>{const I=performance.now();P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 mount completed in ${(I-V).toFixed(1)}ms`)},0)}),je(()=>{P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 ACTIVATED (cache hit) for trial ${e.trial.id}`)}),He(()=>{P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 DEACTIVATED (cached) for trial ${e.trial.id}`)}),Fe(()=>{P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 UNMOUNTED (evicted) for trial ${e.trial.id}`)}),(V,I)=>{const w=ca,O=da;return r(),f("div",xc,[S(O,{activeKey:c.value,"onUpdate:activeKey":I[1]||(I[1]=$=>c.value=$),type:"card",class:"trial-tabs"},{default:x(()=>[S(w,{key:"tasks",tab:"Task View"},{default:x(()=>[s("div",Pc,[(r(),Q(yt,null,[S(Vu,{trial:V.trial,progress:V.progress,"is-executing":k.value,"api-calls":n.value,"is-streaming":u.value,"is-loading":d.value},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])],1024))])]),_:1}),S(w,{key:"pivot",tab:"Pivot Table"},{default:x(()=>[s("div",Ac,[(r(),Q(yt,null,[C.value&&n.value.length>0?(r(),Q(mc,{key:0,"api-calls":n.value,trial:V.trial,"show-performance-info":!1,onCellClick:N},null,8,["api-calls","trial"])):R("",!0)],1024)),C.value&&n.value.length>0?R("",!0):(r(),f("div",Vc,I[3]||(I[3]=[s("p",null,"No completed API calls available for pivot analysis.",-1),s("p",null,"Run the trial to see pivot table data.",-1)])))])]),_:1}),S(w,{key:"details",tab:"Details"},{default:x(()=>[s("div",Oc,[S(bl,{trial:V.trial,"is-collapsed":g.value,onToggleCollapse:I[0]||(I[0]=$=>g.value=!g.value)},null,8,["trial","is-collapsed"])])]),_:1})]),_:1},8,["activeKey"]),_.value?(r(),Q(Rc,{key:0,visible:_.value,row:h.value.row,column:h.value.column,"api-calls":h.value.apiCalls,trial:V.trial,value:h.value.value,onClose:I[2]||(I[2]=$=>_.value=!1)},null,8,["visible","row","column","api-calls","trial","value"])):R("",!0)])}}}),Nc=ue(Dc,[["__scopeId","data-v-743ec3c1"]]);class be extends Error{constructor(t,a,o){super(a);De(this,"code");De(this,"details");this.name="ExportError",this.code=t,this.details=o}}function Yt(l){return typeof TextEncoder<"u"?new TextEncoder().encode(l).length:typeof Buffer<"u"?Buffer.byteLength(l,"utf8"):unescape(encodeURIComponent(l)).length}const ge=class ge{async loadTrialForExport(e){try{const t=this.getCachedData(e);if(t)return{ok:!0,value:t};const a=await ze.trials.get(e);if(!a)return{ok:!1,error:new be("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})};const o=await ze.apiCalls.where("trialId").equals(e).toArray(),n={trial:a,apiCalls:o,fieldDefinitions:[],parameterFields:[],totalRecords:o.length};return this.setCachedData(e,n),{ok:!0,value:n}}catch(t){return{ok:!1,error:new be("GENERATION_FAILED",`Failed to load trial data: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateTrialForExport(e){try{return await ze.trials.get(e)?await ze.apiCalls.where("trialId").equals(e).count()===0?{ok:!1,error:new be("GENERATION_FAILED","Trial has no API calls to export",{trialId:e,apiCallCount:0})}:{ok:!0,value:!0}:{ok:!1,error:new be("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})}}catch(t){return{ok:!1,error:new be("GENERATION_FAILED",`Failed to validate trial: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async getApiCallCount(e){try{return await ze.apiCalls.where("trialId").equals(e).count()}catch(t){return P.warn(`Failed to get API call count for trial ${e}:`,t),0}}clearCache(e){ge.cache.delete(e),ge.cacheExpiry.delete(e)}clearAllCache(){ge.cache.clear(),ge.cacheExpiry.clear()}getCachedData(e){const t=ge.cacheExpiry.get(e);return!t||Date.now()>t?(ge.cache.delete(e),ge.cacheExpiry.delete(e),null):ge.cache.get(e)||null}setCachedData(e,t){ge.cache.set(e,t),ge.cacheExpiry.set(e,Date.now()+ge.CACHE_TTL)}};De(ge,"cache",new Map),De(ge,"cacheExpiry",new Map),De(ge,"CACHE_TTL",6e4);let St=ge;const Ze=new St;class Lc{discoverAllParameters(e){const t=new Map;return e.configurations.forEach((a,o)=>{!a.parameters||typeof a.parameters!="object"||Object.entries(a.parameters).forEach(([n,u])=>{const d=`param_${n}`;t.has(d)||t.set(d,{parameterName:n,fieldId:d,usedByConfigurations:[],dataType:this.inferDataType(u),sampleValues:[]});const p=t.get(d);p.usedByConfigurations.push(o),p.sampleValues.length<3&&!p.sampleValues.includes(u)&&p.sampleValues.push(u)})}),Array.from(t.values()).map(a=>this.createParameterFieldDefinition(a,e)).sort((a,o)=>a.id.localeCompare(o.id))}getParameterUsageStats(e){const t=this.discoverAllParameters(e),a={},o=[],n=[];e.configurations.forEach((d,p)=>{const c=d.provider;a[c]||(a[c]=[]),t.forEach(g=>{g.usedByConfigurations.includes(p)&&(a[c].includes(g.parameterName)||a[c].push(g.parameterName))})});const u=Object.keys(a);return t.forEach(d=>{u.filter(c=>a[c].includes(d.parameterName)).length>1?o.push(d.parameterName):n.push(d.parameterName)}),{totalUniqueParameters:t.length,parametersByProvider:a,sharedParameters:o.sort(),providerSpecificParameters:n.sort()}}validateParameterFields(e,t){const o=this.discoverAllParameters(e).map(p=>p.id),n=t.filter(p=>p.startsWith("param_")),u=[],d=[];return n.forEach(p=>{o.includes(p)?u.push(p):d.push(p)}),{validFields:u,invalidFields:d,availableFields:o}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}createParameterFieldDefinition(e,t){const a=e.usedByConfigurations.map(n=>t.configurations[n]?.provider||"unknown").filter((n,u,d)=>d.indexOf(n)===u).sort(),o=this.generateParameterDescription(e,a);return{id:e.fieldId,name:e.parameterName,description:o,group:"parameters",dataType:e.dataType,isRequired:!1,parameterName:e.parameterName,usedByConfigurations:e.usedByConfigurations}}generateParameterDescription(e,t){const a=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(n=>JSON.stringify(n)).join(", ")})`:"";return`${t.length===1?`Used by ${t[0]}`:`Used by ${t.join(", ")}`}${a}. Empty for configurations that don't use this parameter.`}}const nt=new Lc;class Mc{discoverAllVariables(e,t){e.id,t.length;const a=new Map,o=new Map;t.forEach(g=>{g.variables&&typeof g.variables=="object"&&Object.entries(g.variables).forEach(([_,h])=>{const k=`var_${_}`;a.has(k)||a.set(k,{variableName:_,fieldId:k,usedByCallCount:0,dataType:this.inferDataType(h),sampleValues:[]});const C=a.get(k);C.usedByCallCount++,C.sampleValues.length<3&&!C.sampleValues.includes(h)&&C.sampleValues.push(h)}),g.variableAttributes&&typeof g.variableAttributes=="object"&&Object.entries(g.variableAttributes).forEach(([_,h])=>{!h||typeof h!="object"||Object.entries(h).forEach(([k,C])=>{const T=`attr_${_}_${k}`;o.has(T)||o.set(T,{attributeName:k,fieldId:T,usedByCallCount:0,dataType:this.inferDataType(C),sampleValues:[]});const U=o.get(T);U.usedByCallCount++,U.sampleValues.length<3&&!U.sampleValues.includes(C)&&U.sampleValues.push(C)})})});const n=Array.from(a.values()).map(g=>this.createVariableFieldDefinition(g,t.length)),u=Array.from(o.values()).map(g=>this.createAttributeFieldDefinition(g,t.length)),d=[];t.some(g=>g.variableIndices&&Object.keys(g.variableIndices).length>0)&&Array.from(a.values()).forEach(g=>{const _=g.variableName;d.push({id:`source_${_}_list`,name:`${_} Source List`,description:`Name of the list that provided the value for ${_}`,group:"source",dataType:"string",isRequired:!1}),d.push({id:`source_${_}_index`,name:`${_} Source Index`,description:`Position in the list (0-based) for ${_}`,group:"source",dataType:"number",isRequired:!1})});const c=[...n,...u,...d].sort((g,_)=>g.id.localeCompare(_.id));return n.length,u.length,d.length,c.length,n.map(g=>g.id),u.map(g=>g.id),c}getVariableUsageStats(e,t){const a=this.discoverAllVariables(e,t),o={};a.forEach(d=>{const p=d.name,c=this.getVariableInfo(p,t);o[p]=c.usedByCallCount});const n=Object.entries(o).sort(([,d],[,p])=>p-d).map(([d])=>d),u=t.filter(d=>d.variables&&typeof d.variables=="object"&&Object.keys(d.variables).length>0).length;return{totalUniqueVariables:a.length,variableUsageCounts:o,mostCommonVariables:n.slice(0,10),totalCallsWithVariables:u}}validateVariableFields(e,t,a){const n=this.discoverAllVariables(e,t).map(c=>c.id),u=a.filter(c=>c.startsWith("var_")),d=[],p=[];return u.forEach(c=>{n.includes(c)?d.push(c):p.push(c)}),{validFields:d,invalidFields:p,availableFields:n}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}getVariableInfo(e,t){let a=0;const o=[];return t.forEach(n=>{if(n.variables&&n.variables[e]!==void 0){a++;const u=n.variables[e];o.length<3&&!o.includes(u)&&o.push(u)}}),{attributeName:e,fieldId:`attr_${e}`,usedByCallCount:a,dataType:o.length>0?this.inferDataType(o[0]):"string",sampleValues:o}}createVariableFieldDefinition(e,t){const a=this.generateVariableDescription(e,t);return{id:e.fieldId,name:e.variableName,description:a,group:"content",dataType:e.dataType,isRequired:!1}}createAttributeFieldDefinition(e,t){const a=this.generateAttributeDescription(e,t),o=e.fieldId.replace("attr_","").split("_"),n=o[0],u=o.slice(1).join("_"),d=`${n} attr ${u}`;return{id:e.fieldId,name:d,description:a,group:"content",dataType:e.dataType,isRequired:!1}}generateVariableDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),o=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(n=>JSON.stringify(n)).join(", ")})`:"";return`Template variable used in ${e.usedByCallCount}/${t} calls (${a}%)${o}. Empty for calls that don't use this variable.`}generateAttributeDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),o=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(n=>JSON.stringify(n)).join(", ")})`:"";return`Variable attribute used in ${e.usedByCallCount}/${t} calls (${a}%)${o}. Empty for calls that don't use this attribute.`}}const $s=new Mc;class Uc{isAuthField(e){return e==="request"}sanitizeFieldValue(e,t,a,o){return!t||t.length===0?t:(t.length,this.isAuthField(e),a.id,e==="request"?this.sanitizeRequestField(t,a,o):t)}sanitizeRequestField(e,t,a){try{const o=JSON.parse(e),n=this.getProviderIdForCall(t,a);if(!n)return t.id,this.sanitizeGenericRequest(e);t.id;const u=Ms(o,n);return JSON.stringify(u,null,2)}catch(o){return o instanceof Error?o.message:String(o),t.id,"[MALFORMED_REQUEST_JSON_REDACTED_FOR_SAFETY]"}}sanitizeGenericRequest(e){try{const t=JSON.parse(e);if(t.headers){const a={...t.headers},o=["authorization","api-key","x-api-key","bearer","x-auth-token"];for(const[n,u]of Object.entries(a)){const d=n.toLowerCase();o.some(p=>d.includes(p))&&(a[n]=`${String(u).substring(0,8)}...REDACTED`)}t.headers=a}return JSON.stringify(t,null,2)}catch(t){return t instanceof Error?t.message:String(t),"[REQUEST_JSON_PARSE_FAILED_REDACTED]"}}getProviderIdForCall(e,t){try{return t.configurations[e.configurationIndex]?.provider||null}catch(a){return a instanceof Error?a.message:String(a),e.id,null}}getFieldsRequiringSanitization(){return["request"]}createSanitizationSummary(e){const t=e.filter(a=>this.isAuthField(a));return{sanitizationEnabled:t.length>0,sanitizedFields:t}}}const Qt=new Uc;class zc{extractFieldValue(e,t,a){if(t.startsWith("param_"))return this.extractParameterValue(e,t,a);if(t.startsWith("var_"))return e.id,e.variables,this.extractVariableValue(e,t);if(t.startsWith("attr_")){e.id,e.variableAttributes;const n=this.extractAttributeValue(e,t);return e.id,n}if(t.startsWith("source_"))return this.extractSourceValue(e,t,a);const o=this.extractRawFieldValue(e,t,a);return Qt.isAuthField(t)?(e.id,Qt.sanitizeFieldValue(t,o,e,a)):o}extractRawFieldValue(e,t,a){switch(t){case"id":return e.id;case"order":return String(e.order);case"status":return e.status;case"created":return e.created.toISOString();case"completed":return e.completed?.toISOString()||"";case"configuration":return this.getConfigurationName(e,a);case"provider":return a.configurations[e.configurationIndex]?.provider||"";case"modelId":return a.configurations[e.configurationIndex]?.modelId||"";case"parameters":return this.getParametersJson(e,a);case"prompt":return e.prompt;case"variables":return JSON.stringify(e.variables||{});case"response":return e.result?.content||"";case"parsedResponse":return JSON.stringify(e.result?.parsedContent||{});case"latency":return String(e.response?.latencyMs||e.result?.latency||"");case"promptTokens":return String(e.result?.usage?.prompt_tokens||"");case"completionTokens":return String(e.result?.usage?.completion_tokens||"");case"totalTokens":return String(e.result?.usage?.total_tokens||"");case"request":return JSON.stringify(e.request||{});case"response_raw":return JSON.stringify(e.response||{});case"error":return e.result?.error||"";case"repeatIndex":return String(e.repeatIndex||"");case"cost":return e.cost!==void 0?String(e.cost):this.calculateCost(e,a);case"refused":return String(e.result?.refused||!1);default:return`UNKNOWN_FIELD: ${t}`}}extractMultipleFields(e,t,a){const o={};return t.forEach(n=>{o[n]=this.extractFieldValue(e,n,a)}),o}getFieldDefinitions(e,t){const a=this.getStandardFieldDefinitions(),o=nt.discoverAllParameters(e),n=t?$s.discoverAllVariables(e,t):[];return[...a,...o,...n]}getStandardFieldDefinitions(){return[{id:"id",name:"Call ID",description:"Unique identifier for the API call",group:"basic",dataType:"string",isRequired:!0},{id:"order",name:"Order",description:"Execution order of the API call within the trial",group:"basic",dataType:"number",isRequired:!0},{id:"status",name:"Status",description:"Current status of the API call (pending, running, completed, failed, cancelled)",group:"basic",dataType:"string",isRequired:!0},{id:"created",name:"Created Time",description:"When the API call was created (ISO timestamp)",group:"basic",dataType:"date",isRequired:!0},{id:"completed",name:"Completed Time",description:"When the API call was completed (ISO timestamp, empty if not completed)",group:"basic",dataType:"date",isRequired:!1},{id:"configuration",name:"Configuration",description:"Configuration name or model ID used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"provider",name:"Provider",description:"LLM provider used (e.g., openai-chat, anthropic, ollama)",group:"configuration",dataType:"string",isRequired:!0},{id:"modelId",name:"Model ID",description:"Specific model identifier used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"prompt",name:"Prompt",description:"The input prompt sent to the model",group:"content",dataType:"string",isRequired:!0},{id:"response",name:"Response",description:"The text response from the model",group:"content",dataType:"string",isRequired:!1},{id:"parsedResponse",name:"Parsed Response",description:"Structured/parsed response data (JSON)",group:"content",dataType:"json",isRequired:!1},{id:"latency",name:"Latency (ms)",description:"Response time in milliseconds",group:"performance",dataType:"number",isRequired:!1},{id:"promptTokens",name:"Prompt Tokens",description:"Number of tokens in the input prompt",group:"performance",dataType:"number",isRequired:!1},{id:"completionTokens",name:"Completion Tokens",description:"Number of tokens in the model response",group:"performance",dataType:"number",isRequired:!1},{id:"totalTokens",name:"Total Tokens",description:"Total tokens used (prompt + completion)",group:"performance",dataType:"number",isRequired:!1},{id:"request",name:"Full Request",description:"Complete API request sent to the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"response_raw",name:"Raw Response",description:"Full API response from the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"error",name:"Error Details",description:"Error message if the call failed",group:"technical",dataType:"string",isRequired:!1},{id:"repeatIndex",name:"Repeat Index",description:"Index for repeated calls (empty for single calls)",group:"technical",dataType:"number",isRequired:!1},{id:"cost",name:"Cost (USD)",description:"Calculated cost of the API call based on token usage",group:"performance",dataType:"number",isRequired:!1},{id:"refused",name:"Refused",description:"Whether the model refused to respond (true/false)",group:"content",dataType:"boolean",isRequired:!1}]}validateFields(e,t){const o=this.getFieldDefinitions(e).map(d=>d.id),n=[],u=[];return t.forEach(d=>{o.includes(d)?n.push(d):u.push(d)}),{validFields:n,invalidFields:u,availableFields:o}}extractParameterValue(e,t,a){const o=t.replace("param_",""),n=a.configurations[e.configurationIndex];if(!n||!n.parameters)return"";const u=n.parameters[o];return u==null?"":typeof u=="object"?JSON.stringify(u):String(u)}getConfigurationName(e,t){const a=t.configurations[e.configurationIndex];return a?a.modelId||`Config ${e.configurationIndex+1}`:`Config ${e.configurationIndex+1}`}getParametersJson(e,t){const a=t.configurations[e.configurationIndex];return!a||!a.parameters?"{}":JSON.stringify(a.parameters)}extractVariableValue(e,t){const a=t.replace("var_","");if(!e.variables||typeof e.variables!="object")return"";const o=e.variables[a];return o==null?"":typeof o=="object"?JSON.stringify(o):String(o)}extractAttributeValue(e,t){const a=t.replace("attr_","").split("_");if(a.length<2)return"";const o=a[0],n=a.slice(1).join("_");if(!e.variableAttributes||typeof e.variableAttributes!="object")return"";const u=e.variableAttributes[o];if(!u||typeof u!="object")return"";const d=u[n];return d==null?"":typeof d=="object"?JSON.stringify(d):String(d)}extractSourceValue(e,t,a){const o=t.replace("source_","").split("_");if(o.length<2)return"";const n=o[o.length-1],u=o.slice(0,-1).join("_");if(!e.variableIndices||typeof e.variableIndices!="object")return"";const d=e.variableIndices[u];if(d==null)return"";if(n==="index")return String(d);if(n==="list"){if(a.type==="template"&&a.templateConfig?.variables){const p=a.templateConfig.variables[u];if(p&&"snapshot"in p&&p.snapshot?.source?.listName)return p.snapshot.source.listName;if(p?.listId)return p.listId}return""}return""}calculateCost(e,t){if(!e.result?.usage)return"0";const a=t.configurations[e.configurationIndex];if(!a)return"0";const o=a.modelSnapshot;if(!o)return"0";const n=e.result.usage.prompt_tokens,u=e.result.usage.completion_tokens,d=Dt(n,o.capabilities?.inputCostPerToken),p=Dt(u,o.capabilities?.outputCostPerToken);if(d===null||p===null)return"N/A";const c=d+p;return Us(c).replace("$","")}}const Ee=new zc;class Bc{validateFormat(e){const t=["csv","tsv","excel","json","jsonl","python"];return t.includes(e)?{isValid:!0,errors:[],warnings:[]}:{isValid:!1,errors:[`Invalid format: ${e}. Supported formats: ${t.join(", ")}`],warnings:[]}}validateFields(e,t,a){if(!t||t.length===0)return{isValid:!1,errors:["No fields selected for export"],warnings:[],unknownFields:[],supportedFields:Ee.getFieldDefinitions(e,a).map(c=>c.id)};const o=Ee.validateFields(e,t),n=o.invalidFields.filter(c=>!c.startsWith("var_")&&!c.startsWith("attr_")),u={isValid:n.length===0,errors:[],warnings:[],unknownFields:n,supportedFields:o.availableFields};n.length>0&&u.errors.push(`Unknown fields requested: ${n.join(", ")}`),(t.includes("request")||t.includes("response_raw"))&&u.warnings.push("Technical fields (request, response_raw) contain large JSON objects and may significantly increase file size");const d=t.filter(c=>c.startsWith("param_"));d.length>10&&u.warnings.push(`Large number of parameter fields selected (${d.length}). This may result in a very wide export file with many empty cells.`);const p=t.filter(c=>c.startsWith("var_"));return p.length>10&&u.warnings.push(`Large number of variable fields selected (${p.length}). This may result in a very wide export file with many empty cells.`),u}validateExportSize(e,t,a){const o=he.estimateFileSize(e,t,a),n=o/(1024*1024),u={isValid:!0,errors:[],warnings:[]};return n>500?(u.isValid=!1,u.errors.push(`Export too large: ${he.formatFileSize(o)}. Maximum allowed: 500MB. Consider reducing the number of fields or using filters.`)):n>100&&u.warnings.push(`Large export: ${he.formatFileSize(o)}. This may take several minutes to generate and download.`),e>1e5&&u.warnings.push(`Large number of records: ${e.toLocaleString()}. Export generation may take several minutes.`),t>50&&u.warnings.push(`Large number of fields: ${t}. Resulting file will be very wide and may be difficult to work with in spreadsheet applications.`),u}validateExportOptions(e,t,a){const o=[],n=[],u=this.validateFormat(t.format);if(u.isValid||o.push(...u.errors),t.fields){const d=this.validateFields(e,t.fields,a);d.isValid||o.push(...d.errors),n.push(...d.warnings);const p=this.validateExportSize(e.progress?.total||0,t.fields.length,t.format);p.isValid||o.push(...p.errors),n.push(...p.warnings)}return t.format==="python"&&t.fields&&t.fields.length>0&&n.push("Field selection is ignored for Python exports. Python scripts include all available data."),{isValid:o.length===0,errors:o,warnings:n}}getRecommendedFields(e){const t=["order","status","configuration","prompt","response","latency"],a=Ee.getFieldDefinitions(e).filter(u=>u.group==="parameters").map(u=>u.id),o=["param_temperature","param_max_tokens","param_top_p"],n=a.filter(u=>o.includes(u));return[...t,...n]}}const gt=new Bc;class Ge{validateOptions(e){const t=[],a=[];e.fields&&e.fields.length===0&&t.push("At least one field must be selected");const o=this.getFormatInfo();return e.includeHeaders&&!o.supportsHeaders&&a.push(`${o.name} format does not support headers - ignoring includeHeaders option`),e.addBOM&&!o.supportsBOM&&a.push(`${o.name} format does not support BOM - ignoring addBOM option`),{isValid:t.length===0,errors:t,warnings:a}}prepareFieldList(e,t){if(t&&t.length>0){const d=t.filter(_=>_.startsWith("var_")),p=t.filter(_=>_.startsWith("attr_")),c=t.filter(_=>!_.startsWith("var_")&&!_.startsWith("attr_")),g=Ee.validateFields(e,c);return g.invalidFields.length>0&&P.warn("Invalid fields requested:",g.invalidFields),[...g.validFields,...d,...p]}const a=["id","order","status","configuration","provider","modelId","prompt","response","refused","latency"],o=nt.discoverAllParameters(e),n=["param_temperature","param_max_tokens","param_top_p"],u=o.filter(d=>n.includes(d.id)).map(d=>d.id);return[...a,...u]}prepareDataRows(e,t,a){return e.map(o=>t.map(n=>Ee.extractFieldValue(o,n,a)))}prepareHeaderRow(e){return e.map(t=>t.startsWith("param_")?`param_${t.replace("param_","")}`:t.replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase()).trim())}hasParameterFields(e){return e.some(t=>t.startsWith("param_"))}escapeFieldValue(e){return e==null?"":String(e)}}class Wc extends Ge{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=[];if(a.includeHeaders!==!1){const c=this.prepareHeaderRow(o).map(g=>this.escapeCSVValue(g)).join(",");n.push(c)}this.prepareDataRows(e,o,t).forEach(p=>{const c=p.map(g=>this.escapeCSVValue(g)).join(",");n.push(c)});let d=n.join(`
`);return a.addBOM&&(d="\uFEFF"+d),d}getFormatInfo(){return{name:"CSV",description:"Comma-separated values format, compatible with Excel and other spreadsheet applications",mimeType:"text/csv",extension:"csv",supportsHeaders:!0,supportsBOM:!0}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];if(e.fields&&e.fields.length>30&&a.push("Large number of columns may make the CSV difficult to work with in spreadsheet applications"),e.fields){const o=["variables","parsedResponse","request","response_raw"];e.fields.some(u=>o.includes(u))&&a.push("JSON fields (variables, parsedResponse, request, response_raw) may not display well in spreadsheet applications")}return{...t,warnings:a}}escapeCSVValue(e){if(e==null)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes(`
`)||t.includes("\r")?`"${t.replace(/"/g,'""')}"`:t}}class jc extends Ge{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=[];if(a.includeHeaders!==!1){const p=this.prepareHeaderRow(o).map(c=>this.escapeTSVValue(c)).join("	");n.push(p)}return this.prepareDataRows(e,o,t).forEach(d=>{const p=d.map(c=>this.escapeTSVValue(c)).join("	");n.push(p)}),n.join(`
`)}getFormatInfo(){return{name:"TSV",description:"Tab-separated values format, useful for data analysis tools and database imports",mimeType:"text/tab-separated-values",extension:"tsv",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return a.push("TSV format may not be directly supported by all spreadsheet applications"),{...t,warnings:a}}escapeTSVValue(e){return e==null?"":String(e).replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}}class Hc extends Ge{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=mt.book_new(),u=[];if(a.includeHeaders!==!1){const _=this.prepareHeaderRow(o);u.push(_)}const d=this.prepareDataRows(e,o,t);u.push(...d);const p=mt.aoa_to_sheet(u),c=this.calculateColumnWidths(u);return p["!cols"]=c,mt.book_append_sheet(n,p,"Export Data"),_a(n,{type:"base64",bookType:"xlsx",compression:!0})}getFormatInfo(){return{name:"Excel",description:"Microsoft Excel .xlsx format with proper formatting and auto-sized columns",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",extension:"xlsx",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.fields&&e.fields.length>16384&&a.push("Excel has a limit of 16,384 columns - some fields may not display correctly"),e.addBOM&&a.push("Excel .xlsx format is binary - ignoring addBOM option"),a.push("Excel format provides native spreadsheet functionality with auto-sized columns"),{...t,warnings:a}}calculateColumnWidths(e){if(e.length===0)return[];const t=Math.max(...e.map(o=>o.length)),a=[];for(let o=0;o<t;o++){let n=10;for(const u of e)if(u[o]!==void 0){const d=String(u[o]).length;n=Math.max(n,Math.min(d*1.2,50))}a.push({wch:n})}return a}}class qc extends Ge{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n={metadata:{trialId:t.id,trialName:t.name,trialType:t.type,exportDate:new Date().toISOString(),recordCount:e.length,fieldCount:o.length,hasParameterFields:this.hasParameterFields(o)},trial:{id:t.id,name:t.name,description:t.description,type:t.type,status:t.status,created:t.created.toISOString(),configurations:t.configurations.map((u,d)=>({index:d,provider:u.provider,modelId:u.modelId,parameters:u.parameters||{}}))},fields:o.map(u=>{const d=Ee.getFieldDefinitions(t).find(p=>p.id===u);return{id:u,name:d?.name||u,description:d?.description||"",group:d?.group||"unknown",dataType:d?.dataType||"string"}}),apiCalls:e.map(u=>{const d={};return o.forEach(p=>{const c=Ee.extractFieldValue(u,p,t);d[p]=this.parseJSONValue(c,p)}),d})};return JSON.stringify(n,null,2)}getFormatInfo(){return{name:"JSON",description:"JavaScript Object Notation format with complete trial metadata and structured data",mimeType:"application/json",extension:"json",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSON format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSON format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("Large number of fields in JSON format may result in large file sizes and memory usage"),{...t,warnings:a}}parseJSONValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const n=Number(e);return isNaN(n)?null:n}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const n=Number(e);if(!isNaN(n))return n;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return e}}class Gc extends Ge{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=[];return e.forEach(u=>{const d={};o.forEach(p=>{const c=Ee.extractFieldValue(u,p,t);d[p]=this.parseJSONLValue(c,p)}),n.push(JSON.stringify(d))}),n.join(`
`)}getFormatInfo(){return{name:"JSONL",description:"JSON Lines format with one JSON object per line, ideal for streaming and big data processing",mimeType:"application/x-jsonlines",extension:"jsonl",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSONL format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSONL format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("JSONL format handles large datasets well, but many fields may impact readability"),{...t,warnings:a}}parseJSONLValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const u=Number(e);return isNaN(u)?null:u}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const u=Number(e);if(!isNaN(u))return u;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return["created","completed"].includes(t),e}}function Jc(l){switch(l){case"csv":return new Wc;case"tsv":return new jc;case"excel":return new Hc;case"json":return new qc;case"jsonl":return new Gc;default:throw new Error(`Unsupported format: ${l}`)}}class Xc{async exportTrialData(e,t){const a=Date.now();t.format;try{const o=await Ze.loadTrialForExport(e);if(!o.ok){const C=o.error;return{ok:!1,error:new be("GENERATION_FAILED",`Failed to load trial data: ${C.message}`,{trialId:e,originalError:C})}}const{trial:n,apiCalls:u}=o.value;t.format;const d=await this.validateExportOptions(e,t,u);if(!d.ok){const C=d.error;return{ok:!1,error:new be("GENERATION_FAILED",`Validation failed: ${C.message}`,{trialId:e,options:t,originalError:C})}}if(!d.value.isValid)return{ok:!1,error:new be("INVALID_FIELDS",`Export validation failed: ${d.value.errors.join(", ")}`,{errors:d.value.errors})};t.format;const p=Jc(t.format);t.format,u.length,t.fields?.length,t.fields,t.fields?.filter(C=>C.startsWith("param_")),t.fields?.filter(C=>C.startsWith("var_")),t.fields?.filter(C=>C.startsWith("attr_"));const c=Date.now(),g=await p.generate(u,n,t);Date.now()-c,g.length,Yt(g);const _=t.fields||[],h=Date.now()-a,k={filename:he.generateFilename(n.name,t.format),mimeType:p.getFormatInfo().mimeType,data:g,metadata:{trialName:n.name,trialId:n.id,exportDate:new Date,callCount:u.length,fieldCount:_.length,format:t.format,estimatedSizeBytes:Yt(g)},format:t.format,recordCount:u.length,fieldCount:_.length,hasParameterFields:_.some(C=>C.startsWith("param_")),generationTimeMs:h};return t.format,k.filename,k.metadata.estimatedSizeBytes,k.generationTimeMs,{ok:!0,value:k}}catch(o){const n=o instanceof Error?o:new Error(String(o));return n.message,n.stack,n.name,n.constructor.name,t.format,Date.now()-a,{ok:!1,error:new be("GENERATION_FAILED",`Export generation failed: ${n.message}`,{trialId:e,options:t,originalError:o,generationTimeMs:Date.now()-a})}}}async previewExport(e,t){try{const a=await Ze.loadTrialForExport(e);if(!a.ok){const h=a.error;return{ok:!1,error:new be("GENERATION_FAILED",`Failed to load trial data: ${h.message}`,{trialId:e,originalError:h})}}const{trial:o,apiCalls:n}=a.value,u=Ee.getFieldDefinitions(o),d=nt.discoverAllParameters(o),p=t.fields||this.getDefaultFields(o),c=t.format||"csv",g=he.estimateFileSize(n.length,p.length,c);return{ok:!0,value:{fieldCount:p.length,recordCount:n.length,estimatedSizeBytes:g,availableFields:u,parameterFields:d}}}catch(a){return{ok:!1,error:new be("GENERATION_FAILED",`Preview generation failed: ${a instanceof Error?a.message:"Unknown error"}`,{trialId:e,options:t,originalError:a})}}}async getAvailableFields(e){try{const t=await Ze.loadTrialForExport(e);if(!t.ok){const c=t.error;return{ok:!1,error:new be("GENERATION_FAILED",`Failed to load trial data: ${c.message}`,{trialId:e,originalError:c})}}const{trial:a,apiCalls:o}=t.value,n=Ee.getStandardFieldDefinitions(),u=nt.discoverAllParameters(a),d=$s.discoverAllVariables(a,o),p=gt.getRecommendedFields(a);return{ok:!0,value:{standardFields:n,parameterFields:u,variableFields:d,recommendedFields:p}}}catch(t){return{ok:!1,error:new be("GENERATION_FAILED",`Field discovery failed: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateExportOptions(e,t,a){try{const o=await Ze.loadTrialForExport(e);if(!o.ok){const d=o.error;return{ok:!1,error:new be("GENERATION_FAILED",`Failed to load trial data: ${d.message}`,{trialId:e,originalError:d})}}const{trial:n}=o.value;return{ok:!0,value:gt.validateExportOptions(n,t,a)}}catch(o){return{ok:!1,error:new be("GENERATION_FAILED",`Validation failed: ${o instanceof Error?o.message:"Unknown error"}`,{trialId:e,options:t,originalError:o})}}}getDefaultFields(e){return gt.getRecommendedFields(e)}}const It=new Xc,Kc={class:"export-content"},Yc={class:"section"},Qc={key:0,class:"section"},Zc={class:"bundle-info"},ep={key:0},tp={key:1,class:"section"},sp={class:"field-actions"},ap={class:"field-groups"},np={class:"field-group"},op={class:"field-list"},lp={class:"field-group"},ip={class:"field-list"},rp={class:"field-group"},up={class:"field-list"},dp={class:"field-group"},cp={class:"field-list"},pp={class:"field-group"},fp={class:"field-list"},mp={key:0,class:"field-group"},vp={class:"field-list"},gp={key:1,class:"field-group"},hp={class:"field-list"},yp={class:"section"},bp={class:"preview-info"},_p={class:"info-item"},Tp={class:"value"},Cp={class:"info-item"},$p={class:"value"},wp={class:"info-item"},kp={class:"value"},Sp={class:"export-actions"},Ip=re({__name:"ExportDataModalV3",props:{visible:{type:Boolean},trial:{}},emits:["update:visible"],setup(l,{emit:e}){const t=l,a=e,o=q("csv"),n=q(["order","status","configuration","prompt","response","latency"]),u=q(!1),d=q("draft"),p=q({}),c=q([]),g=q([]),_=q([]),h=["order","status","configuration","prompt","response","latency"],k=q([]),C=["id","order","status","created","completed","configuration","provider","modelId","parameters","prompt","variables","response","parsedResponse","latency","promptTokens","completionTokens","totalTokens","cost","request","response_raw","error","repeatIndex"],T=M(()=>{const F=t.trial.progress?.completed||0,i=t.trial.progress?.failed||0;return F+i}),U=M(()=>{const i=n.value.length*50*T.value;return i<1024?`${i} B`:i<1024*1024?`${(i/1024).toFixed(1)} KB`:`${(i/(1024*1024)).toFixed(1)} MB`});function N(){k.value.length,k.value.forEach(j=>{p.value[j]=!1}),h.forEach(j=>{p.value[j]=!0});const F=g.value.map(j=>j.id),i=_.value.map(j=>j.id);F.forEach(j=>{p.value[j]=!0}),i.forEach(j=>{p.value[j]=!0}),h.length,F.length,i.length,h.length+F.length+i.length,V()}function V(){n.value=k.value.filter(F=>p.value[F])}function I(F,i){p.value[F]=i,V()}function w(){k.value.forEach(F=>{p.value[F]=!0}),V()}function O(){k.value.forEach(j=>{p.value[j]=!1}),h.forEach(j=>{p.value[j]=!0});const F=g.value.map(j=>j.id),i=_.value.map(j=>j.id);F.forEach(j=>{p.value[j]=!0}),i.forEach(j=>{p.value[j]=!0}),V()}function $(){k.value.forEach(F=>{p.value[F]=!1}),V()}function m(){a("update:visible",!1)}async function L(){if(o.value==="bundle"){u.value=!0;try{const{trialBundleExportService:F}=await Me(async()=>{const{trialBundleExportService:Y}=await import("./trial-bundle.service-qByMZ3OU.js");return{trialBundleExportService:Y}},__vite__mapDeps([0,1,2,3,4,5,6])),i=d.value==="completed",j=await F.exportTrialBundle(t.trial.id,{includeResults:i,includeApiCalls:i,format:"json"});j.ok?(le.success(`Trial bundle exported: ${j.value.filename}`),a("update:visible",!1)):le.error(`Bundle export failed: ${j.error.message}`)}catch(F){le.error(`Bundle export failed: ${F instanceof Error?F.message:"Unknown error"}`)}finally{u.value=!1}return}if(n.value.length===0){le.warning("Please select at least one field to export");return}u.value=!0;try{const F={format:o.value,fields:n.value,includeHeaders:!0,addBOM:o.value==="excel"||o.value==="csv"},i=await It.exportTrialData(t.trial.id,F);i.ok?(F.format==="excel"&&typeof i.value.data=="string"?await We.downloadExcelFile(i.value.data,i.value.metadata.trialName):await We.downloadFile(i.value.data,F.format,i.value.metadata.trialName,F.addBOM),le.success("Export completed successfully"),a("update:visible",!1)):le.error(`Export failed: ${i.error.message}`)}catch(F){le.error("Export failed: "+F.message)}finally{u.value=!1}}return $e(async()=>{t.trial.id;const F=await It.getAvailableFields(t.trial.id);if(F.ok){c.value=F.value.standardFields,g.value=F.value.parameterFields,_.value=(F.value.variableFields||[]).filter(A=>!A.id.startsWith("source_"));const i=F.value.standardFields.map(A=>A.id).filter(A=>A!=="parameters"&&A!=="variables"),j=F.value.parameterFields.map(A=>A.id),Y=_.value.map(A=>A.id);k.value=[...i,...j,...Y],F.value.standardFields.length,F.value.parameterFields.length,(F.value.variableFields||[]).length,k.value.length,F.value.parameterFields.map(A=>A.id),(F.value.variableFields||[]).map(A=>A.id),k.value}else F.error,k.value=[...C];N()}),(F,i)=>{const j=pa,Y=Pt,A=At,X=we,v=ps,y=Ae;return r(),Q(y,{visible:F.visible,"onUpdate:visible":i[46]||(i[46]=E=>F.$emit("update:visible",E)),title:"Export Trial Data",width:800,footer:null,"destroy-on-close":!0,class:"export-data-modal"},{default:x(()=>[s("div",Kc,[s("div",Yc,[i[53]||(i[53]=s("h4",null,"Export Format",-1)),S(Y,{value:o.value,"onUpdate:value":i[0]||(i[0]=E=>o.value=E),class:"format-options"},{default:x(()=>[S(j,{value:"csv"},{default:x(()=>i[47]||(i[47]=[D("CSV")])),_:1,__:[47]}),S(j,{value:"tsv"},{default:x(()=>i[48]||(i[48]=[D("TSV")])),_:1,__:[48]}),S(j,{value:"excel"},{default:x(()=>i[49]||(i[49]=[D("Excel")])),_:1,__:[49]}),S(j,{value:"json"},{default:x(()=>i[50]||(i[50]=[D("JSON")])),_:1,__:[50]}),S(j,{value:"jsonl"},{default:x(()=>i[51]||(i[51]=[D("JSONL")])),_:1,__:[51]}),S(j,{value:"bundle"},{default:x(()=>i[52]||(i[52]=[D("Auditomatic Trial Format")])),_:1,__:[52]})]),_:1},8,["value"])]),o.value==="bundle"?(r(),f("div",Qc,[i[64]||(i[64]=s("h4",null,"Auditomatic Trial Format",-1)),s("div",Zc,[i[61]||(i[61]=s("p",{style:{"margin-bottom":"16px",color:"var(--color-text-secondary)"}}," Export your trial in Auditomatic's native format to recreate the exact trial on another browser or computer. Perfect for sharing experiments with collaborators or backing up your work. ",-1)),S(Y,{value:d.value,"onUpdate:value":i[1]||(i[1]=E=>d.value=E),style:{"margin-bottom":"16px"}},{default:x(()=>[S(A,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:x(()=>i[54]||(i[54]=[s("strong",null,"Export as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Trial configuration only - recreate the trial setup and run a fresh experiment ",-1)])),_:1,__:[54]}),S(A,{value:"completed",style:{display:"block"}},{default:x(()=>i[55]||(i[55]=[s("strong",null,"Export with Results",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Complete trial with all execution results - review past experiments or continue where you left off ",-1)])),_:1,__:[55]})]),_:1},8,["value"]),i[62]||(i[62]=s("p",null,"The exported file contains:",-1)),s("ul",null,[i[56]||(i[56]=s("li",null,"âœ… Complete trial configuration",-1)),i[57]||(i[57]=s("li",null,"âœ… Template with metadata",-1)),i[58]||(i[58]=s("li",null,"âœ… All variable lists",-1)),i[59]||(i[59]=s("li",null,"âœ… Model configurations",-1)),d.value==="completed"?(r(),f("li",ep,"âœ… Execution results and API calls")):R("",!0),i[60]||(i[60]=s("li",null,"âœ… Variable index tracking for lineage",-1))]),i[63]||(i[63]=s("p",{style:{"margin-top":"12px"}},[s("strong",null,"To import:"),D(' Use the "Import Trial" button on the Trials page to load this file on any Auditomatic instance. ')],-1))])])):(r(),f("div",tp,[i[97]||(i[97]=s("h4",null,"Fields to Export",-1)),s("div",sp,[S(X,{size:"small",onClick:w},{default:x(()=>i[65]||(i[65]=[D("Select All")])),_:1,__:[65]}),S(X,{size:"small",onClick:O},{default:x(()=>i[66]||(i[66]=[D("Select Defaults")])),_:1,__:[66]}),S(X,{size:"small",onClick:$},{default:x(()=>i[67]||(i[67]=[D("Clear All")])),_:1,__:[67]})]),s("div",ap,[s("div",np,[i[73]||(i[73]=s("h5",null,"Basic Information",-1)),s("div",op,[S(v,{checked:p.value.id,"onUpdate:checked":i[2]||(i[2]=E=>p.value.id=E),onChange:i[3]||(i[3]=E=>I("id",E.target.checked))},{default:x(()=>i[68]||(i[68]=[D("Call ID")])),_:1,__:[68]},8,["checked"]),S(v,{checked:p.value.order,"onUpdate:checked":i[4]||(i[4]=E=>p.value.order=E),onChange:i[5]||(i[5]=E=>I("order",E.target.checked))},{default:x(()=>i[69]||(i[69]=[D("Order")])),_:1,__:[69]},8,["checked"]),S(v,{checked:p.value.status,"onUpdate:checked":i[6]||(i[6]=E=>p.value.status=E),onChange:i[7]||(i[7]=E=>I("status",E.target.checked))},{default:x(()=>i[70]||(i[70]=[D("Status")])),_:1,__:[70]},8,["checked"]),S(v,{checked:p.value.created,"onUpdate:checked":i[8]||(i[8]=E=>p.value.created=E),onChange:i[9]||(i[9]=E=>I("created",E.target.checked))},{default:x(()=>i[71]||(i[71]=[D("Created Time")])),_:1,__:[71]},8,["checked"]),S(v,{checked:p.value.completed,"onUpdate:checked":i[10]||(i[10]=E=>p.value.completed=E),onChange:i[11]||(i[11]=E=>I("completed",E.target.checked))},{default:x(()=>i[72]||(i[72]=[D("Completed Time")])),_:1,__:[72]},8,["checked"])])]),s("div",lp,[i[78]||(i[78]=s("h5",null,"Configuration",-1)),s("div",ip,[S(v,{checked:p.value.configuration,"onUpdate:checked":i[12]||(i[12]=E=>p.value.configuration=E),onChange:i[13]||(i[13]=E=>I("configuration",E.target.checked))},{default:x(()=>i[74]||(i[74]=[D("Configuration Name")])),_:1,__:[74]},8,["checked"]),S(v,{checked:p.value.provider,"onUpdate:checked":i[14]||(i[14]=E=>p.value.provider=E),onChange:i[15]||(i[15]=E=>I("provider",E.target.checked))},{default:x(()=>i[75]||(i[75]=[D("Provider")])),_:1,__:[75]},8,["checked"]),S(v,{checked:p.value.modelId,"onUpdate:checked":i[16]||(i[16]=E=>p.value.modelId=E),onChange:i[17]||(i[17]=E=>I("modelId",E.target.checked))},{default:x(()=>i[76]||(i[76]=[D("Model ID")])),_:1,__:[76]},8,["checked"]),S(v,{checked:p.value.parameters,"onUpdate:checked":i[18]||(i[18]=E=>p.value.parameters=E),onChange:i[19]||(i[19]=E=>I("parameters",E.target.checked))},{default:x(()=>i[77]||(i[77]=[D("Parameters")])),_:1,__:[77]},8,["checked"])])]),s("div",rp,[i[83]||(i[83]=s("h5",null,"Content",-1)),s("div",up,[S(v,{checked:p.value.prompt,"onUpdate:checked":i[20]||(i[20]=E=>p.value.prompt=E),onChange:i[21]||(i[21]=E=>I("prompt",E.target.checked))},{default:x(()=>i[79]||(i[79]=[D("Prompt")])),_:1,__:[79]},8,["checked"]),S(v,{checked:p.value.variables,"onUpdate:checked":i[22]||(i[22]=E=>p.value.variables=E),onChange:i[23]||(i[23]=E=>I("variables",E.target.checked))},{default:x(()=>i[80]||(i[80]=[D("Variables")])),_:1,__:[80]},8,["checked"]),S(v,{checked:p.value.response,"onUpdate:checked":i[24]||(i[24]=E=>p.value.response=E),onChange:i[25]||(i[25]=E=>I("response",E.target.checked))},{default:x(()=>i[81]||(i[81]=[D("Response")])),_:1,__:[81]},8,["checked"]),S(v,{checked:p.value.parsedResponse,"onUpdate:checked":i[26]||(i[26]=E=>p.value.parsedResponse=E),onChange:i[27]||(i[27]=E=>I("parsedResponse",E.target.checked))},{default:x(()=>i[82]||(i[82]=[D("Parsed Response")])),_:1,__:[82]},8,["checked"])])]),s("div",dp,[i[89]||(i[89]=s("h5",null,"Performance",-1)),s("div",cp,[S(v,{checked:p.value.latency,"onUpdate:checked":i[28]||(i[28]=E=>p.value.latency=E),onChange:i[29]||(i[29]=E=>I("latency",E.target.checked))},{default:x(()=>i[84]||(i[84]=[D("Latency (ms)")])),_:1,__:[84]},8,["checked"]),S(v,{checked:p.value.promptTokens,"onUpdate:checked":i[30]||(i[30]=E=>p.value.promptTokens=E),onChange:i[31]||(i[31]=E=>I("promptTokens",E.target.checked))},{default:x(()=>i[85]||(i[85]=[D("Prompt Tokens")])),_:1,__:[85]},8,["checked"]),S(v,{checked:p.value.completionTokens,"onUpdate:checked":i[32]||(i[32]=E=>p.value.completionTokens=E),onChange:i[33]||(i[33]=E=>I("completionTokens",E.target.checked))},{default:x(()=>i[86]||(i[86]=[D("Completion Tokens")])),_:1,__:[86]},8,["checked"]),S(v,{checked:p.value.totalTokens,"onUpdate:checked":i[34]||(i[34]=E=>p.value.totalTokens=E),onChange:i[35]||(i[35]=E=>I("totalTokens",E.target.checked))},{default:x(()=>i[87]||(i[87]=[D("Total Tokens")])),_:1,__:[87]},8,["checked"]),S(v,{checked:p.value.cost,"onUpdate:checked":i[36]||(i[36]=E=>p.value.cost=E),onChange:i[37]||(i[37]=E=>I("cost",E.target.checked))},{default:x(()=>i[88]||(i[88]=[D("Cost (USD)")])),_:1,__:[88]},8,["checked"])])]),s("div",pp,[i[94]||(i[94]=s("h5",null,"Technical Details",-1)),s("div",fp,[S(v,{checked:p.value.request,"onUpdate:checked":i[38]||(i[38]=E=>p.value.request=E),onChange:i[39]||(i[39]=E=>I("request",E.target.checked))},{default:x(()=>i[90]||(i[90]=[D("Full Request")])),_:1,__:[90]},8,["checked"]),S(v,{checked:p.value.response_raw,"onUpdate:checked":i[40]||(i[40]=E=>p.value.response_raw=E),onChange:i[41]||(i[41]=E=>I("response_raw",E.target.checked))},{default:x(()=>i[91]||(i[91]=[D("Raw Response")])),_:1,__:[91]},8,["checked"]),S(v,{checked:p.value.error,"onUpdate:checked":i[42]||(i[42]=E=>p.value.error=E),onChange:i[43]||(i[43]=E=>I("error",E.target.checked))},{default:x(()=>i[92]||(i[92]=[D("Error Details")])),_:1,__:[92]},8,["checked"]),S(v,{checked:p.value.repeatIndex,"onUpdate:checked":i[44]||(i[44]=E=>p.value.repeatIndex=E),onChange:i[45]||(i[45]=E=>I("repeatIndex",E.target.checked))},{default:x(()=>i[93]||(i[93]=[D("Repeat Index")])),_:1,__:[93]},8,["checked"])])]),g.value.length>0?(r(),f("div",mp,[i[95]||(i[95]=s("h5",null,"Parameters (Individual Columns)",-1)),s("div",vp,[(r(!0),f(Z,null,te(g.value,E=>(r(),Q(v,{key:E.id,checked:p.value[E.id],"onUpdate:checked":H=>p.value[E.id]=H,onChange:H=>I(E.id,H.target.checked)},{default:x(()=>[D(b(E.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):R("",!0),_.value.length>0?(r(),f("div",gp,[i[96]||(i[96]=s("h5",null,"Attributes (Individual Columns)",-1)),s("div",hp,[(r(!0),f(Z,null,te(_.value,E=>(r(),Q(v,{key:E.id,checked:p.value[E.id],"onUpdate:checked":H=>p.value[E.id]=H,onChange:H=>I(E.id,H.target.checked)},{default:x(()=>[D(b(E.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):R("",!0)])])),s("div",yp,[i[101]||(i[101]=s("h4",null,"Export Preview",-1)),s("div",bp,[s("div",_p,[i[98]||(i[98]=s("span",{class:"label"},"Records:",-1)),s("span",Tp,b(T.value),1)]),s("div",Cp,[i[99]||(i[99]=s("span",{class:"label"},"Fields:",-1)),s("span",$p,b(n.value.length),1)]),s("div",wp,[i[100]||(i[100]=s("span",{class:"label"},"Estimated Size:",-1)),s("span",kp,b(U.value),1)])])]),s("div",Sp,[S(X,{onClick:m},{default:x(()=>i[102]||(i[102]=[D("Cancel")])),_:1,__:[102]}),S(X,{type:"primary",onClick:L,loading:u.value,disabled:n.value.length===0},{default:x(()=>[S(W(ms)),i[103]||(i[103]=D(" Export "))]),_:1,__:[103]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),Ep=ue(Ip,[["__scopeId","data-v-8229d46c"]]),Fp={class:"trial-details-panel"},Rp={key:0,class:"loading-state"},xp={key:1,class:"error-state"},Pp={class:"error-actions"},Ap=re({__name:"TrialDetailsPanelV3",props:{trial:{},isLeader:{type:Boolean},executionState:{},progress:{}},emits:["start-trial","pause-trial","resume-trial","cancel-trial","duplicate-trial","edit-trial","delete-trial","export-data","export-python"],setup(l){const e=l,t=ot(),a=q(!1),o=q(null),n=q(!1),u=gs(),d=M(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial?.id);function p(){o.value=null}function c(){t.push("/trials")}function g(){n.value=!0}async function _(){if(e.trial){`${e.trial.id}`;try{u.isActive&&u.currentTrialId===e.trial.id&&u.stopStreaming(),await u.loadHistoricalData(e.trial.id),`${e.trial.id}`,(e.trial.status==="running"||e.trial.status==="paused")&&await u.startStreaming(e.trial.id)}catch(h){P.error("REFRESH: Failed to refresh trial data:",h)}}}return ie(()=>e.trial,(h,k)=>{h&&h.id!==k?.id&&(o.value=null,P.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 switching from ${k?.id} to ${h.id}`))}),$e(()=>{const h=e.trial?.id;P.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 MOUNTED for trial ${h}`)}),je(()=>{const h=e.trial?.id;P.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 ACTIVATED (cache hit) for trial ${h}`)}),He(()=>{const h=e.trial?.id;P.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 DEACTIVATED (cached) for trial ${h}`)}),Fe(()=>{const h=e.trial?.id;P.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 UNMOUNTED (evicted) for trial ${h}`)}),(h,k)=>{const C=we;return r(),f("div",Fp,[a.value?(r(),f("div",Rp,[S(W(rs),{class:"loading-spinner",spin:""}),k[9]||(k[9]=s("span",null,"Loading trial details...",-1))])):o.value?(r(),f("div",xp,[S(W(Be),{class:"error-icon"}),k[12]||(k[12]=s("h3",null,"Failed to load trial",-1)),s("p",null,b(o.value),1),s("div",Pp,[S(C,{onClick:p},{default:x(()=>k[10]||(k[10]=[D("Retry")])),_:1,__:[10]}),S(C,{type:"link",onClick:c},{default:x(()=>k[11]||(k[11]=[D("Go Back")])),_:1,__:[11]})])])):h.trial?(r(),f(Z,{key:2},[S(Zn,{trial:h.trial,progress:h.progress,"is-executing":d.value},null,8,["trial","progress","is-executing"]),S(oo,{trial:h.trial,"is-leader":h.isLeader,"execution-state":h.executionState,onStart:k[0]||(k[0]=T=>h.$emit("start-trial")),onPause:k[1]||(k[1]=T=>h.$emit("pause-trial")),onResume:k[2]||(k[2]=T=>h.$emit("resume-trial")),onCancel:k[3]||(k[3]=T=>h.$emit("cancel-trial")),onDuplicate:k[4]||(k[4]=T=>h.$emit("duplicate-trial",h.trial.id)),onEdit:k[5]||(k[5]=T=>h.$emit("edit-trial",h.trial.id)),onDelete:k[6]||(k[6]=T=>h.$emit("delete-trial",h.trial.id)),onExportData:g,onExportPython:k[7]||(k[7]=T=>h.$emit("export-python",h.trial.id)),onRefresh:_},null,8,["trial","is-leader","execution-state"]),h.trial&&n.value?(r(),Q(Ep,{key:0,visible:n.value,trial:h.trial,"onUpdate:visible":k[8]||(k[8]=T=>n.value=!1)},null,8,["visible","trial"])):R("",!0),S(Nc,{trial:h.trial,progress:h.progress,"is-leader":h.isLeader,"execution-state":h.executionState},null,8,["trial","progress","is-leader","execution-state"])],64)):R("",!0)])}}}),Vp=ue(Ap,[["__scopeId","data-v-081db72e"]]),Op={class:"import-content"},Dp={class:"upload-section"},Np={class:"ant-upload-drag-icon"},Lp={key:0,class:"preview-section"},Mp={class:"bundle-details"},Up={class:"detail-row"},zp={class:"value"},Bp={class:"detail-row"},Wp={class:"value"},jp={class:"detail-row"},Hp={class:"value"},qp={class:"detail-row"},Gp={class:"value"},Jp={key:0,style:{color:"green","margin-left":"8px"}},Xp={key:1,style:{color:"orange","margin-left":"8px"}},Kp={key:0,class:"detail-row"},Yp={class:"value"},Qp={class:"detail-row"},Zp={class:"value"},ef={class:"import-options"},tf={key:0,style:{"margin-bottom":"12px"}},sf={key:1,style:{"margin-bottom":"12px",padding:"8px",background:"#f0f0f0","border-radius":"4px"}},af={key:0,class:"warnings"},nf={class:"modal-actions"},of=re({__name:"ImportTrialDialog",props:{visible:{type:Boolean}},emits:["update:visible","trial-imported"],setup(l,{emit:e}){const t=l,a=e,o=ot(),n=q([]),u=q(null),d=q(!1),p=q([]),c=q({mode:"draft",namePrefix:"Imported: "}),g=M({get:()=>t.visible,set:I=>a("update:visible",I)}),_=M(()=>u.value?.execution?.apiCalls&&u.value.execution.apiCalls.length>0);function h(I){return!1}async function k(I){const w=I.file.originFileObj||I.file;if(w)try{const O=await C(w),$=JSON.parse(O);p.value=T($),u.value=$,$.execution?.apiCalls&&$.execution.apiCalls.length>0,c.value.mode="draft"}catch{le.error("Failed to read bundle file: Invalid JSON format"),u.value=null}}function C(I){return new Promise((w,O)=>{const $=new FileReader;$.onload=m=>w(m.target?.result),$.onerror=O,$.readAsText(I)})}function T(I){const w=[];return I.version||w.push("Bundle version is missing"),I.configuration?.trial||w.push("Trial configuration is missing"),(!I.configuration?.variableLists||I.configuration.variableLists.length===0)&&w.push("No variable lists found in bundle"),I.version!=="1.0"&&w.push(`Bundle version ${I.version} may not be fully compatible`),w}function U(I){return new Date(I).toLocaleString()}function N(){n.value=[],u.value=null,p.value=[],g.value=!1}async function V(){if(!u.value){le.error("No bundle to import");return}d.value=!0;try{const{trialBundleImportService:I}=await Me(async()=>{const{trialBundleImportService:$}=await import("./trial-bundle.service-qByMZ3OU.js");return{trialBundleImportService:$}},__vite__mapDeps([0,1,2,3,4,5,6])),w=_.value&&c.value.mode==="completed",O=await I.importTrialBundle(JSON.stringify(u.value),{importResults:w,importAsCompleted:w,namePrefix:c.value.namePrefix||void 0});O.ok?(le.success("Trial imported successfully!"),o.push(`/trials?trialId=${O.value.trialId}`),a("trial-imported",O.value.trialId),N()):le.error(`Import failed: ${O.error.message}`)}catch(I){le.error(`Import failed: ${I instanceof Error?I.message:"Unknown error"}`)}finally{d.value=!1}}return(I,w)=>{const O=fa,$=At,m=Pt,L=cs,F=it,i=we,j=Ae;return r(),Q(j,{visible:g.value,"onUpdate:visible":w[3]||(w[3]=Y=>g.value=Y),title:"Import Trial Bundle",width:600,footer:null,"destroy-on-close":!0,class:"import-trial-modal"},{default:x(()=>[s("div",Op,[s("div",Dp,[S(O,{fileList:n.value,"onUpdate:fileList":w[0]||(w[0]=Y=>n.value=Y),"before-upload":h,"max-count":1,accept:".json",onChange:k},{default:x(()=>[s("p",Np,[S(W(is))]),w[4]||(w[4]=s("p",{class:"ant-upload-text"},"Click or drag trial bundle file here",-1)),w[5]||(w[5]=s("p",{class:"ant-upload-hint"}," Supports .json files exported from trials ",-1))]),_:1,__:[4,5]},8,["fileList"])]),u.value?(r(),f("div",Lp,[w[17]||(w[17]=s("h3",null,"Bundle Contents",-1)),s("div",Mp,[s("div",Up,[w[6]||(w[6]=s("span",{class:"label"},"Trial Name:",-1)),s("span",zp,b(u.value.metadata.trialName),1)]),s("div",Bp,[w[7]||(w[7]=s("span",{class:"label"},"Export Date:",-1)),s("span",Wp,b(U(u.value.metadata.exportDate)),1)]),s("div",jp,[w[8]||(w[8]=s("span",{class:"label"},"Status:",-1)),s("span",Hp,b(u.value.metadata.trialStatus),1)]),s("div",qp,[w[9]||(w[9]=s("span",{class:"label"},"API Calls:",-1)),s("span",Gp,[D(b(u.value.metadata.apiCallCount)+" ",1),_.value?(r(),f("span",Jp," (with results) ")):(r(),f("span",Xp," (configuration only) "))])]),u.value.configuration.template?(r(),f("div",Kp,[w[10]||(w[10]=s("span",{class:"label"},"Template:",-1)),s("span",Yp,b(u.value.configuration.template.name),1)])):R("",!0),s("div",Qp,[w[11]||(w[11]=s("span",{class:"label"},"Variable Lists:",-1)),s("span",Zp,b(u.value.configuration.variableLists?.length||0),1)])]),s("div",ef,[w[16]||(w[16]=s("h4",null,"Import Options",-1)),_.value?(r(),f("div",tf,[S(m,{value:c.value.mode,"onUpdate:value":w[1]||(w[1]=Y=>c.value.mode=Y),style:{display:"block"}},{default:x(()=>[S($,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:x(()=>w[12]||(w[12]=[s("strong",null,"Import as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Create fresh trial ready to run new experiment ",-1)])),_:1,__:[12]}),S($,{value:"completed",style:{display:"block"}},{default:x(()=>w[13]||(w[13]=[s("strong",null,"Import as Completed",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Preserve historical results for review/analysis ",-1)])),_:1,__:[13]})]),_:1},8,["value"])])):(r(),f("div",sf,w[14]||(w[14]=[s("strong",null,"Draft Trial",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px"}}," This bundle contains configuration only - will import as draft ready to run ",-1)]))),S(L,{value:c.value.namePrefix,"onUpdate:value":w[2]||(w[2]=Y=>c.value.namePrefix=Y),placeholder:"Name prefix (optional)",style:{"margin-top":"8px"}},{prefix:x(()=>w[15]||(w[15]=[D("Name:")])),_:1},8,["value"])]),p.value.length>0?(r(),f("div",af,[S(F,{message:"Import Warnings",type:"warning","show-icon":""},{description:x(()=>[s("ul",null,[(r(!0),f(Z,null,te(p.value,Y=>(r(),f("li",{key:Y},b(Y),1))),128))])]),_:1})])):R("",!0)])):R("",!0),s("div",nf,[S(i,{onClick:N},{default:x(()=>w[18]||(w[18]=[D("Cancel")])),_:1,__:[18]}),S(i,{type:"primary",onClick:V,loading:d.value,disabled:!u.value},{default:x(()=>[S(W(ls)),w[19]||(w[19]=D(" Import Trial "))]),_:1,__:[19]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),lf=ue(of,[["__scopeId","data-v-1d9366d6"]]),rf={class:"option-content"},uf={class:"option-header"},df={class:"modal-footer"},cf=re({__name:"PythonExportModal",props:{visible:{type:Boolean},trialId:{}},emits:["update:visible"],setup(l,{emit:e}){const t=l,a=e,o=M({get:()=>t.visible,set:p=>a("update:visible",p)}),n=q("script-config-data"),u=q(!1);ie(o,p=>{p&&(n.value="script-config-data",u.value=!1)});async function d(){if(n.value){u.value=!0;try{const{reproducibilityBundleService:p}=await Me(async()=>{const{reproducibilityBundleService:g}=await import("./index-BPEpZwZF.js");return{reproducibilityBundleService:g}},__vite__mapDeps([7,1,2,3,4,5,0,6,8,9,10,11,12,13,14,15,16,17,18])),c=await p.exportBundle(t.trialId,{bundleType:n.value,includeComments:!0});if(c.ok){const{tauriDownloadUtilities:g}=await Me(async()=>{const{tauriDownloadUtilities:_}=await Promise.resolve().then(()=>Uu);return{tauriDownloadUtilities:_}},void 0);if(n.value==="script-only"){const _=await c.value.zipBlob.text();await g.downloadFile(_,"python",c.value.filename.replace(".zip",""),!1),le.success("Python script downloaded successfully")}else{const _=await c.value.zipBlob.arrayBuffer(),h=new Uint8Array(_);await g.downloadFile(h,"zip",c.value.filename.replace(".zip",""),!1);const k=n.value==="script-config-data"?"Complete archive bundle":"Reproducibility bundle";le.success(`${k} downloaded successfully`)}o.value=!1}else throw new Error(c.error?.message||"Export failed")}catch(p){P.error("Export failed:",p),le.error(`Failed to export: ${p instanceof Error?p.message:"Unknown error"}`)}finally{u.value=!1}}}return(p,c)=>{const g=At,_=lt,h=Pt,k=we,C=Ae;return r(),Q(C,{visible:o.value,"onUpdate:visible":c[1]||(c[1]=T=>o.value=T),title:"Export for Reproducibility",width:600,footer:null,"destroy-on-close":!0},{default:x(()=>[c[10]||(c[10]=s("p",{class:"export-description"}," Choose your export format: ",-1)),S(h,{value:n.value,"onUpdate:value":c[0]||(c[0]=T=>n.value=T),class:"export-options"},{default:x(()=>[S(g,{value:"script-only",class:"export-option"},{default:x(()=>c[2]||(c[2]=[s("div",{class:"option-content"},[s("div",{class:"option-header"},[s("span",{class:"option-icon"},"ðŸ“„"),s("strong",{class:"option-title"},"Python Script Only")]),s("div",{class:"option-description"}," Minimal Python script (~200-400 lines) with clear experimental design. "),s("div",{class:"option-files"},"â€¢ experiment.py")],-1)])),_:1,__:[2]}),S(g,{value:"script-config",class:"export-option"},{default:x(()=>c[3]||(c[3]=[s("div",{class:"option-content"},[s("div",{class:"option-header"},[s("span",{class:"option-icon"},"ðŸ“¦"),s("strong",{class:"option-title"},"Reproducibility Bundle")]),s("div",{class:"option-description"}," Python script + complete trial configuration. "),s("div",{class:"option-files"}," â€¢ experiment.py â€¢ trial_config.json â€¢ README.md ")],-1)])),_:1,__:[3]}),S(g,{value:"script-config-data",class:"export-option recommended"},{default:x(()=>[s("div",rf,[s("div",uf,[c[5]||(c[5]=s("span",{class:"option-icon"},"ðŸ—‚ï¸",-1)),c[6]||(c[6]=s("strong",{class:"option-title"},"Complete Archive Bundle",-1)),S(_,{color:"green",style:{"margin-left":"8px"}},{default:x(()=>c[4]||(c[4]=[D("Recommended")])),_:1,__:[4]})]),c[7]||(c[7]=s("div",{class:"option-description"}," Everything: Python script + configuration + all experimental results. ",-1)),c[8]||(c[8]=s("div",{class:"option-files"}," â€¢ experiment.py â€¢ trial_config.json â€¢ data/results.{csv,xlsx,jsonl} â€¢ README.md ",-1))])]),_:1})]),_:1},8,["value"]),s("div",df,[S(k,{type:"primary",size:"large",disabled:!n.value,loading:u.value,onClick:d},{default:x(()=>[S(W(ms)),c[9]||(c[9]=D(" Download "))]),_:1,__:[9]},8,["disabled","loading"])])]),_:1,__:[10]},8,["visible"])}}}),pf=ue(cf,[["__scopeId","data-v-6cec199d"]]),ff={class:"trials-view-v3"},mf={key:0,class:"provider-warning-banner"},vf={class:"banner-content"},gf={key:1,class:"observer-mode-banner"},hf={class:"banner-content"},yf={key:1,class:"loading-left-pane"},bf={key:0,class:"no-selection"},_f={key:0,class:"observer-note"},Tf=re({__name:"TrialsViewV3",setup(l){const e=Ta(),{trials:t}=ga(),{enabledModels:a}=Ca(),{duplicateTrial:o,deleteTrial:n}=ha(),u=gs(),d=as(),p=ot(),c=q(),g=q(!0),_=q(null),h=q(""),k=q("all"),C=q(-1),T=q(!1),U=q(!1),N=q(!1),V=M(()=>a.value.length>0),I=M(()=>!V.value&&!N.value),w=e.isLeader,O=e.execution,{trial:$}=ya(_),m=M(()=>{const B=$.value?.progress;return B?{trialId:_.value||"",...B,lastUpdated:new Date}:null}),L=M(()=>{let B=t.value;if(h.value){const G=h.value.toLowerCase();B=B.filter(ae=>{const Se=ae.name.toLowerCase().includes(G),ke=ae.templateConfig?.template?.toLowerCase().includes(G),ve=ae.configurations.some(Re=>Re.modelId.toLowerCase().includes(G)||Re.provider.toLowerCase().includes(G));return Se||ke||ve})}return k.value!=="all"&&(B=B.filter(G=>G.status===k.value)),B});async function F(){const B=d.query;if(B.duplicate){const G=B.duplicate,ae=await o(G);ae.ok?await p.push({path:"/trials/create",query:{duplicate:ae.value,edit:B.edit==="true"?"true":void 0}}):_e.error(`Failed to duplicate trial: ${ae.error?.message||"Unknown error"}`),await p.replace({query:{}});return}if(B.designId||B.promptSource){await p.push({path:"/trials/create",query:B});return}if(d.query.trialId){const G=d.query.trialId;j(G)}}function i(){if(_.value||t.value.length===0)return;const B=t.value.find(G=>G.status==="running");if(B){j(B.id);return}j(t.value[0].id)}async function j(B){const G=performance.now();P.info(`V4_TRIAL_SWITCH: Starting trial selection: ${B}`),_.value=B;const ae=performance.now();if(P.info(`V4_TRIAL_SWITCH: UI updated in ${(ae-G).toFixed(1)}ms`),t.value.length>0){const ve=L.value.findIndex(Re=>Re.id===B);ve>=0&&(C.value=ve)}const Se=performance.now();if(P.info(`V4_TRIAL_SWITCH: Starting stream manager for trial ${B} at ${(Se-G).toFixed(1)}ms`),u.startStreaming(B).catch(ve=>{P.error(`V4_TRIAL_SWITCH: Failed to start streaming for trial ${B}`,ve)}),d.query.trialId!==B){const ve={...d.query};ve.trialId=B,ve.tab||(ve.tab="status"),p.push({path:"/trials",query:ve}),P.info(`V4_TRIAL_SWITCH: URL updated to preserve tab '${ve.tab}' at ${(performance.now()-G).toFixed(1)}ms`)}c.value&&c.value.closeMobileOverlay();const ke=performance.now();P.info(`V4_TRIAL_SWITCH: selectTrial() completed in ${(ke-G).toFixed(1)}ms`)}function Y(B){h.value=B,C.value=-1}function A(B){k.value=B,C.value=-1}async function X(){_e.info("Refreshing trial list...")}function v(B){const G=L.value;if(G.length!==0){if((B.metaKey||B.ctrlKey)&&B.key==="k"){B.preventDefault(),window.dispatchEvent(new CustomEvent("focus-trial-search"));return}(B.key==="j"||B.key==="ArrowDown")&&(B.preventDefault(),C.value=Math.min(C.value+1,G.length-1),C.value>=0&&(j(G[C.value].id),y(G[C.value].id))),(B.key==="k"||B.key==="ArrowUp")&&(B.preventDefault(),C.value=Math.max(C.value-1,0),j(G[C.value].id),y(G[C.value].id)),B.key==="Enter"&&_.value,B.key==="Escape"&&(h.value="",_.value=null,C.value=-1)}}function y(B){Oe(()=>{const G=document.querySelector(`[data-trial-id="${B}"]`);G&&G.scrollIntoView({behavior:"smooth",block:"nearest"})})}function E(B){P.debug("Trial list panel resized",{width:B})}function H(B){P.debug("Mobile overlay changed",{visible:B})}function ne(){N.value=!0}async function oe(){await p.push("/trials/create")}function de(){U.value=!0}function fe(B){X(),j(B)}async function me(){if(_.value&&!T.value){T.value=!0,e.execution?.value,e.execution?.value?.status;try{_.value;const B=await e.startTrialWithStreaming(_.value);if(!B.ok){_e.error(B.error?.message||"Unknown error");return}await u.startStreaming(_.value);const G={...d.query};G.tab="tasks",p.replace({query:G})}finally{T.value=!1}}}async function Te(){`${_.value}`,`${_.value}`,`${e.execution.value.status}`,`${e.isLeader.value}`;const B=await e.pauseExecution();B?.ok,B.ok?`${e.execution.value.status}`:(B.error.message,_e.error(B.error?.message||"Unknown error"))}async function Ue(){if(!_.value)return;`${_.value}`,`${_.value}`,`${e.execution.value.status}`,`${e.isLeader.value}`;const B=e.execution.value?.status||"idle",G=e.execution.value?.currentTrialId;if(B==="paused"&&G===_.value){`${_.value}`;const ae=await e.resumeExecution(_.value);ae.ok||(ae.error.message,_e.error(ae.error.message))}else{const ae=await e.startTrialWithStreaming(_.value);ae.ok?await u.startStreaming(_.value):(ae.error.message,_e.error(ae.error?.message||"Unknown error"))}}async function Pe(){const B=await e.cancelExecution();B.ok||_e.error(B.error?.message||"Unknown error")}async function pt(B){const G=await o(B);G.ok?(_e.success("Trial duplicated"),G.value&&j(G.value)):_e.error(G.error?.message||"Unknown error")}async function ft(B){await p.push({path:"/trials/create",query:{duplicate:B,edit:"true"}})}async function Je(B){const G=await n(B);G.ok?(_e.success("Trial deleted"),_.value===B&&(_.value=null)):_e.error(G.error?.message||"Unknown error")}async function Xe(B,G){const ae=await It.exportTrialData(B,{format:G,fields:void 0,includeHeaders:!0,addBOM:G==="excel"||G==="csv"});ae.ok?(await We.downloadFile(ae.value.data,G,ae.value.metadata.trialName,G==="excel"||G==="csv"),_e.success(`Exported ${ae.value.recordCount} API calls to ${ae.value.filename}`)):_e.error(ae.error?.message||"Unknown error")}const Ve=q(!1),Ke=q("");function Ye(B){Ke.value=B,Ve.value=!0}return ie(()=>d.query.trialId,B=>{B&&B!==_.value&&j(B)}),ie(g,(B,G)=>{const ae=performance.now();P.info(`V4_TRIAL_SWITCH: isLoadingInitial changed from ${G} to ${B} at ${ae}`),B||P.info("V4_TRIAL_SWITCH: Both panes should now be VISIBLE (no longer loading initial)")},{immediate:!0}),ie(t,(B,G)=>{const ae=performance.now();P.info(`V4_TRIAL_SWITCH: trials array changed from ${G?.length||0} to ${B.length} trials at ${ae}`)},{immediate:!0}),$e(async()=>{const B=performance.now();P.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() ENTRY at ${B}`);const G=performance.now();P.info(`V4_TRIAL_SWITCH: Starting V4 execution system initialization at ${(G-B).toFixed(1)}ms`);try{await e.initialize();const ce=performance.now();P.info(`V4_TRIAL_SWITCH: V4 execution system initialized in ${(ce-G).toFixed(1)}ms`)}catch(ce){const Ce=performance.now();P.error(`V4_TRIAL_SWITCH: V4 initialization failed in ${(Ce-G).toFixed(1)}ms:`,ce)}const ae=performance.now();window.addEventListener("keydown",v),P.info(`V4_TRIAL_SWITCH: Keyboard listener added in ${(ae-B).toFixed(1)}ms`);const Se=performance.now();P.info(`V4_TRIAL_SWITCH: Starting nextTick wait at ${(Se-B).toFixed(1)}ms`),await Oe();const ke=performance.now();P.info(`V4_TRIAL_SWITCH: nextTick completed in ${(ke-Se).toFixed(1)}ms`);const ve=performance.now();g.value=!1,P.info(`V4_TRIAL_SWITCH: isLoadingInitial set to false at ${(ve-B).toFixed(1)}ms`);const Re=performance.now();P.info(`V4_TRIAL_SWITCH: Starting URL parameter processing at ${(Re-B).toFixed(1)}ms`),await F();const z=performance.now();P.info(`V4_TRIAL_SWITCH: URL parameter processing completed in ${(z-Re).toFixed(1)}ms`);const J=performance.now();P.info(`V4_TRIAL_SWITCH: Starting auto-selection at ${(J-B).toFixed(1)}ms`),i();const K=performance.now();P.info(`V4_TRIAL_SWITCH: Auto-selection completed in ${(K-J).toFixed(1)}ms`);const ee=performance.now();P.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() TOTAL: ${(ee-B).toFixed(1)}ms`)}),Fe(()=>{window.removeEventListener("keydown",v),u.destroy()}),(B,G)=>{const ae=Zt("router-link"),Se=we;return r(),f("div",ff,[I.value?(r(),f("div",mf,[s("div",vf,[S(W(Be),{class:"warning-icon"}),G[3]||(G[3]=s("span",null,"No LLM providers configured. Please add API keys in Settings to run trials.",-1)),S(ae,{to:"/settings",class:"settings-link"},{default:x(()=>G[2]||(G[2]=[D("Go to Settings")])),_:1,__:[2]}),S(W(os),{class:"close-icon",onClick:ne})]),G[4]||(G[4]=s("div",{class:"banner-note"},"Note: Ollama doesn't require API keys",-1))])):R("",!0),W(w)?R("",!0):(r(),f("div",gf,[s("div",hf,[S(W(ds),{class:"observer-icon"}),G[5]||(G[5]=s("span",null,[s("strong",null,"Observer Mode: Multiple Tabs Detected")],-1)),G[6]||(G[6]=s("div",{class:"leader-hint"}," You can only open one Auditomatic tab at a time. Close other tabs, or refresh if this is your only tab. Your templates and trials are safely saved. ",-1))])])),S(ka,{ref_key:"splitPanel",ref:c,"storage-key":"trial-list-width","default-width":250,"min-width":200,"max-width":600,onResize:E,onMobileOverlayChange:H},{left:x(()=>[g.value?(r(),f("div",yf," Loading trials... ")):(r(),Q(Nn,{key:0,trials:W(t),"selected-trial-id":_.value,"search-query":h.value,"filter-status":k.value,onSelectTrial:j,onCreateTrial:oe,onImportTrial:de,onUpdateSearch:Y,onUpdateFilter:A,onRefresh:X},null,8,["trials","selected-trial-id","search-query","filter-status"]))]),right:x(()=>[(r(),Q(yt,{max:5},[_.value?(r(),Q(Vp,{key:_.value,trial:W($),"is-leader":W(w),"execution-state":W(O),progress:m.value,onStartTrial:me,onPauseTrial:Te,onResumeTrial:Ue,onCancelTrial:Pe,onDuplicateTrial:pt,onEditTrial:ft,onDeleteTrial:Je,onExportData:Xe,onExportPython:Ye},null,8,["trial","is-leader","execution-state","progress"])):R("",!0)],1024)),!_.value||!W($)?Le((r(),f("div",bf,[S(W(fs),{class:"empty-icon"}),G[8]||(G[8]=s("h3",null,"Select a trial to view details",-1)),G[9]||(G[9]=s("p",null,"Choose from the list or create a new one",-1)),S(Se,{type:"primary",size:"large",disabled:!W(w),onClick:oe},{default:x(()=>G[7]||(G[7]=[D(" Create New Trial ")])),_:1,__:[7]},8,["disabled"]),W(w)?R("",!0):(r(),f("div",_f," Close other tabs to enable trial creation "))],512)),[[ss,!g.value]]):R("",!0)]),_:1},512),S(lf,{visible:U.value,"onUpdate:visible":G[0]||(G[0]=ke=>U.value=ke),onTrialImported:fe},null,8,["visible"]),S(pf,{visible:Ve.value,"onUpdate:visible":G[1]||(G[1]=ke=>Ve.value=ke),"trial-id":Ke.value},null,8,["visible","trial-id"])])}}}),Cf=ue(Tf,[["__scopeId","data-v-84d2df98"]]),Lf=Object.freeze(Object.defineProperty({__proto__:null,default:Cf},Symbol.toStringTag,{value:"Module"}));export{be as E,Lf as T,It as d,Yt as g,Ze as t};
