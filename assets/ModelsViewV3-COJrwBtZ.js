const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cm3YP0q9.js","assets/vue-vendor-DPw1dQYc.js","assets/ui-vendor-IRGmExUJ.js","assets/utils-vendor-B76-F3_P.js","assets/tauri-vendor-1uBLmS9u.js","assets/index-gxIXtJdR.css"])))=>i.map(i=>d[i]);
import{d as $,r as Le,c as wt,u as Re,a as O,j as re,_ as Fe,s as Ct}from"./index-Cm3YP0q9.js";import{f as y,c as K,d as ie,R as b,Y as u,S as t,_ as T,a0 as ee,V as f,u as g,F as H,W as se,B as oe,k as r,$ as N,Z as l,G as M,o as Ve,s as Se,h as Mt,b as $t,a5 as Ot,a6 as Pt,X as Dt}from"./vue-vendor-DPw1dQYc.js";import{u as Ue}from"./useV4Models-CiDNoJvg.js";import{u as ze}from"./useV4ProviderParameters-BNDIMMd1.js";import{O as At}from"./OllamaModelManagerV3-DszExrIG.js";import{ap as St,T as ge,ak as Be,al as Te,L as Ne,n as _e,m as Et,aq as xt,U as Lt,ar as Ge,J as je,O as Rt,t as Ke,v as Ft,ag as Vt,S as Ie,M as We,as as Ut,at as zt,_ as Bt,au as Tt,s as Nt,y as Gt,av as jt,w as Kt,aw as It,ax as Ee,ay as xe,V as Wt,a8 as qt,ai as Jt,q as Ht,ao as Qt}from"./ui-vendor-IRGmExUJ.js";import{detectOllamaIssue as Xt}from"./ollama-fetch-CnP6vUgG.js";import"./utils-vendor-B76-F3_P.js";import"./tauri-vendor-1uBLmS9u.js";import"./useV4LiveQuery-Do0jdBW3.js";class Yt{async bulkWrite(i,a,n="put"){a.length!==0&&await $.transaction("rw",$[i],async()=>{switch(n){case"put":await $[i].bulkPut(a);break;case"add":await $[i].bulkAdd(a);break;case"update":const p=a.map(_=>$[i].update(_.id,_));await Promise.all(p);break}})}async bulkDelete(i,a){a.length!==0&&await $.transaction("rw",$[i],async()=>{await $[i].bulkDelete(a)})}async conditionalBulkUpdate(i,a,n){let p=0;return await $.transaction("rw",$[i],async()=>{await $[i].toCollection().modify(_=>{a(_)&&(Object.assign(_,n),p++)})}),p}freezeDeep(i){const a=i.map(n=>Object.freeze(n));return Object.freeze(a)}async getAndFreeze(i,a){const n=await $[i].get(a);return n?Object.freeze(n):null}async getAllAndFreeze(i){const a=await $[i].toArray();return this.freezeDeep(a)}}const ne=new Yt;class Zt{async bulkUpsertModels(i){i.length!==0&&await $.transaction("rw",$.models,async()=>{const a=i.map(n=>Object.freeze({...n,enabled:n.enabled??!1,available:n.available??!0}));await $.models.bulkPut(a)})}async clearProviderModels(i){return await $.transaction("rw",$.models,async()=>{const p=(await $.models.where("provider").equals(i).toArray()).map(_=>_.id);return p.length>0&&await $.models.bulkDelete(p),p.length})}async toggleModelEnabled(i,a){return await $.models.update(i,{enabled:a})===1}async toggleProviderModels(i,a){return await ne.conditionalBulkUpdate("models",n=>n.provider===i,{enabled:a})}async toggleAllModels(i){return await ne.conditionalBulkUpdate("models",()=>!0,{enabled:i})}async getModelStatistics(){const i=await $.models.toArray(),a={total:i.length,enabled:0,byProvider:{}};for(const n of i)n.enabled&&a.enabled++,a.byProvider[n.provider]||(a.byProvider[n.provider]={total:0,enabled:0}),a.byProvider[n.provider].total++,n.enabled&&a.byProvider[n.provider].enabled++;return Object.freeze(a)}async updateModelAvailability(i,a){return await ne.conditionalBulkUpdate("models",n=>n.provider===i,{available:a})}async searchModels(i){let a=$.models.toCollection();if(i.provider&&(a=$.models.where("provider").equals(i.provider)),i.enabled!==void 0&&(a=a.and(p=>p.enabled===i.enabled)),i.available!==void 0&&(a=a.and(p=>p.available===i.available)),i.search){const p=i.search.toLowerCase();a=a.and(_=>_.displayName.toLowerCase().includes(p)||_.modelId.toLowerCase().includes(p))}const n=await a.toArray();return ne.freezeDeep(n)}async clearAllModels(){await $.models.clear()}}const es=new Zt;function ts(){const F=Le(),i=y(!1),a=y(null),n=y(!1),p=y(!1);async function _(w,c){i.value=!0,c&&(c.value=!0),a.value=null;try{return{ok:!0,value:await w()}}catch(s){const L=s instanceof Error?s:new Error(String(s));return a.value=L,{ok:!1,error:L}}finally{i.value=!1,c&&(c.value=!1)}}async function V(w){return _(()=>F.discoverModels(w),n)}async function E(w){return _(()=>F.refreshModelSource(w),n)}async function A(w,c){return _(async()=>{await F.toggleModel(w,c)},p)}async function h(w){return _(async()=>{await F.toggleAllModels(w)},p)}async function d(w,c){return _(async()=>{await F.toggleProviderModels(w,c)},p)}async function x(){return _(async()=>{await F.enableOpenRouterFavorites()},p)}async function C(){return _(async()=>{await F.clearAllModels()})}async function v(w,c){return _(async()=>{await es.updateModelAvailability(w,c)})}return{discoverModels:V,refreshDiscoverySource:E,toggleModel:A,toggleAllModels:h,toggleProviderModels:d,enableOpenRouterFavorites:x,clearAllModels:C,updateModelAvailability:v,isExecuting:i,lastError:a,isDiscovering:n,isTogglingModels:p}}function qe(){const F=Le(),i=y([]),a=y(!1),n=y([]);function p(){const E=F.getDiscoveryStatus();i.value=E.map(A=>({id:A.id,status:A.status==="loading"?"loading":A.status==="idle"?"success":A.status,modelCount:A.modelCount,error:A.error})),a.value=F.isDiscovering(),n.value=F.getDiscoveryErrors()}function _(E){return{litellm:"LiteLLM",openrouter:"OpenRouter",ollama:"Ollama",deterministic:"Deterministic"}[E]||E}function V(E){return wt.getProvider(E)?.name||E}return p(),{discoveryStatus:K(()=>i.value),isDiscovering:K(()=>a.value),discoveryErrors:K(()=>n.value),getSourceDisplayName:_,getProviderDisplayName:V,refreshStatus:p}}const ss={class:"model-list"},os={class:"model-header"},as={class:"model-table"},ls=["onClick"],ns={class:"model-name"},rs={class:"model-source"},is={class:"model-context"},ds={key:0},us={key:1,class:"text-secondary"},cs={key:0,class:"model-cost-in"},vs={key:0,class:"cost-value"},ps={key:1,class:"text-secondary"},ms={key:1,class:"model-cost-out"},fs={key:0,class:"cost-value"},gs={key:1,class:"text-secondary"},_s={class:"model-enviro-carbon"},ys={class:"enviro-value"},bs={class:"model-enviro-water"},ks={class:"enviro-value"},hs={class:"model-enviro-energy"},ws={class:"enviro-value"},Cs=ie({__name:"ModelListV3",props:{models:{},providerId:{}},emits:["toggle-model"],setup(F){const i=F,a=Re(),n=y("name"),p=y("asc"),_=K(()=>{if(!i.models||i.models.length===0)return[];const h=i.models.filter(C=>C.capabilities?.inputCostPerToken||C.capabilities?.outputCostPerToken);return h.length>0?O.info("MODEL_LIST_DEBUG: Models with pricing:",h.map(C=>({id:C.id,provider:C.provider,modelId:C.modelId,inputCost:C.capabilities?.inputCostPerToken,outputCost:C.capabilities?.outputCostPerToken}))):O.info("MODEL_LIST_DEBUG: No models have pricing data. Sample model:",i.models[0]),[...i.models].sort((C,v)=>{let w=0;switch(n.value){case"enabled":w=(C.enabled?1:0)-(v.enabled?1:0);break;case"name":w=C.displayName.localeCompare(v.displayName);break;case"source":w=(C.source||"").localeCompare(v.source||"");break;case"context":const c=C.capabilities?.contextWindow||0,s=v.capabilities?.contextWindow||0;w=c-s;break;case"inputCost":const L=C.capabilities?.inputCostPerToken||0,D=v.capabilities?.inputCostPerToken||0;w=L-D;break;case"outputCost":const q=C.capabilities?.outputCostPerToken||0,J=v.capabilities?.outputCostPerToken||0;w=q-J;break}return p.value==="asc"?w:-w})});function V(h){n.value===h?p.value=p.value==="asc"?"desc":"asc":(n.value=h,p.value="asc")}function E(h){return h>=1e6?(h/1e6).toFixed(1)+"M":h>=1e3?(h/1e3).toFixed(0)+"K":h.toString()}function A(h){if(!h||h===0)return"0.00";const d=h*1e6;return d<.01?d.toFixed(4):d<1?d.toFixed(3):d<10?d.toFixed(2):d<100?d.toFixed(1):d.toFixed(0)}return(h,d)=>{const x=St,C=ge;return u(),b("div",ss,[t("div",os,[t("div",{class:"header-switch sortable",onClick:d[0]||(d[0]=v=>V("enabled"))},[d[7]||(d[7]=t("span",null,"Enabled",-1)),t("span",{class:ee(["sort-indicator",{active:n.value==="enabled"}])},f(n.value==="enabled"&&p.value==="asc"?"â–²":"â–¼"),3)]),t("div",{class:"header-name sortable",onClick:d[1]||(d[1]=v=>V("name"))},[d[8]||(d[8]=t("span",null,"Model",-1)),t("span",{class:ee(["sort-indicator",{active:n.value==="name"}])},f(n.value==="name"&&p.value==="asc"?"â–²":"â–¼"),3)]),t("div",{class:"header-source sortable",onClick:d[2]||(d[2]=v=>V("source"))},[d[9]||(d[9]=t("span",null,"Source",-1)),t("span",{class:ee(["sort-indicator",{active:n.value==="source"}])},f(n.value==="source"&&p.value==="asc"?"â–²":"â–¼"),3)]),t("div",{class:"header-context sortable",onClick:d[3]||(d[3]=v=>V("context"))},[d[10]||(d[10]=t("span",null,"Context",-1)),t("span",{class:ee(["sort-indicator",{active:n.value==="context"}])},f(n.value==="context"&&p.value==="asc"?"â–²":"â–¼"),3)]),g(a).showFinancialCosts.value?(u(),b("div",{key:0,class:"header-cost-in sortable",onClick:d[4]||(d[4]=v=>V("inputCost"))},[d[11]||(d[11]=t("span",null,"Input $/1M",-1)),t("span",{class:ee(["sort-indicator",{active:n.value==="inputCost"}])},f(n.value==="inputCost"&&p.value==="asc"?"â–²":"â–¼"),3)])):T("",!0),g(a).showFinancialCosts.value?(u(),b("div",{key:1,class:"header-cost-out sortable",onClick:d[5]||(d[5]=v=>V("outputCost"))},[d[12]||(d[12]=t("span",null,"Output $/1M",-1)),t("span",{class:ee(["sort-indicator",{active:n.value==="outputCost"}])},f(n.value==="outputCost"&&p.value==="asc"?"â–²":"â–¼"),3)])):T("",!0),d[13]||(d[13]=t("div",{class:"header-enviro-carbon"},[t("span",null,"COâ‚‚")],-1)),d[14]||(d[14]=t("div",{class:"header-enviro-water"},[t("span",null,"ðŸ’§")],-1)),d[15]||(d[15]=t("div",{class:"header-enviro-energy"},[t("span",null,"âš¡")],-1))]),t("div",as,[(u(!0),b(H,null,se(_.value,v=>(u(),b("div",{key:v.id,class:"model-row",onClick:w=>h.$emit("toggle-model",v.id,!v.enabled)},[t("div",{class:"model-switch",onClick:d[6]||(d[6]=oe(()=>{},["stop"]))},[r(x,{checked:v.enabled,size:"small",onChange:w=>h.$emit("toggle-model",v.id,w),"data-testid":"model-toggle","data-provider":v.provider,"data-model":v.modelId,"aria-label":`${v.enabled?"Disable":"Enable"} model ${v.modelId}`},null,8,["checked","onChange","data-provider","data-model","aria-label"])]),t("div",ns,[t("code",null,f(v.modelId),1)]),t("div",rs,[v.source?(u(),N(C,{key:0,size:"small",color:"cyan"},{default:l(()=>[M(f(v.source),1)]),_:2},1024)):T("",!0)]),t("div",is,[v.capabilities?.contextWindow?(u(),b("span",ds,f(E(v.capabilities.contextWindow)),1)):(u(),b("span",us,"-"))]),g(a).showFinancialCosts.value?(u(),b("div",cs,[v.capabilities?.inputCostPerToken?(u(),b("span",vs," $"+f(A(v.capabilities.inputCostPerToken)),1)):(u(),b("span",ps,"-"))])):T("",!0),g(a).showFinancialCosts.value?(u(),b("div",ms,[v.capabilities?.outputCostPerToken?(u(),b("span",fs," $"+f(A(v.capabilities.outputCostPerToken)),1)):(u(),b("span",gs,"-"))])):T("",!0),t("div",_s,[t("span",ys,f(g(a).getEnvironmentalCost(v,"carbon")),1)]),t("div",bs,[t("span",ks,f(g(a).getEnvironmentalCost(v,"water")),1)]),t("div",hs,[t("span",ws,f(g(a).getEnvironmentalCost(v,"energy")),1)])],8,ls))),128))])])}}}),Ms=re(Cs,[["__scopeId","data-v-2b840b1b"]]),$s={class:"model-preference-manager"},Os={class:"preferences-section"},Ps={class:"action-group"},Ds={class:"action-group"},As={class:"status-grid"},Ss={class:"status-item"},Es={class:"status-value"},xs={class:"status-item"},Ls={class:"status-value"},Rs={class:"status-item"},Fs={class:"status-value"},Vs={class:"status-item"},Us={class:"status-value"},zs={class:"status-item"},Bs={class:"status-value"},Ts={class:"status-item"},Ns={class:"status-value"},Gs={class:"action-group"},js={class:"provider-grid"},Ks={class:"provider-name"},Is={class:"provider-stats"},Ws={class:"provider-total"},qs={class:"provider-enabled"},Js=ie({__name:"ModelPreferenceManagerV3",setup(F){const{models:i,enabledModels:a,modelsByProvider:n}=Ue(),{discoveryStatus:p}=qe(),_=Re(),{showFinancialCosts:V,showEnvironmentalCosts:E}=_,A=y([]),h=y(!1),d=y(!1),x=y(""),C=y("");async function v(){h.value=!0,x.value="";try{const c=await _.exportModelPreferences();if(c.ok){const s=new Blob([JSON.stringify(c.value,null,2)],{type:"application/json"}),L=URL.createObjectURL(s),D=document.createElement("a");D.href=L,D.download=`model-preferences-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(L),C.value="Model preferences exported successfully!"}else x.value=c.error.message}catch(c){x.value=`Failed to export preferences: ${c instanceof Error?c.message:"Unknown error"}`}finally{h.value=!1}}async function w(c){d.value=!0,x.value="";try{const s=await c.text(),L=JSON.parse(s),D=await _.importModelPreferences(L);D.ok?C.value="Model preferences imported successfully!":x.value=D.error.message}catch(s){s instanceof SyntaxError?x.value="Invalid JSON file format":x.value=`Failed to import preferences: ${s instanceof Error?s.message:"Unknown error"}`}finally{d.value=!1}return!1}return(c,s)=>{const L=_e,D=xt,q=Ne,J=Ge,I=je,Z=Te,R=Be;return u(),b("div",$s,[r(R,{activeKey:A.value,"onUpdate:activeKey":s[2]||(s[2]=U=>A.value=U),bordered:!1,class:"preferences-collapse"},{default:l(()=>[r(Z,{key:"preferences"},{header:l(()=>s[3]||(s[3]=[t("div",{class:"preferences-header"},[t("strong",null,"ðŸ”§ V3 Enhanced Features"),t("span",{class:"preferences-description"},"Advanced model preference management")],-1)])),default:l(()=>[t("div",Os,[t("div",Ps,[s[6]||(s[6]=t("h5",{class:"action-title"},"Model Preferences",-1)),s[7]||(s[7]=t("p",{class:"action-description"}," Export and import your model enabled/disabled preferences for backup or sharing. ",-1)),r(q,null,{default:l(()=>[r(L,{onClick:v,loading:h.value,type:"primary"},{icon:l(()=>[r(g(Et))]),default:l(()=>[s[4]||(s[4]=M(" Export Preferences "))]),_:1,__:[4]},8,["loading"]),r(D,{"before-upload":w,"show-upload-list":!1,accept:".json"},{default:l(()=>[r(L,{loading:d.value},{icon:l(()=>[r(g(Lt))]),default:l(()=>[s[5]||(s[5]=M(" Import Preferences "))]),_:1,__:[5]},8,["loading"])]),_:1})]),_:1})]),r(J),t("div",Ds,[s[14]||(s[14]=t("h5",{class:"action-title"},"V3 System Information",-1)),s[15]||(s[15]=t("p",{class:"action-description"}," Enhanced V3 backend capabilities and status. ",-1)),t("div",As,[t("div",Ss,[s[8]||(s[8]=t("span",{class:"status-label"},"Total Models:",-1)),t("span",Es,f(g(i)?.length||0),1)]),t("div",xs,[s[9]||(s[9]=t("span",{class:"status-label"},"Enabled Models:",-1)),t("span",Ls,f(g(a)?.length||0),1)]),t("div",Rs,[s[10]||(s[10]=t("span",{class:"status-label"},"Active Providers:",-1)),t("span",Fs,f(Object.keys(g(n)||{}).length),1)]),t("div",Vs,[s[11]||(s[11]=t("span",{class:"status-label"},"Discovery Sources:",-1)),t("span",Us,f(g(p)?.length||0),1)]),t("div",zs,[s[12]||(s[12]=t("span",{class:"status-label"},"Cost Display:",-1)),t("span",Bs,f(g(V)?"Enabled":"Disabled"),1)]),t("div",Ts,[s[13]||(s[13]=t("span",{class:"status-label"},"Environmental Display:",-1)),t("span",Ns,f(g(E)?"Enabled":"Disabled"),1)])])]),r(J),t("div",Gs,[s[16]||(s[16]=t("h5",{class:"action-title"},"Provider Status",-1)),s[17]||(s[17]=t("p",{class:"action-description"}," Real-time provider status and model counts. ",-1)),t("div",js,[(u(!0),b(H,null,se(g(n),(U,G)=>(u(),b("div",{key:G,class:"provider-item"},[t("div",Ks,f(g(_).getProviderDisplayName(G)),1),t("div",Is,[t("span",Ws,f(U.length)+" total",1),t("span",qs,f(U.filter(te=>te.enabled).length)+" enabled",1)])]))),128))])])]),x.value?(u(),N(I,{key:0,type:"error",message:x.value,closable:"",onClose:s[0]||(s[0]=U=>x.value=""),class:"error-alert"},null,8,["message"])):T("",!0),C.value?(u(),N(I,{key:1,type:"success",message:C.value,closable:"",onClose:s[1]||(s[1]=U=>C.value=""),class:"success-alert"},null,8,["message"])):T("",!0)]),_:1})]),_:1},8,["activeKey"])])}}}),Hs=re(Js,[["__scopeId","data-v-f4de1453"]]),Qs={key:0,class:"loading-state"},Xs={key:1,class:"error-state"},Ys={class:"error-message"},Zs=["onClick"],eo={class:"list-header"},to={class:"list-info"},so={class:"list-name"},oo={class:"list-meta"},ao={class:"list-actions"},lo={class:"list-description"},no={class:"list-preview"},ro={key:0,class:"more-models"},io=ie({__name:"ModelListsDropdownV3",props:{currentModels:{},isLoading:{type:Boolean,default:!1}},emits:["apply-list","close"],setup(F,{emit:i}){const a=F,n=i,{getProviderGroup:p}=ze(),_=y([]),V=y(!0),E=y(""),A=y(!1),h=y("");Ve(async()=>{try{V.value=!0,E.value="";const{getModelListManager:c}=await Fe(async()=>{const{getModelListManager:D}=await import("./index-Cm3YP0q9.js").then(q=>q.K);return{getModelListManager:D}},__vite__mapDeps([0,1,2,3,4,5])),L=await c().getLists();_.value=L.filter(D=>["openrouter-favorites","cost-efficient","high-performance"].includes(D.id)),O.info("Model lists loaded:",{lists:_.value.length})}catch(c){O.error("Failed to load model lists:",c),E.value="Failed to load model lists"}finally{V.value=!1}});function d(c){return a.currentModels.some(s=>s.modelId!==c.modelId?!1:c.provider?s.provider===c.provider&&s.enabled:c.providerGroup?p(s.provider)===c.providerGroup&&s.enabled:!1)}function x(c){return c.models.slice(0,3)}function C(c){return c.modelId.replace(/^.*\//,"").replace(/-instruct$/,"").replace(/-preview$/,"")}async function v(c){if(!(A.value||a.isLoading))try{A.value=!0,h.value=c,await new Promise(s=>{n("apply-list",c),setTimeout(()=>{s()},2e3)})}catch(s){O.error("Failed to apply list:",s)}finally{A.value=!1,h.value=""}}function w(c){c.domEvent?.stopPropagation()}return(c,s)=>{const L=Rt,D=_e,q=Ke,J=Ft,I=ge,Z=We;return u(),N(Z,{class:"model-lists-menu",onClick:w},{default:l(()=>[V.value?(u(),b("div",Qs,[r(L,{size:"small"}),s[0]||(s[0]=t("span",null,"Loading model lists...",-1))])):E.value?(u(),b("div",Xs,[t("span",Ys,f(E.value),1)])):(u(),b(H,{key:2},[s[6]||(s[6]=t("div",{class:"menu-header"},[t("span",null,"Built-in Lists")],-1)),(u(!0),b(H,null,se(_.value,R=>(u(),N(q,{key:R.id,class:"list-menu-item"},{default:l(()=>[t("div",{class:"list-item",onClick:U=>v(R.id)},[t("div",eo,[t("div",to,[t("span",so,f(R.name),1),t("span",oo,f(R.models.length)+" models",1)]),t("div",ao,[r(D,{type:"primary",size:"small",loading:A.value&&h.value===R.id,onClick:oe(U=>v(R.id),["stop"])},{default:l(()=>s[1]||(s[1]=[M(" Apply ")])),_:2,__:[1]},1032,["loading","onClick"])])]),t("div",lo,f(R.description),1),t("div",no,[(u(!0),b(H,null,se(x(R),(U,G)=>(u(),b("span",{key:`${U.provider||U.providerGroup}-${U.modelId}`,class:ee(["preview-model",{enabled:d(U)}])},f(C(U))+f(G<x(R).length-1?", ":""),3))),128)),R.models.length>3?(u(),b("span",ro," +"+f(R.models.length-3)+" more ",1)):T("",!0)])],8,Zs)]),_:2},1024))),128)),r(J),r(q,{disabled:"",class:"future-feature"},{default:l(()=>[r(g(Vt)),s[3]||(s[3]=t("span",null,"Save Current Selection...",-1)),r(I,{color:"blue",size:"small"},{default:l(()=>s[2]||(s[2]=[M("Soon")])),_:1,__:[2]})]),_:1,__:[3]}),r(q,{disabled:"",class:"future-feature"},{default:l(()=>[r(g(Ie)),s[5]||(s[5]=t("span",null,"Manage Lists...",-1)),r(I,{color:"blue",size:"small"},{default:l(()=>s[4]||(s[4]=[M("Soon")])),_:1,__:[4]})]),_:1,__:[5]})],64))]),_:1})}}}),uo=re(io,[["__scopeId","data-v-5706641b"]]),co={class:"models-view","data-testid":"page-models"},vo={class:"page-header"},po={key:3,class:"discovery-status-bar"},mo={class:"source-name"},fo=["onClick","data-testid","aria-label"],go={class:"search-filter-bar"},_o={class:"control-bar"},yo={class:"left-controls"},bo={class:"dropdown-item"},ko={class:"dropdown-item"},ho={class:"stats"},wo={class:"provider-header"},Co={class:"provider-info"},Mo={key:1,class:"provider-summary"},$o=ie({__name:"ModelsViewV3",setup(F){const i=Dt(),{models:a,modelsByProvider:n,stats:p}=Ue(),{getProviderGroup:_,requiresApiKey:V}=ze(),E=Ct(),{hasApiKey:A}=E.secureSettings,{discoverModels:h,refreshDiscoverySource:d,toggleModel:x,toggleAllModels:C,toggleProviderModels:v,clearAllModels:w,isDiscovering:c,isTogglingModels:s}=ts(),{discoveryStatus:L,getSourceDisplayName:D,getProviderDisplayName:q,refreshStatus:J}=qe(),I=y(""),Z=y(""),R=y("all"),U=y(!1),G=y({hideOpenRouterFree:!1,hideOpenRouterAuto:!1}),te=K(()=>{const o={};return Object.keys(n.value||{}).forEach(e=>{const m=_(e),S=V(e),j=A(m);o[e]={hasKey:j,providerGroup:m,requiresKey:S}}),o}),de=y(!1),P=y(""),Q=y([]),ye=y(null),be=y([]),Je=y(!1),ae=y(null),ue=y(!1);let ce=null;const He=o=>{ce&&clearTimeout(ce),ce=setTimeout(()=>{Z.value=o},300)},ve=K(()=>{const o={};for(const[e,m]of Object.entries(n.value))o[e]=m.filter(S=>S.enabled).length;return o}),X=y([]),le=K(()=>{const o=Z.value.toLowerCase(),e={},m=Object.keys(n.value);if(X.value.length===0||m.some(S=>!X.value.includes(S))){const S=X.value.filter(z=>m.includes(z)),j=m.filter(z=>!X.value.includes(z)).sort();X.value=[...S,...j]}for(const S of X.value){const j=n.value[S];if(!j)continue;let z=[...j];o&&(z=z.filter(Y=>Y.displayName.toLowerCase().includes(o)||Y.modelId.toLowerCase().includes(o)||S.toLowerCase().includes(o))),R.value==="enabled"?z=z.filter(Y=>Y.enabled):R.value==="disabled"&&(z=z.filter(Y=>!Y.enabled)),z.length>0&&(e[S]=z)}return e}),Qe=K(()=>{const o=p.value.total;return O.info("ModelsViewV3 V4 totalCount:",o),o}),Xe=K(()=>p.value.enabled),Ye=K(()=>n.value.openrouter?.length>0),Ze=K(()=>I.value?`No models found matching "${I.value}"`:R.value!=="all"?`No ${R.value} models found`:'No models available. Click "Refresh Models" to discover models.'),ke=K(()=>{if(!P.value)return!1;const o=P.value.toLowerCase();return o.includes("ollama")&&(o.includes("failed to fetch")||o.includes("networkerror when attempting to fetch"))&&!o.includes("litellm")&&!o.includes("openrouter")}),et=K(()=>!0),pe=K(()=>{const o=X.value.length;return Q.value.length===o&&o>0}),tt=Se(Ut),st=Se(zt);function ot(o){return{idle:"default",loading:"processing",success:"success",error:"error"}[o]||"default"}function at(o){return ve.value[o]||0}function lt(o){const e=at(o),m=(n.value[o]||[]).length;return e===0?"default":e===m?"success":"warning"}function nt(o){const e=le.value[o]||[];return e.length>0&&e.every(m=>m.enabled)}function rt(o){const e=le.value[o]||[];return e.length>0&&e.every(m=>!m.enabled)}function it(o){i.push({path:"/settings",query:o?{provider:o}:void 0})}function dt(){pe.value?Q.value=[]:Q.value=[...X.value]}async function ut(o,e){const m=await x(o,e);m.ok||(P.value=m.error.message)}async function he(o,e){const m=await v(o,e);m.ok||(P.value=m.error.message)}async function ct(){const o=await C(!0);o.ok||(P.value=o.error.message)}async function vt(){const o=await C(!1);o.ok||(P.value=o.error.message)}async function me(){U.value=!0,P.value="";try{O.info("V4 DEBUG: Starting discovery...");const o=await h({forceRefresh:!0});if(O.info("V4 DEBUG: Discovery result:",o),o.ok){O.info("V4 DEBUG: Discovery successful, models found:",o.value.totalModels),O.info("V4 DEBUG: After discovery, models.value.length =",a.value.length);const e=o.value.errors.filter(m=>!(m.includes("ollama")&&m.includes("not detected")));e.length>0&&(P.value=`Some sources failed: ${e.join("; ")}`)}else O.info("V4 DEBUG: Discovery failed:",o.error),P.value=`Discovery failed: ${o.error.message}`;J()}catch(o){O.error("Failed to refresh models",o),P.value="Failed to refresh models. Please check your connection and try again."}finally{U.value=!1}}async function pt(o){ye.value=o,P.value="";try{const e=await d(o);o==="ollama"&&(e.ok&&e.value?.errors?.some(S=>S.includes("not detected"))||!e.ok&&e.error?.message?.includes("not detected"))||(e.ok&&e.value.errors.length>0?P.value=`Failed to refresh ${D(o)}: ${e.value.errors.join("; ")}`:e.ok||(P.value=`Failed to refresh ${D(o)}: ${e.error.message}`)),J()}catch(e){O.error("Failed to retry source",e,{sourceId:o}),P.value=`Failed to refresh ${D(o)}: ${e instanceof Error?e.message:"Unknown error"}`}finally{ye.value=null}}async function mt(){try{await d("ollama"),J(),Ce()}catch(o){O.error("Failed to refresh Ollama models after update",o)}}async function we(){O.info("[ModelsView] Saving OpenRouter settings:",G.value),await $.settings.get("main")?(O.info("[ModelsView] Updating existing settings"),await $.settings.update("main",{hideOpenRouterFree:G.value.hideOpenRouterFree,hideOpenRouterAuto:G.value.hideOpenRouterAuto})):(O.info("[ModelsView] Creating new settings"),await $.settings.add({id:"main",version:1,initialized:!0,hideOpenRouterFree:G.value.hideOpenRouterFree,hideOpenRouterAuto:G.value.hideOpenRouterAuto}));const e=await $.settings.get("main");O.info("[ModelsView] Settings after save:",e)}async function Ce(){try{(await Xt()).hasIssue?ae.value="not-detected":ae.value=null}catch{}}async function ft(){if(confirm("This will remove all models and re-discover them from scratch. Any custom model configurations will be lost. Continue?")){de.value=!0,P.value="";try{const e=await w();if(!e.ok){P.value=e.error.message;return}const m=await h({forceRefresh:!0});if(m.ok&&m.value.errors.length>0){const S=m.value.errors.filter(j=>!(j.includes("ollama")&&j.includes("not detected")));S.length>0&&(P.value=`Some sources failed: ${S.join("; ")}`)}else m.ok||(P.value=`Discovery failed: ${m.error.message}`);J()}catch(e){O.error("Failed to clear and refresh models",e),P.value="Failed to clear and refresh models. Please check your connection and try again."}finally{de.value=!1}}}async function gt(o){try{O.info("Applying model list:",o);const{getModelListManager:e}=await Fe(async()=>{const{getModelListManager:j}=await import("./index-Cm3YP0q9.js").then(z=>z.K);return{getModelListManager:j}},__vite__mapDeps([0,1,2,3,4,5])),S=await e().applyList(o);O.info("Model list applied:",S),await me()}catch(e){O.error("Failed to apply model list:",e),P.value=`Failed to apply model list: ${e instanceof Error?e.message:"Unknown error"}`}}Mt(()=>{He(I.value)});const W=K(()=>s.value);return Ve(async()=>{O.info("V4 DEBUG: models.value.length =",a.value.length),O.info("V4 DEBUG: models.value =",a.value),O.info("V4 DEBUG: modelsByProvider.value =",n.value);const o=await $.settings.get("main");o&&(G.value={hideOpenRouterFree:o.hideOpenRouterFree??!1,hideOpenRouterAuto:o.hideOpenRouterAuto??!1}),a.value.length===0&&(O.info("V4 DEBUG: No models found, refreshing..."),me()),Q.value=[],Ce()}),$t(()=>{I.value="",Q.value=[],P.value=""}),(o,e)=>{const m=_e,S=Ne,j=je,z=ge,Y=Bt,fe=It,_t=Tt,yt=Ge,Me=Nt,$e=Jt,Oe=Ke,bt=We,kt=Ht,Pe=Te,De=Be,ht=Gt;return u(),b("div",co,[t("div",vo,[e[13]||(e[13]=t("div",{class:"header-content"},[t("h1",null,"Model Management"),t("p",{class:"description"},"Configure and enable LLM models for testing")],-1)),r(S,null,{default:l(()=>[r(m,{type:"primary",onClick:me,loading:U.value||g(c),"data-testid":"btn-refresh-models","aria-label":"Refresh available models"},{icon:l(()=>[r(g(jt))]),default:l(()=>[e[11]||(e[11]=M(" Refresh Models "))]),_:1,__:[11]},8,["loading"]),r(m,{danger:"",onClick:ft,loading:de.value,"data-testid":"btn-clear-refresh-models","aria-label":"Clear all models and refresh"},{icon:l(()=>[r(g(Kt))]),default:l(()=>[e[12]||(e[12]=M(" Clear and Refresh Models "))]),_:1,__:[12]},8,["loading"])]),_:1})]),P.value&&!ke.value?(u(),N(j,{key:0,type:"error",message:P.value,closable:"",onClose:e[0]||(e[0]=k=>P.value=""),class:"error-alert"},null,8,["message"])):T("",!0),ke.value?(u(),N(j,{key:1,type:"info",closable:"",onClose:e[1]||(e[1]=k=>P.value=""),class:"ollama-info-alert"},{message:l(()=>e[14]||(e[14]=[t("div",{class:"ollama-message"},[M(" Ollama is not running on this computer. To audit local LLMs, install "),t("a",{href:"https://ollama.com",target:"_blank",rel:"noopener noreferrer"},"Ollama"),M(". ")],-1)])),_:1})):T("",!0),ae.value?(u(),N(j,{key:2,type:"info",closable:"",onClose:e[2]||(e[2]=k=>ae.value=null),class:"ollama-cors-alert"},{message:l(()=>e[15]||(e[15]=[t("div",{class:"ollama-cors-message"},[t("strong",null,"Ollama not detected: "),t("a",{href:"https://ollama.com",target:"_blank",rel:"noopener noreferrer"},"Ollama"),M(" is an external program for running LLMs on your computer. If Ollama is installed, you must "),t("a",{href:"https://objectgraph.com/blog/ollama-cors/",target:"_blank",rel:"noopener noreferrer"},"configure CORS"),M(' by setting OLLAMA_ORIGINS to "*" or "auditomatic.org". If you do not wish to use Ollama, close and ignore this message. ')],-1)])),_:1})):T("",!0),g(L).length>0?(u(),b("div",po,[e[16]||(e[16]=t("span",{class:"status-label"},"Sources:",-1)),(u(!0),b(H,null,se(g(L),k=>(u(),b("div",{key:k.id,class:"source-status-compact"},[t("span",mo,f(g(D)(k.id)),1),r(z,{color:ot(k.status),size:"small"},{default:l(()=>[k.status==="success"&&k.modelCount?(u(),b(H,{key:0},[M(f(k.modelCount),1)],64)):k.status==="error"?(u(),b("span",{key:1,onClick:B=>pt(k.id),style:{cursor:"pointer"},"data-testid":`retry-source-${k.id}`,"aria-label":`Retry loading models from ${g(D)(k.id)}`},"âŸ³ retry",8,fo)):(u(),b(H,{key:2},[M(f(k.status),1)],64))]),_:2},1032,["color"])]))),128))])):T("",!0),t("div",go,[r(Y,{value:I.value,"onUpdate:value":e[3]||(e[3]=k=>I.value=k),placeholder:"Search models by name, provider, or ID...","allow-clear":"",size:"large",class:"search-input","data-testid":"input-model-search","aria-label":"Search models",loading:I.value!==Z.value},null,8,["value","loading"]),r(_t,{value:R.value,"onUpdate:value":e[4]||(e[4]=k=>R.value=k),"button-style":"solid",size:"large"},{default:l(()=>[r(fe,{value:"all"},{default:l(()=>e[17]||(e[17]=[M("All")])),_:1,__:[17]}),r(fe,{value:"enabled"},{default:l(()=>e[18]||(e[18]=[M("Enabled")])),_:1,__:[18]}),r(fe,{value:"disabled"},{default:l(()=>e[19]||(e[19]=[M("Disabled")])),_:1,__:[19]})]),_:1},8,["value"])]),t("div",_o,[t("div",yo,[r(m,{type:"text",size:"small",onClick:dt},{icon:l(()=>[(u(),N(Ot(pe.value?st.value:tt.value)))]),default:l(()=>[M(" "+f(pe.value?"Collapse All":"Expand All"),1)]),_:1}),r(yt,{type:"vertical"}),r(m,{type:"text",size:"small",onClick:ct,loading:W.value,disabled:W.value},{icon:l(()=>[r(g(Ee))]),default:l(()=>[e[20]||(e[20]=M(" Enable All "))]),_:1,__:[20]},8,["loading","disabled"]),r(m,{type:"text",size:"small",onClick:vt,loading:W.value,disabled:W.value},{icon:l(()=>[r(g(xe))]),default:l(()=>[e[21]||(e[21]=M(" Disable All "))]),_:1,__:[21]},8,["loading","disabled"]),r(Me,{open:ue.value,"onUpdate:open":e[6]||(e[6]=k=>ue.value=k),placement:"bottomLeft",disabled:W.value},{overlay:l(()=>[r(uo,{"current-models":Array.from(g(a)),"is-loading":W.value,onApplyList:gt,onClose:e[5]||(e[5]=k=>ue.value=!1)},null,8,["current-models","is-loading"])]),default:l(()=>[r(m,{type:"text",size:"small",loading:W.value,disabled:W.value},{icon:l(()=>[r(g(qt))]),default:l(()=>[e[22]||(e[22]=M(" Model Lists ")),r(g(Wt))]),_:1,__:[22]},8,["loading","disabled"])]),_:1},8,["open","disabled"]),Ye.value?(u(),N(Me,{key:0},{overlay:l(()=>[r(bt,null,{default:l(()=>[r(Oe,{key:"privacy"},{default:l(()=>[t("div",bo,[r($e,{checked:G.value.hideOpenRouterFree,"onUpdate:checked":e[7]||(e[7]=k=>G.value.hideOpenRouterFree=k),onChange:we},{default:l(()=>e[23]||(e[23]=[M(" Hide free models (privacy concerns) ")])),_:1,__:[23]},8,["checked"])])]),_:1}),r(Oe,{key:"auto"},{default:l(()=>[t("div",ko,[r($e,{checked:G.value.hideOpenRouterAuto,"onUpdate:checked":e[8]||(e[8]=k=>G.value.hideOpenRouterAuto=k),onChange:we},{default:l(()=>e[24]||(e[24]=[M(" Hide Auto Router (unpredictable costs) ")])),_:1,__:[24]},8,["checked"])])]),_:1})]),_:1})]),default:l(()=>[r(m,{type:"text",size:"small"},{icon:l(()=>[r(g(Ie))]),default:l(()=>[e[25]||(e[25]=M(" OpenRouter Settings "))]),_:1,__:[25]})]),_:1})):T("",!0)]),t("div",ho,[t("span",null,f(Xe.value)+" of "+f(Qe.value)+" models enabled",1)])]),r(De,{activeKey:Q.value,"onUpdate:activeKey":e[9]||(e[9]=k=>Q.value=k),bordered:!1,class:"provider-collapse",destroyInactivePanel:!1},{default:l(()=>[(u(!0),b(H,null,se(le.value,(k,B)=>(u(),N(Pe,{key:`provider-${B}`},{header:l(()=>[t("div",wo,[t("div",Co,[t("strong",null,f(g(q)(B)),1),te.value[B]?.requiresKey&&!te.value[B]?.hasKey?(u(),N(kt,{key:0,placement:"top"},{title:l(()=>[M(" API key not set for "+f(te.value[B]?.providerGroup)+". Click to add in settings. ",1)]),default:l(()=>[r(m,{type:"link",danger:"",size:"small",onClick:oe(Ae=>it(te.value[B]?.providerGroup),["stop"])},{icon:l(()=>[r(g(Qt))]),default:l(()=>[e[26]||(e[26]=M(" API Key Missing "))]),_:2,__:[26]},1032,["onClick"])]),_:2},1024)):T("",!0),Q.value.includes(B)?(u(),b(H,{key:2},[r(z,{size:"small",color:"blue"},{default:l(()=>[M(f(k.length)+" models",1)]),_:2},1024),r(z,{size:"small",color:lt(B)},{default:l(()=>[M(f(ve.value[B]||0)+" enabled ",1)]),_:2},1032,["color"])],64)):(u(),b("span",Mo,f(ve.value[B]||0)+" / "+f((g(n)[B]||[]).length)+" enabled ",1))]),r(S,{size:"small"},{default:l(()=>[r(m,{type:"text",size:"small",onClick:oe(Ae=>he(B,!0),["stop"]),disabled:nt(B)||W.value,loading:W.value},{icon:l(()=>[r(g(Ee))]),default:l(()=>[e[27]||(e[27]=M(" Enable All "))]),_:2,__:[27]},1032,["onClick","disabled","loading"]),r(m,{type:"text",size:"small",onClick:oe(Ae=>he(B,!1),["stop"]),disabled:rt(B)||W.value,loading:W.value},{icon:l(()=>[r(g(xe))]),default:l(()=>[e[28]||(e[28]=M(" Disable All "))]),_:2,__:[28]},1032,["onClick","disabled","loading"])]),_:2},1024)])]),default:l(()=>[(u(),N(Pt,null,[r(Ms,{models:k,"provider-id":B,onToggleModel:ut},null,8,["models","provider-id"])],1024))]),_:2},1024))),128))]),_:1},8,["activeKey"]),Object.keys(le.value).length===0?(u(),N(ht,{key:4,description:Ze.value,class:"empty-state"},null,8,["description"])):T("",!0),et.value?(u(),N(De,{key:5,activeKey:be.value,"onUpdate:activeKey":e[10]||(e[10]=k=>be.value=k),bordered:!1,class:"ollama-manager-collapse"},{default:l(()=>[r(Pe,{key:"ollama"},{header:l(()=>e[29]||(e[29]=[t("div",{class:"ollama-header"},[t("strong",null,"Ollama Model Management"),t("span",{class:"ollama-description"},"Download and manage local Ollama models")],-1)])),default:l(()=>[r(At,{onModelsUpdated:mt})]),_:1})]),_:1},8,["activeKey"])):T("",!0),Je.value?(u(),N(Hs,{key:6,class:"enhanced-features"})):T("",!0)])}}}),Vo=re($o,[["__scopeId","data-v-8a55582f"]]);export{Vo as default};
