import{h as Z,u as ce,a as ne}from"./index-C3wwEGBH.js";import{d as J,f as x,c as j,w as X,R as d,Y as o,S as a,a0 as ve,n as Y,q as pe,a2 as me,y as ze,_ as R,k as g,V as b,F as D,W as O,a3 as te,Z as y,G as I,$ as q,a4 as oe,B as Oe,b as Ke,u as G,a1 as qe,o as He,X as Ge}from"./vue-vendor-DPw1dQYc.js";import{u as Xe}from"./useV4Templates-CPSpX_Xu.js";import{u as Ye}from"./useV4TemplateCommands-BnxF1TA4.js";import{a as Ze}from"./useV4VariableLists-DZhy5XH6.js";import{m as ee,am as Je,I as Qe,an as fe,M as ge,W as be,q as _e,ac as et,ad as tt,ae as at,af as lt,o as st,a5 as it,w as nt,a8 as ot,ag as rt,k as re}from"./ui-vendor-BMnJXXRj.js";import{P as ut}from"./ParserSelector-DF749jqq.js";import"./utils-vendor-Cq8ftA55.js";import"./useV4LiveQuery-tQxuLTQz.js";import"./parser.store-DCm08bfp.js";const dt={class:"template-editor"},ct=["placeholder","rows","data-testid","aria-label"],vt=J({__name:"TemplateEditorV3C",props:{modelValue:{},label:{},placeholder:{default:"Enter your prompt template..."},required:{type:Boolean},rows:{default:4},variables:{default:()=>[]},variableColors:{default:()=>({})}},emits:["update:modelValue"],setup(K,{expose:z,emit:p}){const M=K,B=p,m=x(),$=x(),F=x(!1),S=j({get:()=>M.modelValue,set:u=>B("update:modelValue",u)}),T=j(()=>{let u=s(S.value);return u=u.replace(/\{\{(\w+)\}\}/g,(f,i)=>{const n=/^\w+$/.test(i),w=M.variableColors[i];return n&&w?`<span class="variable-highlight" style="background-color: ${w.bg}; box-shadow: 0 0 0 1px ${w.bg};">${s(f)}</span>`:n?`<span class="variable-highlight">${s(f)}</span>`:`<span class="variable-error">${s(f)}</span>`}),u=u.replace(/\n/g,"<br>"),u=u.replace(/  /g," &nbsp;"),u.endsWith("<br>")||(u+="<br>"),u});function s(u){const f=document.createElement("div");return f.textContent=u,f.innerHTML}function h(){!m.value||!$.value||($.value.scrollTop=m.value.scrollTop,$.value.scrollLeft=m.value.scrollLeft)}return X(S,async()=>{await ze(),h()}),z({focus:()=>m.value?.focus()}),(u,f)=>{const i=pe("dompurify-html");return o(),d("div",dt,[a("div",{class:ve(["editor-container",{focused:F.value}])},[Y(a("div",{ref_key:"highlightRef",ref:$,class:"editor-highlight","aria-hidden":"true"},null,512),[[i,T.value,"template"]]),Y(a("textarea",{ref_key:"textareaRef",ref:m,"onUpdate:modelValue":f[0]||(f[0]=n=>S.value=n),class:"editor-textarea",placeholder:u.placeholder,rows:u.rows,"data-testid":u.$attrs["data-testid"]||"textarea-template-editor","aria-label":u.$attrs["aria-label"]||"Template editor textarea",onFocus:f[1]||(f[1]=n=>F.value=!0),onBlur:f[2]||(f[2]=n=>F.value=!1),onScroll:h},null,40,ct),[[me,S.value]])],2)])}}}),pt=Z(vt,[["__scopeId","data-v-da627e6e"]]),mt={class:"variable-chip-input"},ft={key:0,class:"attributed-list-display"},gt={class:"list-header"},bt={class:"source-name"},_t={key:0,class:"attribute-breakdown"},yt={key:0,class:"separator"},ht={class:"total-conditions"},kt={class:"attributed-chips-container"},wt={class:"item-name"},$t={key:0,class:"attributes-wrapper"},Ct={key:1,class:"direct-values"},Vt={key:0,class:"simple-list-display"},Lt={class:"list-header"},It={class:"source-name"},Tt={class:"tag-input-wrapper"},Rt={class:"custom-tag-input"},St={class:"tag-container tag-container-readonly"},Et=["title"],xt={key:0,class:"readonly-hint"},Wt={key:0,class:"helper-text"},Pt={key:1,class:"tag-input-wrapper"},Bt={class:"custom-tag-input"},Ft={class:"tag-container"},Ut={class:"floating-actions"},Mt=["title"],jt=["onClick","data-testid","aria-label"],At=["placeholder","aria-label","onKeydown"],Nt={key:0,class:"helper-text"},Dt=J({__name:"VariableChipInputV3C",props:{values:{},listRef:{},listName:{},source:{},placeholder:{},attributedSamples:{},attributeBreakdown:{},attributeKeys:{},previewValues:{},totalCount:{}},emits:["update:values","clear-source","clear-list","select-list"],setup(K,{emit:z}){const p=K,M=z,B=x(""),m=x();function $(){return[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}]}function F(i){return p.attributeKeys?Object.entries(i).map(([n,w])=>{const t=p.attributeKeys.indexOf(n)%5;return{value:w,colorIndex:t}}):[]}function S(i){M("update:values",i),p.source&&M("clear-source")}function T(){const i=B.value.trim();i&&(p.values.includes(i)||S([...p.values,i]),B.value="")}function s(i){i.preventDefault();const w=(i.clipboardData?.getData("text")||"").split(/\r?\n/).map(t=>t.trim()).filter(t=>t.length>0);if(w.length>0){const t=new Set(p.values),v=w.filter(C=>!t.has(C));v.length>0&&S([...p.values,...v]),B.value=""}}function h(i){const n=[...p.values];n.splice(i,1),S(n)}function u(){if(B.value===""&&p.values.length>0){const i=[...p.values];i.pop(),S(i)}}function f(){S([]),p.source&&M("clear-source")}return(i,n)=>{const w=ee;return o(),d("div",mt,[i.listRef&&i.attributedSamples?(o(),d("div",ft,[a("div",gt,[n[6]||(n[6]=a("span",{class:"source-label"},"From list:",-1)),a("span",bt,b(i.listName||"Unknown List"),1),i.attributeBreakdown&&i.attributeBreakdown.parts.length>0?(o(),d("div",_t,[(o(!0),d(D,null,O(i.attributeBreakdown.parts,(t,v)=>(o(),d(D,{key:`part-${t.text}-${v}`},[a("span",{class:"attribute-part",style:te({backgroundColor:$()[t.colorIndex].bg,color:$()[t.colorIndex].text})},b(t.text),5),v<i.attributeBreakdown.parts.length-1?(o(),d("span",yt," × ")):R("",!0)],64))),128)),n[4]||(n[4]=a("span",{class:"arrow"}," → ",-1)),a("span",ht,b(i.attributeBreakdown.totalItems)+" conditions",1)])):R("",!0),g(w,{size:"small",danger:"",onClick:n[0]||(n[0]=t=>i.$emit("clear-list")),"data-testid":"btn-remove-list","aria-label":"Remove linked variable list"},{default:y(()=>n[5]||(n[5]=[I(" Remove List ")])),_:1,__:[5]})]),a("div",kt,[n[9]||(n[9]=a("span",{class:"sample-hint"},"Sample values:",-1)),(o(!0),d(D,null,O(i.attributedSamples,t=>(o(),d("div",{key:t.value,class:"attributed-item-chip"},[a("span",wt,b(t.value),1),t.attributes?(o(),d("span",$t,[n[7]||(n[7]=I(" (")),(o(!0),d(D,null,O(F(t.attributes),(v,C)=>(o(),d("span",{key:`attr-${v.value}-${C}`,class:"attribute-value",style:te({backgroundColor:$()[v.colorIndex].bg,color:$()[v.colorIndex].text})},b(v.value),5))),128)),n[8]||(n[8]=I(") "))])):R("",!0)]))),128))])])):(o(),d("div",Ct,[i.source?(o(),d("div",Vt,[a("div",Lt,[n[12]||(n[12]=a("span",{class:"source-label"},"From list:",-1)),a("span",It,b(i.source.listName),1),n[13]||(n[13]=a("span",{class:"edit-hint"},"(Unlink list to edit)",-1)),g(w,{size:"small",type:"primary",onClick:n[1]||(n[1]=t=>i.$emit("clear-source")),"data-testid":"btn-unlink-list","aria-label":"Unlink list and edit values directly"},{default:y(()=>n[10]||(n[10]=[I(" Unlink List and Edit Directly ")])),_:1,__:[10]}),g(w,{size:"small",danger:"",onClick:f,"data-testid":"btn-clear-values","aria-label":"Remove all values from list"},{default:y(()=>n[11]||(n[11]=[I(" Remove List ")])),_:1,__:[11]})]),a("div",Tt,[a("div",Rt,[a("div",St,[(o(!0),d(D,null,O(i.values,(t,v)=>(o(),d("div",{key:`${t}-${v}`,class:"tag tag-readonly"},[a("span",{class:"tag-text",title:t.length>100?t:""},b(t.length>100?t.substring(0,100)+"...":t),9,Et)]))),128)),i.values.length===0?(o(),d("span",xt," Values from linked list will appear here ")):R("",!0)]),i.values.length>0?(o(),d("div",Wt,b(i.values.length)+" values ",1)):R("",!0)])])])):R("",!0),i.source?R("",!0):(o(),d("div",Pt,[a("div",Bt,[a("div",Ft,[a("div",Ut,[i.values.length>0?(o(),q(w,{key:0,size:"small",danger:"",onClick:f,"data-testid":"btn-clear-all","aria-label":"Clear all values"},{default:y(()=>n[14]||(n[14]=[I(" Clear ")])),_:1,__:[14]})):R("",!0),g(w,{size:"small",onClick:n[2]||(n[2]=t=>i.$emit("select-list")),"data-testid":"btn-select-list","aria-label":"Replace values with a variable list"},{default:y(()=>n[15]||(n[15]=[I(" Replace with List ")])),_:1,__:[15]})]),(o(!0),d(D,null,O(i.values,(t,v)=>(o(),d("div",{key:`${t}-${v}`,class:"tag"},[a("span",{class:"tag-text",title:t.length>100?t:""},b(t.length>100?t.substring(0,100)+"...":t),9,Mt),a("button",{type:"button",class:"tag-remove",onClick:C=>h(v),"data-testid":`btn-remove-tag-${v}`,"aria-label":`Remove value ${t}`}," × ",8,jt)]))),128)),Y(a("input",{ref_key:"inputField",ref:m,"onUpdate:modelValue":n[3]||(n[3]=t=>B.value=t),placeholder:i.placeholder,class:"tag-input-field","data-testid":"input-variable-value","aria-label":i.placeholder||"Enter variable value",onKeydown:[oe(Oe(T,["prevent"]),["enter"]),oe(u,["backspace"])],onPaste:s},null,40,At),[[me,B.value]])]),i.values.length>0?(o(),d("div",Nt,b(i.values.length)+" values ",1)):R("",!0)])]))]))])}}}),ue=Z(Dt,[["__scopeId","data-v-33f1ece4"]]),zt={class:"variable-preview-cycler"},Ot={class:"preview-controls"},Kt={key:0,class:"cycle-info","data-testid":"cycle-info",role:"status","aria-live":"polite"},qt=["aria-label"],Ht={key:0,class:"preview-content"},Gt={key:0,class:"no-variables"},Xt={key:1,class:"single-preview","data-testid":"single-preview"},Yt={class:"preview-template","data-testid":"preview-template",role:"region","aria-label":"Preview of filled-in prompt"},Zt={key:2,class:"cycling-preview","data-testid":"cycling-preview"},Jt={class:"preview-template","data-testid":"preview-template-cycling",role:"region","aria-label":"Preview of filled-in prompt with cycling variables"},Qt={class:"variable-legend"},ea=["data-testid"],ta={class:"variable-value"},aa=J({__name:"VariablePreviewCyclerV3C",props:{template:{},variableBindings:{},variables:{},variableListRefs:{}},emits:["toggle-preview"],setup(K,{emit:z}){const p=K,M=z,B=ce(),m=x(!1),$=x(0);let F=null;const S=["variable-highlight-blue","variable-highlight-green","variable-highlight-purple","variable-highlight-orange","variable-highlight-pink","variable-highlight-teal"],T=j(()=>{let t=[];if(p.variableBindings?t=Object.keys(p.variableBindings):p.variables&&(t=Object.keys(p.variables)),p.variableListRefs){const v=Object.keys(p.variableListRefs);t=[...new Set([...t,...v])]}return t}),s=j(()=>{if(T.value.length===0)return[];const t=[],v=B.variableLists.value;for(const V of T.value){let k=[];if(p.variableBindings){const P=p.variableBindings[V];if(P.type==="value"&&P.values)k=[...P.values];else if(P.type==="list"&&P.listId){const L=v.find(N=>N.id===P.listId);L&&(L.category==="simple"&&L.values?k=[...L.values]:L.category==="attributed"&&L.items&&(k=L.items.map(N=>N.value)))}}else if(p.variables&&p.variables[V]&&p.variables[V].length>0)k=[...p.variables[V]];else if(p.variableListRefs&&p.variableListRefs[V]){const P=p.variableListRefs[V],L=v.find(N=>N.id===P);L&&(L.category==="simple"&&L.values?k=[...L.values]:L.category==="attributed"&&L.items&&(k=L.items.map(N=>N.value)))}k.length>0&&t.push({name:V,values:k})}if(t.length===0)return[];function C(V){return V.reduce((k,P)=>k.flatMap(L=>P.map(N=>[...L,N])),[[]])}const A=t.map(V=>V.values);return C(A).map(V=>{const k={};return t.forEach((P,L)=>{k[P.name]=V[L]}),k})});function h(){m.value=!m.value,M("toggle-preview",m.value),m.value&&s.value.length>1?u():f()}function u(){f(),F=setInterval(()=>{$.value=($.value+1)%s.value.length},1e3)}function f(){F&&(clearInterval(F),F=null)}function i(t){return S[t%S.length]}function n(t){let v=w(p.template);return T.value.forEach((C,A)=>{if(t[C]!==void 0){const W=w(C),V=new RegExp(`\\{\\{\\s*${W}\\s*\\}\\}`,"g"),P=`<span class="${i(A)}">${w(String(t[C]))}</span>`;v=v.replace(V,P)}}),v}function w(t){const v=document.createElement("div");return v.textContent=t,v.innerHTML}return X(()=>p.template,()=>{$.value=0}),X(s,t=>{t.length===0?f():m.value&&t.length>1&&u(),$.value>=t.length&&($.value=0)}),Ke(()=>{f()}),(t,v)=>{const C=ee,A=pe("dompurify-html");return o(),d("div",zt,[a("div",Ot,[g(C,{type:m.value?"default":"primary",ghost:!m.value,onClick:h,class:"toggle-button","data-testid":"btn-toggle-preview-mode","aria-label":m.value?"Return to editor mode":"Preview filled-in prompts","aria-pressed":m.value},{default:y(()=>[m.value?(o(),q(G(Qe),{key:1})):(o(),q(G(Je),{key:0})),I(" "+b(m.value?"Return to Editor Mode":"Preview Filled-In Prompts"),1)]),_:1},8,["type","ghost","aria-label","aria-pressed"]),m.value&&s.value.length>1?(o(),d("div",Kt,[a("span",{class:"cycle-counter","data-testid":"cycle-counter","aria-label":`Showing combination ${$.value+1} of ${s.value.length}`},b($.value+1)+" / "+b(s.value.length),9,qt),v[0]||(v[0]=a("span",{class:"cycle-hint"},"Auto-cycling every second",-1))])):R("",!0)]),m.value?(o(),d("div",Ht,[s.value.length===0?(o(),d("div",Gt,[g(G(fe)),v[1]||(v[1]=a("span",null,"No variables detected in template",-1))])):s.value.length===1?(o(),d("div",Xt,[Y(a("div",Yt,null,512),[[A,n(s.value[0]),"template"]])])):(o(),d("div",Zt,[Y(a("div",Jt,null,512),[[A,n(s.value[$.value]),"template"]]),a("div",Qt,[(o(!0),d(D,null,O(T.value,(W,V)=>(o(),d("div",{key:W,class:"legend-item","data-testid":`legend-item-${W}`},[a("span",{class:ve(i(V))},b(W),3),a("span",ta,b(s.value[$.value][W]),1)],8,ea))),128))])]))])):R("",!0)])}}}),la=Z(aa,[["__scopeId","data-v-a0ce6ec6"]]),sa={class:"list-selector"},ia={key:0,class:"loading-container"},na={key:0,class:"list-grid"},oa=["onClick"],ra={class:"list-header"},ua={class:"item-count"},da={key:0,class:"list-description"},ca={class:"list-preview"},va={key:0,class:"preview-more"},pa={key:1,class:"attributed-badge"},ma={key:1,class:"empty-state"},fa=J({__name:"ListSelectorV3C",props:{modelValue:{type:Boolean},listType:{}},emits:["update:modelValue","select"],setup(K,{emit:z}){const p=K,M=z,B=ce(),m=j(()=>B.variableLists.value),$=j(()=>!1),F=j(()=>null),S=j(()=>{if(!m.value)return[];let h=[];return p.listType==="all"?h=m.value.filter(u=>u.category!=="tabular"):p.listType==="simple"?h=m.value.filter(u=>u.category==="simple"):p.listType==="refusal"&&(h=m.value.filter(u=>u.category==="refusal")),h}),T=h=>h.category==="attributed"&&h.items?h.items.slice(0,5).map(u=>u.value):h.values?.slice(0,5)??[],s=h=>{M("select",h),M("update:modelValue",!1)};return(h,u)=>{const f=be,i=_e,n=ee,w=ge;return o(),q(w,{open:h.modelValue,title:"Select List",width:"80vw",style:{maxWidth:"800px"},"onUpdate:open":u[1]||(u[1]=t=>h.$emit("update:modelValue",t)),onCancel:u[2]||(u[2]=t=>h.$emit("update:modelValue",!1))},{footer:y(()=>[g(n,{onClick:u[0]||(u[0]=t=>h.$emit("update:modelValue",!1))},{default:y(()=>u[3]||(u[3]=[I(" Cancel ")])),_:1,__:[3]})]),default:y(()=>[a("div",sa,[$.value?(o(),d("div",ia,[g(f,{size:"large",tip:"Loading lists..."})])):F.value?(o(),q(i,{key:1,type:"error",message:F.value.message||"Failed to load lists",class:"error-alert"},null,8,["message"])):(o(),d(D,{key:2},[S.value.length>0?(o(),d("div",na,[(o(!0),d(D,null,O(S.value,t=>(o(),d("div",{key:t.id,class:"list-option",onClick:v=>s(t)},[a("div",ra,[a("h4",null,b(t.name),1),a("span",ua,b(t.itemCount)+" items",1)]),t.description?(o(),d("p",da,b(t.description),1)):R("",!0),a("div",ca,[(o(!0),d(D,null,O(T(t),(v,C)=>(o(),d("span",{key:`${t.id}-preview-${C}-${v}`,class:"preview-value"},b(v),1))),128)),t.itemCount>5?(o(),d("span",va," +"+b(t.itemCount-5)+" more ",1)):R("",!0)]),t.category==="attributed"?(o(),d("div",pa," Attributed List ")):R("",!0)],8,oa))),128))])):(o(),d("div",ma," No "+b(h.listType)+" lists available ",1))],64))])]),_:1},8,["open"])}}}),de=Z(fa,[["__scopeId","data-v-9aca871d"]]),ga={class:"template-editor-page"},ba={class:"header-content"},_a={class:"page-title"},ya={class:"design-form-container"},ha={key:0,class:"loading-container"},ka={class:"name-desc-row"},wa={key:0,class:"variable-hint"},$a={key:0,class:"variables-container"},Ca={class:"variable-label"},Va={class:"variable-content"},La={class:"parser-row"},Ia={style:{flex:"1"}},Ta={class:"refusal-row"},Ra={class:"refusal-content"},Sa={class:"footer-content"},Ea={class:"stats"},xa={class:"actions"},Wa={class:"pricing-content"},Pa={key:0,class:"token-stats"},Ba={class:"stats-grid"},Fa={class:"pricing-placeholder"},Ua=J({__name:"TemplateEditorViewV3C",setup(K){const z=qe(),p=Ge(),{templates:M,loading:B}=Xe(),{variableLists:m}=Ze(),{createTemplate:$,updateTemplate:F,isExecuting:S}=Ye(),T=j(()=>z.params.id),s=x({name:"",description:"",template:"",parserId:null,refusalWords:[],refusalWordsListRef:"",refusalWordsSource:null,rejectRefusalWords:!1}),h=j(()=>B.value||S.value),u=x([]),f=x({}),i=x({}),n=x({}),w=x(!1),t=x(!1),v=x("all"),C=x(""),A=x(!1),W=x(null),V=[{bg:"#E8D5F2",text:"#6B21A8"},{bg:"#D5F2E8",text:"#047857"},{bg:"#FFE4D6",text:"#C2410C"},{bg:"#D6E4FF",text:"#1E40AF"},{bg:"#F3E8D5",text:"#92400E"}],k=j(()=>{if(!s.value.template)return[];const l=/\{\{([^}]+)\}\}/g,e=new Set;let r;for(;(r=l.exec(s.value.template))!==null;){const _=r[1].trim();/^\w+$/.test(_)&&e.add(_)}return Array.from(e)}),P=j(()=>{const l={};return k.value.forEach((e,r)=>{l[e]=V[r%V.length]}),l}),L=j(()=>{let l=1;for(const e of k.value){const r=f.value[e]||[],_=i.value[e];if(_){const E=m.value.find(U=>U.id===_);E&&(l*=E.itemCount||1)}else r.length>0&&(l*=r.length)}return{total:l,formatted:l.toLocaleString()}});function N(l){const e=k.value.indexOf(l);return V[e%V.length]}function ye(l){return`{{${l}}}`}function he(l){}function ke(l){const e=i.value[l];return e?m.value.find(_=>_.id===e)?.name:void 0}function we(l){const e=i.value[l];return e?m.value.find(_=>_.id===e)?.itemCount:void 0}function $e(l){const e=i.value[l];if(!e)return;const r=m.value.find(_=>_.id===e);if(!(!r||r.category!=="attributed"||!r.items))return r.items.slice(0,10)}function Ce(l){const e=i.value[l];if(!e)return;const r=m.value.find(E=>E.id===e);if(!r||r.category!=="attributed")return;const _=[];return r.attributeKeys&&_.push(...r.attributeKeys.map((E,U)=>({text:E,colorIndex:U%5}))),{parts:_,totalItems:r.itemCount||0}}function Ve(l){const e=i.value[l];if(!e)return;const r=m.value.find(_=>_.id===e);return r?.attributeKeys?[...r.attributeKeys]:void 0}function Le(l){const e=i.value[l];if(!e)return;const r=m.value.find(_=>_.id===e);if(!(!r||r.category!=="simple"))return r.values?.slice(0,10)}function Ie(l,e){f.value[l]=e}function Te(l){n.value[l]=null}function Re(l){i.value[l]="",f.value[l]=[]}function Se(l){C.value=l,v.value="all",w.value=!0}function Ee(l){C.value&&(l.category==="simple"?(f.value[C.value]=[...l.values||[]],i.value[C.value]="",n.value[C.value]={listId:l.id,listName:l.name}):(i.value[C.value]=l.id,f.value[C.value]=[],n.value[C.value]=null)),w.value=!1}function xe(){return s.value.refusalWordsListRef?m.value.find(e=>e.id===s.value.refusalWordsListRef)?.name:void 0}function We(){s.value.refusalWordsListRef="",s.value.refusalWords=[]}function Pe(l){(l.category==="simple"||l.category==="refusal")&&l.values&&(s.value.refusalWords=[...l.values],s.value.refusalWordsListRef="",s.value.refusalWordsSource=null),t.value=!1}function Be(l,e){l!==s.value.parserId&&(s.value.parserId=l)}function ae(){p.push({name:"templates"})}async function le(){try{if(u.value=[],!s.value.name.trim()){u.value.push("Template name is required");return}if(!s.value.template.trim()){u.value.push("Template content is required");return}const l={};for(const r of k.value)i.value[r]?l[r]={type:"list",listId:i.value[r]}:f.value[r]?.length>0&&(l[r]={type:"value",values:[...f.value[r]]});const e={name:s.value.name,description:s.value.description,template:s.value.template,variables:l,category:"Custom",tags:[],parserId:s.value.parserId||void 0,refusalWords:s.value.refusalWords.length>0?[...s.value.refusalWords]:void 0,rejectRefusalWords:s.value.rejectRefusalWords};if(T.value){const r=await F(T.value,e);if(r.ok)re.success("Template updated successfully");else{u.value=[r.error.message];return}}else{const r=await $(e);if(r.ok)re.success("Template created successfully");else{u.value=[r.error.message];return}}p.push({name:"templates"})}catch(l){ne.error("Failed to save template:",l),u.value=[l instanceof Error?l.message:"Failed to save template"]}}function se(){if(!T.value)return;const l=M.value.find(_=>_.id===T.value);if(!l){B.value||(u.value=["Template not found"]);return}s.value.name=l.name,s.value.description=l.description||"",s.value.template=l.template;const e=s.value.parserId,r=l.parserId||null;(!e||e===r)&&(s.value.parserId=r),s.value.refusalWords=l.refusalWords?[...l.refusalWords]:[],s.value.rejectRefusalWords=l.rejectRefusalWords||!1,f.value={},i.value={},n.value={};for(const[_,E]of Object.entries(l.variables))if(E.type==="list"&&E.listId){const U=m.value.find(H=>H.id===E.listId);U&&(U.category==="simple"||U.category==="refusal"?(f.value[_]=[...U.values||[]],i.value[_]="",n.value[_]={listId:U.id,listName:U.name}):(i.value[_]=E.listId,f.value[_]=[],n.value[_]=null))}else E.type==="value"&&E.values&&(f.value[_]=[...E.values])}X(A,async l=>{l&&!W.value&&(W.value={promptTokens:Math.ceil(s.value.template.length/4),totalEstimate:Math.ceil(s.value.template.length/3),variableTokens:{}})}),He(()=>{T.value,T.value,T.value&&se()});let ie=T.value;return X([()=>z.params.id,M,m],(l,e)=>{const r=T.value;if(r){const _=r!==ie,E=e&&l[1]!==e[1],U=e&&l[2]!==e[2];(_||E||U)&&se()}ie=r},{immediate:!0}),(l,e)=>{const r=ee,_=tt,E=be,U=it,H=st,Fe=nt,Ue=_e,Me=ot,je=lt,Ae=rt,Ne=et,De=ge;return o(),d("div",ga,[g(Ne,null,{default:y(()=>[g(_,{class:"editor-header"},{default:y(()=>[a("div",ba,[g(r,{type:"text",onClick:ae,class:"back-button","data-testid":"btn-back-to-templates"},{icon:y(()=>[g(G(at))]),default:y(()=>[e[14]||(e[14]=I(" Back to Templates "))]),_:1,__:[14]}),a("h1",_a,b(T.value?"Edit Template":"Create Template"),1)])]),_:1}),g(je,{class:"editor-content"},{default:y(()=>[a("div",ya,[h.value?(o(),d("div",ha,[g(E,{size:"large",tip:"Loading template..."})])):(o(),q(Me,{key:1,model:s.value,layout:"vertical",onFinish:le},{default:y(()=>[a("div",ka,[e[15]||(e[15]=a("label",{class:"inline-field-label"},"Name",-1)),g(H,{name:"name",rules:[{required:!0,message:"Required"}],class:"name-field"},{default:y(()=>[g(U,{value:s.value.name,"onUpdate:value":e[0]||(e[0]=c=>s.value.name=c),placeholder:"Enter template name",size:"large","data-testid":"input-template-name","aria-label":"Template name"},null,8,["value"])]),_:1}),e[16]||(e[16]=a("label",{class:"inline-field-label"},"Description",-1)),g(H,{name:"description",class:"desc-field"},{default:y(()=>[g(U,{value:s.value.description,"onUpdate:value":e[1]||(e[1]=c=>s.value.description=c),placeholder:"Optional description",size:"large","data-testid":"input-template-description","aria-label":"Template description"},null,8,["value"])]),_:1})]),g(H,{label:"Template",name:"template",rules:[{required:!0,message:"Required"}],class:"template-form-item"},{default:y(()=>[k.value.length===0?(o(),d("div",wa,[g(G(fe)),e[17]||(e[17]=a("span",null,[I("Type a prompt and use double curly braces to add a variable with conditions to vary, like "),a("code",null,"{{name}}"),I(" or "),a("code",null,"{{system_prompt}}"),I(". Variable names cannot contain spaces or punctuation except underscores (_).")],-1))])):R("",!0),g(pt,{modelValue:s.value.template,"onUpdate:modelValue":e[2]||(e[2]=c=>s.value.template=c),placeholder:"Enter your prompt template... Use {{variable}} for variables",rows:7,variables:k.value,"variable-colors":P.value,"data-testid":"template-editor","aria-label":"Prompt template editor"},null,8,["modelValue","variables","variable-colors"]),k.value.length>0&&s.value.template?(o(),q(la,{key:1,template:s.value.template,variables:f.value,"variable-list-refs":i.value,onTogglePreview:he},null,8,["template","variables","variable-list-refs"])):R("",!0)]),_:1}),k.value.length>0?(o(),d("div",$a,[(o(!0),d(D,null,O(k.value,c=>(o(),d("div",{key:c,class:"variable-row"},[a("div",Ca,[e[18]||(e[18]=a("span",{class:"variable-text"},"Variable:",-1)),a("span",{style:te({backgroundColor:N(c).bg,color:N(c).text}),class:"variable-badge"},b(ye(c)),5)]),a("div",Va,[g(ue,{values:f.value[c]||[],"list-ref":i.value[c],"list-name":ke(c),source:n.value[c]||null,placeholder:`Enter a value for {{${c}}} and hit enter`,"attributed-samples":$e(c),"attribute-breakdown":Ce(c),"attribute-keys":Ve(c),"preview-values":Le(c),"total-count":we(c),"onUpdate:values":Q=>Ie(c,Q),onClearSource:Q=>Te(c),onClearList:Q=>Re(c),onSelectList:Q=>Se(c)},null,8,["values","list-ref","list-name","source","placeholder","attributed-samples","attribute-breakdown","attribute-keys","preview-values","total-count","onUpdate:values","onClearSource","onClearList","onSelectList"])])]))),128))])):R("",!0),a("div",La,[e[19]||(e[19]=a("label",{class:"row-label"},"Response Parser",-1)),a("div",Ia,[g(ut,{modelValue:s.value.parserId,"onUpdate:modelValue":e[3]||(e[3]=c=>s.value.parserId=c),placeholder:"Select Parser (Optional - leave blank for full response)","allow-clear":!0,context:"template-editor",onChange:Be},null,8,["modelValue"])])]),a("div",Ta,[e[21]||(e[21]=a("label",{class:"row-label"},"Parse Refusals",-1)),a("div",Ra,[g(ue,{values:s.value.refusalWords,"list-ref":s.value.refusalWordsListRef,"list-name":xe(),source:s.value.refusalWordsSource||null,placeholder:"Enter a refusal word and hit enter (e.g., cannot, unable, refuse)","onUpdate:values":e[4]||(e[4]=c=>s.value.refusalWords=c),onClearSource:e[5]||(e[5]=c=>s.value.refusalWordsSource=null),onClearList:e[6]||(e[6]=c=>We()),onSelectList:e[7]||(e[7]=c=>t.value=!0)},null,8,["values","list-ref","list-name","source"])]),g(Fe,{checked:s.value.rejectRefusalWords,"onUpdate:checked":e[8]||(e[8]=c=>s.value.rejectRefusalWords=c),class:"reject-checkbox","data-testid":"checkbox-reject-refusals","aria-label":"Reject responses containing refusal words"},{default:y(()=>e[20]||(e[20]=[I(" Reject on match ")])),_:1,__:[20]},8,["checked"])]),u.value.length>0?(o(),q(Ue,{key:1,type:"error","show-icon":"",class:"error-alert"},{message:y(()=>[I(b(u.value.join(", ")),1)]),_:1})):R("",!0)]),_:1},8,["model"]))])]),_:1}),g(Ae,{class:"editor-footer"},{default:y(()=>[a("div",Sa,[a("div",Ea,b(k.value.length)+" variables • "+b(L.value.formatted)+" combinations ",1),a("div",xa,[g(r,{size:"large",onClick:e[9]||(e[9]=c=>A.value=!0),"data-testid":"btn-calculate-pricing","aria-label":"Calculate pricing for this template"},{default:y(()=>e[22]||(e[22]=[I(" Calculate Pricing ")])),_:1,__:[22]}),g(r,{size:"large",onClick:ae,"data-testid":"btn-cancel-template","aria-label":"Cancel and go back to templates"},{default:y(()=>e[23]||(e[23]=[I(" Cancel ")])),_:1,__:[23]}),g(r,{size:"large",type:"primary",onClick:le,"data-testid":"btn-save-template","aria-label":"Save template and go back to templates"},{default:y(()=>e[24]||(e[24]=[I(" Save ")])),_:1,__:[24]})])])]),_:1})]),_:1}),g(de,{modelValue:w.value,"onUpdate:modelValue":e[10]||(e[10]=c=>w.value=c),"list-type":v.value,onSelect:Ee},null,8,["modelValue","list-type"]),g(de,{modelValue:t.value,"onUpdate:modelValue":e[11]||(e[11]=c=>t.value=c),"list-type":"refusal",onSelect:Pe},null,8,["modelValue"]),g(De,{open:A.value,"onUpdate:open":e[13]||(e[13]=c=>A.value=c),title:"Cost Estimation",width:"90vw",style:{maxWidth:"1000px"}},{footer:y(()=>[g(r,{onClick:e[12]||(e[12]=c=>A.value=!1)},{default:y(()=>e[30]||(e[30]=[I("Close")])),_:1,__:[30]})]),default:y(()=>[a("div",Wa,[W.value?(o(),d("div",Pa,[e[25]||(e[25]=a("h4",null,"Token Analysis",-1)),a("div",Ba,[a("div",null,"Min: "+b(W.value.promptTokens),1),a("div",null,"Max: "+b(W.value.totalEstimate),1),a("div",null,"Avg: "+b(Math.round((W.value.promptTokens+W.value.totalEstimate)/2)),1),a("div",null,"Variables: "+b(Object.keys(W.value.variableTokens).length),1)])])):R("",!0),a("div",Fa,[e[29]||(e[29]=a("p",null,"Pricing calculation will be implemented with V3 backend integration.",-1)),a("p",null,[e[26]||(e[26]=I("Template: ")),a("strong",null,b(s.value.name||"Untitled"),1)]),a("p",null,[e[27]||(e[27]=I("Variables: ")),a("strong",null,b(k.value.length),1)]),a("p",null,[e[28]||(e[28]=I("Combinations: ")),a("strong",null,b(L.value.formatted),1)])])])]),_:1},8,["open"])])}}}),Ga=Z(Ua,[["__scopeId","data-v-4b568bd8"]]);export{Ga as default};
