const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/trial-bundle.service-C0Q0VKH5.js","assets/index-C3wwEGBH.js","assets/vue-vendor-DPw1dQYc.js","assets/ui-vendor-BMnJXXRj.js","assets/utils-vendor-Cq8ftA55.js","assets/index-cTUJCLSS.css","assets/data-vendor-byFmqONf.js","assets/python-bundle-management-B0LMLcDu.js"])))=>i.map(i=>d[i]);
var vs=Object.defineProperty;var gs=(o,e,t)=>e in o?vs(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var $e=(o,e,t)=>gs(o,typeof e!="symbol"?e+"":e,t);import{h as ae,a as P,u as hs,b as gt,d as Ie,v as ys,_ as Re}from"./index-C3wwEGBH.js";import{d as ne,f as q,c as j,o as fe,b as be,w as re,R as f,a0 as se,S as s,_ as R,a9 as we,a3 as ye,Y as u,y as ke,aa as bs,ab as _s,ac as Ts,$ as K,ad as ks,ae as Cs,af as Pt,q as Ft,n as Se,k as $,Z as F,F as ee,W as te,a5 as ht,ag as $s,ah as ws,u as z,a4 as Ze,V as T,G as L,M as Fe,ai as xe,U as xt,A as At,aj as Ss,B as Ot,r as Is,a7 as Es,a1 as Vt,X as Be,a6 as et}from"./vue-vendor-DPw1dQYc.js";import{aH as Dt,C as Nt,aS as Rs,m as me,G as Ps,aT as Lt,aU as Fs,J as ut,az as xs,N as dt,O as ct,V as As,a2 as Mt,P as yt,aV as Os,ab as Vs,av as Ds,aM as Ut,K as Ns,aI as Ls,Z as Ms,Q as pt,I as Us,u as js,M as Ce,ax as jt,aN as Pe,T as ft,q as ze,D as Bs,k as Z,aJ as zs,am as Bt,a6 as Ws,a7 as Hs,a5 as zt,aW as Gs,w as Wt,E as Ht,ak as qs,al as Js,a8 as Xs,o as Ks,ap as Ys,s as Qs,a3 as Zs,a4 as ea,aX as Xe,y as ta,v as sa,au as Gt,aw as aa,aY as qt,z as na,a1 as ra}from"./ui-vendor-BMnJXXRj.js";import{b as Jt}from"./utils-vendor-Cq8ftA55.js";import{u as mt}from"./useCostEstimation-CpldDPvm.js";import{P as oa}from"./ParserSelector-DF749jqq.js";import{u as We,a as Xt}from"./trial-stream-manager-v4-olHbTfnC.js";import{u as ia}from"./parser.store-DCm08bfp.js";import{v as bt,u as la,a as ua,b as da}from"./useV4TrialCommands-BHVUul5A.js";import{u as ca}from"./useHeatmapStylingV3-CCIdVOn4.js";import{u as Ke,w as pa}from"./data-vendor-byFmqONf.js";import{u as fa}from"./execution-control-v4-Y9oFEVU4.js";import{u as ma}from"./useV4Models-CHs1bCey.js";import"./useV4LiveQuery-tQxuLTQz.js";const va={class:"right-panel"},ga=ne({__name:"ResizablePanelContainer",props:{storageKey:{default:"trial-list-width"},defaultWidth:{default:250},minWidth:{default:200},maxWidth:{default:600},mobileBreakpoint:{default:768}},emits:["resize","mobile-overlay-change"],setup(o,{expose:e,emit:t}){const a=o,n=t,r=q(a.defaultWidth),l=q(!1),c=q(0),d=q(0),m=q(window.innerWidth),h=q(!1),g=j(()=>m.value<a.mobileBreakpoint),_=j(()=>g.value?{width:`${Math.min(m.value*.85,400)}px`}:{width:`${r.value}px`});function S(){const v=localStorage.getItem(a.storageKey);if(v){const p=parseInt(v,10);!isNaN(p)&&p>=a.minWidth&&p<=a.maxWidth&&(r.value=p)}}function k(v){localStorage.setItem(a.storageKey,v.toString()),n("resize",v)}function C(v){l.value=!0,c.value=v.clientX,d.value=r.value,document.addEventListener("mousemove",D),document.addEventListener("mouseup",H),document.body.style.userSelect="none",document.body.style.cursor="col-resize"}function D(v){if(!l.value)return;const p=v.clientX-c.value,U=Math.max(a.minWidth,Math.min(a.maxWidth,d.value+p));r.value=U}function H(){l.value&&(l.value=!1,k(r.value),document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",H),document.body.style.userSelect="",document.body.style.cursor="")}function A(){r.value=a.defaultWidth,k(a.defaultWidth)}function y(){m.value=window.innerWidth,!g.value&&h.value&&(h.value=!1,n("mobile-overlay-change",!1))}function w(){g.value&&(h.value=!h.value,n("mobile-overlay-change",h.value))}function N(){h.value=!1,n("mobile-overlay-change",!1)}return e({toggleMobileOverlay:w,closeMobileOverlay:N}),fe(()=>{S(),window.addEventListener("resize",y)}),be(()=>{window.removeEventListener("resize",y),H()}),re(()=>a.defaultWidth,v=>{r.value===a.defaultWidth&&(r.value=v)}),(v,p)=>(u(),f("div",{class:se(["resizable-panel-container",{"mobile-overlay":g.value}])},[s("div",{class:se(["left-panel",{"overlay-visible":g.value&&h.value}]),style:ye(_.value)},[we(v.$slots,"left",{},void 0,!0)],6),g.value?R("",!0):(u(),f("div",{key:0,class:se(["resize-handle",{dragging:l.value}]),onMousedown:C,onDblclick:A},p[0]||(p[0]=[s("div",{class:"handle-bar"},null,-1)]),34)),s("div",va,[we(v.$slots,"right",{},void 0,!0)]),g.value&&h.value?(u(),f("div",{key:1,class:"mobile-overlay-bg",onClick:N})):R("",!0)],2))}}),ha=ae(ga,[["__scopeId","data-v-949e1df1"]]);function ya(){var o=window.navigator.userAgent,e=o.indexOf("MSIE ");if(e>0)return parseInt(o.substring(e+5,o.indexOf(".",e)),10);var t=o.indexOf("Trident/");if(t>0){var a=o.indexOf("rv:");return parseInt(o.substring(a+3,o.indexOf(".",a)),10)}var n=o.indexOf("Edge/");return n>0?parseInt(o.substring(n+5,o.indexOf(".",n)),10):-1}let Ve;function tt(){tt.init||(tt.init=!0,Ve=ya()!==-1)}var He={name:"ResizeObserver",props:{emitOnMount:{type:Boolean,default:!1},ignoreWidth:{type:Boolean,default:!1},ignoreHeight:{type:Boolean,default:!1}},emits:["notify"],mounted(){tt(),ke(()=>{this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitOnMount&&this.emitSize()});const o=document.createElement("object");this._resizeObject=o,o.setAttribute("aria-hidden","true"),o.setAttribute("tabindex",-1),o.onload=this.addResizeHandlers,o.type="text/html",Ve&&this.$el.appendChild(o),o.data="about:blank",Ve||this.$el.appendChild(o)},beforeUnmount(){this.removeResizeHandlers()},methods:{compareAndNotify(){(!this.ignoreWidth&&this._w!==this.$el.offsetWidth||!this.ignoreHeight&&this._h!==this.$el.offsetHeight)&&(this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitSize())},emitSize(){this.$emit("notify",{width:this._w,height:this._h})},addResizeHandlers(){this._resizeObject.contentDocument.defaultView.addEventListener("resize",this.compareAndNotify),this.compareAndNotify()},removeResizeHandlers(){this._resizeObject&&this._resizeObject.onload&&(!Ve&&this._resizeObject.contentDocument&&this._resizeObject.contentDocument.defaultView.removeEventListener("resize",this.compareAndNotify),this.$el.removeChild(this._resizeObject),this._resizeObject.onload=null,this._resizeObject=null)}}};const ba=Ts();bs("data-v-b329ee4c");const _a={class:"resize-observer",tabindex:"-1"};_s();const Ta=ba((o,e,t,a,n,r)=>(u(),K("div",_a)));He.render=Ta;He.__scopeId="data-v-b329ee4c";He.__file="src/components/ResizeObserver.vue";function De(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?De=function(e){return typeof e}:De=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},De(o)}function ka(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}function Ca(o,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(o,a.key,a)}}function $a(o,e,t){return e&&Ca(o.prototype,e),o}function _t(o){return wa(o)||Sa(o)||Ia(o)||Ea()}function wa(o){if(Array.isArray(o))return st(o)}function Sa(o){if(typeof Symbol<"u"&&Symbol.iterator in Object(o))return Array.from(o)}function Ia(o,e){if(o){if(typeof o=="string")return st(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return st(o,e)}}function st(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,a=new Array(e);t<e;t++)a[t]=o[t];return a}function Ea(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ra(o){var e;return typeof o=="function"?e={callback:o}:e=o,e}function Pa(o,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a,n,r,l=function(d){for(var m=arguments.length,h=new Array(m>1?m-1:0),g=1;g<m;g++)h[g-1]=arguments[g];if(r=h,!(a&&d===n)){var _=t.leading;typeof _=="function"&&(_=_(d,n)),(!a||d!==n)&&_&&o.apply(void 0,[d].concat(_t(r))),n=d,clearTimeout(a),a=setTimeout(function(){o.apply(void 0,[d].concat(_t(r))),a=0},e)}};return l._clear=function(){clearTimeout(a),a=null},l}function Kt(o,e){if(o===e)return!0;if(De(o)==="object"){for(var t in o)if(!Kt(o[t],e[t]))return!1;return!0}return!1}var Fa=(function(){function o(e,t,a){ka(this,o),this.el=e,this.observer=null,this.frozen=!1,this.createObserver(t,a)}return $a(o,[{key:"createObserver",value:function(t,a){var n=this;if(this.observer&&this.destroyObserver(),!this.frozen){if(this.options=Ra(t),this.callback=function(c,d){n.options.callback(c,d),c&&n.options.once&&(n.frozen=!0,n.destroyObserver())},this.callback&&this.options.throttle){var r=this.options.throttleOptions||{},l=r.leading;this.callback=Pa(this.callback,this.options.throttle,{leading:function(d){return l==="both"||l==="visible"&&d||l==="hidden"&&!d}})}this.oldResult=void 0,this.observer=new IntersectionObserver(function(c){var d=c[0];if(c.length>1){var m=c.find(function(g){return g.isIntersecting});m&&(d=m)}if(n.callback){var h=d.isIntersecting&&d.intersectionRatio>=n.threshold;if(h===n.oldResult)return;n.oldResult=h,n.callback(h,d)}},this.options.intersection),ke(function(){n.observer&&n.observer.observe(n.el)})}}},{key:"destroyObserver",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null),this.callback&&this.callback._clear&&(this.callback._clear(),this.callback=null)}},{key:"threshold",get:function(){return this.options.intersection&&typeof this.options.intersection.threshold=="number"?this.options.intersection.threshold:0}}]),o})();function Yt(o,e,t){var a=e.value;if(a)if(typeof IntersectionObserver>"u")console.warn("[vue-observe-visibility] IntersectionObserver API is not available in your browser. Please install this polyfill: https://github.com/w3c/IntersectionObserver/tree/master/polyfill");else{var n=new Fa(o,a,t);o._vue_visibilityState=n}}function xa(o,e,t){var a=e.value,n=e.oldValue;if(!Kt(a,n)){var r=o._vue_visibilityState;if(!a){Qt(o);return}r?r.createObserver(a,t):Yt(o,{value:a},t)}}function Qt(o){var e=o._vue_visibilityState;e&&(e.destroyObserver(),delete o._vue_visibilityState)}var Aa={beforeMount:Yt,updated:xa,unmounted:Qt},Oa={itemsLimit:1e3},Va=/(auto|scroll)/;function Zt(o,e){return o.parentNode===null?e:Zt(o.parentNode,e.concat([o]))}var Ye=function(e,t){return getComputedStyle(e,null).getPropertyValue(t)},Da=function(e){return Ye(e,"overflow")+Ye(e,"overflow-y")+Ye(e,"overflow-x")},Na=function(e){return Va.test(Da(e))};function Tt(o){if(o instanceof HTMLElement||o instanceof SVGElement){for(var e=Zt(o.parentNode,[]),t=0;t<e.length;t+=1)if(Na(e[t]))return e[t];return document.scrollingElement||document.documentElement}}function at(o){"@babel/helpers - typeof";return at=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},at(o)}var La={items:{type:Array,required:!0},keyField:{type:String,default:"id"},direction:{type:String,default:"vertical",validator:function(e){return["vertical","horizontal"].includes(e)}},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"}};function Ma(){return this.items.length&&at(this.items[0])!=="object"}var nt=!1;if(typeof window<"u"){nt=!1;try{var Ua=Object.defineProperty({},"passive",{get:function(){nt=!0}});window.addEventListener("test",null,Ua)}catch{}}let ja=0;var Ge={name:"RecycleScroller",components:{ResizeObserver:He},directives:{ObserveVisibility:Aa},props:{...La,itemSize:{type:Number,default:null},gridItems:{type:Number,default:void 0},itemSecondarySize:{type:Number,default:void 0},minItemSize:{type:[Number,String],default:null},sizeField:{type:String,default:"size"},typeField:{type:String,default:"type"},buffer:{type:Number,default:200},pageMode:{type:Boolean,default:!1},prerender:{type:Number,default:0},emitUpdate:{type:Boolean,default:!1},updateInterval:{type:Number,default:0},skipHover:{type:Boolean,default:!1},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},listClass:{type:[String,Object,Array],default:""},itemClass:{type:[String,Object,Array],default:""}},emits:["resize","visible","hidden","update","scroll-start","scroll-end"],data(){return{pool:[],totalSize:0,ready:!1,hoverKey:null}},computed:{sizes(){if(this.itemSize===null){const o={"-1":{accumulator:0}},e=this.items,t=this.sizeField,a=this.minItemSize;let n=1e4,r=0,l;for(let c=0,d=e.length;c<d;c++)l=e[c][t]||a,l<n&&(n=l),r+=l,o[c]={accumulator:r,size:l};return this.$_computedMinItemSize=n,o}return[]},simpleArray:Ma,itemIndexByKey(){const{keyField:o,items:e}=this,t={};for(let a=0,n=e.length;a<n;a++)t[e[a][o]]=a;return t}},watch:{items(){this.updateVisibleItems(!0)},pageMode(){this.applyPageMode(),this.updateVisibleItems(!1)},sizes:{handler(){this.updateVisibleItems(!1)},deep:!0},gridItems(){this.updateVisibleItems(!0)},itemSecondarySize(){this.updateVisibleItems(!0)}},created(){this.$_startIndex=0,this.$_endIndex=0,this.$_views=new Map,this.$_unusedViews=new Map,this.$_scrollDirty=!1,this.$_lastUpdateScrollPosition=0,this.prerender&&(this.$_prerender=!0,this.updateVisibleItems(!1)),this.gridItems&&!this.itemSize&&console.error("[vue-recycle-scroller] You must provide an itemSize when using gridItems")},mounted(){this.applyPageMode(),this.$nextTick(()=>{this.$_prerender=!1,this.updateVisibleItems(!0),this.ready=!0})},activated(){const o=this.$_lastUpdateScrollPosition;typeof o=="number"&&this.$nextTick(()=>{this.scrollToPosition(o)})},beforeUnmount(){this.removeListeners()},methods:{addView(o,e,t,a,n){const r=ks({id:ja++,index:e,used:!0,key:a,type:n}),l=Cs({item:t,position:0,nr:r});return o.push(l),l},unuseView(o,e=!1){const t=this.$_unusedViews,a=o.nr.type;let n=t.get(a);n||(n=[],t.set(a,n)),n.push(o),e||(o.nr.used=!1,o.position=-9999)},handleResize(){this.$emit("resize"),this.ready&&this.updateVisibleItems(!1)},handleScroll(o){if(!this.$_scrollDirty){if(this.$_scrollDirty=!0,this.$_updateTimeout)return;const e=()=>requestAnimationFrame(()=>{this.$_scrollDirty=!1;const{continuous:t}=this.updateVisibleItems(!1,!0);t||(clearTimeout(this.$_refreshTimout),this.$_refreshTimout=setTimeout(this.handleScroll,this.updateInterval+100))});e(),this.updateInterval&&(this.$_updateTimeout=setTimeout(()=>{this.$_updateTimeout=0,this.$_scrollDirty&&e()},this.updateInterval))}},handleVisibilityChange(o,e){this.ready&&(o||e.boundingClientRect.width!==0||e.boundingClientRect.height!==0?(this.$emit("visible"),requestAnimationFrame(()=>{this.updateVisibleItems(!1)})):this.$emit("hidden"))},updateVisibleItems(o,e=!1){const t=this.itemSize,a=this.gridItems||1,n=this.itemSecondarySize||t,r=this.$_computedMinItemSize,l=this.typeField,c=this.simpleArray?null:this.keyField,d=this.items,m=d.length,h=this.sizes,g=this.$_views,_=this.$_unusedViews,S=this.pool,k=this.itemIndexByKey;let C,D,H,A,y;if(!m)C=D=A=y=H=0;else if(this.$_prerender)C=A=0,D=y=Math.min(this.prerender,d.length),H=null;else{const i=this.getScroll();if(e){let E=i.start-this.$_lastUpdateScrollPosition;if(E<0&&(E=-E),t===null&&E<r||E<t)return{continuous:!0}}this.$_lastUpdateScrollPosition=i.start;const O=this.buffer;i.start-=O,i.end+=O;let I=0;if(this.$refs.before&&(I=this.$refs.before.scrollHeight,i.start-=I),this.$refs.after){const E=this.$refs.after.scrollHeight;i.end+=E}if(t===null){let E,G=0,V=m-1,Y=~~(m/2),b;do b=Y,E=h[Y].accumulator,E<i.start?G=Y:Y<m-1&&h[Y+1].accumulator>i.start&&(V=Y),Y=~~((G+V)/2);while(Y!==b);for(Y<0&&(Y=0),C=Y,H=h[m-1].accumulator,D=Y;D<m&&h[D].accumulator<i.end;D++);for(D===-1?D=d.length-1:(D++,D>m&&(D=m)),A=C;A<m&&I+h[A].accumulator<i.start;A++);for(y=A;y<m&&I+h[y].accumulator<i.end;y++);}else{C=~~(i.start/t*a);const E=C%a;C-=E,D=Math.ceil(i.end/t*a),A=Math.max(0,Math.floor((i.start-I)/t*a)),y=Math.floor((i.end-I)/t*a),C<0&&(C=0),D>m&&(D=m),A<0&&(A=0),y>m&&(y=m),H=Math.ceil(m/a)*t}}D-C>Oa.itemsLimit&&this.itemsLimitError(),this.totalSize=H;let w;const N=C<=this.$_endIndex&&D>=this.$_startIndex;if(N)for(let i=0,O=S.length;i<O;i++)w=S[i],w.nr.used&&(o&&(w.nr.index=k[w.item[c]]),(w.nr.index==null||w.nr.index<C||w.nr.index>=D)&&this.unuseView(w));const v=N?null:new Map;let p,U,x;for(let i=C;i<D;i++){p=d[i];const O=c?p[c]:p;if(O==null)throw new Error(`Key is ${O} on item (keyField is '${c}')`);if(w=g.get(O),!t&&!h[i].size){w&&this.unuseView(w);continue}U=p[l];let I=_.get(U),E=!1;if(!w)N?I&&I.length?w=I.pop():w=this.addView(S,i,p,O,U):(x=v.get(U)||0,(!I||x>=I.length)&&(w=this.addView(S,i,p,O,U),this.unuseView(w,!0),I=_.get(U)),w=I[x],v.set(U,x+1)),g.delete(w.nr.key),w.nr.used=!0,w.nr.index=i,w.nr.key=O,w.nr.type=U,g.set(O,w),E=!0;else if(!w.nr.used&&(w.nr.used=!0,E=!0,I)){const G=I.indexOf(w);G!==-1&&I.splice(G,1)}w.item=p,E&&(i===d.length-1&&this.$emit("scroll-end"),i===0&&this.$emit("scroll-start")),t===null?(w.position=h[i-1].accumulator,w.offset=0):(w.position=Math.floor(i/a)*t,w.offset=i%a*n)}return this.$_startIndex=C,this.$_endIndex=D,this.emitUpdate&&this.$emit("update",C,D,A,y),clearTimeout(this.$_sortTimer),this.$_sortTimer=setTimeout(this.sortViews,this.updateInterval+300),{continuous:N}},getListenerTarget(){let o=Tt(this.$el);return window.document&&(o===window.document.documentElement||o===window.document.body)&&(o=window),o},getScroll(){const{$el:o,direction:e}=this,t=e==="vertical";let a;if(this.pageMode){const n=o.getBoundingClientRect(),r=t?n.height:n.width;let l=-(t?n.top:n.left),c=t?window.innerHeight:window.innerWidth;l<0&&(c+=l,l=0),l+c>r&&(c=r-l),a={start:l,end:l+c}}else t?a={start:o.scrollTop,end:o.scrollTop+o.clientHeight}:a={start:o.scrollLeft,end:o.scrollLeft+o.clientWidth};return a},applyPageMode(){this.pageMode?this.addListeners():this.removeListeners()},addListeners(){this.listenerTarget=this.getListenerTarget(),this.listenerTarget.addEventListener("scroll",this.handleScroll,nt?{passive:!0}:!1),this.listenerTarget.addEventListener("resize",this.handleResize)},removeListeners(){this.listenerTarget&&(this.listenerTarget.removeEventListener("scroll",this.handleScroll),this.listenerTarget.removeEventListener("resize",this.handleResize),this.listenerTarget=null)},scrollToItem(o){let e;const t=this.gridItems||1;this.itemSize===null?e=o>0?this.sizes[o-1].accumulator:0:e=Math.floor(o/t)*this.itemSize,this.scrollToPosition(e)},scrollToPosition(o){const e=this.direction==="vertical"?{scroll:"scrollTop",start:"top"}:{scroll:"scrollLeft",start:"left"};let t,a,n;if(this.pageMode){const r=Tt(this.$el),l=r.tagName==="HTML"?0:r[e.scroll],c=r.getBoundingClientRect(),m=this.$el.getBoundingClientRect()[e.start]-c[e.start];t=r,a=e.scroll,n=o+l+m}else t=this.$el,a=e.scroll,n=o;t[a]=n},itemsLimitError(){throw setTimeout(()=>{this.$el}),new Error("Rendered items limit reached")},sortViews(){this.pool.sort((o,e)=>o.nr.index-e.nr.index)}}};const Ba={key:0,ref:"before",class:"vue-recycle-scroller__slot"},za={key:1,ref:"after",class:"vue-recycle-scroller__slot"};function Wa(o,e,t,a,n,r){const l=Pt("ResizeObserver"),c=Ft("observe-visibility");return Se((u(),f("div",{class:se(["vue-recycle-scroller",{ready:n.ready,"page-mode":t.pageMode,[`direction-${o.direction}`]:!0}]),onScrollPassive:e[0]||(e[0]=(...d)=>r.handleScroll&&r.handleScroll(...d))},[o.$slots.before?(u(),f("div",Ba,[we(o.$slots,"before")],512)):R("v-if",!0),(u(),K(ht(t.listTag),{ref:"wrapper",style:ye({[o.direction==="vertical"?"minHeight":"minWidth"]:n.totalSize+"px"}),class:se(["vue-recycle-scroller__item-wrapper",t.listClass])},{default:F(()=>[(u(!0),f(ee,null,te(n.pool,d=>(u(),K(ht(t.itemTag),$s({key:d.nr.id,style:n.ready?{transform:`translate${o.direction==="vertical"?"Y":"X"}(${d.position}px) translate${o.direction==="vertical"?"X":"Y"}(${d.offset}px)`,width:t.gridItems?`${o.direction==="vertical"&&t.itemSecondarySize||t.itemSize}px`:void 0,height:t.gridItems?`${o.direction==="horizontal"&&t.itemSecondarySize||t.itemSize}px`:void 0}:null,class:["vue-recycle-scroller__item-view",[t.itemClass,{hover:!t.skipHover&&n.hoverKey===d.nr.key}]]},ws(t.skipHover?{}:{mouseenter:()=>{n.hoverKey=d.nr.key},mouseleave:()=>{n.hoverKey=null}})),{default:F(()=>[we(o.$slots,"default",{item:d.item,index:d.nr.index,active:d.nr.used})]),_:2},1040,["style","class"]))),128)),we(o.$slots,"empty")]),_:3},8,["style","class"])),o.$slots.after?(u(),f("div",za,[we(o.$slots,"after")],512)):R("v-if",!0),$(l,{onNotify:r.handleResize},null,8,["onNotify"])],34)),[[c,r.handleVisibilityChange]])}Ge.render=Wa;Ge.__file="src/components/RecycleScroller.vue";const Ha={class:"trial-list-search"},Ga=["value"],qa=ne({__name:"TrialListSearch",props:{modelValue:{}},emits:["update:modelValue"],setup(o,{emit:e}){const t=e,a=q(),n=Jt(m=>{t("update:modelValue",m)},300);function r(m){const h=m.target.value;n(h)}function l(){t("update:modelValue",""),a.value?.focus()}function c(){a.value?.focus(),a.value?.select()}function d(m){m.type==="focus-trial-search"&&c()}return fe(()=>{window.addEventListener("focus-trial-search",d)}),be(()=>{window.removeEventListener("focus-trial-search",d)}),(m,h)=>(u(),f("div",Ha,[$(z(Dt),{class:"search-icon"}),s("input",{ref_key:"searchInput",ref:a,type:"text",class:"search-input",placeholder:"Filter trials...",value:m.modelValue,onInput:r,onKeydown:Ze(l,["escape"])},null,40,Ga),m.modelValue?(u(),K(z(Nt),{key:0,class:"clear-icon",onClick:l})):R("",!0)]))}}),Ja=ae(qa,[["__scopeId","data-v-3a032c2b"]]),Xa={class:"item-content"},Ka={class:"item-header"},Ya=["title"],Qa={key:0,class:"progress-bar"},Za={class:"item-metadata"},en={class:"meta-item"},tn={class:"meta-item"},sn={key:0,class:"meta-separator"},an={key:1,class:"meta-item cost"},nn=ne({__name:"TrialListItem",props:{trial:{},selected:{type:Boolean}},emits:["click"],setup(o){const e=o,{calculateTemplateTokens:t,calculatePromptTokens:a,estimateTotalCost:n,sumEstimates:r,formatCost:l}=mt(),c=j(()=>{if(e.trial.progress.total===0)return 0;const g=e.trial.progress.completed+e.trial.progress.failed;return Math.round(g/e.trial.progress.total*100)}),d=j(()=>{const{completed:g,failed:_,total:S}=e.trial.progress;return e.trial.status==="draft"?`${S} tasks`:`${g+_}/${S} tasks`}),m=j(()=>{const g=e.trial.started||e.trial.created;if(!g)return"";const S=new Date().getTime()-g.getTime(),k=Math.floor(S/1e3),C=Math.floor(k/60),D=Math.floor(C/60),H=Math.floor(D/24);return k<60?"now":C<60?`${C}m`:D<24?`${D}h`:`${H}d`}),h=j(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let g=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)g=t(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const k=a(e.trial.spreadsheetConfig.promptPattern),C=e.trial.progress.total/e.trial.configurations.length;g={totalTokens:k*C,combinationCount:C,perCallAverage:k}}else if(e.trial.type==="playground")return null;if(!g||g.totalTokens===0)return null;const _=e.trial.configurations.map(k=>{const C=k.modelSnapshot;return C?n(g.totalTokens,g.combinationCount,C,k.parameters):null}).filter(Boolean);if(_.length===0)return null;const S=r(_);return`$${l(S,"compact")} total`});return(g,_)=>(u(),f("div",{class:se(["trial-list-item",{selected:g.selected,"has-progress":g.trial.status==="running"}]),onClick:_[0]||(_[0]=S=>g.$emit("click"))},[s("div",{class:se(["status-indicator",`status-${g.trial.status}`])},null,2),s("div",Xa,[s("div",Ka,[s("span",{class:"trial-name",title:g.trial.name},T(g.trial.name),9,Ya),s("span",{class:se(["status-tag",`status-${g.trial.status}`])},T(g.trial.status.toUpperCase()),3)]),g.trial.status==="running"?(u(),f("div",Qa,[s("div",{class:"progress-fill",style:ye({width:`${c.value}%`})},null,4)])):R("",!0),s("div",Za,[s("span",en,T(d.value),1),_[1]||(_[1]=s("span",{class:"meta-separator"},"•",-1)),s("span",tn,T(m.value),1),h.value?(u(),f("span",sn,"•")):R("",!0),h.value?(u(),f("span",an,T(h.value),1)):R("",!0)])])],2))}}),kt=ae(nn,[["__scopeId","data-v-67909aef"]]),rn={class:"section-title"},on=ne({__name:"TrialListSection",props:{title:{},background:{type:Boolean}},setup(o){return(e,t)=>(u(),f("div",{class:se(["trial-list-section",{"with-background":e.background}])},[s("span",rn,T(e.title),1)],2))}}),Ct=ae(on,[["__scopeId","data-v-07a26c58"]]),ln={class:"panel-header"},un={class:"header-title"},dn={key:0,class:"title-text"},cn={class:"trial-count"},pn={key:0,class:"header-actions"},fn={class:"filter-count"},mn={class:"filter-count"},vn={class:"filter-count"},gn={class:"filter-count"},hn={class:"filter-count"},yn={key:1,class:"status-tabs"},bn={class:"tab-count"},_n={class:"tab-count"},Tn={class:"tab-count"},kn={class:"trial-list-container"},Cn={key:1,class:"trial-list"},$n={key:2,class:"collapsed-list"},wn=["onClick"],Sn={class:"collapsed-count"},In={key:3,class:"empty-state"},En=ne({__name:"TrialListPanelV3",props:{trials:{},selectedTrialId:{},searchQuery:{},filterStatus:{}},emits:["select-trial","create-trial","import-trial","update-search","update-filter","refresh"],setup(o,{emit:e}){const t=o,a=e,n=q(!1),r=q("all"),l=q(250),c=j(()=>l.value<50),d=j(()=>t.trials.filter(v=>v.status==="running"||v.status==="paused").length),m=j(()=>t.trials.filter(v=>v.status==="completed"||v.status==="failed").length),h=j(()=>{let v=t.trials;if(t.searchQuery){const i=t.searchQuery.toLowerCase();v=v.filter(O=>{const I=O.name.toLowerCase().includes(i),E=O.templateConfig?.template?.toLowerCase().includes(i),G=O.configurations.some(V=>V.modelId.toLowerCase().includes(i)||V.provider.toLowerCase().includes(i));return I||E||G})}t.filterStatus!=="all"&&(v=v.filter(i=>i.status===t.filterStatus)),r.value==="active"?v=v.filter(i=>i.status==="running"||i.status==="paused"):r.value==="done"&&(v=v.filter(i=>i.status==="completed"||i.status==="failed"));const p=v.filter(i=>i.status==="running"),U=v.filter(i=>i.status!=="running"),x=[];return p.length>0&&(x.push({type:"section",title:"RUNNING",background:!0,id:"section-running"}),x.push(...p.sort((i,O)=>(O.started?.getTime()||0)-(i.started?.getTime()||0)))),U.length>0&&(p.length>0&&x.push({type:"section",title:"RECENT",background:!1,id:"section-recent"}),x.push(...U.sort((i,O)=>(O.created?.getTime()||0)-(i.created?.getTime()||0)))),x}),g=j(()=>h.value.map(v=>({...v,height:H(v)}))),_=j(()=>t.trials.filter(v=>r.value==="active"?v.status==="running"||v.status==="paused":r.value==="done"?v.status==="completed"||v.status==="failed":!0)),S=j(()=>t.searchQuery?"No trials found":t.filterStatus==="running"?"No trials are currently running":"No trials found"),k=j(()=>t.searchQuery?"No trials match your search":t.filterStatus!=="all"?`No ${t.filterStatus} trials`:"Create your first trial to get started"),C=j(()=>t.filterStatus==="all"&&!t.searchQuery);function D(v){return t.trials.filter(p=>p.status===v).length}function H(v){if(v.type==="section")return 32;const p=v.status==="running",U=v.configurations?.some(x=>x.repeatCount>1);return p||U?96:80}function A(v){const p=v.progress.completed+v.progress.failed;return v.status==="running"?`${Math.round(p/v.progress.total*100)}%`:p.toString()}async function y(){n.value=!0;try{await new Promise(v=>setTimeout(v,500)),a("refresh")}finally{n.value=!1}}function w({key:v}){a("update-filter",v)}function N(){const v=document.querySelector(".trial-list-panel");v&&(l.value=v.clientWidth)}return fe(()=>{N(),window.addEventListener("resize",N);const v=document.querySelector(".trial-list-panel");v&&new ResizeObserver(()=>N()).observe(v)}),be(()=>{window.removeEventListener("resize",N)}),(v,p)=>{const U=me,x=ct,i=As,O=dt,I=ut;return u(),f("div",{class:se(["trial-list-panel",{collapsed:c.value}])},[s("div",ln,[s("div",un,[$(z(Rs),{class:"title-icon"}),c.value?R("",!0):(u(),f("span",dn,"Trials")),s("span",cn,T(v.trials.length),1)]),c.value?R("",!0):(u(),f("div",pn,[$(U,{type:"primary",size:"small",onClick:p[0]||(p[0]=E=>v.$emit("create-trial"))},{default:F(()=>[$(z(Ps)),p[7]||(p[7]=L(" New Trial "))]),_:1,__:[7]}),$(U,{size:"small",onClick:p[1]||(p[1]=E=>v.$emit("import-trial"))},{default:F(()=>[$(z(Lt)),p[8]||(p[8]=L(" Import "))]),_:1,__:[8]}),$(U,{size:"small",onClick:y,loading:n.value},{default:F(()=>[$(z(Fs),{spin:n.value},null,8,["spin"])]),_:1},8,["loading"]),$(I,null,{overlay:F(()=>[$(O,{onClick:w},{default:F(()=>[$(x,{key:"all"},{default:F(()=>p[9]||(p[9]=[s("span",null,"All Trials",-1)])),_:1,__:[9]}),$(i),$(x,{key:"running"},{default:F(()=>[p[10]||(p[10]=s("span",null,"Running Only",-1)),s("span",fn,T(D("running")),1)]),_:1,__:[10]}),$(x,{key:"completed"},{default:F(()=>[p[11]||(p[11]=s("span",null,"Completed Only",-1)),s("span",mn,T(D("completed")),1)]),_:1,__:[11]}),$(x,{key:"failed"},{default:F(()=>[p[12]||(p[12]=s("span",null,"Failed Only",-1)),s("span",vn,T(D("failed")),1)]),_:1,__:[12]}),$(x,{key:"paused"},{default:F(()=>[p[13]||(p[13]=s("span",null,"Paused Only",-1)),s("span",gn,T(D("paused")),1)]),_:1,__:[13]}),$(x,{key:"draft"},{default:F(()=>[p[14]||(p[14]=s("span",null,"Draft Only",-1)),s("span",hn,T(D("draft")),1)]),_:1,__:[14]})]),_:1})]),default:F(()=>[$(U,{size:"small"},{default:F(()=>[$(z(xs))]),_:1})]),_:1})]))]),c.value?R("",!0):(u(),K(Ja,{key:0,"model-value":v.searchQuery,"onUpdate:modelValue":p[2]||(p[2]=E=>v.$emit("update-search",E))},null,8,["model-value"])),c.value?R("",!0):(u(),f("div",yn,[s("div",{class:se(["status-tab",{active:r.value==="all"}]),onClick:p[3]||(p[3]=E=>r.value="all")},[p[15]||(p[15]=s("span",{class:"tab-icon"},"📊",-1)),p[16]||(p[16]=s("span",{class:"tab-label"},"ALL",-1)),s("span",bn,T(v.trials.length),1)],2),s("div",{class:se(["status-tab",{active:r.value==="active"}]),onClick:p[4]||(p[4]=E=>r.value="active")},[p[17]||(p[17]=s("span",{class:"tab-icon"},"🟢",-1)),p[18]||(p[18]=s("span",{class:"tab-label"},"Active",-1)),s("span",_n,T(d.value),1)],2),s("div",{class:se(["status-tab",{active:r.value==="done"}]),onClick:p[5]||(p[5]=E=>r.value="done")},[p[19]||(p[19]=s("span",{class:"tab-icon"},"✅",-1)),p[20]||(p[20]=s("span",{class:"tab-label"},"Done",-1)),s("span",Tn,T(m.value),1)],2)])),s("div",kn,[!c.value&&h.value.length>100?(u(),K(z(Ge),{key:0,class:"trial-list virtual-list",items:g.value,"size-field":"height","key-field":"id",buffer:10},{default:F(({item:E})=>[E.type==="section"?(u(),K(Ct,{key:0,title:E.title,background:E.background},null,8,["title","background"])):(u(),K(kt,{key:1,trial:E,selected:E.id===v.selectedTrialId,"data-trial-id":E.id,onClick:G=>v.$emit("select-trial",E.id)},null,8,["trial","selected","data-trial-id","onClick"]))]),_:1},8,["items"])):c.value?(u(),f("div",$n,[(u(!0),f(ee,null,te(_.value,E=>(u(),f("div",{key:E.id,class:se(["collapsed-item",{selected:E.id===v.selectedTrialId}]),onClick:G=>v.$emit("select-trial",E.id)},[s("div",{class:se(["status-dot",`status-${E.status}`])},null,2),s("span",Sn,T(A(E)),1)],10,wn))),128))])):(u(),f("div",Cn,[(u(!0),f(ee,null,te(h.value,(E,G)=>(u(),f(ee,{key:E.id||`section-${G}`},[E.type==="section"?(u(),K(Ct,{key:0,title:E.title,background:E.background},null,8,["title","background"])):(u(),K(kt,{key:1,trial:E,selected:E.id===v.selectedTrialId,"data-trial-id":E.id,onClick:V=>v.$emit("select-trial",E.id)},null,8,["trial","selected","data-trial-id","onClick"]))],64))),128))])),h.value.length===0&&!c.value?(u(),f("div",In,[$(z(Mt),{class:"empty-icon"}),s("h3",null,T(S.value),1),s("p",null,T(k.value),1),C.value?(u(),K(U,{key:0,type:"primary",size:"large",onClick:p[6]||(p[6]=E=>v.$emit("create-trial"))},{default:F(()=>p[21]||(p[21]=[L(" Create New Trial ")])),_:1,__:[21]})):R("",!0)])):R("",!0)])],2)}}}),Rn=ae(En,[["__scopeId","data-v-ad2a17cf"]]),Pn={class:"trial-header"},Fn={class:"header-main"},xn={class:"header-title"},An={class:"trial-name"},On={key:0,class:"progress-container"},Vn={class:"progress-bar"},Dn={class:"progress-stats-inline"},Nn={class:"progress-text"},Ln={key:0,class:"progress-stat"},Mn={class:"stat-number"},Un={key:1,class:"progress-stat"},jn={class:"stat-number"},Bn={key:2,class:"progress-stat"},zn={class:"stat-number"},Wn=ne({__name:"TrialHeaderV3",props:{trial:{},progress:{},isExecuting:{type:Boolean}},setup(o){const e=o,t=j(()=>{let k=e.trial.name;return k=k.replace(/\s*-\s*\d{1,2}\/\d{1,2}\/\d{4}$/,""),k=k.replace(/\s*\(Copy\)(\s*\(Copy\))*/g,""),k.trim()}),a=j(()=>!0),n=j(()=>e.progress?e.progress.completed+e.progress.failed:0),r=j(()=>{if(!e.progress||e.progress.total===0)return 0;const k=e.progress.completed+e.progress.failed;return Math.round(k/e.progress.total*100)}),l=j(()=>{const k=e.trial.started||e.trial.created;if(!k)return"0m";let C;if(e.trial.status==="draft")return"0m";e.trial.completed?C=e.trial.completed:C=new Date;const D=C.getTime()-k.getTime(),H=Math.floor(D/(1e3*60*60)),A=Math.floor(D%(1e3*60*60)/(1e3*60));return H>0?`${H}h ${A}m`:`${A}m`}),c=j(()=>{if(!e.progress?.avgLatencyMs)return null;const k=e.progress.avgLatencyMs;return k<1e3?`${Math.round(k)}ms`:`${(k/1e3).toFixed(1)}s`}),{calculateTemplateTokens:d,calculatePromptTokens:m,estimateTotalCost:h,sumEstimates:g,formatCost:_}=mt();j(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let k=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)k=d(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const H=m(e.trial.spreadsheetConfig.promptPattern),y=(e.progress?.total||e.trial.progress.total)/e.trial.configurations.length;k={totalTokens:H*y,combinationCount:y,perCallAverage:H}}else if(e.trial.type==="playground")return null;if(!k||k.totalTokens===0)return null;const C=e.trial.configurations.map(H=>{const A=H.modelSnapshot;return A?h(k.totalTokens,k.combinationCount,A,H.parameters):null}).filter(Boolean);if(C.length===0)return null;const D=g(C);return`${_(D,"compact")} total`});const S=j(()=>{if(e.trial.status!=="running"||!e.progress||e.progress.completed===0)return null;const C=(Date.now()-(e.trial.started?.getTime()||0))/e.progress.completed,D=e.progress.pending*C,H=Math.floor(D/(1e3*60)),A=Math.floor(D%(1e3*60)/1e3);if(H>60){const y=Math.floor(H/60),w=H%60;return`${y}h ${w}m`}return`${H}m ${A}s`});return(k,C)=>(u(),f("div",Pn,[s("div",Fn,[s("div",xn,[s("h2",An,T(t.value),1),s("span",{class:se(["status-tag",`status-${k.trial.status}`])},T(k.trial.status.toUpperCase()),3)]),a.value?(u(),f("div",On,[s("div",Vn,[s("div",{class:"progress-fill",style:ye({width:`${r.value}%`})},null,4)]),s("div",Dn,[s("span",Nn,T(n.value)+"/"+T(k.progress?.total||0)+" ("+T(r.value)+"%) ",1),l.value?(u(),f("span",Ln,[C[0]||(C[0]=s("span",{class:"stat-label"},"Duration:",-1)),C[1]||(C[1]=L()),s("span",Mn,T(l.value),1)])):R("",!0),c.value?(u(),f("span",Un,[C[2]||(C[2]=s("span",{class:"stat-label"},"Avg:",-1)),C[3]||(C[3]=L()),s("span",jn,T(c.value),1)])):R("",!0),S.value?(u(),f("span",Bn,[C[4]||(C[4]=s("span",{class:"stat-label"},"Remaining:",-1)),C[5]||(C[5]=L()),s("span",zn,"~"+T(S.value),1)])):R("",!0)])])):R("",!0)]),R("",!0)]))}}),Hn=ae(Wn,[["__scopeId","data-v-65916275"]]),Gn={class:"trial-actions"},qn={class:"action-group execution-controls"},Jn={class:"action-group data-actions"},Xn={class:"action-group management-actions"},Kn=ne({__name:"TrialActionsV3",props:{trial:{},isLeader:{type:Boolean},executionState:{}},emits:["start","pause","resume","cancel","duplicate","edit","delete","export-data","export-python","refresh"],setup(o,{emit:e}){const t=o,a=e,n=q(!1),r=q(!1),l=q(!1);j(()=>t.executionState?.currentTrialId===t.trial.id);const c=j(()=>["draft","failed","cancelled"].includes(t.trial.status)),d=j(()=>t.trial.status==="running"),m=j(()=>t.trial.status==="paused"),h=j(()=>["running","paused"].includes(t.trial.status));function g(){a("start")}async function _(){n.value=!0,r.value=!1,a("pause"),setTimeout(()=>{n.value=!1},1e3)}async function S(){r.value=!0,n.value=!1,a("resume"),setTimeout(()=>{r.value=!1},3e3)}function k(){Ce.confirm({title:"Cancel trial?",content:"This will stop all pending API calls.",okText:"Cancel Trial",okType:"danger",onOk:()=>a("cancel")})}async function C(){l.value=!0,a("refresh"),setTimeout(()=>{l.value=!1},500)}function D({key:w}){w==="data"?a("export-data"):w==="python"&&a("export-python")}function H(){a("duplicate")}function A(){a("edit")}function y(){const w=t.trial.progress.total;Ce.confirm({title:"Delete trial?",content:`Delete trial and all ${w} API calls?`,okText:"Delete",okType:"danger",cancelText:"Cancel",onOk:()=>{a("delete")}})}return(w,N)=>{const v=me,p=ct,U=dt,x=ut;return u(),f("div",Gn,[s("div",qn,[c.value?(u(),K(v,{key:0,type:"primary",size:"large",disabled:!w.isLeader,onClick:g},{default:F(()=>[$(z(yt)),N[0]||(N[0]=L(" Start Trial "))]),_:1,__:[0]},8,["disabled"])):R("",!0),d.value?(u(),K(v,{key:1,size:"large",disabled:!w.isLeader,loading:n.value,onClick:_},{default:F(()=>[n.value?R("",!0):(u(),K(z(Os),{key:0})),L(" "+T(n.value?"Pausing...":"Pause"),1)]),_:1},8,["disabled","loading"])):R("",!0),m.value?(u(),K(v,{key:2,type:"primary",size:"large",disabled:!w.isLeader||r.value,loading:r.value,onClick:S},{default:F(()=>[r.value?R("",!0):(u(),K(z(yt),{key:0})),L(" "+T(r.value?"Resuming...":"Resume"),1)]),_:1},8,["disabled","loading"])):R("",!0),h.value?(u(),K(v,{key:3,danger:"",size:"large",disabled:!w.isLeader,onClick:k},{default:F(()=>[$(z(Vs)),N[1]||(N[1]=L(" Cancel "))]),_:1,__:[1]},8,["disabled"])):R("",!0)]),s("div",Jn,[$(v,{size:"large",loading:l.value,onClick:C,title:"Refresh trial data from database"},{default:F(()=>[l.value?(u(),K(z(Ut),{key:1,spin:""})):(u(),K(z(Ds),{key:0})),L(" "+T(l.value?"Refreshing...":"Refresh"),1)]),_:1},8,["loading"]),$(x,null,{overlay:F(()=>[$(U,{onClick:D},{default:F(()=>[$(p,{key:"data"},{default:F(()=>[$(z(Ls)),N[3]||(N[3]=L(" Export Data "))]),_:1,__:[3]}),$(p,{key:"python"},{default:F(()=>[$(z(Ms)),N[4]||(N[4]=L(" Export Python Script "))]),_:1,__:[4]})]),_:1})]),default:F(()=>[$(v,{size:"large"},{default:F(()=>[N[2]||(N[2]=L(" Export ")),$(z(Ns))]),_:1,__:[2]})]),_:1})]),s("div",Xn,[$(v,{size:"large",disabled:!w.isLeader,onClick:H},{default:F(()=>[$(z(pt)),N[5]||(N[5]=L(" Duplicate "))]),_:1,__:[5]},8,["disabled"]),w.trial.status==="draft"?(u(),K(v,{key:0,size:"large",disabled:!w.isLeader,onClick:A},{default:F(()=>[$(z(Us)),N[6]||(N[6]=L(" Edit "))]),_:1,__:[6]},8,["disabled"])):R("",!0),$(v,{danger:"",size:"large",disabled:!w.isLeader,onClick:y},{default:F(()=>[$(z(js)),N[7]||(N[7]=L(" Delete "))]),_:1,__:[7]},8,["disabled"])])])}}}),Yn=ae(Kn,[["__scopeId","data-v-e642c431"]]),Qn={class:"snapshot-debug"},Zn={class:"debug-header"},er={class:"status-row"},tr={key:0,class:"badge success"},sr={key:1,class:"badge warning"},ar={key:0,class:"status-row"},nr={key:0,class:"variables-section"},rr={class:"variable-header"},or={class:"var-name"},ir={class:"var-type"},lr={key:0,class:"snapshot-content"},ur={class:"snapshot-meta"},dr={key:0},cr={class:"snapshot-items"},pr={class:"items-preview"},fr={class:"item-index"},mr={class:"item-value"},vr={key:0,class:"item-attrs"},gr={key:0,class:"more-indicator"},hr={key:1,class:"no-snapshot"},yr={key:0},br={key:1,class:"legacy-warning"},_r={class:"debug-footer"},Tr=ne({__name:"SnapshotDebugModal",props:{visible:{type:Boolean},trial:{},migrating:{type:Boolean}},emits:["close","migrate"],setup(o){const e=o,t=j(()=>e.trial.templateConfig?.hasSnapshots===!0),a=j(()=>e.trial.templateConfig?.variables||{});function n(m){return"snapshot"in m&&m.snapshot!=null}function r(m){return m.snapshot}function l(m){return n(m)?`${r(m).source.type} (snapshot)`:m.type==="value"?"Direct values":m.type==="list"?"List reference":"Unknown"}function c(){for(const m of Object.values(a.value))if(n(m)){const h=r(m);if(h.source?.snapshotDate)return new Date(h.source.snapshotDate).toLocaleString()}return"Unknown"}function d(){const m={trialId:e.trial.id,trialName:e.trial.name,hasSnapshots:t.value,variables:a.value};navigator.clipboard.writeText(JSON.stringify(m,null,2)),Z.success("Debug info copied to clipboard")}return(m,h)=>{const g=ft,_=ze,S=me,k=Ce;return u(),K(k,{visible:m.visible,title:"Variable Snapshot Debug View",width:"80%",footer:null,onCancel:h[2]||(h[2]=C=>m.$emit("close"))},{default:F(()=>[s("div",Qn,[s("div",Zn,[s("div",er,[h[5]||(h[5]=s("span",{class:"label"},"Snapshot Status:",-1)),t.value?(u(),f("span",tr,[$(z(jt)),h[3]||(h[3]=L(" Snapshots Enabled "))])):(u(),f("span",sr,[$(z(Pe)),h[4]||(h[4]=L(" Legacy Mode (No Snapshots) "))]))]),t.value?(u(),f("div",ar,[h[6]||(h[6]=s("span",{class:"label"},"Snapshot Date:",-1)),s("span",null,T(c()),1)])):R("",!0)]),t.value?(u(),f("div",nr,[h[8]||(h[8]=s("h3",null,"Variable Snapshots",-1)),(u(!0),f(ee,null,te(a.value,(C,D)=>(u(),f("div",{key:D,class:"variable-card"},[s("div",rr,[s("span",or,T(D),1),s("span",ir,T(l(C)),1)]),n(C)?(u(),f("div",lr,[s("div",ur,[s("span",null,"Source: "+T(r(C).source.type),1),r(C).source.listName?(u(),f("span",dr," List: "+T(r(C).source.listName),1)):R("",!0),s("span",null,"Items: "+T(r(C).items.length),1)]),s("div",cr,[s("div",pr,[(u(!0),f(ee,null,te(r(C).items.slice(0,5),(H,A)=>(u(),f("div",{key:A,class:"item-row"},[s("span",fr,T(A+1)+".",1),s("span",mr,T(H.value),1),H.attributes&&Object.keys(H.attributes).length>0?(u(),f("span",vr,[(u(!0),f(ee,null,te(H.attributes,(y,w)=>(u(),K(g,{key:w,size:"small"},{default:F(()=>[L(T(w)+": "+T(y),1)]),_:2},1024))),128))])):R("",!0)]))),128)),r(C).items.length>5?(u(),f("div",gr," ... and "+T(r(C).items.length-5)+" more items ",1)):R("",!0)])])])):(u(),f("div",hr,[$(z(Pe)),h[7]||(h[7]=L(" No snapshot - using live reference ")),C.listId?(u(),f("span",yr,"List ID: "+T(C.listId),1)):R("",!0)]))]))),128))])):(u(),f("div",br,[$(_,{message:"Legacy Trial",description:"This trial was created before snapshots were implemented. Variable lists are loaded dynamically from the database, which means changes to lists will affect trial duplication.",type:"warning","show-icon":""}),$(S,{type:"primary",onClick:h[0]||(h[0]=C=>m.$emit("migrate")),loading:m.migrating,style:{"margin-top":"16px"}},{default:F(()=>[$(z(Bs)),h[9]||(h[9]=L(" Migrate to Snapshots "))]),_:1,__:[9]},8,["loading"])])),s("div",_r,[$(S,{onClick:d},{default:F(()=>[$(z(pt)),h[10]||(h[10]=L(" Copy Debug Info "))]),_:1,__:[10]}),$(S,{onClick:h[1]||(h[1]=C=>m.$emit("close"))},{default:F(()=>h[11]||(h[11]=[L("Close")])),_:1,__:[11]})])])]),_:1},8,["visible"])}}}),kr=ae(Tr,[["__scopeId","data-v-726379cc"]]),Cr={class:"trial-detail-view"},$r={key:0,class:"detail-content"},wr={class:"detail-section"},Sr={class:"detail-grid"},Ir={class:"detail-item"},Er={key:0,class:"detail-item"},Rr={key:1,class:"detail-item"},Pr={class:"detail-item"},Fr={class:"detail-item"},xr={class:"detail-section"},Ar={class:"detail-grid"},Or={key:0,class:"detail-item full-width"},Vr={key:1,class:"detail-item full-width"},Dr={class:"detail-item"},Nr={class:"detail-item"},Lr={style:{display:"flex","align-items":"center",gap:"8px"}},Mr={key:0,class:"snapshot-badge success"},Ur={key:1,class:"snapshot-badge warning"},jr={class:"detail-item"},Br={key:2,class:"detail-item"},zr={key:0,class:"detail-section"},Wr={class:"detail-grid"},Hr={class:"detail-item"},Gr={class:"detail-item"},qr={class:"detail-item"},Jr={class:"detail-section"},Xr={class:"model-configs"},Kr={class:"config-header"},Yr=["src","alt"],Qr={class:"provider-name"},Zr={class:"config-details"},eo={class:"config-item"},to={class:"config-params"},so={class:"param-list"},ao={key:0,class:"config-item"},no={class:"cost"},ro=ne({__name:"TrialDetailView",props:{trial:{},isCollapsed:{type:Boolean}},emits:["toggle-collapse"],setup(o){const e=o,t=q(!1),a=j(()=>{const A=e.trial.started||e.trial.created,w=(e.trial.completed||new Date).getTime()-A.getTime(),N=Math.floor(w/(1e3*60*60)),v=Math.floor(w%(1e3*60*60)/(1e3*60));return N>0?`${N}h ${v}m`:`${v}m`}),n=j(()=>({draft:"Not started",pending:"Waiting to start",running:"Executing API calls",paused:"Execution paused",completed:"All calls completed",failed:"Execution failed",cancelled:"Execution cancelled"})[e.trial.status]||e.trial.status),r=j(()=>e.trial.type==="template"&&e.trial.templateConfig?.variables?Object.keys(e.trial.templateConfig.variables).length:0),l=j(()=>Math.round(e.trial.progress.total*750)),c=j(()=>e.trial.type==="template"&&e.trial.templateConfig?e.trial.templateConfig.hasSnapshots===!0:!1),d=j(()=>"text"),m=j(()=>1),h=j(()=>e.trial.progress.total/m.value);function g(A){return A?new Date(A).toLocaleString():"N/A"}function _(){if(e.trial.templateConfig?.templateName)return e.trial.templateConfig.templateName;const A=e.trial.templateConfig?.template||"Unknown Template";return A.length>50?A.substring(0,50)+"...":A}function S(){return e.trial.spreadsheetConfig?.datasetId||"Unknown Dataset"}function k(A){return{"openai-chat":"OpenAI","anthropic-messages":"Anthropic",openrouter:"OpenRouter","ollama-chat":"Ollama","ollama-generate":"Ollama"}[A]||A}function C(A){}async function D(){try{Z.info("Migration feature coming soon"),t.value=!1}catch(A){Z.error("Failed to migrate trial"),P.error("Migration error:",A)}}function H(A){const y=A.modelSnapshot;return y?.capabilities?.inputCostPerToken?`$${((y.capabilities.inputCostPerToken+y.capabilities.outputCostPerToken)*1e3).toFixed(4)}/1k tokens`:null}return(A,y)=>{const w=me;return u(),f("div",Cr,[s("div",{class:"detail-header",onClick:y[0]||(y[0]=N=>A.$emit("toggle-collapse"))},[y[3]||(y[3]=s("h3",null,"Trial Details",-1)),$(z(zs),{class:se(["collapse-icon",{rotated:A.isCollapsed}])},null,8,["class"])]),A.isCollapsed?R("",!0):(u(),f("div",$r,[s("div",wr,[y[9]||(y[9]=s("h4",null,"Basic Information",-1)),s("div",Sr,[s("div",Ir,[y[4]||(y[4]=s("label",null,"Created:",-1)),s("span",null,T(g(A.trial.created)),1)]),A.trial.started?(u(),f("div",Er,[y[5]||(y[5]=s("label",null,"Started:",-1)),s("span",null,T(g(A.trial.started)),1)])):R("",!0),A.trial.completed?(u(),f("div",Rr,[y[6]||(y[6]=s("label",null,"Completed:",-1)),s("span",null,T(g(A.trial.completed)),1)])):R("",!0),s("div",Pr,[y[7]||(y[7]=s("label",null,"Duration:",-1)),s("span",null,T(a.value),1)]),s("div",Fr,[y[8]||(y[8]=s("label",null,"Status:",-1)),s("span",null,T(A.trial.status)+" - "+T(n.value),1)])])]),s("div",xr,[y[19]||(y[19]=s("h4",null,"Configuration",-1)),s("div",Ar,[A.trial.type==="template"?(u(),f("div",Or,[y[10]||(y[10]=s("label",null,"Template:",-1)),s("span",null,T(_()),1)])):R("",!0),A.trial.type==="spreadsheet"?(u(),f("div",Vr,[y[11]||(y[11]=s("label",null,"Dataset:",-1)),s("span",null,T(S()),1)])):R("",!0),s("div",Dr,[y[12]||(y[12]=s("label",null,"Variable Lists:",-1)),s("span",null,T(r.value)+" lists",1)]),s("div",Nr,[y[16]||(y[16]=s("label",null,"Data Snapshot:",-1)),s("div",Lr,[c.value?(u(),f("span",Mr,[$(z(jt)),y[13]||(y[13]=L(" Captured "))])):(u(),f("span",Ur,[$(z(Pe)),y[14]||(y[14]=L(" Live Reference "))])),A.trial.type==="template"?(u(),K(w,{key:2,size:"small",type:"link",onClick:y[1]||(y[1]=N=>t.value=!0)},{default:F(()=>[$(z(Bt)),y[15]||(y[15]=L(" Debug "))]),_:1,__:[15]})):R("",!0)])]),s("div",jr,[y[17]||(y[17]=s("label",null,"Token Estimate:",-1)),s("span",null,"~"+T(l.value)+" tokens",1)]),d.value?(u(),f("div",Br,[y[18]||(y[18]=s("label",null,"Output Type:",-1)),s("span",{class:se(["output-type",`type-${d.value}`])},T(d.value),3)])):R("",!0)])]),m.value>1?(u(),f("div",zr,[y[23]||(y[23]=s("h4",null,"Repeat Configuration",-1)),s("div",Wr,[s("div",Hr,[y[20]||(y[20]=s("label",null,"Times per prompt:",-1)),s("span",null,T(m.value),1)]),s("div",Gr,[y[21]||(y[21]=s("label",null,"Total combinations:",-1)),s("span",null,T(h.value),1)]),s("div",qr,[y[22]||(y[22]=s("label",null,"Total API calls:",-1)),s("span",null,T(A.trial.progress.total),1)])])])):R("",!0),s("div",Jr,[y[27]||(y[27]=s("h4",null,"Model Configurations",-1)),s("div",Xr,[(u(!0),f(ee,null,te(A.trial.configurations,(N,v)=>(u(),f("div",{key:v,class:"model-config-card"},[s("div",Kr,[(N.provider,void 0)?(u(),f("img",{key:0,src:(N.provider,void 0),alt:N.provider,class:"provider-logo"},null,8,Yr)):R("",!0),s("span",Qr,T(k(N.provider)),1)]),s("div",Zr,[s("div",eo,[y[24]||(y[24]=s("label",null,"Model:",-1)),s("span",null,T(N.modelId),1)]),s("div",to,[y[25]||(y[25]=s("label",null,"Parameters:",-1)),s("div",so,[(u(!0),f(ee,null,te(N.parameters,(p,U)=>(u(),f("span",{key:U,class:"param-tag"},T(U)+": "+T(p),1))),128))])]),H(N)?(u(),f("div",ao,[y[26]||(y[26]=s("label",null,"Est. Cost:",-1)),s("span",no,T(H(N)),1)])):R("",!0)])]))),128))])])])),t.value?(u(),K(kr,{key:1,visible:t.value,trial:A.trial,onClose:y[2]||(y[2]=N=>t.value=!1),onMigrate:D},null,8,["visible","trial"])):R("",!0)])}}}),oo=ae(ro,[["__scopeId","data-v-a5e15d0c"]]),io={class:"filter-bar"},lo={class:"search-container"},uo=ne({__name:"TrialResultsFilterBar",props:{statusFilter:{},configFilter:{},searchQuery:{},visibleColumns:{},configurations:{},apiCalls:{},showRepeatColumn:{type:Boolean}},emits:["update:statusFilter","update:configFilter","update:searchQuery","update:visibleColumns","openPostProcessing"],setup(o,{emit:e}){const t=o,a=e,n=j(()=>{const m=[{key:"status",label:"Status"},{key:"configuration",label:"Configuration"},{key:"variables",label:"Variables"},{key:"response",label:"Response"},{key:"parsedResponse",label:"Parsed Response"},{key:"postProcessedResponse",label:"Post-Processed"},{key:"length",label:"Length"},{key:"latency",label:"Latency"}];return t.showRepeatColumn&&m.splice(2,0,{key:"repeat",label:"Repeat Index"}),m}),r=j(()=>{const m={total:t.apiCalls.length,completed:0,failed:0,running:0,pending:0};return t.apiCalls.forEach(h=>{h.status==="completed"?m.completed++:h.status==="failed"?m.failed++:h.status==="running"?m.running++:h.status==="pending"&&m.pending++}),m});function l(m){return m.modelSnapshot?.displayName||`${m.provider} - ${m.modelId}`}const c=Jt(m=>{const h=m.target.value;a("update:searchQuery",h)},300);function d(m){const h=[...t.visibleColumns],g=h.indexOf(m);if(g>-1)h.splice(g,1);else{const _=n.value.map(C=>C.key),S=_.indexOf(m);let k=0;for(let C=0;C<S;C++)h.includes(_[C])&&k++;h.splice(k,0,m)}a("update:visibleColumns",h)}return(m,h)=>{const g=Hs,_=Ws,S=zt,k=me,C=Wt,D=ct,H=dt,A=ut;return u(),f("div",io,[$(_,{value:m.statusFilter,onChange:h[0]||(h[0]=y=>m.$emit("update:statusFilter",y)),placeholder:"Filter by status",style:{width:"150px"}},{default:F(()=>[$(g,{value:"all"},{default:F(()=>[L(" All ("+T(r.value.total)+") ",1)]),_:1}),$(g,{value:"completed"},{default:F(()=>[L(" Completed ("+T(r.value.completed)+") ",1)]),_:1}),$(g,{value:"failed"},{default:F(()=>[L(" Failed ("+T(r.value.failed)+") ",1)]),_:1}),$(g,{value:"running"},{default:F(()=>[L(" Running ("+T(r.value.running)+") ",1)]),_:1}),$(g,{value:"pending"},{default:F(()=>[L(" Pending ("+T(r.value.pending)+") ",1)]),_:1})]),_:1},8,["value"]),$(_,{value:m.configFilter,onChange:h[1]||(h[1]=y=>m.$emit("update:configFilter",y)),mode:"multiple",placeholder:"Filter by configuration",style:{width:"250px"},"max-tag-count":2},{default:F(()=>[$(g,{value:""},{default:F(()=>h[3]||(h[3]=[L("All Configurations")])),_:1,__:[3]}),(u(!0),f(ee,null,te(m.configurations,(y,w)=>(u(),K(g,{key:w,value:w.toString()},{default:F(()=>[L(T(l(y)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s("div",lo,[$(S,{value:m.searchQuery,onInput:z(c),placeholder:"Search in variables and responses...",style:{width:"400px"},"allow-clear":""},{prefix:F(()=>[$(z(Dt))]),_:1},8,["value","onInput"])]),$(A,null,{overlay:F(()=>[$(H,null,{default:F(()=>[(u(!0),f(ee,null,te(n.value,y=>(u(),K(D,{key:y.key},{default:F(()=>[$(C,{checked:m.visibleColumns.includes(y.key),disabled:y.key==="status",onChange:w=>d(y.key)},{default:F(()=>[L(T(y.label),1)]),_:2},1032,["checked","disabled","onChange"])]),_:2},1024))),128))]),_:1})]),default:F(()=>[$(k,null,{default:F(()=>[$(z(Gs)),h[4]||(h[4]=L(" Columns "))]),_:1,__:[4]})]),_:1}),$(k,{type:"primary",onClick:h[2]||(h[2]=y=>m.$emit("openPostProcessing"))},{default:F(()=>[$(z(Ht)),h[5]||(h[5]=L(" Post-Process "))]),_:1,__:[5]})])}}}),co=ae(uo,[["__scopeId","data-v-e6112af3"]]),po={class:"modal-content"},fo={class:"section"},mo={class:"info-grid"},vo={class:"info-item"},go={class:"monospace"},ho={class:"info-item"},yo={class:"info-item"},bo={key:0,class:"info-item"},_o={class:"info-item"},To={key:1,class:"info-item"},ko={key:2,class:"info-item"},Co={key:3,class:"info-item"},$o={key:0,class:"info-row"},wo={class:"monospace"},So={key:0,class:"section"},Io={class:"variables-list"},Eo={class:"variable-main"},Ro={class:"variable-label"},Po={class:"variable-value"},Fo={key:0,class:"variable-attributes"},xo={class:"attribute-label"},Ao={class:"attribute-value"},Oo={class:"section"},Vo={class:"content-box prompt-display"},Do={key:1,class:"section"},No={key:0,class:"error-result"},Lo={key:1,class:"success-result"},Mo={class:"content-box response-content"},Uo={key:0,class:"parsed-content-section"},jo={class:"content-box parsed-content"},Bo={key:1,class:"post-processed-section"},zo={class:"content-box post-processed-content"},Wo={key:2,class:"refusal-warning"},Ho={key:3,class:"refusal-warning"},Go={class:"extraction-config-section"},qo={class:"config-grid"},Jo={key:0,class:"config-item"},Xo={class:"config-value"},Ko={key:1,class:"config-item"},Yo={class:"config-value"},Qo={key:2,class:"config-item"},Zo={class:"config-value pattern"},ei={key:3,class:"config-item"},ti={class:"config-value"},si={key:4,class:"config-item"},ai={class:"config-value"},ni={key:5,class:"config-item no-extraction"},ri={key:4,class:"post-processing-config-section"},oi={class:"config-grid"},ii={class:"config-item post-processing-item"},li={class:"config-value"},ui={key:0,class:"config-item post-processing-item"},di={class:"config-value"},ci={key:1,class:"config-item post-processing-item"},pi={class:"config-value pattern"},fi={key:2,class:"config-item post-processing-item"},mi={class:"config-value"},vi={key:3,class:"config-item post-processing-item"},gi={class:"config-value"},hi={key:4,class:"config-item post-processing-item"},yi={class:"config-value"},bi={key:5,class:"usage-info"},_i={class:"info-grid"},Ti={class:"info-item"},ki={class:"info-item"},Ci={class:"info-item"},$i={key:0,class:"info-item"},wi={class:"raw-data-section"},Si={class:"raw-data"},Ii={key:0},Ei={key:1,class:"raw-data"},Ri={key:2},Pi={key:3,class:"raw-data"},Fi={class:"modal-footer"},xi=ne({__name:"APICallDetailModalV3",props:{visible:{type:Boolean},apiCall:{},trial:{}},emits:["update:visible"],setup(o,{emit:e}){const t=o,a=e,n=hs(),r=j(()=>{if(t.apiCall.duration!==void 0)return t.apiCall.duration;if(!t.apiCall.completed||!t.apiCall.created)return null;const v=new Date(t.apiCall.created).getTime();return new Date(t.apiCall.completed).getTime()-v}),l=j(()=>{if(t.apiCall.modelName){const p=t.trial.configurations[t.apiCall.configurationIndex];return p?`${p.provider} / ${t.apiCall.modelName}`:t.apiCall.modelName}const v=t.trial.configurations[t.apiCall.configurationIndex];return v?`${v.provider} / ${v.modelId}`:null}),c=j(()=>{if(t.apiCall.cost!==void 0)return t.apiCall.cost;if(!t.apiCall.result?.usage)return null;const v=t.trial.configurations[t.apiCall.configurationIndex];if(!v)return null;const p=n.models.value.find(i=>i.provider===v.provider&&i.modelId===v.modelId);if(!p?.capabilities?.inputCostPerToken&&!p?.capabilities?.outputCostPerToken)return null;const U=(t.apiCall.result.usage.prompt_tokens||0)*(p.capabilities.inputCostPerToken||0),x=(t.apiCall.result.usage.completion_tokens||0)*(p.capabilities.outputCostPerToken||0);return U+x}),d=j(()=>{if(!t.apiCall.request)return"No request data";const v=JSON.parse(JSON.stringify(t.apiCall.request));return v.headers&&Object.keys(v.headers).forEach(p=>{(p.toLowerCase().includes("authorization")||p.toLowerCase().includes("api-key")||p.toLowerCase().includes("x-api-key"))&&(v.headers[p]="[REDACTED]")}),v.body&&typeof v.body=="object"&&(v.body.api_key&&(v.body.api_key="[REDACTED]"),v.body.apiKey&&(v.body.apiKey="[REDACTED]")),JSON.stringify(v,null,2)}),m=j(()=>t.apiCall.parserId?{parserId:t.apiCall.parserId,outputType:t.trial.type==="template"?t.trial.templateConfig?.outputType:void 0,extractPattern:t.trial.type==="template"?t.trial.templateConfig?.extractPattern:void 0,refusalWords:t.trial.type==="template"?t.trial.templateConfig?.refusalWords:void 0,rejectRefusalWords:t.trial.type==="template"?t.trial.templateConfig?.rejectRefusalWords:void 0}:t.trial.type!=="template"||!t.trial.templateConfig?{}:{parserId:t.trial.templateConfig.parserId,outputType:t.trial.templateConfig.outputType,extractPattern:t.trial.templateConfig.extractPattern,refusalWords:t.trial.templateConfig.refusalWords,rejectRefusalWords:t.trial.templateConfig.rejectRefusalWords}),h=j(()=>{const v=m.value;return!!(v.parserId||v.outputType||v.extractPattern||v.refusalWords&&v.refusalWords.length>0)}),g=j(()=>t.trial.postProcessingConfig||null),_=j(()=>t.apiCall.response?JSON.stringify({status:t.apiCall.response.status,headers:t.apiCall.response.headers,body:t.apiCall.response.body,latencyMs:t.apiCall.response.latencyMs},null,2):"No response data available"),S=j(()=>t.apiCall.result?JSON.stringify(t.apiCall.result,null,2):"No processed result available");function k(v){return{completed:"success",failed:"error",running:"processing",pending:"warning"}[v]||"default"}function C(){const v=t.trial.configurations[t.apiCall.configurationIndex];return v?.modelSnapshot?.displayName||v?.modelId||`Configuration ${t.apiCall.configurationIndex+1}`}function D(v){return(typeof v=="string"?new Date(v):v).toLocaleString()}function H(v){return v<1e3?`${v}ms`:v<6e4?`${(v/1e3).toFixed(1)}s`:`${Math.floor(v/6e4)}m ${(v%6e4/1e3).toFixed(0)}s`}function A(v){return v==null?"null":typeof v=="string"?v:typeof v=="number"||typeof v=="boolean"?String(v):JSON.stringify(v,null,2)}function y(v){return{network_error_no_response:"Network Error (No Response)",api_error_received:"API Error Response",parsing_error:"Response Parsing Error",timeout:"Request Timeout",rate_limit:"Rate Limit Exceeded"}[v]||v}function w(){a("update:visible",!1)}async function N(){const v={id:t.apiCall.id,status:t.apiCall.status,configuration:C(),provider:l.value,variables:t.apiCall.variables,variableAttributes:t.apiCall.variableAttributes,prompt:t.apiCall.prompt,fullApiResponse:t.apiCall.response,processedResult:t.apiCall.result,extractionConfig:m.value,postProcessingConfig:g.value,created:t.apiCall.created,completed:t.apiCall.completed,duration:r.value?`${r.value}ms`:null,cost:c.value?`$${c.value.toFixed(4)}`:null},p=JSON.stringify(v,null,2);try{await navigator.clipboard.writeText(p),Z.success("Details copied to clipboard!")}catch(U){P.error("Failed to copy to clipboard",U),Z.error("Failed to copy to clipboard")}}return(v,p)=>{const U=ft,x=ze,i=Js,O=qs,I=me,E=Ce;return u(),K(E,{open:v.visible,onCancel:p[0]||(p[0]=G=>a("update:visible",!1)),title:"API Call Details",width:1400,footer:null,"body-style":{padding:0,height:"85vh",display:"flex",flexDirection:"column"},centered:!0,"destroy-on-close":!0,class:"api-call-detail-modal"},{default:F(()=>[s("div",po,[s("div",fo,[p[10]||(p[10]=s("h3",null,"Overview",-1)),s("div",mo,[s("div",vo,[p[1]||(p[1]=s("label",null,"Call ID:",-1)),s("span",go,T(v.apiCall.id),1)]),s("div",ho,[p[2]||(p[2]=s("label",null,"Status:",-1)),$(U,{color:k(v.apiCall.status)},{default:F(()=>[L(T(v.apiCall.status.toUpperCase()),1)]),_:1},8,["color"])]),s("div",yo,[p[3]||(p[3]=s("label",null,"Configuration:",-1)),s("span",null,T(C()),1)]),v.apiCall.repeatIndex!==void 0?(u(),f("div",bo,[p[4]||(p[4]=s("label",null,"Repeat:",-1)),s("span",null,"#"+T(v.apiCall.repeatIndex+1),1)])):R("",!0),s("div",_o,[p[5]||(p[5]=s("label",null,"Created:",-1)),s("span",null,T(D(v.apiCall.created)),1)]),v.apiCall.completed?(u(),f("div",To,[p[6]||(p[6]=s("label",null,"Completed:",-1)),s("span",null,T(D(v.apiCall.completed)),1)])):R("",!0),r.value?(u(),f("div",ko,[p[7]||(p[7]=s("label",null,"Duration:",-1)),s("span",null,T(H(r.value)),1)])):R("",!0),v.apiCall.result?.latency?(u(),f("div",Co,[p[8]||(p[8]=s("label",null,"API Latency:",-1)),s("span",null,T(v.apiCall.result.latency)+"ms",1)])):R("",!0)]),l.value?(u(),f("div",$o,[p[9]||(p[9]=s("label",null,"Provider/Model:",-1)),s("span",wo,T(l.value),1)])):R("",!0)]),v.apiCall.variables&&Object.keys(v.apiCall.variables).length>0?(u(),f("div",So,[p[11]||(p[11]=s("h3",null,"Variables",-1)),s("div",Io,[(u(!0),f(ee,null,te(v.apiCall.variables,(G,V)=>(u(),f("div",{key:V,class:"variable-group"},[s("div",Eo,[s("label",Ro,T(V)+":",1),s("span",Po,T(G),1)]),v.apiCall.variableAttributes&&v.apiCall.variableAttributes[V]?(u(),f("div",Fo,[(u(!0),f(ee,null,te(v.apiCall.variableAttributes[V],(Y,b)=>(u(),f("div",{key:b,class:"attribute-item"},[s("label",xo,T(b)+":",1),s("span",Ao,T(Y),1)]))),128))])):R("",!0)]))),128))])])):R("",!0),s("div",Oo,[p[12]||(p[12]=s("h3",null,"Resolved Prompt",-1)),s("div",Vo,T(v.apiCall.prompt),1)]),v.apiCall.result?(u(),f("div",Do,[p[35]||(p[35]=s("h3",null,"Response",-1)),v.apiCall.status==="failed"&&v.apiCall.result.error?(u(),f("div",No,[$(x,{type:"error",message:v.apiCall.result.error,description:v.apiCall.result.errorType?`Error Type: ${y(v.apiCall.result.errorType)}`:void 0,"show-icon":""},null,8,["message","description"])])):v.apiCall.result.content?(u(),f("div",Lo,[s("div",Mo,T(v.apiCall.result.content),1),v.apiCall.result.parsedContent!==void 0?(u(),f("div",Uo,[p[13]||(p[13]=s("h4",null,"Extracted Value (Original)",-1)),s("div",jo,T(A(v.apiCall.result.parsedContent)),1)])):R("",!0),v.apiCall.result.postParsedContent!==void 0?(u(),f("div",Bo,[p[14]||(p[14]=s("h4",null,"Post-Processed Value",-1)),s("div",zo,T(A(v.apiCall.result.postParsedContent)),1)])):R("",!0),v.apiCall.result.refused?(u(),f("div",Wo,[$(x,{type:"warning",message:"Response flagged as refusal (Original Extraction)",description:"This response matched configured refusal patterns","show-icon":""})])):R("",!0),v.apiCall.result.postRefused?(u(),f("div",Ho,[$(x,{type:"warning",message:"Response flagged as refusal (Post-Processing)",description:"This response matched post-processing refusal patterns","show-icon":""})])):R("",!0),s("div",Go,[p[21]||(p[21]=s("h4",null,"Original Extraction Configuration",-1)),s("div",qo,[m.value.parserId?(u(),f("div",Jo,[p[15]||(p[15]=s("label",null,"Parser ID:",-1)),s("span",Xo,T(m.value.parserId),1)])):R("",!0),m.value.outputType?(u(),f("div",Ko,[p[16]||(p[16]=s("label",null,"Output Type:",-1)),s("span",Yo,T(m.value.outputType),1)])):R("",!0),m.value.extractPattern?(u(),f("div",Qo,[p[17]||(p[17]=s("label",null,"Extract Pattern:",-1)),s("span",Zo,T(m.value.extractPattern),1)])):R("",!0),m.value.refusalWords&&m.value.refusalWords.length>0?(u(),f("div",ei,[p[18]||(p[18]=s("label",null,"Refusal Words:",-1)),s("span",ti,T(m.value.refusalWords.join(", ")),1)])):R("",!0),m.value.rejectRefusalWords!==void 0?(u(),f("div",si,[p[19]||(p[19]=s("label",null,"Reject on Refusal:",-1)),s("span",ai,T(m.value.rejectRefusalWords?"Yes":"No"),1)])):R("",!0),h.value?R("",!0):(u(),f("div",ni,p[20]||(p[20]=[s("span",{class:"no-config-message"},"No extraction configuration set for this trial",-1)])))])]),g.value&&g.value.enabled?(u(),f("div",ri,[p[29]||(p[29]=s("h4",null,"Post-Processing Configuration",-1)),s("div",oi,[s("div",ii,[p[23]||(p[23]=s("label",null,"Status:",-1)),s("span",li,[$(U,{color:"processing"},{default:F(()=>p[22]||(p[22]=[L("Enabled")])),_:1,__:[22]})])]),g.value.outputType?(u(),f("div",ui,[p[24]||(p[24]=s("label",null,"Output Type:",-1)),s("span",di,T(g.value.outputType),1)])):R("",!0),g.value.extractPattern?(u(),f("div",ci,[p[25]||(p[25]=s("label",null,"Extract Pattern:",-1)),s("span",pi,T(g.value.extractPattern),1)])):R("",!0),g.value.refusalWords&&g.value.refusalWords.length>0?(u(),f("div",fi,[p[26]||(p[26]=s("label",null,"Refusal Words:",-1)),s("span",mi,T(g.value.refusalWords.join(", ")),1)])):R("",!0),g.value.rejectRefusalWords!==void 0?(u(),f("div",vi,[p[27]||(p[27]=s("label",null,"Reject on Refusal:",-1)),s("span",gi,T(g.value.rejectRefusalWords?"Yes":"No"),1)])):R("",!0),g.value.updatedAt?(u(),f("div",hi,[p[28]||(p[28]=s("label",null,"Last Updated:",-1)),s("span",yi,T(D(g.value.updatedAt)),1)])):R("",!0)])])):R("",!0),v.apiCall.result.usage?(u(),f("div",bi,[p[34]||(p[34]=s("h4",null,"Token Usage",-1)),s("div",_i,[s("div",Ti,[p[30]||(p[30]=s("label",null,"Prompt Tokens:",-1)),s("span",null,T(v.apiCall.result.usage.prompt_tokens||0),1)]),s("div",ki,[p[31]||(p[31]=s("label",null,"Completion Tokens:",-1)),s("span",null,T(v.apiCall.result.usage.completion_tokens||0),1)]),s("div",Ci,[p[32]||(p[32]=s("label",null,"Total Tokens:",-1)),s("span",null,T(v.apiCall.result.usage.total_tokens||0),1)]),c.value?(u(),f("div",$i,[p[33]||(p[33]=s("label",null,"Cost:",-1)),s("span",null,"$"+T(c.value.toFixed(4)),1)])):R("",!0)])])):R("",!0)])):R("",!0)])):R("",!0),$(O,{ghost:""},{default:F(()=>[$(i,{key:"raw",header:"Raw Data"},{default:F(()=>[s("div",wi,[p[36]||(p[36]=s("h4",null,"HTTP Request",-1)),s("pre",Si,T(d.value),1),v.apiCall.response?(u(),f("h4",Ii,"Full API Response")):R("",!0),v.apiCall.response?(u(),f("pre",Ei,T(_.value),1)):R("",!0),v.apiCall.result?(u(),f("h4",Ri,"Processed Result")):R("",!0),v.apiCall.result?(u(),f("pre",Pi,T(S.value),1)):R("",!0)])]),_:1})]),_:1})]),s("div",Fi,[$(I,{onClick:w,size:"large"},{default:F(()=>p[37]||(p[37]=[L(" Close ")])),_:1,__:[37]}),$(I,{type:"primary",onClick:N,size:"large"},{default:F(()=>[$(z(pt)),p[38]||(p[38]=L(" Copy Details "))]),_:1,__:[38]})])]),_:1},8,["open"])}}}),es=ae(xi,[["__scopeId","data-v-72b861dc"]]),Ai={class:"post-processing-modal"},Oi={key:2,class:"current-extraction"},Vi={class:"parser-info"},Di={class:"parser-name"},Ni={key:0,class:"test-results"},Li={key:1,class:"statistics"},Mi={class:"stat-item"},Ui={class:"stat-value"},ji={class:"stat-item"},Bi={class:"stat-value"},zi={class:"stat-item"},Wi={class:"stat-value"},Hi={class:"stat-item"},Gi={class:"stat-value"},qi={class:"modal-actions"},Ji=ne({__name:"PostProcessingModalV2",props:{visible:{type:Boolean},trial:{}},emits:["close"],setup(o,{emit:e}){const t=o,a=e,n=We(),r=ia(),l=q(t.visible),c=q(!1),d=q(!1),m=q(!1),h=q(null),g=q({enabled:!1,postParserId:null}),_=q([]),S=q(null),k=[{title:"Variables",dataIndex:"variables",key:"variables",width:200,customRender:({text:O})=>Object.entries(O).map(([I,E])=>`${I}: ${E}`).join(", ")},{title:"Original",dataIndex:"original",key:"original",slots:{customRender:"original"}},{title:"Post-Processed",dataIndex:"postProcessed",key:"postProcessed",slots:{customRender:"postProcessed"}},{title:"Changed",dataIndex:"changed",key:"changed",width:100,slots:{customRender:"changed"}}],C=j(()=>t.trial.parserId?r.parsers.find(O=>O.id===t.trial.parserId):null);function D(O){switch(O){case"regex":return"blue";case"javascript":return"orange";case"python":return"green";default:return"default"}}function H(O){return O===void 0?"(no match)":O===null?"null":typeof O=="string"&&O.length>50?O.substring(0,50)+"...":String(O)}function A(O){O||(_.value=[],S.value=null)}function y(){d.value=!0}function w(O){h.value=O,m.value=!0}async function N(O,I){if(!O||!I){_.value=[],S.value=null;return}await v(I),await p(I)}async function v(O){const I=n.apiCalls.value.filter(G=>G.result?.content).slice(0,10),E=[];for(const G of I){const V=await gt.executeParser(G.result.content,O);E.push({id:G.id,variables:G.variables,original:G.result.parsedContent,postProcessed:V.success?V.value:null,changed:V.success&&V.value!==G.result.parsedContent})}_.value=E}async function p(O){if(!n.apiCalls.value.length){S.value=null;return}const I=n.apiCalls.value,E=I.length,G=I.filter(b=>b.result?.content).length;let V=0,Y=0;for(const b of I){if(!b.result?.content)continue;const B=await gt.executeParser(b.result.content,O);B.success&&B.value!==void 0&&(V++,B.value!==b.result.parsedContent&&Y++)}S.value={total:E,withContent:G,matches:V,changed:Y}}async function U(){c.value=!0;try{const O=await bt.updatePostParserId(t.trial.id,null,!1);if(O.ok)g.value.enabled=!1,g.value.postParserId=null,Z.success("Post-processing disabled"),await n.refreshFromDatabase(t.trial.id);else throw O.error}catch(O){P.error("Failed to reset post-processing:",O),Z.error("Failed to reset post-processing")}finally{c.value=!1}}async function x(){if(!g.value.enabled){Z.warning("Please enable post-processing");return}if(!g.value.postParserId){Z.warning("Please select a parser");return}c.value=!0;try{const O=n.apiCalls.value.some(G=>G.status==="completed"&&G.result?.content),I=O&&await new Promise(G=>{G(O?confirm("Apply post-processing to existing completed calls?"):!1)}),E=await bt.updatePostParserId(t.trial.id,g.value.postParserId,I);if(E.ok)Z.success(I?"Post-processing applied to all calls":"Post-processing will apply to future calls"),await n.refreshFromDatabase(t.trial.id),i();else throw E.error}catch(O){P.error("Failed to apply post-processing:",O),Z.error("Failed to apply post-processing")}finally{c.value=!1}}function i(){a("close")}return fe(async()=>{if(await r.initialize(),t.trial.postParserId){g.value.enabled=!0,g.value.postParserId=t.trial.postParserId;const O=r.parsers.find(I=>I.id===t.trial.postParserId);O&&(await v(O),await p(O))}else t.trial.postProcessingConfig?.enabled&&(g.value.enabled=!0,Z.info("Legacy post-processing config detected. Please select a parser to continue."))}),re(()=>t.visible,O=>{l.value=O}),re(l,O=>{O||a("close")}),(O,I)=>{const E=ze,G=ft,V=Ys,Y=Ks,b=Qs,B=ea,J=Zs,X=me,oe=Xs,ce=Ce;return u(),K(ce,{visible:l.value,"onUpdate:visible":I[2]||(I[2]=pe=>l.value=pe),title:"Post-Process Extraction",width:"80%",footer:null,onCancel:i},{default:F(()=>[s("div",Ai,[O.trial.status==="running"?(u(),K(E,{key:0,message:"Trial is currently running",description:"Post-processing will apply to all completed calls and future results as they arrive.",type:"info","show-icon":"",style:{"margin-bottom":"20px"}})):O.trial.status==="draft"?(u(),K(E,{key:1,message:"Trial not started",description:"Configure post-processing now. It will apply when the trial runs.",type:"warning","show-icon":"",style:{"margin-bottom":"20px"}})):R("",!0),C.value?(u(),f("div",Oi,[I[3]||(I[3]=s("h4",null,"Current Primary Parser",-1)),s("div",Vi,[s("span",Di,T(C.value.name),1),$(G,{color:D(C.value.type)},{default:F(()=>[L(T(C.value.type),1)]),_:1},8,["color"]),$(G,null,{default:F(()=>[L(T(C.value.outputType),1)]),_:1})])])):R("",!0),$(oe,{model:g.value,layout:"vertical",onFinish:x},{default:F(()=>[$(Y,{label:"Enable Post-Processing"},{default:F(()=>[$(V,{checked:g.value.enabled,"onUpdate:checked":I[0]||(I[0]=pe=>g.value.enabled=pe),onChange:A},{checkedChildren:F(()=>I[4]||(I[4]=[L("ON")])),unCheckedChildren:F(()=>I[5]||(I[5]=[L("OFF")])),_:1},8,["checked"])]),_:1}),$(Y,{label:"Post-Processing Parser",disabled:!g.value.enabled},{default:F(()=>[$(oa,{modelValue:g.value.postParserId,"onUpdate:modelValue":I[1]||(I[1]=pe=>g.value.postParserId=pe),disabled:!g.value.enabled,"allow-create":!0,"show-preview":!0,placeholder:"Select or create a parser for post-processing",onCreate:y,onTest:w,onChange:N},null,8,["modelValue","disabled"])]),_:1},8,["disabled"]),_.value.length>0&&g.value.enabled?(u(),f("div",Ni,[I[6]||(I[6]=s("h4",null,"Preview Results (First 10 calls)",-1)),$(b,{columns:k,"data-source":_.value,pagination:!1,size:"small",scroll:{x:800}},{original:F(({text:pe})=>[s("code",null,T(H(pe)),1)]),postProcessed:F(({text:pe,record:qe})=>[s("code",{class:se({"value-changed":qe.changed})},T(H(pe)),3)]),changed:F(({text:pe})=>[$(G,{color:pe?"green":"default"},{default:F(()=>[L(T(pe?"Changed":"Same"),1)]),_:2},1032,["color"])]),_:1},8,["data-source"])])):R("",!0),S.value&&g.value.enabled?(u(),f("div",Li,[$(J,{gutter:16},{default:F(()=>[$(B,{span:6},{default:F(()=>[s("div",Mi,[I[7]||(I[7]=s("div",{class:"stat-label"},"Total Calls",-1)),s("div",Ui,T(S.value.total),1)])]),_:1}),$(B,{span:6},{default:F(()=>[s("div",ji,[I[8]||(I[8]=s("div",{class:"stat-label"},"With Content",-1)),s("div",Bi,T(S.value.withContent),1)])]),_:1}),$(B,{span:6},{default:F(()=>[s("div",zi,[I[9]||(I[9]=s("div",{class:"stat-label"},"Matches",-1)),s("div",Wi,T(S.value.matches),1)])]),_:1}),$(B,{span:6},{default:F(()=>[s("div",Hi,[I[10]||(I[10]=s("div",{class:"stat-label"},"Changed",-1)),s("div",Gi,T(S.value.changed),1)])]),_:1})]),_:1})])):R("",!0),s("div",qi,[$(X,{onClick:U,disabled:!g.value.enabled},{default:F(()=>I[11]||(I[11]=[L(" Reset ")])),_:1,__:[11]},8,["disabled"]),$(X,{onClick:i},{default:F(()=>I[12]||(I[12]=[L(" Cancel ")])),_:1,__:[12]}),$(X,{type:"primary","html-type":"submit",loading:c.value,disabled:!g.value.enabled||!g.value.postParserId},{default:F(()=>I[13]||(I[13]=[L(" Apply Post-Processing ")])),_:1,__:[13]},8,["loading","disabled"])])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),Xi=ae(Ji,[["__scopeId","data-v-2ab953e4"]]),Ki={class:"trial-results-table"},Yi={class:"table-container"},Qi={class:"results-table"},Zi={key:0,class:"col-status"},el={key:1,class:"col-configuration"},tl={key:2,class:"col-repeat"},sl={key:3,class:"col-variables"},al={key:4,class:"col-response"},nl={key:5,class:"col-parsed"},rl={key:6,class:"col-post-processed"},ol={key:0,class:"post-process-indicator"},il={key:7,class:"col-length"},ll={key:8,class:"col-latency"},ul={class:"results-table"},dl=["onClick"],cl={key:0,class:"col-status"},pl={class:"status-cell"},fl={class:"status-time"},ml={key:1,class:"col-configuration"},vl={key:2,class:"col-repeat"},gl={key:3,class:"col-variables"},hl={class:"variable-tags"},yl={key:0,class:"var-item"},bl={key:1,class:"var-item"},_l={key:2},Tl={key:3},kl={key:4,class:"col-response"},Cl={class:"response-content"},$l={key:5,class:"col-parsed"},wl={key:6,class:"col-post-processed"},Sl={key:7,class:"col-length"},Il={key:8,class:"col-latency"},El={key:1,class:"results-table"},Rl={key:0,class:"col-status"},Pl={key:1,class:"col-configuration"},Fl={key:2,class:"col-repeat"},xl={key:3,class:"col-variables"},Al={key:4,class:"col-response"},Ol={key:5,class:"col-parsed"},Vl={key:6,class:"col-post-processed"},Dl={key:0,class:"post-process-indicator"},Nl={key:7,class:"col-length"},Ll={key:8,class:"col-latency"},Ml=["onClick"],Ul={key:0,class:"col-status"},jl={class:"status-cell"},Bl={class:"status-time"},zl={key:1,class:"col-configuration"},Wl={key:2,class:"col-repeat"},Hl={key:3,class:"col-variables"},Gl={class:"variable-tags"},ql={key:0,class:"var-item"},Jl={key:1,class:"var-item"},Xl={key:2},Kl={key:3},Yl={key:4,class:"col-response"},Ql={class:"response-content"},Zl={key:5,class:"col-parsed"},eu={key:6,class:"col-post-processed"},tu={key:7,class:"col-length"},su={key:8,class:"col-latency"},au={key:0},nu=["colspan"],ru={key:0},ou={key:1},$t="trial-results-visible-columns",iu=ne({__name:"TrialResultsTableV3",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(o){const e=o,t=q("all"),a=q([]),n=q(""),r=q(["status","configuration","variables","response","parsedResponse","postProcessedResponse","length","latency"]),l=q(null),c=q(!1),d=We(),m=j(()=>d.apiCalls?.value||[]),h=j(()=>e.apiCalls||m.value);re(h,(I,E)=>{const G=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 calls data changed from ${E?.length||0} to ${I.length} calls`),setTimeout(()=>{const V=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 reactive update completed in ${(V-G).toFixed(1)}ms`)},0)});const g=I=>{if(!n.value)return I;const E=n.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),G=new RegExp(`(${E})`,"gi");return I.replace(G,"<mark>$1</mark>")},_=j(()=>{const I=performance.now();if(!(t.value!=="all"||a.value.length>0||n.value))return performance.now()-I>5&&P.info(`V4_OPTIMIZE: No filtering needed, returning ${h.value.length} calls directly`),h.value;let G=h.value.filter(Y=>{if(t.value!=="all"&&Y.status!==t.value||a.value.length>0&&!a.value.includes(String(Y.configurationIndex)))return!1;if(n.value){const b=n.value.toLowerCase();if(!(Y.prompt?.toLowerCase().includes(b)||Y.result?.content?.toLowerCase().includes(b)||Y.result?.error?.toLowerCase().includes(b)))return!1}return!0});const V=performance.now();return V-I>10&&P.info(`V4_OPTIMIZE: Filtered ${h.value.length} → ${G.length} calls in ${(V-I).toFixed(1)}ms`),G});re(_,(I,E)=>{const G=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls changed from ${E?.length||0} to ${I.length} items`),setTimeout(()=>{const V=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls render completed in ${(V-G).toFixed(1)}ms`)},0)});const S=j(()=>h.value),k=j(()=>h.value.length),C=j(()=>e.trial.configurations.some(I=>I.repeatCount>1)),D=j(()=>60);function H(I){}function A(I){const E=e.trial.configurations[I];return E?E.modelSnapshot?.displayName||`${E.modelId}`:`Config ${I+1}`}function y(I){return I.status==="pending"?"Waiting...":I.status==="running"?"Processing...":I.status==="failed"?I.result?.errorType==="refusal_detected"||I.result?.error==="REFUSED"?I.result?.content||"REFUSED":I.result?.error||"Error occurred":I.result?.content||""}function w(I){if(!I.result)return"";if(I.result.parsedContent!==void 0){const E=I.result.parsedContent;return E===null?"null":typeof E=="string"?E:typeof E=="number"||typeof E=="boolean"?String(E):JSON.stringify(E)}return""}function N(I){if(!I.result||I.result.postParsedContent===void 0)return"";const E=I.result.postParsedContent;return E===null?"null":E==="REFUSED"||I.result.postRefused?"REFUSED":typeof E=="string"?E:typeof E=="number"||typeof E=="boolean"?String(E):JSON.stringify(E)}function v(I){const E=I.result?.content||"";if(!E)return"";const G=E.length;return G>1e3?`${(G/1e3).toFixed(1)}k chars`:`${G} chars`}function p(I){return I?I<1e3?`${I}ms`:`${(I/1e3).toFixed(1)}s`:""}function U(I){let E;switch(I.status){case"completed":case"failed":E=I.completed;break;case"running":E=I.started;break;case"pending":case"cancelled":E=I.created;break}if(!E)return"";const G=new Date(E),V=G.getHours().toString().padStart(2,"0"),Y=G.getMinutes().toString().padStart(2,"0"),b=G.getSeconds().toString().padStart(2,"0");return`  ${V}:${Y}:${b}`}function x(I){return I?I<1e3?"latency-fast":I<5e3?"latency-medium":"latency-slow":""}function i(I){return g(I)}function O(I){l.value=I}return re(r,I=>{localStorage.setItem($t,JSON.stringify(I))},{deep:!0}),fe(()=>{const I=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 MOUNTED with ${h.value.length} calls`);const E=localStorage.getItem($t);if(E)try{r.value=JSON.parse(E)}catch{}ke(()=>{const G=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 DOM ready in ${(G-I).toFixed(1)}ms`),setTimeout(()=>{const V=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 virtual scrolling ready in ${(V-I).toFixed(1)}ms`)},100)}),setTimeout(()=>{const G=performance.now();P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 mount completed in ${(G-I).toFixed(1)}ms`)},0)}),Fe(()=>{P.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 ACTIVATED (cache hit) with ${h.value.length} calls`)}),xe(()=>{P.info("V4_TRIAL_SWITCH: TrialResultsTableV3 DEACTIVATED (cached)")}),be(()=>{P.info("V4_TRIAL_SWITCH: TrialResultsTableV3 UNMOUNTED (evicted)")}),(I,E)=>{const G=Ft("dompurify-html");return u(),f("div",Ki,[$(co,{"status-filter":t.value,"onUpdate:statusFilter":E[0]||(E[0]=V=>t.value=V),"config-filter":a.value,"onUpdate:configFilter":E[1]||(E[1]=V=>a.value=V),"search-query":n.value,"onUpdate:searchQuery":E[2]||(E[2]=V=>n.value=V),"visible-columns":r.value,"onUpdate:visibleColumns":E[3]||(E[3]=V=>r.value=V),configurations:I.trial.configurations,"api-calls":S.value,"show-repeat-column":C.value,onOpenPostProcessing:E[4]||(E[4]=V=>c.value=!0)},null,8,["status-filter","config-filter","search-query","visible-columns","configurations","api-calls","show-repeat-column"]),s("div",Yi,[k.value>100?(u(),K(z(Ge),{key:0,class:"results-scroller",items:Array.from(_.value),"item-size":D.value,"key-field":"id",buffer:10,onVisibleRange:H},{before:F(()=>[s("table",Qi,[s("thead",null,[s("tr",null,[r.value.includes("status")?(u(),f("th",Zi,"Status")):R("",!0),r.value.includes("configuration")?(u(),f("th",el,"Configuration")):R("",!0),r.value.includes("repeat")&&C.value?(u(),f("th",tl,"Repeat")):R("",!0),r.value.includes("variables")?(u(),f("th",sl,"Variables")):R("",!0),r.value.includes("response")?(u(),f("th",al,"Response")):R("",!0),r.value.includes("parsedResponse")?(u(),f("th",nl,"Parsed Response")):R("",!0),r.value.includes("postProcessedResponse")?(u(),f("th",rl,[E[7]||(E[7]=L(" Post-Processed ")),I.trial.postProcessingConfig?.enabled?(u(),f("span",ol,"✨")):R("",!0)])):R("",!0),r.value.includes("length")?(u(),f("th",il,"Length")):R("",!0),r.value.includes("latency")?(u(),f("th",ll,"Latency")):R("",!0)])])])]),default:F(({item:V})=>[s("table",ul,[s("tbody",null,[s("tr",{class:se(["result-row",`status-${V.status}`]),onClick:Y=>O(V)},[r.value.includes("status")?(u(),f("td",cl,[s("div",pl,[s("span",{class:se(["status-tag",`status-${V.status}`])},T(V.status.toUpperCase()),3),s("span",fl,T(U(V)),1)])])):R("",!0),r.value.includes("configuration")?(u(),f("td",ml,T(A(V.configurationIndex)),1)):R("",!0),r.value.includes("repeat")&&C.value?(u(),f("td",vl," #"+T((V.repeatIndex||0)+1),1)):R("",!0),r.value.includes("variables")?(u(),f("td",gl,[s("div",hl,[(u(!0),f(ee,null,te(Object.entries(V.variables),([Y,b],B)=>(u(),f(ee,{key:Y},[E[9]||(E[9]=s("span",{class:"var-bullet"},"• ",-1)),Object.keys(V.variables).length<=2?(u(),f("span",yl,T(Y)+": "+T(b),1)):(u(),f("span",bl,T(b),1)),Object.keys(V.variables).length===2&&B===0?(u(),f("span",_l,E[8]||(E[8]=[s("br",null,null,-1)]))):B<Object.keys(V.variables).length-1?(u(),f("span",Tl,T("  "))):R("",!0)],64))),128))])])):R("",!0),r.value.includes("response")?(u(),f("td",kl,[Se(s("div",Cl,null,512),[[G,i(y(V)),"apiResponse"]])])):R("",!0),r.value.includes("parsedResponse")?(u(),f("td",$l,T(w(V)),1)):R("",!0),r.value.includes("postProcessedResponse")?(u(),f("td",wl,T(N(V)),1)):R("",!0),r.value.includes("length")?(u(),f("td",Sl,T(v(V)),1)):R("",!0),r.value.includes("latency")?(u(),f("td",Il,[s("span",{class:se(x(V.response?.latencyMs))},T(p(V.response?.latencyMs)),3)])):R("",!0)],10,dl)])])]),_:1},8,["items","item-size"])):(u(),f("table",El,[s("thead",null,[s("tr",null,[r.value.includes("status")?(u(),f("th",Rl,"Status")):R("",!0),r.value.includes("configuration")?(u(),f("th",Pl,"Configuration")):R("",!0),r.value.includes("repeat")&&C.value?(u(),f("th",Fl,"Repeat")):R("",!0),r.value.includes("variables")?(u(),f("th",xl,"Variables")):R("",!0),r.value.includes("response")?(u(),f("th",Al,"Response")):R("",!0),r.value.includes("parsedResponse")?(u(),f("th",Ol,"Parsed Response")):R("",!0),r.value.includes("postProcessedResponse")?(u(),f("th",Vl,[E[10]||(E[10]=L(" Post-Processed ")),I.trial.postProcessingConfig?.enabled?(u(),f("span",Dl,"✨")):R("",!0)])):R("",!0),r.value.includes("length")?(u(),f("th",Nl,"Length")):R("",!0),r.value.includes("latency")?(u(),f("th",Ll,"Latency")):R("",!0)])]),s("tbody",null,[(u(!0),f(ee,null,te(_.value,V=>(u(),f("tr",{key:V.id,class:se(["result-row",`status-${V.status}`]),onClick:Y=>O(V)},[r.value.includes("status")?(u(),f("td",Ul,[s("div",jl,[s("span",{class:se(["status-tag",`status-${V.status}`])},T(V.status.toUpperCase()),3),s("span",Bl,T(U(V)),1)])])):R("",!0),r.value.includes("configuration")?(u(),f("td",zl,T(A(V.configurationIndex)),1)):R("",!0),r.value.includes("repeat")&&C.value?(u(),f("td",Wl," #"+T((V.repeatIndex||0)+1),1)):R("",!0),r.value.includes("variables")?(u(),f("td",Hl,[s("div",Gl,[(u(!0),f(ee,null,te(V.variables,(Y,b,B)=>(u(),f(ee,{key:b},[E[12]||(E[12]=s("span",{class:"var-bullet"},"• ",-1)),Object.keys(V.variables).length<=2?(u(),f("span",ql,T(b)+": "+T(Y),1)):(u(),f("span",Jl,T(Y),1)),Object.keys(V.variables).length===2&&B===0?(u(),f("span",Xl,E[11]||(E[11]=[s("br",null,null,-1)]))):B<Object.keys(V.variables).length-1?(u(),f("span",Kl,T("  "))):R("",!0)],64))),128))])])):R("",!0),r.value.includes("response")?(u(),f("td",Yl,[Se(s("div",Ql,null,512),[[G,i(y(V)),"apiResponse"]])])):R("",!0),r.value.includes("parsedResponse")?(u(),f("td",Zl,T(w(V)),1)):R("",!0),r.value.includes("postProcessedResponse")?(u(),f("td",eu,T(N(V)),1)):R("",!0),r.value.includes("length")?(u(),f("td",tu,T(v(V)),1)):R("",!0),r.value.includes("latency")?(u(),f("td",su,[s("span",{class:se(x(V.response?.latencyMs))},T(p(V.response?.latencyMs)),3)])):R("",!0)],10,Ml))),128)),_.value.length===0?(u(),f("tr",au,[s("td",{colspan:r.value.length,class:"empty-state"},[m.value.length===0?(u(),f("div",ru," No API calls yet. Start the trial to begin execution. ")):(u(),f("div",ou," No results match your filters. "))],8,nu)])):R("",!0)])]))]),l.value?(u(),K(es,{key:0,visible:!!l.value,"api-call":l.value,trial:I.trial,"onUpdate:visible":E[5]||(E[5]=V=>l.value=null)},null,8,["visible","api-call","trial"])):R("",!0),c.value?(u(),K(Xi,{key:1,visible:c.value,trial:I.trial,onClose:E[6]||(E[6]=V=>c.value=!1)},null,8,["visible","trial"])):R("",!0)])}}}),lu=ae(iu,[["__scopeId","data-v-a566786b"]]),uu={class:"trial-analysis-view"},du=ne({__name:"TrialAnalysisView",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(o){const e=o;return fe(()=>{const t=performance.now();P.info(`V4_TRIAL_SWITCH: TrialAnalysisView MOUNTED for trial ${e.trial.id}`),ke(()=>{const a=performance.now();P.info(`V4_TRIAL_SWITCH: TrialAnalysisView DOM ready in ${(a-t).toFixed(1)}ms`)}),setTimeout(()=>{const a=performance.now();P.info(`V4_TRIAL_SWITCH: TrialAnalysisView mount completed in ${(a-t).toFixed(1)}ms`)},0)}),Fe(()=>{P.info(`V4_TRIAL_SWITCH: TrialAnalysisView ACTIVATED (cache hit) for trial ${e.trial.id}`)}),xe(()=>{P.info(`V4_TRIAL_SWITCH: TrialAnalysisView DEACTIVATED (cached) for trial ${e.trial.id}`)}),be(()=>{P.info(`V4_TRIAL_SWITCH: TrialAnalysisView UNMOUNTED (evicted) for trial ${e.trial.id}`)}),(t,a)=>(u(),f("div",uu,[$(lu,{trial:t.trial,progress:t.progress,"is-executing":t.isExecuting,"api-calls":t.apiCalls,"is-streaming":t.isStreaming,"is-loading":t.isLoading},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])]))}}),cu=ae(du,[["__scopeId","data-v-602f5d5a"]]);function pu(o,e){const t=new Set,a=new Set,n=new Set;o.forEach(h=>{h.variables&&Object.keys(h.variables).forEach(g=>t.add(g)),h.variableAttributes&&Object.values(h.variableAttributes).forEach(g=>{g&&Object.keys(g).forEach(_=>a.add(_))})});const r=Array.from(t).sort(),l=Array.from(a).sort(),c=Array.from(n).sort(),d=[],m=["success","refused","parsed_response",...d,...c];return{categorical:[...r,...l,"model","status","error_type"],numeric:["response_time","total_tokens","prompt_tokens","completion_tokens",...d].sort(),extracted:m}}function Le(o,e,t){switch(e){case"model":return t&&o.configurationIndex<t.configurations.length&&t.configurations[o.configurationIndex].modelId||"Unknown";case"status":return o.status;case"response_time":return o.response?.latencyMs||0;case"total_tokens":if(o.response?.body?.usage){const a=o.response.body.usage;return a.total_tokens||a.prompt_tokens+a.completion_tokens||0}return 0;case"prompt_tokens":return o.response?.body?.usage?.prompt_tokens||o.response?.body?.usage?.input_tokens||0;case"completion_tokens":return o.response?.body?.usage?.completion_tokens||o.response?.body?.usage?.output_tokens||0;case"error_type":return o.result?.errorType||(o.result?.success===!1?"api_error":"success");case"success":return o.result?.success?1:0;case"refused":return o.result?.refused?1:0;case"parsed_response":if(o.result?.parsedContent!==void 0){const a=o.result.parsedContent;return typeof a=="object"?JSON.stringify(a):a}return null}if(o.variables?.[e]!==void 0)return o.variables[e];if(o.variableAttributes)for(const a of Object.keys(o.variableAttributes)){const n=o.variableAttributes[a];if(n&&n[e]!==void 0)return n[e]}return null}const Ae={count:{label:"Count",calculate:o=>o.length,format:o=>o.toString(),needsNumeric:!1},sum:{label:"Sum",calculate:o=>{const e=o.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0):null},format:o=>o?.toFixed(2)||"-",needsNumeric:!0},mean:{label:"Mean",calculate:o=>{const e=o.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0)/e.length:null},format:o=>o?.toFixed(2)||"-",needsNumeric:!0},median:{label:"Median",calculate:o=>{const e=o.map(n=>typeof n=="number"?n:null).filter(n=>n!==null);if(e.length===0)return null;const t=[...e].sort((n,r)=>n-r),a=Math.floor(t.length/2);return t.length%2===0?(t[a-1]+t[a])/2:t[a]},format:o=>o?.toFixed(2)||"-",needsNumeric:!0},mode:{label:"Mode",calculate:o=>{if(o.length===0)return null;const e=new Map;o.forEach(n=>e.set(n,(e.get(n)||0)+1));let t=0,a=null;return e.forEach((n,r)=>{n>t&&(t=n,a=r)}),{value:a,count:t,total:o.length}},format:o=>o?`${o.value} (${o.count}/${o.total})`:"-",needsNumeric:!1},variance:{label:"Variance",calculate:o=>{const e=o.map(n=>typeof n=="number"?n:null).filter(n=>n!==null);if(e.length<=1)return null;const t=e.reduce((n,r)=>n+r,0)/e.length;return e.reduce((n,r)=>n+Math.pow(r-t,2),0)/(e.length-1)},format:o=>o?.toFixed(3)||"-",needsNumeric:!0},std_dev:{label:"Std Dev",calculate:o=>{const e=Ae.variance.calculate(o);return e!==null?Math.sqrt(e):null},format:o=>o?.toFixed(3)||"-",needsNumeric:!0},min:{label:"Min",calculate:o=>{const e=o.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.min(...e):null},format:o=>o?.toFixed(2)||"-",needsNumeric:!0},max:{label:"Max",calculate:o=>{const e=o.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.max(...e):null},format:o=>o?.toFixed(2)||"-",needsNumeric:!0},success_rate:{label:"Success Rate",calculate:(o,e)=>{const t=e.filter(a=>a.result?.success).length;return e.length>0?t/e.length:0},format:o=>`${Math.round(o*100)}%`,needsNumeric:!1,usesApiCalls:!0},refusal_rate:{label:"Refusal Rate",calculate:(o,e)=>{const t=e.filter(a=>a.result?.refused).length;return e.length>0?t/e.length:0},format:o=>`${Math.round(o*100)}%`,needsNumeric:!1,usesApiCalls:!0},avg_time:{label:"Avg Time (ms)",calculate:(o,e)=>{const t=e.filter(a=>a.response?.latencyMs).map(a=>a.response.latencyMs);return t.length>0?t.reduce((a,n)=>a+n,0)/t.length:null},format:o=>o?`${Math.round(o)}ms`:"-",needsNumeric:!1,usesApiCalls:!0}};function wt(o,e,t){const a=performance.now(),n=new Map,r=new Set,l=new Set,c=new Map,d=(y,w)=>{c.has(w)||c.set(w,new Map);const N=c.get(w);return N.has(y)||N.set(y,Le(y,w,t)),N.get(y)};for(const y of o){const w=String(d(y,e.rowField)||"Unknown"),N=String(d(y,e.columnField)||"Unknown");r.add(w),l.add(N),n.has(w)||n.set(w,new Map);const v=n.get(w);v.has(N)||v.set(N,[]),v.get(N).push(y)}const m=performance.now()-a;m>50&&`${o.length}${m.toFixed(1)}`;const h=y=>y.every(N=>!isNaN(Number(N))&&N.trim()!=="")?y.sort((N,v)=>Number(N)-Number(v)):y.sort(),g=(y,w)=>(t&&(t.type,t.type),h(y)),_=e.rowSort==="original"?g(Array.from(r),e.rowField):h(Array.from(r)),S=e.columnSort==="original"?g(Array.from(l),e.columnField):h(Array.from(l)),k=Ae[e.aggregation];function C(y,w=!1){const N=w?y.map(x=>d(x,e.valueField)):y.map(x=>Le(x,e.valueField,t));if(!k||typeof k.calculate!="function")return P.error("Invalid aggregation function:",e.aggregation,k),{value:null,count:y.length,apiCalls:y,rawValues:N,error:"Invalid aggregation function"};const v={nonNumeric:0,nullUndefined:0};return k.needsNumeric&&(v.nonNumeric=N.filter(x=>typeof x!="number").length),v.nullUndefined=N.filter(x=>x==null).length,{value:k.usesApiCalls?k.calculate(N,y):k.calculate(N),count:y.length,apiCalls:y,rawValues:N,excludedCounts:v}}const D=_.map(y=>{const w=[],N=[];return S.forEach(v=>{const p=n.get(y)?.get(v)||[];w.push(p.length>0?C(p,!0):null),N.push(...p)}),{label:y,cells:w,total:C(N,!0)}}),H=S.map(y=>{const w=[];return _.forEach(N=>{const v=n.get(N)?.get(y)||[];w.push(...v)}),C(w,!0)}),A=performance.now()-a;return A>100&&`${A.toFixed(1)}${o.length}`,{rows:D,columns:S,totals:H,grandTotal:C(o,!0)}}function _e(o,e){return!o||o.value===null?"-":Ae[e].format(o.value)}function fu(o){if(!o||Object.keys(o).length===0)return"";const e=[];return o.temperature!==void 0&&e.push(`T:${o.temperature}`),o.max_tokens!==void 0?e.push(`${o.max_tokens}t`):o.maxTokens!==void 0?e.push(`${o.maxTokens}t`):o.num_predict!==void 0&&e.push(`${o.num_predict}t`),o.top_p!==void 0&&e.push(`p:${o.top_p}`),o.top_k!==void 0&&e.push(`k:${o.top_k}`),e.length>0?`(${e.join(", ")})`:""}function mu(o,e,t,a=q({}),n={}){const{debounceMs:r=100}=n,l=q({rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}}),c=q({categorical:[],numeric:[],extracted:[]}),d=q(!1),m=q(0),h=j(()=>{const k=a.value;return Object.values(k).some(D=>D!=="")?o.value.filter(D=>{if(k.model&&k.model!==""){if(!t.value||D.configurationIndex>=t.value.configurations.length)return!1;const H=t.value.configurations[D.configurationIndex],A=H.modelId||"Unknown",y=fu(H.parameters);if((y?`${A} ${y}`:A)!==k.model)return!1}if(k.status&&k.status!==""&&D.status!==k.status)return!1;for(const[H,A]of Object.entries(k))if(A&&A!==""&&H!=="model"&&H!=="status"&&D.variables?.[H]!==A)return!1;return!0}):o.value}),g=Xe(()=>{if(h.value.length===0){l.value={rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}};return}d.value=!0;const k=performance.now();try{l.value=wt(h.value,e.value,t.value);const C=performance.now()-k;m.value=C,P.debug("Pivot data computed (config change)",{apiCallCount:h.value.length,computeTimeMs:C,rowCount:l.value.rows.length,columnCount:l.value.columns.length})}catch(C){P.error("Error computing pivot data",C)}finally{d.value=!1}},r),_=Xe(()=>{if(h.value.length===0){l.value={rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}};return}d.value=!0;const k=performance.now();try{l.value=wt(h.value,e.value,t.value);const C=performance.now()-k;m.value=C,P.debug("Pivot data computed (stream update)",{apiCallCount:h.value.length,computeTimeMs:C,rowCount:l.value.rows.length,columnCount:l.value.columns.length})}catch(C){P.error("Error computing pivot data",C)}finally{d.value=!1}},100),S=Xe(()=>{c.value=pu(o.value,t.value)},200);return re([e],()=>{g()},{deep:!0}),re(h,(k,C)=>{const D=typeof window<"u"?window.__trialDataStoreV4?.():null;if(D&&D.activeTab?.value!=="pivot"){`${D.activeTab?.value}`;return}const H=C?.length||0,A=k.length;(H!==A||A>0)&&_()},{immediate:!0}),re([o,t],()=>{`${o.value.length}`,S()},{immediate:!0}),S(),{pivotData:j(()=>l.value),availableFields:j(()=>c.value),isComputing:j(()=>d.value),lastComputeTime:j(()=>m.value),formatCellValue:_e,extractFieldValue:Le,aggregationFunctions:Ae}}const vu={class:"pivot-config-v3"},gu={class:"config-row"},hu={class:"config-group"},yu=["value","aria-label"],bu={label:"Categorical"},_u=["value"],Tu={class:"config-group sort-group"},ku=["value","aria-label"],Cu={class:"config-group"},$u=["value","aria-label"],wu={label:"Categorical"},Su=["value"],Iu={class:"config-group sort-group"},Eu=["value","aria-label"],Ru={class:"config-group"},Pu=["value","aria-label"],Fu={label:"Extracted Values"},xu=["value"],Au={label:"Numeric Fields"},Ou=["value"],Vu={class:"config-group"},Du=["value","aria-label"],Nu=ne({__name:"PivotConfigurationV3",props:{config:{},availableFields:{}},emits:["update-config"],setup(o,{emit:e}){const t=e;function a(r,l){t("update-config",r,l)}function n(r){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[r]||r.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase())}return(r,l)=>(u(),f("div",vu,[s("div",gu,[s("div",hu,[l[6]||(l[6]=s("label",{for:"pivot-row-field"},"Rows (Group by):",-1)),s("select",{id:"pivot-row-field",value:r.config.rowField,"aria-label":"Group rows by "+n(r.config.rowField),onChange:l[0]||(l[0]=c=>a("rowField",c.target.value))},[s("optgroup",bu,[(u(!0),f(ee,null,te(r.availableFields.categorical,c=>(u(),f("option",{key:c,value:c},T(n(c)),9,_u))),128))])],40,yu)]),s("div",Tu,[l[8]||(l[8]=s("label",{for:"pivot-row-sort"},"Sort Rows:",-1)),s("select",{id:"pivot-row-sort",value:r.config.rowSort||"original","aria-label":"Sort rows by "+(r.config.rowSort||"original")+" order",onChange:l[1]||(l[1]=c=>a("rowSort",c.target.value))},l[7]||(l[7]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,ku)]),s("div",Cu,[l[9]||(l[9]=s("label",{for:"pivot-column-field"},"Columns (Group by):",-1)),s("select",{id:"pivot-column-field",value:r.config.columnField,"aria-label":"Group columns by "+n(r.config.columnField),onChange:l[2]||(l[2]=c=>a("columnField",c.target.value))},[s("optgroup",wu,[(u(!0),f(ee,null,te(r.availableFields.categorical,c=>(u(),f("option",{key:c,value:c},T(n(c)),9,Su))),128))])],40,$u)]),s("div",Iu,[l[11]||(l[11]=s("label",{for:"pivot-column-sort"},"Sort Columns:",-1)),s("select",{id:"pivot-column-sort",value:r.config.columnSort||"original","aria-label":"Sort columns by "+(r.config.columnSort||"original")+" order",onChange:l[3]||(l[3]=c=>a("columnSort",c.target.value))},l[10]||(l[10]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,Eu)]),s("div",Ru,[l[12]||(l[12]=s("label",{for:"pivot-value-field"},"Values (Aggregate):",-1)),s("select",{id:"pivot-value-field",value:r.config.valueField,"aria-label":"Aggregate "+r.config.valueField+" values",onChange:l[4]||(l[4]=c=>a("valueField",c.target.value))},[s("optgroup",Fu,[(u(!0),f(ee,null,te(r.availableFields.extracted,c=>(u(),f("option",{key:c,value:c},T(c),9,xu))),128))]),s("optgroup",Au,[(u(!0),f(ee,null,te(r.availableFields.numeric,c=>(u(),f("option",{key:c,value:c},T(n(c)),9,Ou))),128))])],40,Pu)]),s("div",Vu,[l[14]||(l[14]=s("label",{for:"pivot-aggregation"},"Aggregation:",-1)),s("select",{id:"pivot-aggregation",value:r.config.aggregation,"aria-label":"Aggregation method: "+r.config.aggregation,onChange:l[5]||(l[5]=c=>a("aggregation",c.target.value))},l[13]||(l[13]=[xt('<optgroup label="Statistical" data-v-0d3a0d50><option value="mean" data-v-0d3a0d50>Mean</option><option value="median" data-v-0d3a0d50>Median</option><option value="variance" data-v-0d3a0d50>Variance</option><option value="std_dev" data-v-0d3a0d50>Std Dev</option><option value="min" data-v-0d3a0d50>Min</option><option value="max" data-v-0d3a0d50>Max</option><option value="sum" data-v-0d3a0d50>Sum</option></optgroup><optgroup label="Frequency" data-v-0d3a0d50><option value="count" data-v-0d3a0d50>Count</option><option value="mode" data-v-0d3a0d50>Mode</option></optgroup><optgroup label="Performance" data-v-0d3a0d50><option value="success_rate" data-v-0d3a0d50>Success Rate</option><option value="refusal_rate" data-v-0d3a0d50>Refusal Rate</option><option value="avg_time" data-v-0d3a0d50>Avg Time</option></optgroup>',3)]),40,Du)])])]))}}),Lu=ae(Nu,[["__scopeId","data-v-0d3a0d50"]]),Mu={class:"heatmap-controls-v3"},Uu={class:"color-scale-selector"},ju=["value","aria-label"],Bu={class:"gradient-mode-selector"},zu={class:"gradient-toggle",role:"group","aria-label":"Gradient mode selector"},Wu=["aria-pressed"],Hu=["aria-pressed"],Gu=["aria-pressed"],qu=["title","aria-label"],Ju=ne({__name:"PivotHeatmapV3",props:{selectedColorScale:{},gradientMode:{},isFullscreen:{type:Boolean}},emits:["update-color-scale","update-gradient-mode","toggle-fullscreen"],setup(o,{emit:e}){const t=e;function a(r){const l=r.target.value;t("update-color-scale",l)}function n(r){t("update-gradient-mode",r)}return(r,l)=>(u(),f("div",Mu,[s("div",Uu,[l[5]||(l[5]=s("label",{for:"heatmap-color-scale"},"Color Scale:",-1)),s("select",{id:"heatmap-color-scale",value:r.selectedColorScale,"aria-label":"Color scale: "+r.selectedColorScale,onChange:a},l[4]||(l[4]=[xt('<option value="blue-subtle" data-v-dcb6369b>Blue (Subtle)</option><option value="green-red" data-v-dcb6369b>Green-Red (Success)</option><option value="blue-yellow" data-v-dcb6369b>Blue-Yellow (Performance)</option><option value="purple-orange" data-v-dcb6369b>Purple-Orange (General)</option><option value="viridis" data-v-dcb6369b>Viridis</option><option value="inferno" data-v-dcb6369b>Inferno</option><option value="magma" data-v-dcb6369b>Magma</option><option value="plasma" data-v-dcb6369b>Plasma</option><option value="grayscale" data-v-dcb6369b>Grayscale</option>',9)]),40,ju)]),s("div",Bu,[l[6]||(l[6]=s("label",null,"Gradient Mode:",-1)),s("div",zu,[s("button",{type:"button",class:se(["toggle-btn",{active:r.gradientMode==="global"}]),"aria-pressed":r.gradientMode==="global",onClick:l[0]||(l[0]=c=>n("global"))}," Global ",10,Wu),s("button",{type:"button",class:se(["toggle-btn",{active:r.gradientMode==="column"}]),"aria-pressed":r.gradientMode==="column",onClick:l[1]||(l[1]=c=>n("column"))}," Per Column ",10,Hu),s("button",{type:"button",class:se(["toggle-btn",{active:r.gradientMode==="row"}]),"aria-pressed":r.gradientMode==="row",onClick:l[2]||(l[2]=c=>n("row"))}," Per Row ",10,Gu)])]),s("button",{type:"button",class:"fullscreen-btn",title:r.isFullscreen?"Exit Fullscreen":"Enter Fullscreen","aria-label":r.isFullscreen?"Exit fullscreen mode":"Enter fullscreen mode",onClick:l[3]||(l[3]=c=>r.$emit("toggle-fullscreen"))},T(r.isFullscreen?"⊟":"⊞"),9,qu)]))}}),Xu=ae(Ju,[["__scopeId","data-v-dcb6369b"]]),Ku={class:"pivot-filters-v3"},Yu={class:"filters-row"},Qu={key:0,class:"filter-group"},Zu=["value"],ed=["value"],td=["for"],sd=["id","value","aria-label","onChange"],ad={value:""},nd=["value"],rd={key:1,class:"filter-group"},od=["value"],id=["value"],ld=ne({__name:"PivotFiltersV3",props:{apiCalls:{},trial:{},activeFilters:{}},emits:["update-filters","clear-filters"],setup(o,{emit:e}){const t=o,a=e,n=q({});let r=0;const l=()=>{if(t.apiCalls.length===0){n.value={};return}const _={};t.apiCalls.forEach(k=>{if(t.trial&&k.configurationIndex<t.trial.configurations.length){const C=t.trial.configurations[k.configurationIndex],D=C.modelId||"Unknown",H=m(C.parameters),A=H?`${D} ${H}`:D;_.model||(_.model=new Set),_.model.add(A)}k.status&&(_.status||(_.status=new Set),_.status.add(k.status)),k.variables&&Object.entries(k.variables).forEach(([C,D])=>{D&&String(D).trim()&&(_[C]||(_[C]=new Set),_[C].add(String(D)))})});const S={};Object.entries(_).forEach(([k,C])=>{S[k]=Array.from(C).sort()}),n.value=S};re(()=>t.apiCalls.length,_=>{(_===0||r===0||_-r>=5)&&(l(),r=_)},{immediate:!0});const c=j(()=>{const{model:_,status:S,...k}=n.value;return k}),d=j(()=>Object.values(t.activeFilters).some(_=>_!==""));function m(_){if(!_||Object.keys(_).length===0)return"";const S=[];return _.temperature!==void 0&&S.push(`T:${_.temperature}`),_.max_tokens!==void 0?S.push(`${_.max_tokens}t`):_.maxTokens!==void 0?S.push(`${_.maxTokens}t`):_.num_predict!==void 0&&S.push(`${_.num_predict}t`),_.top_p!==void 0&&S.push(`p:${_.top_p}`),_.top_k!==void 0&&S.push(`k:${_.top_k}`),S.length>0?`(${S.join(", ")})`:""}function h(_){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",extracted_value:"Extracted Value"}[_]||_.replace(/_/g," ").replace(/\b\w/g,k=>k.toUpperCase())}function g(_,S){const k={...t.activeFilters};S===""?delete k[_]:k[_]=S,a("update-filters",k)}return(_,S)=>(u(),f("div",Ku,[s("div",Yu,[n.value.model&&n.value.model.length>1?(u(),f("div",Qu,[S[4]||(S[4]=s("label",{for:"filter-model",class:"filter-label"},"Model:",-1)),s("select",{id:"filter-model",value:_.activeFilters.model||"",class:"filter-select","aria-label":"Filter by model",onChange:S[0]||(S[0]=k=>g("model",k.target.value))},[S[3]||(S[3]=s("option",{value:""},"All Models",-1)),(u(!0),f(ee,null,te(n.value.model,k=>(u(),f("option",{key:k,value:k},T(k),9,ed))),128))],40,Zu)])):R("",!0),(u(!0),f(ee,null,te(c.value,(k,C)=>(u(),f("div",{key:C,class:"filter-group"},[s("label",{for:`filter-${C}`,class:"filter-label"},T(h(String(C)))+": ",9,td),s("select",{id:`filter-${C}`,value:_.activeFilters[C]||"",class:"filter-select","aria-label":`Filter by ${h(String(C))}`,onChange:D=>g(String(C),D.target.value)},[s("option",ad,"All "+T(h(String(C))),1),(u(!0),f(ee,null,te(k,D=>(u(),f("option",{key:D,value:D},T(D),9,nd))),128))],40,sd)]))),128)),n.value.status&&n.value.status.length>1?(u(),f("div",rd,[S[6]||(S[6]=s("label",{for:"filter-status",class:"filter-label"},"Status:",-1)),s("select",{id:"filter-status",value:_.activeFilters.status||"",class:"filter-select","aria-label":"Filter by status",onChange:S[1]||(S[1]=k=>g("status",k.target.value))},[S[5]||(S[5]=s("option",{value:""},"All Statuses",-1)),(u(!0),f(ee,null,te(n.value.status,k=>(u(),f("option",{key:k,value:k},T(k),9,id))),128))],40,od)])):R("",!0),d.value?(u(),f("button",{key:2,type:"button",class:"clear-filters-btn",title:"Clear all filters","aria-label":"Clear all filters",onClick:S[2]||(S[2]=k=>_.$emit("clear-filters"))}," Clear Filters ")):R("",!0)])]))}}),ud=ae(ld,[["__scopeId","data-v-d5848163"]]),dd={class:"collapse-icon"},cd={class:"options-content"},pd={class:"controls-row"},fd={key:0,class:"performance-info"},md={class:"table-view"},vd={key:0,class:"empty-state","data-testid":"empty-data-message"},gd={key:1,class:"error-state","data-testid":"invalid-aggregation-error"},hd={key:2,class:"loading-state","data-testid":"computing-state"},yd={key:3,class:"pivot-table-container"},bd={class:"pivot-table-grid responsive-table",role:"table"},_d={role:"row"},Td={class:"corner-cell",role:"columnheader"},kd={key:0,class:"total-header",role:"columnheader"},Cd={class:"row-header",role:"rowheader"},$d=["data-testid","title","aria-label","role","onClick","onKeydown"],wd={key:0,class:"cell-content"},Sd=["title"],Id={class:"cell-value"},Ed={class:"error-message"},Rd={key:1},Pd=ne({__name:"PivotTableV3",props:{apiCalls:{},trial:{default:null},config:{},maxTableRows:{default:1e4},showTotals:{type:Boolean,default:!0},showPerformanceInfo:{type:Boolean,default:!1}},emits:["config-change","cell-click"],setup(o,{emit:e}){const t=o,a=e,n=q(!1),r=q("blue-yellow"),l=q("global"),c=q(!1),d=q({rowField:t.config?.rowField||"",columnField:t.config?.columnField||"",valueField:t.config?.valueField||"",aggregation:t.config?.aggregation||"mean",rowSort:t.config?.rowSort||"original",columnSort:t.config?.columnSort||"original"});re(()=>t.config,b=>{b&&Object.assign(d.value,b)},{deep:!0});const m=q({}),h=We(),g=j(()=>h.apiCalls?h.apiCalls.value||[]:t.apiCalls||[]),_=g,S=j(()=>t.trial),{pivotData:k,availableFields:C,isComputing:D,lastComputeTime:H}=mu(_,d,S,m,{debounceMs:750});re(k,(b,B)=>{const J=performance.now(),X=b?.rows?.length||0,oe=b?.columns?.length||0;P.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData computed: ${X}x${oe} matrix`),setTimeout(()=>{const ce=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData render completed in ${(ce-J).toFixed(1)}ms`)},0)}),re(D,b=>{b?P.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING STARTED with ${g.value.length} API calls`):P.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING FINISHED in ${H.value.toFixed(1)}ms`)}),re(g,(b,B)=>{const J=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls changed from ${B?.length||0} to ${b.length} calls`),setTimeout(()=>{const X=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls prop update completed in ${(X-J).toFixed(1)}ms`)},0)});const A=j(()=>k.value.rows.slice(0,t.maxTableRows)),y=j(()=>Object.values(m.value).some(B=>B!=="")?g.value.filter(B=>{if(m.value.model&&m.value.model!==""){if(!t.trial||B.configurationIndex>=t.trial.configurations.length)return!1;const J=t.trial.configurations[B.configurationIndex],X=J.modelId||"Unknown",oe=p(J.parameters);if((oe?`${X} ${oe}`:X)!==m.value.model)return!1}if(m.value.status&&m.value.status!==""&&B.status!==m.value.status)return!1;for(const[J,X]of Object.entries(m.value))if(X&&X!==""&&J!=="model"&&J!=="status"&&B.variables?.[J]!==X)return!1;return!0}).length:g.value.length),{getCellStyle:w,getSummaryStyle:N,styleKey:v}=ca(k,r,l);function p(b){if(!b||Object.keys(b).length===0)return"";const B=[];return b.temperature!==void 0&&B.push(`T:${b.temperature}`),b.max_tokens!==void 0?B.push(`${b.max_tokens}t`):b.maxTokens!==void 0?B.push(`${b.maxTokens}t`):b.num_predict!==void 0&&B.push(`${b.num_predict}t`),b.top_p!==void 0&&B.push(`p:${b.top_p}`),b.top_k!==void 0&&B.push(`k:${b.top_k}`),B.length>0?`(${B.join(", ")})`:""}function U(b){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[b]||b.replace(/_/g," ").replace(/\b\w/g,J=>J.toUpperCase())}function x(b,B,J){if(!J)return`${b} × ${B}: No data`;const X=_e(J,d.value.aggregation);let oe=`${b} × ${B}: ${X} (${J.count} calls)`;if(J.excludedCounts){const ce=[];J.excludedCounts.nonNumeric>0&&ce.push(`${J.excludedCounts.nonNumeric} non-numeric responses excluded`),J.excludedCounts.nullUndefined>0&&ce.push(`${J.excludedCounts.nullUndefined} null/empty responses`),ce.length>0&&(oe+=` | ${ce.join(", ")}`)}return J.error&&(oe+=` - ERROR: ${J.error}`),oe}function i(b,B,J){if(!J)return`${b} by ${B}: No data`;const X=_e(J,d.value.aggregation);return J.error?`${b} by ${B}: ${X} with data integrity error: ${J.error}`:`${b} by ${B}: ${X} from ${J.count} API calls`}function O(b,B){(b==="rowField"||b==="columnField"||b==="valueField"||b==="aggregation"||b==="rowSort"||b==="columnSort")&&(d.value[b]=B),a("config-change",{...d.value})}function I(b){m.value={...b}}function E(){m.value={}}function G(b,B,J){J&&a("cell-click",{row:b,column:B,cell:J})}function V(){c.value=!c.value}function Y(){n.value=!n.value,n.value?document.body.style.overflow="hidden":document.body.style.overflow=""}return fe(()=>{const b=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 MOUNTED for trial ${t.trial?.id||"unknown"} with ${g.value.length} calls`),ke(()=>{const B=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 DOM ready in ${(B-b).toFixed(1)}ms`)}),setTimeout(()=>{const B=performance.now();P.info(`V4_TRIAL_SWITCH: PivotTableV3 mount completed in ${(B-b).toFixed(1)}ms`)},0)}),Fe(()=>{P.info(`V4_TRIAL_SWITCH: PivotTableV3 ACTIVATED (cache hit) for trial ${t.trial?.id||"unknown"} with ${g.value.length} calls`)}),xe(()=>{P.info(`V4_TRIAL_SWITCH: PivotTableV3 DEACTIVATED (cached) for trial ${t.trial?.id||"unknown"}`)}),be(()=>{P.info(`V4_TRIAL_SWITCH: PivotTableV3 UNMOUNTED (evicted) for trial ${t.trial?.id||"unknown"}`),n.value&&(document.body.style.overflow="")}),re([C,g],([b])=>{if(g.value.length>0&&(!d.value.rowField||d.value.rowField==="")&&b.categorical.length>0){if(d.value.rowField=b.categorical.find(B=>B!=="model"&&B!=="status"&&B!=="error_type")||b.categorical[0]||"model",d.value.columnField=d.value.columnField||"model",d.value.valueField=d.value.valueField||"parsed_response",!d.value.aggregation||d.value.aggregation===""){const B=g.value.slice(0,3).map(X=>Le(X,d.value.valueField,t.trial)).filter(X=>X!=null),J=B.length>0&&B.every(X=>typeof X=="number");d.value.aggregation=J?"mean":"mode"}a("config-change",{...d.value})}},{immediate:!0}),(b,B)=>(u(),f("div",{class:se(["pivot-table-v3",{fullscreen:n.value}])},[s("div",{class:se(["pivot-options-container",{collapsed:c.value}])},[s("div",{class:"options-header",onClick:V},[B[3]||(B[3]=s("span",{class:"options-title"},"Pivot Table Options",-1)),s("span",dd,T(c.value?"▶":"▼"),1)]),Se(s("div",cd,[Ss([z(C),d.value],()=>(u(),f("div",null,[$(Lu,{config:d.value,"available-fields":z(C),onUpdateConfig:O},null,8,["config","available-fields"])])),B,0),s("div",pd,[g.value.length>0?(u(),K(ud,{key:0,"api-calls":g.value,trial:b.trial,"active-filters":m.value,onUpdateFilters:I,onClearFilters:E},null,8,["api-calls","trial","active-filters"])):R("",!0),$(Xu,{"selected-color-scale":r.value,"gradient-mode":l.value,"is-fullscreen":n.value,onUpdateColorScale:B[1]||(B[1]=J=>r.value=J),onUpdateGradientMode:B[2]||(B[2]=J=>l.value=J),onToggleFullscreen:Y},null,8,["selected-color-scale","gradient-mode","is-fullscreen"])])],512),[[At,!c.value]])],2),b.showPerformanceInfo?(u(),f("div",fd,[s("span",null,"Computing: "+T(z(D)?"Yes":"No"),1),s("span",null,"Last Compute: "+T(z(H).toFixed(1))+"ms",1),s("span",null,"API Calls: "+T(g.value.length),1),s("span",null,"Filtered: "+T(y.value),1)])):R("",!0),s("div",md,[g.value.length===0?(u(),f("div",vd,B[4]||(B[4]=[s("p",null,"No data available for pivot table analysis.",-1)]))):d.value.aggregation in z(Ae)?z(D)?(u(),f("div",hd,B[6]||(B[6]=[s("p",null,"Computing pivot table...",-1)]))):(u(),f("div",yd,[s("table",bd,[s("thead",null,[s("tr",_d,[s("th",Td,T(U(d.value.rowField)||"Items")+" / "+T(U(d.value.columnField)||"Aggregated"),1),(u(!0),f(ee,null,te(z(k).columns,J=>(u(),f("th",{key:J,class:"column-header",role:"columnheader"},T(J),1))),128)),d.value.columnField&&b.showTotals?(u(),f("th",kd," Total ")):R("",!0)])]),s("tbody",null,[(u(!0),f(ee,null,te(A.value,J=>(u(),f("tr",{key:`${J.label}-${z(v)}`,class:"data-row",role:"row"},[s("td",Cd,T(J.label),1),(u(!0),f(ee,null,te(J.cells,(X,oe)=>(u(),f("td",{key:`${oe}-${z(v)}`,class:se(["data-cell",{"error-cell":X?.error}]),"data-testid":X?.error?"pivot-cell-error":"pivot-cell",style:ye(z(w)(X,J.label,oe)),title:x(J.label,z(k).columns[oe],X),"aria-label":i(J.label,z(k).columns[oe],X),role:X?.error?"alert":"cell",tabindex:"0",onClick:ce=>G(J.label,z(k).columns[oe],X),onKeydown:[Ze(ce=>G(J.label,z(k).columns[oe],X),["enter"]),Ze(Ot(ce=>G(J.label,z(k).columns[oe],X),["prevent"]),["space"])]},[X?.error?(u(),f("div",wd,[s("span",{class:"error-indicator",title:X.error},"⚠️",8,Sd),s("span",Id,T(X?z(_e)(X,d.value.aggregation):"-"),1),s("div",Ed,T(X.error),1)])):(u(),f("span",Rd,T(X?z(_e)(X,d.value.aggregation):"-"),1))],46,$d))),128)),d.value.columnField&&b.showTotals?(u(),f("td",{key:0,class:"total-cell",style:ye(z(N)(J.total)),role:"cell"},T(z(_e)(J.total,d.value.aggregation)),5)):R("",!0)]))),128)),d.value.rowField&&b.showTotals?(u(),f("tr",{key:`totals-${z(v)}`,class:"total-row",role:"row"},[B[7]||(B[7]=s("td",{class:"row-header",role:"rowheader"},"Total",-1)),(u(!0),f(ee,null,te(z(k).totals,(J,X)=>(u(),f("td",{key:`total-${X}-${z(v)}`,class:"total-cell",style:ye(z(N)(J)),role:"cell"},T(z(_e)(J,d.value.aggregation)),5))),128)),d.value.columnField?(u(),f("td",{key:0,class:"grand-total-cell",style:ye(z(N)(z(k).grandTotal)),role:"cell"},T(z(_e)(z(k).grandTotal,d.value.aggregation)),5)):R("",!0)])):R("",!0)])])])):(u(),f("div",gd,[s("p",null,"Invalid aggregation function: "+T(d.value.aggregation),1),B[5]||(B[5]=s("p",null,"Please select a valid aggregation method.",-1))]))])],2))}}),Fd=ae(Pd,[["__scopeId","data-v-edba4039"]]),xd={class:"modal-content"},Ad={class:"modal-header"},Od={class:"modal-title"},Vd={class:"summary-row"},Dd={key:0},Nd={key:0,class:"filter-row"},Ld=["onUpdate:modelValue","aria-label"],Md={value:""},Ud=["value"],jd={class:"table-container"},Bd={class:"api-calls-table"},zd=["onClick"],Wd=["title"],Hd=["title"],Gd=ne({__name:"PivotCellDetailV3",props:{visible:{type:Boolean},row:{},column:{},apiCalls:{},trial:{},value:{}},emits:["close"],setup(o){const e=o,t=Is({}),a=q(null),{formatSingleCost:n}=mt(),r=j(()=>{const p=new Set;return e.apiCalls.forEach(U=>{U.variables&&Object.keys(U.variables).forEach(x=>p.add(x)),U.attributedVariables&&Object.entries(U.attributedVariables).forEach(([x,i])=>{i&&typeof i=="object"&&Object.keys(i).forEach(O=>{p.add(`${x}.${O}`)})})}),Array.from(p).sort()}),l=j(()=>r.value.map(p=>({title:p,dataIndex:`var_${p}`,key:`var_${p}`,width:150}))),c=[{title:"Status",dataIndex:"status",key:"status",width:100},{title:"Model",dataIndex:"model",key:"model",width:150}],d=[{title:"Response",dataIndex:"response",key:"response",width:300},{title:"Parsed Content",dataIndex:"parsedContent",key:"parsedContent",width:150},{title:"Duration",dataIndex:"duration",key:"duration",width:100},{title:"Cost",dataIndex:"cost",key:"cost",width:100}],m=j(()=>[...c,...l.value,...d]),h=j(()=>`${e.row} × ${e.column} - ${e.apiCalls.length} API Calls`),g=j(()=>e.apiCalls.map(p=>{const U={id:p.id,status:p.status,model:p.modelName||"-",response:p.result?.content||p.result?.error||"-",parsedContent:H(p.result?.parsedContent),duration:p.duration!==void 0?`${p.duration}ms`:"-",cost:p.cost!==void 0?p.cost:"-"};return r.value.forEach(x=>{if(x.includes(".")){const[i,O]=x.split("."),I=p.attributedVariables?.[i]?.[O];U[`var_${x}`]=I!==void 0?String(I):"-"}else U[`var_${x}`]=p.variables?.[x]||"-"}),U})),_=j(()=>Object.values(t).some(p=>p!==void 0&&p!=="")),S=j(()=>_.value?g.value.filter(p=>Object.entries(t).every(([U,x])=>x?p[U]===x:!0)):g.value),k=j(()=>{const p=e.apiCalls.filter(U=>U.status==="completed").length;return Math.round(p/e.apiCalls.length*100)}),C=j(()=>{const p=e.apiCalls.filter(U=>U.duration).map(U=>U.duration);return p.length===0?0:Math.round(p.reduce((U,x)=>U+x,0)/p.length)}),D=j(()=>{const p=e.apiCalls.filter(U=>U.cost!==void 0).map(U=>U.cost);if(p.length!==0)return p.reduce((U,x)=>U+x,0)});function H(p){if(p==null)return"-";if(typeof p=="string")return p;if(typeof p=="number"||typeof p=="boolean")return String(p);if(typeof p=="object")try{return JSON.stringify(p,null,2).substring(0,100)}catch{return"[Object]"}return String(p)}function A(p){switch(p){case"completed":return"status-success";case"failed":return"status-error";case"pending":return"status-warning";case"running":return"status-processing";default:return"status-default"}}function y(p,U=200){if(!p)return"";if(p.length<=U)return p;const x=p.slice(0,100),i=p.slice(-100);return`${x} [...TRUNCATED...] ${i}`}function w(p){const U=new Set;return g.value.forEach(x=>{const i=x[p];i&&i!=="-"&&U.add(i)}),Array.from(U).sort()}function N(){Object.keys(t).forEach(p=>{delete t[p]})}function v(p){const U=e.apiCalls.find(x=>x.id===p.id);U&&(a.value=U)}return(p,U)=>(u(),f(ee,null,[s("div",{class:se(["pivot-cell-detail-modal-v3",{visible:p.visible}]),onClick:U[1]||(U[1]=Ot(x=>p.$emit("close"),["self"]))},[s("div",xd,[s("div",Ad,[s("h3",Od,T(h.value),1),s("button",{type:"button",class:"close-btn","aria-label":"Close modal",onClick:U[0]||(U[0]=x=>p.$emit("close"))}," × ")]),s("div",Vd,[s("span",null,[U[3]||(U[3]=s("b",null,"Total:",-1)),L(" "+T(p.apiCalls.length),1)]),s("span",null,[U[4]||(U[4]=s("b",null,"Success Rate:",-1)),L(" "+T(k.value)+"%",1)]),s("span",null,[U[5]||(U[5]=s("b",null,"Avg Duration:",-1)),L(" "+T(C.value)+"ms",1)]),D.value!==void 0?(u(),f("span",Dd,[U[6]||(U[6]=s("b",null,"Total Cost:",-1)),L(" "+T(z(n)(D.value)),1)])):R("",!0)]),l.value.length>0?(u(),f("div",Nd,[(u(!0),f(ee,null,te(l.value,x=>(u(),f("div",{key:x.key,class:"variable-filter"},[Se(s("select",{"onUpdate:modelValue":i=>t[x.key]=i,"aria-label":`Filter ${x.title}`,class:"filter-select"},[s("option",Md,"All "+T(x.title),1),(u(!0),f(ee,null,te(w(x.key),i=>(u(),f("option",{key:i,value:i},T(i),9,Ud))),128))],8,Ld),[[Es,t[x.key]]])]))),128)),_.value?(u(),f("button",{key:0,type:"button",class:"clear-filters-btn",onClick:N}," Clear Filters ")):R("",!0)])):R("",!0),s("div",jd,[s("table",Bd,[s("thead",null,[s("tr",null,[(u(!0),f(ee,null,te(m.value,x=>(u(),f("th",{key:x.key,class:"table-header",style:ye({width:x.width?`${x.width}px`:"auto"})},T(x.title),5))),128))])]),s("tbody",null,[(u(!0),f(ee,null,te(S.value,x=>(u(),f("tr",{key:x.id,class:"table-row clickable-row",onClick:i=>v(x)},[(u(!0),f(ee,null,te(m.value,i=>(u(),f("td",{key:i.key,class:se(["table-cell",{"status-cell":i.key==="status"}])},[i.key==="status"?(u(),f("span",{key:0,class:se(["status-tag",A(x.status)])},T(x.status),3)):i.key==="response"?(u(),f("span",{key:1,class:"response-cell",title:x.response},T(y(x.response)),9,Wd)):i.key==="cost"?(u(),f(ee,{key:2},[L(T(x.cost==="-"?"-":z(n)(x.cost)),1)],64)):i.key.startsWith("var_")?(u(),f("span",{key:3,class:"variable-cell",title:x[i.key]},T(x[i.key]||"-"),9,Hd)):(u(),f(ee,{key:4},[L(T(x[i.key]||"-"),1)],64))],2))),128))],8,zd))),128))])])])])],2),a.value?(u(),K(es,{key:0,visible:!!a.value,"api-call":a.value,trial:p.trial,"onUpdate:visible":U[2]||(U[2]=x=>a.value=null)},null,8,["visible","api-call","trial"])):R("",!0)],64))}}),qd=ae(Gd,[["__scopeId","data-v-ddbda380"]]),Jd={class:"trial-tab-content"},Xd={class:"tab-pane-content"},Kd={class:"tab-pane-content"},Yd={key:0,class:"no-data-message"},Qd={class:"tab-pane-content"},St="trial-details-active-tab",Zd=ne({__name:"TrialTabContentV3",props:{trial:{},progress:{},isLeader:{type:Boolean},executionState:{}},setup(o){const e=o,t=Vt(),a=Be(),n=We(),r=j(()=>n.apiCalls?.value||[]),l=j(()=>n.isStreaming?.value||!1);re(r,(A,y)=>{const w=performance.now();P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls changed from ${y?.length||0} to ${A.length} calls`),setTimeout(()=>{const N=performance.now();P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls reactive update completed in ${(N-w).toFixed(1)}ms`)},0)});const c=j(()=>!1),m=q((()=>{const A=t.query.tab;return A==="status"?"details":A&&["details","tasks","pivot"].includes(A)?A:"tasks"})()),h=q(!1);re(m,A=>{n.setActiveTab(A)},{immediate:!0});const g=q(!1),_=q({row:"",column:"",apiCalls:[],value:null}),S=j(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial.id),k=j(()=>e.trial.progress.completed>0);function C(){localStorage.setItem(St,m.value);const A={...t.query};A.tab=m.value,t.query.tab!==m.value&&(a.replace({query:A}),`${m.value}`)}function D(){const A=localStorage.getItem(St);A==="status"?m.value="details":A&&["details","tasks","pivot"].includes(A)&&(m.value=A)}function H(A){!A.cell||!A.cell.apiCalls.length||(_.value={row:A.row,column:A.column,apiCalls:A.cell.apiCalls,value:A.cell.value},g.value=!0)}return re(m,()=>{C()}),re(()=>t.query.tab,A=>{if(A&&typeof A=="string"){let y=A==="status"?"details":A;["details","tasks","pivot"].includes(y)&&m.value!==y&&(m.value=y)}}),fe(()=>{const A=performance.now();if(P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 MOUNTED for trial ${e.trial.id}`),!t.query.tab){const y={...t.query};y.tab=m.value,a.replace({query:y}),`${m.value}`}D(),setTimeout(()=>{const y=performance.now();P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 mount completed in ${(y-A).toFixed(1)}ms`)},0)}),Fe(()=>{P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 ACTIVATED (cache hit) for trial ${e.trial.id}`)}),xe(()=>{P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 DEACTIVATED (cached) for trial ${e.trial.id}`)}),be(()=>{P.info(`V4_TRIAL_SWITCH: TrialTabContentV3 UNMOUNTED (evicted) for trial ${e.trial.id}`)}),(A,y)=>{const w=sa,N=ta;return u(),f("div",Jd,[$(N,{activeKey:m.value,"onUpdate:activeKey":y[1]||(y[1]=v=>m.value=v),type:"card",class:"trial-tabs"},{default:F(()=>[$(w,{key:"tasks",tab:"Task View"},{default:F(()=>[s("div",Xd,[(u(),K(et,null,[$(cu,{trial:A.trial,progress:A.progress,"is-executing":S.value,"api-calls":r.value,"is-streaming":l.value,"is-loading":c.value},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])],1024))])]),_:1}),$(w,{key:"pivot",tab:"Pivot Table"},{default:F(()=>[s("div",Kd,[(u(),K(et,null,[k.value&&r.value.length>0?(u(),K(Fd,{key:0,"api-calls":r.value,trial:A.trial,"show-performance-info":!1,onCellClick:H},null,8,["api-calls","trial"])):R("",!0)],1024)),k.value&&r.value.length>0?R("",!0):(u(),f("div",Yd,y[3]||(y[3]=[s("p",null,"No completed API calls available for pivot analysis.",-1),s("p",null,"Run the trial to see pivot table data.",-1)])))])]),_:1}),$(w,{key:"details",tab:"Details"},{default:F(()=>[s("div",Qd,[$(oo,{trial:A.trial,"is-collapsed":h.value,onToggleCollapse:y[0]||(y[0]=v=>h.value=!h.value)},null,8,["trial","is-collapsed"])])]),_:1})]),_:1},8,["activeKey"]),g.value?(u(),K(qd,{key:0,visible:g.value,row:_.value.row,column:_.value.column,"api-calls":_.value.apiCalls,trial:A.trial,value:_.value.value,onClose:y[2]||(y[2]=v=>g.value=!1)},null,8,["visible","row","column","api-calls","trial","value"])):R("",!0)])}}}),ec=ae(Zd,[["__scopeId","data-v-743ec3c1"]]);class ie extends Error{constructor(t,a,n){super(a);$e(this,"code");$e(this,"details");this.name="ExportError",this.code=t,this.details=n}}function Me(o){return typeof TextEncoder<"u"?new TextEncoder().encode(o).length:typeof Buffer<"u"?Buffer.byteLength(o,"utf8"):unescape(encodeURIComponent(o)).length}const ue=class ue{async loadTrialForExport(e){try{const t=this.getCachedData(e);if(t)return{ok:!0,value:t};const a=await Ie.trials.get(e);if(!a)return{ok:!1,error:new ie("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})};const n=await Ie.apiCalls.where("trialId").equals(e).toArray(),r={trial:a,apiCalls:n,fieldDefinitions:[],parameterFields:[],totalRecords:n.length};return this.setCachedData(e,r),{ok:!0,value:r}}catch(t){return{ok:!1,error:new ie("GENERATION_FAILED",`Failed to load trial data: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateTrialForExport(e){try{return await Ie.trials.get(e)?await Ie.apiCalls.where("trialId").equals(e).count()===0?{ok:!1,error:new ie("GENERATION_FAILED","Trial has no API calls to export",{trialId:e,apiCallCount:0})}:{ok:!0,value:!0}:{ok:!1,error:new ie("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})}}catch(t){return{ok:!1,error:new ie("GENERATION_FAILED",`Failed to validate trial: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async getApiCallCount(e){try{return await Ie.apiCalls.where("trialId").equals(e).count()}catch(t){return P.warn(`Failed to get API call count for trial ${e}:`,t),0}}clearCache(e){ue.cache.delete(e),ue.cacheExpiry.delete(e)}clearAllCache(){ue.cache.clear(),ue.cacheExpiry.clear()}getCachedData(e){const t=ue.cacheExpiry.get(e);return!t||Date.now()>t?(ue.cache.delete(e),ue.cacheExpiry.delete(e),null):ue.cache.get(e)||null}setCachedData(e,t){ue.cache.set(e,t),ue.cacheExpiry.set(e,Date.now()+ue.CACHE_TTL)}};$e(ue,"cache",new Map),$e(ue,"cacheExpiry",new Map),$e(ue,"CACHE_TTL",6e4);let rt=ue;const Ee=new rt;class tc{discoverAllParameters(e){const t=new Map;return e.configurations.forEach((a,n)=>{!a.parameters||typeof a.parameters!="object"||Object.entries(a.parameters).forEach(([r,l])=>{const c=`param_${r}`;t.has(c)||t.set(c,{parameterName:r,fieldId:c,usedByConfigurations:[],dataType:this.inferDataType(l),sampleValues:[]});const d=t.get(c);d.usedByConfigurations.push(n),d.sampleValues.length<3&&!d.sampleValues.includes(l)&&d.sampleValues.push(l)})}),Array.from(t.values()).map(a=>this.createParameterFieldDefinition(a,e)).sort((a,n)=>a.id.localeCompare(n.id))}getParameterUsageStats(e){const t=this.discoverAllParameters(e),a={},n=[],r=[];e.configurations.forEach((c,d)=>{const m=c.provider;a[m]||(a[m]=[]),t.forEach(h=>{h.usedByConfigurations.includes(d)&&(a[m].includes(h.parameterName)||a[m].push(h.parameterName))})});const l=Object.keys(a);return t.forEach(c=>{l.filter(m=>a[m].includes(c.parameterName)).length>1?n.push(c.parameterName):r.push(c.parameterName)}),{totalUniqueParameters:t.length,parametersByProvider:a,sharedParameters:n.sort(),providerSpecificParameters:r.sort()}}validateParameterFields(e,t){const n=this.discoverAllParameters(e).map(d=>d.id),r=t.filter(d=>d.startsWith("param_")),l=[],c=[];return r.forEach(d=>{n.includes(d)?l.push(d):c.push(d)}),{validFields:l,invalidFields:c,availableFields:n}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}createParameterFieldDefinition(e,t){const a=e.usedByConfigurations.map(r=>t.configurations[r]?.provider||"unknown").filter((r,l,c)=>c.indexOf(r)===l).sort(),n=this.generateParameterDescription(e,a);return{id:e.fieldId,name:e.parameterName,description:n,group:"parameters",dataType:e.dataType,isRequired:!1,parameterName:e.parameterName,usedByConfigurations:e.usedByConfigurations}}generateParameterDescription(e,t){const a=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(r=>JSON.stringify(r)).join(", ")})`:"";return`${t.length===1?`Used by ${t[0]}`:`Used by ${t.join(", ")}`}${a}. Empty for configurations that don't use this parameter.`}}const Ue=new tc;class sc{discoverAllVariables(e,t){e.id,t.length;const a=new Map,n=new Map;t.forEach(h=>{h.variables&&typeof h.variables=="object"&&Object.entries(h.variables).forEach(([g,_])=>{const S=`var_${g}`;a.has(S)||a.set(S,{variableName:g,fieldId:S,usedByCallCount:0,dataType:this.inferDataType(_),sampleValues:[]});const k=a.get(S);k.usedByCallCount++,k.sampleValues.length<3&&!k.sampleValues.includes(_)&&k.sampleValues.push(_)}),h.variableAttributes&&typeof h.variableAttributes=="object"&&Object.entries(h.variableAttributes).forEach(([g,_])=>{!_||typeof _!="object"||Object.entries(_).forEach(([S,k])=>{const C=`attr_${g}_${S}`;n.has(C)||n.set(C,{attributeName:S,fieldId:C,usedByCallCount:0,dataType:this.inferDataType(k),sampleValues:[]});const D=n.get(C);D.usedByCallCount++,D.sampleValues.length<3&&!D.sampleValues.includes(k)&&D.sampleValues.push(k)})})});const r=Array.from(a.values()).map(h=>this.createVariableFieldDefinition(h,t.length)),l=Array.from(n.values()).map(h=>this.createAttributeFieldDefinition(h,t.length)),c=[];t.some(h=>h.variableIndices&&Object.keys(h.variableIndices).length>0)&&Array.from(a.values()).forEach(h=>{const g=h.variableName;c.push({id:`source_${g}_list`,name:`${g} Source List`,description:`Name of the list that provided the value for ${g}`,group:"source",dataType:"string",isRequired:!1}),c.push({id:`source_${g}_index`,name:`${g} Source Index`,description:`Position in the list (0-based) for ${g}`,group:"source",dataType:"number",isRequired:!1})});const m=[...r,...l,...c].sort((h,g)=>h.id.localeCompare(g.id));return r.length,l.length,c.length,m.length,r.map(h=>h.id),l.map(h=>h.id),m}getVariableUsageStats(e,t){const a=this.discoverAllVariables(e,t),n={};a.forEach(c=>{const d=c.name,m=this.getVariableInfo(d,t);n[d]=m.usedByCallCount});const r=Object.entries(n).sort(([,c],[,d])=>d-c).map(([c])=>c),l=t.filter(c=>c.variables&&typeof c.variables=="object"&&Object.keys(c.variables).length>0).length;return{totalUniqueVariables:a.length,variableUsageCounts:n,mostCommonVariables:r.slice(0,10),totalCallsWithVariables:l}}validateVariableFields(e,t,a){const r=this.discoverAllVariables(e,t).map(m=>m.id),l=a.filter(m=>m.startsWith("var_")),c=[],d=[];return l.forEach(m=>{r.includes(m)?c.push(m):d.push(m)}),{validFields:c,invalidFields:d,availableFields:r}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}getVariableInfo(e,t){let a=0;const n=[];return t.forEach(r=>{if(r.variables&&r.variables[e]!==void 0){a++;const l=r.variables[e];n.length<3&&!n.includes(l)&&n.push(l)}}),{attributeName:e,fieldId:`attr_${e}`,usedByCallCount:a,dataType:n.length>0?this.inferDataType(n[0]):"string",sampleValues:n}}createVariableFieldDefinition(e,t){const a=this.generateVariableDescription(e,t);return{id:e.fieldId,name:e.variableName,description:a,group:"content",dataType:e.dataType,isRequired:!1}}createAttributeFieldDefinition(e,t){const a=this.generateAttributeDescription(e,t),n=e.fieldId.replace("attr_","").split("_"),r=n[0],l=n.slice(1).join("_"),c=`${r} attr ${l}`;return{id:e.fieldId,name:c,description:a,group:"content",dataType:e.dataType,isRequired:!1}}generateVariableDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),n=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(r=>JSON.stringify(r)).join(", ")})`:"";return`Template variable used in ${e.usedByCallCount}/${t} calls (${a}%)${n}. Empty for calls that don't use this variable.`}generateAttributeDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),n=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(r=>JSON.stringify(r)).join(", ")})`:"";return`Variable attribute used in ${e.usedByCallCount}/${t} calls (${a}%)${n}. Empty for calls that don't use this attribute.`}}const ts=new sc;class ac{isAuthField(e){return e==="request"}sanitizeFieldValue(e,t,a,n){return!t||t.length===0?t:(t.length,this.isAuthField(e),a.id,e==="request"?this.sanitizeRequestField(t,a,n):t)}sanitizeRequestField(e,t,a){try{const n=JSON.parse(e),r=this.getProviderIdForCall(t,a);if(!r)return t.id,this.sanitizeGenericRequest(e);t.id;const l=ys(n,r);return JSON.stringify(l,null,2)}catch(n){return n instanceof Error?n.message:String(n),t.id,"[MALFORMED_REQUEST_JSON_REDACTED_FOR_SAFETY]"}}sanitizeGenericRequest(e){try{const t=JSON.parse(e);if(t.headers){const a={...t.headers},n=["authorization","api-key","x-api-key","bearer","x-auth-token"];for(const[r,l]of Object.entries(a)){const c=r.toLowerCase();n.some(d=>c.includes(d))&&(a[r]=`${String(l).substring(0,8)}...REDACTED`)}t.headers=a}return JSON.stringify(t,null,2)}catch(t){return t instanceof Error?t.message:String(t),"[REQUEST_JSON_PARSE_FAILED_REDACTED]"}}getProviderIdForCall(e,t){try{return t.configurations[e.configurationIndex]?.provider||null}catch(a){return a instanceof Error?a.message:String(a),e.id,null}}getFieldsRequiringSanitization(){return["request"]}createSanitizationSummary(e){const t=e.filter(a=>this.isAuthField(a));return{sanitizationEnabled:t.length>0,sanitizedFields:t}}}const It=new ac;class nc{extractFieldValue(e,t,a){if(t.startsWith("param_"))return this.extractParameterValue(e,t,a);if(t.startsWith("var_"))return e.id,e.variables,this.extractVariableValue(e,t);if(t.startsWith("attr_")){e.id,e.variableAttributes;const r=this.extractAttributeValue(e,t);return e.id,r}if(t.startsWith("source_"))return this.extractSourceValue(e,t,a);const n=this.extractRawFieldValue(e,t,a);return It.isAuthField(t)?(e.id,It.sanitizeFieldValue(t,n,e,a)):n}extractRawFieldValue(e,t,a){switch(t){case"id":return e.id;case"order":return String(e.order);case"status":return e.status;case"created":return e.created.toISOString();case"completed":return e.completed?.toISOString()||"";case"configuration":return this.getConfigurationName(e,a);case"provider":return a.configurations[e.configurationIndex]?.provider||"";case"modelId":return a.configurations[e.configurationIndex]?.modelId||"";case"parameters":return this.getParametersJson(e,a);case"prompt":return e.prompt;case"variables":return JSON.stringify(e.variables||{});case"response":return e.result?.content||"";case"parsedResponse":return JSON.stringify(e.result?.parsedContent||{});case"latency":return String(e.response?.latencyMs||e.result?.latency||"");case"promptTokens":return String(e.result?.usage?.prompt_tokens||"");case"completionTokens":return String(e.result?.usage?.completion_tokens||"");case"totalTokens":return String(e.result?.usage?.total_tokens||"");case"request":return JSON.stringify(e.request||{});case"response_raw":return JSON.stringify(e.response||{});case"error":return e.result?.error||"";case"repeatIndex":return String(e.repeatIndex||"");case"cost":return e.cost!==void 0?String(e.cost):this.calculateCost(e,a);default:return`UNKNOWN_FIELD: ${t}`}}extractMultipleFields(e,t,a){const n={};return t.forEach(r=>{n[r]=this.extractFieldValue(e,r,a)}),n}getFieldDefinitions(e,t){const a=this.getStandardFieldDefinitions(),n=Ue.discoverAllParameters(e),r=t?ts.discoverAllVariables(e,t):[];return[...a,...n,...r]}getStandardFieldDefinitions(){return[{id:"id",name:"Call ID",description:"Unique identifier for the API call",group:"basic",dataType:"string",isRequired:!0},{id:"order",name:"Order",description:"Execution order of the API call within the trial",group:"basic",dataType:"number",isRequired:!0},{id:"status",name:"Status",description:"Current status of the API call (pending, running, completed, failed, cancelled)",group:"basic",dataType:"string",isRequired:!0},{id:"created",name:"Created Time",description:"When the API call was created (ISO timestamp)",group:"basic",dataType:"date",isRequired:!0},{id:"completed",name:"Completed Time",description:"When the API call was completed (ISO timestamp, empty if not completed)",group:"basic",dataType:"date",isRequired:!1},{id:"configuration",name:"Configuration",description:"Configuration name or model ID used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"provider",name:"Provider",description:"LLM provider used (e.g., openai-chat, anthropic, ollama)",group:"configuration",dataType:"string",isRequired:!0},{id:"modelId",name:"Model ID",description:"Specific model identifier used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"prompt",name:"Prompt",description:"The input prompt sent to the model",group:"content",dataType:"string",isRequired:!0},{id:"response",name:"Response",description:"The text response from the model",group:"content",dataType:"string",isRequired:!1},{id:"parsedResponse",name:"Parsed Response",description:"Structured/parsed response data (JSON)",group:"content",dataType:"json",isRequired:!1},{id:"latency",name:"Latency (ms)",description:"Response time in milliseconds",group:"performance",dataType:"number",isRequired:!1},{id:"promptTokens",name:"Prompt Tokens",description:"Number of tokens in the input prompt",group:"performance",dataType:"number",isRequired:!1},{id:"completionTokens",name:"Completion Tokens",description:"Number of tokens in the model response",group:"performance",dataType:"number",isRequired:!1},{id:"totalTokens",name:"Total Tokens",description:"Total tokens used (prompt + completion)",group:"performance",dataType:"number",isRequired:!1},{id:"request",name:"Full Request",description:"Complete API request sent to the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"response_raw",name:"Raw Response",description:"Full API response from the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"error",name:"Error Details",description:"Error message if the call failed",group:"technical",dataType:"string",isRequired:!1},{id:"repeatIndex",name:"Repeat Index",description:"Index for repeated calls (empty for single calls)",group:"technical",dataType:"number",isRequired:!1},{id:"cost",name:"Cost (USD)",description:"Calculated cost of the API call based on token usage",group:"performance",dataType:"number",isRequired:!1}]}validateFields(e,t){const n=this.getFieldDefinitions(e).map(c=>c.id),r=[],l=[];return t.forEach(c=>{n.includes(c)?r.push(c):l.push(c)}),{validFields:r,invalidFields:l,availableFields:n}}extractParameterValue(e,t,a){const n=t.replace("param_",""),r=a.configurations[e.configurationIndex];if(!r||!r.parameters)return"";const l=r.parameters[n];return l==null?"":typeof l=="object"?JSON.stringify(l):String(l)}getConfigurationName(e,t){const a=t.configurations[e.configurationIndex];return a?a.modelId||`Config ${e.configurationIndex+1}`:`Config ${e.configurationIndex+1}`}getParametersJson(e,t){const a=t.configurations[e.configurationIndex];return!a||!a.parameters?"{}":JSON.stringify(a.parameters)}extractVariableValue(e,t){const a=t.replace("var_","");if(!e.variables||typeof e.variables!="object")return"";const n=e.variables[a];return n==null?"":typeof n=="object"?JSON.stringify(n):String(n)}extractAttributeValue(e,t){const a=t.replace("attr_","").split("_");if(a.length<2)return"";const n=a[0],r=a.slice(1).join("_");if(!e.variableAttributes||typeof e.variableAttributes!="object")return"";const l=e.variableAttributes[n];if(!l||typeof l!="object")return"";const c=l[r];return c==null?"":typeof c=="object"?JSON.stringify(c):String(c)}extractSourceValue(e,t,a){const n=t.replace("source_","").split("_");if(n.length<2)return"";const r=n[n.length-1],l=n.slice(0,-1).join("_");if(!e.variableIndices||typeof e.variableIndices!="object")return"";const c=e.variableIndices[l];if(c==null)return"";if(r==="index")return String(c);if(r==="list"){if(a.type==="template"&&a.templateConfig?.variables){const d=a.templateConfig.variables[l];if(d&&"snapshot"in d&&d.snapshot?.source?.listName)return d.snapshot.source.listName;if(d?.listId)return d.listId}return""}return""}calculateCost(e,t){if(!e.result?.usage)return"0";const a=t.configurations[e.configurationIndex];if(!a)return"0";const n=a.modelSnapshot;if(!n||!n.capabilities?.inputCostPerToken&&!n.capabilities?.outputCostPerToken)return"0";const r=e.result.usage.prompt_tokens||0,l=e.result.usage.completion_tokens||0,c=r*(n.capabilities.inputCostPerToken||0),d=l*(n.capabilities.outputCostPerToken||0),m=c+d;return m===0?"0":m<1e-4?m.toFixed(8):m<.01?m.toFixed(6):m<1?m.toFixed(4):m.toFixed(2)}}const he=new nc;class rc{getMimeType(e){switch(e){case"csv":return"text/csv";case"excel":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"tsv":return"text/tab-separated-values";case"json":return"application/json";case"jsonl":return"application/x-jsonlines";case"python":return"text/x-python";case"zip":return"application/zip";default:return"application/octet-stream"}}getFileExtension(e){switch(e){case"csv":return"csv";case"excel":return"xlsx";case"tsv":return"tsv";case"json":return"json";case"jsonl":return"jsonl";case"python":return"py";case"zip":return"zip";default:return"bin"}}generateFilename(e,t,a){const n=this.sanitizeFilename(e),l=(a||new Date).toISOString().split("T")[0],c=this.getFileExtension(t);return`${n}_${t}_${l}.${c}`}estimateFileSize(e,t,a,n=50){let r=e*t*n;switch(a){case"json":r*=2.5;break;case"jsonl":r*=2.2;break;case"csv":r*=1.3;break;case"excel":r*=.8;break;case"tsv":r*=1.1;break;case"python":r=Math.max(r*1.5,5e3);break}return Math.round(r)}formatFileSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:`${(e/(1024*1024*1024)).toFixed(1)} GB`}createDownloadBlob(e,t,a=!1){let n=e;return a&&(n="\uFEFF"+n),new Blob([n],{type:t})}createDownloadBlobFromBase64(e,t){const a=atob(e),n=new Uint8Array(a.length);for(let r=0;r<a.length;r++)n[r]=a.charCodeAt(r);return new Blob([n],{type:t})}triggerDownload(e,t){const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>URL.revokeObjectURL(a),100)}downloadFile(e,t,a,n=!1){const r=this.getMimeType(t),l=this.generateFilename(a,t);let c;t==="excel"?c=this.createDownloadBlobFromBase64(e,r):c=this.createDownloadBlob(e,r,n),this.triggerDownload(c,l)}sanitizeFilename(e){return e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_+/g,"_").substring(0,50).replace(/^_+|_+$/g,"")||"trial"}}const de=new rc;class oc{validateFormat(e){const t=["csv","tsv","excel","json","jsonl","python"];return t.includes(e)?{isValid:!0,errors:[],warnings:[]}:{isValid:!1,errors:[`Invalid format: ${e}. Supported formats: ${t.join(", ")}`],warnings:[]}}validateFields(e,t,a){if(!t||t.length===0)return{isValid:!1,errors:["No fields selected for export"],warnings:[],unknownFields:[],supportedFields:he.getFieldDefinitions(e,a).map(m=>m.id)};const n=he.validateFields(e,t),r=n.invalidFields.filter(m=>!m.startsWith("var_")&&!m.startsWith("attr_")),l={isValid:r.length===0,errors:[],warnings:[],unknownFields:r,supportedFields:n.availableFields};r.length>0&&l.errors.push(`Unknown fields requested: ${r.join(", ")}`),(t.includes("request")||t.includes("response_raw"))&&l.warnings.push("Technical fields (request, response_raw) contain large JSON objects and may significantly increase file size");const c=t.filter(m=>m.startsWith("param_"));c.length>10&&l.warnings.push(`Large number of parameter fields selected (${c.length}). This may result in a very wide export file with many empty cells.`);const d=t.filter(m=>m.startsWith("var_"));return d.length>10&&l.warnings.push(`Large number of variable fields selected (${d.length}). This may result in a very wide export file with many empty cells.`),l}validateExportSize(e,t,a){const n=de.estimateFileSize(e,t,a),r=n/(1024*1024),l={isValid:!0,errors:[],warnings:[]};return r>500?(l.isValid=!1,l.errors.push(`Export too large: ${de.formatFileSize(n)}. Maximum allowed: 500MB. Consider reducing the number of fields or using filters.`)):r>100&&l.warnings.push(`Large export: ${de.formatFileSize(n)}. This may take several minutes to generate and download.`),e>1e5&&l.warnings.push(`Large number of records: ${e.toLocaleString()}. Export generation may take several minutes.`),t>50&&l.warnings.push(`Large number of fields: ${t}. Resulting file will be very wide and may be difficult to work with in spreadsheet applications.`),l}validateExportOptions(e,t,a){const n=[],r=[],l=this.validateFormat(t.format);if(l.isValid||n.push(...l.errors),t.fields){const c=this.validateFields(e,t.fields,a);c.isValid||n.push(...c.errors),r.push(...c.warnings);const d=this.validateExportSize(e.progress?.total||0,t.fields.length,t.format);d.isValid||n.push(...d.errors),r.push(...d.warnings)}return t.format==="python"&&t.fields&&t.fields.length>0&&r.push("Field selection is ignored for Python exports. Python scripts include all available data."),{isValid:n.length===0,errors:n,warnings:r}}getRecommendedFields(e){const t=["order","status","configuration","prompt","response","latency"],a=he.getFieldDefinitions(e).filter(l=>l.group==="parameters").map(l=>l.id),n=["param_temperature","param_max_tokens","param_top_p"],r=a.filter(l=>n.includes(l));return[...t,...r]}}const Qe=new oc;class Oe{validateOptions(e){const t=[],a=[];e.fields&&e.fields.length===0&&t.push("At least one field must be selected");const n=this.getFormatInfo();return e.includeHeaders&&!n.supportsHeaders&&a.push(`${n.name} format does not support headers - ignoring includeHeaders option`),e.addBOM&&!n.supportsBOM&&a.push(`${n.name} format does not support BOM - ignoring addBOM option`),{isValid:t.length===0,errors:t,warnings:a}}prepareFieldList(e,t){if(t&&t.length>0){const c=t.filter(g=>g.startsWith("var_")),d=t.filter(g=>g.startsWith("attr_")),m=t.filter(g=>!g.startsWith("var_")&&!g.startsWith("attr_")),h=he.validateFields(e,m);return h.invalidFields.length>0&&P.warn("Invalid fields requested:",h.invalidFields),[...h.validFields,...c,...d]}const a=["id","order","status","configuration","provider","modelId","prompt","response","latency"],n=Ue.discoverAllParameters(e),r=["param_temperature","param_max_tokens","param_top_p"],l=n.filter(c=>r.includes(c.id)).map(c=>c.id);return[...a,...l]}prepareDataRows(e,t,a){return e.map(n=>t.map(r=>he.extractFieldValue(n,r,a)))}prepareHeaderRow(e){return e.map(t=>t.startsWith("param_")?`param_${t.replace("param_","")}`:t.replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase()).trim())}hasParameterFields(e){return e.some(t=>t.startsWith("param_"))}escapeFieldValue(e){return e==null?"":String(e)}}class ic extends Oe{async generate(e,t,a){const n=this.prepareFieldList(t,a.fields),r=[];if(a.includeHeaders!==!1){const m=this.prepareHeaderRow(n).map(h=>this.escapeCSVValue(h)).join(",");r.push(m)}this.prepareDataRows(e,n,t).forEach(d=>{const m=d.map(h=>this.escapeCSVValue(h)).join(",");r.push(m)});let c=r.join(`
`);return a.addBOM&&(c="\uFEFF"+c),c}getFormatInfo(){return{name:"CSV",description:"Comma-separated values format, compatible with Excel and other spreadsheet applications",mimeType:"text/csv",extension:"csv",supportsHeaders:!0,supportsBOM:!0}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];if(e.fields&&e.fields.length>30&&a.push("Large number of columns may make the CSV difficult to work with in spreadsheet applications"),e.fields){const n=["variables","parsedResponse","request","response_raw"];e.fields.some(l=>n.includes(l))&&a.push("JSON fields (variables, parsedResponse, request, response_raw) may not display well in spreadsheet applications")}return{...t,warnings:a}}escapeCSVValue(e){if(e==null)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes(`
`)||t.includes("\r")?`"${t.replace(/"/g,'""')}"`:t}}class lc extends Oe{async generate(e,t,a){const n=this.prepareFieldList(t,a.fields),r=[];if(a.includeHeaders!==!1){const d=this.prepareHeaderRow(n).map(m=>this.escapeTSVValue(m)).join("	");r.push(d)}return this.prepareDataRows(e,n,t).forEach(c=>{const d=c.map(m=>this.escapeTSVValue(m)).join("	");r.push(d)}),r.join(`
`)}getFormatInfo(){return{name:"TSV",description:"Tab-separated values format, useful for data analysis tools and database imports",mimeType:"text/tab-separated-values",extension:"tsv",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return a.push("TSV format may not be directly supported by all spreadsheet applications"),{...t,warnings:a}}escapeTSVValue(e){return e==null?"":String(e).replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}}class uc extends Oe{async generate(e,t,a){const n=this.prepareFieldList(t,a.fields),r=Ke.book_new(),l=[];if(a.includeHeaders!==!1){const g=this.prepareHeaderRow(n);l.push(g)}const c=this.prepareDataRows(e,n,t);l.push(...c);const d=Ke.aoa_to_sheet(l),m=this.calculateColumnWidths(l);return d["!cols"]=m,Ke.book_append_sheet(r,d,"Export Data"),pa(r,{type:"base64",bookType:"xlsx",compression:!0})}getFormatInfo(){return{name:"Excel",description:"Microsoft Excel .xlsx format with proper formatting and auto-sized columns",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",extension:"xlsx",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.fields&&e.fields.length>16384&&a.push("Excel has a limit of 16,384 columns - some fields may not display correctly"),e.addBOM&&a.push("Excel .xlsx format is binary - ignoring addBOM option"),a.push("Excel format provides native spreadsheet functionality with auto-sized columns"),{...t,warnings:a}}calculateColumnWidths(e){if(e.length===0)return[];const t=Math.max(...e.map(n=>n.length)),a=[];for(let n=0;n<t;n++){let r=10;for(const l of e)if(l[n]!==void 0){const c=String(l[n]).length;r=Math.max(r,Math.min(c*1.2,50))}a.push({wch:r})}return a}}class dc extends Oe{async generate(e,t,a){const n=this.prepareFieldList(t,a.fields),r={metadata:{trialId:t.id,trialName:t.name,trialType:t.type,exportDate:new Date().toISOString(),recordCount:e.length,fieldCount:n.length,hasParameterFields:this.hasParameterFields(n)},trial:{id:t.id,name:t.name,description:t.description,type:t.type,status:t.status,created:t.created.toISOString(),configurations:t.configurations.map((l,c)=>({index:c,provider:l.provider,modelId:l.modelId,parameters:l.parameters||{}}))},fields:n.map(l=>{const c=he.getFieldDefinitions(t).find(d=>d.id===l);return{id:l,name:c?.name||l,description:c?.description||"",group:c?.group||"unknown",dataType:c?.dataType||"string"}}),apiCalls:e.map(l=>{const c={};return n.forEach(d=>{const m=he.extractFieldValue(l,d,t);c[d]=this.parseJSONValue(m,d)}),c})};return JSON.stringify(r,null,2)}getFormatInfo(){return{name:"JSON",description:"JavaScript Object Notation format with complete trial metadata and structured data",mimeType:"application/json",extension:"json",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSON format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSON format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("Large number of fields in JSON format may result in large file sizes and memory usage"),{...t,warnings:a}}parseJSONValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const r=Number(e);return isNaN(r)?null:r}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const r=Number(e);if(!isNaN(r))return r;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return e}}class cc extends Oe{async generate(e,t,a){const n=this.prepareFieldList(t,a.fields),r=[];return e.forEach(l=>{const c={};n.forEach(d=>{const m=he.extractFieldValue(l,d,t);c[d]=this.parseJSONLValue(m,d)}),r.push(JSON.stringify(c))}),r.join(`
`)}getFormatInfo(){return{name:"JSONL",description:"JSON Lines format with one JSON object per line, ideal for streaming and big data processing",mimeType:"application/x-jsonlines",extension:"jsonl",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSONL format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSONL format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("JSONL format handles large datasets well, but many fields may impact readability"),{...t,warnings:a}}parseJSONLValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const l=Number(e);return isNaN(l)?null:l}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const l=Number(e);if(!isNaN(l))return l;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return["created","completed"].includes(t),e}}function pc(o){switch(o){case"csv":return new ic;case"tsv":return new lc;case"excel":return new uc;case"json":return new dc;case"jsonl":return new cc;default:throw new Error(`Unsupported format: ${o}`)}}class fc{async exportTrialData(e,t){const a=Date.now();t.format;try{const n=await Ee.loadTrialForExport(e);if(!n.ok){const k=n.error;return{ok:!1,error:new ie("GENERATION_FAILED",`Failed to load trial data: ${k.message}`,{trialId:e,originalError:k})}}const{trial:r,apiCalls:l}=n.value;t.format;const c=await this.validateExportOptions(e,t,l);if(!c.ok){const k=c.error;return{ok:!1,error:new ie("GENERATION_FAILED",`Validation failed: ${k.message}`,{trialId:e,options:t,originalError:k})}}if(!c.value.isValid)return{ok:!1,error:new ie("INVALID_FIELDS",`Export validation failed: ${c.value.errors.join(", ")}`,{errors:c.value.errors})};t.format;const d=pc(t.format);t.format,l.length,t.fields?.length,t.fields,t.fields?.filter(k=>k.startsWith("param_")),t.fields?.filter(k=>k.startsWith("var_")),t.fields?.filter(k=>k.startsWith("attr_"));const m=Date.now(),h=await d.generate(l,r,t);Date.now()-m,h.length,Me(h);const g=t.fields||[],_=Date.now()-a,S={filename:de.generateFilename(r.name,t.format),mimeType:d.getFormatInfo().mimeType,data:h,metadata:{trialName:r.name,trialId:r.id,exportDate:new Date,callCount:l.length,fieldCount:g.length,format:t.format,estimatedSizeBytes:Me(h)},format:t.format,recordCount:l.length,fieldCount:g.length,hasParameterFields:g.some(k=>k.startsWith("param_")),generationTimeMs:_};return t.format,S.filename,S.metadata.estimatedSizeBytes,S.generationTimeMs,{ok:!0,value:S}}catch(n){const r=n instanceof Error?n:new Error(String(n));return r.message,r.stack,r.name,r.constructor.name,t.format,Date.now()-a,{ok:!1,error:new ie("GENERATION_FAILED",`Export generation failed: ${r.message}`,{trialId:e,options:t,originalError:n,generationTimeMs:Date.now()-a})}}}async previewExport(e,t){try{const a=await Ee.loadTrialForExport(e);if(!a.ok){const _=a.error;return{ok:!1,error:new ie("GENERATION_FAILED",`Failed to load trial data: ${_.message}`,{trialId:e,originalError:_})}}const{trial:n,apiCalls:r}=a.value,l=he.getFieldDefinitions(n),c=Ue.discoverAllParameters(n),d=t.fields||this.getDefaultFields(n),m=t.format||"csv",h=de.estimateFileSize(r.length,d.length,m);return{ok:!0,value:{fieldCount:d.length,recordCount:r.length,estimatedSizeBytes:h,availableFields:l,parameterFields:c}}}catch(a){return{ok:!1,error:new ie("GENERATION_FAILED",`Preview generation failed: ${a instanceof Error?a.message:"Unknown error"}`,{trialId:e,options:t,originalError:a})}}}async getAvailableFields(e){try{const t=await Ee.loadTrialForExport(e);if(!t.ok){const m=t.error;return{ok:!1,error:new ie("GENERATION_FAILED",`Failed to load trial data: ${m.message}`,{trialId:e,originalError:m})}}const{trial:a,apiCalls:n}=t.value,r=he.getStandardFieldDefinitions(),l=Ue.discoverAllParameters(a),c=ts.discoverAllVariables(a,n),d=Qe.getRecommendedFields(a);return{ok:!0,value:{standardFields:r,parameterFields:l,variableFields:c,recommendedFields:d}}}catch(t){return{ok:!1,error:new ie("GENERATION_FAILED",`Field discovery failed: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateExportOptions(e,t,a){try{const n=await Ee.loadTrialForExport(e);if(!n.ok){const c=n.error;return{ok:!1,error:new ie("GENERATION_FAILED",`Failed to load trial data: ${c.message}`,{trialId:e,originalError:c})}}const{trial:r}=n.value;return{ok:!0,value:Qe.validateExportOptions(r,t,a)}}catch(n){return{ok:!1,error:new ie("GENERATION_FAILED",`Validation failed: ${n instanceof Error?n.message:"Unknown error"}`,{trialId:e,options:t,originalError:n})}}}getDefaultFields(e){return Qe.getRecommendedFields(e)}}const ot=new fc;let it=null,lt=null,je=!1;try{typeof window<"u"&&("__TAURI__"in window||"__TAURI_INTERNALS__"in window)&&(je=!0)}catch{}async function mc(){if(!je)return!1;try{return it||(it=await Re(()=>import("./tauri-vendor-DvKxkFnM.js").then(o=>o.b),[])),lt||(lt=await Re(()=>import("./tauri-vendor-DvKxkFnM.js").then(o=>o.c),[])),!0}catch(o){return P.warn("Failed to load Tauri modules:",o),je=!1,!1}}class vc{async downloadFile(e,t,a,n=!1){await this.useTauriSaveDialog(e,t,a,n)||this.useBrowserDownload(e,t,a,n)}async useTauriSaveDialog(e,t,a,n){if(!await mc())return!1;try{const r=de.generateFilename(a,t),l=de.getFileExtension(t),c=await it.save({defaultPath:r,filters:[{name:this.getFilterName(t),extensions:[l]}],title:`Save ${this.getFilterName(t)} File`});if(!c)return!0;let d;if(typeof e=="string"){const m=n?"\uFEFF"+e:e;d=new TextEncoder().encode(m)}else d=e;return await lt.writeFile(c,d),`${c}`,!0}catch(r){return P.error("Tauri save dialog error:",r),!1}}useBrowserDownload(e,t,a,n){if(e instanceof Uint8Array&&(t==="zip"||t==="excel")){const g=de.getMimeType(t),_=de.generateFilename(a,t),S=new Blob([e],{type:g}),k=window.URL.createObjectURL(S),C=document.createElement("a");C.href=k,C.download=_,document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(k);return}e instanceof Uint8Array&&(e=new TextDecoder().decode(e));const r=de.getMimeType(t),l=de.generateFilename(a,t),c=n?"\uFEFF"+e:e,d=new Blob([c],{type:r}),m=window.URL.createObjectURL(d),h=document.createElement("a");h.href=m,h.download=l,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(m)}async downloadExcelFile(e,t){const a=atob(e),n=new Uint8Array(a.length);for(let r=0;r<a.length;r++)n[r]=a.charCodeAt(r);await this.downloadFile(n,"excel",t,!1)}getFilterName(e){switch(e){case"csv":return"CSV";case"excel":return"Excel";case"tsv":return"TSV";case"json":return"JSON";case"jsonl":return"JSON Lines";case"python":return"Python Script";case"zip":return"ZIP Archive";default:return"Binary"}}isInTauri(){return je}generateFilename(e,t,a){return de.generateFilename(e,t,a)}getMimeType(e){return de.getMimeType(e)}getFileExtension(e){return de.getFileExtension(e)}estimateFileSize(e,t,a,n=50){return de.estimateFileSize(e,t,a,n)}formatFileSize(e){return de.formatFileSize(e)}}const Ne=new vc,gc={class:"export-content"},hc={class:"section"},yc={key:0,class:"section"},bc={class:"bundle-info"},_c={key:0},Tc={key:1,class:"section"},kc={class:"field-actions"},Cc={class:"field-groups"},$c={class:"field-group"},wc={class:"field-list"},Sc={class:"field-group"},Ic={class:"field-list"},Ec={class:"field-group"},Rc={class:"field-list"},Pc={class:"field-group"},Fc={class:"field-list"},xc={class:"field-group"},Ac={class:"field-list"},Oc={key:0,class:"field-group"},Vc={class:"field-list"},Dc={key:1,class:"field-group"},Nc={class:"field-list"},Lc={class:"section"},Mc={class:"preview-info"},Uc={class:"info-item"},jc={class:"value"},Bc={class:"info-item"},zc={class:"value"},Wc={class:"info-item"},Hc={class:"value"},Gc={class:"export-actions"},qc=ne({__name:"ExportDataModalV3",props:{visible:{type:Boolean},trial:{}},emits:["update:visible"],setup(o,{emit:e}){const t=o,a=e,n=q("csv"),r=q(["order","status","configuration","prompt","response","latency"]),l=q(!1),c=q("draft"),d=q({}),m=q([]),h=q([]),g=q([]),_=["order","status","configuration","prompt","response","latency"],S=q([]),k=["id","order","status","created","completed","configuration","provider","modelId","parameters","prompt","variables","response","parsedResponse","latency","promptTokens","completionTokens","totalTokens","cost","request","response_raw","error","repeatIndex"],C=j(()=>{const x=t.trial.progress?.completed||0,i=t.trial.progress?.failed||0;return x+i}),D=j(()=>{const i=r.value.length*50*C.value;return i<1024?`${i} B`:i<1024*1024?`${(i/1024).toFixed(1)} KB`:`${(i/(1024*1024)).toFixed(1)} MB`});function H(){S.value.length,S.value.forEach(O=>{d.value[O]=!1}),_.forEach(O=>{d.value[O]=!0});const x=h.value.map(O=>O.id),i=g.value.map(O=>O.id);x.forEach(O=>{d.value[O]=!0}),i.forEach(O=>{d.value[O]=!0}),_.length,x.length,i.length,_.length+x.length+i.length,A()}function A(){r.value=S.value.filter(x=>d.value[x])}function y(x,i){d.value[x]=i,A()}function w(){S.value.forEach(x=>{d.value[x]=!0}),A()}function N(){S.value.forEach(O=>{d.value[O]=!1}),_.forEach(O=>{d.value[O]=!0});const x=h.value.map(O=>O.id),i=g.value.map(O=>O.id);x.forEach(O=>{d.value[O]=!0}),i.forEach(O=>{d.value[O]=!0}),A()}function v(){S.value.forEach(x=>{d.value[x]=!1}),A()}function p(){a("update:visible",!1)}async function U(){if(n.value==="bundle"){l.value=!0;try{const{trialBundleExportService:x}=await Re(async()=>{const{trialBundleExportService:I}=await import("./trial-bundle.service-C0Q0VKH5.js");return{trialBundleExportService:I}},__vite__mapDeps([0,1,2,3,4,5,6])),i=c.value==="completed",O=await x.exportTrialBundle(t.trial.id,{includeResults:i,includeApiCalls:i,format:"json"});O.ok?(Z.success(`Trial bundle exported: ${O.value.filename}`),a("update:visible",!1)):Z.error(`Bundle export failed: ${O.error.message}`)}catch(x){Z.error(`Bundle export failed: ${x instanceof Error?x.message:"Unknown error"}`)}finally{l.value=!1}return}if(r.value.length===0){Z.warning("Please select at least one field to export");return}l.value=!0;try{const x={format:n.value,fields:r.value,includeHeaders:!0,addBOM:n.value==="excel"||n.value==="csv"},i=await ot.exportTrialData(t.trial.id,x);i.ok?(await Ne.downloadFile(i.value.data,x.format,i.value.metadata.trialName,x.addBOM),Z.success("Export completed successfully"),a("update:visible",!1)):Z.error(`Export failed: ${i.error.message}`)}catch(x){Z.error("Export failed: "+x.message)}finally{l.value=!1}}return fe(async()=>{t.trial.id;const x=await ot.getAvailableFields(t.trial.id);if(x.ok){m.value=x.value.standardFields,h.value=x.value.parameterFields,g.value=(x.value.variableFields||[]).filter(E=>!E.id.startsWith("source_"));const i=x.value.standardFields.map(E=>E.id).filter(E=>E!=="parameters"&&E!=="variables"),O=x.value.parameterFields.map(E=>E.id),I=g.value.map(E=>E.id);S.value=[...i,...O,...I],x.value.standardFields.length,x.value.parameterFields.length,(x.value.variableFields||[]).length,S.value.length,x.value.parameterFields.map(E=>E.id),(x.value.variableFields||[]).map(E=>E.id),S.value}else x.error,S.value=[...k];H()}),(x,i)=>{const O=aa,I=Gt,E=qt,G=me,V=Wt,Y=Ce;return u(),K(Y,{visible:x.visible,"onUpdate:visible":i[46]||(i[46]=b=>x.$emit("update:visible",b)),title:"Export Trial Data",width:800,footer:null,"destroy-on-close":!0,class:"export-data-modal"},{default:F(()=>[s("div",gc,[s("div",hc,[i[53]||(i[53]=s("h4",null,"Export Format",-1)),$(I,{value:n.value,"onUpdate:value":i[0]||(i[0]=b=>n.value=b),class:"format-options"},{default:F(()=>[$(O,{value:"csv"},{default:F(()=>i[47]||(i[47]=[L("CSV")])),_:1,__:[47]}),$(O,{value:"tsv"},{default:F(()=>i[48]||(i[48]=[L("TSV")])),_:1,__:[48]}),$(O,{value:"excel"},{default:F(()=>i[49]||(i[49]=[L("Excel")])),_:1,__:[49]}),$(O,{value:"json"},{default:F(()=>i[50]||(i[50]=[L("JSON")])),_:1,__:[50]}),$(O,{value:"jsonl"},{default:F(()=>i[51]||(i[51]=[L("JSONL")])),_:1,__:[51]}),$(O,{value:"bundle"},{default:F(()=>i[52]||(i[52]=[L("Bundle 📦")])),_:1,__:[52]})]),_:1},8,["value"])]),n.value==="bundle"?(u(),f("div",yc,[i[62]||(i[62]=s("h4",null,"Bundle Export Options",-1)),s("div",bc,[$(I,{value:c.value,"onUpdate:value":i[1]||(i[1]=b=>c.value=b),style:{"margin-bottom":"16px"}},{default:F(()=>[$(E,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:F(()=>i[54]||(i[54]=[s("strong",null,"Export as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Configuration only - recipient can run fresh experiment ",-1)])),_:1,__:[54]}),$(E,{value:"completed",style:{display:"block"}},{default:F(()=>i[55]||(i[55]=[s("strong",null,"Export with Results",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Include all execution results for review/analysis ",-1)])),_:1,__:[55]})]),_:1},8,["value"]),i[61]||(i[61]=s("p",null,"The bundle will include:",-1)),s("ul",null,[i[56]||(i[56]=s("li",null,"✅ Complete trial configuration",-1)),i[57]||(i[57]=s("li",null,"✅ Template with metadata",-1)),i[58]||(i[58]=s("li",null,"✅ All variable lists",-1)),i[59]||(i[59]=s("li",null,"✅ Model configurations",-1)),c.value==="completed"?(u(),f("li",_c,"✅ Execution results and API calls")):R("",!0),i[60]||(i[60]=s("li",null,"✅ Variable index tracking for lineage",-1))]),s("p",null,[s("strong",null,T(c.value==="draft"?"Ready to run fresh experiment":"Complete historical record"),1)])])])):(u(),f("div",Tc,[i[95]||(i[95]=s("h4",null,"Fields to Export",-1)),s("div",kc,[$(G,{size:"small",onClick:w},{default:F(()=>i[63]||(i[63]=[L("Select All")])),_:1,__:[63]}),$(G,{size:"small",onClick:N},{default:F(()=>i[64]||(i[64]=[L("Select Defaults")])),_:1,__:[64]}),$(G,{size:"small",onClick:v},{default:F(()=>i[65]||(i[65]=[L("Clear All")])),_:1,__:[65]})]),s("div",Cc,[s("div",$c,[i[71]||(i[71]=s("h5",null,"Basic Information",-1)),s("div",wc,[$(V,{checked:d.value.id,"onUpdate:checked":i[2]||(i[2]=b=>d.value.id=b),onChange:i[3]||(i[3]=b=>y("id",b.target.checked))},{default:F(()=>i[66]||(i[66]=[L("Call ID")])),_:1,__:[66]},8,["checked"]),$(V,{checked:d.value.order,"onUpdate:checked":i[4]||(i[4]=b=>d.value.order=b),onChange:i[5]||(i[5]=b=>y("order",b.target.checked))},{default:F(()=>i[67]||(i[67]=[L("Order")])),_:1,__:[67]},8,["checked"]),$(V,{checked:d.value.status,"onUpdate:checked":i[6]||(i[6]=b=>d.value.status=b),onChange:i[7]||(i[7]=b=>y("status",b.target.checked))},{default:F(()=>i[68]||(i[68]=[L("Status")])),_:1,__:[68]},8,["checked"]),$(V,{checked:d.value.created,"onUpdate:checked":i[8]||(i[8]=b=>d.value.created=b),onChange:i[9]||(i[9]=b=>y("created",b.target.checked))},{default:F(()=>i[69]||(i[69]=[L("Created Time")])),_:1,__:[69]},8,["checked"]),$(V,{checked:d.value.completed,"onUpdate:checked":i[10]||(i[10]=b=>d.value.completed=b),onChange:i[11]||(i[11]=b=>y("completed",b.target.checked))},{default:F(()=>i[70]||(i[70]=[L("Completed Time")])),_:1,__:[70]},8,["checked"])])]),s("div",Sc,[i[76]||(i[76]=s("h5",null,"Configuration",-1)),s("div",Ic,[$(V,{checked:d.value.configuration,"onUpdate:checked":i[12]||(i[12]=b=>d.value.configuration=b),onChange:i[13]||(i[13]=b=>y("configuration",b.target.checked))},{default:F(()=>i[72]||(i[72]=[L("Configuration Name")])),_:1,__:[72]},8,["checked"]),$(V,{checked:d.value.provider,"onUpdate:checked":i[14]||(i[14]=b=>d.value.provider=b),onChange:i[15]||(i[15]=b=>y("provider",b.target.checked))},{default:F(()=>i[73]||(i[73]=[L("Provider")])),_:1,__:[73]},8,["checked"]),$(V,{checked:d.value.modelId,"onUpdate:checked":i[16]||(i[16]=b=>d.value.modelId=b),onChange:i[17]||(i[17]=b=>y("modelId",b.target.checked))},{default:F(()=>i[74]||(i[74]=[L("Model ID")])),_:1,__:[74]},8,["checked"]),$(V,{checked:d.value.parameters,"onUpdate:checked":i[18]||(i[18]=b=>d.value.parameters=b),onChange:i[19]||(i[19]=b=>y("parameters",b.target.checked))},{default:F(()=>i[75]||(i[75]=[L("Parameters")])),_:1,__:[75]},8,["checked"])])]),s("div",Ec,[i[81]||(i[81]=s("h5",null,"Content",-1)),s("div",Rc,[$(V,{checked:d.value.prompt,"onUpdate:checked":i[20]||(i[20]=b=>d.value.prompt=b),onChange:i[21]||(i[21]=b=>y("prompt",b.target.checked))},{default:F(()=>i[77]||(i[77]=[L("Prompt")])),_:1,__:[77]},8,["checked"]),$(V,{checked:d.value.variables,"onUpdate:checked":i[22]||(i[22]=b=>d.value.variables=b),onChange:i[23]||(i[23]=b=>y("variables",b.target.checked))},{default:F(()=>i[78]||(i[78]=[L("Variables")])),_:1,__:[78]},8,["checked"]),$(V,{checked:d.value.response,"onUpdate:checked":i[24]||(i[24]=b=>d.value.response=b),onChange:i[25]||(i[25]=b=>y("response",b.target.checked))},{default:F(()=>i[79]||(i[79]=[L("Response")])),_:1,__:[79]},8,["checked"]),$(V,{checked:d.value.parsedResponse,"onUpdate:checked":i[26]||(i[26]=b=>d.value.parsedResponse=b),onChange:i[27]||(i[27]=b=>y("parsedResponse",b.target.checked))},{default:F(()=>i[80]||(i[80]=[L("Parsed Response")])),_:1,__:[80]},8,["checked"])])]),s("div",Pc,[i[87]||(i[87]=s("h5",null,"Performance",-1)),s("div",Fc,[$(V,{checked:d.value.latency,"onUpdate:checked":i[28]||(i[28]=b=>d.value.latency=b),onChange:i[29]||(i[29]=b=>y("latency",b.target.checked))},{default:F(()=>i[82]||(i[82]=[L("Latency (ms)")])),_:1,__:[82]},8,["checked"]),$(V,{checked:d.value.promptTokens,"onUpdate:checked":i[30]||(i[30]=b=>d.value.promptTokens=b),onChange:i[31]||(i[31]=b=>y("promptTokens",b.target.checked))},{default:F(()=>i[83]||(i[83]=[L("Prompt Tokens")])),_:1,__:[83]},8,["checked"]),$(V,{checked:d.value.completionTokens,"onUpdate:checked":i[32]||(i[32]=b=>d.value.completionTokens=b),onChange:i[33]||(i[33]=b=>y("completionTokens",b.target.checked))},{default:F(()=>i[84]||(i[84]=[L("Completion Tokens")])),_:1,__:[84]},8,["checked"]),$(V,{checked:d.value.totalTokens,"onUpdate:checked":i[34]||(i[34]=b=>d.value.totalTokens=b),onChange:i[35]||(i[35]=b=>y("totalTokens",b.target.checked))},{default:F(()=>i[85]||(i[85]=[L("Total Tokens")])),_:1,__:[85]},8,["checked"]),$(V,{checked:d.value.cost,"onUpdate:checked":i[36]||(i[36]=b=>d.value.cost=b),onChange:i[37]||(i[37]=b=>y("cost",b.target.checked))},{default:F(()=>i[86]||(i[86]=[L("Cost (USD)")])),_:1,__:[86]},8,["checked"])])]),s("div",xc,[i[92]||(i[92]=s("h5",null,"Technical Details",-1)),s("div",Ac,[$(V,{checked:d.value.request,"onUpdate:checked":i[38]||(i[38]=b=>d.value.request=b),onChange:i[39]||(i[39]=b=>y("request",b.target.checked))},{default:F(()=>i[88]||(i[88]=[L("Full Request")])),_:1,__:[88]},8,["checked"]),$(V,{checked:d.value.response_raw,"onUpdate:checked":i[40]||(i[40]=b=>d.value.response_raw=b),onChange:i[41]||(i[41]=b=>y("response_raw",b.target.checked))},{default:F(()=>i[89]||(i[89]=[L("Raw Response")])),_:1,__:[89]},8,["checked"]),$(V,{checked:d.value.error,"onUpdate:checked":i[42]||(i[42]=b=>d.value.error=b),onChange:i[43]||(i[43]=b=>y("error",b.target.checked))},{default:F(()=>i[90]||(i[90]=[L("Error Details")])),_:1,__:[90]},8,["checked"]),$(V,{checked:d.value.repeatIndex,"onUpdate:checked":i[44]||(i[44]=b=>d.value.repeatIndex=b),onChange:i[45]||(i[45]=b=>y("repeatIndex",b.target.checked))},{default:F(()=>i[91]||(i[91]=[L("Repeat Index")])),_:1,__:[91]},8,["checked"])])]),h.value.length>0?(u(),f("div",Oc,[i[93]||(i[93]=s("h5",null,"Parameters (Individual Columns)",-1)),s("div",Vc,[(u(!0),f(ee,null,te(h.value,b=>(u(),K(V,{key:b.id,checked:d.value[b.id],"onUpdate:checked":B=>d.value[b.id]=B,onChange:B=>y(b.id,B.target.checked)},{default:F(()=>[L(T(b.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):R("",!0),g.value.length>0?(u(),f("div",Dc,[i[94]||(i[94]=s("h5",null,"Attributes (Individual Columns)",-1)),s("div",Nc,[(u(!0),f(ee,null,te(g.value,b=>(u(),K(V,{key:b.id,checked:d.value[b.id],"onUpdate:checked":B=>d.value[b.id]=B,onChange:B=>y(b.id,B.target.checked)},{default:F(()=>[L(T(b.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):R("",!0)])])),s("div",Lc,[i[99]||(i[99]=s("h4",null,"Export Preview",-1)),s("div",Mc,[s("div",Uc,[i[96]||(i[96]=s("span",{class:"label"},"Records:",-1)),s("span",jc,T(C.value),1)]),s("div",Bc,[i[97]||(i[97]=s("span",{class:"label"},"Fields:",-1)),s("span",zc,T(r.value.length),1)]),s("div",Wc,[i[98]||(i[98]=s("span",{class:"label"},"Estimated Size:",-1)),s("span",Hc,T(D.value),1)])])]),s("div",Gc,[$(G,{onClick:p},{default:F(()=>i[100]||(i[100]=[L("Cancel")])),_:1,__:[100]}),$(G,{type:"primary",onClick:U,loading:l.value,disabled:r.value.length===0},{default:F(()=>[$(z(na)),i[101]||(i[101]=L(" Export "))]),_:1,__:[101]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),Jc=ae(qc,[["__scopeId","data-v-1fc3d8ba"]]),Xc={class:"trial-details-panel"},Kc={key:0,class:"loading-state"},Yc={key:1,class:"error-state"},Qc={class:"error-actions"},Zc=ne({__name:"TrialDetailsPanelV3",props:{trial:{},isLeader:{type:Boolean},executionState:{},progress:{}},emits:["start-trial","pause-trial","resume-trial","cancel-trial","duplicate-trial","edit-trial","delete-trial","export-data","export-python"],setup(o){const e=o,t=Be(),a=q(!1),n=q(null),r=q(!1),l=Xt(),c=j(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial?.id);function d(){n.value=null}function m(){t.push("/trials")}function h(){r.value=!0}async function g(){if(e.trial){`${e.trial.id}`;try{l.isActive&&l.currentTrialId===e.trial.id&&l.stopStreaming(),await l.loadHistoricalData(e.trial.id),`${e.trial.id}`,(e.trial.status==="running"||e.trial.status==="paused")&&await l.startStreaming(e.trial.id)}catch(_){P.error("REFRESH: Failed to refresh trial data:",_)}}}return re(()=>e.trial,(_,S)=>{_&&_.id!==S?.id&&(n.value=null,P.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 switching from ${S?.id} to ${_.id}`))}),fe(()=>{const _=e.trial?.id;P.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 MOUNTED for trial ${_}`)}),Fe(()=>{const _=e.trial?.id;P.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 ACTIVATED (cache hit) for trial ${_}`)}),xe(()=>{const _=e.trial?.id;P.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 DEACTIVATED (cached) for trial ${_}`)}),be(()=>{const _=e.trial?.id;P.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 UNMOUNTED (evicted) for trial ${_}`)}),(_,S)=>{const k=me;return u(),f("div",Xc,[a.value?(u(),f("div",Kc,[$(z(Ut),{class:"loading-spinner",spin:""}),S[9]||(S[9]=s("span",null,"Loading trial details...",-1))])):n.value?(u(),f("div",Yc,[$(z(Pe),{class:"error-icon"}),S[12]||(S[12]=s("h3",null,"Failed to load trial",-1)),s("p",null,T(n.value),1),s("div",Qc,[$(k,{onClick:d},{default:F(()=>S[10]||(S[10]=[L("Retry")])),_:1,__:[10]}),$(k,{type:"link",onClick:m},{default:F(()=>S[11]||(S[11]=[L("Go Back")])),_:1,__:[11]})])])):_.trial?(u(),f(ee,{key:2},[$(Hn,{trial:_.trial,progress:_.progress,"is-executing":c.value},null,8,["trial","progress","is-executing"]),$(Yn,{trial:_.trial,"is-leader":_.isLeader,"execution-state":_.executionState,onStart:S[0]||(S[0]=C=>_.$emit("start-trial")),onPause:S[1]||(S[1]=C=>_.$emit("pause-trial")),onResume:S[2]||(S[2]=C=>_.$emit("resume-trial")),onCancel:S[3]||(S[3]=C=>_.$emit("cancel-trial")),onDuplicate:S[4]||(S[4]=C=>_.$emit("duplicate-trial",_.trial.id)),onEdit:S[5]||(S[5]=C=>_.$emit("edit-trial",_.trial.id)),onDelete:S[6]||(S[6]=C=>_.$emit("delete-trial",_.trial.id)),onExportData:h,onExportPython:S[7]||(S[7]=C=>_.$emit("export-python",_.trial.id)),onRefresh:g},null,8,["trial","is-leader","execution-state"]),_.trial&&r.value?(u(),K(Jc,{key:0,visible:r.value,trial:_.trial,"onUpdate:visible":S[8]||(S[8]=C=>r.value=!1)},null,8,["visible","trial"])):R("",!0),$(ec,{trial:_.trial,progress:_.progress,"is-leader":_.isLeader,"execution-state":_.executionState},null,8,["trial","progress","is-leader","execution-state"])],64)):R("",!0)])}}}),ep=ae(Zc,[["__scopeId","data-v-081db72e"]]),tp={class:"import-content"},sp={class:"upload-section"},ap={class:"ant-upload-drag-icon"},np={key:0,class:"preview-section"},rp={class:"bundle-details"},op={class:"detail-row"},ip={class:"value"},lp={class:"detail-row"},up={class:"value"},dp={class:"detail-row"},cp={class:"value"},pp={class:"detail-row"},fp={class:"value"},mp={key:0,style:{color:"green","margin-left":"8px"}},vp={key:1,style:{color:"orange","margin-left":"8px"}},gp={key:0,class:"detail-row"},hp={class:"value"},yp={class:"detail-row"},bp={class:"value"},_p={class:"import-options"},Tp={key:0,style:{"margin-bottom":"12px"}},kp={key:1,style:{"margin-bottom":"12px",padding:"8px",background:"#f0f0f0","border-radius":"4px"}},Cp={key:0,class:"warnings"},$p={class:"modal-actions"},wp=ne({__name:"ImportTrialDialog",props:{visible:{type:Boolean}},emits:["update:visible","trial-imported"],setup(o,{emit:e}){const t=o,a=e,n=Be(),r=q([]),l=q(null),c=q(!1),d=q([]),m=q({mode:"draft",namePrefix:"Imported: "}),h=j({get:()=>t.visible,set:y=>a("update:visible",y)}),g=j(()=>l.value?.execution?.apiCalls&&l.value.execution.apiCalls.length>0);function _(y){return!1}async function S(y){const w=y.file.originFileObj||y.file;if(w)try{const N=await k(w),v=JSON.parse(N);d.value=C(v),l.value=v,v.execution?.apiCalls&&v.execution.apiCalls.length>0,m.value.mode="draft"}catch{Z.error("Failed to read bundle file: Invalid JSON format"),l.value=null}}function k(y){return new Promise((w,N)=>{const v=new FileReader;v.onload=p=>w(p.target?.result),v.onerror=N,v.readAsText(y)})}function C(y){const w=[];return y.version||w.push("Bundle version is missing"),y.configuration?.trial||w.push("Trial configuration is missing"),(!y.configuration?.variableLists||y.configuration.variableLists.length===0)&&w.push("No variable lists found in bundle"),y.version!=="1.0"&&w.push(`Bundle version ${y.version} may not be fully compatible`),w}function D(y){return new Date(y).toLocaleString()}function H(){r.value=[],l.value=null,d.value=[],h.value=!1}async function A(){if(!l.value){Z.error("No bundle to import");return}c.value=!0;try{const{trialBundleImportService:y}=await Re(async()=>{const{trialBundleImportService:v}=await import("./trial-bundle.service-C0Q0VKH5.js");return{trialBundleImportService:v}},__vite__mapDeps([0,1,2,3,4,5,6])),w=g.value&&m.value.mode==="completed",N=await y.importTrialBundle(JSON.stringify(l.value),{importResults:w,importAsCompleted:w,namePrefix:m.value.namePrefix||void 0});N.ok?(Z.success("Trial imported successfully!"),n.push(`/trials?trialId=${N.value.trialId}`),a("trial-imported",N.value.trialId),H()):Z.error(`Import failed: ${N.error.message}`)}catch(y){Z.error(`Import failed: ${y instanceof Error?y.message:"Unknown error"}`)}finally{c.value=!1}}return(y,w)=>{const N=ra,v=qt,p=Gt,U=zt,x=ze,i=me,O=Ce;return u(),K(O,{visible:h.value,"onUpdate:visible":w[3]||(w[3]=I=>h.value=I),title:"Import Trial Bundle",width:600,footer:null,"destroy-on-close":!0,class:"import-trial-modal"},{default:F(()=>[s("div",tp,[s("div",sp,[$(N,{fileList:r.value,"onUpdate:fileList":w[0]||(w[0]=I=>r.value=I),"before-upload":_,"max-count":1,accept:".json",onChange:S},{default:F(()=>[s("p",ap,[$(z(Mt))]),w[4]||(w[4]=s("p",{class:"ant-upload-text"},"Click or drag trial bundle file here",-1)),w[5]||(w[5]=s("p",{class:"ant-upload-hint"}," Supports .json files exported from trials ",-1))]),_:1,__:[4,5]},8,["fileList"])]),l.value?(u(),f("div",np,[w[17]||(w[17]=s("h3",null,"Bundle Contents",-1)),s("div",rp,[s("div",op,[w[6]||(w[6]=s("span",{class:"label"},"Trial Name:",-1)),s("span",ip,T(l.value.metadata.trialName),1)]),s("div",lp,[w[7]||(w[7]=s("span",{class:"label"},"Export Date:",-1)),s("span",up,T(D(l.value.metadata.exportDate)),1)]),s("div",dp,[w[8]||(w[8]=s("span",{class:"label"},"Status:",-1)),s("span",cp,T(l.value.metadata.trialStatus),1)]),s("div",pp,[w[9]||(w[9]=s("span",{class:"label"},"API Calls:",-1)),s("span",fp,[L(T(l.value.metadata.apiCallCount)+" ",1),g.value?(u(),f("span",mp," (with results) ")):(u(),f("span",vp," (configuration only) "))])]),l.value.configuration.template?(u(),f("div",gp,[w[10]||(w[10]=s("span",{class:"label"},"Template:",-1)),s("span",hp,T(l.value.configuration.template.name),1)])):R("",!0),s("div",yp,[w[11]||(w[11]=s("span",{class:"label"},"Variable Lists:",-1)),s("span",bp,T(l.value.configuration.variableLists?.length||0),1)])]),s("div",_p,[w[16]||(w[16]=s("h4",null,"Import Options",-1)),g.value?(u(),f("div",Tp,[$(p,{value:m.value.mode,"onUpdate:value":w[1]||(w[1]=I=>m.value.mode=I),style:{display:"block"}},{default:F(()=>[$(v,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:F(()=>w[12]||(w[12]=[s("strong",null,"Import as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Create fresh trial ready to run new experiment ",-1)])),_:1,__:[12]}),$(v,{value:"completed",style:{display:"block"}},{default:F(()=>w[13]||(w[13]=[s("strong",null,"Import as Completed",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Preserve historical results for review/analysis ",-1)])),_:1,__:[13]})]),_:1},8,["value"])])):(u(),f("div",kp,w[14]||(w[14]=[s("strong",null,"Draft Trial",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px"}}," This bundle contains configuration only - will import as draft ready to run ",-1)]))),$(U,{value:m.value.namePrefix,"onUpdate:value":w[2]||(w[2]=I=>m.value.namePrefix=I),placeholder:"Name prefix (optional)",style:{"margin-top":"8px"}},{prefix:F(()=>w[15]||(w[15]=[L("Name:")])),_:1},8,["value"])]),d.value.length>0?(u(),f("div",Cp,[$(x,{message:"Import Warnings",type:"warning","show-icon":""},{description:F(()=>[s("ul",null,[(u(!0),f(ee,null,te(d.value,I=>(u(),f("li",{key:I},T(I),1))),128))])]),_:1})])):R("",!0)])):R("",!0),s("div",$p,[$(i,{onClick:H},{default:F(()=>w[18]||(w[18]=[L("Cancel")])),_:1,__:[18]}),$(i,{type:"primary",onClick:A,loading:c.value,disabled:!l.value},{default:F(()=>[$(z(Lt)),w[19]||(w[19]=L(" Import Trial "))]),_:1,__:[19]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),Sp=ae(wp,[["__scopeId","data-v-1d9366d6"]]);class ss{getTemplate(){return{id:"minimal",name:"Minimal Experiment Script",description:"Minimal Python script with clear experimental design and pre-built requests",pythonVersion:"3.8",requiredImports:["json","requests","itertools","csv"],templateCode:"MINIMAL_TEMPLATE",supportsAnalysis:!1,supportsVisualization:!1}}generateScript(e,t,a={}){const{includeComments:n=!0}=a,r=this.buildResolvedConfigurations(e);return[this.generateHeader(e,n),this.generateImports(),this.generateExperimentSection(e,n),this.generateResolvedConfigsSection(r,n),this.generateMinimalUtilities(),this.generateExecutionSection(e,n)].filter(Boolean).join(`

`)}buildResolvedConfigurations(e){const t=[];for(const[a,n]of e.configurations.entries())t.push(this.buildResolvedConfig(n,a));return t}buildResolvedConfig(e,t){const a=e.providerSnapshot;if(!a)return this.buildFallbackConfig(e,t);const n=a.api?.baseUrl||"https://api.example.com",r=a.api?.endpoint||"/v1/api",l={"Content-Type":"application/json",...a.headers};a.auth?.type==="bearer"?l.Authorization="Bearer {{API_KEY}}":a.auth?.type==="header"&&a.auth.header&&(l[a.auth.header]="{{API_KEY}}");const c={model:e.modelId},d=a.requestTransform;if(d?.promptKey?d.wrapPrompt?c[d.promptKey]=[{role:d.messageRole||"user",content:"{{PROMPT}}"}]:c[d.promptKey]="{{PROMPT}}":c.prompt="{{PROMPT}}",d?.nestParams){const h=d.rootLevelParams||[],g={},_={};for(const[S,k]of Object.entries(e.parameters))h.includes(S)?_[S]=k:g[S]=k;Object.keys(g).length>0&&(c[d.nestParams]=g),Object.assign(c,_)}else Object.assign(c,e.parameters);if(a.requestTransforms){for(const h of a.requestTransforms)if(h.type==="field_transform"&&h.config){const{field:g,transform:_,transformConfig:S}=h.config;g in c&&_==="string_to_object"&&S?.objectWrapper&&typeof c[g]=="string"&&(c[g]={[S.objectWrapper]:c[g]})}}const m=e.provider.split("-")[0];return{index:t,name:e.modelSnapshot?.displayName||e.modelId,provider:e.provider,providerGroup:m,url:n+r,headers:l,bodyTemplate:c,responsePath:this.getResponsePath(e)}}getResponsePath(e){const t=e.providerSnapshot;if(!t)return"response";const a=t.responseModes?.text;if(!a)return"response";const n=a.responseTransform;if(!n)return"response";const r=[];return n.contentPath&&r.push(n.contentPath),n.fallbackPaths&&Array.isArray(n.fallbackPaths)&&r.push(...n.fallbackPaths),r.length>0?r:"response"}buildFallbackConfig(e,t){const a=e.providerSnapshot,n=a?.api?.baseUrl||"https://api.example.com",r=a?.api?.endpoint||"/v1/api",l=e.provider.split("-")[0];return{index:t,name:e.modelSnapshot?.displayName||e.modelId,provider:e.provider,providerGroup:l,url:n+r,headers:{"Content-Type":"application/json",Authorization:"{{API_KEY}}"},bodyTemplate:{model:e.modelId,prompt:"{{PROMPT}}",...e.parameters},responsePath:"response"}}generateHeader(e,t){const a="#!/usr/bin/env python3";return t?`${a}
"""
Minimal Experiment Script - ${e.name}
Generated: ${new Date().toISOString()}

This script contains ONLY what's needed for your specific experiment.
No generic boilerplate, no unused provider functions.
"""`:a}generateImports(){return`import json
import requests
import itertools
import csv
import sys
import os
import argparse
from datetime import datetime
from typing import Dict, List, Any, Optional`}generateExperimentSection(e,t){const a=t?`# === EXPERIMENTAL DESIGN ===
`:"";if(e.type!=="template"||!e.templateConfig)return`${a}# Non-template trial - no factorial design`;const{template:n,variables:r}=e.templateConfig,l={};for(const[c,d]of Object.entries(r))"snapshot"in d&&d.snapshot?l[c]=d.snapshot.items.map(m=>m.value):d.type==="value"&&d.values&&(l[c]=[...d.values]);return`${a}# Template with variables
template = ${JSON.stringify(n)}

# Variables (${Object.keys(l).length} dimensions)
variables = ${this.toPythonJson(l)}`}generateResolvedConfigsSection(e,t){return`${t?`# === MODEL CONFIGURATIONS ===
# Pre-built requests with all transforms applied
`:""}model_configs = ${this.toPythonJson(e)}`}generateExecutionSection(e,t){const a=t?`# === EXECUTION ===
`:"";if(e.type!=="template")return`${a}# Non-template execution not yet implemented`;const n=new Set;for(const l of e.configurations){const c=l.provider.split("-")[0];n.add(c)}const r=[];for(const l of n){const c=`${l.toUpperCase()}_API_KEY`;l==="ollama"?r.push(`    "${l}": "",  # No key needed for local`):r.push(`    "${l}": os.getenv("${c}", "")`)}return`${a}# Parse command line arguments
parser = argparse.ArgumentParser(description='Run LLM experiment')
parser.add_argument('--replace', action='store_true', help='Replace existing results file')
parser.add_argument('--output', default='experiment_results.jsonl', help='Output file path')
parser.add_argument('--api-keys-file', help='JSON file with API keys')
args = parser.parse_args()

# Output file handling
output_file = args.output
checkpoint_file = output_file.replace('.jsonl', '_checkpoint.json')

# Check for existing results
completed_calls = set()
if os.path.exists(output_file) and not args.replace:
    print(f"Resuming from existing results in {output_file}")
    with open(output_file, 'r') as f:
        for line in f:
            try:
                result = json.loads(line)
                # Use the same ID format as new calls
                config_idx = result.get('config_index', 0)
                call_idx = result.get('call_index', '')
                call_id = f"config{config_idx}_call{call_idx}"
                completed_calls.add(call_id)
            except:
                pass
    print(f"Found {len(completed_calls)} completed calls")
    mode = 'a'  # Append mode
else:
    if os.path.exists(output_file):
        print(f"Replacing existing results file: {output_file}")
    mode = 'w'  # Write mode
    completed_calls = set()

# API Keys (for all providers used in this experiment)
API_KEYS = {
${r.join(`,
`)}
}

# Load API keys from file if provided
if args.api_keys_file and os.path.exists(args.api_keys_file):
    with open(args.api_keys_file, 'r') as f:
        API_KEYS.update(json.load(f))

# Calculate total calls
total_combinations = list(itertools.product(*[variables[k] for k in variables]))
total_calls = len(model_configs) * len(total_combinations)
print(f"\\nTotal API calls to make: {total_calls}")

# Open output file for writing/appending
with open(output_file, mode) as f:
    call_index = 0
    
    # Factorial execution
    for config in model_configs:
        for combination in total_combinations:
            # Build call identifier
            call_index += 1
            call_id = f"config{config['index']}_call{call_index}"
            
            # Skip if already completed
            if call_id in completed_calls:
                print(f"[{call_index}/{total_calls}] Skipping completed: {call_id}")
                continue
            
            # Build variable dictionary
            var_names = list(variables.keys())
            var_dict = dict(zip(var_names, combination))
            
            # Substitute variables in template
            prompt = template
            for var_name, var_value in var_dict.items():
                prompt = prompt.replace(f"{{{{{var_name}}}}}", str(var_value))
            
            # Build request from pre-built template (safe replacement)
            request_body = safe_json_replace(
                config['bodyTemplate'],
                {'{{PROMPT}}': prompt}
            )
            
            # Get API key for this provider (use explicit provider group)
            provider_group = config.get('providerGroup', config['provider'].split('-')[0])
            api_key = API_KEYS.get(provider_group, '')
            
            headers = {}
            for key, value in config['headers'].items():
                headers[key] = value.replace('{{API_KEY}}', api_key)
            
            # Prepare result record
            result = {
                'timestamp': datetime.now().isoformat(),
                'call_index': call_index,
                'config_index': config['index'],  # Store config index for resume
                'model': config['name'],
                'provider': config['provider'],
                **var_dict,
                'prompt': prompt,
                'request': {
                    'url': config['url'],
                    'headers': {k: v if k != 'Authorization' and not k.endswith('-key') else '***' for k, v in headers.items()},
                    'body': request_body
                }
            }
            
            # Make API call
            print(f"[{call_index}/{total_calls}] Calling {config['name']} with {var_dict}...")
            
            try:
                response = requests.post(
                    config['url'],
                    headers=headers,
                    json=request_body,
                    timeout=90
                )
                
                # Store full response
                result['response_status'] = response.status_code
                result['response_headers'] = dict(response.headers)
                
                try:
                    response_json = response.json()
                    result['response_body'] = response_json
                    
                    if response.ok:
                        # Extract content using pre-determined path
                        content = extract_at_path(response_json, config['responsePath'])
                        result['success'] = True
                        result['extracted_content'] = content
                        print(f"  ✓ Success: {str(content)[:100]}...")
                    else:
                        result['success'] = False
                        result['error'] = f"HTTP {response.status_code}"
                        result['error_details'] = response_json
                        print(f"  ✗ HTTP {response.status_code}: {response_json}")
                        
                except json.JSONDecodeError as e:
                    result['success'] = False
                    result['error'] = 'Invalid JSON response'
                    result['response_text'] = response.text[:1000]
                    print(f"  ✗ Invalid JSON: {response.text[:200]}...")
                    
            except requests.exceptions.Timeout:
                result['success'] = False
                result['error'] = 'Request timeout'
                print(f"  ✗ Timeout after 90 seconds")
                
            except requests.exceptions.RequestException as e:
                result['success'] = False
                result['error'] = str(e)
                print(f"  ✗ Request failed: {e}")
                
            except Exception as e:
                result['success'] = False
                result['error'] = str(e)
                result['error_type'] = type(e).__name__
                print(f"  ✗ Unexpected error: {e}")
            
            # Write result immediately (flush to disk)
            json.dump(result, f)
            f.write('\\n')
            f.flush()
            
            # Save checkpoint
            checkpoint = {
                'last_call_index': call_index,
                'completed': call_index,
                'total': total_calls,
                'timestamp': datetime.now().isoformat()
            }
            with open(checkpoint_file, 'w') as cf:
                json.dump(checkpoint, cf, indent=2)

print(f"\\nExperiment complete! Results saved to {output_file}")

# Show summary
show_summary(output_file)`}generateMinimalUtilities(){return`# === UTILITIES ===

def safe_json_replace(obj, replacements):
    """Safely replace placeholders in a nested object structure.
    
    This avoids JSON injection vulnerabilities by replacing in the object,
    not in the JSON string representation.
    """
    if isinstance(obj, dict):
        return {k: safe_json_replace(v, replacements) for k, v in obj.items()}
    elif isinstance(obj, list):
        return [safe_json_replace(item, replacements) for item in obj]
    elif isinstance(obj, str):
        result = obj
        for key, value in replacements.items():
            result = result.replace(key, value)
        return result
    else:
        return obj

def extract_at_path(data: Dict, paths) -> Any:
    """Extract value from nested dict using path(s) like 'choices[0].message.content'
    
    Args:
        data: The response dictionary
        paths: Either a single path string or a list of paths to try
    
    Returns:
        The extracted value from the first successful path, or None
    """
    if not paths or not data:
        return data if not paths else None
    
    # Handle both single path and list of paths
    if isinstance(paths, str):
        paths = [paths]
    
    # Try each path until one works
    for path in paths:
        if not path:
            continue
            
        parts = path.replace('[', '.').replace(']', '').split('.')
        current = data
        
        try:
            for part in parts:
                if part.isdigit():
                    part = int(part)
                current = current[part]
            
            # If we got here without exception and have a non-None value, return it
            if current is not None:
                return current
        except (KeyError, IndexError, TypeError):
            # Try next path
            continue
    
    return None

def show_summary(results_file):
    """Show a simple summary of results."""
    if not os.path.exists(results_file):
        return
    
    results = []
    with open(results_file, 'r') as f:
        for line in f:
            try:
                results.append(json.loads(line))
            except:
                pass
    
    if not results:
        return
    
    total = len(results)
    successful = sum(1 for r in results if r.get('success'))
    failed = total - successful
    
    print(f"\\n{'='*50}")
    print(f"SUMMARY: {successful}/{total} successful ({successful/total*100:.1f}%)")
    if failed > 0:
        print(f"Failed: {failed} calls")
    
    # Group by configuration index
    by_config = {}
    for r in results:
        config_idx = r.get('config_index', 'unknown')
        model = r.get('model', 'unknown')
        provider = r.get('provider', 'unknown')
        key = (config_idx, model, provider)
        if key not in by_config:
            by_config[key] = {'success': 0, 'fail': 0}
        if r.get('success'):
            by_config[key]['success'] += 1
        else:
            by_config[key]['fail'] += 1
    
    print(f"\\nBy Configuration Index:")
    for (idx, model, provider), stats in sorted(by_config.items()):
        total_config = stats['success'] + stats['fail']
        success_rate = stats['success']/total_config*100 if total_config > 0 else 0
        print(f"  [{idx}] {model} via {provider}: {stats['success']}/{total_config} ({success_rate:.1f}%)")
    print(f"{'='*50}\\n")`}toPythonJson(e){return JSON.stringify(e,null,4).replace(/: false/g,": False").replace(/: true/g,": True").replace(/: null/g,": None")}}function Et(o){switch(o){case"minimal":case"basic":case"reproduction":case"analysis":return new ss;default:throw new Error(`Unknown template: ${o}`)}}function Ip(){return[new ss().getTemplate()]}class Ep{async generateScript(e,t={}){const a=Date.now();t.template;try{const n=await Ee.loadTrialForExport(e);if(!n.ok){const D=n.error;return{ok:!1,error:new ie("GENERATION_FAILED",`Failed to load trial data: ${D.message}`,{trialId:e,originalError:D})}}const{trial:r,apiCalls:l}=n.value,c=this.validateCodeGenOptions(t);if(!c.isValid)return{ok:!1,error:new ie("INVALID_FIELDS",`Code generation validation failed: ${c.errors.join(", ")}`,{errors:c.errors})};const d=t.template||"minimal",m=Et(d),h=m.getTemplate();l.length;const g=Date.now(),_=m.generateScript(r,l,{includeComments:t.includeComments!==!1});Date.now()-g,_.length,Me(_);const S=Date.now()-a,C={filename:this.generateScriptFilename(r.name,d),mimeType:"text/x-python",data:_,metadata:{trialName:r.name,trialId:r.id,exportDate:new Date,callCount:l.length,fieldCount:0,format:"python",estimatedSizeBytes:Me(_)},template:d,pythonVersion:h.pythonVersion,requiredPackages:this.extractRequiredPackages(h,t),codeLength:_.length,generationTimeMs:S};return C.filename,C.codeLength,C.generationTimeMs,C.requiredPackages,{ok:!0,value:C}}catch(n){const r=n instanceof Error?n:new Error(String(n));return t.template,Date.now()-a,{ok:!1,error:new ie("GENERATION_FAILED",`Python script generation failed: ${r.message}`,{trialId:e,options:t,originalError:n,generationTimeMs:Date.now()-a})}}}getAvailableTemplates(){return Ip()}validateCodeGenOptions(e){const t=[],a=[];if(e.template){const n=this.getAvailableTemplates().map(r=>r.id);n.includes(e.template)||t.push(`Invalid template: ${e.template}. Available templates: ${n.join(", ")}`)}if(e.pythonVersion){const n=["3.8","3.9","3.10","3.11"];n.includes(e.pythonVersion)||a.push(`Python version ${e.pythonVersion} not explicitly supported. Supported versions: ${n.join(", ")}`)}if(e.includeVisualization){const n=e.template||"minimal";Et(n).getTemplate().supportsVisualization||a.push(`Template '${n}' does not support built-in visualization. You can add your own visualization code to the exported script.`)}return{isValid:t.length===0,errors:t,warnings:a}}generateScriptFilename(e,t){const a=e.replace(/[^a-zA-Z0-9\s-_]/g,"").replace(/\s+/g,"_").toLowerCase().substring(0,30).replace(/^_+|_+$/g,"")||"trial",n=t==="minimal"?"":`_${t}`,r=new Date().toISOString().split("T")[0];return`${a}${n}_${r}.py`}extractRequiredPackages(e,t){return["json","requests","itertools","csv"]}}const Rt=new Ep,Rp={class:"trials-view-v3"},Pp={key:0,class:"provider-warning-banner"},Fp={class:"banner-content"},xp={key:1,class:"observer-mode-banner"},Ap={class:"banner-content"},Op={key:1,class:"loading-left-pane"},Vp={key:0,class:"no-selection"},Dp={key:0,class:"observer-note"},Np=ne({__name:"TrialsViewV3",setup(o){const e=fa(),{trials:t}=la(),{enabledModels:a}=ma(),{duplicateTrial:n,deleteTrial:r}=ua(),l=Xt(),c=Vt(),d=Be(),m=q(),h=q(!0),g=q(null),_=q(""),S=q("all"),k=q(-1),C=q(!1),D=q(!1),H=q(!1),A=j(()=>a.value.length>0),y=j(()=>!A.value&&!H.value),w=e.isLeader,N=e.execution,{trial:v}=da(g),p=j(()=>{const M=v.value?.progress;return M?{trialId:g.value||"",...M,lastUpdated:new Date}:null}),U=j(()=>{let M=t.value;if(_.value){const W=_.value.toLowerCase();M=M.filter(Q=>{const ve=Q.name.toLowerCase().includes(W),ge=Q.templateConfig?.template?.toLowerCase().includes(W),le=Q.configurations.some(Te=>Te.modelId.toLowerCase().includes(W)||Te.provider.toLowerCase().includes(W));return ve||ge||le})}return S.value!=="all"&&(M=M.filter(W=>W.status===S.value)),M});async function x(){const M=c.query;if(M.duplicate){const W=M.duplicate,Q=await n(W);Q.ok?await d.push({path:"/trials/create",query:{duplicate:Q.value,edit:M.edit==="true"?"true":void 0}}):Z.error(`Failed to duplicate trial: ${Q.error?.message||"Unknown error"}`),await d.replace({query:{}});return}if(M.designId||M.promptSource){await d.push({path:"/trials/create",query:M});return}if(c.query.trialId){const W=c.query.trialId;O(W)}}function i(){if(g.value||t.value.length===0)return;const M=t.value.find(W=>W.status==="running");if(M){O(M.id);return}O(t.value[0].id)}async function O(M){const W=performance.now();P.info(`V4_TRIAL_SWITCH: Starting trial selection: ${M}`),g.value=M;const Q=performance.now();if(P.info(`V4_TRIAL_SWITCH: UI updated in ${(Q-W).toFixed(1)}ms`),t.value.length>0){const le=U.value.findIndex(Te=>Te.id===M);le>=0&&(k.value=le)}const ve=performance.now();if(P.info(`V4_TRIAL_SWITCH: Starting stream manager for trial ${M} at ${(ve-W).toFixed(1)}ms`),l.startStreaming(M).catch(le=>{P.error(`V4_TRIAL_SWITCH: Failed to start streaming for trial ${M}`,le)}),c.query.trialId!==M){const le={...c.query};le.trialId=M,le.tab||(le.tab="status"),d.push({path:"/trials",query:le}),P.info(`V4_TRIAL_SWITCH: URL updated to preserve tab '${le.tab}' at ${(performance.now()-W).toFixed(1)}ms`)}m.value&&m.value.closeMobileOverlay();const ge=performance.now();P.info(`V4_TRIAL_SWITCH: selectTrial() completed in ${(ge-W).toFixed(1)}ms`)}function I(M){_.value=M,k.value=-1}function E(M){S.value=M,k.value=-1}async function G(){Z.info("Refreshing trial list...")}function V(M){const W=U.value;if(W.length!==0){if((M.metaKey||M.ctrlKey)&&M.key==="k"){M.preventDefault(),window.dispatchEvent(new CustomEvent("focus-trial-search"));return}(M.key==="j"||M.key==="ArrowDown")&&(M.preventDefault(),k.value=Math.min(k.value+1,W.length-1),k.value>=0&&(O(W[k.value].id),Y(W[k.value].id))),(M.key==="k"||M.key==="ArrowUp")&&(M.preventDefault(),k.value=Math.max(k.value-1,0),O(W[k.value].id),Y(W[k.value].id)),M.key==="Enter"&&g.value,M.key==="Escape"&&(_.value="",g.value=null,k.value=-1)}}function Y(M){ke(()=>{const W=document.querySelector(`[data-trial-id="${M}"]`);W&&W.scrollIntoView({behavior:"smooth",block:"nearest"})})}function b(M){P.debug("Trial list panel resized",{width:M})}function B(M){P.debug("Mobile overlay changed",{visible:M})}function J(){H.value=!0}async function X(){await d.push("/trials/create")}function oe(){D.value=!0}function ce(M){G(),O(M)}async function pe(){if(g.value&&!C.value){C.value=!0,e.execution?.value,e.execution?.value?.status;try{g.value;const M=await e.startTrialWithStreaming(g.value);if(!M.ok){Z.error(M.error?.message||"Unknown error");return}await l.startStreaming(g.value);const W={...c.query};W.tab="tasks",d.replace({query:W})}finally{C.value=!1}}}async function qe(){`${g.value}`,`${g.value}`,`${e.execution.value.status}`,`${e.isLeader.value}`;const M=await e.pauseExecution();M?.ok,M.ok?`${e.execution.value.status}`:(M.error.message,Z.error(M.error?.message||"Unknown error"))}async function as(){if(!g.value)return;`${g.value}`,`${g.value}`,`${e.execution.value.status}`,`${e.isLeader.value}`;const M=e.execution.value?.status||"idle",W=e.execution.value?.currentTrialId;if(M==="paused"&&W===g.value){`${g.value}`;const Q=await e.resumeExecution(g.value);Q.ok||(Q.error.message,Z.error(Q.error.message))}else{const Q=await e.startTrialWithStreaming(g.value);Q.ok?await l.startStreaming(g.value):(Q.error.message,Z.error(Q.error?.message||"Unknown error"))}}async function ns(){const M=await e.cancelExecution();M.ok||Z.error(M.error?.message||"Unknown error")}async function rs(M){const W=await n(M);W.ok?(Z.success("Trial duplicated"),W.value&&O(W.value)):Z.error(W.error?.message||"Unknown error")}async function os(M){await d.push({path:"/trials/create",query:{duplicate:M,edit:"true"}})}async function is(M){const W=await r(M);W.ok?(Z.success("Trial deleted"),g.value===M&&(g.value=null)):Z.error(W.error?.message||"Unknown error")}async function ls(M,W){const Q=await ot.exportTrialData(M,{format:W,fields:void 0,includeHeaders:!0,addBOM:W==="excel"||W==="csv"});Q.ok?(await Ne.downloadFile(Q.value.data,W,Q.value.metadata.trialName,W==="excel"||W==="csv"),Z.success(`Exported ${Q.value.recordCount} API calls to ${Q.value.filename}`)):Z.error(Q.error?.message||"Unknown error")}function us(M){ds(M,"minimal")}async function ds(M,W="classic"){if(W==="bundle"){const{usePythonBundleManagement:Q}=await Re(async()=>{const{usePythonBundleManagement:le}=await import("./python-bundle-management-B0LMLcDu.js");return{usePythonBundleManagement:le}},__vite__mapDeps([7,1,2,3,4,5,0,6])),{exportPythonBundle:ve}=Q(),ge=await ve(M,{includeApiKeys:!0,showProgress:!0});ge.ok||Z.error(ge.error?.message||"Bundle export failed")}else if(W==="minimal"){const Q=await Rt.generateScript(M,{template:"minimal",includeComments:!0});Q.ok?(await Ne.downloadFile(Q.value.data,"python",Q.value.metadata.trialName,!1),Z.success("Minimal Python script exported")):Z.error(Q.error?.message||"Minimal export failed")}else{const Q=await Rt.generateScript(M,{template:"minimal",includeComments:!0});Q.ok?(await Ne.downloadFile(Q.value.data,"python",Q.value.metadata.trialName,!1),Z.success("Python script exported")):Z.error(Q.error?.message||"Classic export failed")}}return re(()=>c.query.trialId,M=>{M&&M!==g.value&&O(M)}),re(h,(M,W)=>{const Q=performance.now();P.info(`V4_TRIAL_SWITCH: isLoadingInitial changed from ${W} to ${M} at ${Q}`),M||P.info("V4_TRIAL_SWITCH: Both panes should now be VISIBLE (no longer loading initial)")},{immediate:!0}),re(t,(M,W)=>{const Q=performance.now();P.info(`V4_TRIAL_SWITCH: trials array changed from ${W?.length||0} to ${M.length} trials at ${Q}`)},{immediate:!0}),fe(async()=>{const M=performance.now();P.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() ENTRY at ${M}`);const W=performance.now();P.info(`V4_TRIAL_SWITCH: Starting V4 execution system initialization at ${(W-M).toFixed(1)}ms`);try{await e.initialize();const Je=performance.now();P.info(`V4_TRIAL_SWITCH: V4 execution system initialized in ${(Je-W).toFixed(1)}ms`)}catch(Je){const ms=performance.now();P.error(`V4_TRIAL_SWITCH: V4 initialization failed in ${(ms-W).toFixed(1)}ms:`,Je)}const Q=performance.now();window.addEventListener("keydown",V),P.info(`V4_TRIAL_SWITCH: Keyboard listener added in ${(Q-M).toFixed(1)}ms`);const ve=performance.now();P.info(`V4_TRIAL_SWITCH: Starting nextTick wait at ${(ve-M).toFixed(1)}ms`),await ke();const ge=performance.now();P.info(`V4_TRIAL_SWITCH: nextTick completed in ${(ge-ve).toFixed(1)}ms`);const le=performance.now();h.value=!1,P.info(`V4_TRIAL_SWITCH: isLoadingInitial set to false at ${(le-M).toFixed(1)}ms`);const Te=performance.now();P.info(`V4_TRIAL_SWITCH: Starting URL parameter processing at ${(Te-M).toFixed(1)}ms`),await x();const cs=performance.now();P.info(`V4_TRIAL_SWITCH: URL parameter processing completed in ${(cs-Te).toFixed(1)}ms`);const vt=performance.now();P.info(`V4_TRIAL_SWITCH: Starting auto-selection at ${(vt-M).toFixed(1)}ms`),i();const ps=performance.now();P.info(`V4_TRIAL_SWITCH: Auto-selection completed in ${(ps-vt).toFixed(1)}ms`);const fs=performance.now();P.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() TOTAL: ${(fs-M).toFixed(1)}ms`)}),be(()=>{window.removeEventListener("keydown",V),l.destroy()}),(M,W)=>{const Q=Pt("router-link"),ve=me;return u(),f("div",Rp,[y.value?(u(),f("div",Pp,[s("div",Fp,[$(z(Pe),{class:"warning-icon"}),W[2]||(W[2]=s("span",null,"No LLM providers configured. Please add API keys in Settings to run trials.",-1)),$(Q,{to:"/settings",class:"settings-link"},{default:F(()=>W[1]||(W[1]=[L("Go to Settings")])),_:1,__:[1]}),$(z(Nt),{class:"close-icon",onClick:J})]),W[3]||(W[3]=s("div",{class:"banner-note"},"Note: Ollama doesn't require API keys",-1))])):R("",!0),z(w)?R("",!0):(u(),f("div",xp,[s("div",Ap,[$(z(Bt),{class:"observer-icon"}),W[4]||(W[4]=s("span",null,[s("strong",null,"Observer Mode: Multiple Tabs Detected")],-1)),W[5]||(W[5]=s("div",{class:"leader-hint"}," You can only open one Auditomatic tab at a time. Close other tabs, or refresh if this is your only tab. Your templates and trials are safely saved. ",-1))])])),$(ha,{ref_key:"splitPanel",ref:m,"storage-key":"trial-list-width","default-width":250,"min-width":200,"max-width":600,onResize:b,onMobileOverlayChange:B},{left:F(()=>[h.value?(u(),f("div",Op," Loading trials... ")):(u(),K(Rn,{key:0,trials:z(t),"selected-trial-id":g.value,"search-query":_.value,"filter-status":S.value,onSelectTrial:O,onCreateTrial:X,onImportTrial:oe,onUpdateSearch:I,onUpdateFilter:E,onRefresh:G},null,8,["trials","selected-trial-id","search-query","filter-status"]))]),right:F(()=>[(u(),K(et,{max:5},[g.value?(u(),K(ep,{key:g.value,trial:z(v),"is-leader":z(w),"execution-state":z(N),progress:p.value,onStartTrial:pe,onPauseTrial:qe,onResumeTrial:as,onCancelTrial:ns,onDuplicateTrial:rs,onEditTrial:os,onDeleteTrial:is,onExportData:ls,onExportPython:us},null,8,["trial","is-leader","execution-state","progress"])):R("",!0)],1024)),!g.value||!z(v)?Se((u(),f("div",Vp,[$(z(Ht),{class:"empty-icon"}),W[7]||(W[7]=s("h3",null,"Select a trial to view details",-1)),W[8]||(W[8]=s("p",null,"Choose from the list or create a new one",-1)),$(ve,{type:"primary",size:"large",disabled:!z(w),onClick:X},{default:F(()=>W[6]||(W[6]=[L(" Create New Trial ")])),_:1,__:[6]},8,["disabled"]),z(w)?R("",!0):(u(),f("div",Dp," Close other tabs to enable trial creation "))],512)),[[At,!h.value]]):R("",!0)]),_:1},512),$(Sp,{visible:D.value,"onUpdate:visible":W[0]||(W[0]=ge=>D.value=ge),onTrialImported:ce},null,8,["visible"])])}}}),Zp=ae(Np,[["__scopeId","data-v-f2ce2e14"]]);export{Zp as default};
