import{f as q,c as F,d as Q,o as ie,b as ge,w as G,V as k,a5 as ne,a2 as U,q as ye,k as r,W as t,a1 as B,a0 as w,X as y,v as Ce,a7 as _e,F as X,Y as ee,_ as f,G as O,u as D,r as be,$ as H,e as he,z as ke,p as $e,a4 as Te,Z as we}from"./vue-vendor-BZxY9vkr.js";import{a as Y,d as Ie,e as Z,b as Se,p as Pe}from"./index-BRQLqOf1.js";import{u as xe}from"./useV4Templates-zgRUXbhZ.js";import{a as me}from"./useV4VariableLists-DVOBW9Fj.js";import{u as le}from"./useV4Models-CKX4qZvU.js";import{u as re,a as De,b as Ve}from"./useV4TrialCommands-P55jrZZA.js";import{O as ve,Q as ce,F as Ee,P as ae,V as Me,q as Le,W as Oe,s as Ae,t as fe,X as Ne,Y as ze,w as Re,k as se}from"./ui-vendor-DgwC-sRC.js";import{G as je}from"./GenericModelSelectorModalV3-CBRUeERX.js";import{u as de}from"./useCostEstimation-Dx3JjXP0.js";import"./utils-vendor-X1Ah6TN4.js";import"./data-vendor-CllpzWXw.js";import"./useV4LiveQuery-CfOiSnL_.js";import"./useV4ProviderParameters-BOtVSooM.js";function Be(W){const{templates:V}=xe(),{variableLists:a}=me(),{enabledModels:S}=le(),{runningTrials:c}=re(),x=Ve(),{createTrial:C}=De(),m=q(null),v=q(""),h=q(""),I=q(1),b=q([]),L=q(!1),N=q(!1),u=F(()=>V.value||[]),o=F(()=>[]),E=F(()=>{var i,$;if(!m.value)return 0;if(m.value.type==="template"){const g=m.value;if(!g.variables)return 1;let M=1;for(const[,j]of Object.entries(g.variables))if(j.type==="value"&&j.values)M*=j.values.length;else if(j.type==="list"&&j.listId){const K=a.value.find(te=>te.id===j.listId);K&&(K.category==="simple"?M*=((i=K.values)==null?void 0:i.length)||0:K.category==="attributed"?M*=(($=K.items)==null?void 0:$.length)||0:K.category==="tabular"&&(M*=K.itemCount||0))}return M}else return 0}),z=F(()=>E.value*b.value.length*I.value),R=F(()=>{let i=0;for(const $ of b.value){const g=e($);i+=g*E.value*I.value}return i}),A=F(()=>m.value!==null&&b.value.length>0&&v.value.trim()!=="");function T(i){m.value=i,v.value=J(i)}function J(i){const $=i||m.value;if(!$)return"New Trial";const g=new Date().toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return`${$.name} - ${g}`}function e(i){var te,ue;if(!m.value)return 0;const $=S.value.find(pe=>pe.provider===i.provider&&pe.modelId===i.modelId);if(!($!=null&&$.capabilities))return 0;const g=s(),M=((te=i.parameters)==null?void 0:te.max_tokens)||((ue=i.parameters)==null?void 0:ue.maxTokens)||256,j=($.capabilities.inputCostPerToken||0)*g,K=($.capabilities.outputCostPerToken||0)*M;return j+K}function s(){return m.value&&m.value.type==="template"?150:100}function l(i){b.value.push(i)}function n(i){b.value.splice(i,1)}async function p(){if(A.value){L.value=!0;try{const i=JSON.parse(JSON.stringify(m.value)),$={name:v.value,description:"",type:i.type,configurations:JSON.parse(JSON.stringify(b.value)),repeatCount:I.value,templateConfig:i.type==="template"?{template:i.template,variables:i.variables,outputType:i.outputType,extractPattern:i.extractPattern,refusalWords:i.refusalWords,rejectRefusalWords:i.rejectRefusalWords}:void 0,spreadsheetConfig:i.type==="spreadsheet"?{promptPattern:i.promptPattern,datasetId:i.datasetId}:void 0},g=await C($);if(g.ok)return g.value;throw g.error}finally{L.value=!1}}}async function _(){const i=await p();if(i)return c.value.length>0?{trialId:i,needsConfirmation:!0,runningTrial:c.value[0]}:await d(i)}async function d(i){Y.info("V4: Creation view starting trial via V4 execution control",i);const $=await x.startTrialWithStreaming(i);if($.ok){Y.info("V4: Trial started successfully via V4 execution control");const g=$.value.progress$.subscribe({next:j=>{Y.info("V4: Creation view received progress update:",j.type)},error:j=>{Y.error("V4: Creation view stream error:",j)}}),M=$.value.calls$.subscribe({next:j=>{Y.info("V4: Creation view received batch of",j.length,"calls")},error:j=>{Y.error("V4: Creation view calls stream error:",j)}});return Y.info("V4: Creation view subscribed to BOTH streams, execution started, navigating to trials view"),setTimeout(()=>{g.unsubscribe(),M.unsubscribe(),Y.info("V4: Creation view unsubscribed from streams after navigation")},1e3),{trialId:i,needsConfirmation:!1}}else throw $.error}async function P(){var i,$;try{await x.initialize(),Y.info("V4: Execution control initialized in creation view")}catch(g){Y.error("V4: Failed to initialize execution control in creation view:",g)}if(W.value.type==="duplicate"&&W.value.sourceTrialId){const g=await Ie.trials.get(W.value.sourceTrialId);if(g){if(v.value=`Copy of ${g.name}`,I.value=g.repeatCount||1,g.configurations&&(b.value=g.configurations.map(M=>{var j;return{name:((j=M.modelSnapshot)==null?void 0:j.displayName)||M.modelId,provider:M.provider,modelId:M.modelId,parameters:M.parameters||{}}})),g.type==="template"&&((i=g.templateConfig)!=null&&i.template)){const M=u.value.find(j=>{var K;return j.template===((K=g.templateConfig)==null?void 0:K.template)});M&&T(M)}else if(g.type==="spreadsheet"&&(($=g.spreadsheetConfig)!=null&&$.datasetId)){const M=o.value.find(j=>{var K;return j.datasetId===((K=g.spreadsheetConfig)==null?void 0:K.datasetId)});M&&T(M)}}}}return{selectedPrompt:m,trialName:v,description:h,repeatCount:I,configurations:b,creating:L,showModelSelector:N,templates:u,spreadsheets:o,variableLists:a,enabledModels:S,runningTrials:c,totalCombinations:E,totalExperiments:z,totalCost:R,canProceed:A,selectPrompt:T,generateTrialName:J,addConfiguration:l,removeConfiguration:n,getConfigCostPerCall:e,createTrialAsDraft:p,createAndStartTrial:_,initialize:P}}const Fe={key:0,class:"preview-controls"},Ue={class:"template-name"},Je={key:0,class:"cycle-info"},qe={key:1,class:"variable-legend"},We={class:"variable-value"},Ke=Q({__name:"TemplatePreviewV3",props:{template:{},variableLists:{default:()=>[]},cycling:{type:Boolean,default:!0},cyclingSpeed:{default:1e3},showControls:{type:Boolean,default:!1},displayMode:{default:"block"},showLegend:{type:Boolean,default:!1},maxLines:{default:0}},emits:["update:paused","back-to-select"],setup(W,{emit:V}){const a=W,S=V,c=q(0),x=q(!1);let C=null;const m=["variable-highlight-blue","variable-highlight-green","variable-highlight-purple","variable-highlight-orange","variable-highlight-pink","variable-highlight-teal"],v=F(()=>a.template.type==="template"?a.template.template:a.template.type==="spreadsheet"?a.template.promptPattern:""),h=F(()=>{var l;if(a.template.type==="spreadsheet"){const n=a.template,p=a.variableLists.find(_=>_.id===n.datasetId);return(p==null?void 0:p.category)==="tabular"&&((l=p.tabularData)!=null&&l.rows)?p.tabularData.rows.map(_=>{const d={};return Object.keys(_).forEach(P=>{let i=P.replace(/[^a-zA-Z0-9_]/g,"_");/^[a-zA-Z]/.test(i)||(i="col_"+i),i=i.replace(/_+/g,"_").replace(/_+$/,""),d[i]=String(_[P]||"")}),d}):[]}const T=[];if(a.template.variables){for(const[n,p]of Object.entries(a.template.variables))if(p.type==="value"&&p.values)T.push({name:n,values:[...p.values]});else if(p.type==="list"&&p.listId){const _=a.variableLists.find(d=>d.id===p.listId);_&&(_.category==="simple"&&_.values?T.push({name:n,values:[..._.values]}):_.category==="attributed"&&_.items&&T.push({name:n,values:_.items.map(d=>d.value)}))}}if(T.length===0)return[];const J=n=>n.reduce((p,_)=>p.flatMap(d=>_.map(P=>[...d,P])),[[]]),e=T.map(n=>n.values);return J(e).map(n=>{const p={};return T.forEach((_,d)=>{p[_.name]=n[d]}),p})}),I=F(()=>h.value.length),b=F(()=>h.value.length===0?null:h.value[c.value]||h.value[0]),L=F(()=>{const T=v.value;if(!T)return"";const J=b.value;if(!J||Object.keys(J).length===0)return o(T).replace(/\n/g,"<br>");let e=o(T);if(Object.keys(J).sort((l,n)=>n.length-l.length).forEach((l,n)=>{const p=J[l],_=o(p),d=u(n),P=new RegExp(`{{\\s*${E(l)}\\s*}}`,"g");e=e.replace(P,`<span class="${d} variable-value">${_}</span>`)}),e=e.replace(/\n/g,"<br>"),a.maxLines>0){const l=e.split("<br>");l.length>a.maxLines&&(e=l.slice(0,a.maxLines).join("<br>")+'<br><span class="line-clamp-indicator">...</span>')}return e}),N=F(()=>a.displayMode==="inline"&&a.maxLines>0?{display:"-webkit-box","-webkit-line-clamp":a.maxLines,"-webkit-box-orient":"vertical",overflow:"hidden"}:{});function u(T){return m[T%m.length]}function o(T){const J=document.createElement("div");return J.textContent=T,J.innerHTML}function E(T){return T.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function z(){x.value=!x.value,S("update:paused",x.value)}function R(){!a.cycling||x.value||I.value<=1||(C=setInterval(()=>{c.value=(c.value+1)%I.value},a.cyclingSpeed))}function A(){C&&(clearInterval(C),C=null)}return ie(()=>{a.cycling&&!x.value&&R()}),ge(()=>{A()}),G(()=>x.value,T=>{T||!a.cycling?A():R()}),G(()=>a.cycling,T=>{T?x.value||R():(A(),c.value=0)}),G(()=>a.cyclingSpeed,()=>{a.cycling&&!x.value&&(A(),R())}),G(I,()=>{c.value=0}),(T,J)=>{const e=B("a-button"),s=B("a-tag"),l=Ce("dompurify-html");return f(),k("div",{class:ne(["template-preview",[`preview-${T.displayMode}`,{"preview-cycling":T.cycling&&!x.value}]])},[T.showControls?(f(),k("div",Fe,[r(e,{type:"link",onClick:J[0]||(J[0]=n=>T.$emit("back-to-select")),class:"back-to-select"},{default:w(()=>[r(D(ve)),J[1]||(J[1]=O(" Back to Select Template "))]),_:1,__:[1]}),t("h3",Ue,y(a.template.name),1),r(e,{onClick:z,size:"small",type:x.value?"default":"primary",disabled:!T.cycling||I.value<=1},{default:w(()=>[O(y(x.value?"Start":"Pause")+" Variable Selection ",1)]),_:1},8,["type","disabled"]),T.cycling&&I.value>1?(f(),k("span",Je,y(c.value+1)+" / "+y(I.value),1)):U("",!0),r(s,{color:a.template.type==="template"?"blue":"green",class:"source-badge"},{default:w(()=>[O(y(a.template.type==="template"?"Prompt Design":"Spreadsheet Design"),1)]),_:1},8,["color"])])):U("",!0),ye(t("div",{class:"preview-content",style:_e(N.value)},null,4),[[l,L.value,"template"]]),T.showLegend&&b.value&&Object.keys(b.value).length>0?(f(),k("div",qe,[(f(!0),k(X,null,ee(b.value,(n,p,_)=>(f(),k("div",{key:p,class:"legend-item"},[t("span",{class:ne(u(_))},y(p),3),t("span",We,y(n),1)]))),128))])):U("",!0)],2)}}}),oe=Z(Ke,[["__scopeId","data-v-1ad1228f"]]),Ye={class:"design-selection"},He={class:"design-selector","data-testid":"template-design-selector"},Ge={key:0,class:"no-designs-state"},Qe={class:"no-designs-content"},Ze={key:1,class:"no-designs-state"},Xe={class:"no-designs-content"},et={key:2,class:"design-list","data-testid":"design-list"},tt=["data-template-id","data-template-name","onClick"],at={class:"design-header"},st={class:"design-title-section"},nt={class:"design-name"},ot={key:0,class:"design-inline-description"},it={class:"design-date"},lt={class:"design-stats"},rt={class:"stat-item"},dt={class:"stat-value"},ut={class:"stat-item"},pt={class:"stat-value"},ct={class:"stat-item"},mt={class:"stat-value"},vt={class:"design-selector","data-testid":"spreadsheet-design-selector"},ft={key:0,class:"no-designs-state"},gt={class:"no-designs-content"},yt={key:1,class:"design-list","data-testid":"design-list"},Ct=["data-spreadsheet-id","data-spreadsheet-name","onClick"],_t={class:"design-header"},bt={class:"design-title-section"},ht={class:"design-name"},kt={key:0,class:"design-inline-description"},$t={class:"design-date"},Tt={class:"design-stats"},wt={class:"stat-item"},It={class:"stat-value"},St={class:"stat-item"},Pt={class:"stat-value"},xt={class:"stat-item"},Dt={class:"stat-value"},Vt=Q({__name:"TrialDesignSelectionV3",props:{templates:{},spreadsheets:{},variableLists:{}},emits:["select","create-template","create-spreadsheet"],setup(W){const V=Se(),a=W,S=q("template"),c=q(""),x=q(""),C=F(()=>{if(!c.value)return a.templates;const u=c.value.toLowerCase();return a.templates.filter(o=>o.name.toLowerCase().includes(u)||(o.description||"").toLowerCase().includes(u))}),m=F(()=>{if(!x.value)return a.spreadsheets;const u=x.value.toLowerCase();return a.spreadsheets.filter(o=>o.name.toLowerCase().includes(u)||(o.description||"").toLowerCase().includes(u))});function v(u){const o=typeof u=="string"?new Date(u):u,z=new Date().getTime()-o.getTime(),R=Math.floor(z/(1e3*60*60*24));if(R===0){const A=Math.floor(z/36e5);if(A===0){const T=Math.floor(z/6e4);return T<=1?"just now":`${T} min ago`}return A===1?"1 hour ago":`${A} hours ago`}else return R===1?"yesterday":R<7?`${R} days ago`:o.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function h(u){return u.variables?Object.keys(u.variables).length:0}function I(u){var E,z;if(!u.variables)return 1;let o=1;for(const[,R]of Object.entries(u.variables))if(R.type==="value"&&R.values)o*=R.values.length;else if(R.type==="list"&&R.listId){const A=a.variableLists.find(T=>T.id===R.listId);A&&(A.category==="simple"?o*=((E=A.values)==null?void 0:E.length)||0:A.category==="attributed"?o*=((z=A.items)==null?void 0:z.length)||0:A.category==="tabular"&&(o*=A.itemCount||0))}return o}function b(u){const o=a.variableLists.find(E=>E.id===u.datasetId);return(o==null?void 0:o.itemCount)||0}function L(u){var E;const o=a.variableLists.find(z=>z.id===u.datasetId);return(o==null?void 0:o.category)==="tabular"&&((E=o.tabularData)!=null&&E.columns)?o.tabularData.columns.length:0}function N(u){if(!u)return"???";try{if("template"in u&&u.template)return`~${V.estimateTokens(u.template)}`;if("promptPattern"in u&&u.promptPattern)return`~${V.estimateTokens(u.promptPattern)}`}catch(o){Y.warn("Failed to estimate tokens:",o)}return"???"}return(u,o)=>{const E=B("a-input"),z=B("a-spin"),R=B("a-button"),A=B("a-tag"),T=B("a-tab-pane"),J=B("a-tabs");return f(),k("div",Ye,[r(J,{activeKey:S.value,"onUpdate:activeKey":o[6]||(o[6]=e=>S.value=e),size:"large"},{default:w(()=>[r(T,{key:"template",tab:"Prompt Designs (one API call per combination)"},{default:w(()=>[t("div",He,[r(E,{value:c.value,"onUpdate:value":o[0]||(o[0]=e=>c.value=e),placeholder:"Search prompt designs...",size:"large",class:"design-search","data-testid":"input-template-search",allowClear:""},{prefix:w(()=>[r(D(ce))]),_:1},8,["value"]),!u.templates||u.templates.length===0?(f(),k("div",Ge,[t("div",Qe,[r(z,{size:"large",tip:"Loading templates..."})])])):C.value.length===0?(f(),k("div",Ze,[t("div",Xe,[o[8]||(o[8]=t("p",null,"No prompt designs found",-1)),r(R,{type:"primary",onClick:o[1]||(o[1]=e=>u.$emit("create-template"))},{default:w(()=>[r(D(Ee)),o[7]||(o[7]=O(" Create Prompt Design "))]),_:1,__:[7]})])])):(f(),k("div",et,[(f(!0),k(X,null,ee(C.value,e=>(f(),k("div",{key:e.id,class:"design-item","data-testid":"template-item","data-template-id":e.id,"data-template-name":e.name,onClick:s=>u.$emit("select",e)},[t("div",at,[t("div",st,[t("h4",nt,[O(y(e.name)+" ",1),e.description?(f(),k("span",ot,"- "+y(e.description),1)):U("",!0)])]),t("span",it,y(v(e.updated)),1)]),r(oe,{template:e,"variable-lists":u.variableLists,cycling:!0,"show-controls":!1,"display-mode":"inline","max-lines":5,class:"design-preview"},null,8,["template","variable-lists"]),t("div",lt,[r(A,{size:"small",color:"blue",class:"output-type-tag"},{default:w(()=>[O(y(e.outputType||"text"),1)]),_:2},1024),t("span",rt,[t("span",dt,y(h(e)),1),o[9]||(o[9]=t("span",{class:"stat-label"},"vars",-1))]),o[12]||(o[12]=t("span",{class:"stat-divider"},"•",-1)),t("span",ut,[t("span",pt,y(I(e)),1),o[10]||(o[10]=t("span",{class:"stat-label"},"combos",-1))]),o[13]||(o[13]=t("span",{class:"stat-divider"},"•",-1)),t("span",ct,[t("span",mt,y(N(e)),1),o[11]||(o[11]=t("span",{class:"stat-label"},"tokens",-1))])])],8,tt))),128)),t("div",{class:"design-item design-item-create","data-testid":"btn-create-design",onClick:o[2]||(o[2]=e=>u.$emit("create-template"))},[r(D(ae),{style:{"font-size":"24px"}}),o[14]||(o[14]=t("span",null,"Create New Design",-1))])]))])]),_:1}),r(T,{key:"spreadsheet",tab:"Spreadsheet Designs (one API call per row)"},{default:w(()=>[t("div",vt,[r(E,{value:x.value,"onUpdate:value":o[3]||(o[3]=e=>x.value=e),placeholder:"Search spreadsheet designs...",size:"large",class:"design-search","data-testid":"input-spreadsheet-search",allowClear:""},{prefix:w(()=>[r(D(ce))]),_:1},8,["value"]),m.value.length===0?(f(),k("div",ft,[t("div",gt,[o[16]||(o[16]=t("p",null,"No spreadsheet designs found",-1)),r(R,{type:"primary",onClick:o[4]||(o[4]=e=>u.$emit("create-spreadsheet"))},{default:w(()=>[r(D(Me)),o[15]||(o[15]=O(" Create Spreadsheet Design "))]),_:1,__:[15]})])])):(f(),k("div",yt,[(f(!0),k(X,null,ee(m.value,e=>(f(),k("div",{key:e.id,class:"design-item","data-testid":"spreadsheet-item","data-spreadsheet-id":e.id,"data-spreadsheet-name":e.name,onClick:s=>u.$emit("select",e)},[t("div",_t,[t("div",bt,[t("h4",ht,[O(y(e.name)+" ",1),e.description?(f(),k("span",kt,"- "+y(e.description),1)):U("",!0)])]),t("span",$t,y(v(e.updated)),1)]),r(oe,{template:e,"variable-lists":u.variableLists,cycling:!0,"show-controls":!1,"display-mode":"inline","max-lines":5,class:"design-preview"},null,8,["template","variable-lists"]),t("div",Tt,[r(A,{size:"small",color:"green",class:"output-type-tag"},{default:w(()=>[O(y(e.outputType||"text"),1)]),_:2},1024),t("span",wt,[t("span",It,y(b(e)),1),o[17]||(o[17]=t("span",{class:"stat-label"},"rows",-1))]),o[20]||(o[20]=t("span",{class:"stat-divider"},"•",-1)),t("span",St,[t("span",Pt,y(L(e)),1),o[18]||(o[18]=t("span",{class:"stat-label"},"cols",-1))]),o[21]||(o[21]=t("span",{class:"stat-divider"},"•",-1)),t("span",xt,[t("span",Dt,y(N(e)),1),o[19]||(o[19]=t("span",{class:"stat-label"},"tokens",-1))])])],8,Ct))),128)),t("div",{class:"design-item design-item-create","data-testid":"btn-create-spreadsheet",onClick:o[5]||(o[5]=e=>u.$emit("create-spreadsheet"))},[r(D(ae),{style:{"font-size":"24px"}}),o[22]||(o[22]=t("span",null,"Create New Spreadsheet Design",-1))])]))])]),_:1})]),_:1},8,["activeKey"])])}}}),Et=Z(Vt,[["__scopeId","data-v-db101528"]]),Mt={class:"trial-metadata-form"},Lt=Q({__name:"TrialMetadataV3",props:{name:{},repeatCount:{default:1},description:{default:""},totalCombinations:{default:0}},emits:["update:name","update:repeatCount","update:description"],setup(W,{emit:V}){const a=W,S=V,c=be({name:a.name,repeatCount:a.repeatCount,description:a.description||""}),x=F(()=>{if(a.totalCombinations>0&&c.repeatCount>1){const m=a.totalCombinations*c.repeatCount;return`Each prompt will be run ${c.repeatCount} times (${m} total calls)`}return"Number of times to run each prompt"});function C(){S("update:name",c.name),S("update:repeatCount",c.repeatCount),S("update:description",c.description)}return G(()=>a.name,m=>{c.name=m}),G(()=>a.repeatCount,m=>{c.repeatCount=m}),G(()=>a.description,m=>{c.description=m||""}),(m,v)=>{const h=B("a-input"),I=B("a-form-item"),b=B("a-col"),L=B("a-input-number"),N=B("a-row"),u=B("a-textarea"),o=B("a-form");return f(),k("div",Mt,[r(o,{layout:"vertical",model:c},{default:w(()=>[r(N,{gutter:24},{default:w(()=>[r(b,{span:18},{default:w(()=>[r(I,{label:"Trial Name",rules:[{required:!0,message:"Please enter a trial name"}]},{default:w(()=>[r(h,{value:c.name,"onUpdate:value":v[0]||(v[0]=E=>c.name=E),size:"large",placeholder:"e.g., GPT-4 Performance Test",onChange:C},null,8,["value"])]),_:1})]),_:1}),r(b,{span:6},{default:w(()=>[r(I,{label:"Repeat Count",help:x.value},{default:w(()=>[r(L,{value:c.repeatCount,"onUpdate:value":v[1]||(v[1]=E=>c.repeatCount=E),min:1,max:100,size:"large",style:{width:"100%"},onChange:C},null,8,["value"])]),_:1},8,["help"])]),_:1})]),_:1}),r(I,{label:"Description (Optional)"},{default:w(()=>[r(u,{value:c.description,"onUpdate:value":v[2]||(v[2]=E=>c.description=E),placeholder:"Add any notes about this trial...",rows:2,onChange:C},null,8,["value"])]),_:1})]),_:1},8,["model"])])}}}),Ot=Z(Lt,[["__scopeId","data-v-b945eb57"]]),At={class:"model-configuration"},Nt={key:0,class:"quick-add-section"},zt={class:"quick-add-models"},Rt={class:"provider-name"},jt={class:"model-name"},Bt={key:0,class:"param-info"},Ft={class:"configuration-table"},Ut={class:"table-header"},Jt={style:{display:"inline-flex","align-items":"center",gap:"0"}},qt={key:0,class:"model-name-cell"},Wt={class:"model-name"},Kt={class:"model-id"},Yt={key:1,class:"parameter-tags"},Ht={key:2,class:"cost-cell"},Gt={class:"cost-value"},Qt={key:0,class:"cost-summary"},Zt={class:"cost-summary-item"},Xt={class:"cost-summary-item"},ea={class:"total-cost"},ta=Q({__name:"ModelConfigurationV3",props:{configurations:{},totalCombinations:{},repeatCount:{},tokenData:{}},emits:["add-configuration","remove-configuration"],setup(W,{emit:V}){const a=W,S=V,{models:c}=le(),{trials:x}=re(),{estimateTotalCost:C,multiplyEstimate:m}=de(),v=q(!1),h=F(()=>{var _;const e=new Map;if(x.value&&x.value.length>0){const d=x.value.filter(P=>P.status!=="draft").slice(0,10);for(const P of d)if(P.configurations){for(const i of P.configurations){const $=JSON.stringify(i.parameters||{}),g=`${i.provider}-${i.modelId}-${$}`;if(e.has(g)||e.set(g,i),e.size>=15)break}if(e.size>=15)break}}const s=new Set(a.configurations.map(d=>{const P=JSON.stringify(d.parameters||{});return`${d.provider}-${d.modelId}-${P}`})),l=Array.from(e.values()).filter(d=>{var g;const P=JSON.stringify(d.parameters||{}),i=`${d.provider}-${d.modelId}-${P}`;if(s.has(i))return!1;const $=(g=c.value)==null?void 0:g.find(M=>M.provider===d.provider&&M.modelId===d.modelId);return!(!$||!$.enabled)}),n=[{provider:"openai-chat",modelId:"gpt-4o-mini",params:{temperature:0,max_completion_tokens:1e3}},{provider:"openai-chat",modelId:"gpt-4.1-nano",params:{temperature:0,max_completion_tokens:500}},{provider:"anthropic",modelId:"claude-3-5-haiku-latest",params:{temperature:0,max_tokens:1e3}},{provider:"openrouter",modelId:"meta-llama/llama-4-maverick",params:{temperature:.8,max_tokens:2e3}},{provider:"openrouter",modelId:"mistralai/mistral-nemo",params:{temperature:.7,max_tokens:1500}},{provider:"ollama-generate",modelId:"qwen2.5:0.5b",params:{temperature:0,num_predict:500,stream:!1}},{provider:"ollama-generate",modelId:"llama3.2:1b",params:{temperature:0,num_predict:1e3,stream:!1}}],p=[];for(const d of n){const P=JSON.stringify(d.params),i=`${d.provider}-${d.modelId}-${P}`;if(!s.has(i)&&!e.has(i)){const $=(_=c.value)==null?void 0:_.find(g=>g.provider===d.provider&&g.modelId===d.modelId);$&&$.enabled&&p.push({provider:d.provider,modelId:d.modelId,parameters:d.params,providerSnapshot:{},modelSnapshot:$})}}return[...l,...p].slice(0,10)}),I=[{title:"Model",key:"name",width:"35%"},{title:"Parameters",key:"parameters",width:"35%"},{title:"Cost",key:"cost",width:"20%"},{title:"",key:"actions",width:"10%"}],b=F(()=>a.configurations.map((e,s)=>({key:`${e.provider}-${e.modelId}-${s}`,...e}))),L=F(()=>a.totalCombinations*a.configurations.length*a.repeatCount),N=F(()=>a.tokenData?a.configurations.reduce((e,s)=>{var _;const l=(_=c.value)==null?void 0:_.find(d=>d.provider===s.provider&&d.modelId===s.modelId);if(!l)return e;const n=C(a.tokenData.totalTokens,a.tokenData.combinationCount,l,s.parameters),p=a.repeatCount>1?m(n,a.repeatCount):n;return e+p.cost.total.expected},0):0);function u(e){var P;if(!a.tokenData)return"?? (no token data)";const s=(P=c.value)==null?void 0:P.find(i=>i.provider===e.provider&&i.modelId===e.modelId);if(!s)return"?? (model not found)";const l=C(a.tokenData.totalTokens,a.tokenData.combinationCount,s,e.parameters);if(!l.meta.hasValidCost||l.cost.total.expected===-1)return"?? (no pricing data)";const n=a.repeatCount>1?m(l,a.repeatCount):l,p=n.cost.total.min,_=n.cost.total.max,d=n.cost.total.expected;return Math.abs(_-p)<1e-4?`$${o(d)}`:`$${o(p)}-$${o(_)}`}function o(e){if(e===0)return"0.00";if(e<.01){let s=2,l=e;for(;l<.1;)l*=10,s++;return e.toFixed(s)}return e<1?e.toFixed(3):e<10?e.toFixed(2):e<100?e.toFixed(1):Math.round(e).toLocaleString()}function E(e){const s={},l=["temperature","max_tokens","max_completion_tokens","num_predict","maxTokens","top_p","top_k","reasoning_effort"];for(const n of l)e[n]!==void 0&&e[n]!==null&&(s[n]=e[n]);for(const[n,p]of Object.entries(e))p!=null&&!l.includes(n)&&(s[n]=p);return s}function z(e){return e.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase())}function R(e){if(!e||Object.keys(e).length===0)return"";const s=[];return e.temperature!==void 0&&s.push(`T:${e.temperature}`),e.max_tokens!==void 0?s.push(`${e.max_tokens}t`):e.maxTokens!==void 0?s.push(`${e.maxTokens}t`):e.num_predict!==void 0&&s.push(`${e.num_predict}t`),e.top_p!==void 0&&s.push(`p:${e.top_p}`),s.length>0?`(${s.join(", ")})`:""}function A(e){var n,p;const s=Pe.validateParameters(e.provider,e.modelId,e.parameters||{});if(!s.valid){Y.error("Quick Add validation failed:",{provider:e.provider,modelId:e.modelId,parameters:e.parameters,errors:s.errors}),alert(`Cannot add model configuration: ${((n=s.errors)==null?void 0:n.join(", "))||"Invalid parameters"}`);return}const l={name:((p=e.modelSnapshot)==null?void 0:p.displayName)||e.modelId,provider:e.provider,modelId:e.modelId,parameters:{...e.parameters}};S("add-configuration",l)}function T(e){S("add-configuration",e),v.value=!1}function J(e){S("remove-configuration",e)}return(e,s)=>{const l=B("a-button"),n=B("a-tooltip"),p=B("a-tag"),_=B("a-table");return f(),k("div",At,[h.value.length>0?(f(),k("div",Nt,[s[2]||(s[2]=t("h4",null,"Quick Add Recent Models",-1)),t("div",zt,[(f(!0),k(X,null,ee(h.value,d=>{var P;return f(),H(l,{key:`${d.provider}-${d.modelId}-${JSON.stringify(d.parameters)}`,size:"small",onClick:i=>A(d),class:"quick-add-button",title:`Add ${((P=d.modelSnapshot)==null?void 0:P.displayName)||d.modelId} (${d.provider}) with recent parameters`},{default:w(()=>{var i;return[r(D(ae)),t("span",Rt,y(d.provider)+"/",1),t("span",jt,y(((i=d.modelSnapshot)==null?void 0:i.displayName)||d.modelId),1),R(d.parameters)?(f(),k("span",Bt,y(R(d.parameters)),1)):U("",!0)]}),_:2},1032,["onClick","title"])}),128))])])):U("",!0),t("div",Ft,[t("div",Ut,[t("h3",Jt,[r(n,{placement:"topLeft"},{title:w(()=>s[3]||(s[3]=[O(" Add models to test with your template and configure their parameters like temperature, max tokens, etc. ")])),default:w(()=>[s[4]||(s[4]=t("span",null,"Model Configurations to Test",-1))]),_:1,__:[4]}),s[6]||(s[6]=t("span",null,"  ",-1)),r(l,{type:"primary",size:"small",onClick:s[0]||(s[0]=d=>v.value=!0)},{default:w(()=>[r(D(ae)),s[5]||(s[5]=O(" Add Model "))]),_:1,__:[5]})])]),r(_,{columns:I,"data-source":b.value,pagination:!1,locale:{emptyText:"No models configured. Add at least one model to proceed."},"row-key":"key"},{bodyCell:w(({column:d,record:P,index:i})=>[d.key==="name"?(f(),k("div",qt,[t("span",Wt,y(P.name),1),t("span",Kt,y(P.provider)+":"+y(P.modelId),1)])):d.key==="parameters"?(f(),k("div",Yt,[(f(!0),k(X,null,ee(E(P.parameters),($,g)=>(f(),H(p,{key:g},{default:w(()=>[O(y(z(g))+": "+y($),1)]),_:2},1024))),128))])):d.key==="cost"?(f(),k("div",Ht,[t("span",Gt,y(u(P)),1),s[7]||(s[7]=t("span",{class:"cost-label"},"total trial cost",-1))])):d.key==="actions"?(f(),H(l,{key:3,type:"text",danger:"",size:"small",onClick:$=>J(i)},{default:w(()=>[r(D(Le))]),_:2},1032,["onClick"])):U("",!0)]),_:1},8,["data-source"]),e.configurations.length>0?(f(),k("div",Qt,[t("div",Zt,[s[8]||(s[8]=t("span",null,"Total experiments:",-1)),t("strong",null,y(L.value),1)]),t("div",Xt,[s[9]||(s[9]=t("span",null,"Estimated total cost:",-1)),t("strong",ea,"$"+y(o(N.value)),1)])])):U("",!0)]),r(je,{visible:v.value,"onUpdate:visible":s[1]||(s[1]=d=>v.value=d),mode:"trial","trial-context":{totalCombinations:e.totalCombinations,tokenData:e.tokenData??null},"existing-configurations":e.configurations,onAddConfiguration:T},null,8,["visible","trial-context","existing-configurations"])])}}}),aa=Z(ta,[["__scopeId","data-v-1d4ece19"]]),sa={class:"trial-configuration"},na={class:"configuration-sections"},oa={class:"config-section"},ia={class:"config-section"},la=["aria-expanded"],ra={class:"section-title"},da={class:"expand-hint"},ua={key:0,class:"design-info"},pa={class:"design-stats"},ca={class:"stat"},ma={class:"stat-value"},va={class:"stat"},fa={class:"stat-value"},ga={class:"config-section"},ya=Q({__name:"TrialConfiguration",setup(W){const V=he("trialCreation"),{calculateTemplateTokens:a,calculatePromptTokens:S}=de(),c=q(!1),x=q(!1),C=F(()=>V.selectedPrompt.value),m=F(()=>{var h;const v=C.value;if(!v)return null;try{if(v.type==="template"){const I=v.template,b=v.variables,L=(h=V.variableLists)==null?void 0:h.value;return I?a(I,b||{},L||[]):null}else if(v.type==="spreadsheet"){const I=v.promptPattern;if(!I)return null;const b=S(I),L=V.totalCombinations.value;return{totalTokens:b*L,combinationCount:L,perCallAverage:b}}else return null}catch(I){return Y.error("Error calculating tokenData:",I),null}});return(v,h)=>{var I;return f(),k("div",sa,[t("div",na,[t("section",oa,[h[6]||(h[6]=t("h2",{class:"section-title"},"Trial Details",-1)),r(Ot,{name:D(V).trialName.value,"repeat-count":D(V).repeatCount.value,description:((I=D(V).description)==null?void 0:I.value)||"","total-combinations":D(V).totalCombinations.value,"onUpdate:name":h[0]||(h[0]=b=>D(V).trialName.value=b),"onUpdate:repeatCount":h[1]||(h[1]=b=>D(V).repeatCount.value=b),"onUpdate:description":h[2]||(h[2]=b=>D(V).description.value=b)},null,8,["name","repeat-count","description","total-combinations"])]),t("section",ia,[t("button",{class:"collapsible-header",onClick:h[3]||(h[3]=b=>c.value=!c.value),"aria-expanded":c.value},[r(D(Oe),{class:ne([{expanded:c.value},"expand-icon"])},null,8,["class"]),t("h2",ra,[h[7]||(h[7]=O("Selected Design Preview ")),t("span",da,"(click to "+y(c.value?"collapse":"expand")+")",1)])],8,la),c.value?(f(),k("div",ua,[r(oe,{template:C.value,"variable-lists":D(V).variableLists.value,cycling:x.value,"show-controls":!0,"display-mode":"block","show-legend":!0,"onUpdate:paused":h[4]||(h[4]=b=>x.value=!b),onBackToSelect:h[5]||(h[5]=b=>v.$emit("back"))},null,8,["template","variable-lists","cycling"]),t("div",pa,[t("div",ca,[h[8]||(h[8]=t("span",{class:"stat-label"},"Total Combinations:",-1)),t("span",ma,y(D(V).totalCombinations.value),1)]),t("div",va,[h[9]||(h[9]=t("span",{class:"stat-label"},"Total Input Tokens:",-1)),t("span",fa,y(m.value!==null?`${m.value.totalTokens.toLocaleString()} total (${m.value.combinationCount.toLocaleString()} calls)`:"??"),1)])])])):U("",!0)]),t("section",ga,[h[10]||(h[10]=t("h2",{class:"section-title"},"Add Models and Set Parameters",-1)),r(aa,{configurations:D(V).configurations.value,"total-combinations":D(V).totalCombinations.value,"repeat-count":D(V).repeatCount.value,"token-data":m.value,onAddConfiguration:D(V).addConfiguration,onRemoveConfiguration:D(V).removeConfiguration},null,8,["configurations","total-combinations","repeat-count","token-data","onAddConfiguration","onRemoveConfiguration"])])])])}}}),Ca=Z(ya,[["__scopeId","data-v-794621cc"]]),_a={class:"trial-submission"},ba={class:"review-section"},ha={class:"summary-card"},ka={class:"summary-item"},$a={class:"value"},Ta={class:"summary-item"},wa={class:"value"},Ia={class:"summary-item"},Sa={class:"value"},Pa={key:0,class:"summary-item"},xa={class:"value"},Da={key:1,class:"summary-item"},Va={class:"value"},Ea={class:"summary-item"},Ma={class:"value"},La={key:2,class:"summary-item"},Oa={class:"value"},Aa={class:"summary-item"},Na={class:"value highlight"},za={key:3,class:"summary-item"},Ra={key:0,class:"value highlight"},ja={key:1,class:"value"},Ba={class:"configurations-review"},Fa={class:"config-header"},Ua={class:"config-name"},Ja={class:"config-model"},qa={class:"config-params"},Wa={key:0,class:"running-trials-warning"},Ka={class:"action-buttons"},Ya={key:0},Ha={key:1},Ga={key:2},Qa=Q({__name:"TrialSubmission",props:{trialConfig:{},design:{}},emits:["back","create-draft","create-and-start","export-python"],setup(W,{emit:V}){const a=W,S=V,{runningTrials:c}=re(),{variableLists:x}=me(),{models:C}=le(),{calculateTemplateTokens:m,calculatePromptTokens:v,estimateTotalCost:h,sumEstimates:I}=de(),b=q(null),L=q(!1),N=q(!1),u=F(()=>c.value.length>0),o=F(()=>c.value.length),E=F(()=>{var p,_,d,P;if(!a.trialConfig.configurations)return 0;let l=1;if(a.design.type==="template"&&a.design.variables)for(const[,i]of Object.entries(a.design.variables)){const $=i;if($.type==="value"&&$.values)l*=$.values.length;else if($.type==="list"&&$.listId){const g=(p=x.value)==null?void 0:p.find(M=>M.id===$.listId);g&&(g.category==="simple"?l*=((_=g.values)==null?void 0:_.length)||0:g.category==="attributed"?l*=((d=g.items)==null?void 0:d.length)||0:g.category==="tabular"&&(l*=g.itemCount||0))}}else if(a.design.type==="spreadsheet"){const i=(P=x.value)==null?void 0:P.find($=>$.id===a.design.datasetId);l=(i==null?void 0:i.itemCount)||0}const n=a.trialConfig.repeatCount||1;return l*a.trialConfig.configurations.length*n}),z=F(()=>{var _,d,P,i,$;if(!a.trialConfig.configurations||a.trialConfig.configurations.length===0)return-1;let l=null;if(a.design.type==="template"){const g=((_=a.trialConfig.templateConfig)==null?void 0:_.template)||a.design.template||"",M=((d=a.trialConfig.templateConfig)==null?void 0:d.variables)||a.design.variables||{};l=m(g,M,x.value)}else if(a.design.type==="spreadsheet"){const g=((P=a.trialConfig.spreadsheetConfig)==null?void 0:P.promptPattern)||a.design.promptPattern||"",M=v(g),j=E.value/a.trialConfig.configurations.length;l={totalTokens:M*j,combinationCount:j,perCallAverage:M}}if(!l||l.totalTokens===0)return Y.error("TrialSubmission: No prompt content found for cost estimation",{type:a.design.type,hasTemplate:!!((i=a.trialConfig.templateConfig)!=null&&i.template)||!!a.design.template,hasPromptPattern:!!(($=a.trialConfig.spreadsheetConfig)!=null&&$.promptPattern)||!!a.design.promptPattern}),-1;const n=a.trialConfig.configurations.map(g=>{var j;const M=(j=C.value)==null?void 0:j.find(K=>K.provider===g.provider&&K.modelId===g.modelId);return M?h(l.totalTokens,l.combinationCount,M,g.parameters):null}).filter(Boolean);return n.length===0?-1:I(n).cost.total.expected});function R(l){const n=[];"temperature"in l&&n.push(`temperature=${l.temperature}`),"max_tokens"in l&&n.push(`max_tokens=${l.max_tokens}`),"top_p"in l&&n.push(`top_p=${l.top_p}`);const p=Object.keys(l).length-n.length;return p>0&&n.push(`+${p} more`),n.join(", ")}function A(){return{name:a.trialConfig.name||"",description:a.trialConfig.description,type:a.design.type,configurations:a.trialConfig.configurations||[],repeatCount:a.trialConfig.repeatCount||1,templateConfig:a.trialConfig.templateConfig,spreadsheetConfig:a.trialConfig.spreadsheetConfig}}async function T(){b.value="draft";try{const l=A();S("create-draft",l)}finally{b.value=null}}async function J(){L.value=!0;try{const l=A();S("export-python",l)}finally{L.value=!1}}function e(){u.value||z.value>10&&z.value!==-1?N.value=!0:s()}async function s(){N.value=!1,b.value="start";try{const l=A();S("create-and-start",l)}finally{b.value=null}}return(l,n)=>{var P;const p=B("a-button"),_=B("a-alert"),d=B("a-modal");return f(),k("div",_a,[r(p,{type:"link",onClick:n[0]||(n[0]=i=>l.$emit("back")),class:"back-button"},{default:w(()=>[r(D(Ae)),n[3]||(n[3]=O(" Back to Configuration "))]),_:1,__:[3]}),t("div",ba,[n[15]||(n[15]=t("h2",null,"Review & Create Trial",-1)),t("div",ha,[n[13]||(n[13]=t("h3",null,"Trial Summary",-1)),t("div",ka,[n[4]||(n[4]=t("span",{class:"label"},"Name:",-1)),t("span",$a,y(l.trialConfig.name),1)]),t("div",Ta,[n[5]||(n[5]=t("span",{class:"label"},"Type:",-1)),t("span",wa,y(l.design.type==="template"?"Template":"Spreadsheet"),1)]),t("div",Ia,[n[6]||(n[6]=t("span",{class:"label"},"Design:",-1)),t("span",Sa,y(l.design.name),1)]),l.design.type==="template"?(f(),k("div",Pa,[n[7]||(n[7]=t("span",{class:"label"},"Variables:",-1)),t("span",xa,y(Object.keys(l.design.variables||{}).length)+" variables configured ",1)])):U("",!0),l.design.type==="spreadsheet"?(f(),k("div",Da,[n[8]||(n[8]=t("span",{class:"label"},"Dataset:",-1)),t("span",Va,y(l.design.rowCount)+" rows",1)])):U("",!0),t("div",Ea,[n[9]||(n[9]=t("span",{class:"label"},"Model Configurations:",-1)),t("span",Ma,y(((P=l.trialConfig.configurations)==null?void 0:P.length)||0)+" models",1)]),l.trialConfig.repeatCount&&l.trialConfig.repeatCount>1?(f(),k("div",La,[n[10]||(n[10]=t("span",{class:"label"},"Repeat Count:",-1)),t("span",Oa,y(l.trialConfig.repeatCount)+" times per prompt",1)])):U("",!0),t("div",Aa,[n[11]||(n[11]=t("span",{class:"label"},"Total API Calls:",-1)),t("span",Na,y(E.value),1)]),z.value!==-1?(f(),k("div",za,[n[12]||(n[12]=t("span",{class:"label"},"Estimated Cost:",-1)),z.value>0?(f(),k("span",Ra,"$"+y(z.value.toFixed(4)),1)):(f(),k("span",ja,"Unable to estimate (no prompt content)"))])):U("",!0)]),t("div",Ba,[n[14]||(n[14]=t("h3",null,"Model Configurations",-1)),(f(!0),k(X,null,ee(l.trialConfig.configurations,(i,$)=>(f(),k("div",{key:`review-config-${$}`,class:"config-review-item"},[t("div",Fa,[t("span",Ua,y(i.name||i.modelId),1),t("span",Ja,y(i.provider)+":"+y(i.modelId),1)]),t("div",qa,y(R(i.parameters)),1)]))),128))]),u.value?(f(),k("div",Wa,[r(_,{message:"Running Trials Detected",description:`You have ${o.value} trial(s) currently running. Starting a new trial may affect performance.`,type:"warning","show-icon":""},null,8,["description"])])):U("",!0)]),t("div",Ka,[r(p,{size:"large",onClick:T,loading:b.value==="draft"},{default:w(()=>[r(D(fe)),n[16]||(n[16]=O(" Create as Draft "))]),_:1,__:[16]},8,["loading"]),r(p,{size:"large",onClick:J,loading:L.value},{default:w(()=>[r(D(Ne)),n[17]||(n[17]=O(" Export to Python "))]),_:1,__:[17]},8,["loading"]),r(p,{type:"primary",size:"large",onClick:e,loading:b.value==="start"},{default:w(()=>[r(D(ze)),n[18]||(n[18]=O(" Create and Start "))]),_:1,__:[18]},8,["loading"])]),r(d,{visible:N.value,"onUpdate:visible":n[1]||(n[1]=i=>N.value=i),title:"Confirm Trial Creation",onOk:s,onCancel:n[2]||(n[2]=i=>N.value=!1)},{default:w(()=>[n[19]||(n[19]=t("p",null,"You are about to create and start a trial with:",-1)),t("ul",null,[t("li",null,y(E.value)+" API calls",1),z.value>0?(f(),k("li",Ya,"Estimated cost: $"+y(z.value.toFixed(4)),1)):z.value===-1?(f(),k("li",Ha,"Cost estimation unavailable")):U("",!0),u.value?(f(),k("li",Ga,y(o.value)+" other trial(s) running",1)):U("",!0)]),n[20]||(n[20]=t("p",null,"Do you want to proceed?",-1))]),_:1,__:[19,20]},8,["visible"])])}}}),Za=Z(Qa,[["__scopeId","data-v-b8e71998"]]),Xa={class:"conflict-content"},es={class:"warning-section"},ts={class:"warning-text"},as={class:"trial-info"},ss={class:"summary-grid"},ns={class:"summary-item"},os={class:"value"},is={class:"summary-item"},ls={class:"value"},rs={key:0,class:"summary-item"},ds={class:"value"},us={class:"modal-footer"},ps=Q({__name:"TrialConflictModal",props:{visible:{type:Boolean},runningTrial:{},trialConfig:{},totalApiCalls:{},estimatedCost:{}},emits:["update:visible","cancel","create-draft"],setup(W,{emit:V}){const a=W,S=V,c=q(!1);function x(){S("update:visible",!1),S("cancel")}async function C(){if(a.trialConfig){c.value=!0;try{S("create-draft",a.trialConfig),S("update:visible",!1)}finally{c.value=!1}}}return(m,v)=>{const h=B("a-button"),I=B("a-modal");return f(),H(I,{visible:m.visible,title:"Running Trial Detected",closable:!1,"mask-closable":!1,width:"600px",onCancel:x},{footer:w(()=>[t("div",us,[r(h,{onClick:x,disabled:c.value},{default:w(()=>v[8]||(v[8]=[O(" Cancel ")])),_:1,__:[8]},8,["disabled"]),r(h,{type:"primary",onClick:C,loading:c.value},{default:w(()=>[r(D(fe)),v[9]||(v[9]=O(" Create Draft "))]),_:1,__:[9]},8,["loading"])])]),default:w(()=>{var b,L;return[t("div",Xa,[t("div",es,[r(D(Re),{class:"warning-icon"}),t("div",ts,[v[2]||(v[2]=t("h3",null,"Another trial is currently running",-1)),t("p",null,[v[0]||(v[0]=O(' The trial "')),t("strong",null,y((b=m.runningTrial)==null?void 0:b.name),1),v[1]||(v[1]=O('" is currently executing. You can only run one trial at a time. '))])])]),v[7]||(v[7]=t("div",{class:"message-section"},[t("p",null,"You can only run one trial at a time. Your new trial will be saved as a draft and you can start it manually after the current trial finishes, or you can pause or cancel the running trial, then start your new draft trial.")],-1)),t("div",as,[v[6]||(v[6]=t("h4",null,"New Trial Summary:",-1)),t("div",ss,[t("div",ns,[v[3]||(v[3]=t("span",{class:"label"},"Name:",-1)),t("span",os,y((L=m.trialConfig)==null?void 0:L.name),1)]),t("div",is,[v[4]||(v[4]=t("span",{class:"label"},"API Calls:",-1)),t("span",ls,y(m.totalApiCalls),1)]),m.estimatedCost>0?(f(),k("div",rs,[v[5]||(v[5]=t("span",{class:"label"},"Estimated Cost:",-1)),t("span",ds,"$"+y(m.estimatedCost.toFixed(4)),1)])):U("",!0)])])])]}),_:1},8,["visible"])}}}),cs=Z(ps,[["__scopeId","data-v-6c2d242e"]]),ms={class:"trial-creation-content"},vs={class:"step-content"},fs={key:1,class:"modal-footer"},gs={key:2,class:"create-actions"},ys={key:2,class:"view-footer"},Cs={key:0,class:"validation-errors"},_s={class:"create-actions"},bs=Q({__name:"TrialCreationContent",props:{mode:{},initialData:{}},emits:["cancel","create-template","create-spreadsheet","created","created-and-started","export-python"],setup(W,{expose:V,emit:a}){const S=W,c=a,x=F(()=>{var e,s;return{type:((e=S.initialData)==null?void 0:e.type)||"create",sourceTrialId:(s=S.initialData)==null?void 0:s.sourceTrialId}}),C=Be(ke(x));$e("trialCreation",C);const m=q(0),v=q(!1),h=q(null),I=q(null),b=q(null);V({currentStep:m});const L=F(()=>{if(S.mode==="view")return C.selectedPrompt.value!==null&&C.canProceed.value&&C.configurations.value.length>0;switch(m.value){case 0:return C.selectedPrompt.value!==null;case 1:return C.canProceed.value;default:return!0}}),N=F(()=>{const e=[];return C.selectedPrompt.value||e.push("Select a template or spreadsheet"),C.configurations.value.length===0&&e.push("Add at least one model configuration"),C.trialName.value.trim()===""&&e.push("Enter a trial name"),e.join(" • ")});function u(){var s;const e=JSON.parse(JSON.stringify(C.selectedPrompt.value));return{name:C.trialName.value,description:((s=C.description)==null?void 0:s.value)||"",type:e.type,configurations:JSON.parse(JSON.stringify(C.configurations.value)),repeatCount:C.repeatCount.value,templateConfig:e.type==="template"?{template:e.template,variables:e.variables,outputType:e.outputType,extractPattern:e.extractPattern,refusalWords:e.refusalWords,rejectRefusalWords:e.rejectRefusalWords}:void 0,spreadsheetConfig:e.type==="spreadsheet"?{promptPattern:e.promptPattern,datasetId:e.datasetId}:void 0}}function o(e){C.selectPrompt(e),S.mode==="view"&&(m.value=1)}async function E(){try{const e=await C.createTrialAsDraft();e&&c("created",e)}catch(e){Y.error("Failed to create draft trial:",e)}}async function z(){try{const e=await C.createAndStartTrial();e&&(e.needsConfirmation?(h.value=u(),I.value=e.trialId,b.value="runningTrial"in e?e.runningTrial:null,v.value=!0):c("created-and-started",e.trialId))}catch(e){Y.error("Failed to create and start trial:",e)}}async function R(){c("export-python",u())}function A(){J()}async function T(){try{I.value&&c("created",I.value),J()}catch(e){Y.error("Failed to handle draft creation:",e)}}function J(){v.value=!1,h.value=null,I.value=null,b.value=null}return ie(async()=>{var e,s;if(await C.initialize(),(e=S.initialData)!=null&&e.templateId&&((s=S.initialData)==null?void 0:s.promptSource)==="template"){const l=()=>{const n=C.templates.value.find(p=>{var _;return p.id===((_=S.initialData)==null?void 0:_.templateId)});return n?(C.selectPrompt(n),m.value=1,!0):!1};if(!l()){const n=G(()=>C.templates.value,()=>{l()&&n()},{immediate:!0});setTimeout(()=>n(),3e3)}}}),G(m,()=>{S.mode==="view"&&window.scrollTo(0,0)}),(e,s)=>{const l=B("a-step"),n=B("a-steps"),p=B("a-button");return f(),k("div",ms,[e.mode==="modal"?(f(),H(n,{key:0,current:m.value,class:"creation-steps"},{default:w(()=>[r(l,{title:"Select Design"}),r(l,{title:"Configure Trial"}),r(l,{title:"Review & Create"})]),_:1},8,["current"])):U("",!0),t("div",vs,[m.value===0?(f(),H(Et,{key:0,templates:D(C).templates.value,spreadsheets:D(C).spreadsheets.value,"variable-lists":D(C).variableLists.value,onSelect:o,onCreateTemplate:s[0]||(s[0]=_=>e.$emit("create-template")),onCreateSpreadsheet:s[1]||(s[1]=_=>e.$emit("create-spreadsheet"))},null,8,["templates","spreadsheets","variable-lists"])):m.value===1?(f(),H(Ca,{key:1,onBack:s[2]||(s[2]=_=>m.value--)})):m.value===2?(f(),H(Za,{key:2,"trial-config":u(),design:D(C).selectedPrompt.value,onBack:s[3]||(s[3]=_=>m.value--),onCreateDraft:E,onCreateAndStart:z,onExportPython:R},null,8,["trial-config","design"])):U("",!0)]),S.mode==="modal"?(f(),k("div",fs,[r(p,{onClick:s[4]||(s[4]=_=>e.$emit("cancel"))},{default:w(()=>s[8]||(s[8]=[O("Cancel")])),_:1,__:[8]}),m.value>0?(f(),H(p,{key:0,onClick:s[5]||(s[5]=_=>m.value--)},{default:w(()=>s[9]||(s[9]=[O(" Back ")])),_:1,__:[9]})):U("",!0),m.value<2?(f(),H(p,{key:1,type:"primary",disabled:!L.value,onClick:s[6]||(s[6]=_=>m.value++)},{default:w(()=>s[10]||(s[10]=[O(" Next ")])),_:1,__:[10]},8,["disabled"])):U("",!0),m.value===2?(f(),k("div",gs,[r(p,{type:"primary",disabled:!L.value,onClick:E},{default:w(()=>s[11]||(s[11]=[O(" Create Draft ")])),_:1,__:[11]},8,["disabled"]),r(p,{type:"primary",disabled:!L.value,onClick:z},{default:w(()=>s[12]||(s[12]=[O(" Create & Start ")])),_:1,__:[12]},8,["disabled"])])):U("",!0)])):U("",!0),S.mode==="view"?(f(),k("div",ys,[L.value?U("",!0):(f(),k("div",Cs,y(N.value),1)),t("div",_s,[r(p,{size:"large",disabled:!L.value,onClick:R},{default:w(()=>s[13]||(s[13]=[O(" Export Python ")])),_:1,__:[13]},8,["disabled"]),r(p,{type:"primary",size:"large",disabled:!L.value,onClick:E},{default:w(()=>s[14]||(s[14]=[O(" Create Draft ")])),_:1,__:[14]},8,["disabled"]),r(p,{type:"primary",size:"large",disabled:!L.value,onClick:z},{default:w(()=>s[15]||(s[15]=[O(" Create & Start ")])),_:1,__:[15]},8,["disabled"])])])):U("",!0),r(cs,{visible:v.value,"onUpdate:visible":s[7]||(s[7]=_=>v.value=_),"running-trial":b.value,"trial-config":h.value,"total-api-calls":D(C).totalExperiments.value,"estimated-cost":D(C).totalCost.value,onCancel:A,onCreateDraft:T},null,8,["visible","running-trial","trial-config","total-api-calls","estimated-cost"])])}}}),hs=Z(bs,[["__scopeId","data-v-483a6718"]]),ks={class:"trial-creation-view"},$s={class:"creation-header"},Ts={class:"header-title"},ws={class:"creation-content"},Is=Q({__name:"TrialCreationV3",setup(W){const V=Te(),a=we(),S=q(),c=q(null);async function x(){const N=V.query;if(N.duplicate){const u=N.duplicate;S.value={type:"duplicate",sourceTrialId:u}}else N.designId&&N.promptSource==="template"&&(S.value={type:"create",templateId:N.designId,promptSource:"template"})}function C(){a.push("/trials")}function m(){c.value&&(c.value.currentStep=0)}async function v(N){se.success("Trial created as draft"),a.push({path:"/trials",query:{trialId:N,tab:"details"}})}async function h(N){se.success("Trial created and started"),a.push({path:"/trials",query:{trialId:N,tab:"tasks"}})}async function I(){se.info("Python export not yet implemented")}function b(){a.push("/templates/new")}function L(){a.push("/spreadsheet")}return ie(()=>{x()}),(N,u)=>{var E;const o=B("a-button");return f(),k("div",ks,[t("div",$s,[t("div",Ts,[u[1]||(u[1]=t("h1",null,"Create New Trial",-1)),((E=c.value)==null?void 0:E.currentStep)===1?(f(),H(o,{key:0,type:"link",class:"back-button",onClick:m},{default:w(()=>[r(D(ve)),u[0]||(u[0]=O(" Back to Select Template "))]),_:1,__:[0]})):U("",!0)]),r(o,{onClick:C},{default:w(()=>u[2]||(u[2]=[O("Cancel")])),_:1,__:[2]})]),t("div",ws,[r(hs,{ref_key:"creationContentRef",ref:c,mode:"view","initial-data":S.value,onCancel:C,onCreated:v,onCreatedAndStarted:h,onExportPython:I,onCreateTemplate:b,onCreateSpreadsheet:L},null,8,["initial-data"])])])}}}),js=Z(Is,[["__scopeId","data-v-38a5dd3b"]]);export{js as default};
