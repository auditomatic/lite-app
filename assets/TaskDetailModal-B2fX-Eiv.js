import{i as e,d as a,b as t,e as l,f as s,F as o,D as n,t as r,l as i,n as u,r as c,B as d,j as p,q as v,g,m,X as f,k as b,O as h,w as k}from"./vendor-DdqHZeTC.js";import{d as y,_}from"./index-Bz5Ugese.js";import{a as w}from"./apiLogger-wE3EW76_.js";const C={task_completion:{label:"Task Completion Rate",description:"Percentage of tasks that completed without errors",calculate:e=>{const a=e.filter(e=>"completed"===e.status).length,t=e.length;return{rate:t>0?a/t:0,successful:a,total:t,definition:"task_completion"}}},extraction_success:{label:"Extraction Success Rate",description:"Percentage of tasks with valid extracted values",calculate:e=>{const a=e.filter(e=>e.parsed_results&&Object.keys(e.parsed_results).length>0&&Object.values(e.parsed_results).some(e=>null!=e&&""!==e)).length,t=e.length;return{rate:t>0?a/t:0,successful:a,total:t,definition:"extraction_success"}}},response_quality:{label:"Response Quality Rate",description:"Percentage of non-empty responses without error indicators",calculate:e=>{const a=e.filter(e=>e.result&&"string"==typeof e.result&&""!==e.result.trim()&&!e.result.toLowerCase().includes("error")&&!e.error).length,t=e.length;return{rate:t>0?a/t:0,successful:a,total:t,definition:"response_quality"}}}};function F(e){return function(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e}(e)||function(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)&&Object.values(e).every(F)}(e)||function(e){return Array.isArray(e)&&e.every(F)}(e)}function S(e){if("number"==typeof e)return isNaN(e)?null:e;if("string"==typeof e){const a=e.match(/-?\d+\.?\d*/);return a?parseFloat(a[0]):null}return"boolean"==typeof e?e?1:0:null}async function M(e){return await y.tasks.where("run_id").equals(e).toArray()}function x(e,a){switch(a){case"model":return e.model;case"status":return e.status;case"response_time":return e.response_time||0;case"total_tokens":return e.usage?.total_tokens||0;case"result_length":return e.result?.length||0;case"error_type":return e.error?"error":"success";case"result":case"raw_result":return e.result||"";case"success":if(e.parsed_results&&Object.keys(e.parsed_results).length>0){return Object.values(e.parsed_results).some(e=>null!=e&&""!==e)?1:0}return 0}if(void 0!==e.parsed_results?.[a])return function(e){if(F(e))return e;if(void 0===e)return null;try{return JSON.stringify(e)}catch{return String(e)}}(e.parsed_results[a]);const t=e.variables?.[a];return null==t?null:t}const $={count:{label:"Count",calculate:e=>e.length,format:e=>e.toString(),needsNumeric:!1},sum:{label:"Sum",calculate:e=>{const a=e.map(S).filter(e=>null!==e);return a.length>0?a.reduce((e,a)=>e+a,0):null},format:e=>e?.toFixed(2)||"-",needsNumeric:!0},mean:{label:"Mean",calculate:e=>{const a=e.map(S).filter(e=>null!==e);return a.length>0?a.reduce((e,a)=>e+a,0)/a.length:null},format:e=>e?.toFixed(2)||"-",needsNumeric:!0},median:{label:"Median",calculate:e=>{const a=e.map(S).filter(e=>null!==e);if(0===a.length)return null;const t=[...a].sort((e,a)=>e-a),l=Math.floor(t.length/2);return t.length%2==0?(t[l-1]+t[l])/2:t[l]},format:e=>e?.toFixed(2)||"-",needsNumeric:!0},mode:{label:"Mode",calculate:e=>{if(0===e.length)return null;const a=new Map;e.forEach(e=>a.set(e,(a.get(e)||0)+1));let t=0,l=null;return a.forEach((e,a)=>{e>t&&(t=e,l=a)}),{value:l,count:t,total:e.length}},format:e=>e?`${e.value} (${e.count}/${e.total})`:"-",needsNumeric:!1},variance:{label:"Variance",calculate:e=>{const a=e.map(S).filter(e=>null!==e);if(a.length<=1)return null;const t=a.reduce((e,a)=>e+a,0)/a.length;return a.reduce((e,a)=>e+Math.pow(a-t,2),0)/(a.length-1)},format:e=>e?.toFixed(3)||"-",needsNumeric:!0},std_dev:{label:"Std Dev",calculate:e=>{const a=$.variance.calculate(e);return null!==a?Math.sqrt(a):null},format:e=>e?.toFixed(3)||"-",needsNumeric:!0},min:{label:"Min",calculate:e=>{const a=e.map(S).filter(e=>null!==e);return a.length>0?Math.min(...a):null},format:e=>e?.toFixed(2)||"-",needsNumeric:!0},max:{label:"Max",calculate:e=>{const a=e.map(S).filter(e=>null!==e);return a.length>0?Math.max(...a):null},format:e=>e?.toFixed(2)||"-",needsNumeric:!0},success_rate:{label:"Success Rate",calculate:(e,a)=>{const t=function(e,a){return C[a].calculate(e)}(a,"task_completion");return t.rate},format:e=>`${Math.round(100*e)}%`,needsNumeric:!1,usesTasks:!0},avg_time:{label:"Avg Time (ms)",calculate:(e,a)=>{const t=a.filter(e=>e.response_time).map(e=>e.response_time);return t.length>0?t.reduce((e,a)=>e+a,0)/t.length:null},format:e=>e?`${Math.round(e)}ms`:"-",needsNumeric:!1,usesTasks:!0}};function R(e,a){if(!e||null===e.value)return"-";return $[a].format(e.value)}const I={"blue-subtle":{name:"Blue (Subtle)",colors:["rgba(59, 130, 246, 0.1)","rgba(59, 130, 246, 0.3)","rgba(59, 130, 246, 0.7)"]},"green-red":{name:"Green-Red",colors:["#dc2626","#fbbf24","#10b981"]},"blue-yellow":{name:"Blue-Yellow",colors:["#1e40af","#3b82f6","#fbbf24"]},"purple-orange":{name:"Purple-Orange",colors:["#7c3aed","#a855f7","#ff9500"]},grayscale:{name:"Grayscale",colors:["#f3f4f6","#9ca3af","#374151"]},viridis:{name:"Viridis",colors:["#440154","#482878","#3e4989","#31688e","#26828e","#1f9e89","#35b779","#6ece58","#b5de2b","#fde725"]},inferno:{name:"Inferno",colors:["#000004","#1b0c41","#4a0c6b","#781c6d","#a52c60","#cf4446","#ed6925","#fb9b06","#f7d13d","#fcffa4"]},magma:{name:"Magma",colors:["#000004","#180f3d","#440f76","#721f81","#9e2f7f","#cd4071","#f1605d","#fd9668","#feca8d","#fcfdbf"]},plasma:{name:"Plasma",colors:["#0d0887","#46039f","#7201a8","#9c179e","#bd3786","#d8576b","#ed7953","#fb9f3a","#fdca26","#f0f921"]}};function T(e,a){if(0===a.length)return"transparent";if(1===a.length)return a[0];e=Math.max(0,Math.min(1,e));const t=1/(a.length-1),l=Math.floor(e/t),s=e%t/t;return N(a[Math.min(l,a.length-1)],a[Math.min(l+1,a.length-1)],s)}function N(e,a,t){if(e.startsWith("rgba")&&a.startsWith("rgba")){const l=e=>{const a=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+),?\s*([\d.]*)\)/);return a?{r:parseInt(a[1]),g:parseInt(a[2]),b:parseInt(a[3]),a:a[4]?parseFloat(a[4]):1}:null},s=l(e),o=l(a);if(s&&o){return`rgba(${Math.round(s.r+(o.r-s.r)*t)}, ${Math.round(s.g+(o.g-s.g)*t)}, ${Math.round(s.b+(o.b-s.b)*t)}, ${(s.a+(o.a-s.a)*t).toFixed(2)})`}}if(e.startsWith("rgba")||a.startsWith("rgba"))return t<.5?e:a;const l=e.replace("#",""),s=a.replace("#",""),o=parseInt(l.substr(0,2),16),n=parseInt(l.substr(2,2),16),r=parseInt(l.substr(4,2),16),i=parseInt(s.substr(0,2),16),u=parseInt(s.substr(2,2),16),c=parseInt(s.substr(4,2),16),d=Math.round(o+(i-o)*t),p=Math.round(n+(u-n)*t),v=Math.round(r+(c-r)*t);return`#${d.toString(16).padStart(2,"0")}${p.toString(16).padStart(2,"0")}${v.toString(16).padStart(2,"0")}`}function A(e){let a,t,l;if(e.startsWith("rgba")){const s=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+),?\s*([\d.]*)\)/);if(!s)return!1;a=parseInt(s[1]),t=parseInt(s[2]),l=parseInt(s[3])}else{const s="#"===e.charAt(0)?e.substring(1,7):e;a=parseInt(s.substring(0,2),16),t=parseInt(s.substring(2,4),16),l=parseInt(s.substring(4,6),16)}const s=[a/255,t/255,l/255].map(e=>e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4));return.2126*s[0]+.7152*s[1]+.0722*s[2]<=.179}function j(e){return A(e)?"#FFFFFF":"#000000"}function O(a,t,l){const{colorScales:s,interpolateColor:o,getContrastColor:n}={colorScales:I,interpolateColor:T,interpolateBetweenColors:N,colorIsDarkAdvanced:A,getContrastColor:j};return{getCellStyle:function(e,r,i){if(!e||null===e.value||"number"!=typeof e.value)return{};const u=s[t.value],c=function(e,t,s){const o=S(e.value);if(null===o)return.5;if("global"===l.value){const e=a.value.rows.flatMap(e=>e.cells).filter(e=>null!==e).map(e=>S(e.value)).filter(e=>null!==e);if(e.length>0){const a=Math.min(...e),t=Math.max(...e);if(t!==a)return(o-a)/(t-a)}}else if("column"===l.value){const e=a.value.rows.map(e=>e.cells[s]).filter(e=>null!==e).map(e=>S(e.value)).filter(e=>null!==e);if(e.length>0){const a=Math.min(...e),t=Math.max(...e);if(t!==a)return(o-a)/(t-a)}}else if("row"===l.value){const e=a.value.rows.find(e=>e.label===t);if(e){const a=e.cells.filter(e=>null!==e).map(e=>S(e.value)).filter(e=>null!==e);if(a.length>0){const e=Math.min(...a),t=Math.max(...a);if(t!==e)return(o-e)/(t-e)}}}return.5}(e,r,i),d=o(c,u.colors);return{backgroundColor:`${d} !important`,color:`${n(d)} !important`,fontSize:"15px !important",fontWeight:"600 !important"}},getSummaryStyle:function(e){if(!e||null===e.value||"number"!=typeof e.value)return{};const l=s[t.value];let r=.5;const i=a.value.rows.flatMap(e=>e.cells).filter(e=>null!==e).map(e=>S(e.value)).filter(e=>null!==e);if(i.length>0){const a=Math.min(...i),t=Math.max(...i),l=S(e.value);null!==l&&(r=t!==a?(l-a)/(t-a):.5)}const u=o(r,l.colors);return{backgroundColor:`${u} !important`,color:`${n(u)} !important`,fontSize:"15px !important",fontWeight:"600 !important"}},styleKey:e(()=>`${t.value}-${l.value}`)}}const P={class:"pivot-config"},E={class:"config-row"},U={class:"config-group"},V=["value"],D={label:"Categorical"},q=["value"],G={class:"config-group"},L=["value"],B={label:"Categorical"},W=["value"],J={class:"config-group"},z=["value"],H={label:"Extracted Values"},K=["value"],Y={label:"Numeric Fields"},Q=["value"],X={class:"config-group"},Z=["value"],ee=_(a({__name:"PivotConfiguration",props:{config:{},availableFields:{}},emits:["update-config"],setup(e,{emit:a}){const u=a;function c(e,a){u("update-config",e,a)}function d(e){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Token Count",result_length:"Result Length",error_type:"Error Type"}[e]||e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}return(e,a)=>(l(),t("div",P,[s("div",E,[s("div",U,[a[4]||(a[4]=s("label",null,"Rows (Group by):",-1)),s("select",{value:e.config.rowField,onChange:a[0]||(a[0]=e=>c("rowField",e.target.value))},[s("optgroup",D,[(l(!0),t(o,null,n(e.availableFields.categorical,e=>(l(),t("option",{key:e,value:e},r(d(e)),9,q))),128))])],40,V)]),s("div",G,[a[5]||(a[5]=s("label",null,"Columns (Group by):",-1)),s("select",{value:e.config.columnField,onChange:a[1]||(a[1]=e=>c("columnField",e.target.value))},[s("optgroup",B,[(l(!0),t(o,null,n(e.availableFields.categorical,e=>(l(),t("option",{key:e,value:e},r(d(e)),9,W))),128))])],40,L)]),s("div",J,[a[7]||(a[7]=s("label",null,"Values (Aggregate):",-1)),s("select",{value:e.config.valueField,onChange:a[2]||(a[2]=e=>c("valueField",e.target.value))},[s("optgroup",H,[(l(!0),t(o,null,n(e.availableFields.extracted,e=>(l(),t("option",{key:e,value:e},r(e),9,K))),128))]),s("optgroup",Y,[(l(!0),t(o,null,n(e.availableFields.numeric,e=>(l(),t("option",{key:e,value:e},r(d(e)),9,Q))),128))]),a[6]||(a[6]=s("option",{value:"result"}," Raw Result Text ",-1))],40,z)]),s("div",X,[a[9]||(a[9]=s("label",null,"Aggregation:",-1)),s("select",{value:e.config.aggregation,onChange:a[3]||(a[3]=e=>c("aggregation",e.target.value))},a[8]||(a[8]=[i('<optgroup label="Statistical" data-v-2b5d370f><option value="mean" data-v-2b5d370f> Mean </option><option value="median" data-v-2b5d370f> Median </option><option value="variance" data-v-2b5d370f> Variance </option><option value="std_dev" data-v-2b5d370f> Std Dev </option><option value="min" data-v-2b5d370f> Min </option><option value="max" data-v-2b5d370f> Max </option></optgroup><optgroup label="Frequency" data-v-2b5d370f><option value="count" data-v-2b5d370f> Count </option><option value="mode" data-v-2b5d370f> Mode </option></optgroup><optgroup label="Performance" data-v-2b5d370f><option value="success_rate" data-v-2b5d370f> Success Rate </option><option value="avg_time" data-v-2b5d370f> Avg Time </option></optgroup>',3)]),40,Z)])])]))}}),[["__scopeId","data-v-2b5d370f"]]),ae={class:"heatmap-controls"},te={class:"color-scale-selector"},le=["value"],se={class:"gradient-mode-selector"},oe={class:"gradient-toggle"},ne=["title"],re=_(a({__name:"PivotHeatmapControls",props:{selectedColorScale:{},gradientMode:{},isFullscreen:{type:Boolean}},emits:["update-color-scale","update-gradient-mode","toggle-fullscreen"],setup(e,{emit:a}){const o=a;function n(e){const a=e.target.value;o("update-color-scale",a)}function c(e){o("update-gradient-mode",e)}return(e,a)=>(l(),t("div",ae,[s("div",te,[a[5]||(a[5]=s("label",null,"Color Scale:",-1)),s("select",{value:e.selectedColorScale,onChange:n},a[4]||(a[4]=[i('<option value="blue-subtle" data-v-5e89d613> Blue (Subtle) </option><option value="green-red" data-v-5e89d613> Green-Red (Success) </option><option value="blue-yellow" data-v-5e89d613> Blue-Yellow (Performance) </option><option value="purple-orange" data-v-5e89d613> Purple-Orange (General) </option><option value="viridis" data-v-5e89d613> Viridis </option><option value="inferno" data-v-5e89d613> Inferno </option><option value="magma" data-v-5e89d613> Magma </option><option value="plasma" data-v-5e89d613> Plasma </option><option value="grayscale" data-v-5e89d613> Grayscale </option>',9)]),40,le)]),s("div",se,[a[6]||(a[6]=s("label",null,"Gradient Mode:",-1)),s("div",oe,[s("button",{class:u(["toggle-btn",{active:"global"===e.gradientMode}]),onClick:a[0]||(a[0]=e=>c("global"))}," Global ",2),s("button",{class:u(["toggle-btn",{active:"column"===e.gradientMode}]),onClick:a[1]||(a[1]=e=>c("column"))}," Per Column ",2),s("button",{class:u(["toggle-btn",{active:"row"===e.gradientMode}]),onClick:a[2]||(a[2]=e=>c("row"))}," Per Row ",2)])]),s("button",{class:"fullscreen-btn",title:e.isFullscreen?"Exit Fullscreen":"Enter Fullscreen",onClick:a[3]||(a[3]=a=>e.$emit("toggle-fullscreen"))},r(e.isFullscreen?"⊟":"⊞"),9,ne)]))}}),[["__scopeId","data-v-5e89d613"]]),ie={key:0,class:"data-filters"},ue={class:"filters-row"},ce={key:0,class:"filter-group"},de=["value"],pe={class:"filter-label"},ve=["onUpdate:modelValue"],ge={value:""},me=["value"],fe={key:1,class:"filter-group"},be=["value"],he={class:"table-view"},ke={key:0,class:"empty-state","data-testid":"empty-data-message"},ye={key:1,class:"error-state","data-testid":"invalid-aggregation-error"},_e={key:2,class:"pivot-table-container"},we={class:"pivot-table-grid responsive-table"},Ce={class:"corner-cell"},Fe={key:0,class:"total-header"},Se={class:"row-header"},Me=["data-testid","title","aria-label","role","onClick"],xe={key:0,class:"cell-content"},$e=["title"],Re={class:"cell-value"},Ie={class:"error-message"},Te={key:1},Ne=_(a({__name:"PivotTableCore",props:{tasks:{},config:{},maxTableRows:{default:1e4},showTotals:{type:Boolean,default:!0}},emits:["config-change","cell-click"],setup(a,{emit:i}){const k=a,y=i,_=c(!1),w=c("viridis"),C=c("global"),F=c({rowField:k.config?.rowField||"",columnField:k.config?.columnField||"",valueField:k.config?.valueField||"",aggregation:k.config?.aggregation||"mean"});d(()=>k.config,e=>{e&&Object.assign(F.value,e)},{deep:!0});const M=e(()=>function(e){const a=new Set,t=new Set;e.forEach(e=>{e.variables&&Object.keys(e.variables).forEach(e=>a.add(e)),e.parsed_results&&Object.keys(e.parsed_results).forEach(e=>t.add(e))});const l=Array.from(a).sort(),s=["success",...Array.from(t).sort()];return{categorical:[...l,"model","status","error_type"],numeric:["response_time","total_tokens","result_length"].sort(),extracted:s}}(T.value.length>0||j.value?T.value:k.tasks)),I=c({}),T=c([]),N=e(()=>{if(0===k.tasks.length)return{};const e={};k.tasks.forEach(a=>{a.model&&(e.model||(e.model=new Set),e.model.add(a.model)),a.status&&(e.status||(e.status=new Set),e.status.add(a.status)),a.variables&&Object.entries(a.variables).forEach(([a,t])=>{t&&String(t).trim()&&(e[a]||(e[a]=new Set),e[a].add(String(t)))})});const a={};return Object.entries(e).forEach(([e,t])=>{a[e]=Array.from(t).sort()}),a}),A=e(()=>{const{model:e,status:a,...t}=N.value;return t}),j=e(()=>Object.values(I.value).some(e=>""!==e));function P(){T.value=k.tasks.filter(e=>{if(I.value.model&&""!==I.value.model&&e.model!==I.value.model)return!1;if(I.value.status&&""!==I.value.status&&e.status!==I.value.status)return!1;for(const[a,t]of Object.entries(I.value))if(t&&""!==t&&"model"!==a&&"status"!==a){const l=e.variables?.[a];if(l!==t)return!1}return!0})}function E(){I.value={},P()}d(()=>k.tasks,()=>{j.value?P():T.value=k.tasks},{immediate:!0});const U=e(()=>{const e=T.value.length>0||j.value?T.value:k.tasks;return 0===e.length?{rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,tasks:[],rawValues:[]}}:function(e,a){const t=new Map,l=new Set,s=new Set;e.forEach(e=>{const o=String(x(e,a.rowField)||"Unknown"),n=String(x(e,a.columnField)||"Unknown");l.add(o),s.add(n),t.has(o)||t.set(o,new Map),t.get(o).has(n)||t.get(o).set(n,[]),t.get(o).get(n).push(e)});const o=e=>e.every(e=>!isNaN(Number(e))&&""!==e.trim())?e.sort((e,a)=>Number(e)-Number(a)):e.sort(),n=o(Array.from(l)),r=o(Array.from(s)),i=$[a.aggregation];function u(e){const t=e.map(e=>x(e,a.valueField));if(!i||"function"!=typeof i.calculate)return console.error("Invalid aggregation function:",a.aggregation,i),{value:null,count:e.length,tasks:e,rawValues:t,error:"Invalid aggregation function"};const l={nonNumeric:0,nullUndefined:0};return i.needsNumeric&&(l.nonNumeric=t.filter(e=>null===S(e)).length),l.nullUndefined=t.filter(e=>null==e).length,{value:i.usesTasks?i.calculate(t,e):i.calculate(t),count:e.length,tasks:e,rawValues:t,excludedCounts:l}}const c=n.map(e=>{const a=[],l=[];return r.forEach(s=>{const o=t.get(e)?.get(s)||[];a.push(o.length>0?u(o):null),l.push(...o)}),{label:e,cells:a,total:u(l)}}),d=r.map(e=>{const a=[];return n.forEach(l=>{const s=t.get(l)?.get(e)||[];a.push(...s)}),u(a)});return{rows:c,columns:r,totals:d,grandTotal:u(e)}}(e,F.value)}),V=e(()=>U.value.rows);e(()=>!1);const{getCellStyle:D,getSummaryStyle:q,styleKey:G}=O(U,w,C);function L(e){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Token Count",result_length:"Result Length",error_type:"Error Type"}[e]||e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}function B(e,a,t){if(!t)return`${e} × ${a}: No data`;let l=`${e} × ${a}: ${R(t,F.value.aggregation)} (${t.count} tasks)`;if(t.excludedCounts){const e=[];t.excludedCounts.nonNumeric>0&&e.push(`${t.excludedCounts.nonNumeric} non-numeric responses excluded`),t.excludedCounts.nullUndefined>0&&e.push(`${t.excludedCounts.nullUndefined} null/empty responses`),e.length>0&&(l+=` | ${e.join(", ")}`)}return t.error&&(l+=` - ERROR: ${t.error}`),l}function W(e,a){"rowField"!==e&&"columnField"!==e&&"aggregation"!==e||(F.value[e]=a),y("config-change",{...F.value})}function J(){_.value=!_.value,_.value?document.body.style.overflow="hidden":document.body.style.overflow=""}return p(()=>{_.value&&(document.body.style.overflow="")}),d([M,()=>k.tasks.length],([e])=>{k.tasks.length>0&&(!F.value.rowField||""===F.value.rowField)&&e.categorical.length>0&&(F.value.rowField=e.categorical.find(e=>"model"!==e&&"status"!==e&&"error_type"!==e)||e.categorical[0]||"model",F.value.columnField=F.value.columnField||"model",F.value.valueField=F.value.valueField||e.extracted.find(e=>"match_1"===e)||e.extracted[0]||"response_time",F.value.aggregation=F.value.aggregation||"mean",y("config-change",{...F.value}))},{immediate:!0}),(e,a)=>(l(),t("div",{class:u(["pivot-table-core",{fullscreen:_.value}])},[v(ee,{config:F.value,"available-fields":M.value,onUpdateConfig:W},null,8,["config","available-fields"]),v(re,{"selected-color-scale":w.value,"gradient-mode":C.value,"is-fullscreen":_.value,onUpdateColorScale:a[0]||(a[0]=e=>w.value=e),onUpdateGradientMode:a[1]||(a[1]=e=>C.value=e),onToggleFullscreen:J},null,8,["selected-color-scale","gradient-mode","is-fullscreen"]),N.value&&Object.keys(N.value).length>0?(l(),t("div",ie,[s("div",ue,[N.value.model&&N.value.model.length>1?(l(),t("div",ce,[a[5]||(a[5]=s("label",{class:"filter-label"},"Model:",-1)),m(s("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>I.value.model=e),class:"filter-select",onChange:P},[a[4]||(a[4]=s("option",{value:""}," All Models ",-1)),(l(!0),t(o,null,n(N.value.model,e=>(l(),t("option",{key:e,value:e},r(e),9,de))),128))],544),[[f,I.value.model]])])):g("",!0),(l(!0),t(o,null,n(A.value,(e,a)=>(l(),t("div",{key:a,class:"filter-group"},[s("label",pe,r(L(String(a)))+":",1),m(s("select",{"onUpdate:modelValue":e=>I.value[a]=e,class:"filter-select",onChange:P},[s("option",ge," All "+r(L(String(a))),1),(l(!0),t(o,null,n(e,e=>(l(),t("option",{key:e,value:e},r(e),9,me))),128))],40,ve),[[f,I.value[a]]])]))),128)),N.value.status&&N.value.status.length>1?(l(),t("div",fe,[a[7]||(a[7]=s("label",{class:"filter-label"},"Status:",-1)),m(s("select",{"onUpdate:modelValue":a[3]||(a[3]=e=>I.value.status=e),class:"filter-select",onChange:P},[a[6]||(a[6]=s("option",{value:""}," All Statuses ",-1)),(l(!0),t(o,null,n(N.value.status,e=>(l(),t("option",{key:e,value:e},r(e),9,be))),128))],544),[[f,I.value.status]])])):g("",!0),j.value?(l(),t("button",{key:2,class:"clear-filters-btn",title:"Clear all filters",onClick:E}," Clear Filters ")):g("",!0)])])):g("",!0),s("div",he,[0===k.tasks.length?(l(),t("div",ke,a[8]||(a[8]=[s("p",null,"No data available for pivot table analysis.",-1)]))):F.value.aggregation in b($)?(l(),t("div",_e,[s("table",we,[s("thead",null,[s("tr",null,[s("th",Ce,r(L(F.value.rowField)||"Items")+" / "+r(L(F.value.columnField)||"Aggregated"),1),(l(!0),t(o,null,n(U.value.columns,e=>(l(),t("th",{key:e,class:"column-header"},r(e),1))),128)),F.value.columnField?(l(),t("th",Fe," Total ")):g("",!0)])]),s("tbody",null,[(l(!0),t(o,null,n(V.value,e=>(l(),t("tr",{key:`${e.label}-${b(G)}`,class:"data-row"},[s("td",Se,r(e.label),1),(l(!0),t(o,null,n(e.cells,(a,o)=>(l(),t("td",{key:`${o}-${b(G)}`,class:u(["data-cell",{"error-cell":a?.error}]),"data-testid":a?.error?"pivot-cell-error":"pivot-cell",style:h(b(D)(a,e.label,o)),title:B(e.label,U.value.columns[o],a),"aria-label":a?.error?`Data integrity error: ${a.error}`:void 0,role:a?.error?"alert":void 0,onClick:t=>function(e,a,t){t&&y("cell-click",{row:e,column:a,cell:t})}(e.label,U.value.columns[o],a)},[a?.error?(l(),t("div",xe,[s("span",{class:"error-indicator",title:a.error},"⚠️",8,$e),s("span",Re,r(a?b(R)(a,F.value.aggregation):"-"),1),s("div",Ie,r(a.error),1)])):(l(),t("span",Te,r(a?b(R)(a,F.value.aggregation):"-"),1))],14,Me))),128)),F.value.columnField?(l(),t("td",{key:0,class:"total-cell",style:h(b(q)(e.total))},r(b(R)(e.total,F.value.aggregation)),5)):g("",!0)]))),128)),F.value.rowField&&e.showTotals?(l(),t("tr",{key:`totals-${b(G)}`,class:"total-row"},[a[10]||(a[10]=s("td",{class:"row-header"}," Total ",-1)),(l(!0),t(o,null,n(U.value.totals,(e,a)=>(l(),t("td",{key:`total-${a}-${b(G)}`,class:"total-cell",style:h(b(q)(e))},r(b(R)(e,F.value.aggregation)),5))),128)),F.value.columnField?(l(),t("td",{key:0,class:"grand-total-cell",style:h(b(q)(U.value.grandTotal))},r(b(R)(U.value.grandTotal,F.value.aggregation)),5)):g("",!0)])):g("",!0)])])])):(l(),t("div",ye,[s("p",null,"Invalid aggregation function: "+r(F.value.aggregation),1),a[9]||(a[9]=s("p",null,"Please select a valid aggregation method.",-1))]))])],2))}}),[["__scopeId","data-v-fb34a84b"]]),Ae={class:"modal-content large"},je={class:"modal-header"},Oe={class:"modal-body"},Pe={class:"detail-section"},Ee={class:"detail-grid"},Ue={class:"detail-item"},Ve={class:"value"},De={class:"detail-item"},qe={class:"value"},Ge={class:"detail-item"},Le={class:"value"},Be={class:"detail-item"},We={class:"value"},Je={key:0,class:"detail-section api-section"},ze={class:"api-info"},He={class:"api-summary"},Ke={class:"api-item"},Ye={class:"value cost"},Qe={class:"api-item"},Xe={class:"value"},Ze={class:"api-item"},ea={class:"value"},aa={class:"api-item"},ta={class:"value url"},la={class:"api-actions"},sa=["disabled"],oa={class:"detail-section"},na={class:"variables-list"},ra={class:"variable-key"},ia={class:"variable-value"},ua={class:"detail-section"},ca={class:"prompt-text"},da={key:1,class:"detail-section"},pa={class:"result-text"},va={key:2,class:"detail-section error-section"},ga={class:"error-text"},ma={key:3,class:"detail-section api-details-section"},fa={class:"api-details"},ba={class:"api-detail-item"},ha={class:"api-code"},ka={class:"api-detail-item"},ya={class:"api-code"},_a={class:"modal-footer"},wa=_(a({__name:"TaskDetailModal",props:{task:{}},emits:["close"],setup(a){const i=a,d=c(!1),p=e(()=>i.task.api_call_log?w.getRequestSummary(i.task.api_call_log):null),v=e(()=>i.task.api_call_log?w.formatRequest(i.task.api_call_log):""),m=e(()=>i.task.api_call_log?w.formatResponse(i.task.api_call_log):"");async function f(e){const a="prompt"===e?i.task.prompt:i.task.result;if(a)try{await navigator.clipboard.writeText(a),alert(`${e.charAt(0).toUpperCase()+e.slice(1)} copied to clipboard!`)}catch(t){console.error("Failed to copy:",t)}}function b(){if(!i.task.api_call_log)return;const e={model:i.task.model,prompt:i.task.prompt,variables:i.task.variables,original_task_id:i.task.id};alert("Retry exact call feature coming soon! This would recreate the exact API call with identical parameters."),console.log("Retry data:",e)}function h(){const e={task:{model:i.task.model,prompt:i.task.prompt,variables:i.task.variables,result:i.task.result,response_time:i.task.response_time,created_at:i.task.created_at,completed_at:i.task.completed_at},api_call:i.task.api_call_log?{cost_estimate:i.task.api_call_log.cost_estimate,timing_ms:i.task.api_call_log.response.timing_ms,model:i.task.api_call_log.metadata.model,provider:i.task.api_call_log.metadata.provider}:null,export_timestamp:(new Date).toISOString(),reproducible_hash:btoa(JSON.stringify({model:i.task.model,prompt:i.task.prompt,variables:i.task.variables}))},a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(a),l=document.createElement("a");l.href=t,l.download=`task-${i.task.id}-export.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(t)}return(e,a)=>{return l(),t("div",{class:"modal-overlay",onClick:a[5]||(a[5]=k(a=>e.$emit("close"),["self"]))},[s("div",Ae,[s("div",je,[a[6]||(a[6]=s("h3",null,"Task Details",-1)),s("button",{class:"close-btn",onClick:a[0]||(a[0]=a=>e.$emit("close"))}," × ")]),s("div",Oe,[s("div",Pe,[a[11]||(a[11]=s("h4",null,"Task Information",-1)),s("div",Ee,[s("div",Ue,[a[7]||(a[7]=s("span",{class:"label"},"Model:",-1)),s("span",Ve,r(e.task.model),1)]),s("div",De,[a[8]||(a[8]=s("span",{class:"label"},"Status:",-1)),s("span",qe,[s("span",{class:u(["status-badge",`status-${e.task.status}`])},r(e.task.status),3)])]),s("div",Ge,[a[9]||(a[9]=s("span",{class:"label"},"Response Time:",-1)),s("span",Le,r(e.task.response_time||"-")+"ms",1)]),s("div",Be,[a[10]||(a[10]=s("span",{class:"label"},"Created:",-1)),s("span",We,r((i=e.task.created_at,new Date(i).toLocaleString())),1)])])]),p.value?(l(),t("div",Je,[a[16]||(a[16]=s("h4",null,"🔍 API Call Details",-1)),s("div",ze,[s("div",He,[s("div",Ke,[a[12]||(a[12]=s("span",{class:"label"},"Cost:",-1)),s("span",Ye,r(p.value.cost),1)]),s("div",Qe,[a[13]||(a[13]=s("span",{class:"label"},"Tokens:",-1)),s("span",Xe,r(p.value.tokens),1)]),s("div",Ze,[a[14]||(a[14]=s("span",{class:"label"},"Timing:",-1)),s("span",ea,r(p.value.timing),1)]),s("div",aa,[a[15]||(a[15]=s("span",{class:"label"},"URL:",-1)),s("span",ta,r(p.value.url),1)])]),s("div",la,[s("button",{class:"btn btn-secondary btn-small",disabled:!e.task.api_call_log,onClick:b}," 🔄 Retry Exact Call ",8,sa),s("button",{class:"btn btn-secondary btn-small",onClick:h}," 📤 Export for Review ")])])])):g("",!0),s("div",oa,[a[17]||(a[17]=s("h4",null,"Variables",-1)),s("div",na,[(l(!0),t(o,null,n(e.task.variables,(e,a)=>(l(),t("div",{key:a,class:"variable-item"},[s("span",ra,r(a)+":",1),s("span",ia,r(e),1)]))),128))])]),s("div",ua,[a[18]||(a[18]=s("h4",null,"Prompt",-1)),s("pre",ca,r(e.task.prompt),1)]),e.task.result?(l(),t("div",da,[a[19]||(a[19]=s("h4",null,"Result",-1)),s("pre",pa,r(e.task.result),1)])):g("",!0),e.task.error?(l(),t("div",va,[a[20]||(a[20]=s("h4",null,"Error",-1)),s("pre",ga,r(e.task.error),1)])):g("",!0),d.value&&e.task.api_call_log?(l(),t("div",ma,[s("div",fa,[s("div",ba,[a[21]||(a[21]=s("h5",null,"API Request",-1)),s("pre",ha,r(v.value),1)]),s("div",ka,[a[22]||(a[22]=s("h5",null,"API Response",-1)),s("pre",ya,r(m.value),1)])])])):g("",!0)]),s("div",_a,[s("button",{class:"btn btn-secondary",onClick:a[1]||(a[1]=e=>f("prompt"))}," Copy Prompt "),e.task.result?(l(),t("button",{key:0,class:"btn btn-secondary",onClick:a[2]||(a[2]=e=>f("result"))}," Copy Result ")):g("",!0),e.task.api_call_log?(l(),t("button",{key:1,class:"btn btn-secondary",onClick:a[3]||(a[3]=e=>d.value=!d.value)},r(d.value?"Hide":"View")+" API Details ",1)):g("",!0),s("button",{class:"btn btn-primary",onClick:a[4]||(a[4]=a=>e.$emit("close"))}," Close ")])])]);var i}}}),[["__scopeId","data-v-4ca12dee"]]);export{Ne as P,wa as T,M as q};
