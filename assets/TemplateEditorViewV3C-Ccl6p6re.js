import{j as X,a as oe}from"./index-CAGf8Ut2.js";import{d as Y,f as x,c as D,w as G,R as u,Y as r,S as a,a0 as ve,n as J,q as pe,a2 as me,y as Oe,_ as I,k as b,V as _,F as A,W as O,a3 as te,Z as h,G as L,$ as q,a4 as re,B as ze,b as Ke,u as H,a1 as qe,o as He,X as Ge}from"./vue-vendor-DPw1dQYc.js";import{u as Je}from"./useV4Templates-BF7eJSSG.js";import{u as Xe}from"./useV4TemplateCommands-Cc3qzFSV.js";import{u as ae}from"./useV4VariableLists-Dp2ZjJxx.js";import{n as Q,am as Ye,r as Ze,an as fe,x as ge,O as be,J as _e,ab as Qe,ac as et,ad as tt,ae as at,G as lt,a4 as st,ai as it,a7 as nt,af as ot,N as ue}from"./ui-vendor-IRGmExUJ.js";import{P as rt}from"./ParserSelector-DHu_JGFm.js";import"./utils-vendor-B76-F3_P.js";import"./useV4LiveQuery-Do0jdBW3.js";import"./useV4CrossTab-Djn7l4Cc.js";import"./parser.store-ChYV5z7-.js";const ut={class:"template-editor"},dt=["placeholder","rows","data-testid","aria-label"],ct=Y({__name:"TemplateEditorV3C",props:{modelValue:{},label:{},placeholder:{default:"Enter your prompt template..."},required:{type:Boolean},rows:{default:4},variables:{default:()=>[]},variableColors:{default:()=>({})}},emits:["update:modelValue"],setup(z,{expose:N,emit:v}){const F=z,S=v,g=x(),$=x(),B=x(!1),E=D({get:()=>F.modelValue,set:f=>S("update:modelValue",f)}),T=D(()=>{let f=t(E.value);return f=f.replace(/\{\{(\w+)\}\}/g,(m,s)=>{const n=/^\w+$/.test(s),c=F.variableColors[s];return n&&c?`<span class="variable-highlight" style="background-color: ${c.bg}; box-shadow: 0 0 0 1px ${c.bg};">${t(m)}</span>`:n?`<span class="variable-highlight">${t(m)}</span>`:`<span class="variable-error">${t(m)}</span>`}),f=f.replace(/\n/g,"<br>"),f=f.replace(/  /g," &nbsp;"),f.endsWith("<br>")||(f+="<br>"),f});function t(f){const m=document.createElement("div");return m.textContent=f,m.innerHTML}function w(){!g.value||!$.value||($.value.scrollTop=g.value.scrollTop,$.value.scrollLeft=g.value.scrollLeft)}return G(E,async()=>{await Oe(),w()}),N({focus:()=>g.value?.focus()}),(f,m)=>{const s=pe("dompurify-html");return r(),u("div",ut,[a("div",{class:ve(["editor-container",{focused:B.value}])},[J(a("div",{ref_key:"highlightRef",ref:$,class:"editor-highlight","aria-hidden":"true"},null,512),[[s,T.value,"template"]]),J(a("textarea",{ref_key:"textareaRef",ref:g,"onUpdate:modelValue":m[0]||(m[0]=n=>E.value=n),class:"editor-textarea",placeholder:f.placeholder,rows:f.rows,"data-testid":f.$attrs["data-testid"]||"textarea-template-editor","aria-label":f.$attrs["aria-label"]||"Template editor textarea",onFocus:m[1]||(m[1]=n=>B.value=!0),onBlur:m[2]||(m[2]=n=>B.value=!1),onScroll:w},null,40,dt),[[me,E.value]])],2)])}}}),vt=X(ct,[["__scopeId","data-v-da627e6e"]]),pt={class:"variable-chip-input"},mt={key:0,class:"attributed-list-display"},ft={class:"list-header"},gt={class:"source-name"},bt={key:0,class:"attribute-breakdown"},_t={key:0,class:"separator"},yt={class:"total-conditions"},ht={class:"attributed-chips-container"},kt={class:"item-name"},wt={key:0,class:"attributes-wrapper"},$t={key:1,class:"direct-values"},Ct={key:0,class:"simple-list-display"},Vt={class:"list-header"},Lt={class:"source-name"},Tt={class:"tag-input-wrapper"},Rt={class:"custom-tag-input"},It={class:"tag-container tag-container-readonly"},St=["title"],xt={key:0,class:"readonly-hint"},Et={key:0,class:"helper-text"},Wt={key:1,class:"tag-input-wrapper"},Pt={class:"custom-tag-input"},Bt={class:"tag-container"},Ft={class:"floating-actions"},Ut=["title"],jt=["onClick","data-testid","aria-label"],Mt=["placeholder","aria-label","onKeydown"],At={key:0,class:"helper-text"},Nt=Y({__name:"VariableChipInputV3C",props:{values:{},listRef:{},listName:{},source:{},placeholder:{},attributedSamples:{},attributeBreakdown:{},attributeKeys:{},previewValues:{},totalCount:{}},emits:["update:values","clear-source","clear-list","select-list"],setup(z,{emit:N}){const v=z,F=N,S=x(""),g=x();function $(){return[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}]}function B(s){return v.attributeKeys?Object.entries(s).map(([n,c])=>{const i=v.attributeKeys.indexOf(n)%5;return{value:c,colorIndex:i}}):[]}function E(s){F("update:values",s),v.source&&F("clear-source")}function T(){const s=S.value.trim();s&&(v.values.includes(s)||E([...v.values,s]),S.value="")}function t(s){s.preventDefault();const c=(s.clipboardData?.getData("text")||"").split(/\r?\n/).map(i=>i.trim()).filter(i=>i.length>0);if(c.length>0){const i=new Set(v.values),p=c.filter(R=>!i.has(R));p.length>0&&E([...v.values,...p]),S.value=""}}function w(s){const n=[...v.values];n.splice(s,1),E(n)}function f(){if(S.value===""&&v.values.length>0){const s=[...v.values];s.pop(),E(s)}}function m(){E([]),v.source&&F("clear-source")}return(s,n)=>{const c=Q;return r(),u("div",pt,[s.listRef&&s.attributedSamples?(r(),u("div",mt,[a("div",ft,[n[6]||(n[6]=a("span",{class:"source-label"},"From list:",-1)),a("span",gt,_(s.listName||"Unknown List"),1),s.attributeBreakdown&&s.attributeBreakdown.parts.length>0?(r(),u("div",bt,[(r(!0),u(A,null,O(s.attributeBreakdown.parts,(i,p)=>(r(),u(A,{key:`part-${i.text}-${p}`},[a("span",{class:"attribute-part",style:te({backgroundColor:$()[i.colorIndex].bg,color:$()[i.colorIndex].text})},_(i.text),5),p<s.attributeBreakdown.parts.length-1?(r(),u("span",_t," × ")):I("",!0)],64))),128)),n[4]||(n[4]=a("span",{class:"arrow"}," → ",-1)),a("span",yt,_(s.attributeBreakdown.totalItems)+" conditions",1)])):I("",!0),b(c,{size:"small",danger:"",onClick:n[0]||(n[0]=i=>s.$emit("clear-list")),"data-testid":"btn-remove-list","aria-label":"Remove linked variable list"},{default:h(()=>n[5]||(n[5]=[L(" Remove List ")])),_:1,__:[5]})]),a("div",ht,[n[9]||(n[9]=a("span",{class:"sample-hint"},"Sample values:",-1)),(r(!0),u(A,null,O(s.attributedSamples,i=>(r(),u("div",{key:i.value,class:"attributed-item-chip"},[a("span",kt,_(i.value),1),i.attributes?(r(),u("span",wt,[n[7]||(n[7]=L(" (")),(r(!0),u(A,null,O(B(i.attributes),(p,R)=>(r(),u("span",{key:`attr-${p.value}-${R}`,class:"attribute-value",style:te({backgroundColor:$()[p.colorIndex].bg,color:$()[p.colorIndex].text})},_(p.value),5))),128)),n[8]||(n[8]=L(") "))])):I("",!0)]))),128))])])):(r(),u("div",$t,[s.source?(r(),u("div",Ct,[a("div",Vt,[n[12]||(n[12]=a("span",{class:"source-label"},"From list:",-1)),a("span",Lt,_(s.source.listName),1),n[13]||(n[13]=a("span",{class:"edit-hint"},"(Unlink list to edit)",-1)),b(c,{size:"small",type:"primary",onClick:n[1]||(n[1]=i=>s.$emit("clear-source")),"data-testid":"btn-unlink-list","aria-label":"Unlink list and edit values directly"},{default:h(()=>n[10]||(n[10]=[L(" Unlink List and Edit Directly ")])),_:1,__:[10]}),b(c,{size:"small",danger:"",onClick:m,"data-testid":"btn-clear-values","aria-label":"Remove all values from list"},{default:h(()=>n[11]||(n[11]=[L(" Remove List ")])),_:1,__:[11]})]),a("div",Tt,[a("div",Rt,[a("div",It,[(r(!0),u(A,null,O(s.values,(i,p)=>(r(),u("div",{key:`${i}-${p}`,class:"tag tag-readonly"},[a("span",{class:"tag-text",title:i.length>100?i:""},_(i.length>100?i.substring(0,100)+"...":i),9,St)]))),128)),s.values.length===0?(r(),u("span",xt," Values from linked list will appear here ")):I("",!0)]),s.values.length>0?(r(),u("div",Et,_(s.values.length)+" values ",1)):I("",!0)])])])):I("",!0),s.source?I("",!0):(r(),u("div",Wt,[a("div",Pt,[a("div",Bt,[a("div",Ft,[s.values.length>0?(r(),q(c,{key:0,size:"small",danger:"",onClick:m,"data-testid":"btn-clear-all","aria-label":"Clear all values"},{default:h(()=>n[14]||(n[14]=[L(" Clear ")])),_:1,__:[14]})):I("",!0),b(c,{size:"small",onClick:n[2]||(n[2]=i=>s.$emit("select-list")),"data-testid":"btn-select-list","aria-label":"Replace values with a variable list"},{default:h(()=>n[15]||(n[15]=[L(" Replace with List ")])),_:1,__:[15]})]),(r(!0),u(A,null,O(s.values,(i,p)=>(r(),u("div",{key:`${i}-${p}`,class:"tag"},[a("span",{class:"tag-text",title:i.length>100?i:""},_(i.length>100?i.substring(0,100)+"...":i),9,Ut),a("button",{type:"button",class:"tag-remove",onClick:R=>w(p),"data-testid":`btn-remove-tag-${p}`,"aria-label":`Remove value ${i}`}," × ",8,jt)]))),128)),J(a("input",{ref_key:"inputField",ref:g,"onUpdate:modelValue":n[3]||(n[3]=i=>S.value=i),placeholder:s.placeholder,class:"tag-input-field","data-testid":"input-variable-value","aria-label":s.placeholder||"Enter variable value",onKeydown:[re(ze(T,["prevent"]),["enter"]),re(f,["backspace"])],onPaste:t},null,40,Mt),[[me,S.value]])]),s.values.length>0?(r(),u("div",At,_(s.values.length)+" values ",1)):I("",!0)])]))]))])}}}),de=X(Nt,[["__scopeId","data-v-33f1ece4"]]),Dt={class:"variable-preview-cycler"},Ot={class:"preview-controls"},zt={key:0,class:"cycle-info","data-testid":"cycle-info",role:"status","aria-live":"polite"},Kt=["aria-label"],qt={key:0,class:"preview-content"},Ht={key:0,class:"no-variables"},Gt={key:1,class:"single-preview","data-testid":"single-preview"},Jt={class:"preview-template","data-testid":"preview-template",role:"region","aria-label":"Preview of filled-in prompt"},Xt={key:2,class:"cycling-preview","data-testid":"cycling-preview"},Yt={class:"preview-template","data-testid":"preview-template-cycling",role:"region","aria-label":"Preview of filled-in prompt with cycling variables"},Zt={class:"variable-legend"},Qt=["data-testid"],ea={class:"variable-value"},ta=Y({__name:"VariablePreviewCyclerV3C",props:{template:{},variableBindings:{},variables:{},variableListRefs:{}},emits:["toggle-preview"],setup(z,{emit:N}){const v=z,F=N,{variableLists:S}=ae(),g=x(!1),$=x(0);let B=null;const E=["variable-highlight-blue","variable-highlight-green","variable-highlight-purple","variable-highlight-orange","variable-highlight-pink","variable-highlight-teal"],T=D(()=>{let i=[];if(v.variableBindings?i=Object.keys(v.variableBindings):v.variables&&(i=Object.keys(v.variables)),v.variableListRefs){const p=Object.keys(v.variableListRefs);i=[...new Set([...i,...p])]}return i}),t=D(()=>{if(T.value.length===0)return[];const i=[],p=S.value;for(const C of T.value){let k=[];if(v.variableBindings){const P=v.variableBindings[C];if(P.type==="value"&&P.values)k=[...P.values];else if(P.type==="list"&&P.listId){const V=p.find(j=>j.id===P.listId);V&&(V.category==="simple"&&V.values?k=[...V.values]:V.category==="attributed"&&V.items&&(k=V.items.map(j=>j.value)))}}else if(v.variables&&v.variables[C]&&v.variables[C].length>0)k=[...v.variables[C]];else if(v.variableListRefs&&v.variableListRefs[C]){const P=v.variableListRefs[C],V=p.find(j=>j.id===P);V&&(V.category==="simple"&&V.values?k=[...V.values]:V.category==="attributed"&&V.items&&(k=V.items.map(j=>j.value)))}k.length>0&&i.push({name:C,values:k})}if(i.length===0)return[];function R(C){return C.reduce((k,P)=>k.flatMap(V=>P.map(j=>[...V,j])),[[]])}const U=i.map(C=>C.values);return R(U).map(C=>{const k={};return i.forEach((P,V)=>{k[P.name]=C[V]}),k})});function w(){g.value=!g.value,F("toggle-preview",g.value),g.value&&t.value.length>1?f():m()}function f(){m(),B=setInterval(()=>{$.value=($.value+1)%t.value.length},1e3)}function m(){B&&(clearInterval(B),B=null)}function s(i){return E[i%E.length]}function n(i){let p=c(v.template);return T.value.forEach((R,U)=>{if(i[R]!==void 0){const W=c(R),C=new RegExp(`\\{\\{\\s*${W}\\s*\\}\\}`,"g"),P=`<span class="${s(U)}">${c(String(i[R]))}</span>`;p=p.replace(C,P)}}),p}function c(i){const p=document.createElement("div");return p.textContent=i,p.innerHTML}return G(()=>v.template,()=>{$.value=0}),G(t,i=>{i.length===0?m():g.value&&i.length>1&&f(),$.value>=i.length&&($.value=0)}),Ke(()=>{m()}),(i,p)=>{const R=Q,U=pe("dompurify-html");return r(),u("div",Dt,[a("div",Ot,[b(R,{type:g.value?"default":"primary",ghost:!g.value,onClick:w,class:"toggle-button","data-testid":"btn-toggle-preview-mode","aria-label":g.value?"Return to editor mode":"Preview filled-in prompts","aria-pressed":g.value},{default:h(()=>[g.value?(r(),q(H(Ze),{key:1})):(r(),q(H(Ye),{key:0})),L(" "+_(g.value?"Return to Editor Mode":"Preview Filled-In Prompts"),1)]),_:1},8,["type","ghost","aria-label","aria-pressed"]),g.value&&t.value.length>1?(r(),u("div",zt,[a("span",{class:"cycle-counter","data-testid":"cycle-counter","aria-label":`Showing combination ${$.value+1} of ${t.value.length}`},_($.value+1)+" / "+_(t.value.length),9,Kt),p[0]||(p[0]=a("span",{class:"cycle-hint"},"Auto-cycling every second",-1))])):I("",!0)]),g.value?(r(),u("div",qt,[t.value.length===0?(r(),u("div",Ht,[b(H(fe)),p[1]||(p[1]=a("span",null,"No variables detected in template",-1))])):t.value.length===1?(r(),u("div",Gt,[J(a("div",Jt,null,512),[[U,n(t.value[0]),"template"]])])):(r(),u("div",Xt,[J(a("div",Yt,null,512),[[U,n(t.value[$.value]),"template"]]),a("div",Zt,[(r(!0),u(A,null,O(T.value,(W,C)=>(r(),u("div",{key:W,class:"legend-item","data-testid":`legend-item-${W}`},[a("span",{class:ve(s(C))},_(W),3),a("span",ea,_(t.value[$.value][W]),1)],8,Qt))),128))])]))])):I("",!0)])}}}),aa=X(ta,[["__scopeId","data-v-3ff835e5"]]),la={class:"list-selector"},sa={key:0,class:"loading-container"},ia={key:0,class:"list-grid"},na=["onClick"],oa={class:"list-header"},ra={class:"item-count"},ua={key:0,class:"list-description"},da={class:"list-preview"},ca={key:0,class:"preview-more"},va={key:1,class:"attributed-badge"},pa={key:1,class:"empty-state"},ma=Y({__name:"ListSelectorV3C",props:{modelValue:{type:Boolean},listType:{}},emits:["update:modelValue","select"],setup(z,{emit:N}){const v=z,F=N,{variableLists:S,loading:g,error:$}=ae(),B=D(()=>{if(!S.value)return[];let t=[];return v.listType==="all"?t=S.value.filter(w=>w.category!=="tabular"):v.listType==="simple"?t=S.value.filter(w=>w.category==="simple"):v.listType==="refusal"&&(t=S.value.filter(w=>w.category==="refusal")),t}),E=t=>t.category==="attributed"&&t.items?t.items.slice(0,5).map(w=>w.value):t.values?.slice(0,5)??[],T=t=>{F("select",t),F("update:modelValue",!1)};return(t,w)=>{const f=be,m=_e,s=Q,n=ge;return r(),q(n,{open:t.modelValue,title:"Select List",width:"80vw",style:{maxWidth:"800px"},"onUpdate:open":w[1]||(w[1]=c=>t.$emit("update:modelValue",c)),onCancel:w[2]||(w[2]=c=>t.$emit("update:modelValue",!1))},{footer:h(()=>[b(s,{onClick:w[0]||(w[0]=c=>t.$emit("update:modelValue",!1))},{default:h(()=>w[3]||(w[3]=[L(" Cancel ")])),_:1,__:[3]})]),default:h(()=>[a("div",la,[H(g)?(r(),u("div",sa,[b(f,{size:"large",tip:"Loading lists..."})])):H($)?(r(),q(m,{key:1,type:"error",message:H($).message||"Failed to load lists",class:"error-alert"},null,8,["message"])):(r(),u(A,{key:2},[B.value.length>0?(r(),u("div",ia,[(r(!0),u(A,null,O(B.value,c=>(r(),u("div",{key:c.id,class:"list-option",onClick:i=>T(c)},[a("div",oa,[a("h4",null,_(c.name),1),a("span",ra,_(c.itemCount)+" items",1)]),c.description?(r(),u("p",ua,_(c.description),1)):I("",!0),a("div",da,[(r(!0),u(A,null,O(E(c),(i,p)=>(r(),u("span",{key:`${c.id}-preview-${p}-${i}`,class:"preview-value"},_(i),1))),128)),c.itemCount>5?(r(),u("span",ca," +"+_(c.itemCount-5)+" more ",1)):I("",!0)]),c.category==="attributed"?(r(),u("div",va," Attributed List ")):I("",!0)],8,na))),128))])):(r(),u("div",pa," No "+_(t.listType)+" lists available ",1))],64))])]),_:1},8,["open"])}}}),ce=X(ma,[["__scopeId","data-v-e370cd75"]]),fa={class:"template-editor-page"},ga={class:"header-content"},ba={class:"page-title"},_a={class:"design-form-container"},ya={key:0,class:"loading-container"},ha={class:"name-desc-row"},ka={key:0,class:"variable-hint"},wa={key:0,class:"variables-container"},$a={class:"variable-label"},Ca={class:"variable-content"},Va={class:"parser-row"},La={style:{flex:"1"}},Ta={class:"refusal-row"},Ra={class:"refusal-content"},Ia={class:"footer-content"},Sa={class:"stats"},xa={class:"actions"},Ea={class:"pricing-content"},Wa={key:0,class:"token-stats"},Pa={class:"stats-grid"},Ba={class:"pricing-placeholder"},Fa=Y({__name:"TemplateEditorViewV3C",setup(z){const N=qe(),v=Ge(),{templates:F,loading:S}=Je(),{variableLists:g}=ae(),{createTemplate:$,updateTemplate:B,isExecuting:E}=Xe(),T=D(()=>N.params.id),t=x({name:"",description:"",template:"",parserId:null,refusalWords:[],refusalWordsListRef:"",refusalWordsSource:null,rejectRefusalWords:!1}),w=D(()=>S.value||E.value),f=x([]),m=x({}),s=x({}),n=x({}),c=x(!1),i=x(!1),p=x("all"),R=x(""),U=x(!1),W=x(null),C=[{bg:"#E8D5F2",text:"#6B21A8"},{bg:"#D5F2E8",text:"#047857"},{bg:"#FFE4D6",text:"#C2410C"},{bg:"#D6E4FF",text:"#1E40AF"},{bg:"#F3E8D5",text:"#92400E"}],k=D(()=>{if(!t.value.template)return[];const l=/\{\{([^}]+)\}\}/g,e=new Set;let o;for(;(o=l.exec(t.value.template))!==null;){const y=o[1].trim();/^\w+$/.test(y)&&e.add(y)}return Array.from(e)}),P=D(()=>{const l={};return k.value.forEach((e,o)=>{l[e]=C[o%C.length]}),l}),V=D(()=>{let l=1;for(const e of k.value){const o=m.value[e]||[],y=s.value[e];if(y){const M=g.value.find(K=>K.id===y);M&&(l*=M.itemCount||1)}else o.length>0&&(l*=o.length)}return{total:l,formatted:l.toLocaleString()}});function j(l){const e=k.value.indexOf(l);return C[e%C.length]}function ye(l){return`{{${l}}}`}function he(l){}function ke(l){const e=s.value[l];return e?g.value.find(y=>y.id===e)?.name:void 0}function we(l){const e=s.value[l];return e?g.value.find(y=>y.id===e)?.itemCount:void 0}function $e(l){const e=s.value[l];if(!e)return;const o=g.value.find(y=>y.id===e);if(!(!o||o.category!=="attributed"||!o.items))return o.items.slice(0,10)}function Ce(l){const e=s.value[l];if(!e)return;const o=g.value.find(M=>M.id===e);if(!o||o.category!=="attributed")return;const y=[];return o.attributeKeys&&y.push(...o.attributeKeys.map((M,K)=>({text:M,colorIndex:K%5}))),{parts:y,totalItems:o.itemCount||0}}function Ve(l){const e=s.value[l];if(!e)return;const o=g.value.find(y=>y.id===e);return o?.attributeKeys?[...o.attributeKeys]:void 0}function Le(l){const e=s.value[l];if(!e)return;const o=g.value.find(y=>y.id===e);if(!(!o||o.category!=="simple"))return o.values?.slice(0,10)}function Te(l,e){m.value[l]=e}function Re(l){n.value[l]=null}function Ie(l){s.value[l]="",m.value[l]=[]}function Se(l){R.value=l,p.value="all",c.value=!0}function xe(l){R.value&&(l.category==="simple"?(m.value[R.value]=[...l.values||[]],s.value[R.value]="",n.value[R.value]={listId:l.id,listName:l.name}):(s.value[R.value]=l.id,m.value[R.value]=[],n.value[R.value]=null)),c.value=!1}function Ee(){return t.value.refusalWordsListRef?g.value.find(e=>e.id===t.value.refusalWordsListRef)?.name:void 0}function We(){t.value.refusalWordsListRef="",t.value.refusalWords=[]}function Pe(l){(l.category==="simple"||l.category==="refusal")&&l.values&&(t.value.refusalWords=[...l.values],t.value.refusalWordsListRef="",t.value.refusalWordsSource=null),i.value=!1}function Be(l,e){}function le(){v.push({name:"templates"})}async function se(){try{if(f.value=[],!t.value.name.trim()){f.value.push("Template name is required");return}if(!t.value.template.trim()){f.value.push("Template content is required");return}const l={};for(const o of k.value)s.value[o]?l[o]={type:"list",listId:s.value[o]}:m.value[o]?.length>0&&(l[o]={type:"value",values:[...m.value[o]]});const e={name:t.value.name,description:t.value.description,template:t.value.template,variables:l,category:"Custom",tags:[],parserId:t.value.parserId||void 0,refusalWords:t.value.refusalWords.length>0?[...t.value.refusalWords]:void 0,rejectRefusalWords:t.value.rejectRefusalWords};if(T.value){const o=await B(T.value,e);if(o.ok)ue.success("Template updated successfully");else{f.value=[o.error.message];return}}else{const o=await $(e);if(o.ok)ue.success("Template created successfully");else{f.value=[o.error.message];return}}v.push({name:"templates"})}catch(l){oe.error("Failed to save template:",l),f.value=[l instanceof Error?l.message:"Failed to save template"]}}function ie(){if(!T.value)return;const l=F.value.find(e=>e.id===T.value);if(!l){S.value||(f.value=["Template not found"]);return}t.value.name=l.name,t.value.description=l.description||"",t.value.template=l.template,t.value.parserId=l.parserId||null,t.value.refusalWords=l.refusalWords?[...l.refusalWords]:[],t.value.rejectRefusalWords=l.rejectRefusalWords||!1,m.value={},s.value={},n.value={};for(const[e,o]of Object.entries(l.variables))if(o.type==="list"&&o.listId){const y=g.value.find(M=>M.id===o.listId);y&&(y.category==="simple"||y.category==="refusal"?(m.value[e]=[...y.values||[]],s.value[e]="",n.value[e]={listId:y.id,listName:y.name}):(s.value[e]=o.listId,m.value[e]=[],n.value[e]=null))}else o.type==="value"&&o.values&&(m.value[e]=[...o.values])}G(U,async l=>{l&&!W.value&&(W.value={promptTokens:Math.ceil(t.value.template.length/4),totalEstimate:Math.ceil(t.value.template.length/3),variableTokens:{}})}),He(()=>{T.value,T.value,T.value&&ie()});let ne=T.value;return G([()=>N.params.id,F,g],(l,e)=>{const o=T.value;if(o){const y=o!==ne,M=e&&l[1]!==e[1],K=e&&l[2]!==e[2];(y||M||K)&&ie()}ne=o},{immediate:!0}),(l,e)=>{const o=Q,y=et,M=be,K=st,ee=lt,Fe=it,Ue=_e,je=nt,Me=at,Ae=ot,Ne=Qe,De=ge;return r(),u("div",fa,[b(Ne,null,{default:h(()=>[b(y,{class:"editor-header"},{default:h(()=>[a("div",ga,[b(o,{type:"text",onClick:le,class:"back-button","data-testid":"btn-back-to-templates"},{icon:h(()=>[b(H(tt))]),default:h(()=>[e[14]||(e[14]=L(" Back to Templates "))]),_:1,__:[14]}),a("h1",ba,_(T.value?"Edit Template":"Create Template"),1)])]),_:1}),b(Me,{class:"editor-content"},{default:h(()=>[a("div",_a,[w.value?(r(),u("div",ya,[b(M,{size:"large",tip:"Loading template..."})])):(r(),q(je,{key:1,model:t.value,layout:"vertical",onFinish:se},{default:h(()=>[a("div",ha,[e[15]||(e[15]=a("label",{class:"inline-field-label"},"Name",-1)),b(ee,{name:"name",rules:[{required:!0,message:"Required"}],class:"name-field"},{default:h(()=>[b(K,{value:t.value.name,"onUpdate:value":e[0]||(e[0]=d=>t.value.name=d),placeholder:"Enter template name",size:"large","data-testid":"input-template-name","aria-label":"Template name"},null,8,["value"])]),_:1}),e[16]||(e[16]=a("label",{class:"inline-field-label"},"Description",-1)),b(ee,{name:"description",class:"desc-field"},{default:h(()=>[b(K,{value:t.value.description,"onUpdate:value":e[1]||(e[1]=d=>t.value.description=d),placeholder:"Optional description",size:"large","data-testid":"input-template-description","aria-label":"Template description"},null,8,["value"])]),_:1})]),b(ee,{label:"Template",name:"template",rules:[{required:!0,message:"Required"}],class:"template-form-item"},{default:h(()=>[k.value.length===0?(r(),u("div",ka,[b(H(fe)),e[17]||(e[17]=a("span",null,[L("Type a prompt and use double curly braces to add a variable with conditions to vary, like "),a("code",null,"{{name}}"),L(" or "),a("code",null,"{{system_prompt}}"),L(". Variable names cannot contain spaces or punctuation except underscores (_).")],-1))])):I("",!0),b(vt,{modelValue:t.value.template,"onUpdate:modelValue":e[2]||(e[2]=d=>t.value.template=d),placeholder:"Enter your prompt template... Use {{variable}} for variables",rows:7,variables:k.value,"variable-colors":P.value,"data-testid":"template-editor","aria-label":"Prompt template editor"},null,8,["modelValue","variables","variable-colors"]),k.value.length>0&&t.value.template?(r(),q(aa,{key:1,template:t.value.template,variables:m.value,"variable-list-refs":s.value,onTogglePreview:he},null,8,["template","variables","variable-list-refs"])):I("",!0)]),_:1}),k.value.length>0?(r(),u("div",wa,[(r(!0),u(A,null,O(k.value,d=>(r(),u("div",{key:d,class:"variable-row"},[a("div",$a,[e[18]||(e[18]=a("span",{class:"variable-text"},"Variable:",-1)),a("span",{style:te({backgroundColor:j(d).bg,color:j(d).text}),class:"variable-badge"},_(ye(d)),5)]),a("div",Ca,[b(de,{values:m.value[d]||[],"list-ref":s.value[d],"list-name":ke(d),source:n.value[d]||null,placeholder:`Enter a value for {{${d}}} and hit enter`,"attributed-samples":$e(d),"attribute-breakdown":Ce(d),"attribute-keys":Ve(d),"preview-values":Le(d),"total-count":we(d),"onUpdate:values":Z=>Te(d,Z),onClearSource:Z=>Re(d),onClearList:Z=>Ie(d),onSelectList:Z=>Se(d)},null,8,["values","list-ref","list-name","source","placeholder","attributed-samples","attribute-breakdown","attribute-keys","preview-values","total-count","onUpdate:values","onClearSource","onClearList","onSelectList"])])]))),128))])):I("",!0),a("div",Va,[e[19]||(e[19]=a("label",{class:"row-label"},"Response Parser",-1)),a("div",La,[b(rt,{modelValue:t.value.parserId,"onUpdate:modelValue":e[3]||(e[3]=d=>t.value.parserId=d),placeholder:"Select Parser (Optional - leave blank for full response)","allow-clear":!0,context:"template-editor",onChange:Be},null,8,["modelValue"])])]),a("div",Ta,[e[21]||(e[21]=a("label",{class:"row-label"},"Parse Refusals",-1)),a("div",Ra,[b(de,{values:t.value.refusalWords,"list-ref":t.value.refusalWordsListRef,"list-name":Ee(),source:t.value.refusalWordsSource||null,placeholder:"Enter a refusal word and hit enter (e.g., cannot, unable, refuse)","onUpdate:values":e[4]||(e[4]=d=>t.value.refusalWords=d),onClearSource:e[5]||(e[5]=d=>t.value.refusalWordsSource=null),onClearList:e[6]||(e[6]=d=>We()),onSelectList:e[7]||(e[7]=d=>i.value=!0)},null,8,["values","list-ref","list-name","source"])]),b(Fe,{checked:t.value.rejectRefusalWords,"onUpdate:checked":e[8]||(e[8]=d=>t.value.rejectRefusalWords=d),class:"reject-checkbox","data-testid":"checkbox-reject-refusals","aria-label":"Reject responses containing refusal words"},{default:h(()=>e[20]||(e[20]=[L(" Reject on match ")])),_:1,__:[20]},8,["checked"])]),f.value.length>0?(r(),q(Ue,{key:1,type:"error","show-icon":"",class:"error-alert"},{message:h(()=>[L(_(f.value.join(", ")),1)]),_:1})):I("",!0)]),_:1},8,["model"]))])]),_:1}),b(Ae,{class:"editor-footer"},{default:h(()=>[a("div",Ia,[a("div",Sa,_(k.value.length)+" variables • "+_(V.value.formatted)+" combinations ",1),a("div",xa,[b(o,{size:"large",onClick:e[9]||(e[9]=d=>U.value=!0),"data-testid":"btn-calculate-pricing","aria-label":"Calculate pricing for this template"},{default:h(()=>e[22]||(e[22]=[L(" Calculate Pricing ")])),_:1,__:[22]}),b(o,{size:"large",onClick:le,"data-testid":"btn-cancel-template","aria-label":"Cancel and go back to templates"},{default:h(()=>e[23]||(e[23]=[L(" Cancel ")])),_:1,__:[23]}),b(o,{size:"large",type:"primary",onClick:se,"data-testid":"btn-save-template","aria-label":"Save template and go back to templates"},{default:h(()=>e[24]||(e[24]=[L(" Save ")])),_:1,__:[24]})])])]),_:1})]),_:1}),b(ce,{modelValue:c.value,"onUpdate:modelValue":e[10]||(e[10]=d=>c.value=d),"list-type":p.value,onSelect:xe},null,8,["modelValue","list-type"]),b(ce,{modelValue:i.value,"onUpdate:modelValue":e[11]||(e[11]=d=>i.value=d),"list-type":"refusal",onSelect:Pe},null,8,["modelValue"]),b(De,{open:U.value,"onUpdate:open":e[13]||(e[13]=d=>U.value=d),title:"Cost Estimation",width:"90vw",style:{maxWidth:"1000px"}},{footer:h(()=>[b(o,{onClick:e[12]||(e[12]=d=>U.value=!1)},{default:h(()=>e[30]||(e[30]=[L("Close")])),_:1,__:[30]})]),default:h(()=>[a("div",Ea,[W.value?(r(),u("div",Wa,[e[25]||(e[25]=a("h4",null,"Token Analysis",-1)),a("div",Pa,[a("div",null,"Min: "+_(W.value.promptTokens),1),a("div",null,"Max: "+_(W.value.totalEstimate),1),a("div",null,"Avg: "+_(Math.round((W.value.promptTokens+W.value.totalEstimate)/2)),1),a("div",null,"Variables: "+_(Object.keys(W.value.variableTokens).length),1)])])):I("",!0),a("div",Ba,[e[29]||(e[29]=a("p",null,"Pricing calculation will be implemented with V3 backend integration.",-1)),a("p",null,[e[26]||(e[26]=L("Template: ")),a("strong",null,_(t.value.name||"Untitled"),1)]),a("p",null,[e[27]||(e[27]=L("Variables: ")),a("strong",null,_(k.value.length),1)]),a("p",null,[e[28]||(e[28]=L("Combinations: ")),a("strong",null,_(V.value.formatted),1)])])])]),_:1},8,["open"])])}}}),Ga=X(Fa,[["__scopeId","data-v-7f11ee86"]]);export{Ga as default};
