import{d as e,r as a,i as t,o as s,b as l,e as n,k as o,f as i,F as r,m as c,V as d,X as u,D as v,t as p,w as m,p as g,a1 as h,g as f,n as b,O as y,j as k,v as w,a2 as _,q as C}from"./vendor-DdqHZeTC.js";import{u as A,f as S,d as O,_ as L,g as x,h as E}from"./index-C9s_qmww.js";import{s as U}from"./safeJson-BfKuju6h.js";import"./db-ftwlfnxb.js";const R={class:"models-table-container"},I={key:0,class:"loading"},D={key:1,class:"empty-state"},T={class:"controls-section"},M={class:"search-controls"},$={class:"form-group"},j={class:"form-group"},P={class:"form-group"},F=["value"],N={class:"models-list"},B=["onClick"],G={class:"provider-info"},q={class:"collapse-toggle"},J={class:"model-count"},V=["value","onInput","onBlur"],H={class:"models-table-wrapper"},K={class:"models-table"},Q=["checked","onChange"],W=L(e({__name:"ModelsTable",setup(e){const f=A();S();const b=a(""),y=a("name"),k=a(""),w=a({}),_=a(new Set),C=t(()=>f.isLoading),L=t(()=>{let e=Object.values(f.modelsByProvider).flat();if(b.value.trim()){const a=b.value.toLowerCase();e=e.filter(e=>e.id.toLowerCase().includes(a)||e.name.toLowerCase().includes(a))}k.value&&(e=e.filter(e=>e.provider===k.value)),e.sort((e,a)=>{switch(y.value){case"cost":return(e.input_cost||0)+(e.output_cost||0)-((a.input_cost||0)+(a.output_cost||0));case"context":return(a.max_input_tokens||0)-(e.max_input_tokens||0);default:return e.name.localeCompare(a.name)}});const a={};return e.forEach(e=>{a[e.provider]||(a[e.provider]=[]),a[e.provider].push(e)}),a}),x=t(()=>Object.keys(f.modelsByProvider));function E(e){return e.charAt(0).toUpperCase()+e.slice(1)}function U(e){return w.value[e]||6e4}async function W(e,a){const t=a.target,s=parseInt(t.value);if(isNaN(s)||s<5e3||s>3e5)t.value=U(e).toString();else try{await O.providers.update(e,{timeout_ms:s}),w.value[e]=s,console.log(`Updated ${e} timeout to ${s}ms`)}catch(l){console.error("Failed to update provider timeout:",l),t.value=U(e).toString()}}function z(e,a){const t="input"===a?e.input_cost:e.output_cost;if(!t)return"0";const s="openrouter"===e.provider?1e6*t:t;return s<.01?s.toFixed(4):s<1?s.toFixed(3):s<10?s.toFixed(2):s.toFixed(1)}function Y(e){const a=[];return e.supports_function_calling&&a.push("📞"),e.supports_json_mode&&a.push("📄"),e.supports_streaming&&a.push("🌊"),e.supported_modalities?.includes("image")&&a.push("👁️"),a.join(" ")||"-"}async function X(){const e=Object.values(L.value).flat();for(const a of e)a.enabled||await f.toggleModel(a.id,!0)}async function Z(){const e=Object.values(L.value).flat();for(const a of e)a.enabled&&await f.toggleModel(a.id,!1)}function ee(e){return _.value.has(e)}return s(async()=>{await f.loadModels(),await async function(){try{const e=await O.providers.toArray(),a={};e.forEach(e=>{a[e.id]=e.timeout_ms||6e4}),w.value=a}catch(e){console.warn("Failed to load provider timeouts:",e)}}(),(()=>{const e=Object.keys(f.modelsByProvider);_.value=new Set(e)})()}),(e,a)=>(n(),l("div",R,[C.value?(n(),l("div",I," Loading models... ")):0===Object.keys(o(f).modelsByProvider).length?(n(),l("div",D,a[4]||(a[4]=[i("p",null,"No models loaded yet. Import a model registry file or fetch OpenRouter models to get started.",-1)]))):(n(),l(r,{key:2},[i("div",T,[i("div",M,[i("div",$,[c(i("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>b.value=e),type:"text",placeholder:"Search models...",class:"search-input"},null,512),[[d,b.value]])]),i("div",j,[c(i("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>y.value=e),class:"sort-select"},a[5]||(a[5]=[i("option",{value:"name"}," Sort by Name ",-1),i("option",{value:"cost"}," Sort by Cost ",-1),i("option",{value:"context"}," Sort by Context Length ",-1)]),512),[[u,y.value]])]),i("div",P,[c(i("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>k.value=e),class:"filter-select"},[a[6]||(a[6]=i("option",{value:""}," All Providers ",-1)),(n(!0),l(r,null,v(x.value,e=>(n(),l("option",{key:e,value:e},p(E(e)),9,F))),128))],512),[[u,k.value]])])]),i("div",{class:"bulk-actions"},[i("button",{class:"btn btn-sm btn-secondary",onClick:X}," Enable All Filtered "),i("button",{class:"btn btn-sm btn-secondary",onClick:Z}," Disable All Filtered ")])]),i("div",N,[(n(!0),l(r,null,v(L.value,(e,t)=>(n(),l("div",{key:t,class:"provider-section"},[i("div",{class:"provider-header",onClick:e=>function(e){_.value.has(e)?_.value.delete(e):_.value.add(e),_.value=new Set(_.value)}(t)},[i("div",G,[i("button",q,p(ee(t)?"▶":"▼"),1),i("h3",null,p(E(t)),1),i("span",J,"("+p(e.length)+" models)",1)]),i("div",{class:"provider-config",onClick:a[3]||(a[3]=m(()=>{},["stop"]))},[i("label",null,[a[7]||(a[7]=g(" API Timeout: ")),i("input",{type:"number",value:U(t),min:"5000",max:"300000",step:"1000",class:"timeout-input",onInput:e=>W(t,e),onBlur:e=>W(t,e)},null,40,V),a[8]||(a[8]=i("span",{class:"timeout-unit"},"ms",-1))])])],8,B),c(i("div",H,[i("table",K,[a[9]||(a[9]=i("thead",null,[i("tr",null,[i("th",null,"Enabled"),i("th",null,"Model"),i("th",null,"Context"),i("th",null,"Input Cost"),i("th",null,"Output Cost"),i("th",null,"Features")])],-1)),i("tbody",null,[(n(!0),l(r,null,v(e,e=>{return n(),l("tr",{key:e.id},[i("td",null,[i("input",{type:"checkbox",checked:e.enabled,onChange:a=>async function(e,a){const t=a.target.checked;await f.toggleModel(e,t)}(e.id,a)},null,40,Q)]),i("td",null,p(e.name||e.id),1),i("td",null,p((a=e.max_input_tokens,a?a.toLocaleString():"-")),1),i("td",null,"$"+p(z(e,"input")),1),i("td",null,"$"+p(z(e,"output")),1),i("td",null,p(Y(e)),1)]);var a}),128))])])],512),[[h,!ee(t)]])]))),128))])],64))]))}}),[["__scopeId","data-v-f5329b4e"]]),z={class:"database-management"},Y={class:"management-grid"},X={class:"management-card"},Z={key:0,class:"integrity-status-card"},ee={key:0,class:"issues-list"},ae=["disabled"],te={class:"management-card"},se={class:"cleanup-stats"},le={key:0,class:"stats-grid"},ne={class:"stat-item"},oe={class:"stat-value"},ie={class:"stat-item"},re={class:"stat-value"},ce={class:"cleanup-actions"},de=["disabled"],ue=["disabled"],ve={class:"management-card"},pe={class:"export-actions"},me=["disabled"],ge=["disabled"],he={class:"management-card danger"},fe={class:"danger-actions"},be=["disabled"],ye=L(e({__name:"DatabaseManagement",setup(e){const o=a(null),c=a(null),d=a(!1),u=a(!1),m=a(!1),h=a(!1),y=a(!1),k=t(()=>c.value&&(c.value.orphanedTasks>0||c.value.orphanedRuns>0));async function w(){d.value=!0;try{const[e,a,t,s]=await Promise.all([O.designs.toArray(),O.runs.toArray(),O.tasks.toArray(),O.variable_lists.toArray()]),l=[],n=a.filter(a=>!e.some(e=>e.id===a.design_id));n.length>0&&l.push({type:"orphaned_runs",count:n.length});const i=t.filter(e=>!a.some(a=>a.id===e.run_id));i.length>0&&l.push({type:"orphaned_tasks",count:i.length}),o.value={valid:0===l.length,issues:l.length>0?l:void 0}}catch(e){console.error("Integrity validation failed:",e),o.value={valid:!1}}finally{d.value=!1}}async function _(){u.value=!0;try{const[e,a,t]=await Promise.all([O.designs.toArray(),O.runs.toArray(),O.tasks.toArray()]),s=a.filter(a=>!e.some(e=>e.id===a.design_id)).length,l=t.filter(e=>!a.some(a=>a.id===e.run_id)).length;c.value={orphanedRuns:s,orphanedTasks:l}}catch(e){console.error("Orphan scan failed:",e)}finally{u.value=!1}}async function C(){m.value=!0;try{const[e,a]=await Promise.all([O.designs.toArray(),O.runs.toArray()]),t=a.filter(a=>!e.some(e=>e.id===a.design_id)).map(e=>e.id).filter(e=>void 0!==e);t.length>0&&await O.runs.bulkDelete(t);const s=a.filter(a=>e.some(e=>e.id===a.design_id)).map(e=>e.id).filter(e=>void 0!==e),l=(await O.tasks.filter(e=>!s.includes(e.run_id)).toArray()).map(e=>e.id).filter(e=>void 0!==e);l.length>0&&await O.tasks.bulkDelete(l),console.log(`Cleaned up ${t.length} orphaned runs and ${l.length} orphaned tasks`),await _()}catch(e){console.error("Cleanup failed:",e)}finally{m.value=!1}}async function A(){h.value=!0;try{const[e,a,t,s,l]=await Promise.all([O.designs.toArray(),O.runs.toArray(),O.tasks.toArray(),O.variable_lists.toArray(),O.models.toArray()]),n={metadata:{exported_at:(new Date).toISOString(),version:"2.0.0",type:"full_database_backup"},data:{designs:e,runs:a,tasks:t,variableLists:s,models:l}},o=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),i=URL.createObjectURL(o),r=document.createElement("a");r.href=i,r.download=`auditomatic-backup-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}catch(e){console.error("Export failed:",e)}finally{h.value=!1}}async function S(){h.value=!0;try{const[e,a]=await Promise.all([O.designs.toArray(),O.variable_lists.toArray()]),t={metadata:{exported_at:(new Date).toISOString(),version:"2.0.0",type:"designs_export"},data:{designs:e,variableLists:a}},s=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),l=URL.createObjectURL(s),n=document.createElement("a");n.href=l,n.download=`auditomatic-designs-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l)}catch(e){console.error("Export failed:",e)}finally{h.value=!1}}async function L(){if(!confirm("This will permanently delete ALL data including designs, runs, tasks, variable lists, models, API keys, and settings. This will reset the app to a fresh state. This cannot be undone. Are you sure?"))return;if(confirm("Are you absolutely sure? This will delete everything including API keys and models, and cannot be recovered.")){y.value=!0;try{await Promise.all([O.tasks.clear(),O.runs.clear(),O.designs.clear(),O.variable_lists.clear(),O.models.clear(),O.providers.clear(),O.api_keys.clear(),O.settings.clear(),O.research_logs.clear()]),console.log("All data cleared - app reset to fresh state"),c.value={orphanedTasks:0,orphanedRuns:0},o.value={valid:!0},window.location.reload()}catch(e){console.error("Clear data failed:",e)}finally{y.value=!1}}}return s(()=>{_()}),(e,a)=>(n(),l("div",z,[i("div",Y,[i("div",X,[a[0]||(a[0]=i("h3",null,"Database Health",-1)),o.value?(n(),l("div",Z,[i("div",{class:b(["status-indicator",o.value.valid?"valid":"invalid"])},p(o.value.valid?"✅ Healthy":"⚠️ Issues Found"),3),!o.value.valid&&o.value.issues?(n(),l("div",ee,[(n(!0),l(r,null,v(o.value.issues,e=>(n(),l("div",{key:e.type,class:"issue-item"},[i("strong",null,p(e.count),1),g(" "+p(e.type.replace("_"," ")),1)]))),128))])):f("",!0)])):f("",!0),i("button",{class:"btn btn-secondary",disabled:d.value,onClick:w},p(d.value?"Checking...":"🔍 Check Integrity"),9,ae)]),i("div",te,[a[3]||(a[3]=i("h3",null,"Data Cleanup",-1)),a[4]||(a[4]=i("p",{class:"card-description"}," Remove orphaned tasks and runs that remain after deleting parent records. ",-1)),i("div",se,[c.value?(n(),l("div",le,[i("div",ne,[i("span",oe,p(c.value.orphanedTasks),1),a[1]||(a[1]=i("span",{class:"stat-label"},"Orphaned Tasks",-1))]),i("div",ie,[i("span",re,p(c.value.orphanedRuns),1),a[2]||(a[2]=i("span",{class:"stat-label"},"Orphaned Runs",-1))])])):f("",!0)]),i("div",ce,[i("button",{class:"btn btn-secondary",disabled:u.value,onClick:_},p(u.value?"Scanning...":"🔍 Scan for Orphans"),9,de),i("button",{class:"btn btn-warning",disabled:m.value||!k.value,onClick:C},p(m.value?"Cleaning...":"🧹 Clean Up Orphans"),9,ue)])]),i("div",ve,[a[5]||(a[5]=i("h3",null,"Data Export",-1)),a[6]||(a[6]=i("p",{class:"card-description"}," Export your entire database for backup or migration purposes. ",-1)),i("div",pe,[i("button",{class:"btn btn-primary",disabled:h.value,onClick:A},p(h.value?"Exporting...":"📤 Export Full Database (all runs and results)"),9,me),i("button",{class:"btn btn-secondary",disabled:h.value,onClick:S},p(h.value?"Exporting...":"📋 Export Designs and Variable Lists"),9,ge)])]),i("div",he,[a[7]||(a[7]=i("h3",null,"⚠️ Danger Zone",-1)),a[8]||(a[8]=i("p",{class:"card-description"}," Irreversible operations that will permanently delete data. ",-1)),i("div",fe,[i("button",{class:"btn btn-danger",disabled:y.value,onClick:L},p(y.value?"Clearing...":"🗑️ Clear All Data"),9,be)])])])]))}}),[["__scopeId","data-v-d9de9f25"]]),ke={class:"database-browser"},we={class:"browser-controls"},_e={class:"table-selector"},Ce=["value"],Ae={class:"actions"},Se=["disabled"],Oe=["disabled"],Le=["disabled"],xe={key:0,class:"table-info"},Ee={key:1,class:"loading"},Ue={key:2,class:"error"},Re={key:3,class:"data-table"},Ie={class:"table-wrapper"},De={class:"actions-cell"},Te=["onClick"],Me=["onClick"],$e=["title"],je={key:0,class:"pagination"},Pe=["disabled"],Fe={class:"pagination-info"},Ne=["disabled"],Be={class:"modal-content"},Ge={class:"modal-header"},qe={class:"modal-body"},Je=L(e({__name:"DatabaseBrowser",setup(e){const o=a(""),d=a([]),g=a({}),h=a(!1),b=a(""),y=a(null),k=a(1),w=["designs","runs","tasks","variable_lists","models","providers","api_keys"];function _(e){switch(e){case"designs":return O.designs;case"runs":return O.runs;case"tasks":return O.tasks;case"variable_lists":return O.variable_lists;case"models":return O.models;case"providers":return O.providers;case"api_keys":return O.api_keys;default:throw new Error(`Unknown table: ${e}`)}}const C=t(()=>{if(0===d.value.length)return[];const e=d.value[0];return Object.keys(e)}),A=t(()=>Math.ceil(d.value.length/50)),S=t(()=>{const e=50*(k.value-1),a=e+50;return d.value.slice(e,a)});async function L(){for(const a of w)try{const e=await _(a).count();g.value[a]=e}catch(e){console.warn(`Failed to count ${a}:`,e),g.value[a]=0}}async function x(){if(o.value){h.value=!0,b.value="",k.value=1;try{const e=await _(o.value).toArray();d.value=e}catch(e){console.error(`Failed to load ${o.value}:`,e),b.value=`Failed to load table data: ${e instanceof Error?e.message:"Unknown error"}`,d.value=[]}finally{h.value=!1}}else d.value=[]}async function E(){await x(),await L()}function U(){if(!o.value||0===d.value.length)return;const e={table:o.value,exported_at:(new Date).toISOString(),count:d.value.length,data:d.value},a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download=`${o.value}-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}async function R(){if(!o.value)return;if(confirm(`Are you sure you want to clear all data from the ${o.value} table? This cannot be undone.`))try{await _(o.value).clear(),await E()}catch(e){console.error(`Failed to clear ${o.value}:`,e),b.value=`Failed to clear table: ${e instanceof Error?e.message:"Unknown error"}`}}function I(e){if(null==e)return"";if("object"==typeof e)return JSON.stringify(e);const a=String(e);return a.length>100?a.substring(0,100)+"...":a}return s(async()=>{await L()}),(e,a)=>(n(),l("div",ke,[i("div",we,[i("div",_e,[a[6]||(a[6]=i("label",null,"Select Table:",-1)),c(i("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),onChange:x},[a[5]||(a[5]=i("option",{value:""}," -- Choose a table -- ",-1)),(n(),l(r,null,v(w,e=>i("option",{key:e,value:e},p(e)+" ("+p(g.value[e]||0)+" records) ",9,Ce)),64))],544),[[u,o.value]])]),i("div",Ae,[i("button",{disabled:!o.value,class:"btn btn-secondary",onClick:E}," Refresh ",8,Se),i("button",{disabled:!o.value||!d.value.length,class:"btn btn-secondary",onClick:U}," Export JSON ",8,Oe),i("button",{disabled:!o.value,class:"btn btn-danger",onClick:R}," Clear Table ",8,Le)])]),o.value?(n(),l("div",xe,[i("h3",null,p(o.value)+" Table",1),i("p",null,p(d.value.length)+" records found",1)])):f("",!0),h.value?(n(),l("div",Ee," Loading table data... ")):f("",!0),b.value?(n(),l("div",Ue,p(b.value),1)):f("",!0),d.value.length>0?(n(),l("div",Re,[i("div",Ie,[i("table",null,[i("thead",null,[i("tr",null,[a[7]||(a[7]=i("th",null,"Actions",-1)),(n(!0),l(r,null,v(C.value,e=>(n(),l("th",{key:e},p(e),1))),128))])]),i("tbody",null,[(n(!0),l(r,null,v(S.value,(e,a)=>(n(),l("tr",{key:a},[i("td",De,[i("button",{class:"btn btn-sm btn-secondary",onClick:a=>{return t=e,void(y.value=t);var t}}," View ",8,Te),i("button",{class:"btn btn-sm btn-danger",onClick:a=>async function(e){if(!o.value)return;if(confirm("Are you sure you want to delete this record? This cannot be undone."))try{const a=e.id;void 0!==a?(await _(o.value).delete(a),await E()):b.value="Cannot delete record: no ID found"}catch(a){console.error("Failed to delete record:",a),b.value=`Failed to delete record: ${a instanceof Error?a.message:"Unknown error"}`}}(e)}," Delete ",8,Me)]),(n(!0),l(r,null,v(C.value,a=>(n(),l("td",{key:a,class:"data-cell"},[i("div",{class:"cell-content",title:I(e[a])},p(I(e[a])),9,$e)]))),128))]))),128))])])]),A.value>1?(n(),l("div",je,[i("button",{disabled:1===k.value,class:"btn btn-sm btn-secondary",onClick:a[1]||(a[1]=e=>k.value=Math.max(1,k.value-1))}," Previous ",8,Pe),i("span",Fe," Page "+p(k.value)+" of "+p(A.value)+" ("+p(d.value.length)+" total records) ",1),i("button",{disabled:k.value===A.value,class:"btn btn-sm btn-secondary",onClick:a[2]||(a[2]=e=>k.value=Math.min(A.value,k.value+1))}," Next ",8,Ne)])):f("",!0)])):f("",!0),y.value?(n(),l("div",{key:4,class:"modal-overlay",onClick:a[4]||(a[4]=m(e=>y.value=null,["self"]))},[i("div",Be,[i("div",Ge,[a[8]||(a[8]=i("h3",null,"Record Details",-1)),i("button",{class:"close-btn",onClick:a[3]||(a[3]=e=>y.value=null)}," × ")]),i("div",qe,[i("pre",null,p(JSON.stringify(y.value,null,2)),1)])])])):f("",!0)]))}}),[["__scopeId","data-v-4014bdce"]]),Ve={class:"research-quality-dashboard"},He={class:"dashboard-header"},Ke=["disabled"],Qe={class:"metrics-grid"},We={class:"metric-content"},ze={class:"metric-value"},Ye={class:"metric-details"},Xe={class:"metric-content"},Ze={class:"metric-value"},ea={class:"metric-details"},aa={class:"metric-content"},ta={class:"metric-value"},sa={class:"metric-details"},la={class:"metric-content"},na={class:"metric-value"},oa={class:"metric-details"},ia={class:"metric-content"},ra={class:"metric-value"},ca={class:"metric-details"},da={class:"metric-content"},ua={class:"metric-value"},va={class:"metric-details"},pa={class:"quality-summary"},ma={class:"summary-header"},ga={class:"summary-content"},ha={class:"quality-bar"},fa={class:"quality-recommendations"},ba={key:0,class:"recent-issues"},ya={class:"issues-list"},ka={class:"issue-type"},wa={class:"issue-message"},_a={class:"issue-time"},Ca=L(e({__name:"ResearchQualityDashboard",setup(e){const o=a(!1),c=a([]),d=a([]),u=a({completed:0,total:0,percentage:0,score:0}),m=a({logged:0,total:0,percentage:0,score:0}),g=a({successful:0,total:0,percentage:0,score:0}),h=a({totalCost:"0.00",avgCost:"0.00",score:100}),k=a({avg:0,min:0,max:0,score:100}),w=a({percentage:0,details:"",score:0}),_=a([]),C=t(()=>{const e=[u.value.score,m.value.score,g.value.score,h.value.score,k.value.score,w.value.score],a=e.reduce((e,a)=>e+a,0)/e.length;let t="Poor";return a>=90?t="Excellent":a>=75?t="Good":a>=60&&(t="Fair"),{score:Math.round(a),label:t}}),A=t(()=>{const e=[];return u.value.percentage<80&&e.push("Complete more tasks to improve data completeness"),m.value.percentage<100&&e.push("Ensure all tasks have API logging enabled for full transparency"),g.value.percentage<90&&e.push("Investigate failed tasks to improve success rate"),parseFloat(h.value.avgCost)>.1&&e.push("Consider using more cost-effective models"),k.value.avg>5e3&&e.push("Response times are high - consider optimizing prompts or using faster models"),0===e.length&&e.push("Great job! Your research quality metrics look excellent"),e});async function S(){o.value=!0;try{c.value=await O.runs.toArray(),d.value=await O.tasks.toArray();const e=d.value.filter(e=>"completed"===e.status).length;u.value={completed:e,total:d.value.length,percentage:d.value.length>0?Math.round(e/d.value.length*100):0,score:d.value.length>0?Math.round(e/d.value.length*100):0};const a=d.value.filter(e=>e.api_call_log).length;m.value={logged:a,total:d.value.length,percentage:d.value.length>0?Math.round(a/d.value.length*100):0,score:d.value.length>0?Math.round(a/d.value.length*100):0};const t=d.value.filter(e=>"completed"===e.status&&!e.error).length;g.value={successful:t,total:e,percentage:e>0?Math.round(t/e*100):0,score:e>0?Math.round(t/e*100):0};const s=d.value.filter(e=>e.api_call_log?.cost_estimate).reduce((e,a)=>e+(a.api_call_log?.cost_estimate.estimated_cost_usd||0),0),l=e>0?s/e:0;h.value={totalCost:s.toFixed(2),avgCost:l.toFixed(4),score:l<=.01?100:l<=.05?80:l<=.1?60:40};const n=d.value.filter(e=>e.response_time);if(n.length>0){const e=n.map(e=>e.response_time);k.value={avg:Math.round(e.reduce((e,a)=>e+a,0)/e.length),min:Math.min(...e),max:Math.max(...e),score:e.reduce((e,a)=>e+a,0)/e.length<=3e3?100:e.reduce((e,a)=>e+a,0)/e.length<=5e3?80:60}}const o=d.value.filter(e=>e.prompt&&e.variables&&e.model&&e.api_call_log).length;w.value={percentage:d.value.length>0?Math.round(o/d.value.length*100):0,score:d.value.length>0?Math.round(o/d.value.length*100):0,details:`${o}/${d.value.length} tasks fully reproducible`};const i=[];d.value.filter(e=>e.error&&e.created_at).sort((e,a)=>new Date(a.created_at).getTime()-new Date(e.created_at).getTime()).slice(0,3).forEach(e=>{i.push({id:`error-${e.id}`,type:"Error",message:e.error?.substring(0,100)+"..."||"Unknown error",timestamp:e.created_at})});d.value.filter(e=>"completed"===e.status&&!e.api_call_log&&e.created_at).slice(0,2).forEach(e=>{i.push({id:`missing-log-${e.id}`,type:"Missing Log",message:`Task ${e.id} completed without API logging`,timestamp:e.created_at})}),_.value=i}catch(e){console.error("Failed to refresh metrics:",e)}finally{o.value=!1}}function L(e){return e>=90?"metric-excellent":e>=75?"metric-good":e>=60?"metric-fair":"metric-poor"}function x(){const e=C.value.score;return e>=90?"quality-excellent":e>=75?"quality-good":e>=60?"quality-fair":"quality-poor"}function E(e){const a=new Date(e),t=(new Date).getTime()-a.getTime();return t<6e4?"just now":t<36e5?`${Math.floor(t/6e4)}m ago`:t<864e5?`${Math.floor(t/36e5)}h ago`:a.toLocaleDateString()}return s(()=>{S()}),(e,a)=>(n(),l("div",Ve,[i("div",He,[a[0]||(a[0]=i("h3",null,"🔬 Research Quality Metrics",-1)),i("button",{class:"refresh-btn",disabled:o.value,onClick:S},p(o.value?"Updating...":"🔄 Refresh"),9,Ke)]),i("div",Qe,[i("div",{class:b(["metric-card",L(u.value.score)])},[a[2]||(a[2]=i("div",{class:"metric-icon"}," 📊 ",-1)),i("div",We,[i("div",ze,p(u.value.percentage)+"% ",1),a[1]||(a[1]=i("div",{class:"metric-label"}," Data Completeness ",-1)),i("div",Ye,[i("span",null,p(u.value.completed)+"/"+p(u.value.total)+" tasks completed",1)])])],2),i("div",{class:b(["metric-card",L(m.value.score)])},[a[4]||(a[4]=i("div",{class:"metric-icon"}," 🔍 ",-1)),i("div",Xe,[i("div",Ze,p(m.value.percentage)+"% ",1),a[3]||(a[3]=i("div",{class:"metric-label"}," API Transparency ",-1)),i("div",ea,[i("span",null,p(m.value.logged)+"/"+p(m.value.total)+" with logs",1)])])],2),i("div",{class:b(["metric-card",L(g.value.score)])},[a[6]||(a[6]=i("div",{class:"metric-icon"}," ✅ ",-1)),i("div",aa,[i("div",ta,p(g.value.percentage)+"% ",1),a[5]||(a[5]=i("div",{class:"metric-label"}," Success Rate ",-1)),i("div",sa,[i("span",null,p(g.value.successful)+"/"+p(g.value.total)+" successful",1)])])],2),i("div",{class:b(["metric-card",L(h.value.score)])},[a[8]||(a[8]=i("div",{class:"metric-icon"}," 💰 ",-1)),i("div",la,[i("div",na," $"+p(h.value.avgCost),1),a[7]||(a[7]=i("div",{class:"metric-label"}," Avg Cost/Task ",-1)),i("div",oa,[i("span",null,"Total: $"+p(h.value.totalCost),1)])])],2),i("div",{class:b(["metric-card",L(k.value.score)])},[a[10]||(a[10]=i("div",{class:"metric-icon"}," ⚡ ",-1)),i("div",ia,[i("div",ra,p(k.value.avg)+"ms ",1),a[9]||(a[9]=i("div",{class:"metric-label"}," Avg Response Time ",-1)),i("div",ca,[i("span",null,p(k.value.min)+"ms - "+p(k.value.max)+"ms",1)])])],2),i("div",{class:b(["metric-card",L(w.value.score)])},[a[12]||(a[12]=i("div",{class:"metric-icon"}," 🔄 ",-1)),i("div",da,[i("div",ua,p(w.value.percentage)+"% ",1),a[11]||(a[11]=i("div",{class:"metric-label"}," Reproducibility ",-1)),i("div",va,[i("span",null,p(w.value.details),1)])])],2)]),i("div",pa,[i("div",ma,[a[13]||(a[13]=i("h4",null,"Overall Research Quality",-1)),i("div",{class:b(["quality-score",x()])},p(C.value.label),3)]),i("div",ga,[i("div",ha,[i("div",{class:b(["quality-fill",x()]),style:y({width:`${C.value.score}%`})},null,6)]),i("div",fa,[a[14]||(a[14]=i("h5",null,"Recommendations:",-1)),i("ul",null,[(n(!0),l(r,null,v(A.value,(e,a)=>(n(),l("li",{key:a},p(e),1))),128))])])])]),_.value.length>0?(n(),l("div",ba,[a[15]||(a[15]=i("h4",null,"⚠️ Recent Issues",-1)),i("div",ya,[(n(!0),l(r,null,v(_.value,e=>(n(),l("div",{key:e.id,class:"issue-item"},[i("span",ka,p(e.type),1),i("span",wa,p(e.message),1),i("span",_a,p(E(e.timestamp)),1)]))),128))])])):f("",!0)]))}}),[["__scopeId","data-v-cdbe9ea4"]]),Aa={class:"debug-tools"},Sa={class:"tools-grid"},Oa={class:"tool-card"},La={class:"system-info"},xa={class:"info-item"},Ea={class:"value"},Ua={class:"info-item"},Ra=["title"],Ia={class:"info-item"},Da={class:"value"},Ta={class:"info-item"},Ma={class:"value"},$a={class:"info-item"},ja={class:"value"},Pa={class:"tool-card"},Fa={class:"performance-info"},Na={class:"info-item"},Ba={class:"value"},Ga={class:"info-item"},qa={class:"value"},Ja={class:"info-item"},Va={class:"value"},Ha={class:"info-item"},Ka={class:"value"},Qa={class:"info-item"},Wa={class:"value"},za={class:"tool-card"},Ya={class:"console-section"},Xa={class:"console-controls"},Za={class:"log-level-filter"},et={class:"log-level-filter"},at={class:"log-level-filter"},tt={ref:"consoleOutput",class:"console-output"},st={class:"log-timestamp"},lt={class:"log-level"},nt={class:"log-message"},ot={class:"tool-card"},it={class:"network-tools"},rt={class:"test-section"},ct={class:"test-results"},dt={class:"test-name"},ut=["onClick"],vt=L(e({__name:"DebugTools",setup(e){const o=S(),d=A(),u=a([]),m=a(!0),h=a(!0),f=a(!1),y=a({browser:"",userAgent:"",screen:"",localStorage:"",indexedDB:""}),_=a({memory:"",connection:"",online:!1,loadTime:"",navigationType:""}),C=a([{name:"OpenAI API",url:"https://api.openai.com/v1/models",status:"pending",message:"Not tested"},{name:"Anthropic API",url:"https://api.anthropic.com/v1/models",status:"pending",message:"Not tested"},{name:"OpenRouter API",url:"https://openrouter.ai/api/v1/models",status:"pending",message:"Not tested"},{name:"Ollama Local",url:"http://localhost:11434/api/tags",status:"pending",message:"Not tested"}]),L=t(()=>u.value.filter(e=>!("error"===e.level&&!m.value)&&(!("warn"===e.level&&!h.value)&&!("info"===e.level&&!f.value))).slice(-100));let x={};function E(e,a){u.value.push({timestamp:new Date,level:e,message:a}),u.value.length>1e3&&(u.value=u.value.slice(-1e3))}function U(){u.value=[]}function R(){const e={exported_at:(new Date).toISOString(),logs:u.value},a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download=`auditomatic-logs-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}async function I(){const e={settings:await o.loadSettings(),models:d.models,timestamp:(new Date).toISOString()};console.log("Store State Dump:",e);const a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download=`store-state-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}async function D(){try{console.log("Testing database connectivity...");const e=[{name:"designs",table:O.designs},{name:"runs",table:O.runs},{name:"tasks",table:O.tasks},{name:"variable_lists",table:O.variable_lists},{name:"models",table:O.models}];for(const{name:a,table:t}of e){const e=await t.count();console.log(`${a} table: ${e} records`)}console.log("✅ Database test completed successfully")}catch(e){console.error("❌ Database test failed:",e)}}async function T(){console.log("Generating test data...");try{console.log("Test data generation not implemented yet")}catch(e){console.error("Failed to generate test data:",e)}}function M(){throw console.error("This is a simulated error for testing purposes"),new Error("Simulated error for debugging")}return s(()=>{y.value={browser:navigator.userAgent.includes("Chrome")?"Chrome":navigator.userAgent.includes("Firefox")?"Firefox":navigator.userAgent.includes("Safari")?"Safari":"Unknown",userAgent:navigator.userAgent,screen:`${screen.width}x${screen.height}`,localStorage:"undefined"!=typeof Storage?"✅ Supported":"❌ Not supported",indexedDB:"undefined"!=typeof indexedDB?"✅ Supported":"❌ Not supported"},function(){const e=performance.navigation,a=performance.timing;_.value={memory:performance.memory?`${Math.round(performance.memory.usedJSHeapSize/1024/1024)}MB used`:"Not available",connection:navigator.connection?`${navigator.connection.effectiveType} (${navigator.connection.downlink}Mbps)`:"Not available",online:navigator.onLine,loadTime:a.loadEventEnd>0?a.loadEventEnd-a.navigationStart+"ms":"Not available",navigationType:e?["Navigate","Reload","Back/Forward","Reserved"][e.type]||"Unknown":"Not available"}}(),x={log:console.log,warn:console.warn,error:console.error},console.log=(...e)=>{E("info",e.join(" ")),x.log(...e)},console.warn=(...e)=>{E("warn",e.join(" ")),x.warn(...e)},console.error=(...e)=>{E("error",e.join(" ")),x.error(...e)}}),k(()=>{x.log&&(console.log=x.log,console.warn=x.warn,console.error=x.error)}),(e,a)=>{return n(),l("div",Aa,[i("div",Sa,[i("div",Oa,[a[8]||(a[8]=i("h3",null,"System Information",-1)),i("div",La,[i("div",xa,[a[3]||(a[3]=i("span",{class:"label"},"Browser:",-1)),i("span",Ea,p(y.value.browser),1)]),i("div",Ua,[a[4]||(a[4]=i("span",{class:"label"},"User Agent:",-1)),i("span",{class:"value",title:y.value.userAgent},p((t=y.value.userAgent,s=50,t.length>s?t.substring(0,s)+"...":t)),9,Ra)]),i("div",Ia,[a[5]||(a[5]=i("span",{class:"label"},"Screen Resolution:",-1)),i("span",Da,p(y.value.screen),1)]),i("div",Ta,[a[6]||(a[6]=i("span",{class:"label"},"Local Storage:",-1)),i("span",Ma,p(y.value.localStorage),1)]),i("div",$a,[a[7]||(a[7]=i("span",{class:"label"},"IndexedDB:",-1)),i("span",ja,p(y.value.indexedDB),1)])])]),i("div",Pa,[a[14]||(a[14]=i("h3",null,"Performance Metrics",-1)),i("div",Fa,[i("div",Na,[a[9]||(a[9]=i("span",{class:"label"},"Memory Usage:",-1)),i("span",Ba,p(_.value.memory),1)]),i("div",Ga,[a[10]||(a[10]=i("span",{class:"label"},"Connection:",-1)),i("span",qa,p(_.value.connection),1)]),i("div",Ja,[a[11]||(a[11]=i("span",{class:"label"},"Online Status:",-1)),i("span",Va,p(_.value.online?"🟢 Online":"🔴 Offline"),1)]),i("div",Ha,[a[12]||(a[12]=i("span",{class:"label"},"Page Load Time:",-1)),i("span",Ka,p(_.value.loadTime),1)]),i("div",Qa,[a[13]||(a[13]=i("span",{class:"label"},"Navigation Type:",-1)),i("span",Wa,p(_.value.navigationType),1)])])]),i("div",za,[a[18]||(a[18]=i("h3",null,"Console Log",-1)),i("div",Ya,[i("div",Xa,[i("button",{class:"btn btn-sm btn-secondary",onClick:U}," Clear Logs "),i("button",{class:"btn btn-sm btn-secondary",onClick:R}," Export Logs "),i("label",Za,[c(i("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),type:"checkbox"},null,512),[[w,m.value]]),a[15]||(a[15]=g(" Errors "))]),i("label",et,[c(i("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>h.value=e),type:"checkbox"},null,512),[[w,h.value]]),a[16]||(a[16]=g(" Warnings "))]),i("label",at,[c(i("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>f.value=e),type:"checkbox"},null,512),[[w,f.value]]),a[17]||(a[17]=g(" Info "))])]),i("div",tt,[(n(!0),l(r,null,v(L.value,(e,a)=>{return n(),l("div",{key:a,class:b(["log-entry",`log-${e.level}`])},[i("span",st,p((t=e.timestamp,t.toLocaleTimeString())),1),i("span",lt,p(e.level.toUpperCase()),1),i("span",nt,p(e.message),1)],2);var t}),128))],512)])]),i("div",ot,[a[20]||(a[20]=i("h3",null,"Network Testing",-1)),i("div",it,[i("div",rt,[a[19]||(a[19]=i("h4",null,"API Connectivity",-1)),i("div",ct,[(n(!0),l(r,null,v(C.value,e=>(n(),l("div",{key:e.name,class:"test-result"},[i("span",dt,p(e.name)+":",1),i("span",{class:b(["test-status",e.status])},p(e.message),3),i("button",{class:"btn btn-xs btn-secondary",onClick:a=>async function(e,a){const t=C.value.find(e=>e.name===a);if(t){t.status="pending",t.message="Testing...";try{const a=new AbortController,s=setTimeout(()=>a.abort(),5e3),l=await fetch(e,{method:"HEAD",signal:a.signal,referrerPolicy:"no-referrer"});clearTimeout(s),l.ok?(t.status="success",t.message=`✅ Connected (${l.status})`):(t.status="error",t.message=`❌ Error ${l.status}`)}catch(s){t.status="error",s instanceof Error?"AbortError"===s.name?t.message="❌ Timeout":t.message=`❌ ${s.message}`:t.message="❌ Unknown error"}}}(e.url,e.name)}," Test ",8,ut)]))),128))])])])]),i("div",{class:"tool-card"},[a[21]||(a[21]=i("h3",null,"Developer Tools",-1)),i("div",{class:"dev-tools"},[i("button",{class:"btn btn-secondary",onClick:I}," Dump Store State "),i("button",{class:"btn btn-secondary",onClick:D}," Test Database "),i("button",{class:"btn btn-secondary",onClick:T}," Generate Test Data "),i("button",{class:"btn btn-warning",onClick:M}," Simulate Error ")])])])]);var t,s}}}),[["__scopeId","data-v-aad86c99"]]),pt={class:"settings-view"},mt={class:"settings-nav"},gt={class:"settings-content"},ht={key:0,class:"settings-tab-content"},ft={class:"tab-section"},bt={class:"api-keys"},yt={class:"api-key-group"},kt={class:"key-header"},wt={class:"key-status"},_t={key:0,class:"status-indicator saved",title:"URL configured"},Ct={key:1,class:"status-indicator missing",title:"Using default"},At={class:"api-key-input"},St={class:"key-header"},Ot=["for"],Lt={class:"key-status"},xt={key:0,class:"status-indicator saved",title:"API key is saved"},Et={key:1,class:"status-indicator missing",title:"No API key configured"},Ut={class:"api-key-input"},Rt=["id","onUpdate:modelValue","type","placeholder","onChange"],It=["title","onClick"],Dt={key:0,class:"provider-description"},Tt={class:"tab-section"},Mt={class:"models-actions"},$t=["disabled"],jt={class:"models-container"},Pt={key:1,class:"settings-tab-content"},Ft={class:"tab-section"},Nt={class:"tab-section"},Bt={key:2,class:"settings-tab-content"},Gt={class:"tab-section"},qt={class:"tab-section"},Jt={class:"modal-content"},Vt={class:"modal-header"},Ht={class:"modal-body"},Kt={class:"import-options"},Qt={class:"form-group"},Wt={class:"form-group"},zt={class:"modal-actions"},Yt=L(e({__name:"NewSettingsView",setup(e){const t=S(),o=A(),u=a("api-models"),g=a({}),h=a({}),y=a(""),k=a(!1),w=a(!1),L=a(!1),R=a(!1),I=a(""),D=[{id:"openai",name:"OpenAI",description:"Required for GPT models (gpt-4, gpt-3.5-turbo, etc.)"},{id:"anthropic",name:"Anthropic",description:"Required for Claude models (claude-3-sonnet, claude-3-haiku, etc.)"},{id:"openrouter",name:"OpenRouter",description:"Access to 100+ models through a single API"}];async function T(){const e=y.value.trim()||"http://localhost:11434";await t.saveOllamaUrl(e),console.log("Saved Ollama URL:",e)}async function M(e){try{if(!(await O.providers.get(e))){const t={id:e,name:(a=e,a.charAt(0).toUpperCase()+a.slice(1)),baseUrl:$(e),authType:"bearer",authHeader:"Authorization",authPrefix:"Bearer",endpoints:{},timeout_ms:6e4};await O.providers.add(t),console.log(`Created provider ${e} with default timeout`)}}catch(t){console.warn(`Failed to ensure provider ${e} exists:`,t)}var a}function $(e){switch(e){case"openai":return"https://api.openai.com/v1";case"anthropic":return"https://api.anthropic.com/v1";case"openrouter":return"https://openrouter.ai/api/v1";case"ollama":return"http://localhost:11434";default:return""}}async function j(){k.value=!0;try{console.log("Fetching Ollama models...")}finally{k.value=!1}}async function P(){if(console.log("[DEBUG] fetchOpenRouterModels FUNCTION STARTED"),w.value)console.log("[DEBUG] Already fetching, returning early");else{console.log("[DEBUG] Setting fetchingOpenRouter to true"),w.value=!0;try{console.log("[DEBUG] About to load settings");const e=await t.loadSettings();console.log("[DEBUG] Settings loaded:",e),console.log("[DEBUG] About to call fetchOR with API key:",e.openrouter_api_key?"HAS_KEY":"NO_KEY");const a=await x(e.openrouter_api_key);console.log("[DEBUG] fetchOR returned:",a.length,"models");const s=[];for(const t of a){await O.models.where("id").equals(t.id).first()||s.push(E(t))}if(s.length>0){const e=[...new Set(s.map(e=>e.provider))];for(const a of e)await M(a);await O.models.bulkAdd(s),alert(`Imported ${s.length} new OpenRouter models`),await o.loadModels()}else alert("No new OpenRouter models to import")}catch(e){console.error("[DEBUG] ERROR in fetchOpenRouterModels:",e),console.error("[DEBUG] Error name:",e instanceof Error?e.name:"Unknown"),console.error("[DEBUG] Error message:",e instanceof Error?e.message:"Unknown"),console.error("[DEBUG] Error stack:",e instanceof Error?e.stack:"No stack"),alert("Failed to fetch OpenRouter models: "+e.message)}finally{console.log("[DEBUG] Setting fetchingOpenRouter to false"),w.value=!1}}}async function F(){try{const e=o.models,a={};e.forEach(e=>{a[e.id]=e.enabled});const t={metadata:{exported_at:(new Date).toISOString(),total_models:e.length,enabled_count:e.filter(e=>e.enabled).length},model_config:a},s=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),l=URL.createObjectURL(s),n=document.createElement("a");n.href=l,n.download=`model-config-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l)}catch(e){console.error("Failed to export model config:",e),alert("Failed to export model configuration")}}function N(e){const a=e.target.files?.[0];if(!a)return;const t=new FileReader;t.onload=e=>{I.value=e.target?.result},t.readAsText(a)}async function B(){if(I.value.trim())try{const e=U(I.value);if(null===e)throw new SyntaxError("Invalid JSON format in imported configuration");const a=e.model_config||e;let t=0;for(const[s,l]of Object.entries(a))"boolean"==typeof l&&(await o.toggleModel(s,l),t++);alert(`Updated ${t} model configurations`),R.value=!1,I.value=""}catch(e){console.error("Import failed:",e),alert("Failed to parse JSON: "+(e instanceof Error?e.message:"Unknown error"))}else alert("Please provide JSON data")}return s(async()=>{await async function(){const e=await t.loadSettings();g.value={openai:e.openai_api_key||"",anthropic:e.anthropic_api_key||"",openrouter:e.openrouter_api_key||""},y.value=e.ollama_base_url||""}(),D.forEach(e=>{h.value[e.id]=!1})}),(e,a)=>(n(),l("div",pt,[a[28]||(a[28]=i("div",{class:"settings-header"},[i("h1",null,"Settings"),i("p",{class:"settings-description"}," Configure API keys, manage models, and maintain your database ")],-1)),i("nav",mt,[i("button",{class:b(["settings-tab",{active:"api-models"===u.value}]),onClick:a[0]||(a[0]=e=>u.value="api-models")}," 🔑 API & Models ",2),i("button",{class:b(["settings-tab",{active:"database"===u.value}]),onClick:a[1]||(a[1]=e=>u.value="database")}," 🗄️ Database ",2),i("button",{class:b(["settings-tab",{active:"advanced"===u.value}]),onClick:a[2]||(a[2]=e=>u.value="advanced")}," ⚙️ Advanced ",2)]),i("div",gt,["api-models"===u.value?(n(),l("div",ht,[i("div",ft,[a[12]||(a[12]=i("h2",null,"API Keys",-1)),a[13]||(a[13]=i("p",{class:"section-description"}," Configure API keys for different providers. Keys are stored locally in your browser. ",-1)),i("div",bt,[i("div",yt,[i("div",kt,[a[10]||(a[10]=i("label",{for:"ollama-url"},"Ollama Server URL",-1)),i("div",wt,[y.value?(n(),l("span",_t," ✓ Configured ")):(n(),l("span",Ct," Default "))])]),i("div",At,[c(i("input",{id:"ollama-url","onUpdate:modelValue":a[3]||(a[3]=e=>y.value=e),type:"text",placeholder:"http://localhost:11434",class:"secure-input",onChange:T},null,544),[[d,y.value]])]),a[11]||(a[11]=i("div",{class:"provider-description"}," Default: http://localhost:11434. Make sure to set OLLAMA_ORIGINS=* for browser access. ",-1))]),(n(),l(r,null,v(D,e=>i("div",{key:e.id,class:"api-key-group"},[i("div",St,[i("label",{for:`api-key-${e.id}`},p(e.name)+" API Key ",9,Ot),i("div",Lt,[g.value[e.id]?(n(),l("span",xt," ✓ Saved ")):(n(),l("span",Et," ⚠ Not configured "))])]),i("div",Ut,[c(i("input",{id:`api-key-${e.id}`,"onUpdate:modelValue":a=>g.value[e.id]=a,type:h.value[e.id]?"text":"password",placeholder:`Enter ${e.name} API key`,class:"secure-input",autocomplete:"off",spellcheck:"false",onChange:a=>async function(e){const a=g.value[e];a&&a.trim()?(await t.saveApiKey(e,a.trim()),console.log(`Saved ${e} API key`)):(await t.removeApiKey(e),console.log(`Removed ${e} API key`))}(e.id)},null,40,Rt),[[_,g.value[e.id]]]),i("button",{type:"button",class:"toggle-visibility",title:h.value[e.id]?"Hide key":"Show key",onClick:a=>{return t=e.id,void(h.value[t]=!h.value[t]);var t}},p(h.value[e.id]?"👁️":"🔒"),9,It)]),e.description?(n(),l("div",Dt,p(e.description),1)):f("",!0)])),64))])]),i("div",Tt,[a[14]||(a[14]=i("h2",null,"Model Registry",-1)),a[15]||(a[15]=i("p",{class:"section-description"}," Manage available models, configure providers, and control which models are enabled for experiments. ",-1)),i("div",Mt,[i("button",{class:"btn btn-secondary",disabled:k.value,onClick:j},p(k.value?"Fetching...":"Fetch Ollama Models"),9,$t),i("button",{class:"btn btn-secondary",onClick:P},p(w.value?"Fetching...":"Fetch OpenRouter Models"),1),i("button",{class:"btn btn-secondary",onClick:a[4]||(a[4]=e=>async function(e=!1){if(L.value)return;L.value=!0;const a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);console.log(`[LiteLLM] Browser: ${a?"Safari":"Other"} - ${navigator.userAgent}`);try{e&&await O.models.clear(),console.log("[LiteLLM] Starting fetch...");const t={method:"GET",mode:"cors",credentials:"omit",headers:{Accept:"application/json"}};a?(console.log("[LiteLLM] Applying Safari cache bypass"),t.cache="reload"):t.referrerPolicy="no-referrer";const s=await fetch("https://raw.githubusercontent.com/BerriAI/litellm/refs/heads/main/model_prices_and_context_window.json",t);console.log("[LiteLLM] Response:",{ok:s.ok,status:s.status,statusText:s.statusText,headers:Object.fromEntries(s.headers.entries())});const l=await s.json();console.log("[LiteLLM] JSON parsed, entries:",Object.keys(l).length);const n={};for(const[e,a]of Object.entries(l)){if("sample_spec"===e||!a.litellm_provider)continue;const t=a;["openai","anthropic"].includes(t.litellm_provider)&&(e.startsWith("ft:")||"chat"===t.mode&&("openai"!==t.litellm_provider||e.startsWith("gpt-")||e.startsWith("o"))&&(n[e]=t))}const i={};for(const e of Object.keys(n)){const a=e.replace(/-\d{4}-\d{2}-\d{2}$/,"");i[a]||(i[a]=[]),i[a].push(e)}const r=[];for(const[e,a]of Object.entries(i)){const e=a.filter(e=>/-\d{4}-\d{2}-\d{2}$/.test(e)),t=a.filter(e=>!/-\d{4}-\d{2}-\d{2}$/.test(e));if(e.length>0){const a=e.sort().reverse();r.push(a[0])}else r.push(...t)}const c=[];for(const a of r){if(!e&&await O.models.where("id").equals(a).first())continue;const t=n[a];c.push({id:a,name:a,provider:t.litellm_provider,enabled:!0,max_input_tokens:t.max_input_tokens||t.max_tokens||void 0,max_output_tokens:t.max_output_tokens||void 0,context_window:t.max_input_tokens||t.max_tokens||void 0,input_cost:1e6*(t.input_cost_per_token||0),output_cost:1e6*(t.output_cost_per_token||0),supports_function_calling:t.supports_function_calling||!1,supports_json_mode:t.supports_json_mode||!1,supports_streaming:!1!==t.supports_streaming,supported_modalities:t.supports_vision?["text","image"]:["text"]})}if(c.length>0){const a=[...new Set(c.map(e=>e.provider))];for(const e of a)await M(e);await O.models.bulkAdd(c),alert(`${e?"Replaced all models with":"Imported"} ${c.length} OpenAI and Anthropic chat models from LiteLLM`),await o.loadModels()}else e?alert("No OpenAI or Anthropic chat models found in LiteLLM"):alert("No new OpenAI or Anthropic chat models to import from LiteLLM")}catch(t){console.error("[LiteLLM] DETAILED ERROR:",{error:t,name:t instanceof Error?t.name:"Unknown",message:t instanceof Error?t.message:"Unknown",stack:t instanceof Error?t.stack:void 0,safari:a,userAgent:navigator.userAgent,online:navigator.onLine,cookieEnabled:navigator.cookieEnabled,language:navigator.language,platform:navigator.platform,hardwareConcurrency:navigator.hardwareConcurrency,connection:navigator.connection?{effectiveType:navigator.connection.effectiveType,downlink:navigator.connection.downlink,rtt:navigator.connection.rtt}:"not available"});let e=t.message;a&&t instanceof TypeError&&t.message.includes("fetch")&&(e=`Safari fetch failed: Likely due to content blockers, privacy settings, or network issues. Original: ${t.message}`),alert("Failed to fetch LiteLLM models: "+e)}finally{L.value=!1}}(!1))},p(L.value?"Fetching...":"Fetch OpenAI & Anthropic Pricing (from LiteLLM GitHub repo)"),1),i("button",{class:"btn btn-primary",onClick:F}," 📤 Export Config "),i("button",{class:"btn btn-primary",onClick:a[5]||(a[5]=e=>R.value=!0)}," 📥 Import Config ")]),i("div",jt,[C(W)])])])):f("",!0),"database"===u.value?(n(),l("div",Pt,[i("div",Ft,[a[16]||(a[16]=i("h2",null,"Database Management",-1)),a[17]||(a[17]=i("p",{class:"section-description"}," Monitor database health, clean up orphaned records, and manage data integrity. ",-1)),C(ye)]),i("div",Nt,[a[18]||(a[18]=i("h2",null,"Database Browser",-1)),a[19]||(a[19]=i("p",{class:"section-description"}," Browse raw database tables, export data, and inspect records directly. ",-1)),C(Je)])])):f("",!0),"advanced"===u.value?(n(),l("div",Bt,[i("div",Gt,[a[20]||(a[20]=i("h2",null,"Research Quality Metrics",-1)),a[21]||(a[21]=i("p",{class:"section-description"}," Monitor system performance and research data quality metrics. ",-1)),C(Ca)]),i("div",qt,[a[22]||(a[22]=i("h2",null,"System Debug",-1)),a[23]||(a[23]=i("p",{class:"section-description"}," Advanced debugging tools and system information. ",-1)),C(vt)])])):f("",!0)]),R.value?(n(),l("div",{key:0,class:"modal-overlay",onClick:a[9]||(a[9]=m(e=>R.value=!1,["self"]))},[i("div",Jt,[i("div",Vt,[a[24]||(a[24]=i("h3",null,"Import Model Configuration",-1)),i("button",{class:"close-btn",onClick:a[6]||(a[6]=e=>R.value=!1)}," × ")]),i("div",Ht,[a[27]||(a[27]=i("p",null,"Upload a JSON file containing your model enable/disable configuration:",-1)),i("div",Kt,[i("div",Qt,[a[25]||(a[25]=i("label",{for:"config-file"},"Upload File:",-1)),i("input",{id:"config-file",type:"file",accept:".json",onChange:N},null,32)]),i("div",Wt,[a[26]||(a[26]=i("label",{for:"config-json"},"Or Paste JSON:",-1)),c(i("textarea",{id:"config-json","onUpdate:modelValue":a[7]||(a[7]=e=>I.value=e),rows:"10",placeholder:'{"openai:gpt-4": true, "anthropic:claude-3-sonnet": false, ...}'},null,512),[[d,I.value]])])]),i("div",zt,[i("button",{class:"btn btn-secondary",onClick:a[8]||(a[8]=e=>R.value=!1)}," Cancel "),i("button",{class:"btn btn-primary",onClick:B}," Import ")])])])])):f("",!0)]))}}),[["__scopeId","data-v-52a2e98f"]]);export{Yt as default};
