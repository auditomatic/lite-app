var e=Object.defineProperty,s=(s,t,a)=>((s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a)(s,"symbol"!=typeof t?t+"":t,a);import{d as t,r as a,i as l,y as n,b as i,e as o,f as r,g as c,F as u,A as d,t as v,o as p,Q as m,S as g,n as b,w as f,E as h,u as k,Y as y,Z as _,p as C,V as w,m as D}from"./vendor-w2iEWTO6.js";import{D as x,_ as M,a as $,u as I,b as T}from"./index-BO1xIGYv.js";import{u as S}from"./variableLists-DnXvrsyG.js";import"./db-BfRGDvSu.js";function O(e,s){let t=e;for(const[a,l]of Object.entries(s)){const e=new RegExp(`{{\\s*${a}\\s*}}`,"g"),s=Array.isArray(l)?l.join(", "):String(l);t=t.replace(e,s)}return function(e){const s=e.split(/\s+/);let t=0;for(const l of s)0!==l.length&&(l.length<=4?t+=1:l.length<=8?t+=Math.ceil(l.length/4):t+=Math.ceil(l.length/3.5));const a=e.match(/[.,!?;:'"()\[\]{}<>@#$%^&*+=|\\\/~`-]/g);return a&&(t+=.5*a.length),Math.ceil(t)}(t)}const A=class e{constructor(){s(this,"dbService"),this.dbService=x.getInstance()}static getInstance(){return e.instance||(e.instance=new e),e.instance}async calculateExperimentMetrics(e,s=[]){let t=1,a=0,l=0;const n=e.variables||{};for(const[o,r]of Object.entries(n))Array.isArray(r)&&r.length>0&&(t*=r.length,a++);const i=e.variable_list_refs||{};for(const[o,r]of Object.entries(i)){let e=s.find(e=>e.id===r);if(!e){const s=await this.dbService.read("variable_lists",r);s.success&&s.data&&(e=s.data)}e&&e.values&&e.values.length>0&&(t*=e.values.length,l++)}return{totalCombinations:t,variableCount:a+l,simpleVariables:a,compoundVariables:l,estimatedTasks:t}}async estimateExperimentCost(e,s,t=[],a={}){const l=await this.calculateExperimentMetrics(e,t),n=l.totalCombinations*s.length,{estimatedInputTokens:i=100,estimatedOutputTokens:o=50}=a;let r=0;const c={};for(const u of s){const e="openrouter"===u.provider?u.input_cost||0:(u.input_cost||0)/1e6,s="openrouter"===u.provider?u.output_cost||0:(u.output_cost||0)/1e6;console.log(`DEBUG: Model ${u.id}, provider: ${u.provider}`),console.log(`DEBUG: Raw costs - input: ${u.input_cost}, output: ${u.output_cost}`),console.log(`DEBUG: Per-token costs - input: ${e}, output: ${s}`);const t=e*i*l.totalCombinations,a=s*o*l.totalCombinations,n=t+a;console.log(`DEBUG: Final costs - input: ${t}, output: ${a}, total: ${n}`),c[u.id]=n,r+=n}return{totalCost:r,costPerModel:c,costPerTask:n>0?r/n:0,breakdown:{inputTokens:i*n,outputTokens:o*n,requests:n}}}validateExperimentSize(e,s){const t=e.totalCombinations*s,a=[],l=[];return t>1e3&&a.push(`Large experiment: ${t} tasks may take significant time`),t>1e4&&a.push("Very large experiment: Consider running in batches"),t>5e4&&l.push(`Experiment too large: ${t} tasks exceeds maximum of 50,000`),e.totalCombinations>1e5&&l.push(`Too many variable combinations: ${e.totalCombinations} exceeds maximum of 100,000`),{valid:0===l.length,warnings:a,errors:l}}};s(A,"instance");let L=A;const R={class:"basics-step"},E={class:"form-section"},j={class:"form-group"},U=["value"],F={class:"form-group"},V=["value"],N=["value"],P={key:0,class:"design-preview"},B={class:"preview-card"},q={class:"preview-header"},G={class:"variable-count"},z={class:"prompt-preview"},K={class:"prompt-header"},H={key:0,class:"prompt-controls"},W=["disabled"],Z={class:"prompt-counter"},Y=["disabled"],J={class:"prompt-content"},Q={key:0,class:"preview-note"},X={key:0,class:"variables-preview"},ee={class:"variables-list"},se={class:"variable-name"},te={class:"current-value"},ae={class:"variable-count"},le={class:"variable-name"},ne={class:"current-value"},ie={class:"variable-count"},oe={class:"combinations-info"},re={class:"info-value"},ce={key:1,class:"empty-state"},ue=100,de=M(t({__name:"RunBasicsStep",props:{name:{},designId:{},designs:{},selectedDesign:{}},emits:["update:name","update:design-id"],setup(e,{emit:s}){const t=e,p=S(),m=a(0),g=l(()=>{if(!t.selectedDesign)return 0;return Object.keys(t.selectedDesign.variables||{}).length+Object.keys(t.selectedDesign.variable_list_refs||{}).length}),b=a(0);n(()=>[t.selectedDesign,p.variableLists],async()=>{if(!t.selectedDesign)return void(b.value=0);const e=L.getInstance(),s=await e.calculateExperimentMetrics(t.selectedDesign,p.variableLists);b.value=s.totalCombinations},{immediate:!0,deep:!0});const f=l(()=>{if(!t.selectedDesign)return[];const e=t.selectedDesign.variables||{},s=t.selectedDesign.variable_list_refs||{},a={};for(const[t,o]of Object.entries(e))a[t]=Array.isArray(o)?o:[String(o)];for(const[t,o]of Object.entries(s)){const e=p.variableLists.find(e=>e.id===o);e&&e.values&&(a[t]=e.values)}const l=Object.keys(a);if(0===l.length)return[{}];const n=[],i=Math.min(b.value,ue);!function e(s,t){if(n.length>=i)return;if(s>=l.length)return void n.push({...t});const o=l[s],r=a[o];for(const a of r){if(n.length>=i)return;t[o]=a,e(s+1,t)}}(0,{});for(let t=n.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[n[t],n[e]]=[n[e],n[t]]}return n}),h=l(()=>{if(!t.selectedDesign||0===f.value.length)return t.selectedDesign?.prompt_template||"";const e=f.value[m.value]||{};let s=t.selectedDesign.prompt_template;for(const[t,a]of Object.entries(e)){const e=new RegExp(`{{\\s*${t}\\s*}}`,"g");s=s.replace(e,a)}return s}),k=l(()=>t.selectedDesign&&0!==f.value.length&&f.value[m.value]||{});function y(){m.value>0&&m.value--}function _(){const e=Math.min(b.value,ue)-1;m.value<e&&m.value++}function C(e){const s="string"==typeof e?parseInt(e):e,t=p.variableLists.find(e=>e.id===s);return t?.values?.length||0}return n(()=>t.selectedDesign?.id,()=>{m.value=0}),(e,s)=>(o(),i("div",R,[s[13]||(s[13]=r("div",{class:"step-header"},[r("h3",null,"Run Basics"),r("p",null,"Give your run a name and choose the design to evaluate.")],-1)),r("div",E,[r("div",j,[s[2]||(s[2]=r("label",{for:"run-name"},"Run Name",-1)),r("input",{id:"run-name",value:e.name,type:"text",class:"form-control",placeholder:"e.g., Product Review Analysis - V1",required:"",onInput:s[0]||(s[0]=s=>e.$emit("update:name",s.target.value))},null,40,U),s[3]||(s[3]=r("span",{class:"form-hint"},"Choose a descriptive name to identify this run later",-1))]),r("div",F,[s[5]||(s[5]=r("label",{for:"design-select"},"Design",-1)),r("select",{id:"design-select",value:e.designId,class:"form-control",required:"",onChange:s[1]||(s[1]=s=>e.$emit("update:design-id",Number(s.target.value)||null))},[s[4]||(s[4]=r("option",{value:null}," Select a design... ",-1)),(o(!0),i(u,null,d(e.designs,e=>(o(),i("option",{key:e.id,value:e.id},v(e.name),9,N))),128))],40,V),s[6]||(s[6]=r("span",{class:"form-hint"},"The prompt template and variables to evaluate",-1))])]),e.selectedDesign?(o(),i("div",P,[s[11]||(s[11]=r("h4",null,"Design Preview",-1)),r("div",B,[r("div",q,[r("h5",null,v(e.selectedDesign.name),1),r("span",G,v(g.value)+" variables",1)]),r("div",z,[r("div",K,[s[7]||(s[7]=r("label",null,"Prompt Preview:",-1)),b.value>1?(o(),i("div",H,[r("button",{disabled:0===m.value,class:"nav-btn",onClick:y}," ‚Üê ",8,W),r("span",Z,v(m.value+1)+" of "+v(Math.min(b.value,ue)),1),r("button",{disabled:m.value>=Math.min(b.value,ue)-1,class:"nav-btn",onClick:_}," ‚Üí ",8,Y)])):c("",!0)]),r("div",J,[r("pre",null,v(h.value),1)]),b.value>ue?(o(),i("div",Q," Showing first "+v(ue)+" of "+v(b.value.toLocaleString())+" combinations ",1)):c("",!0)]),g.value>0?(o(),i("div",X,[s[9]||(s[9]=r("label",null,"Variables:",-1)),r("div",ee,[(o(!0),i(u,null,d(e.selectedDesign.variables,(e,s)=>(o(),i("div",{key:s,class:"variable-summary"},[r("span",se,v(s),1),r("span",te,"("+v(k.value[s]||"N/A")+")",1),r("span",ae,v(Array.isArray(e)?e.length:1)+" values",1)]))),128)),(o(!0),i(u,null,d(e.selectedDesign.variable_list_refs,(e,t)=>(o(),i("div",{key:`list-${t}`,class:"variable-summary"},[r("span",le,v(t),1),r("span",ne,"("+v(k.value[t]||"N/A")+")",1),r("span",ie,v(C(e))+" values",1),s[8]||(s[8]=r("span",{class:"variable-source"},"(from list)",-1))]))),128))])])):c("",!0),r("div",oe,[s[10]||(s[10]=r("span",{class:"info-label"},"Total Combinations:",-1)),r("span",re,v(b.value),1)])])])):0===e.designs.length?(o(),i("div",ce,s[12]||(s[12]=[r("div",{class:"empty-icon"}," üìù ",-1),r("h4",null,"No Designs Available",-1),r("p",null,"You need to create a design first before you can create a run.",-1),r("button",{class:"btn btn-outline"}," Create Design ",-1)]))):c("",!0)]))}}),[["__scopeId","data-v-df2d7b34"]]),ve={class:"model-selection-step"},pe={class:"selection-controls"},me={class:"search-and-filters"},ge={class:"search-box"},be={class:"quick-filters"},fe=["onClick"],he={class:"selection-summary"},ke={class:"selected-count"},ye={class:"parameters-section"},_e={class:"parameters-grid"},Ce={class:"parameter-item"},we=["value"],De={class:"parameter-item"},xe=["value"],Me={class:"parameter-item"},$e=["value"],Ie={class:"parameter-item"},Te=["value"],Se={class:"models-grid"},Oe=["onClick"],Ae={class:"provider-controls"},Le={class:"model-count"},Re=["onClick"],Ee={key:0,class:"models-list"},je=["onClick"],Ue={class:"model-info"},Fe={class:"model-details"},Ve={key:0,class:"cost-info"},Ne={key:1,class:"context-info"},Pe={class:"selection-indicator"},Be={key:0},qe={key:0,class:"cost-estimate"},Ge={class:"cost-summary"},ze={class:"cost-overview"},Ke={class:"overview-item"},He={class:"value"},We={class:"overview-item"},Ze={class:"value"},Ye={class:"overview-item"},Je={class:"value"},Qe={class:"overview-item total"},Xe={class:"value"},es={class:"cost-breakdown"},ss={class:"breakdown-table"},ts={key:1,class:"task-estimate"},as={class:"estimate-card"},ls={class:"estimate-details"},ns={class:"estimate-item"},is={class:"value"},os={class:"estimate-item"},rs={class:"value"},cs={class:"estimate-item total"},us={class:"value"},ds=M(t({__name:"ModelSelectionStep",props:{selectedModels:{},allModels:{},design:{},taskCount:{},parameters:{}},emits:["update:selected-models","update:parameters"],setup(e,{emit:s}){const t=e,h=s,k=a(""),y=a(""),_=a(new Set),C=[{id:"all",label:"All Models"},{id:"openai",label:"OpenAI"},{id:"anthropic",label:"Anthropic"},{id:"budget",label:"Budget"},{id:"premium",label:"Premium"}],w=l(()=>{let e=t.allModels;if(k.value){const s=k.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(s)||e.provider.toLowerCase().includes(s))}if(y.value&&"all"!==y.value)switch(y.value){case"openai":e=e.filter(e=>e.provider.toLowerCase().includes("openai"));break;case"anthropic":e=e.filter(e=>e.provider.toLowerCase().includes("anthropic"));break;case"budget":e=e.filter(e=>(e.input_cost||0)<.001);break;case"premium":e=e.filter(e=>(e.input_cost||0)>=.001)}return e}),D=l(()=>{const e={};return w.value.forEach(s=>{e[s.provider]||(e[s.provider]=[]),e[s.provider].push(s)}),Object.keys(e).forEach(s=>{e[s].sort((e,s)=>e.name.localeCompare(s.name))}),e}),x=S(),M=a(0),$=a(null);n(()=>[t.design,x.variableLists],async()=>{if(t.design)try{$.value=null;const e=L.getInstance(),s=await e.calculateExperimentMetrics(t.design,x.variableLists);M.value=s.totalCombinations}catch(e){$.value=`Calculation error: ${e instanceof Error?e.message:"Unknown error"}`,M.value=0}else M.value=0},{immediate:!0,deep:!0});const I=l(()=>M.value*t.selectedModels.length*t.parameters.repetitions_per_prompt),T=l(()=>t.allModels.filter(e=>t.selectedModels.includes(e.id))),O=l(()=>{if(!t.design)return 50;const e=t.design.prompt_template?.length||200;return Math.ceil(e/4)}),A=a(0),R=a(null);n(()=>[t.design,T.value,t.parameters.max_tokens,t.parameters.repetitions_per_prompt,O.value,x.variableLists],async()=>{if(t.design&&0!==T.value.length)try{R.value=null;const e=L.getInstance(),s=await e.estimateExperimentCost(t.design,T.value,x.variableLists,{estimatedInputTokens:O.value,estimatedOutputTokens:t.parameters.max_tokens});A.value=s.totalCost}catch(e){R.value=`Cost calculation error: ${e instanceof Error?e.message:"Unknown error"}`,A.value=0}else A.value=0},{immediate:!0,deep:!0});const E=l(()=>T.value.map(e=>{const s=O.value,a=t.parameters.max_tokens,l=("openrouter"===e.provider?e.input_cost||0:(e.input_cost||0)/1e6)*s+("openrouter"===e.provider?e.output_cost||0:(e.output_cost||0)/1e6)*a,n=l*M.value*t.parameters.repetitions_per_prompt;return{model:e.name,inputTokens:s,outputTokens:a,costPerTask:l,totalCost:n}}));p(()=>{});const j=()=>{h("update:selected-models",[])};function U(e,s){h("update:parameters",{...t.parameters,[e]:s})}const F=(e,s)=>{const t="input"===s?e.input_cost:e.output_cost;if(void 0===t)return"?";const a="openrouter"===e.provider?1e6*t:t;return a<.01?a.toFixed(4):a<1?a.toFixed(3):a<10?a.toFixed(2):a.toFixed(1)};return(e,s)=>(o(),i("div",ve,[s[19]||(s[19]=r("div",{class:"step-header"},[r("h3",null,"Select Models"),r("p",null,"Choose which models to evaluate with your design.")],-1)),r("div",pe,[r("div",me,[r("div",ge,[m(r("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>k.value=e),type:"text",class:"search-input",placeholder:"Search models..."},null,512),[[g,k.value]])]),r("div",be,[(o(),i(u,null,d(C,e=>r("button",{key:e.id,class:b(["filter-btn",{active:y.value===e.id}]),onClick:s=>(e=>{y.value=e.id,"openai"===e.id?(_.value.clear(),_.value.add("OpenAI")):"anthropic"===e.id?(_.value.clear(),_.value.add("Anthropic")):"all"===e.id&&Object.keys(D.value).forEach(e=>{_.value.add(e)})})(e)},v(e.label),11,fe)),64))])]),r("div",he,[r("span",ke,v(e.selectedModels.length)+" models selected",1),e.selectedModels.length>0?(o(),i("button",{key:0,class:"clear-btn",onClick:j}," Clear All ")):c("",!0)])]),r("div",ye,[s[8]||(s[8]=r("h4",null,"Parameters",-1)),r("div",_e,[r("div",Ce,[r("label",null,"Temperature: "+v(t.parameters.temperature),1),r("input",{value:t.parameters.temperature,type:"range",min:"0",max:"2",step:"0.1",class:"parameter-slider",onInput:s[1]||(s[1]=e=>U("temperature",parseFloat(e.target.value)))},null,40,we)]),r("div",De,[s[5]||(s[5]=r("label",null,"Max Output Tokens",-1)),r("input",{value:t.parameters.max_tokens,type:"number",min:"1",max:"4000",class:"parameter-input",onInput:s[2]||(s[2]=e=>U("max_tokens",parseInt(e.target.value)))},null,40,xe)]),r("div",Me,[s[6]||(s[6]=r("label",null,"Concurrency",-1)),r("input",{value:t.parameters.concurrency,type:"number",min:"1",max:"10",class:"parameter-input",onInput:s[3]||(s[3]=e=>U("concurrency",parseInt(e.target.value)))},null,40,$e)]),r("div",Ie,[s[7]||(s[7]=r("label",null,"Repetitions per Prompt",-1)),r("input",{value:t.parameters.repetitions_per_prompt,type:"number",min:"1",max:"10",class:"parameter-input",onInput:s[4]||(s[4]=e=>U("repetitions_per_prompt",parseInt(e.target.value)))},null,40,Te)])])]),r("div",Se,[(o(!0),i(u,null,d(D.value,(s,a)=>(o(),i("div",{key:a,class:"provider-section"},[r("div",{class:"provider-header",onClick:e=>(e=>{_.value.has(e)?_.value.delete(e):_.value.add(e)})(a)},[r("h4",null,v(a),1),r("div",Ae,[r("span",Le,v(s.length)+" models",1),r("button",{class:"select-all-btn",onClick:f(e=>((e,s)=>{const a=s.map(e=>e.id),l=[...t.selectedModels];if(a.every(e=>l.includes(e))){const e=l.filter(e=>!a.includes(e));h("update:selected-models",e)}else{const e=[...new Set([...l,...a])];h("update:selected-models",e)}})(0,s),["stop"])}," Select All ",8,Re),r("span",{class:b(["expand-icon",{expanded:_.value.has(a)}])}," ‚ñº ",2)])],8,Oe),_.value.has(a)?(o(),i("div",Ee,[(o(!0),i(u,null,d(s,s=>{return o(),i("div",{key:s.id,class:b(["model-card",{selected:e.selectedModels.includes(s.id)}]),onClick:e=>(e=>{const s=[...t.selectedModels],a=s.indexOf(e);a>-1?s.splice(a,1):s.push(e),h("update:selected-models",s)})(s.id)},[r("div",Ue,[r("h5",null,v(s.name),1),r("div",Fe,[void 0!==s.input_cost?(o(),i("span",Ve," $"+v(F(s,"input"))+"/$"+v(F(s,"output")),1)):c("",!0),s.context_window?(o(),i("span",Ne,v((a=s.context_window,a>=1e6?`${(a/1e6).toFixed(1)}M`:a>=1e3?`${(a/1e3).toFixed(0)}K`:a.toString()))+" context ",1)):c("",!0)])]),r("div",Pe,[r("div",{class:b(["checkbox",{checked:e.selectedModels.includes(s.id)}])},[e.selectedModels.includes(s.id)?(o(),i("span",Be,"‚úì")):c("",!0)],2)])],10,je);var a}),128))])):c("",!0)]))),128))]),e.selectedModels.length>0&&e.design?(o(),i("div",qe,[s[14]||(s[14]=r("h4",null,"Cost Estimate",-1)),r("div",Ge,[r("div",ze,[r("div",Ke,[s[9]||(s[9]=r("span",{class:"label"},"Variable combinations:",-1)),r("span",He,v(M.value.toLocaleString()),1)]),r("div",We,[s[10]||(s[10]=r("span",{class:"label"},"Selected models:",-1)),r("span",Ze,v(e.selectedModels.length),1)]),r("div",Ye,[s[11]||(s[11]=r("span",{class:"label"},"Total tasks:",-1)),r("span",Je,v(I.value.toLocaleString()),1)]),r("div",Qe,[s[12]||(s[12]=r("span",{class:"label"},"Estimated cost:",-1)),r("span",Xe,"$"+v(A.value.toFixed(3)),1)])]),r("div",es,[r("table",ss,[s[13]||(s[13]=r("thead",null,[r("tr",null,[r("th",null,"Model"),r("th",null,"Input Tokens"),r("th",null,"Output Tokens"),r("th",null,"Cost per Task"),r("th",null,"Total Cost")])],-1)),r("tbody",null,[(o(!0),i(u,null,d(E.value,e=>(o(),i("tr",{key:e.model},[r("td",null,v(e.model),1),r("td",null,v(e.inputTokens),1),r("td",null,v(e.outputTokens),1),r("td",null,"$"+v(e.costPerTask.toFixed(4)),1),r("td",null,"$"+v(e.totalCost.toFixed(3)),1)]))),128))])])])])])):c("",!0),e.design?(o(),i("div",ts,[r("div",as,[s[18]||(s[18]=r("h4",null,"Task Estimate",-1)),r("div",ls,[r("div",ns,[s[15]||(s[15]=r("span",{class:"label"},"Variable combinations:",-1)),r("span",is,v(M.value),1)]),r("div",os,[s[16]||(s[16]=r("span",{class:"label"},"Selected models:",-1)),r("span",rs,v(e.selectedModels.length),1)]),r("div",cs,[s[17]||(s[17]=r("span",{class:"label"},"Total tasks:",-1)),r("span",us,v(I.value),1)])])])])):c("",!0)]))}}),[["__scopeId","data-v-14d174de"]]),vs={class:"review-step"},ps={class:"review-sections"},ms={class:"review-section"},gs={class:"summary-grid"},bs={class:"summary-card"},fs={class:"summary-card"},hs={class:"summary-card"},ks={class:"summary-card tokens"},ys={class:"summary-card cost"},_s={key:0},Cs={key:1},ws={key:0,class:"review-section"},Ds={class:"cost-breakdown"},xs={class:"model-name"},Ms={class:"task-count"},$s={class:"model-cost"},Is={key:1,class:"review-section"},Ts={class:"variables-compact"},Ss={class:"var-name"},Os={class:"var-values"},As={class:"var-name"},Ls={class:"var-values"},Rs={class:"review-section"},Es={class:"config-summary"},js={class:"config-grid"},Us={class:"config-item"},Fs={class:"config-value"},Vs={class:"config-description"},Ns={class:"config-item"},Ps={class:"config-value"},Bs={class:"config-description"},qs={class:"config-item"},Gs={class:"config-value"},zs={class:"config-description"},Ks={class:"review-section"},Hs={class:"models-summary"},Ws={class:"models-by-provider"},Zs={class:"provider-models"},Ys={class:"model-name"},Js={class:"model-details"},Qs={key:0,class:"cost-info"},Xs={key:1,class:"cost-info"},et={key:2,class:"context-info"},st={key:2,class:"review-section"},tt={key:0,class:"warnings"},at={key:1,class:"recommendations"},lt=M(t({__name:"RunReviewStep",props:{formData:{},selectedDesign:{},selectedModels:{},taskCount:{},estimatedCost:{}},setup(e){const s=e,t=S(),p=l(()=>{if(!s.selectedDesign)return 0;return Object.keys(s.selectedDesign.variables||{}).length+Object.keys(s.selectedDesign.variable_list_refs||{}).length}),m=a(1),g=a(null);n(()=>[s.selectedDesign,t.variableLists],async()=>{if(s.selectedDesign)try{g.value=null;const e=L.getInstance(),a=await e.calculateExperimentMetrics(s.selectedDesign,t.variableLists);m.value=a.totalCombinations}catch(e){g.value=`Calculation error: ${e instanceof Error?e.message:"Unknown error"}`,m.value=1}else m.value=1},{immediate:!0,deep:!0});const b=e=>{const s="string"==typeof e?parseInt(e):e,a=t.variableLists.find(e=>e.id===s);return a?.values?.length||0},f=l(()=>{if(!s.selectedDesign)return{input:0,output:0};const e=s.selectedDesign.variables||{},t={};for(const[s,i]of Object.entries(e))t[s]=Array.isArray(i)?i[0]:i;const a=O(s.selectedDesign.prompt_template,t),l=s.formData.parameters.max_tokens,n=m.value*s.selectedModels.length;return{input:a*n,output:l*n}}),h=l(()=>{if(!s.selectedDesign)return[];const e=s.selectedDesign.variables||{},t={};for(const[s,n]of Object.entries(e))t[s]=Array.isArray(n)?n[0]:n;const a=O(s.selectedDesign.prompt_template,t),l=s.formData.parameters.max_tokens;return s.selectedModels.filter(e=>void 0!==e.input_cost&&void 0!==e.output_cost).map(e=>{const s=m.value,t="openrouter"===e.provider?e.input_cost:e.input_cost/1e6,n="openrouter"===e.provider?e.output_cost:e.output_cost/1e6,i=(t*a+n*l)*s;return{name:e.name,tasks:s,cost:i,inputTokens:a,outputTokens:l}}).sort((e,s)=>s.cost-e.cost)}),k=l(()=>{const e={};return s.selectedModels.forEach(s=>{e[s.provider]||(e[s.provider]=[]),e[s.provider].push(s)}),e}),y=l(()=>{const e=[];s.taskCount>1e3&&e.push(`Large run with ${s.taskCount} tasks will take significant time to complete`),s.estimatedCost>10&&e.push(`Estimated cost of $${s.estimatedCost.toFixed(2)} is quite high`);const t=s.selectedModels.filter(e=>void 0===e.input_cost||void 0===e.output_cost);return t.length>0&&e.push(`Cost data unavailable for ${t.length} model${t.length>1?"s":""}`),s.formData.parameters.concurrency>5&&s.selectedModels.some(e=>e.provider.includes("OpenAI"))&&e.push("High concurrency with OpenAI models may hit rate limits"),e}),_=l(()=>{const e=[];return s.taskCount>100&&1===s.formData.parameters.concurrency&&e.push("Consider increasing concurrency to speed up large runs"),s.formData.parameters.temperature>1.5&&e.push("Very high temperature may produce inconsistent results"),1===s.selectedModels.length&&e.push("Consider testing with multiple models for comparison"),e}),C=e=>void 0===e?"?":0===e?"0":e<1e-5?e.toExponential(2):e<.001?e.toFixed(6):e<.01?e.toFixed(4):e.toFixed(3),w=e=>e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toString();return(e,s)=>{return o(),i("div",vs,[s[14]||(s[14]=r("div",{class:"step-header"},[r("h3",null,"Review")],-1)),r("div",ps,[r("div",ms,[r("div",gs,[r("div",bs,[r("h4",null,v(e.taskCount),1),s[0]||(s[0]=r("span",null,"Total Tasks",-1))]),r("div",fs,[r("h4",null,v(m.value),1),s[1]||(s[1]=r("span",null,"Variable Combinations",-1))]),r("div",hs,[r("h4",null,v(e.selectedModels.length),1),s[2]||(s[2]=r("span",null,"Models",-1))]),r("div",ks,[r("h4",null,v(w(f.value.input))+" / "+v(w(f.value.output)),1),s[3]||(s[3]=r("span",null,"Input / Output Tokens",-1))]),r("div",ys,[e.estimatedCost>0?(o(),i("h4",_s," $"+v(e.estimatedCost.toFixed(4)),1)):(o(),i("h4",Cs," Unknown ")),s[4]||(s[4]=r("span",null,"Est. Cost",-1))])])]),h.value.length>0?(o(),i("div",ws,[s[5]||(s[5]=r("h4",null,"Cost by Model",-1)),r("div",Ds,[(o(!0),i(u,null,d(h.value,e=>(o(),i("div",{key:e.name,class:"cost-item"},[r("span",xs,v(e.name),1),r("span",Ms,v(e.tasks)+" tasks √ó "+v(e.inputTokens)+"+"+v(e.outputTokens)+" tokens",1),r("span",$s,"$"+v(e.cost.toFixed(4)),1)]))),128))])])):c("",!0),e.selectedDesign&&(e.selectedDesign.variables||e.selectedDesign.variable_list_refs)?(o(),i("div",Is,[r("h4",null,"Variables ("+v(p.value)+")",1),r("div",Ts,[(o(!0),i(u,null,d(e.selectedDesign.variables||{},(e,s)=>(o(),i("div",{key:s,class:"variable-item"},[r("span",Ss,v(s)+":",1),r("span",Os,v(Array.isArray(e)?e.length:1)+" values",1)]))),128)),(o(!0),i(u,null,d(e.selectedDesign.variable_list_refs||{},(e,s)=>(o(),i("div",{key:`list_${s}`,class:"variable-item"},[r("span",As,v(s)+":",1),r("span",Ls,v(b(e))+" values",1)]))),128))])])):c("",!0),r("div",Rs,[s[9]||(s[9]=r("div",{class:"section-header"},[r("h4",null,"Configuration")],-1)),r("div",Es,[r("div",js,[r("div",Us,[s[6]||(s[6]=r("span",{class:"config-label"},"Temperature:",-1)),r("span",Fs,v(e.formData.parameters.temperature),1),r("span",Vs,v((l=e.formData.parameters.temperature,l<=.2?"Very deterministic":l<=.5?"Focused responses":l<=.8?"Balanced creativity":l<=1.2?"Creative responses":"Highly variable")),1)]),r("div",Ns,[s[7]||(s[7]=r("span",{class:"config-label"},"Max Tokens:",-1)),r("span",Ps,v(e.formData.parameters.max_tokens),1),r("span",Bs,v((a=e.formData.parameters.max_tokens,a<=200?"Brief answers":a<=500?"Short responses":a<=1e3?"Medium length":a<=2e3?"Long responses":"Very detailed")),1)]),r("div",qs,[s[8]||(s[8]=r("span",{class:"config-label"},"Concurrency:",-1)),r("span",Gs,v(e.formData.parameters.concurrency),1),r("span",zs,v((t=e.formData.parameters.concurrency,t<=2?"Conservative pace":t<=4?"Balanced speed":t<=6?"Fast execution":"Maximum speed")),1)])])])]),r("div",Ks,[s[10]||(s[10]=r("div",{class:"section-header"},[r("h4",null,"Selected Models")],-1)),r("div",Hs,[r("div",Ws,[(o(!0),i(u,null,d(k.value,(e,s)=>(o(),i("div",{key:s,class:"provider-group"},[r("h5",null,v(s),1),r("div",Zs,[(o(!0),i(u,null,d(e,e=>{return o(),i("div",{key:e.id,class:"model-summary-item"},[r("span",Ys,v(e.name),1),r("div",Js,[void 0!==e.input_cost&&void 0!==e.output_cost?(o(),i("span",Qs," $"+v(C(e.input_cost))+"/$"+v(C(e.output_cost)),1)):(o(),i("span",Xs," Cost N/A ")),e.context_window?(o(),i("span",et,v((s=e.context_window,s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(0)}K`:s.toString()))+" ctx ",1)):c("",!0)])]);var s}),128))])]))),128))])])]),y.value.length>0||_.value.length>0?(o(),i("div",st,[s[13]||(s[13]=r("div",{class:"section-header"},[r("h4",null,"Recommendations")],-1)),y.value.length>0?(o(),i("div",tt,[s[11]||(s[11]=r("h5",null,"‚ö†Ô∏è Warnings",-1)),r("ul",null,[(o(!0),i(u,null,d(y.value,e=>(o(),i("li",{key:e},v(e),1))),128))])])):c("",!0),_.value.length>0?(o(),i("div",at,[s[12]||(s[12]=r("h5",null,"üí° Recommendations",-1)),r("ul",null,[(o(!0),i(u,null,d(_.value,e=>(o(),i("li",{key:e},v(e),1))),128))])])):c("",!0)])):c("",!0)])]);var t,a,l}}}),[["__scopeId","data-v-f369d3db"]]),nt={class:"wizard-modal"},it={class:"wizard-header"},ot={class:"header-left"},rt={class:"progress-steps"},ct={class:"step-circle"},ut={class:"step-label"},dt={class:"wizard-content"},vt={class:"step-content"},pt={class:"wizard-footer"},mt={class:"footer-buttons"},gt=["disabled"],bt={class:"primary-actions"},ft=["disabled"],ht=["disabled"],kt=M(t({__name:"RunCreationWizard",props:{run:{},preselectedModelIds:{},preselectedDesignId:{}},emits:["close","saved"],setup(e,{emit:s}){const t=e,m=s,g=$(),k=I(),y=T(),_=S(),C=a(0),w=[{id:"basics",title:"Basics"},{id:"models",title:"Models & Configuration"},{id:"review",title:"Review"}],D=a({name:"",design_id:null,models:[],parameters:{temperature:.7,max_tokens:25,concurrency:3,repetitions_per_prompt:1}}),x=l(()=>g.designs),M=l(()=>k.enabledModels),A=l(()=>D.value.design_id&&x.value.find(e=>e.id===D.value.design_id)||null),R=l(()=>M.value.filter(e=>D.value.models.includes(e.id))),E=a(0),j=a(null);n(()=>[A.value,R.value,D.value.parameters.repetitions_per_prompt,_.variableLists],async()=>{if(console.log("=== COMPUTING TASK COUNT ==="),console.log("selectedDesign.value:",!!A.value),console.log("selectedModels.value.length:",R.value.length),!A.value||0===R.value.length)return console.log("Returning 0 because no design or no models selected"),void(E.value=0);try{j.value=null;const e=A.value.variables||{},s=A.value.variable_list_refs||{};console.log("=== TASK COUNT CALCULATION ==="),console.log("Selected Design:",A.value),console.log("Design name:",A.value.name),console.log("Design variables:",e),console.log("Design variable_list_refs:",s),console.log("Variable keys:",Object.keys(e)),console.log("Variable list ref keys:",Object.keys(s)),console.log("Available variable lists in store:",_.variableLists),console.log("Store lists with details:",_.variableLists.map(e=>({id:e.id,name:e.name,valueCount:e.values?.length,hasValues:!!e.values,firstFewValues:e.values?.slice(0,3)})));const t=L.getInstance(),a=await t.calculateExperimentMetrics(A.value,_.variableLists);console.log("Service calculation result:",a);for(const[n,i]of Object.entries(e))Array.isArray(i)&&console.log(`Simple variable ${n}: ${i.length} values`);for(const[n,i]of Object.entries(s)){const e=_.variableLists.find(e=>e.id===i);e&&e.values?console.log(`Compound variable ${n}: ${e.values.length} values from list ${e.name}`):console.log(`Compound variable ${n}: list ${i} not found or has no values`)}const l=a.totalCombinations*R.value.length*D.value.parameters.repetitions_per_prompt;console.log(`Total task count: ${a.totalCombinations} combinations √ó ${R.value.length} models √ó ${D.value.parameters.repetitions_per_prompt} repetitions = ${l}`),E.value=l}catch(e){j.value=`Task count calculation error: ${e instanceof Error?e.message:"Unknown error"}`,E.value=0,console.error("Task count calculation failed:",e)}},{immediate:!0,deep:!0});const U=l(()=>{if(!A.value||0===R.value.length)return 0;const e=A.value.variables||{},s=A.value.variable_list_refs||{};let t=1;for(const[o,r]of Object.entries(e))Array.isArray(r)?t*=r.length:r&&(t*=1);for(const[o,r]of Object.entries(s)){const e=_.variableLists.find(e=>e.id===r);e&&e.values&&(t*=e.values.length)}if(1===t&&0===Object.keys(e).length&&0===Object.keys(s).length)return 0;const a={};for(const[o,r]of Object.entries(e))a[o]=Array.isArray(r)?r[0]:r;const l=O(A.value.prompt_template,a),n=D.value.parameters.max_tokens;let i=0;for(const o of R.value)if(void 0!==o.input_cost&&void 0!==o.output_cost){i+=(("openrouter"===o.provider?o.input_cost:o.input_cost/1e6)*l+("openrouter"===o.provider?o.output_cost:o.output_cost/1e6)*n)*t*D.value.parameters.repetitions_per_prompt}return i}),F=l(()=>{switch(C.value){case 0:return!(!D.value.name.trim()||!D.value.design_id);case 1:return D.value.models.length>0;default:return!0}}),V=l(()=>D.value.name.trim()&&D.value.design_id&&D.value.models.length>0);p(async()=>{console.log("üî•üî•üî• RUN CREATION WIZARD MOUNTED üî•üî•üî•"),console.log("Loading data..."),await Promise.all([g.loadDesigns(),k.loadModels(),_.loadVariableLists()]),console.log("‚úÖ Data loaded!"),console.log("Designs:",g.designs),console.log("Variable lists:",_.variableLists),n(()=>D.value.design_id,e=>{if(console.log("üéØ DESIGN ID CHANGED:",e),e){const s=x.value.find(s=>s.id===e);console.log("Selected design:",s),console.log("variable_list_refs:",s?.variable_list_refs),console.log("Forcing taskCount calculation...");const t=E.value;console.log("Task count result:",t)}}),t.run?D.value={name:t.run.name,design_id:t.run.design_id,models:t.run.models||[],parameters:{...t.run.parameters,repetitions_per_prompt:t.run.parameters.repetitions_per_prompt??1}}:(t.preselectedDesignId&&(D.value.design_id=t.preselectedDesignId,D.value.name=await(async e=>{const s=x.value.find(s=>s.id===e);if(!s)return"New Run";await y.loadRuns();const t=y.runs.filter(s=>s.design_id===e).length+1,a=(new Date).toISOString().split("T")[0];return`${s.name} - ${a} #${t}`})(t.preselectedDesignId)),t.preselectedModelIds&&(D.value.models=[...t.preselectedModelIds],t.preselectedDesignId||(C.value=1)))});const N=()=>{C.value<w.length-1&&C.value++},P=()=>{C.value>0&&C.value--},B=async()=>{try{if(!D.value.design_id)return void console.error("Design ID is required");const e={...D.value,design_id:D.value.design_id,status:"draft"};let s;s=t.run?await y.updateRun(t.run.id,e):await y.createRun(e),m("saved",s),m("close")}catch(e){console.error("Error saving run:",e)}};return(e,s)=>(o(),i("div",{class:"modal-overlay",onClick:s[6]||(s[6]=f(s=>e.$emit("close"),["self"]))},[r("div",nt,[r("div",it,[r("div",ot,[r("h3",null,v(e.run?"Edit":"Create")+" Run",1),r("div",rt,[(o(),i(u,null,d(w,(e,s)=>r("div",{key:e.id,class:b(["progress-step",{active:C.value===s,completed:s<C.value}])},[r("div",ct,v(s<C.value?"‚úì":s+1),1),r("span",ut,v(e.title),1)],2)),64))])]),r("button",{class:"close-btn",onClick:s[0]||(s[0]=s=>e.$emit("close"))}," √ó ")]),r("div",dt,[r("div",vt,[0===C.value?(o(),h(de,{key:0,name:D.value.name,"onUpdate:name":s[1]||(s[1]=e=>D.value.name=e),"design-id":D.value.design_id,"onUpdate:designId":s[2]||(s[2]=e=>D.value.design_id=e),designs:x.value,"selected-design":A.value},null,8,["name","design-id","designs","selected-design"])):c("",!0),1===C.value?(o(),h(ds,{key:1,"selected-models":D.value.models,"onUpdate:selectedModels":s[3]||(s[3]=e=>D.value.models=e),parameters:D.value.parameters,"onUpdate:parameters":s[4]||(s[4]=e=>D.value.parameters=e),"all-models":M.value,design:A.value,"task-count":E.value},null,8,["selected-models","parameters","all-models","design","task-count"])):c("",!0),2===C.value?(o(),h(lt,{key:2,"form-data":D.value,"selected-design":A.value,"selected-models":R.value,"task-count":E.value,"estimated-cost":U.value},null,8,["form-data","selected-design","selected-models","task-count","estimated-cost"])):c("",!0)])]),r("div",pt,[r("div",mt,[r("button",{class:"btn btn-secondary",disabled:0===C.value,onClick:P}," Back ",8,gt),r("div",bt,[r("button",{class:"btn btn-outline",onClick:s[5]||(s[5]=s=>e.$emit("close"))}," Cancel "),C.value<w.length-1?(o(),i("button",{key:0,class:"btn btn-primary",disabled:!F.value,onClick:N}," Next ",8,ft)):(o(),i("button",{key:1,class:"btn btn-primary",disabled:!V.value,onClick:B},v(e.run?"Update Run":"Create Run"),9,ht))])])])])]))}}),[["__scopeId","data-v-d4602b91"]]),yt=t({__name:"RunEditorModal",props:{run:{},preselectedModelIds:{},preselectedDesignId:{}},emits:["close","saved"],setup:e=>(e,s)=>(o(),h(kt,{run:e.run,"preselected-model-ids":e.preselectedModelIds,"preselected-design-id":e.preselectedDesignId,onClose:s[0]||(s[0]=s=>e.$emit("close")),onSaved:s[1]||(s[1]=s=>e.$emit("saved",s))},null,8,["run","preselected-model-ids","preselected-design-id"]))}),_t={class:"runs-view"},Ct={class:"header"},wt={key:0,class:"loading"},Dt={key:1,class:"empty-state"},xt={key:2,class:"runs-container"},Mt={class:"sort-controls"},$t={class:"runs-table"},It={class:"run-main"},Tt={class:"run-info"},St={class:"run-header"},Ot={class:"run-name"},At={class:"run-meta"},Lt={key:0},Rt={class:"run-actions"},Et=["onClick"],jt=["onClick"],Ut=["onClick"],Ft=["onClick"],Vt=["onClick"],Nt=["onClick"],Pt=M(t({__name:"RunsView",setup(e){const s=k(),t=y(),n=T(),{runs:g,loading:f}=_(n),x=a(!1),M=a(null),$=a("updated_at"),I=a("desc"),S=l(()=>[...g.value].sort((e,s)=>{let t,a;switch($.value){case"name":t=e.name.toLowerCase(),a=s.name.toLowerCase();break;case"created_at":t=new Date(e.created_at||0).getTime(),a=new Date(s.created_at||0).getTime();break;case"updated_at":t=new Date(e.updated_at||e.created_at||0).getTime(),a=new Date(s.updated_at||s.created_at||0).getTime();break;case"status":const l={pending:0,running:1,completed:2,failed:3};t=l[e.status]??999,a=l[s.status]??999;break;default:return 0}return t<a?"asc"===I.value?-1:1:t>a?"asc"===I.value?1:-1:0})),O=l(()=>{const e=t.query.create;return e?parseInt(e):null});async function A(e){if(M.value)await n.updateRun(M.value.id,e);else{const t=await n.createRun(e);await n.startRun(t.id),s.push("/active")}L()}function L(){x.value=!1,M.value=null,t.query.create&&("designs"===t.query.from?s.push({name:"designs"}):s.replace({name:"runs"}))}function R(){}function E(){I.value="asc"===I.value?"desc":"asc"}function j(e){return e?new Date(e).toLocaleDateString():"N/A"}return p(()=>{n.loadRuns(),O.value&&(x.value=!0)}),(e,t)=>(o(),i("div",_t,[r("div",Ct,[t[3]||(t[3]=r("h2",null,"Runs",-1)),r("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=e=>x.value=!0)}," Create Run ")]),C(f)?(o(),i("div",wt," Loading runs... ")):0===C(g).length?(o(),i("div",Dt,[t[4]||(t[4]=r("p",null,"No runs created yet",-1)),r("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=e=>x.value=!0)}," Create your first run ")])):(o(),i("div",xt,[r("div",Mt,[t[6]||(t[6]=r("label",null,"Sort by:",-1)),m(r("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>$.value=e),onChange:R},t[5]||(t[5]=[r("option",{value:"updated_at"}," Last Updated ",-1),r("option",{value:"name"}," Name ",-1),r("option",{value:"created_at"}," Created Date ",-1),r("option",{value:"status"}," Status ",-1)]),544),[[w,$.value]]),r("button",{class:"sort-toggle",onClick:E},v("desc"===I.value?"‚Üì":"‚Üë"),1)]),r("div",$t,[(o(!0),i(u,null,d(S.value,e=>(o(),i("div",{key:e.id,class:"run-row"},[r("div",It,[r("div",Tt,[r("div",St,[r("h3",Ot,v(e.name),1),r("span",{class:b(["run-status",`status-${e.status}`])},v(e.status),3)]),r("p",At,[D(v(e.total_tasks||0)+" tasks ("+v(e.completed_tasks||0)+" completed) ‚Ä¢ Created "+v(j(e.created_at))+" ",1),e.updated_at&&e.updated_at!==e.created_at?(o(),i("span",Lt," ‚Ä¢ Updated "+v(j(e.updated_at)),1)):c("",!0)])]),r("div",Rt,["pending"===e.status?(o(),i("button",{key:0,class:"btn btn-primary btn-small",onClick:t=>async function(e){await n.startRun(e.id),s.push("/active")}(e)}," Start ",8,Et)):c("",!0),"running"===e.status?(o(),i("button",{key:1,class:"btn btn-danger btn-small",onClick:s=>async function(e){await n.stopRun(e.id)}(e)}," Stop ",8,jt)):c("",!0),r("button",{class:"btn btn-secondary btn-small",onClick:t=>function(e){s.push(`/results/${e.id}`)}(e)}," Results ",8,Ut),r("button",{class:"btn btn-secondary btn-small",onClick:s=>async function(e){if(e.id){const s=await n.getRunById(e.id);M.value=s||e}else M.value=e}(e)}," Edit ",8,Ft),r("button",{class:"btn btn-secondary btn-small",onClick:s=>function(e){const s={version:"1.0",exportDate:(new Date).toISOString(),run:e},t=JSON.stringify(s,null,2),a=new Blob([t],{type:"application/json"}),l=URL.createObjectURL(a),n=document.createElement("a");n.href=l,n.download=`run_${e.name.replace(/[^a-zA-Z0-9]/g,"_")}_${(new Date).toISOString().split("T")[0]}.json`,n.click(),URL.revokeObjectURL(l)}(e)}," Export ",8,Vt),r("button",{class:"btn btn-danger btn-small",onClick:s=>async function(e){confirm(`Delete run "${e.name}"? This action cannot be undone.`)&&await n.deleteRun(e.id)}(e)}," Delete ",8,Nt)])])]))),128))])])),x.value||M.value?(o(),h(yt,{key:3,run:M.value||void 0,"preselected-design-id":O.value||void 0,onSaved:A,onClose:L},null,8,["run","preselected-design-id"])):c("",!0)]))}}),[["__scopeId","data-v-544f9eaf"]]);export{Pt as default};
