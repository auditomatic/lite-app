const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C_Jm4ddV.js","assets/index-C4rYxeWH.css"])))=>i.map(i=>d[i]);
import{e as i,I as _t,d as P,ap as Fe,r as b,c as W,p as bt,f as ce,u as Ue,a as x,h,j as c,i as e,A as j,ac as se,B as f,G as y,F as Y,C as ae,aj as ne,y as M,v as G,x as r,z as $,k as ve,H as ht,t as ze,_ as Be,W as Ne,ao as kt,s as xe,aq as wt,ar as Ct,a4 as Mt,o as Ot,as as $t,N as Pt,at as Dt,au as Le,av as Re,L as At,aw as Et,am as St,Q as xt}from"./index-C_Jm4ddV.js";import{u as Te}from"./useV4Models-BDI7fbnD.js";import{u as je}from"./useV4ProviderParameters-B4iiG92E.js";import{O as Lt}from"./OllamaModelManagerV3-Cj4aU2lm.js";import{S as Rt}from"./SaveOutlined-5PUV0Z_y.js";import{detectOllamaIssue as Vt}from"./ollama-fetch-Cp0SojOC.js";import{U as Ft}from"./UnorderedListOutlined-SuS5LTrv.js";import"./useV4LiveQuery-DYWEk8w6.js";import"./FilterOutlined-Cq2JyzlU.js";var Ut={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};function Ve(A){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?Object(arguments[n]):{},l=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(o).filter(function(p){return Object.getOwnPropertyDescriptor(o,p).enumerable}))),l.forEach(function(p){zt(A,p,o[p])})}return A}function zt(A,n,o){return n in A?Object.defineProperty(A,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):A[n]=o,A}var be=function(n,o){var l=Ve({},n,o.attrs);return i(_t,Ve({},l,{icon:Ut}),null)};be.displayName="UploadOutlined";be.inheritAttrs=!1;class Bt{async bulkWrite(n,o,l="put"){o.length!==0&&await P.transaction("rw",P[n],async()=>{switch(l){case"put":await P[n].bulkPut(o);break;case"add":await P[n].bulkAdd(o);break;case"update":const p=o.map(_=>P[n].update(_.id,_));await Promise.all(p);break}})}async bulkDelete(n,o){o.length!==0&&await P.transaction("rw",P[n],async()=>{await P[n].bulkDelete(o)})}async conditionalBulkUpdate(n,o,l){let p=0;return await P.transaction("rw",P[n],async()=>{await P[n].toCollection().modify(_=>{o(_)&&(Object.assign(_,l),p++)})}),p}freezeDeep(n){const o=n.map(l=>Object.freeze(l));return Object.freeze(o)}async getAndFreeze(n,o){const l=await P[n].get(o);return l?Object.freeze(l):null}async getAllAndFreeze(n){const o=await P[n].toArray();return this.freezeDeep(o)}}const ue=new Bt;class Nt{async bulkUpsertModels(n){n.length!==0&&await P.transaction("rw",P.models,async()=>{const o=n.map(l=>Object.freeze({...l,enabled:l.enabled??!1,available:l.available??!0}));await P.models.bulkPut(o)})}async clearProviderModels(n){return await P.transaction("rw",P.models,async()=>{const p=(await P.models.where("provider").equals(n).toArray()).map(_=>_.id);return p.length>0&&await P.models.bulkDelete(p),p.length})}async toggleModelEnabled(n,o){return await P.models.update(n,{enabled:o})===1}async toggleProviderModels(n,o){return await ue.conditionalBulkUpdate("models",l=>l.provider===n,{enabled:o})}async toggleAllModels(n){return await ue.conditionalBulkUpdate("models",()=>!0,{enabled:n})}async getModelStatistics(){const n=await P.models.toArray(),o={total:n.length,enabled:0,byProvider:{}};for(const l of n)l.enabled&&o.enabled++,o.byProvider[l.provider]||(o.byProvider[l.provider]={total:0,enabled:0}),o.byProvider[l.provider].total++,l.enabled&&o.byProvider[l.provider].enabled++;return Object.freeze(o)}async updateModelAvailability(n,o){return await ue.conditionalBulkUpdate("models",l=>l.provider===n,{available:o})}async searchModels(n){let o=P.models.toCollection();if(n.provider&&(o=P.models.where("provider").equals(n.provider)),n.enabled!==void 0&&(o=o.and(p=>p.enabled===n.enabled)),n.available!==void 0&&(o=o.and(p=>p.available===n.available)),n.search){const p=n.search.toLowerCase();o=o.and(_=>_.displayName.toLowerCase().includes(p)||_.modelId.toLowerCase().includes(p))}const l=await o.toArray();return ue.freezeDeep(l)}async clearAllModels(){await P.models.clear()}}const Tt=new Nt;function jt(){const A=Fe(),n=b(!1),o=b(null),l=b(!1),p=b(!1);async function _(g,v){n.value=!0,v&&(v.value=!0),o.value=null;try{return{ok:!0,value:await g()}}catch(s){const S=s instanceof Error?s:new Error(String(s));return o.value=S,{ok:!1,error:S}}finally{n.value=!1,v&&(v.value=!1)}}async function N(g){return _(()=>A.discoverModels(g),l)}async function U(g){return _(()=>A.refreshModelSource(g),l)}async function E(g,v){return _(async()=>{await A.toggleModel(g,v)},p)}async function C(g){return _(async()=>{await A.toggleAllModels(g)},p)}async function d(g,v){return _(async()=>{await A.toggleProviderModels(g,v)},p)}async function V(){return _(async()=>{await A.enableOpenRouterFavorites()},p)}async function D(){return _(async()=>{await A.clearAllModels()})}async function u(g,v){return _(async()=>{await Tt.updateModelAvailability(g,v)})}return{discoverModels:N,refreshDiscoverySource:U,toggleModel:E,toggleAllModels:C,toggleProviderModels:d,enableOpenRouterFavorites:V,clearAllModels:D,updateModelAvailability:u,isExecuting:n,lastError:o,isDiscovering:l,isTogglingModels:p}}function Ge(){const A=Fe(),n=b([]),o=b(!1),l=b([]);function p(){const U=A.getDiscoveryStatus();n.value=U.map(E=>({id:E.id,status:E.status==="loading"?"loading":E.status==="idle"?"success":E.status,modelCount:E.modelCount,error:E.error})),o.value=A.isDiscovering(),l.value=A.getDiscoveryErrors()}function _(U){return{litellm:"LiteLLM",openrouter:"OpenRouter",ollama:"Ollama",deterministic:"Deterministic"}[U]||U}function N(U){const E=bt.getProvider(U);return(E==null?void 0:E.name)||U}return p(),{discoveryStatus:W(()=>n.value),isDiscovering:W(()=>o.value),discoveryErrors:W(()=>l.value),getSourceDisplayName:_,getProviderDisplayName:N,refreshStatus:p}}const Gt={class:"model-list"},It={class:"model-header"},Kt={class:"model-table"},Wt=["onClick"],Ht={class:"model-name"},qt={class:"model-source"},Jt={class:"model-context"},Qt={key:0},Xt={key:1,class:"text-secondary"},Yt={key:0,class:"model-cost-in"},Zt={key:0,class:"cost-value"},es={key:1,class:"text-secondary"},ts={key:1,class:"model-cost-out"},ss={key:0,class:"cost-value"},as={key:1,class:"text-secondary"},os={class:"model-enviro-carbon"},ls={class:"enviro-value"},ns={class:"model-enviro-water"},rs={class:"enviro-value"},is={class:"model-enviro-energy"},ds={class:"enviro-value"},us=ce({__name:"ModelListV3",props:{models:{},providerId:{}},emits:["toggle-model"],setup(A){const n=A,o=Ue(),l=b("name"),p=b("asc"),_=W(()=>{if(!n.models||n.models.length===0)return[];const C=n.models.filter(D=>{var u,g;return((u=D.capabilities)==null?void 0:u.inputCostPerToken)||((g=D.capabilities)==null?void 0:g.outputCostPerToken)});return C.length>0?x.info("MODEL_LIST_DEBUG: Models with pricing:",C.map(D=>{var u,g;return{id:D.id,provider:D.provider,modelId:D.modelId,inputCost:(u=D.capabilities)==null?void 0:u.inputCostPerToken,outputCost:(g=D.capabilities)==null?void 0:g.outputCostPerToken}})):x.info("MODEL_LIST_DEBUG: No models have pricing data. Sample model:",n.models[0]),[...n.models].sort((D,u)=>{var v,s,S,F,I,K;let g=0;switch(l.value){case"enabled":g=(D.enabled?1:0)-(u.enabled?1:0);break;case"name":g=D.displayName.localeCompare(u.displayName);break;case"source":g=(D.source||"").localeCompare(u.source||"");break;case"context":const J=((v=D.capabilities)==null?void 0:v.contextWindow)||0,H=((s=u.capabilities)==null?void 0:s.contextWindow)||0;g=J-H;break;case"inputCost":const B=((S=D.capabilities)==null?void 0:S.inputCostPerToken)||0,L=((F=u.capabilities)==null?void 0:F.inputCostPerToken)||0;g=B-L;break;case"outputCost":const Q=((I=D.capabilities)==null?void 0:I.outputCostPerToken)||0,ee=((K=u.capabilities)==null?void 0:K.outputCostPerToken)||0;g=Q-ee;break}return p.value==="asc"?g:-g})});function N(C){l.value===C?p.value=p.value==="asc"?"desc":"asc":(l.value=C,p.value="asc")}function U(C){return C>=1e6?(C/1e6).toFixed(1)+"M":C>=1e3?(C/1e3).toFixed(0)+"K":C.toString()}function E(C){if(!C||C===0)return"0.00";const d=C*1e6;return d<.01?d.toFixed(4):d<1?d.toFixed(3):d<10?d.toFixed(2):d<100?d.toFixed(1):d.toFixed(0)}return(C,d)=>{const V=M("a-switch"),D=M("a-tag");return c(),h("div",Gt,[e("div",It,[e("div",{class:"header-switch sortable",onClick:d[0]||(d[0]=u=>N("enabled"))},[d[7]||(d[7]=e("span",null,"Enabled",-1)),e("span",{class:se(["sort-indicator",{active:l.value==="enabled"}])},f(l.value==="enabled"&&p.value==="asc"?"▲":"▼"),3)]),e("div",{class:"header-name sortable",onClick:d[1]||(d[1]=u=>N("name"))},[d[8]||(d[8]=e("span",null,"Model",-1)),e("span",{class:se(["sort-indicator",{active:l.value==="name"}])},f(l.value==="name"&&p.value==="asc"?"▲":"▼"),3)]),e("div",{class:"header-source sortable",onClick:d[2]||(d[2]=u=>N("source"))},[d[9]||(d[9]=e("span",null,"Source",-1)),e("span",{class:se(["sort-indicator",{active:l.value==="source"}])},f(l.value==="source"&&p.value==="asc"?"▲":"▼"),3)]),e("div",{class:"header-context sortable",onClick:d[3]||(d[3]=u=>N("context"))},[d[10]||(d[10]=e("span",null,"Context",-1)),e("span",{class:se(["sort-indicator",{active:l.value==="context"}])},f(l.value==="context"&&p.value==="asc"?"▲":"▼"),3)]),y(o).showFinancialCosts.value?(c(),h("div",{key:0,class:"header-cost-in sortable",onClick:d[4]||(d[4]=u=>N("inputCost"))},[d[11]||(d[11]=e("span",null,"Input $/1M",-1)),e("span",{class:se(["sort-indicator",{active:l.value==="inputCost"}])},f(l.value==="inputCost"&&p.value==="asc"?"▲":"▼"),3)])):j("",!0),y(o).showFinancialCosts.value?(c(),h("div",{key:1,class:"header-cost-out sortable",onClick:d[5]||(d[5]=u=>N("outputCost"))},[d[12]||(d[12]=e("span",null,"Output $/1M",-1)),e("span",{class:se(["sort-indicator",{active:l.value==="outputCost"}])},f(l.value==="outputCost"&&p.value==="asc"?"▲":"▼"),3)])):j("",!0),d[13]||(d[13]=e("div",{class:"header-enviro-carbon"},[e("span",null,"CO₂")],-1)),d[14]||(d[14]=e("div",{class:"header-enviro-water"},[e("span",null,"💧")],-1)),d[15]||(d[15]=e("div",{class:"header-enviro-energy"},[e("span",null,"⚡")],-1))]),e("div",Kt,[(c(!0),h(Y,null,ae(_.value,u=>{var g,v,s;return c(),h("div",{key:u.id,class:"model-row",onClick:S=>C.$emit("toggle-model",u.id,!u.enabled)},[e("div",{class:"model-switch",onClick:d[6]||(d[6]=ne(()=>{},["stop"]))},[i(V,{checked:u.enabled,size:"small",onChange:S=>C.$emit("toggle-model",u.id,S),"data-testid":"model-toggle","data-provider":u.provider,"data-model":u.modelId,"aria-label":`${u.enabled?"Disable":"Enable"} model ${u.modelId}`},null,8,["checked","onChange","data-provider","data-model","aria-label"])]),e("div",Ht,[e("code",null,f(u.modelId),1)]),e("div",qt,[u.source?(c(),G(D,{key:0,size:"small",color:"cyan"},{default:r(()=>[$(f(u.source),1)]),_:2},1024)):j("",!0)]),e("div",Jt,[(g=u.capabilities)!=null&&g.contextWindow?(c(),h("span",Qt,f(U(u.capabilities.contextWindow)),1)):(c(),h("span",Xt,"-"))]),y(o).showFinancialCosts.value?(c(),h("div",Yt,[(v=u.capabilities)!=null&&v.inputCostPerToken?(c(),h("span",Zt," $"+f(E(u.capabilities.inputCostPerToken)),1)):(c(),h("span",es,"-"))])):j("",!0),y(o).showFinancialCosts.value?(c(),h("div",ts,[(s=u.capabilities)!=null&&s.outputCostPerToken?(c(),h("span",ss," $"+f(E(u.capabilities.outputCostPerToken)),1)):(c(),h("span",as,"-"))])):j("",!0),e("div",os,[e("span",ls,f(y(o).getEnvironmentalCost(u,"carbon")),1)]),e("div",ns,[e("span",rs,f(y(o).getEnvironmentalCost(u,"water")),1)]),e("div",is,[e("span",ds,f(y(o).getEnvironmentalCost(u,"energy")),1)])],8,Wt)}),128))])])}}}),cs=ve(us,[["__scopeId","data-v-2b840b1b"]]),vs={class:"model-preference-manager"},ps={class:"preferences-section"},ms={class:"action-group"},fs={class:"action-group"},gs={class:"status-grid"},ys={class:"status-item"},_s={class:"status-value"},bs={class:"status-item"},hs={class:"status-value"},ks={class:"status-item"},ws={class:"status-value"},Cs={class:"status-item"},Ms={class:"status-value"},Os={class:"status-item"},$s={class:"status-value"},Ps={class:"status-item"},Ds={class:"status-value"},As={class:"action-group"},Es={class:"provider-grid"},Ss={class:"provider-name"},xs={class:"provider-stats"},Ls={class:"provider-total"},Rs={class:"provider-enabled"},Vs=ce({__name:"ModelPreferenceManagerV3",setup(A){const{models:n,enabledModels:o,modelsByProvider:l}=Te(),{discoveryStatus:p}=Ge(),_=Ue(),{showFinancialCosts:N,showEnvironmentalCosts:U}=_,E=b([]),C=b(!1),d=b(!1),V=b(""),D=b("");async function u(){C.value=!0,V.value="";try{const v=await _.exportModelPreferences();if(v.ok){const s=new Blob([JSON.stringify(v.value,null,2)],{type:"application/json"}),S=URL.createObjectURL(s),F=document.createElement("a");F.href=S,F.download=`model-preferences-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(F),F.click(),document.body.removeChild(F),URL.revokeObjectURL(S),D.value="Model preferences exported successfully!"}else V.value=v.error.message}catch(v){V.value=`Failed to export preferences: ${v instanceof Error?v.message:"Unknown error"}`}finally{C.value=!1}}async function g(v){d.value=!0,V.value="";try{const s=await v.text(),S=JSON.parse(s),F=await _.importModelPreferences(S);F.ok?D.value="Model preferences imported successfully!":V.value=F.error.message}catch(s){s instanceof SyntaxError?V.value="Invalid JSON file format":V.value=`Failed to import preferences: ${s instanceof Error?s.message:"Unknown error"}`}finally{d.value=!1}return!1}return(v,s)=>{const S=M("a-button"),F=M("a-upload"),I=M("a-space"),K=M("a-divider"),J=M("a-alert"),H=M("a-collapse-panel"),B=M("a-collapse");return c(),h("div",vs,[i(B,{activeKey:E.value,"onUpdate:activeKey":s[2]||(s[2]=L=>E.value=L),bordered:!1,class:"preferences-collapse"},{default:r(()=>[i(H,{key:"preferences"},{header:r(()=>s[3]||(s[3]=[e("div",{class:"preferences-header"},[e("strong",null,"🔧 V3 Enhanced Features"),e("span",{class:"preferences-description"},"Advanced model preference management")],-1)])),default:r(()=>{var L,Q,ee;return[e("div",ps,[e("div",ms,[s[6]||(s[6]=e("h5",{class:"action-title"},"Model Preferences",-1)),s[7]||(s[7]=e("p",{class:"action-description"}," Export and import your model enabled/disabled preferences for backup or sharing. ",-1)),i(I,null,{default:r(()=>[i(S,{onClick:u,loading:C.value,type:"primary"},{icon:r(()=>[i(y(ht))]),default:r(()=>[s[4]||(s[4]=$(" Export Preferences "))]),_:1,__:[4]},8,["loading"]),i(F,{"before-upload":g,"show-upload-list":!1,accept:".json"},{default:r(()=>[i(S,{loading:d.value},{icon:r(()=>[i(y(be))]),default:r(()=>[s[5]||(s[5]=$(" Import Preferences "))]),_:1,__:[5]},8,["loading"])]),_:1})]),_:1})]),i(K),e("div",fs,[s[14]||(s[14]=e("h5",{class:"action-title"},"V3 System Information",-1)),s[15]||(s[15]=e("p",{class:"action-description"}," Enhanced V3 backend capabilities and status. ",-1)),e("div",gs,[e("div",ys,[s[8]||(s[8]=e("span",{class:"status-label"},"Total Models:",-1)),e("span",_s,f(((L=y(n))==null?void 0:L.length)||0),1)]),e("div",bs,[s[9]||(s[9]=e("span",{class:"status-label"},"Enabled Models:",-1)),e("span",hs,f(((Q=y(o))==null?void 0:Q.length)||0),1)]),e("div",ks,[s[10]||(s[10]=e("span",{class:"status-label"},"Active Providers:",-1)),e("span",ws,f(Object.keys(y(l)||{}).length),1)]),e("div",Cs,[s[11]||(s[11]=e("span",{class:"status-label"},"Discovery Sources:",-1)),e("span",Ms,f(((ee=y(p))==null?void 0:ee.length)||0),1)]),e("div",Os,[s[12]||(s[12]=e("span",{class:"status-label"},"Cost Display:",-1)),e("span",$s,f(y(N)?"Enabled":"Disabled"),1)]),e("div",Ps,[s[13]||(s[13]=e("span",{class:"status-label"},"Environmental Display:",-1)),e("span",Ds,f(y(U)?"Enabled":"Disabled"),1)])])]),i(K),e("div",As,[s[16]||(s[16]=e("h5",{class:"action-title"},"Provider Status",-1)),s[17]||(s[17]=e("p",{class:"action-description"}," Real-time provider status and model counts. ",-1)),e("div",Es,[(c(!0),h(Y,null,ae(y(l),(O,X)=>(c(),h("div",{key:X,class:"provider-item"},[e("div",Ss,f(y(_).getProviderDisplayName(X)),1),e("div",xs,[e("span",Ls,f(O.length)+" total",1),e("span",Rs,f(O.filter(re=>re.enabled).length)+" enabled",1)])]))),128))])])]),V.value?(c(),G(J,{key:0,type:"error",message:V.value,closable:"",onClose:s[0]||(s[0]=O=>V.value=""),class:"error-alert"},null,8,["message"])):j("",!0),D.value?(c(),G(J,{key:1,type:"success",message:D.value,closable:"",onClose:s[1]||(s[1]=O=>D.value=""),class:"success-alert"},null,8,["message"])):j("",!0)]}),_:1})]),_:1},8,["activeKey"])])}}}),Fs=ve(Vs,[["__scopeId","data-v-f4de1453"]]),Us={key:0,class:"loading-state"},zs={key:1,class:"error-state"},Bs={class:"error-message"},Ns=["onClick"],Ts={class:"list-header"},js={class:"list-info"},Gs={class:"list-name"},Is={class:"list-meta"},Ks={class:"list-actions"},Ws={class:"list-description"},Hs={class:"list-preview"},qs={key:0,class:"more-models"},Js=ce({__name:"ModelListsDropdownV3",props:{currentModels:{},isLoading:{type:Boolean,default:!1}},emits:["apply-list","close"],setup(A,{emit:n}){const o=A,l=n,{getProviderGroup:p}=je(),_=b([]),N=b(!0),U=b(""),E=b(!1),C=b("");ze(async()=>{try{N.value=!0,U.value="";const{getModelListManager:v}=await Be(async()=>{const{getModelListManager:F}=await import("./index-C_Jm4ddV.js").then(I=>I.b6);return{getModelListManager:F}},__vite__mapDeps([0,1])),S=await v().getLists();_.value=S.filter(F=>["openrouter-favorites","cost-efficient","high-performance"].includes(F.id)),x.info("Model lists loaded:",{lists:_.value.length})}catch(v){x.error("Failed to load model lists:",v),U.value="Failed to load model lists"}finally{N.value=!1}});function d(v){return o.currentModels.some(s=>s.modelId!==v.modelId?!1:v.provider?s.provider===v.provider&&s.enabled:v.providerGroup?p(s.provider)===v.providerGroup&&s.enabled:!1)}function V(v){return v.models.slice(0,3)}function D(v){return v.modelId.replace(/^.*\//,"").replace(/-instruct$/,"").replace(/-preview$/,"")}async function u(v){if(!(E.value||o.isLoading))try{E.value=!0,C.value=v,await new Promise(s=>{l("apply-list",v),setTimeout(()=>{s()},2e3)})}catch(s){x.error("Failed to apply list:",s)}finally{E.value=!1,C.value=""}}function g(v){var s;(s=v.domEvent)==null||s.stopPropagation()}return(v,s)=>{const S=M("a-spin"),F=M("a-button"),I=M("a-menu-item"),K=M("a-menu-divider"),J=M("a-tag"),H=M("a-menu");return c(),G(H,{class:"model-lists-menu",onClick:g},{default:r(()=>[N.value?(c(),h("div",Us,[i(S,{size:"small"}),s[0]||(s[0]=e("span",null,"Loading model lists...",-1))])):U.value?(c(),h("div",zs,[e("span",Bs,f(U.value),1)])):(c(),h(Y,{key:2},[s[6]||(s[6]=e("div",{class:"menu-header"},[e("span",null,"Built-in Lists")],-1)),(c(!0),h(Y,null,ae(_.value,B=>(c(),G(I,{key:B.id,class:"list-menu-item"},{default:r(()=>[e("div",{class:"list-item",onClick:L=>u(B.id)},[e("div",Ts,[e("div",js,[e("span",Gs,f(B.name),1),e("span",Is,f(B.models.length)+" models",1)]),e("div",Ks,[i(F,{type:"primary",size:"small",loading:E.value&&C.value===B.id,onClick:ne(L=>u(B.id),["stop"])},{default:r(()=>s[1]||(s[1]=[$(" Apply ")])),_:2,__:[1]},1032,["loading","onClick"])])]),e("div",Ws,f(B.description),1),e("div",Hs,[(c(!0),h(Y,null,ae(V(B),(L,Q)=>(c(),h("span",{key:`${L.provider||L.providerGroup}-${L.modelId}`,class:se(["preview-model",{enabled:d(L)}])},f(D(L))+f(Q<V(B).length-1?", ":""),3))),128)),B.models.length>3?(c(),h("span",qs," +"+f(B.models.length-3)+" more ",1)):j("",!0)])],8,Ns)]),_:2},1024))),128)),i(K),i(I,{disabled:"",class:"future-feature"},{default:r(()=>[i(y(Rt)),s[3]||(s[3]=e("span",null,"Save Current Selection...",-1)),i(J,{color:"blue",size:"small"},{default:r(()=>s[2]||(s[2]=[$("Soon")])),_:1,__:[2]})]),_:1,__:[3]}),i(I,{disabled:"",class:"future-feature"},{default:r(()=>[i(y(Ne)),s[5]||(s[5]=e("span",null,"Manage Lists...",-1)),i(J,{color:"blue",size:"small"},{default:r(()=>s[4]||(s[4]=[$("Soon")])),_:1,__:[4]})]),_:1,__:[5]})],64))]),_:1})}}}),Qs=ve(Js,[["__scopeId","data-v-5706641b"]]),Xs={class:"models-view","data-testid":"page-models"},Ys={class:"page-header"},Zs={key:3,class:"discovery-status-bar"},ea={class:"source-name"},ta=["onClick","data-testid","aria-label"],sa={class:"search-filter-bar"},aa={class:"control-bar"},oa={class:"left-controls"},la={class:"dropdown-item"},na={class:"dropdown-item"},ra={class:"stats"},ia={class:"provider-header"},da={class:"provider-info"},ua={key:1,class:"provider-summary"},ca=ce({__name:"ModelsViewV3",setup(A){const n=xt(),{models:o,modelsByProvider:l,stats:p}=Te(),{getProviderGroup:_,requiresApiKey:N}=je(),{hasApiKey:U}=kt(),{discoverModels:E,refreshDiscoverySource:C,toggleModel:d,toggleAllModels:V,toggleProviderModels:D,clearAllModels:u,isDiscovering:g,isTogglingModels:v}=jt(),{discoveryStatus:s,getSourceDisplayName:S,getProviderDisplayName:F,refreshStatus:I}=Ge(),K=b(""),J=b(""),H=b("all"),B=b(!1),L=b({hideOpenRouterFree:!1,hideOpenRouterAuto:!1}),Q=W(()=>{const a={};return Object.keys(l.value||{}).forEach(t=>{const m=_(t),R=N(t),z=U(m);a[t]={hasKey:z,providerGroup:m,requiresKey:R}}),a}),ee=b(!1),O=b(""),X=b([]),re=b(null),he=b([]),Ie=b(!1),ie=b(null),pe=b(!1);let me=null;const Ke=a=>{me&&clearTimeout(me),me=setTimeout(()=>{J.value=a},300)},fe=W(()=>{const a={};for(const[t,m]of Object.entries(l.value))a[t]=m.filter(R=>R.enabled).length;return a}),te=b([]),de=W(()=>{const a=J.value.toLowerCase(),t={},m=Object.keys(l.value);if(te.value.length===0||m.some(R=>!te.value.includes(R))){const R=te.value.filter(k=>m.includes(k)),z=m.filter(k=>!te.value.includes(k)).sort();te.value=[...R,...z]}for(const R of te.value){const z=l.value[R];if(!z)continue;let k=[...z];a&&(k=k.filter(Z=>Z.displayName.toLowerCase().includes(a)||Z.modelId.toLowerCase().includes(a)||R.toLowerCase().includes(a))),H.value==="enabled"?k=k.filter(Z=>Z.enabled):H.value==="disabled"&&(k=k.filter(Z=>!Z.enabled)),k.length>0&&(t[R]=k)}return t}),We=W(()=>{const a=p.value.total;return x.info("ModelsViewV3 V4 totalCount:",a),a}),He=W(()=>p.value.enabled),qe=W(()=>{var a;return((a=l.value.openrouter)==null?void 0:a.length)>0}),Je=W(()=>K.value?`No models found matching "${K.value}"`:H.value!=="all"?`No ${H.value} models found`:'No models available. Click "Refresh Models" to discover models.'),ge=W(()=>{if(!O.value)return!1;const a=O.value.toLowerCase();return a.includes("ollama")&&(a.includes("failed to fetch")||a.includes("networkerror when attempting to fetch"))&&!a.includes("litellm")&&!a.includes("openrouter")}),Qe=W(()=>{var m,R;const a=((m=l.value["ollama-chat"])==null?void 0:m.length)>0||((R=l.value["ollama-generate"])==null?void 0:R.length)>0,t=s.value.some(z=>z.id==="ollama");return a||t||ge.value}),ye=W(()=>{const a=te.value.length;return X.value.length===a&&a>0}),Xe=xe(wt),Ye=xe(Ct);function Ze(a){return{idle:"default",loading:"processing",success:"success",error:"error"}[a]||"default"}function et(a){return fe.value[a]||0}function tt(a){const t=et(a),m=(l.value[a]||[]).length;return t===0?"default":t===m?"success":"warning"}function st(a){const t=de.value[a]||[];return t.length>0&&t.every(m=>m.enabled)}function at(a){const t=de.value[a]||[];return t.length>0&&t.every(m=>!m.enabled)}function ot(a){n.push({path:"/settings",query:a?{provider:a}:void 0})}function lt(){ye.value?X.value=[]:X.value=[...te.value]}async function nt(a,t){const m=await d(a,t);m.ok||(O.value=m.error.message)}async function ke(a,t){const m=await D(a,t);m.ok||(O.value=m.error.message)}async function rt(){const a=await V(!0);a.ok||(O.value=a.error.message)}async function it(){const a=await V(!1);a.ok||(O.value=a.error.message)}async function _e(){B.value=!0,O.value="";try{x.info("V4 DEBUG: Starting discovery...");const a=await E({forceRefresh:!0});if(x.info("V4 DEBUG: Discovery result:",a),a.ok){x.info("V4 DEBUG: Discovery successful, models found:",a.value.totalModels),x.info("V4 DEBUG: After discovery, models.value.length =",o.value.length);const t=a.value.errors.filter(m=>!(m.includes("ollama")&&m.includes("not detected")));t.length>0&&(O.value=`Some sources failed: ${t.join("; ")}`)}else x.info("V4 DEBUG: Discovery failed:",a.error),O.value=`Discovery failed: ${a.error.message}`;I()}catch(a){x.error("Failed to refresh models",a),O.value="Failed to refresh models. Please check your connection and try again."}finally{B.value=!1}}async function dt(a){var t,m,R,z;re.value=a,O.value="";try{const k=await C(a);a==="ollama"&&(k.ok&&((m=(t=k.value)==null?void 0:t.errors)==null?void 0:m.some(oe=>oe.includes("not detected")))||!k.ok&&((z=(R=k.error)==null?void 0:R.message)==null?void 0:z.includes("not detected")))||(k.ok&&k.value.errors.length>0?O.value=`Failed to refresh ${S(a)}: ${k.value.errors.join("; ")}`:k.ok||(O.value=`Failed to refresh ${S(a)}: ${k.error.message}`)),I()}catch(k){x.error("Failed to retry source",k,{sourceId:a}),O.value=`Failed to refresh ${S(a)}: ${k instanceof Error?k.message:"Unknown error"}`}finally{re.value=null}}async function ut(){try{await C("ollama"),I(),Ce()}catch(a){x.error("Failed to refresh Ollama models after update",a)}}async function we(){x.info("[ModelsView] Saving OpenRouter settings:",L.value),await P.settings.get("main")?(x.info("[ModelsView] Updating existing settings"),await P.settings.update("main",{hideOpenRouterFree:L.value.hideOpenRouterFree,hideOpenRouterAuto:L.value.hideOpenRouterAuto})):(x.info("[ModelsView] Creating new settings"),await P.settings.add({id:"main",version:1,initialized:!0,hideOpenRouterFree:L.value.hideOpenRouterFree,hideOpenRouterAuto:L.value.hideOpenRouterAuto}));const t=await P.settings.get("main");x.info("[ModelsView] Settings after save:",t)}async function Ce(){try{(await Vt()).hasIssue?ie.value="not-detected":ie.value=null}catch{}}async function ct(){if(confirm("This will remove all models and re-discover them from scratch. Any custom model configurations will be lost. Continue?")){ee.value=!0,O.value="";try{const t=await u();if(!t.ok){O.value=t.error.message;return}const m=await E({forceRefresh:!0});if(m.ok&&m.value.errors.length>0){const R=m.value.errors.filter(z=>!(z.includes("ollama")&&z.includes("not detected")));R.length>0&&(O.value=`Some sources failed: ${R.join("; ")}`)}else m.ok||(O.value=`Discovery failed: ${m.error.message}`);I()}catch(t){x.error("Failed to clear and refresh models",t),O.value="Failed to clear and refresh models. Please check your connection and try again."}finally{ee.value=!1}}}async function vt(a){try{x.info("Applying model list:",a);const{getModelListManager:t}=await Be(async()=>{const{getModelListManager:z}=await import("./index-C_Jm4ddV.js").then(k=>k.b6);return{getModelListManager:z}},__vite__mapDeps([0,1])),R=await t().applyList(a);x.info("Model list applied:",R),await _e()}catch(t){x.error("Failed to apply model list:",t),O.value=`Failed to apply model list: ${t instanceof Error?t.message:"Unknown error"}`}}Mt(()=>{Ke(K.value)});const q=W(()=>v.value);return ze(async()=>{x.info("V4 DEBUG: models.value.length =",o.value.length),x.info("V4 DEBUG: models.value =",o.value),x.info("V4 DEBUG: modelsByProvider.value =",l.value);const a=await P.settings.get("main");a&&(L.value={hideOpenRouterFree:a.hideOpenRouterFree??!1,hideOpenRouterAuto:a.hideOpenRouterAuto??!1}),o.value.length===0&&(x.info("V4 DEBUG: No models found, refreshing..."),_e()),X.value=[],Ce()}),Ot(()=>{K.value="",X.value=[],O.value=""}),(a,t)=>{const m=M("a-button"),R=M("a-space"),z=M("a-alert"),k=M("a-tag"),Z=M("a-input-search"),oe=M("a-radio-button"),pt=M("a-radio-group"),mt=M("a-divider"),Me=M("a-dropdown"),Oe=M("a-checkbox"),$e=M("a-menu-item"),ft=M("a-menu"),gt=M("a-tooltip"),Pe=M("a-collapse-panel"),De=M("a-collapse"),yt=M("a-empty");return c(),h("div",Xs,[e("div",Ys,[t[13]||(t[13]=e("div",{class:"header-content"},[e("h1",null,"Model Management"),e("p",{class:"description"},"Configure and enable LLM models for testing")],-1)),i(R,null,{default:r(()=>[i(m,{type:"primary",onClick:_e,loading:B.value||y(g),"data-testid":"btn-refresh-models","aria-label":"Refresh available models"},{icon:r(()=>[i(y($t))]),default:r(()=>[t[11]||(t[11]=$(" Refresh Models "))]),_:1,__:[11]},8,["loading"]),i(m,{danger:"",onClick:ct,loading:ee.value,"data-testid":"btn-clear-refresh-models","aria-label":"Clear all models and refresh"},{icon:r(()=>[i(y(Pt))]),default:r(()=>[t[12]||(t[12]=$(" Clear and Refresh Models "))]),_:1,__:[12]},8,["loading"])]),_:1})]),O.value&&!ge.value?(c(),G(z,{key:0,type:"error",message:O.value,closable:"",onClose:t[0]||(t[0]=w=>O.value=""),class:"error-alert"},null,8,["message"])):j("",!0),ge.value?(c(),G(z,{key:1,type:"info",closable:"",onClose:t[1]||(t[1]=w=>O.value=""),class:"ollama-info-alert"},{message:r(()=>t[14]||(t[14]=[e("div",{class:"ollama-message"},[$(" Ollama is not running on this computer. To audit local LLMs, install "),e("a",{href:"https://ollama.com",target:"_blank",rel:"noopener noreferrer"},"Ollama"),$(". ")],-1)])),_:1})):j("",!0),ie.value?(c(),G(z,{key:2,type:"info",closable:"",onClose:t[2]||(t[2]=w=>ie.value=null),class:"ollama-cors-alert"},{message:r(()=>t[15]||(t[15]=[e("div",{class:"ollama-cors-message"},[e("strong",null,"Ollama not detected: "),e("a",{href:"https://ollama.com",target:"_blank",rel:"noopener noreferrer"},"Ollama"),$(" is an external program for running LLMs on your computer. If Ollama is installed, you must "),e("a",{href:"https://objectgraph.com/blog/ollama-cors/",target:"_blank",rel:"noopener noreferrer"},"configure CORS"),$(' by setting OLLAMA_ORIGINS to "*" or "auditomatic.org". If you do not wish to use Ollama, close and ignore this message. ')],-1)])),_:1})):j("",!0),y(s).length>0?(c(),h("div",Zs,[t[16]||(t[16]=e("span",{class:"status-label"},"Sources:",-1)),(c(!0),h(Y,null,ae(y(s),w=>(c(),h("div",{key:w.id,class:"source-status-compact"},[e("span",ea,f(y(S)(w.id)),1),i(k,{color:Ze(w.status),size:"small"},{default:r(()=>[w.status==="success"&&w.modelCount?(c(),h(Y,{key:0},[$(f(w.modelCount),1)],64)):w.status==="error"?(c(),h("span",{key:1,onClick:T=>dt(w.id),style:{cursor:"pointer"},"data-testid":`retry-source-${w.id}`,"aria-label":`Retry loading models from ${y(S)(w.id)}`},"⟳ retry",8,ta)):(c(),h(Y,{key:2},[$(f(w.status),1)],64))]),_:2},1032,["color"])]))),128))])):j("",!0),e("div",sa,[i(Z,{value:K.value,"onUpdate:value":t[3]||(t[3]=w=>K.value=w),placeholder:"Search models by name, provider, or ID...","allow-clear":"",size:"large",class:"search-input","data-testid":"input-model-search","aria-label":"Search models",loading:K.value!==J.value},null,8,["value","loading"]),i(pt,{value:H.value,"onUpdate:value":t[4]||(t[4]=w=>H.value=w),"button-style":"solid",size:"large"},{default:r(()=>[i(oe,{value:"all"},{default:r(()=>t[17]||(t[17]=[$("All")])),_:1,__:[17]}),i(oe,{value:"enabled"},{default:r(()=>t[18]||(t[18]=[$("Enabled")])),_:1,__:[18]}),i(oe,{value:"disabled"},{default:r(()=>t[19]||(t[19]=[$("Disabled")])),_:1,__:[19]})]),_:1},8,["value"])]),e("div",aa,[e("div",oa,[i(m,{type:"text",size:"small",onClick:lt},{icon:r(()=>[(c(),G(Dt(ye.value?Ye.value:Xe.value)))]),default:r(()=>[$(" "+f(ye.value?"Collapse All":"Expand All"),1)]),_:1}),i(mt,{type:"vertical"}),i(m,{type:"text",size:"small",onClick:rt,loading:q.value,disabled:q.value},{icon:r(()=>[i(y(Le))]),default:r(()=>[t[20]||(t[20]=$(" Enable All "))]),_:1,__:[20]},8,["loading","disabled"]),i(m,{type:"text",size:"small",onClick:it,loading:q.value,disabled:q.value},{icon:r(()=>[i(y(Re))]),default:r(()=>[t[21]||(t[21]=$(" Disable All "))]),_:1,__:[21]},8,["loading","disabled"]),i(Me,{open:pe.value,"onUpdate:open":t[6]||(t[6]=w=>pe.value=w),placement:"bottomLeft",disabled:q.value},{overlay:r(()=>[i(Qs,{"current-models":Array.from(y(o)),"is-loading":q.value,onApplyList:vt,onClose:t[5]||(t[5]=w=>pe.value=!1)},null,8,["current-models","is-loading"])]),default:r(()=>[i(m,{type:"text",size:"small",loading:q.value,disabled:q.value},{icon:r(()=>[i(y(Ft))]),default:r(()=>[t[22]||(t[22]=$(" Model Lists ")),i(y(At))]),_:1,__:[22]},8,["loading","disabled"])]),_:1},8,["open","disabled"]),qe.value?(c(),G(Me,{key:0},{overlay:r(()=>[i(ft,null,{default:r(()=>[i($e,{key:"privacy"},{default:r(()=>[e("div",la,[i(Oe,{checked:L.value.hideOpenRouterFree,"onUpdate:checked":t[7]||(t[7]=w=>L.value.hideOpenRouterFree=w),onChange:we},{default:r(()=>t[23]||(t[23]=[$(" Hide free models (privacy concerns) ")])),_:1,__:[23]},8,["checked"])])]),_:1}),i($e,{key:"auto"},{default:r(()=>[e("div",na,[i(Oe,{checked:L.value.hideOpenRouterAuto,"onUpdate:checked":t[8]||(t[8]=w=>L.value.hideOpenRouterAuto=w),onChange:we},{default:r(()=>t[24]||(t[24]=[$(" Hide Auto Router (unpredictable costs) ")])),_:1,__:[24]},8,["checked"])])]),_:1})]),_:1})]),default:r(()=>[i(m,{type:"text",size:"small"},{icon:r(()=>[i(y(Ne))]),default:r(()=>[t[25]||(t[25]=$(" OpenRouter Settings "))]),_:1,__:[25]})]),_:1})):j("",!0)]),e("div",ra,[e("span",null,f(He.value)+" of "+f(We.value)+" models enabled",1)])]),i(De,{activeKey:X.value,"onUpdate:activeKey":t[9]||(t[9]=w=>X.value=w),bordered:!1,class:"provider-collapse",destroyInactivePanel:!1},{default:r(()=>[(c(!0),h(Y,null,ae(de.value,(w,T)=>(c(),G(Pe,{key:`provider-${T}`},{header:r(()=>{var Ae,Ee;return[e("div",ia,[e("div",da,[e("strong",null,f(y(F)(T)),1),(Ae=Q.value[T])!=null&&Ae.requiresKey&&!((Ee=Q.value[T])!=null&&Ee.hasKey)?(c(),G(gt,{key:0,placement:"top"},{title:r(()=>{var le;return[$(" API key not set for "+f((le=Q.value[T])==null?void 0:le.providerGroup)+". Click to add in settings. ",1)]}),default:r(()=>[i(m,{type:"link",danger:"",size:"small",onClick:ne(le=>{var Se;return ot((Se=Q.value[T])==null?void 0:Se.providerGroup)},["stop"])},{icon:r(()=>[i(y(St))]),default:r(()=>[t[26]||(t[26]=$(" API Key Missing "))]),_:2,__:[26]},1032,["onClick"])]),_:2},1024)):j("",!0),X.value.includes(T)?(c(),h(Y,{key:2},[i(k,{size:"small",color:"blue"},{default:r(()=>[$(f(w.length)+" models",1)]),_:2},1024),i(k,{size:"small",color:tt(T)},{default:r(()=>[$(f(fe.value[T]||0)+" enabled ",1)]),_:2},1032,["color"])],64)):(c(),h("span",ua,f(fe.value[T]||0)+" / "+f((y(l)[T]||[]).length)+" enabled ",1))]),i(R,{size:"small"},{default:r(()=>[i(m,{type:"text",size:"small",onClick:ne(le=>ke(T,!0),["stop"]),disabled:st(T)||q.value,loading:q.value},{icon:r(()=>[i(y(Le))]),default:r(()=>[t[27]||(t[27]=$(" Enable All "))]),_:2,__:[27]},1032,["onClick","disabled","loading"]),i(m,{type:"text",size:"small",onClick:ne(le=>ke(T,!1),["stop"]),disabled:at(T)||q.value,loading:q.value},{icon:r(()=>[i(y(Re))]),default:r(()=>[t[28]||(t[28]=$(" Disable All "))]),_:2,__:[28]},1032,["onClick","disabled","loading"])]),_:2},1024)])]}),default:r(()=>[(c(),G(Et,null,[i(cs,{models:w,"provider-id":T,onToggleModel:nt},null,8,["models","provider-id"])],1024))]),_:2},1024))),128))]),_:1},8,["activeKey"]),Object.keys(de.value).length===0?(c(),G(yt,{key:4,description:Je.value,class:"empty-state"},null,8,["description"])):j("",!0),Qe.value?(c(),G(De,{key:5,activeKey:he.value,"onUpdate:activeKey":t[10]||(t[10]=w=>he.value=w),bordered:!1,class:"ollama-manager-collapse"},{default:r(()=>[i(Pe,{key:"ollama"},{header:r(()=>t[29]||(t[29]=[e("div",{class:"ollama-header"},[e("strong",null,"Ollama Model Management"),e("span",{class:"ollama-description"},"Download and manage local Ollama models")],-1)])),default:r(()=>[i(Lt,{onModelsUpdated:ut})]),_:1})]),_:1},8,["activeKey"])):j("",!0),Ie.value?(c(),G(Fs,{key:6,class:"enhanced-features"})):j("",!0)])}}}),ka=ve(ca,[["__scopeId","data-v-eeb53a85"]]);export{ka as default};
