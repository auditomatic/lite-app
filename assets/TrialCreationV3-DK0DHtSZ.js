import{r as B,c as z,a as H,d as ve,f as Q,t as oe,o as fe,w as Y,h as k,ac as ne,A as L,ad as ge,e as u,i as e,y as E,x as $,B as _,ae as ye,ah as Ce,F as X,C as ee,j as g,z as O,G as I,aE as ue,k as Z,aF as de,T as _e,P as ae,aG as be,a6 as he,v as G,N as ke,p as $e,aH as Te,aI as we,u as Ie,$ as Se,aJ as Pe,am as xe,aK as De,aL as Ve,Z as Ne,Q as Oe,D as se}from"./index-8if2tzRy.js";import{u as Ae}from"./useV4Templates-DMEisaVt.js";import{a as Me}from"./useV4VariableLists-B_Iv1biy.js";import{u as pe}from"./useV4Models-QI5LH92x.js";import{u as ce,a as Le,b as Ee,F as ze,C as Re}from"./useV4TrialCommands-DVZf3DXH.js";import{G as je}from"./GenericModelSelectorModalV3-BRBs_RN-.js";import{S as me}from"./SaveOutlined-D9A0tWZJ.js";import"./useV4LiveQuery-BpGHTaC2.js";import"./useV4ProviderParameters-BVWaAQxs.js";import"./InboxOutlined-9nbeNqrC.js";function Be(W){const{templates:x}=Ae(),{variableLists:n}=Me(),{enabledModels:T}=pe(),{runningTrials:f}=ce(),w=Ee(),{createTrial:y}=Le(),o=B(null),b=B(""),D=B(""),V=B(1),S=B([]),R=B(!1),A=B(!1),c=z(()=>x.value||[]),s=z(()=>[]),P=z(()=>{var v,j;if(!o.value)return 0;if(o.value.type==="template"){const M=o.value;if(!M.variables)return 1;let J=1;for(const[,U]of Object.entries(M.variables))if(U.type==="value"&&U.values)J*=U.values.length;else if(U.type==="list"&&U.listId){const K=n.value.find(te=>te.id===U.listId);K&&(K.category==="simple"?J*=((v=K.values)==null?void 0:v.length)||0:K.category==="attributed"?J*=((j=K.items)==null?void 0:j.length)||0:K.category==="tabular"&&(J*=K.itemCount||0))}return J}else return 0}),F=z(()=>P.value*S.value.length*V.value),p=z(()=>{let v=0;for(const j of S.value){const M=a(j);v+=M*P.value*V.value}return v}),r=z(()=>o.value!==null&&S.value.length>0&&b.value.trim()!=="");function t(v){o.value=v,b.value=l(v)}function l(v){const j=v||o.value;if(!j)return"New Trial";const M=new Date().toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return`${j.name} - ${M}`}function a(v){var te,le;if(!o.value)return 0;const j=T.value.find(re=>re.provider===v.provider&&re.modelId===v.modelId);if(!(j!=null&&j.capabilities))return 0;const M=d(),J=((te=v.parameters)==null?void 0:te.max_tokens)||((le=v.parameters)==null?void 0:le.maxTokens)||256,U=(j.capabilities.inputCostPerToken||0)*M,K=(j.capabilities.outputCostPerToken||0)*J;return U+K}function d(){return o.value&&o.value.type==="template"?150:100}function C(v){S.value.push(v)}function h(v){S.value.splice(v,1)}async function i(){if(r.value){R.value=!0;try{const v=JSON.parse(JSON.stringify(o.value)),j={name:b.value,description:"",type:v.type,configurations:JSON.parse(JSON.stringify(S.value)),repeatCount:V.value,templateConfig:v.type==="template"?{template:v.template,variables:v.variables,outputType:v.outputType,extractPattern:v.extractPattern,refusalWords:v.refusalWords,rejectRefusalWords:v.rejectRefusalWords}:void 0,spreadsheetConfig:v.type==="spreadsheet"?{promptPattern:v.promptPattern,datasetId:v.datasetId}:void 0},M=await y(j);if(M.ok)return M.value;throw M.error}finally{R.value=!1}}}async function m(){const v=await i();if(v)return f.value.length>0?{trialId:v,needsConfirmation:!0,runningTrial:f.value[0]}:await N(v)}async function N(v){H.info("V4: Creation view starting trial via V4 execution control",v);const j=await w.startTrialWithStreaming(v);if(j.ok){H.info("V4: Trial started successfully via V4 execution control");const M=j.value.progress$.subscribe({next:U=>{H.info("V4: Creation view received progress update:",U.type)},error:U=>{H.error("V4: Creation view stream error:",U)}}),J=j.value.calls$.subscribe({next:U=>{H.info("V4: Creation view received batch of",U.length,"calls")},error:U=>{H.error("V4: Creation view calls stream error:",U)}});return H.info("V4: Creation view subscribed to BOTH streams, execution started, navigating to trials view"),setTimeout(()=>{M.unsubscribe(),J.unsubscribe(),H.info("V4: Creation view unsubscribed from streams after navigation")},1e3),{trialId:v,needsConfirmation:!1}}else throw j.error}async function q(){var v,j;try{await w.initialize(),H.info("V4: Execution control initialized in creation view")}catch(M){H.error("V4: Failed to initialize execution control in creation view:",M)}if(W.value.type==="duplicate"&&W.value.sourceTrialId){const M=await ve.trials.get(W.value.sourceTrialId);if(M){if(b.value=`Copy of ${M.name}`,V.value=M.repeatCount||1,M.configurations&&(S.value=M.configurations.map(J=>{var U;return{name:((U=J.modelSnapshot)==null?void 0:U.displayName)||J.modelId,provider:J.provider,modelId:J.modelId,parameters:J.parameters||{}}})),M.type==="template"&&((v=M.templateConfig)!=null&&v.template)){const J=c.value.find(U=>{var K;return U.template===((K=M.templateConfig)==null?void 0:K.template)});J&&t(J)}else if(M.type==="spreadsheet"&&((j=M.spreadsheetConfig)!=null&&j.datasetId)){const J=s.value.find(U=>{var K;return U.datasetId===((K=M.spreadsheetConfig)==null?void 0:K.datasetId)});J&&t(J)}}}}return{selectedPrompt:o,trialName:b,description:D,repeatCount:V,configurations:S,creating:R,showModelSelector:A,templates:c,spreadsheets:s,variableLists:n,enabledModels:T,runningTrials:f,totalCombinations:P,totalExperiments:F,totalCost:p,canProceed:r,selectPrompt:t,generateTrialName:l,addConfiguration:C,removeConfiguration:h,getConfigCostPerCall:a,createTrialAsDraft:i,createAndStartTrial:m,initialize:q}}const Fe={key:0,class:"preview-controls"},Ue={class:"template-name"},Je={key:0,class:"cycle-info"},qe={key:1,class:"variable-legend"},We={class:"variable-value"},Ke=Q({__name:"TemplatePreviewV3",props:{template:{},variableLists:{default:()=>[]},cycling:{type:Boolean,default:!0},cyclingSpeed:{default:1e3},showControls:{type:Boolean,default:!1},displayMode:{default:"block"},showLegend:{type:Boolean,default:!1},maxLines:{default:0}},emits:["update:paused","back-to-select"],setup(W,{emit:x}){const n=W,T=x,f=B(0),w=B(!1);let y=null;const o=["variable-highlight-blue","variable-highlight-green","variable-highlight-purple","variable-highlight-orange","variable-highlight-pink","variable-highlight-teal"],b=z(()=>n.template.type==="template"?n.template.template:n.template.type==="spreadsheet"?n.template.promptPattern:""),D=z(()=>{var C;if(n.template.type==="spreadsheet"){const h=n.template,i=n.variableLists.find(m=>m.id===h.datasetId);return(i==null?void 0:i.category)==="tabular"&&((C=i.tabularData)!=null&&C.rows)?i.tabularData.rows.map(m=>{const N={};return Object.keys(m).forEach(q=>{let v=q.replace(/[^a-zA-Z0-9_]/g,"_");/^[a-zA-Z]/.test(v)||(v="col_"+v),v=v.replace(/_+/g,"_").replace(/_+$/,""),N[v]=String(m[q]||"")}),N}):[]}const t=[];if(n.template.variables){for(const[h,i]of Object.entries(n.template.variables))if(i.type==="value"&&i.values)t.push({name:h,values:[...i.values]});else if(i.type==="list"&&i.listId){const m=n.variableLists.find(N=>N.id===i.listId);m&&(m.category==="simple"&&m.values?t.push({name:h,values:[...m.values]}):m.category==="attributed"&&m.items&&t.push({name:h,values:m.items.map(N=>N.value)}))}}if(t.length===0)return[];const l=h=>h.reduce((i,m)=>i.flatMap(N=>m.map(q=>[...N,q])),[[]]),a=t.map(h=>h.values);return l(a).map(h=>{const i={};return t.forEach((m,N)=>{i[m.name]=h[N]}),i})}),V=z(()=>D.value.length),S=z(()=>D.value.length===0?null:D.value[f.value]||D.value[0]),R=z(()=>{const t=b.value;if(!t)return"";const l=S.value;if(!l||Object.keys(l).length===0)return s(t).replace(/\n/g,"<br>");let a=s(t);if(Object.keys(l).sort((C,h)=>h.length-C.length).forEach((C,h)=>{const i=l[C],m=s(i),N=c(h),q=new RegExp(`{{\\s*${P(C)}\\s*}}`,"g");a=a.replace(q,`<span class="${N} variable-value">${m}</span>`)}),a=a.replace(/\n/g,"<br>"),n.maxLines>0){const C=a.split("<br>");C.length>n.maxLines&&(a=C.slice(0,n.maxLines).join("<br>")+'<br><span class="line-clamp-indicator">...</span>')}return a}),A=z(()=>n.displayMode==="inline"&&n.maxLines>0?{display:"-webkit-box","-webkit-line-clamp":n.maxLines,"-webkit-box-orient":"vertical",overflow:"hidden"}:{});function c(t){return o[t%o.length]}function s(t){const l=document.createElement("div");return l.textContent=t,l.innerHTML}function P(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function F(){w.value=!w.value,T("update:paused",w.value)}function p(){!n.cycling||w.value||V.value<=1||(y=setInterval(()=>{f.value=(f.value+1)%V.value},n.cyclingSpeed))}function r(){y&&(clearInterval(y),y=null)}return oe(()=>{n.cycling&&!w.value&&p()}),fe(()=>{r()}),Y(()=>w.value,t=>{t||!n.cycling?r():p()}),Y(()=>n.cycling,t=>{t?w.value||p():(r(),f.value=0)}),Y(()=>n.cyclingSpeed,()=>{n.cycling&&!w.value&&(r(),p())}),Y(V,()=>{f.value=0}),(t,l)=>{const a=E("a-button"),d=E("a-tag"),C=ye("dompurify-html");return g(),k("div",{class:ne(["template-preview",[`preview-${t.displayMode}`,{"preview-cycling":t.cycling&&!w.value}]])},[t.showControls?(g(),k("div",Fe,[u(a,{type:"link",onClick:l[0]||(l[0]=h=>t.$emit("back-to-select")),class:"back-to-select"},{default:$(()=>[u(I(ue)),l[1]||(l[1]=O(" Back to Select Template "))]),_:1,__:[1]}),e("h3",Ue,_(n.template.name),1),u(a,{onClick:F,size:"small",type:w.value?"default":"primary",disabled:!t.cycling||V.value<=1},{default:$(()=>[O(_(w.value?"Start":"Pause")+" Variable Selection ",1)]),_:1},8,["type","disabled"]),t.cycling&&V.value>1?(g(),k("span",Je,_(f.value+1)+" / "+_(V.value),1)):L("",!0),u(d,{color:n.template.type==="template"?"blue":"green",class:"source-badge"},{default:$(()=>[O(_(n.template.type==="template"?"Prompt Design":"Spreadsheet Design"),1)]),_:1},8,["color"])])):L("",!0),ge(e("div",{class:"preview-content",style:Ce(A.value)},null,4),[[C,R.value,"template"]]),t.showLegend&&S.value&&Object.keys(S.value).length>0?(g(),k("div",qe,[(g(!0),k(X,null,ee(S.value,(h,i,m)=>(g(),k("div",{key:i,class:"legend-item"},[e("span",{class:ne(c(m))},_(i),3),e("span",We,_(h),1)]))),128))])):L("",!0)],2)}}}),ie=Z(Ke,[["__scopeId","data-v-1ad1228f"]]),He={class:"design-selection"},Ge={class:"design-selector","data-testid":"template-design-selector"},Ye={key:0,class:"no-designs-state"},Qe={class:"no-designs-content"},Ze={key:1,class:"no-designs-state"},Xe={class:"no-designs-content"},et={key:2,class:"design-list","data-testid":"design-list"},tt=["data-template-id","data-template-name","onClick"],at={class:"design-header"},st={class:"design-title-section"},nt={class:"design-name"},it={key:0,class:"design-inline-description"},ot={class:"design-date"},lt={class:"design-stats"},rt={class:"stat-item"},dt={class:"stat-value"},ut={class:"stat-item"},pt={class:"stat-value"},ct={class:"stat-item"},mt={class:"stat-value"},vt={class:"design-selector","data-testid":"spreadsheet-design-selector"},ft={key:0,class:"no-designs-state"},gt={class:"no-designs-content"},yt={key:1,class:"design-list","data-testid":"design-list"},Ct=["data-spreadsheet-id","data-spreadsheet-name","onClick"],_t={class:"design-header"},bt={class:"design-title-section"},ht={class:"design-name"},kt={key:0,class:"design-inline-description"},$t={class:"design-date"},Tt={class:"design-stats"},wt={class:"stat-item"},It={class:"stat-value"},St={class:"stat-item"},Pt={class:"stat-value"},xt={class:"stat-item"},Dt={class:"stat-value"},Vt=Q({__name:"TrialDesignSelectionV3",props:{templates:{},spreadsheets:{},variableLists:{}},emits:["select","create-template","create-spreadsheet"],setup(W){const x=be(),n=W,T=B("template"),f=B(""),w=B(""),y=z(()=>{if(!f.value)return n.templates;const c=f.value.toLowerCase();return n.templates.filter(s=>s.name.toLowerCase().includes(c)||(s.description||"").toLowerCase().includes(c))}),o=z(()=>{if(!w.value)return n.spreadsheets;const c=w.value.toLowerCase();return n.spreadsheets.filter(s=>s.name.toLowerCase().includes(c)||(s.description||"").toLowerCase().includes(c))});function b(c){const s=typeof c=="string"?new Date(c):c,F=new Date().getTime()-s.getTime(),p=Math.floor(F/(1e3*60*60*24));if(p===0){const r=Math.floor(F/36e5);if(r===0){const t=Math.floor(F/6e4);return t<=1?"just now":`${t} min ago`}return r===1?"1 hour ago":`${r} hours ago`}else return p===1?"yesterday":p<7?`${p} days ago`:s.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function D(c){return c.variables?Object.keys(c.variables).length:0}function V(c){var P,F;if(!c.variables)return 1;let s=1;for(const[,p]of Object.entries(c.variables))if(p.type==="value"&&p.values)s*=p.values.length;else if(p.type==="list"&&p.listId){const r=n.variableLists.find(t=>t.id===p.listId);r&&(r.category==="simple"?s*=((P=r.values)==null?void 0:P.length)||0:r.category==="attributed"?s*=((F=r.items)==null?void 0:F.length)||0:r.category==="tabular"&&(s*=r.itemCount||0))}return s}function S(c){const s=n.variableLists.find(P=>P.id===c.datasetId);return(s==null?void 0:s.itemCount)||0}function R(c){var P;const s=n.variableLists.find(F=>F.id===c.datasetId);return(s==null?void 0:s.category)==="tabular"&&((P=s.tabularData)!=null&&P.columns)?s.tabularData.columns.length:0}function A(c){if(!c)return"???";try{if("template"in c&&c.template)return`~${x.estimateTokens(c.template)}`;if("promptPattern"in c&&c.promptPattern)return`~${x.estimateTokens(c.promptPattern)}`}catch(s){H.warn("Failed to estimate tokens:",s)}return"???"}return(c,s)=>{const P=E("a-input"),F=E("a-spin"),p=E("a-button"),r=E("a-tag"),t=E("a-tab-pane"),l=E("a-tabs");return g(),k("div",He,[u(l,{activeKey:T.value,"onUpdate:activeKey":s[6]||(s[6]=a=>T.value=a),size:"large"},{default:$(()=>[u(t,{key:"template",tab:"Prompt Designs (one API call per combination)"},{default:$(()=>[e("div",Ge,[u(P,{value:f.value,"onUpdate:value":s[0]||(s[0]=a=>f.value=a),placeholder:"Search prompt designs...",size:"large",class:"design-search","data-testid":"input-template-search",allowClear:""},{prefix:$(()=>[u(I(de))]),_:1},8,["value"]),!c.templates||c.templates.length===0?(g(),k("div",Ye,[e("div",Qe,[u(F,{size:"large",tip:"Loading templates..."})])])):y.value.length===0?(g(),k("div",Ze,[e("div",Xe,[s[8]||(s[8]=e("p",null,"No prompt designs found",-1)),u(p,{type:"primary",onClick:s[1]||(s[1]=a=>c.$emit("create-template"))},{default:$(()=>[u(I(_e)),s[7]||(s[7]=O(" Create Prompt Design "))]),_:1,__:[7]})])])):(g(),k("div",et,[(g(!0),k(X,null,ee(y.value,a=>(g(),k("div",{key:a.id,class:"design-item","data-testid":"template-item","data-template-id":a.id,"data-template-name":a.name,onClick:d=>c.$emit("select",a)},[e("div",at,[e("div",st,[e("h4",nt,[O(_(a.name)+" ",1),a.description?(g(),k("span",it,"- "+_(a.description),1)):L("",!0)])]),e("span",ot,_(b(a.updated)),1)]),u(ie,{template:a,"variable-lists":c.variableLists,cycling:!0,"show-controls":!1,"display-mode":"inline","max-lines":5,class:"design-preview"},null,8,["template","variable-lists"]),e("div",lt,[u(r,{size:"small",color:"blue",class:"output-type-tag"},{default:$(()=>[O(_(a.outputType||"text"),1)]),_:2},1024),e("span",rt,[e("span",dt,_(D(a)),1),s[9]||(s[9]=e("span",{class:"stat-label"},"vars",-1))]),s[12]||(s[12]=e("span",{class:"stat-divider"},"•",-1)),e("span",ut,[e("span",pt,_(V(a)),1),s[10]||(s[10]=e("span",{class:"stat-label"},"combos",-1))]),s[13]||(s[13]=e("span",{class:"stat-divider"},"•",-1)),e("span",ct,[e("span",mt,_(A(a)),1),s[11]||(s[11]=e("span",{class:"stat-label"},"tokens",-1))])])],8,tt))),128)),e("div",{class:"design-item design-item-create","data-testid":"btn-create-design",onClick:s[2]||(s[2]=a=>c.$emit("create-template"))},[u(I(ae),{style:{"font-size":"24px"}}),s[14]||(s[14]=e("span",null,"Create New Design",-1))])]))])]),_:1}),u(t,{key:"spreadsheet",tab:"Spreadsheet Designs (one API call per row)"},{default:$(()=>[e("div",vt,[u(P,{value:w.value,"onUpdate:value":s[3]||(s[3]=a=>w.value=a),placeholder:"Search spreadsheet designs...",size:"large",class:"design-search","data-testid":"input-spreadsheet-search",allowClear:""},{prefix:$(()=>[u(I(de))]),_:1},8,["value"]),o.value.length===0?(g(),k("div",ft,[e("div",gt,[s[16]||(s[16]=e("p",null,"No spreadsheet designs found",-1)),u(p,{type:"primary",onClick:s[4]||(s[4]=a=>c.$emit("create-spreadsheet"))},{default:$(()=>[u(I(ze)),s[15]||(s[15]=O(" Create Spreadsheet Design "))]),_:1,__:[15]})])])):(g(),k("div",yt,[(g(!0),k(X,null,ee(o.value,a=>(g(),k("div",{key:a.id,class:"design-item","data-testid":"spreadsheet-item","data-spreadsheet-id":a.id,"data-spreadsheet-name":a.name,onClick:d=>c.$emit("select",a)},[e("div",_t,[e("div",bt,[e("h4",ht,[O(_(a.name)+" ",1),a.description?(g(),k("span",kt,"- "+_(a.description),1)):L("",!0)])]),e("span",$t,_(b(a.updated)),1)]),u(ie,{template:a,"variable-lists":c.variableLists,cycling:!0,"show-controls":!1,"display-mode":"inline","max-lines":5,class:"design-preview"},null,8,["template","variable-lists"]),e("div",Tt,[u(r,{size:"small",color:"green",class:"output-type-tag"},{default:$(()=>[O(_(a.outputType||"text"),1)]),_:2},1024),e("span",wt,[e("span",It,_(S(a)),1),s[17]||(s[17]=e("span",{class:"stat-label"},"rows",-1))]),s[20]||(s[20]=e("span",{class:"stat-divider"},"•",-1)),e("span",St,[e("span",Pt,_(R(a)),1),s[18]||(s[18]=e("span",{class:"stat-label"},"cols",-1))]),s[21]||(s[21]=e("span",{class:"stat-divider"},"•",-1)),e("span",xt,[e("span",Dt,_(A(a)),1),s[19]||(s[19]=e("span",{class:"stat-label"},"tokens",-1))])])],8,Ct))),128)),e("div",{class:"design-item design-item-create","data-testid":"btn-create-spreadsheet",onClick:s[5]||(s[5]=a=>c.$emit("create-spreadsheet"))},[u(I(ae),{style:{"font-size":"24px"}}),s[22]||(s[22]=e("span",null,"Create New Spreadsheet Design",-1))])]))])]),_:1})]),_:1},8,["activeKey"])])}}}),Nt=Z(Vt,[["__scopeId","data-v-db101528"]]),Ot={class:"trial-metadata-form"},At=Q({__name:"TrialMetadataV3",props:{name:{},repeatCount:{default:1},description:{default:""},totalCombinations:{default:0}},emits:["update:name","update:repeatCount","update:description"],setup(W,{emit:x}){const n=W,T=x,f=he({name:n.name,repeatCount:n.repeatCount,description:n.description||""}),w=z(()=>{if(n.totalCombinations>0&&f.repeatCount>1){const o=n.totalCombinations*f.repeatCount;return`Each prompt will be run ${f.repeatCount} times (${o} total calls)`}return"Number of times to run each prompt"});function y(){T("update:name",f.name),T("update:repeatCount",f.repeatCount),T("update:description",f.description)}return Y(()=>n.name,o=>{f.name=o}),Y(()=>n.repeatCount,o=>{f.repeatCount=o}),Y(()=>n.description,o=>{f.description=o||""}),(o,b)=>{const D=E("a-input"),V=E("a-form-item"),S=E("a-col"),R=E("a-input-number"),A=E("a-row"),c=E("a-textarea"),s=E("a-form");return g(),k("div",Ot,[u(s,{layout:"vertical",model:f},{default:$(()=>[u(A,{gutter:24},{default:$(()=>[u(S,{span:18},{default:$(()=>[u(V,{label:"Trial Name",rules:[{required:!0,message:"Please enter a trial name"}]},{default:$(()=>[u(D,{value:f.name,"onUpdate:value":b[0]||(b[0]=P=>f.name=P),size:"large",placeholder:"e.g., GPT-4 Performance Test",onChange:y},null,8,["value"])]),_:1})]),_:1}),u(S,{span:6},{default:$(()=>[u(V,{label:"Repeat Count",help:w.value},{default:$(()=>[u(R,{value:f.repeatCount,"onUpdate:value":b[1]||(b[1]=P=>f.repeatCount=P),min:1,max:100,size:"large",style:{width:"100%"},onChange:y},null,8,["value"])]),_:1},8,["help"])]),_:1})]),_:1}),u(V,{label:"Description (Optional)"},{default:$(()=>[u(c,{value:f.description,"onUpdate:value":b[2]||(b[2]=P=>f.description=P),placeholder:"Add any notes about this trial...",rows:2,onChange:y},null,8,["value"])]),_:1})]),_:1},8,["model"])])}}}),Mt=Z(At,[["__scopeId","data-v-b945eb57"]]),Lt={class:"model-configuration"},Et={key:0,class:"quick-add-section"},zt={class:"quick-add-models"},Rt={class:"provider-name"},jt={class:"model-name"},Bt={key:0,class:"param-info"},Ft={class:"configuration-table"},Ut={class:"table-header"},Jt={style:{display:"inline-flex","align-items":"center",gap:"0"}},qt={key:0,class:"model-name-cell"},Wt={class:"model-name"},Kt={class:"model-id"},Ht={key:1,class:"parameter-tags"},Gt={key:2,class:"cost-cell"},Yt={class:"cost-value"},Qt={key:0,class:"cost-total"},Zt={key:0,class:"cost-summary"},Xt={class:"cost-summary-item"},ea={class:"cost-summary-item"},ta={class:"total-cost"},aa=Q({__name:"ModelConfigurationV3",props:{configurations:{},totalCombinations:{},repeatCount:{},avgTokens:{default:150}},emits:["add-configuration","remove-configuration"],setup(W,{emit:x}){const n=W,T=x,{models:f}=pe(),{trials:w}=ce(),y=B(!1),o=z(()=>{var h;const t=new Map;if(w.value&&w.value.length>0){const i=w.value.filter(m=>m.status!=="draft").slice(0,10);for(const m of i)if(m.configurations){for(const N of m.configurations){const q=JSON.stringify(N.parameters||{}),v=`${N.provider}-${N.modelId}-${q}`;if(t.has(v)||t.set(v,N),t.size>=15)break}if(t.size>=15)break}}const l=new Set(n.configurations.map(i=>{const m=JSON.stringify(i.parameters||{});return`${i.provider}-${i.modelId}-${m}`})),a=Array.from(t.values()).filter(i=>{var v;const m=JSON.stringify(i.parameters||{}),N=`${i.provider}-${i.modelId}-${m}`;if(l.has(N))return!1;const q=(v=f.value)==null?void 0:v.find(j=>j.provider===i.provider&&j.modelId===i.modelId);return!(!q||!q.enabled)}),d=[{provider:"openai-chat",modelId:"gpt-4o-mini",params:{temperature:0,max_completion_tokens:1e3}},{provider:"openai-chat",modelId:"gpt-4.1-nano",params:{temperature:0,max_completion_tokens:500}},{provider:"anthropic",modelId:"claude-3-5-haiku-latest",params:{temperature:0,max_tokens:1e3}},{provider:"openrouter",modelId:"meta-llama/llama-4-maverick",params:{temperature:.8,max_tokens:2e3}},{provider:"openrouter",modelId:"mistralai/mistral-nemo",params:{temperature:.7,max_tokens:1500}},{provider:"ollama-generate",modelId:"qwen2.5:0.5b",params:{temperature:0,num_predict:500,stream:!1}},{provider:"ollama-generate",modelId:"llama3.2:1b",params:{temperature:0,num_predict:1e3,stream:!1}}],C=[];for(const i of d){const m=JSON.stringify(i.params),N=`${i.provider}-${i.modelId}-${m}`;if(!l.has(N)&&!t.has(N)){const q=(h=f.value)==null?void 0:h.find(v=>v.provider===i.provider&&v.modelId===i.modelId);q&&q.enabled&&C.push({provider:i.provider,modelId:i.modelId,parameters:i.params,providerSnapshot:{},modelSnapshot:q})}}return[...a,...C].slice(0,10)}),b=[{title:"Model",key:"name",width:"35%"},{title:"Parameters",key:"parameters",width:"35%"},{title:"Cost",key:"cost",width:"20%"},{title:"",key:"actions",width:"10%"}],D=z(()=>n.configurations.map((t,l)=>({key:`${t.provider}-${t.modelId}-${l}`,...t,costPerCall:R(t)}))),V=z(()=>n.totalCombinations*n.configurations.length*n.repeatCount),S=z(()=>n.configurations.reduce((t,l)=>{const a=R(l);return t+a*n.totalCombinations*n.repeatCount},0));function R(t){var h,i,m;const l=(h=f.value)==null?void 0:h.find(N=>N.provider===t.provider&&N.modelId===t.modelId);if(!(l!=null&&l.capabilities))return 0;const a=((i=t.parameters)==null?void 0:i.max_tokens)||((m=t.parameters)==null?void 0:m.maxTokens)||256,d=(l.capabilities.inputCostPerToken||0)*n.avgTokens,C=(l.capabilities.outputCostPerToken||0)*a;return d+C}function A(t){return t===0?"0.00":t<.01?"<0.01":t<1?t.toFixed(2):t<10?t.toFixed(1):Math.round(t).toString()}function c(t){const l={},a=["temperature","max_tokens","max_completion_tokens","num_predict","maxTokens","top_p","top_k","reasoning_effort"];for(const d of a)t[d]!==void 0&&t[d]!==null&&(l[d]=t[d]);for(const[d,C]of Object.entries(t))C!=null&&!a.includes(d)&&(l[d]=C);return l}function s(t){return t.replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase())}function P(t){if(!t||Object.keys(t).length===0)return"";const l=[];return t.temperature!==void 0&&l.push(`T:${t.temperature}`),t.max_tokens!==void 0?l.push(`${t.max_tokens}t`):t.maxTokens!==void 0?l.push(`${t.maxTokens}t`):t.num_predict!==void 0&&l.push(`${t.num_predict}t`),t.top_p!==void 0&&l.push(`p:${t.top_p}`),l.length>0?`(${l.join(", ")})`:""}function F(t){var d,C;const l=$e.validateParameters(t.provider,t.modelId,t.parameters||{});if(!l.valid){H.error("Quick Add validation failed:",{provider:t.provider,modelId:t.modelId,parameters:t.parameters,errors:l.errors}),alert(`Cannot add model configuration: ${((d=l.errors)==null?void 0:d.join(", "))||"Invalid parameters"}`);return}const a={name:((C=t.modelSnapshot)==null?void 0:C.displayName)||t.modelId,provider:t.provider,modelId:t.modelId,parameters:{...t.parameters}};T("add-configuration",a)}function p(t){T("add-configuration",t),y.value=!1}function r(t){T("remove-configuration",t)}return(t,l)=>{const a=E("a-button"),d=E("a-tooltip"),C=E("a-tag"),h=E("a-table");return g(),k("div",Lt,[o.value.length>0?(g(),k("div",Et,[l[2]||(l[2]=e("h4",null,"Quick Add Recent Models",-1)),e("div",zt,[(g(!0),k(X,null,ee(o.value,i=>{var m;return g(),G(a,{key:`${i.provider}-${i.modelId}-${JSON.stringify(i.parameters)}`,size:"small",onClick:N=>F(i),class:"quick-add-button",title:`Add ${((m=i.modelSnapshot)==null?void 0:m.displayName)||i.modelId} (${i.provider}) with recent parameters`},{default:$(()=>{var N;return[u(I(ae)),e("span",Rt,_(i.provider)+"/",1),e("span",jt,_(((N=i.modelSnapshot)==null?void 0:N.displayName)||i.modelId),1),P(i.parameters)?(g(),k("span",Bt,_(P(i.parameters)),1)):L("",!0)]}),_:2},1032,["onClick","title"])}),128))])])):L("",!0),e("div",Ft,[e("div",Ut,[e("h3",Jt,[u(d,{placement:"topLeft"},{title:$(()=>l[3]||(l[3]=[O(" Add models to test with your template and configure their parameters like temperature, max tokens, etc. ")])),default:$(()=>[l[4]||(l[4]=e("span",null,"Model Configurations to Test",-1))]),_:1,__:[4]}),l[6]||(l[6]=e("span",null,"  ",-1)),u(a,{type:"primary",size:"small",onClick:l[0]||(l[0]=i=>y.value=!0)},{default:$(()=>[u(I(ae)),l[5]||(l[5]=O(" Add Model "))]),_:1,__:[5]})])]),u(h,{columns:b,"data-source":D.value,pagination:!1,locale:{emptyText:"No models configured. Add at least one model to proceed."},"row-key":"key"},{bodyCell:$(({column:i,record:m,index:N})=>[i.key==="name"?(g(),k("div",qt,[e("span",Wt,_(m.name),1),e("span",Kt,_(m.provider)+":"+_(m.modelId),1)])):i.key==="parameters"?(g(),k("div",Ht,[(g(!0),k(X,null,ee(c(m.parameters),(q,v)=>(g(),G(C,{key:v},{default:$(()=>[O(_(s(v))+": "+_(q),1)]),_:2},1024))),128))])):i.key==="cost"?(g(),k("div",Gt,[e("span",Yt,"$"+_(A(m.costPerCall)),1),l[7]||(l[7]=e("span",{class:"cost-label"},"per call",-1)),t.totalCombinations>1?(g(),k("div",Qt," Total: $"+_(A(m.costPerCall*t.totalCombinations*t.repeatCount)),1)):L("",!0)])):i.key==="actions"?(g(),G(a,{key:3,type:"text",danger:"",size:"small",onClick:q=>r(N)},{default:$(()=>[u(I(ke))]),_:2},1032,["onClick"])):L("",!0)]),_:1},8,["data-source"]),t.configurations.length>0?(g(),k("div",Zt,[e("div",Xt,[l[8]||(l[8]=e("span",null,"Total experiments:",-1)),e("strong",null,_(V.value),1)]),e("div",ea,[l[9]||(l[9]=e("span",null,"Estimated total cost:",-1)),e("strong",ta,"$"+_(A(S.value)),1)])])):L("",!0)]),u(je,{visible:y.value,"onUpdate:visible":l[1]||(l[1]=i=>y.value=i),mode:"trial","trial-context":{totalCombinations:t.totalCombinations,avgTokens:t.avgTokens},"existing-configurations":t.configurations,onAddConfiguration:p},null,8,["visible","trial-context","existing-configurations"])])}}}),sa=Z(aa,[["__scopeId","data-v-f4b373de"]]),na={class:"trial-configuration"},ia={class:"configuration-sections"},oa={class:"config-section"},la={class:"config-section"},ra=["aria-expanded"],da={class:"section-title"},ua={class:"expand-hint"},pa={key:0,class:"design-info"},ca={class:"design-stats"},ma={class:"stat"},va={class:"stat-value"},fa={class:"stat"},ga={class:"stat-value"},ya={class:"config-section"},Ca=Q({__name:"TrialConfiguration",setup(W){const x=Te("trialCreation"),n=B(!1),T=B(!1),f=z(()=>x.selectedPrompt.value),w=z(()=>f.value.type==="template"?150:100);return(y,o)=>{var b;return g(),k("div",na,[e("div",ia,[e("section",oa,[o[6]||(o[6]=e("h2",{class:"section-title"},"Trial Details",-1)),u(Mt,{name:I(x).trialName.value,"repeat-count":I(x).repeatCount.value,description:((b=I(x).description)==null?void 0:b.value)||"","total-combinations":I(x).totalCombinations.value,"onUpdate:name":o[0]||(o[0]=D=>I(x).trialName.value=D),"onUpdate:repeatCount":o[1]||(o[1]=D=>I(x).repeatCount.value=D),"onUpdate:description":o[2]||(o[2]=D=>I(x).description.value=D)},null,8,["name","repeat-count","description","total-combinations"])]),e("section",la,[e("button",{class:"collapsible-header",onClick:o[3]||(o[3]=D=>n.value=!n.value),"aria-expanded":n.value},[u(I(we),{class:ne([{expanded:n.value},"expand-icon"])},null,8,["class"]),e("h2",da,[o[7]||(o[7]=O("Selected Design Preview ")),e("span",ua,"(click to "+_(n.value?"collapse":"expand")+")",1)])],8,ra),n.value?(g(),k("div",pa,[u(ie,{template:f.value,"variable-lists":I(x).variableLists.value,cycling:T.value,"show-controls":!0,"display-mode":"block","show-legend":!0,"onUpdate:paused":o[4]||(o[4]=D=>T.value=!D),onBackToSelect:o[5]||(o[5]=D=>y.$emit("back"))},null,8,["template","variable-lists","cycling"]),e("div",ca,[e("div",ma,[o[8]||(o[8]=e("span",{class:"stat-label"},"Total Combinations:",-1)),e("span",va,_(I(x).totalCombinations.value),1)]),e("div",fa,[o[9]||(o[9]=e("span",{class:"stat-label"},"Estimated Tokens:",-1)),e("span",ga,"~"+_(w.value)+" per call",1)])])])):L("",!0)]),e("section",ya,[o[10]||(o[10]=e("h2",{class:"section-title"},"Add Models and Set Parameters",-1)),u(sa,{configurations:I(x).configurations.value,"total-combinations":I(x).totalCombinations.value,"repeat-count":I(x).repeatCount.value,"avg-tokens":w.value,onAddConfiguration:I(x).addConfiguration,onRemoveConfiguration:I(x).removeConfiguration},null,8,["configurations","total-combinations","repeat-count","avg-tokens","onAddConfiguration","onRemoveConfiguration"])])])])}}}),_a=Z(Ca,[["__scopeId","data-v-c95afe8d"]]),ba={class:"trial-submission"},ha={class:"review-section"},ka={class:"summary-card"},$a={class:"summary-item"},Ta={class:"value"},wa={class:"summary-item"},Ia={class:"value"},Sa={class:"summary-item"},Pa={class:"value"},xa={key:0,class:"summary-item"},Da={class:"value"},Va={key:1,class:"summary-item"},Na={class:"value"},Oa={class:"summary-item"},Aa={class:"value"},Ma={key:2,class:"summary-item"},La={class:"value"},Ea={class:"summary-item"},za={class:"value highlight"},Ra={key:3,class:"summary-item"},ja={class:"value highlight"},Ba={class:"configurations-review"},Fa={class:"config-header"},Ua={class:"config-name"},Ja={class:"config-model"},qa={class:"config-params"},Wa={key:0,class:"running-trials-warning"},Ka={class:"action-buttons"},Ha={key:0},Ga={key:1},Ya=Q({__name:"TrialSubmission",props:{trialConfig:{},design:{}},emits:["back","create-draft","create-and-start","export-python"],setup(W,{emit:x}){const n=W,T=x,f=Ie(),w=B(null),y=B(!1),o=B(!1),b=z(()=>f.runningTrials.value.length>0),D=z(()=>f.runningTrials.value.length),V=z(()=>{var t,l,a,d;if(!n.trialConfig.configurations)return 0;let p=1;if(n.design.type==="template"&&n.design.variables)for(const[,C]of Object.entries(n.design.variables)){const h=C;if(h.type==="value"&&h.values)p*=h.values.length;else if(h.type==="list"&&h.listId){const i=(t=f.variableLists.value)==null?void 0:t.find(m=>m.id===h.listId);i&&(i.category==="simple"?p*=((l=i.values)==null?void 0:l.length)||0:i.category==="attributed"?p*=((a=i.items)==null?void 0:a.length)||0:i.category==="tabular"&&(p*=i.itemCount||0))}}else if(n.design.type==="spreadsheet"){const C=(d=f.variableLists.value)==null?void 0:d.find(h=>h.id===n.design.datasetId);p=(C==null?void 0:C.itemCount)||0}const r=n.trialConfig.repeatCount||1;return p*n.trialConfig.configurations.length*r}),S=z(()=>{var t,l,a;if(!n.trialConfig.configurations)return 0;let p=0;const r=150;for(const d of n.trialConfig.configurations){const C=(t=f.models.value)==null?void 0:t.find(h=>h.provider===d.provider&&h.modelId===d.modelId);if(C!=null&&C.capabilities){const h=((l=d.parameters)==null?void 0:l.max_tokens)||((a=d.parameters)==null?void 0:a.maxTokens)||256,i=(C.capabilities.inputCostPerToken||0)*r,m=(C.capabilities.outputCostPerToken||0)*h;p+=i+m}}return p*V.value});function R(p){const r=[];"temperature"in p&&r.push(`temperature=${p.temperature}`),"max_tokens"in p&&r.push(`max_tokens=${p.max_tokens}`),"top_p"in p&&r.push(`top_p=${p.top_p}`);const t=Object.keys(p).length-r.length;return t>0&&r.push(`+${t} more`),r.join(", ")}function A(){return{name:n.trialConfig.name||"",description:n.trialConfig.description,type:n.design.type,configurations:n.trialConfig.configurations||[],repeatCount:n.trialConfig.repeatCount||1,templateConfig:n.trialConfig.templateConfig,spreadsheetConfig:n.trialConfig.spreadsheetConfig}}async function c(){w.value="draft";try{const p=A();T("create-draft",p)}finally{w.value=null}}async function s(){y.value=!0;try{const p=A();T("export-python",p)}finally{y.value=!1}}function P(){b.value||S.value>10?o.value=!0:F()}async function F(){o.value=!1,w.value="start";try{const p=A();T("create-and-start",p)}finally{w.value=null}}return(p,r)=>{var d;const t=E("a-button"),l=E("a-alert"),a=E("a-modal");return g(),k("div",ba,[u(t,{type:"link",onClick:r[0]||(r[0]=C=>p.$emit("back")),class:"back-button"},{default:$(()=>[u(I(Se)),r[3]||(r[3]=O(" Back to Configuration "))]),_:1,__:[3]}),e("div",ha,[r[15]||(r[15]=e("h2",null,"Review & Create Trial",-1)),e("div",ka,[r[13]||(r[13]=e("h3",null,"Trial Summary",-1)),e("div",$a,[r[4]||(r[4]=e("span",{class:"label"},"Name:",-1)),e("span",Ta,_(p.trialConfig.name),1)]),e("div",wa,[r[5]||(r[5]=e("span",{class:"label"},"Type:",-1)),e("span",Ia,_(p.design.type==="template"?"Template":"Spreadsheet"),1)]),e("div",Sa,[r[6]||(r[6]=e("span",{class:"label"},"Design:",-1)),e("span",Pa,_(p.design.name),1)]),p.design.type==="template"?(g(),k("div",xa,[r[7]||(r[7]=e("span",{class:"label"},"Variables:",-1)),e("span",Da,_(Object.keys(p.design.variables||{}).length)+" variables configured ",1)])):L("",!0),p.design.type==="spreadsheet"?(g(),k("div",Va,[r[8]||(r[8]=e("span",{class:"label"},"Dataset:",-1)),e("span",Na,_(p.design.rowCount)+" rows",1)])):L("",!0),e("div",Oa,[r[9]||(r[9]=e("span",{class:"label"},"Model Configurations:",-1)),e("span",Aa,_(((d=p.trialConfig.configurations)==null?void 0:d.length)||0)+" models",1)]),p.trialConfig.repeatCount&&p.trialConfig.repeatCount>1?(g(),k("div",Ma,[r[10]||(r[10]=e("span",{class:"label"},"Repeat Count:",-1)),e("span",La,_(p.trialConfig.repeatCount)+" times per prompt",1)])):L("",!0),e("div",Ea,[r[11]||(r[11]=e("span",{class:"label"},"Total API Calls:",-1)),e("span",za,_(V.value),1)]),S.value>0?(g(),k("div",Ra,[r[12]||(r[12]=e("span",{class:"label"},"Estimated Cost:",-1)),e("span",ja,"$"+_(S.value.toFixed(4)),1)])):L("",!0)]),e("div",Ba,[r[14]||(r[14]=e("h3",null,"Model Configurations",-1)),(g(!0),k(X,null,ee(p.trialConfig.configurations,(C,h)=>(g(),k("div",{key:`review-config-${h}`,class:"config-review-item"},[e("div",Fa,[e("span",Ua,_(C.name||C.modelId),1),e("span",Ja,_(C.provider)+":"+_(C.modelId),1)]),e("div",qa,_(R(C.parameters)),1)]))),128))]),b.value?(g(),k("div",Wa,[u(l,{message:"Running Trials Detected",description:`You have ${D.value} trial(s) currently running. Starting a new trial may affect performance.`,type:"warning","show-icon":""},null,8,["description"])])):L("",!0)]),e("div",Ka,[u(t,{size:"large",onClick:c,loading:w.value==="draft"},{default:$(()=>[u(I(me)),r[16]||(r[16]=O(" Create as Draft "))]),_:1,__:[16]},8,["loading"]),u(t,{size:"large",onClick:s,loading:y.value},{default:$(()=>[u(I(Re)),r[17]||(r[17]=O(" Export to Python "))]),_:1,__:[17]},8,["loading"]),u(t,{type:"primary",size:"large",onClick:P,loading:w.value==="start"},{default:$(()=>[u(I(Pe)),r[18]||(r[18]=O(" Create and Start "))]),_:1,__:[18]},8,["loading"])]),u(a,{visible:o.value,"onUpdate:visible":r[1]||(r[1]=C=>o.value=C),title:"Confirm Trial Creation",onOk:F,onCancel:r[2]||(r[2]=C=>o.value=!1)},{default:$(()=>[r[19]||(r[19]=e("p",null,"You are about to create and start a trial with:",-1)),e("ul",null,[e("li",null,_(V.value)+" API calls",1),S.value>0?(g(),k("li",Ha,"Estimated cost: $"+_(S.value.toFixed(4)),1)):L("",!0),b.value?(g(),k("li",Ga,_(D.value)+" other trial(s) running",1)):L("",!0)]),r[20]||(r[20]=e("p",null,"Do you want to proceed?",-1))]),_:1,__:[19,20]},8,["visible"])])}}}),Qa=Z(Ya,[["__scopeId","data-v-49870505"]]),Za={class:"conflict-content"},Xa={class:"warning-section"},es={class:"warning-text"},ts={class:"trial-info"},as={class:"summary-grid"},ss={class:"summary-item"},ns={class:"value"},is={class:"summary-item"},os={class:"value"},ls={key:0,class:"summary-item"},rs={class:"value"},ds={class:"modal-footer"},us=Q({__name:"TrialConflictModal",props:{visible:{type:Boolean},runningTrial:{},trialConfig:{},totalApiCalls:{},estimatedCost:{}},emits:["update:visible","cancel","create-draft"],setup(W,{emit:x}){const n=W,T=x,f=B(!1);function w(){T("update:visible",!1),T("cancel")}async function y(){if(n.trialConfig){f.value=!0;try{T("create-draft",n.trialConfig),T("update:visible",!1)}finally{f.value=!1}}}return(o,b)=>{const D=E("a-button"),V=E("a-modal");return g(),G(V,{visible:o.visible,title:"Running Trial Detected",closable:!1,"mask-closable":!1,width:"600px",onCancel:w},{footer:$(()=>[e("div",ds,[u(D,{onClick:w,disabled:f.value},{default:$(()=>b[8]||(b[8]=[O(" Cancel ")])),_:1,__:[8]},8,["disabled"]),u(D,{type:"primary",onClick:y,loading:f.value},{default:$(()=>[u(I(me)),b[9]||(b[9]=O(" Create Draft "))]),_:1,__:[9]},8,["loading"])])]),default:$(()=>{var S,R;return[e("div",Za,[e("div",Xa,[u(I(xe),{class:"warning-icon"}),e("div",es,[b[2]||(b[2]=e("h3",null,"Another trial is currently running",-1)),e("p",null,[b[0]||(b[0]=O(' The trial "')),e("strong",null,_((S=o.runningTrial)==null?void 0:S.name),1),b[1]||(b[1]=O('" is currently executing. You can only run one trial at a time. '))])])]),b[7]||(b[7]=e("div",{class:"message-section"},[e("p",null,"You can only run one trial at a time. Your new trial will be saved as a draft and you can start it manually after the current trial finishes, or you can pause or cancel the running trial, then start your new draft trial.")],-1)),e("div",ts,[b[6]||(b[6]=e("h4",null,"New Trial Summary:",-1)),e("div",as,[e("div",ss,[b[3]||(b[3]=e("span",{class:"label"},"Name:",-1)),e("span",ns,_((R=o.trialConfig)==null?void 0:R.name),1)]),e("div",is,[b[4]||(b[4]=e("span",{class:"label"},"API Calls:",-1)),e("span",os,_(o.totalApiCalls),1)]),o.estimatedCost>0?(g(),k("div",ls,[b[5]||(b[5]=e("span",{class:"label"},"Estimated Cost:",-1)),e("span",rs,"$"+_(o.estimatedCost.toFixed(4)),1)])):L("",!0)])])])]}),_:1},8,["visible"])}}}),ps=Z(us,[["__scopeId","data-v-6c2d242e"]]),cs={class:"trial-creation-content"},ms={class:"step-content"},vs={key:1,class:"modal-footer"},fs={key:2,class:"create-actions"},gs={key:2,class:"view-footer"},ys={key:0,class:"validation-errors"},Cs={class:"create-actions"},_s=Q({__name:"TrialCreationContent",props:{mode:{},initialData:{}},emits:["cancel","create-template","create-spreadsheet","created","created-and-started","export-python"],setup(W,{expose:x,emit:n}){const T=W,f=n,w=z(()=>{var a,d;return{type:((a=T.initialData)==null?void 0:a.type)||"create",sourceTrialId:(d=T.initialData)==null?void 0:d.sourceTrialId}}),y=Be(De(w));Ve("trialCreation",y);const o=B(0),b=B(!1),D=B(null),V=B(null),S=B(null);x({currentStep:o});const R=z(()=>{if(T.mode==="view")return y.selectedPrompt.value!==null&&y.canProceed.value&&y.configurations.value.length>0;switch(o.value){case 0:return y.selectedPrompt.value!==null;case 1:return y.canProceed.value;default:return!0}}),A=z(()=>{const a=[];return y.selectedPrompt.value||a.push("Select a template or spreadsheet"),y.configurations.value.length===0&&a.push("Add at least one model configuration"),y.trialName.value.trim()===""&&a.push("Enter a trial name"),a.join(" • ")});function c(){var d;const a=JSON.parse(JSON.stringify(y.selectedPrompt.value));return{name:y.trialName.value,description:((d=y.description)==null?void 0:d.value)||"",type:a.type,configurations:JSON.parse(JSON.stringify(y.configurations.value)),repeatCount:y.repeatCount.value,templateConfig:a.type==="template"?{template:a.template,variables:a.variables,outputType:a.outputType,extractPattern:a.extractPattern,refusalWords:a.refusalWords,rejectRefusalWords:a.rejectRefusalWords}:void 0,spreadsheetConfig:a.type==="spreadsheet"?{promptPattern:a.promptPattern,datasetId:a.datasetId}:void 0}}function s(a){y.selectPrompt(a),T.mode==="view"&&(o.value=1)}async function P(){try{const a=await y.createTrialAsDraft();a&&f("created",a)}catch(a){H.error("Failed to create draft trial:",a)}}async function F(){try{const a=await y.createAndStartTrial();a&&(a.needsConfirmation?(D.value=c(),V.value=a.trialId,S.value="runningTrial"in a?a.runningTrial:null,b.value=!0):f("created-and-started",a.trialId))}catch(a){H.error("Failed to create and start trial:",a)}}async function p(){f("export-python",c())}function r(){l()}async function t(){try{V.value&&f("created",V.value),l()}catch(a){H.error("Failed to handle draft creation:",a)}}function l(){b.value=!1,D.value=null,V.value=null,S.value=null}return oe(async()=>{var a,d;if(await y.initialize(),(a=T.initialData)!=null&&a.templateId&&((d=T.initialData)==null?void 0:d.promptSource)==="template"){const C=()=>{const h=y.templates.value.find(i=>{var m;return i.id===((m=T.initialData)==null?void 0:m.templateId)});return h?(y.selectPrompt(h),o.value=1,!0):!1};if(!C()){const h=Y(()=>y.templates.value,()=>{C()&&h()},{immediate:!0});setTimeout(()=>h(),3e3)}}}),Y(o,()=>{T.mode==="view"&&window.scrollTo(0,0)}),(a,d)=>{const C=E("a-step"),h=E("a-steps"),i=E("a-button");return g(),k("div",cs,[a.mode==="modal"?(g(),G(h,{key:0,current:o.value,class:"creation-steps"},{default:$(()=>[u(C,{title:"Select Design"}),u(C,{title:"Configure Trial"}),u(C,{title:"Review & Create"})]),_:1},8,["current"])):L("",!0),e("div",ms,[o.value===0?(g(),G(Nt,{key:0,templates:I(y).templates.value,spreadsheets:I(y).spreadsheets.value,"variable-lists":I(y).variableLists.value,onSelect:s,onCreateTemplate:d[0]||(d[0]=m=>a.$emit("create-template")),onCreateSpreadsheet:d[1]||(d[1]=m=>a.$emit("create-spreadsheet"))},null,8,["templates","spreadsheets","variable-lists"])):o.value===1?(g(),G(_a,{key:1,onBack:d[2]||(d[2]=m=>o.value--)})):o.value===2?(g(),G(Qa,{key:2,"trial-config":c(),design:I(y).selectedPrompt.value,onBack:d[3]||(d[3]=m=>o.value--),onCreateDraft:P,onCreateAndStart:F,onExportPython:p},null,8,["trial-config","design"])):L("",!0)]),T.mode==="modal"?(g(),k("div",vs,[u(i,{onClick:d[4]||(d[4]=m=>a.$emit("cancel"))},{default:$(()=>d[8]||(d[8]=[O("Cancel")])),_:1,__:[8]}),o.value>0?(g(),G(i,{key:0,onClick:d[5]||(d[5]=m=>o.value--)},{default:$(()=>d[9]||(d[9]=[O(" Back ")])),_:1,__:[9]})):L("",!0),o.value<2?(g(),G(i,{key:1,type:"primary",disabled:!R.value,onClick:d[6]||(d[6]=m=>o.value++)},{default:$(()=>d[10]||(d[10]=[O(" Next ")])),_:1,__:[10]},8,["disabled"])):L("",!0),o.value===2?(g(),k("div",fs,[u(i,{type:"primary",disabled:!R.value,onClick:P},{default:$(()=>d[11]||(d[11]=[O(" Create Draft ")])),_:1,__:[11]},8,["disabled"]),u(i,{type:"primary",disabled:!R.value,onClick:F},{default:$(()=>d[12]||(d[12]=[O(" Create & Start ")])),_:1,__:[12]},8,["disabled"])])):L("",!0)])):L("",!0),T.mode==="view"?(g(),k("div",gs,[R.value?L("",!0):(g(),k("div",ys,_(A.value),1)),e("div",Cs,[u(i,{size:"large",disabled:!R.value,onClick:p},{default:$(()=>d[13]||(d[13]=[O(" Export Python ")])),_:1,__:[13]},8,["disabled"]),u(i,{type:"primary",size:"large",disabled:!R.value,onClick:P},{default:$(()=>d[14]||(d[14]=[O(" Create Draft ")])),_:1,__:[14]},8,["disabled"]),u(i,{type:"primary",size:"large",disabled:!R.value,onClick:F},{default:$(()=>d[15]||(d[15]=[O(" Create & Start ")])),_:1,__:[15]},8,["disabled"])])])):L("",!0),u(ps,{visible:b.value,"onUpdate:visible":d[7]||(d[7]=m=>b.value=m),"running-trial":S.value,"trial-config":D.value,"total-api-calls":I(y).totalExperiments.value,"estimated-cost":I(y).totalCost.value,onCancel:r,onCreateDraft:t},null,8,["visible","running-trial","trial-config","total-api-calls","estimated-cost"])])}}}),bs=Z(_s,[["__scopeId","data-v-483a6718"]]),hs={class:"trial-creation-view"},ks={class:"creation-header"},$s={class:"header-title"},Ts={class:"creation-content"},ws=Q({__name:"TrialCreationV3",setup(W){const x=Ne(),n=Oe(),T=B(),f=B(null);async function w(){const A=x.query;if(A.duplicate){const c=A.duplicate;T.value={type:"duplicate",sourceTrialId:c}}else A.designId&&A.promptSource==="template"&&(T.value={type:"create",templateId:A.designId,promptSource:"template"})}function y(){n.push("/trials")}function o(){f.value&&(f.value.currentStep=0)}async function b(A){se.success("Trial created as draft"),n.push({path:"/trials",query:{trialId:A,tab:"details"}})}async function D(A){se.success("Trial created and started"),n.push({path:"/trials",query:{trialId:A,tab:"tasks"}})}async function V(){se.info("Python export not yet implemented")}function S(){n.push("/templates/new")}function R(){n.push("/spreadsheet")}return oe(()=>{w()}),(A,c)=>{var P;const s=E("a-button");return g(),k("div",hs,[e("div",ks,[e("div",$s,[c[1]||(c[1]=e("h1",null,"Create New Trial",-1)),((P=f.value)==null?void 0:P.currentStep)===1?(g(),G(s,{key:0,type:"link",class:"back-button",onClick:o},{default:$(()=>[u(I(ue)),c[0]||(c[0]=O(" Back to Select Template "))]),_:1,__:[0]})):L("",!0)]),u(s,{onClick:y},{default:$(()=>c[2]||(c[2]=[O("Cancel")])),_:1,__:[2]})]),e("div",Ts,[u(bs,{ref_key:"creationContentRef",ref:f,mode:"view","initial-data":T.value,onCancel:y,onCreated:b,onCreatedAndStarted:D,onExportPython:V,onCreateTemplate:S,onCreateSpreadsheet:R},null,8,["initial-data"])])])}}}),Ls=Z(ws,[["__scopeId","data-v-38a5dd3b"]]);export{Ls as default};
