const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./PythonExportService-BL-hrLR8.js","./index-CPkYwVf3.js","./vendor-DdqHZeTC.js","./db-ftwlfnxb.js","./index-DXqFmLeW.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{d as s,r as a,i as l,B as n,b as o,e as i,f as r,g as c,F as u,D as d,t as p,o as v,m,V as g,n as b,w as h,I as y,u as f,_ as k,$ as _,k as x,X as C,p as w}from"./vendor-DdqHZeTC.js";import{D,_ as E,a as O,u as M,b as T,c as I}from"./index-CPkYwVf3.js";import{u as $}from"./variableLists-BjyZEd9B.js";import"./db-ftwlfnxb.js";function S(e,t){let s=e;for(const[a,l]of Object.entries(t)){const e=new RegExp(`{{\\s*${a}\\s*}}`,"g"),t=Array.isArray(l)?l.join(", "):String(l);s=s.replace(e,t)}return function(e){const t=e.split(/\s+/);let s=0;for(const l of t)0!==l.length&&(l.length<=4?s+=1:l.length<=8?s+=Math.ceil(l.length/4):s+=Math.ceil(l.length/3.5));const a=e.match(/[.,!?;:'"()\[\]{}<>@#$%^&*+=|\\\/~`-]/g);return a&&(s+=.5*a.length),Math.ceil(s)}(s)}const R=class e{constructor(){t(this,"dbService"),this.dbService=D.getInstance()}static getInstance(){return e.instance||(e.instance=new e),e.instance}async calculateExperimentMetrics(e,t=[]){let s=1,a=0,l=0;const n=e.variables||{};for(const[i,r]of Object.entries(n))Array.isArray(r)&&r.length>0&&(s*=r.length,a++);const o=e.variable_list_refs||{};for(const[i,r]of Object.entries(o)){let e=t.find(e=>e.id===r);if(!e){const t=await this.dbService.read("variable_lists",r);t.success&&t.data&&(e=t.data)}e&&e.values&&e.values.length>0&&(s*=e.values.length,l++)}return{totalCombinations:s,variableCount:a+l,simpleVariables:a,compoundVariables:l,estimatedTasks:s}}async estimateExperimentCost(e,t,s=[],a={}){const l=await this.calculateExperimentMetrics(e,s),n=l.totalCombinations*t.length,{estimatedInputTokens:o=100,estimatedOutputTokens:i=50}=a;let r=0;const c={};for(const u of t){const e="openrouter"===u.provider?u.input_cost||0:(u.input_cost||0)/1e6,t="openrouter"===u.provider?u.output_cost||0:(u.output_cost||0)/1e6;console.log(`DEBUG: Model ${u.id}, provider: ${u.provider}`),console.log(`DEBUG: Raw costs - input: ${u.input_cost}, output: ${u.output_cost}`),console.log(`DEBUG: Per-token costs - input: ${e}, output: ${t}`);const s=e*o*l.totalCombinations,a=t*i*l.totalCombinations,n=s+a;console.log(`DEBUG: Final costs - input: ${s}, output: ${a}, total: ${n}`),c[u.id]=n,r+=n}return{totalCost:r,costPerModel:c,costPerTask:n>0?r/n:0,breakdown:{inputTokens:o*n,outputTokens:i*n,requests:n}}}validateExperimentSize(e,t){const s=e.totalCombinations*t,a=[],l=[];return s>1e3&&a.push(`Large experiment: ${s} tasks may take significant time`),s>1e4&&a.push("Very large experiment: Consider running in batches"),s>5e4&&l.push(`Experiment too large: ${s} tasks exceeds maximum of 50,000`),e.totalCombinations>1e5&&l.push(`Too many variable combinations: ${e.totalCombinations} exceeds maximum of 100,000`),{valid:0===l.length,warnings:a,errors:l}}};t(R,"instance");let L=R;const A={class:"basics-step"},j={class:"form-section"},P={class:"form-group"},F=["value"],V={class:"form-group"},U=["value"],B=["value"],N={class:"form-group"},q={class:"execution-type-options"},G={class:"radio-option"},z=["checked"],K={class:"radio-option"},H=["checked"],J={key:0,class:"design-preview"},W={class:"preview-card"},Z={class:"preview-header"},X={class:"variable-count"},Y={class:"prompt-preview"},Q={class:"prompt-header"},ee={key:0,class:"prompt-controls"},te=["disabled"],se={class:"prompt-counter"},ae=["disabled"],le={class:"prompt-content"},ne={key:0,class:"preview-note"},oe={key:0,class:"variables-preview"},ie={class:"variables-list"},re={class:"variable-name"},ce={class:"current-value"},ue={class:"variable-count"},de={class:"variable-name"},pe={class:"current-value"},ve={class:"variable-count"},me={class:"combinations-info"},ge={class:"info-value"},be={key:1,class:"empty-state"},he=100,ye=E(s({__name:"RunBasicsStep",props:{name:{},designId:{},designs:{},selectedDesign:{},executionType:{}},emits:["update:name","update:design-id","update:execution-type"],setup(e,{emit:t}){const s=e,v=t,m=$(),g=a(0),b=l(()=>{if(!s.selectedDesign)return 0;return Object.keys(s.selectedDesign.variables||{}).length+Object.keys(s.selectedDesign.variable_list_refs||{}).length}),h=a(0);n(()=>[s.selectedDesign,m.variableLists],async()=>{if(!s.selectedDesign)return void(h.value=0);const e=L.getInstance(),t=await e.calculateExperimentMetrics(s.selectedDesign,m.variableLists);h.value=t.totalCombinations},{immediate:!0,deep:!0});const y=l(()=>{if(!s.selectedDesign)return[];const e=s.selectedDesign.variables||{},t=s.selectedDesign.variable_list_refs||{},a={};for(const[s,i]of Object.entries(e))a[s]=Array.isArray(i)?i:[String(i)];for(const[s,i]of Object.entries(t)){const e=m.variableLists.find(e=>e.id===i);e&&e.values&&(a[s]=e.values)}const l=Object.keys(a);if(0===l.length)return[{}];const n=[],o=Math.min(h.value,he);!function e(t,s){if(n.length>=o)return;if(t>=l.length)return void n.push({...s});const i=l[t],r=a[i];for(const a of r){if(n.length>=o)return;s[i]=a,e(t+1,s)}}(0,{});for(let s=n.length-1;s>0;s--){const e=Math.floor(Math.random()*(s+1));[n[s],n[e]]=[n[e],n[s]]}return n}),f=l(()=>{if(!s.selectedDesign||0===y.value.length)return s.selectedDesign?.prompt_template||"";const e=y.value[g.value]||{};let t=s.selectedDesign.prompt_template;for(const[s,a]of Object.entries(e)){const e=new RegExp(`{{\\s*${s}\\s*}}`,"g");t=t.replace(e,a)}return t}),k=l(()=>s.selectedDesign&&0!==y.value.length&&y.value[g.value]||{});function _(){g.value>0&&g.value--}function x(){const e=Math.min(h.value,he)-1;g.value<e&&g.value++}function C(e){const t="string"==typeof e?parseInt(e):e,s=m.variableLists.find(e=>e.id===t);return s?.values?.length||0}return n(()=>s.selectedDesign?.id,()=>{g.value=0}),(e,t)=>(i(),o("div",A,[t[18]||(t[18]=r("div",{class:"step-header"},[r("h3",null,"Run Basics"),r("p",null,"Give your run a name and choose the design to evaluate.")],-1)),r("div",j,[r("div",P,[t[4]||(t[4]=r("label",{for:"run-name"},"Run Name",-1)),r("input",{id:"run-name",value:e.name,type:"text",class:"form-control",placeholder:"e.g., Product Review Analysis - V1",required:"",onInput:t[0]||(t[0]=e=>v("update:name",e.target.value))},null,40,F),t[5]||(t[5]=r("span",{class:"form-hint"},"Choose a descriptive name to identify this run later",-1))]),r("div",V,[t[7]||(t[7]=r("label",{for:"design-select"},"Design",-1)),r("select",{id:"design-select",value:e.designId,class:"form-control",required:"",onChange:t[1]||(t[1]=e=>v("update:design-id",Number(e.target.value)||null))},[t[6]||(t[6]=r("option",{value:null}," Select a design... ",-1)),(i(!0),o(u,null,d(e.designs,e=>(i(),o("option",{key:e.id,value:e.id},p(e.name),9,B))),128))],40,U),t[8]||(t[8]=r("span",{class:"form-hint"},"The prompt template and variables to evaluate",-1))]),r("div",N,[t[11]||(t[11]=r("label",null,"Execution Type",-1)),r("div",q,[r("label",G,[r("input",{type:"radio",value:"browser",checked:"browser"===e.executionType,name:"execution-type",onChange:t[2]||(t[2]=e=>v("update:execution-type","browser"))},null,40,z),t[9]||(t[9]=r("span",{class:"radio-label"},[r("strong",null,"Run in Browser"),r("small",null,"Execute immediately using your browser")],-1))]),r("label",K,[r("input",{type:"radio",value:"python_export",checked:"python_export"===e.executionType,name:"execution-type",onChange:t[3]||(t[3]=e=>v("update:execution-type","python_export"))},null,40,H),t[10]||(t[10]=r("span",{class:"radio-label"},[r("strong",null,"Export Python Package"),r("small",null,"Download a standalone Python script for external execution")],-1))])])])]),e.selectedDesign?(i(),o("div",J,[t[16]||(t[16]=r("h4",null,"Design Preview",-1)),r("div",W,[r("div",Z,[r("h5",null,p(e.selectedDesign.name),1),r("span",X,p(b.value)+" variables",1)]),r("div",Y,[r("div",Q,[t[12]||(t[12]=r("label",null,"Prompt Preview:",-1)),h.value>1?(i(),o("div",ee,[r("button",{disabled:0===g.value,class:"nav-btn",onClick:_}," ‚Üê ",8,te),r("span",se,p(g.value+1)+" of "+p(Math.min(h.value,he)),1),r("button",{disabled:g.value>=Math.min(h.value,he)-1,class:"nav-btn",onClick:x}," ‚Üí ",8,ae)])):c("",!0)]),r("div",le,[r("pre",null,p(f.value),1)]),h.value>he?(i(),o("div",ne," Showing first "+p(he)+" of "+p(h.value.toLocaleString())+" combinations ",1)):c("",!0)]),b.value>0?(i(),o("div",oe,[t[14]||(t[14]=r("label",null,"Variables:",-1)),r("div",ie,[(i(!0),o(u,null,d(e.selectedDesign.variables,(e,t)=>(i(),o("div",{key:t,class:"variable-summary"},[r("span",re,p(t),1),r("span",ce,"("+p(k.value[t]||"N/A")+")",1),r("span",ue,p(Array.isArray(e)?e.length:1)+" values",1)]))),128)),(i(!0),o(u,null,d(e.selectedDesign.variable_list_refs,(e,s)=>(i(),o("div",{key:`list-${s}`,class:"variable-summary"},[r("span",de,p(s),1),r("span",pe,"("+p(k.value[s]||"N/A")+")",1),r("span",ve,p(C(e))+" values",1),t[13]||(t[13]=r("span",{class:"variable-source"},"(from list)",-1))]))),128))])])):c("",!0),r("div",me,[t[15]||(t[15]=r("span",{class:"info-label"},"Total Combinations:",-1)),r("span",ge,p(h.value),1)])])])):0===e.designs.length?(i(),o("div",be,t[17]||(t[17]=[r("div",{class:"empty-icon"}," üìù ",-1),r("h4",null,"No Designs Available",-1),r("p",null,"You need to create a design first before you can create a run.",-1),r("button",{class:"btn btn-outline"}," Create Design ",-1)]))):c("",!0)]))}}),[["__scopeId","data-v-6cc4fabc"]]),fe={class:"model-selection-step"},ke={class:"selection-controls"},_e={class:"search-and-filters"},xe={class:"search-box"},Ce={class:"quick-filters"},we=["onClick"],De={class:"selection-summary"},Ee={class:"selected-count"},Oe={class:"parameters-section"},Me={class:"parameters-grid"},Te={class:"parameter-item"},Ie=["value"],$e={class:"parameter-item"},Se=["value"],Re={class:"parameter-item"},Le=["value"],Ae={class:"parameter-item"},je=["value"],Pe={key:0,class:"python-export-section"},Fe={class:"export-options-grid"},Ve={class:"option-group"},Ue=["value"],Be={class:"option-group"},Ne=["value"],qe={class:"option-group"},Ge=["value"],ze={class:"option-group"},Ke=["value"],He={class:"option-group"},Je=["value"],We={class:"option-checkboxes"},Ze={class:"checkbox-option"},Xe=["checked"],Ye={class:"checkbox-option"},Qe=["checked"],et={class:"checkbox-option"},tt=["checked"],st={class:"checkbox-option"},at=["checked"],lt={class:"checkbox-option"},nt=["checked"],ot={class:"models-grid"},it=["onClick"],rt={class:"provider-controls"},ct={class:"model-count"},ut=["onClick"],dt={key:0,class:"models-list"},pt=["onClick"],vt={class:"model-info"},mt={class:"model-details"},gt={key:0,class:"cost-info"},bt={key:1,class:"context-info"},ht={class:"selection-indicator"},yt={key:0},ft={key:1,class:"cost-estimate"},kt={class:"cost-summary"},_t={class:"cost-overview"},xt={class:"overview-item"},Ct={class:"value"},wt={class:"overview-item"},Dt={class:"value"},Et={class:"overview-item"},Ot={class:"value"},Mt={class:"overview-item total"},Tt={class:"value"},It={class:"cost-breakdown"},$t={class:"breakdown-table"},St={key:2,class:"task-estimate"},Rt={class:"estimate-card"},Lt={class:"estimate-details"},At={class:"estimate-item"},jt={class:"value"},Pt={class:"estimate-item"},Ft={class:"value"},Vt={class:"estimate-item total"},Ut={class:"value"},Bt=E(s({__name:"ModelSelectionStep",props:{selectedModels:{},allModels:{},design:{},taskCount:{},parameters:{},executionType:{},pythonExportOptions:{}},emits:["update:selected-models","update:parameters","update:python-export-options"],setup(e,{emit:t}){const s=e,y=t,f=a(""),k=a(""),_=a(new Set),x=[{id:"all",label:"All Models"},{id:"openai",label:"OpenAI"},{id:"anthropic",label:"Anthropic"},{id:"budget",label:"Budget"},{id:"premium",label:"Premium"}],C=l(()=>{let e=s.allModels;if(f.value){const t=f.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.provider.toLowerCase().includes(t))}if(k.value&&"all"!==k.value)switch(k.value){case"openai":e=e.filter(e=>e.provider.toLowerCase().includes("openai"));break;case"anthropic":e=e.filter(e=>e.provider.toLowerCase().includes("anthropic"));break;case"budget":e=e.filter(e=>(e.input_cost||0)<.001);break;case"premium":e=e.filter(e=>(e.input_cost||0)>=.001)}return e}),w=l(()=>{const e={};return C.value.forEach(t=>{e[t.provider]||(e[t.provider]=[]),e[t.provider].push(t)}),Object.keys(e).forEach(t=>{e[t].sort((e,t)=>e.name.localeCompare(t.name))}),e}),D=$(),E=a(0),O=a(null);n(()=>[s.design,D.variableLists],async()=>{if(s.design)try{O.value=null;const e=L.getInstance(),t=await e.calculateExperimentMetrics(s.design,D.variableLists);E.value=t.totalCombinations}catch(e){O.value=`Calculation error: ${e instanceof Error?e.message:"Unknown error"}`,E.value=0}else E.value=0},{immediate:!0,deep:!0});const M=l(()=>E.value*s.selectedModels.length*s.parameters.repetitions_per_prompt),T=l(()=>s.allModels.filter(e=>s.selectedModels.includes(e.id))),I=l(()=>{if(!s.design)return 50;const e=s.design.prompt_template?.length||200;return Math.ceil(e/4)}),S=a(0),R=a(null);n(()=>[s.design,T.value,s.parameters.max_tokens,s.parameters.repetitions_per_prompt,I.value,D.variableLists],async()=>{if(s.design&&0!==T.value.length)try{R.value=null;const e=L.getInstance(),t=await e.estimateExperimentCost(s.design,T.value,D.variableLists,{estimatedInputTokens:I.value,estimatedOutputTokens:s.parameters.max_tokens});S.value=t.totalCost}catch(e){R.value=`Cost calculation error: ${e instanceof Error?e.message:"Unknown error"}`,S.value=0}else S.value=0},{immediate:!0,deep:!0});const A=l(()=>T.value.map(e=>{const t=I.value,a=s.parameters.max_tokens,l=("openrouter"===e.provider?e.input_cost||0:(e.input_cost||0)/1e6)*t+("openrouter"===e.provider?e.output_cost||0:(e.output_cost||0)/1e6)*a,n=l*E.value*s.parameters.repetitions_per_prompt;return{model:e.name,inputTokens:t,outputTokens:a,costPerTask:l,totalCost:n}}));v(()=>{});const j=()=>{y("update:selected-models",[])};function P(e,t){y("update:parameters",{...s.parameters,[e]:t})}function F(e,t){y("update:python-export-options",{...s.pythonExportOptions,[e]:t})}const V=(e,t)=>{const s="input"===t?e.input_cost:e.output_cost;if(void 0===s)return"?";const a="openrouter"===e.provider?1e6*s:s;return a<.01?a.toFixed(4):a<1?a.toFixed(3):a<10?a.toFixed(2):a.toFixed(1)};return(e,t)=>(i(),o("div",fe,[t[42]||(t[42]=r("div",{class:"step-header"},[r("h3",null,"Select Models"),r("p",null,"Choose which models to evaluate with your design.")],-1)),r("div",ke,[r("div",_e,[r("div",xe,[m(r("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),type:"text",class:"search-input",placeholder:"Search models..."},null,512),[[g,f.value]])]),r("div",Ce,[(i(),o(u,null,d(x,e=>r("button",{key:e.id,class:b(["filter-btn",{active:k.value===e.id}]),onClick:t=>(e=>{k.value=e.id,"openai"===e.id?(_.value.clear(),_.value.add("OpenAI")):"anthropic"===e.id?(_.value.clear(),_.value.add("Anthropic")):"all"===e.id&&Object.keys(w.value).forEach(e=>{_.value.add(e)})})(e)},p(e.label),11,we)),64))])]),r("div",De,[r("span",Ee,p(e.selectedModels.length)+" models selected",1),e.selectedModels.length>0?(i(),o("button",{key:0,class:"clear-btn",onClick:j}," Clear All ")):c("",!0)])]),r("div",Oe,[t[18]||(t[18]=r("h4",null,"Parameters",-1)),r("div",Me,[r("div",Te,[r("label",null,"Temperature: "+p(s.parameters.temperature),1),r("input",{value:s.parameters.temperature,type:"range",min:"0",max:"2",step:"0.1",class:"parameter-slider",onInput:t[1]||(t[1]=e=>P("temperature",parseFloat(e.target.value)))},null,40,Ie)]),r("div",$e,[t[15]||(t[15]=r("label",null,"Max Output Tokens",-1)),r("input",{value:s.parameters.max_tokens,type:"number",min:"1",max:"4000",class:"parameter-input",onInput:t[2]||(t[2]=e=>P("max_tokens",parseInt(e.target.value)))},null,40,Se)]),r("div",Re,[t[16]||(t[16]=r("label",null,"Concurrency",-1)),r("input",{value:s.parameters.concurrency,type:"number",min:"1",max:"10",class:"parameter-input",onInput:t[3]||(t[3]=e=>P("concurrency",parseInt(e.target.value)))},null,40,Le)]),r("div",Ae,[t[17]||(t[17]=r("label",null,"Repetitions per Prompt",-1)),r("input",{value:s.parameters.repetitions_per_prompt,type:"number",min:"1",max:"10",class:"parameter-input",onInput:t[4]||(t[4]=e=>P("repetitions_per_prompt",parseInt(e.target.value)))},null,40,je)])])]),"python_export"===s.executionType?(i(),o("div",Pe,[t[31]||(t[31]=r("h4",null,"Python Export Options",-1)),r("div",Fe,[r("div",Ve,[t[20]||(t[20]=r("label",null,"Output Format",-1)),r("select",{value:s.pythonExportOptions.outputFormat,class:"option-select",onChange:t[5]||(t[5]=e=>F("outputFormat",e.target.value))},t[19]||(t[19]=[r("option",{value:"json"}," JSON only ",-1),r("option",{value:"csv"}," CSV only ",-1),r("option",{value:"both"}," Both JSON and CSV ",-1)]),40,Ue)]),r("div",Be,[t[22]||(t[22]=r("label",null,"Python Version",-1)),r("select",{value:s.pythonExportOptions.pythonVersion,class:"option-select",onChange:t[6]||(t[6]=e=>F("pythonVersion",e.target.value))},t[21]||(t[21]=[r("option",{value:"3.8+"}," Python 3.8+ ",-1),r("option",{value:"3.9+"}," Python 3.9+ ",-1),r("option",{value:"3.10+"}," Python 3.10+ ",-1)]),40,Ne)]),r("div",qe,[t[23]||(t[23]=r("label",null,"Max Retries",-1)),r("input",{value:s.pythonExportOptions.maxRetries,type:"number",min:"1",max:"10",class:"option-input",onInput:t[7]||(t[7]=e=>F("maxRetries",parseInt(e.target.value)))},null,40,Ge)]),r("div",ze,[t[24]||(t[24]=r("label",null,"Retry Backoff Multiplier",-1)),r("input",{value:s.pythonExportOptions.retryBackoffMultiplier,type:"number",min:"1",max:"5",step:"0.1",class:"option-input",onInput:t[8]||(t[8]=e=>F("retryBackoffMultiplier",parseFloat(e.target.value)))},null,40,Ke)]),r("div",He,[t[25]||(t[25]=r("label",null,"Timeout Override (seconds)",-1)),r("input",{value:s.pythonExportOptions.timeoutOverride||"",type:"number",min:"10",max:"300",placeholder:"Default",class:"option-input",onInput:t[9]||(t[9]=e=>F("timeoutOverride",e.target.value?parseInt(e.target.value):void 0))},null,40,Je)])]),r("div",We,[r("label",Ze,[r("input",{type:"checkbox",checked:s.pythonExportOptions.enableProgressBar,onChange:t[10]||(t[10]=e=>F("enableProgressBar",e.target.checked))},null,40,Xe),t[26]||(t[26]=r("span",null,"Enable progress bar",-1))]),r("label",Ye,[r("input",{type:"checkbox",checked:s.pythonExportOptions.verboseLogging,onChange:t[11]||(t[11]=e=>F("verboseLogging",e.target.checked))},null,40,Qe),t[27]||(t[27]=r("span",null,"Verbose logging",-1))]),r("label",et,[r("input",{type:"checkbox",checked:s.pythonExportOptions.enableCheckpointing,onChange:t[12]||(t[12]=e=>F("enableCheckpointing",e.target.checked))},null,40,tt),t[28]||(t[28]=r("span",null,"Enable checkpointing",-1))]),r("label",st,[r("input",{type:"checkbox",checked:s.pythonExportOptions.continueOnError,onChange:t[13]||(t[13]=e=>F("continueOnError",e.target.checked))},null,40,at),t[29]||(t[29]=r("span",null,"Continue on error",-1))]),r("label",lt,[r("input",{type:"checkbox",checked:s.pythonExportOptions.includeApiLogs,onChange:t[14]||(t[14]=e=>F("includeApiLogs",e.target.checked))},null,40,nt),t[30]||(t[30]=r("span",null,"Include API logs for debugging",-1))])])])):c("",!0),r("div",ot,[(i(!0),o(u,null,d(w.value,(t,a)=>(i(),o("div",{key:a,class:"provider-section"},[r("div",{class:"provider-header",onClick:e=>(e=>{_.value.has(e)?_.value.delete(e):_.value.add(e)})(a)},[r("h4",null,p(a),1),r("div",rt,[r("span",ct,p(t.length)+" models",1),r("button",{class:"select-all-btn",onClick:h(e=>((e,t)=>{const a=t.map(e=>e.id),l=[...s.selectedModels];if(a.every(e=>l.includes(e))){const e=l.filter(e=>!a.includes(e));y("update:selected-models",e)}else{const e=[...new Set([...l,...a])];y("update:selected-models",e)}})(0,t),["stop"])}," Select All ",8,ut),r("span",{class:b(["expand-icon",{expanded:_.value.has(a)}])}," ‚ñº ",2)])],8,it),_.value.has(a)?(i(),o("div",dt,[(i(!0),o(u,null,d(t,t=>{return i(),o("div",{key:t.id,class:b(["model-card",{selected:e.selectedModels.includes(t.id)}]),onClick:e=>(e=>{const t=[...s.selectedModels],a=t.indexOf(e);a>-1?t.splice(a,1):t.push(e),y("update:selected-models",t)})(t.id)},[r("div",vt,[r("h5",null,p(t.name),1),r("div",mt,[void 0!==t.input_cost?(i(),o("span",gt," $"+p(V(t,"input"))+"/$"+p(V(t,"output")),1)):c("",!0),t.context_window?(i(),o("span",bt,p((a=t.context_window,a>=1e6?`${(a/1e6).toFixed(1)}M`:a>=1e3?`${(a/1e3).toFixed(0)}K`:a.toString()))+" context ",1)):c("",!0)])]),r("div",ht,[r("div",{class:b(["checkbox",{checked:e.selectedModels.includes(t.id)}])},[e.selectedModels.includes(t.id)?(i(),o("span",yt,"‚úì")):c("",!0)],2)])],10,pt);var a}),128))])):c("",!0)]))),128))]),e.selectedModels.length>0&&e.design?(i(),o("div",ft,[t[37]||(t[37]=r("h4",null,"Cost Estimate",-1)),r("div",kt,[r("div",_t,[r("div",xt,[t[32]||(t[32]=r("span",{class:"label"},"Variable combinations:",-1)),r("span",Ct,p(E.value.toLocaleString()),1)]),r("div",wt,[t[33]||(t[33]=r("span",{class:"label"},"Selected models:",-1)),r("span",Dt,p(e.selectedModels.length),1)]),r("div",Et,[t[34]||(t[34]=r("span",{class:"label"},"Total tasks:",-1)),r("span",Ot,p(M.value.toLocaleString()),1)]),r("div",Mt,[t[35]||(t[35]=r("span",{class:"label"},"Estimated cost:",-1)),r("span",Tt,"$"+p(S.value.toFixed(3)),1)])]),r("div",It,[r("table",$t,[t[36]||(t[36]=r("thead",null,[r("tr",null,[r("th",null,"Model"),r("th",null,"Input Tokens"),r("th",null,"Output Tokens"),r("th",null,"Cost per Task"),r("th",null,"Total Cost")])],-1)),r("tbody",null,[(i(!0),o(u,null,d(A.value,e=>(i(),o("tr",{key:e.model},[r("td",null,p(e.model),1),r("td",null,p(e.inputTokens),1),r("td",null,p(e.outputTokens),1),r("td",null,"$"+p(e.costPerTask.toFixed(4)),1),r("td",null,"$"+p(e.totalCost.toFixed(3)),1)]))),128))])])])])])):c("",!0),e.design?(i(),o("div",St,[r("div",Rt,[t[41]||(t[41]=r("h4",null,"Task Estimate",-1)),r("div",Lt,[r("div",At,[t[38]||(t[38]=r("span",{class:"label"},"Variable combinations:",-1)),r("span",jt,p(E.value),1)]),r("div",Pt,[t[39]||(t[39]=r("span",{class:"label"},"Selected models:",-1)),r("span",Ft,p(e.selectedModels.length),1)]),r("div",Vt,[t[40]||(t[40]=r("span",{class:"label"},"Total tasks:",-1)),r("span",Ut,p(M.value),1)])])])])):c("",!0)]))}}),[["__scopeId","data-v-e579f46f"]]),Nt={class:"review-step"},qt={class:"review-sections"},Gt={class:"review-section"},zt={class:"summary-grid"},Kt={class:"summary-card"},Ht={class:"summary-card"},Jt={class:"summary-card"},Wt={class:"summary-card tokens"},Zt={class:"summary-card cost"},Xt={key:0},Yt={key:1},Qt={key:0,class:"review-section"},es={class:"cost-breakdown"},ts={class:"model-name"},ss={class:"task-count"},as={class:"model-cost"},ls={key:1,class:"review-section"},ns={class:"variables-compact"},os={class:"var-name"},is={class:"var-values"},rs={class:"var-name"},cs={class:"var-values"},us={class:"review-section"},ds={class:"config-summary"},ps={class:"config-grid"},vs={class:"config-item"},ms={class:"config-value"},gs={class:"config-description"},bs={class:"config-item"},hs={class:"config-value"},ys={class:"config-description"},fs={class:"config-item"},ks={class:"config-value"},_s={class:"config-description"},xs={class:"review-section"},Cs={class:"models-summary"},ws={class:"models-by-provider"},Ds={class:"provider-models"},Es={class:"model-name"},Os={class:"model-details"},Ms={key:0,class:"cost-info"},Ts={key:1,class:"cost-info"},Is={key:2,class:"context-info"},$s={key:2,class:"review-section"},Ss={key:0,class:"warnings"},Rs={key:1,class:"recommendations"},Ls=E(s({__name:"RunReviewStep",props:{formData:{},selectedDesign:{},selectedModels:{},taskCount:{},estimatedCost:{}},setup(e){const t=e,s=$(),v=l(()=>{if(!t.selectedDesign)return 0;return Object.keys(t.selectedDesign.variables||{}).length+Object.keys(t.selectedDesign.variable_list_refs||{}).length}),m=a(1),g=a(null);n(()=>[t.selectedDesign,s.variableLists],async()=>{if(t.selectedDesign)try{g.value=null;const e=L.getInstance(),a=await e.calculateExperimentMetrics(t.selectedDesign,s.variableLists);m.value=a.totalCombinations}catch(e){g.value=`Calculation error: ${e instanceof Error?e.message:"Unknown error"}`,m.value=1}else m.value=1},{immediate:!0,deep:!0});const b=e=>{const t="string"==typeof e?parseInt(e):e,a=s.variableLists.find(e=>e.id===t);return a?.values?.length||0},h=l(()=>{if(!t.selectedDesign)return{input:0,output:0};const e=t.selectedDesign.variables||{},s={};for(const[t,o]of Object.entries(e))s[t]=Array.isArray(o)?o[0]:o;const a=S(t.selectedDesign.prompt_template,s),l=t.formData.parameters.max_tokens,n=m.value*t.selectedModels.length;return{input:a*n,output:l*n}}),y=l(()=>{if(!t.selectedDesign)return[];const e=t.selectedDesign.variables||{},s={};for(const[t,n]of Object.entries(e))s[t]=Array.isArray(n)?n[0]:n;const a=S(t.selectedDesign.prompt_template,s),l=t.formData.parameters.max_tokens;return t.selectedModels.filter(e=>void 0!==e.input_cost&&void 0!==e.output_cost).map(e=>{const t=m.value,s="openrouter"===e.provider?e.input_cost:e.input_cost/1e6,n="openrouter"===e.provider?e.output_cost:e.output_cost/1e6,o=(s*a+n*l)*t;return{name:e.name,tasks:t,cost:o,inputTokens:a,outputTokens:l}}).sort((e,t)=>t.cost-e.cost)}),f=l(()=>{const e={};return t.selectedModels.forEach(t=>{e[t.provider]||(e[t.provider]=[]),e[t.provider].push(t)}),e}),k=l(()=>{const e=[];t.taskCount>1e3&&e.push(`Large run with ${t.taskCount} tasks will take significant time to complete`),t.estimatedCost>10&&e.push(`Estimated cost of $${t.estimatedCost.toFixed(2)} is quite high`);const s=t.selectedModels.filter(e=>void 0===e.input_cost||void 0===e.output_cost);return s.length>0&&e.push(`Cost data unavailable for ${s.length} model${s.length>1?"s":""}`),t.formData.parameters.concurrency>5&&t.selectedModels.some(e=>e.provider.includes("OpenAI"))&&e.push("High concurrency with OpenAI models may hit rate limits"),e}),_=l(()=>{const e=[];return t.taskCount>100&&1===t.formData.parameters.concurrency&&e.push("Consider increasing concurrency to speed up large runs"),t.formData.parameters.temperature>1.5&&e.push("Very high temperature may produce inconsistent results"),1===t.selectedModels.length&&e.push("Consider testing with multiple models for comparison"),e}),x=e=>void 0===e?"?":0===e?"0":e<1e-5?e.toExponential(2):e<.001?e.toFixed(6):e<.01?e.toFixed(4):e.toFixed(3),C=e=>e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toString();return(e,t)=>{return i(),o("div",Nt,[t[14]||(t[14]=r("div",{class:"step-header"},[r("h3",null,"Review")],-1)),r("div",qt,[r("div",Gt,[r("div",zt,[r("div",Kt,[r("h4",null,p(e.taskCount),1),t[0]||(t[0]=r("span",null,"Total Tasks",-1))]),r("div",Ht,[r("h4",null,p(m.value),1),t[1]||(t[1]=r("span",null,"Variable Combinations",-1))]),r("div",Jt,[r("h4",null,p(e.selectedModels.length),1),t[2]||(t[2]=r("span",null,"Models",-1))]),r("div",Wt,[r("h4",null,p(C(h.value.input))+" / "+p(C(h.value.output)),1),t[3]||(t[3]=r("span",null,"Input / Output Tokens",-1))]),r("div",Zt,[e.estimatedCost>0?(i(),o("h4",Xt," $"+p(e.estimatedCost.toFixed(4)),1)):(i(),o("h4",Yt," Unknown ")),t[4]||(t[4]=r("span",null,"Est. Cost",-1))])])]),y.value.length>0?(i(),o("div",Qt,[t[5]||(t[5]=r("h4",null,"Cost by Model",-1)),r("div",es,[(i(!0),o(u,null,d(y.value,e=>(i(),o("div",{key:e.name,class:"cost-item"},[r("span",ts,p(e.name),1),r("span",ss,p(e.tasks)+" tasks √ó "+p(e.inputTokens)+"+"+p(e.outputTokens)+" tokens",1),r("span",as,"$"+p(e.cost.toFixed(4)),1)]))),128))])])):c("",!0),e.selectedDesign&&(e.selectedDesign.variables||e.selectedDesign.variable_list_refs)?(i(),o("div",ls,[r("h4",null,"Variables ("+p(v.value)+")",1),r("div",ns,[(i(!0),o(u,null,d(e.selectedDesign.variables||{},(e,t)=>(i(),o("div",{key:t,class:"variable-item"},[r("span",os,p(t)+":",1),r("span",is,p(Array.isArray(e)?e.length:1)+" values",1)]))),128)),(i(!0),o(u,null,d(e.selectedDesign.variable_list_refs||{},(e,t)=>(i(),o("div",{key:`list_${t}`,class:"variable-item"},[r("span",rs,p(t)+":",1),r("span",cs,p(b(e))+" values",1)]))),128))])])):c("",!0),r("div",us,[t[9]||(t[9]=r("div",{class:"section-header"},[r("h4",null,"Configuration")],-1)),r("div",ds,[r("div",ps,[r("div",vs,[t[6]||(t[6]=r("span",{class:"config-label"},"Temperature:",-1)),r("span",ms,p(e.formData.parameters.temperature),1),r("span",gs,p((l=e.formData.parameters.temperature,l<=.2?"Very deterministic":l<=.5?"Focused responses":l<=.8?"Balanced creativity":l<=1.2?"Creative responses":"Highly variable")),1)]),r("div",bs,[t[7]||(t[7]=r("span",{class:"config-label"},"Max Tokens:",-1)),r("span",hs,p(e.formData.parameters.max_tokens),1),r("span",ys,p((a=e.formData.parameters.max_tokens,a<=200?"Brief answers":a<=500?"Short responses":a<=1e3?"Medium length":a<=2e3?"Long responses":"Very detailed")),1)]),r("div",fs,[t[8]||(t[8]=r("span",{class:"config-label"},"Concurrency:",-1)),r("span",ks,p(e.formData.parameters.concurrency),1),r("span",_s,p((s=e.formData.parameters.concurrency,s<=2?"Conservative pace":s<=4?"Balanced speed":s<=6?"Fast execution":"Maximum speed")),1)])])])]),r("div",xs,[t[10]||(t[10]=r("div",{class:"section-header"},[r("h4",null,"Selected Models")],-1)),r("div",Cs,[r("div",ws,[(i(!0),o(u,null,d(f.value,(e,t)=>(i(),o("div",{key:t,class:"provider-group"},[r("h5",null,p(t),1),r("div",Ds,[(i(!0),o(u,null,d(e,e=>{return i(),o("div",{key:e.id,class:"model-summary-item"},[r("span",Es,p(e.name),1),r("div",Os,[void 0!==e.input_cost&&void 0!==e.output_cost?(i(),o("span",Ms," $"+p(x(e.input_cost))+"/$"+p(x(e.output_cost)),1)):(i(),o("span",Ts," Cost N/A ")),e.context_window?(i(),o("span",Is,p((t=e.context_window,t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(0)}K`:t.toString()))+" ctx ",1)):c("",!0)])]);var t}),128))])]))),128))])])]),k.value.length>0||_.value.length>0?(i(),o("div",$s,[t[13]||(t[13]=r("div",{class:"section-header"},[r("h4",null,"Recommendations")],-1)),k.value.length>0?(i(),o("div",Ss,[t[11]||(t[11]=r("h5",null,"‚ö†Ô∏è Warnings",-1)),r("ul",null,[(i(!0),o(u,null,d(k.value,e=>(i(),o("li",{key:e},p(e),1))),128))])])):c("",!0),_.value.length>0?(i(),o("div",Rs,[t[12]||(t[12]=r("h5",null,"üí° Recommendations",-1)),r("ul",null,[(i(!0),o(u,null,d(_.value,e=>(i(),o("li",{key:e},p(e),1))),128))])])):c("",!0)])):c("",!0)])]);var s,a,l}}}),[["__scopeId","data-v-13d7f55d"]]),As={class:"wizard-modal"},js={class:"wizard-header"},Ps={class:"header-left"},Fs={class:"progress-steps"},Vs={class:"step-circle"},Us={class:"step-label"},Bs={class:"wizard-content"},Ns={class:"step-content"},qs={class:"wizard-footer"},Gs={class:"footer-buttons"},zs=["disabled"],Ks={class:"primary-actions"},Hs=["disabled"],Js=["disabled"],Ws=E(s({__name:"RunCreationWizard",props:{run:{},preselectedModelIds:{},preselectedDesignId:{}},emits:["close","saved"],setup(e,{emit:t}){const s=e,m=t,g=O(),f=M(),k=T(),_=$(),x=a(0),C=[{id:"basics",title:"Basics"},{id:"models",title:"Models & Configuration"},{id:"review",title:"Review"}],w=a({name:"",design_id:null,models:[],parameters:{temperature:.7,max_tokens:25,concurrency:3,repetitions_per_prompt:1},executionType:"browser",pythonExportOptions:{outputFormat:"both",enableProgressBar:!0,verboseLogging:!1,enableCheckpointing:!0,maxRetries:3,retryBackoffMultiplier:2,continueOnError:!0,pythonVersion:"3.9+",includeApiLogs:!1}}),D=l(()=>g.designs),E=l(()=>f.enabledModels),R=l(()=>w.value.design_id&&D.value.find(e=>e.id===w.value.design_id)||null),A=l(()=>E.value.filter(e=>w.value.models.includes(e.id))),j=a(0),P=a(null);n(()=>[R.value,A.value,w.value.parameters.repetitions_per_prompt,_.variableLists],async()=>{if(console.log("=== COMPUTING TASK COUNT ==="),console.log("selectedDesign.value:",!!R.value),console.log("selectedModels.value.length:",A.value.length),!R.value||0===A.value.length)return console.log("Returning 0 because no design or no models selected"),void(j.value=0);try{P.value=null;const e=R.value.variables||{},t=R.value.variable_list_refs||{};console.log("=== TASK COUNT CALCULATION ==="),console.log("Selected Design:",R.value),console.log("Design name:",R.value.name),console.log("Design variables:",e),console.log("Design variable_list_refs:",t),console.log("Variable keys:",Object.keys(e)),console.log("Variable list ref keys:",Object.keys(t)),console.log("Available variable lists in store:",_.variableLists),console.log("Store lists with details:",_.variableLists.map(e=>({id:e.id,name:e.name,valueCount:e.values?.length,hasValues:!!e.values,firstFewValues:e.values?.slice(0,3)})));const s=L.getInstance(),a=await s.calculateExperimentMetrics(R.value,_.variableLists);console.log("Service calculation result:",a);for(const[n,o]of Object.entries(e))Array.isArray(o)&&console.log(`Simple variable ${n}: ${o.length} values`);for(const[n,o]of Object.entries(t)){const e=_.variableLists.find(e=>e.id===o);e&&e.values?console.log(`Compound variable ${n}: ${e.values.length} values from list ${e.name}`):console.log(`Compound variable ${n}: list ${o} not found or has no values`)}const l=a.totalCombinations*A.value.length*w.value.parameters.repetitions_per_prompt;console.log(`Total task count: ${a.totalCombinations} combinations √ó ${A.value.length} models √ó ${w.value.parameters.repetitions_per_prompt} repetitions = ${l}`),j.value=l}catch(e){P.value=`Task count calculation error: ${e instanceof Error?e.message:"Unknown error"}`,j.value=0,console.error("Task count calculation failed:",e)}},{immediate:!0,deep:!0});const F=l(()=>{if(!R.value||0===A.value.length)return 0;const e=R.value.variables||{},t=R.value.variable_list_refs||{};let s=1;for(const[i,r]of Object.entries(e))Array.isArray(r)?s*=r.length:r&&(s*=1);for(const[i,r]of Object.entries(t)){const e=_.variableLists.find(e=>e.id===r);e&&e.values&&(s*=e.values.length)}if(1===s&&0===Object.keys(e).length&&0===Object.keys(t).length)return 0;const a={};for(const[i,r]of Object.entries(e))a[i]=Array.isArray(r)?r[0]:r;const l=S(R.value.prompt_template,a),n=w.value.parameters.max_tokens;let o=0;for(const i of A.value)if(void 0!==i.input_cost&&void 0!==i.output_cost){o+=(("openrouter"===i.provider?i.input_cost:i.input_cost/1e6)*l+("openrouter"===i.provider?i.output_cost:i.output_cost/1e6)*n)*s*w.value.parameters.repetitions_per_prompt}return o}),V=l(()=>{switch(x.value){case 0:return!(!w.value.name.trim()||!w.value.design_id);case 1:return w.value.models.length>0;default:return!0}}),U=l(()=>w.value.name.trim()&&w.value.design_id&&w.value.models.length>0);v(async()=>{console.log("üî•üî•üî• RUN CREATION WIZARD MOUNTED üî•üî•üî•"),console.log("Loading data..."),await Promise.all([g.loadDesigns(),f.loadModels(),_.loadVariableLists()]),console.log("‚úÖ Data loaded!"),console.log("Designs:",g.designs),console.log("Variable lists:",_.variableLists),n(()=>w.value.design_id,e=>{if(console.log("üéØ DESIGN ID CHANGED:",e),e){const t=D.value.find(t=>t.id===e);console.log("Selected design:",t),console.log("variable_list_refs:",t?.variable_list_refs),console.log("Forcing taskCount calculation...");const s=j.value;console.log("Task count result:",s)}}),s.run?w.value={name:s.run.name,design_id:s.run.design_id,models:s.run.models||[],parameters:{...s.run.parameters,repetitions_per_prompt:s.run.parameters.repetitions_per_prompt??1},executionType:"browser",pythonExportOptions:w.value.pythonExportOptions}:(s.preselectedDesignId&&(w.value.design_id=s.preselectedDesignId,w.value.name=await(async e=>{const t=D.value.find(t=>t.id===e);if(!t)return"New Run";await k.loadRuns();const s=k.runs.filter(t=>t.design_id===e).length+1,a=(new Date).toISOString().split("T")[0];return`${t.name} - ${a} #${s}`})(s.preselectedDesignId)),s.preselectedModelIds&&(w.value.models=[...s.preselectedModelIds],s.preselectedDesignId||(x.value=1)))});const B=()=>{x.value<C.length-1&&x.value++},N=()=>{x.value>0&&x.value--},q=async()=>{try{if(!w.value.design_id)return void console.error("Design ID is required");if("python_export"===w.value.executionType){const{PythonExportService:e}=await I(async()=>{const{PythonExportService:e}=await import("./PythonExportService-BL-hrLR8.js");return{PythonExportService:e}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),{downloadBlob:t}=await I(async()=>{const{downloadBlob:e}=await import("./fileDownload-C1JQo-y2.js");return{downloadBlob:e}},[],import.meta.url),s=e.getInstance(),a=await s.exportRunConfiguration(w.value,w.value.pythonExportOptions);a.success&&a.blob?(t(a.blob,a.filename),m("close")):console.error("Export failed:",a.error)}else{const e={name:w.value.name,design_id:w.value.design_id,models:w.value.models,parameters:w.value.parameters,status:"draft"};let t;t=s.run?await k.updateRun(s.run.id,e):await k.createRun(e),m("saved",t),m("close")}}catch(e){console.error("Error saving/exporting run:",e)}};return(e,t)=>(i(),o("div",{class:"modal-overlay",onClick:t[8]||(t[8]=h(t=>e.$emit("close"),["self"]))},[r("div",As,[r("div",js,[r("div",Ps,[r("h3",null,p(e.run?"Edit":"Create")+" Run",1),r("div",Fs,[(i(),o(u,null,d(C,(e,t)=>r("div",{key:e.id,class:b(["progress-step",{active:x.value===t,completed:t<x.value}])},[r("div",Vs,p(t<x.value?"‚úì":t+1),1),r("span",Us,p(e.title),1)],2)),64))])]),r("button",{class:"close-btn",onClick:t[0]||(t[0]=t=>e.$emit("close"))}," √ó ")]),r("div",Bs,[r("div",Ns,[0===x.value?(i(),y(ye,{key:0,name:w.value.name,"onUpdate:name":t[1]||(t[1]=e=>w.value.name=e),"design-id":w.value.design_id,"onUpdate:designId":t[2]||(t[2]=e=>w.value.design_id=e),"execution-type":w.value.executionType,"onUpdate:executionType":t[3]||(t[3]=e=>w.value.executionType=e),designs:D.value,"selected-design":R.value},null,8,["name","design-id","execution-type","designs","selected-design"])):c("",!0),1===x.value?(i(),y(Bt,{key:1,"selected-models":w.value.models,"onUpdate:selectedModels":t[4]||(t[4]=e=>w.value.models=e),parameters:w.value.parameters,"onUpdate:parameters":t[5]||(t[5]=e=>w.value.parameters=e),"python-export-options":w.value.pythonExportOptions,"onUpdate:pythonExportOptions":t[6]||(t[6]=e=>w.value.pythonExportOptions=e),"all-models":E.value,design:R.value,"task-count":j.value,"execution-type":w.value.executionType},null,8,["selected-models","parameters","python-export-options","all-models","design","task-count","execution-type"])):c("",!0),2===x.value?(i(),y(Ls,{key:2,"form-data":w.value,"selected-design":R.value,"selected-models":A.value,"task-count":j.value,"estimated-cost":F.value},null,8,["form-data","selected-design","selected-models","task-count","estimated-cost"])):c("",!0)])]),r("div",qs,[r("div",Gs,[r("button",{class:"btn btn-secondary",disabled:0===x.value,onClick:N}," Back ",8,zs),r("div",Ks,[r("button",{class:"btn btn-outline",onClick:t[7]||(t[7]=t=>e.$emit("close"))}," Cancel "),x.value<C.length-1?(i(),o("button",{key:0,class:"btn btn-primary",disabled:!V.value,onClick:B}," Next ",8,Hs)):(i(),o("button",{key:1,class:"btn btn-primary",disabled:!U.value,onClick:q},p(s.run?"Update Run":"python_export"===w.value.executionType?"Export Python Package":"Create Run"),9,Js))])])])])]))}}),[["__scopeId","data-v-0c4665b2"]]),Zs=s({__name:"RunEditorModal",props:{run:{},preselectedModelIds:{},preselectedDesignId:{}},emits:["close","saved"],setup:e=>(e,t)=>(i(),y(Ws,{run:e.run,"preselected-model-ids":e.preselectedModelIds,"preselected-design-id":e.preselectedDesignId,onClose:t[0]||(t[0]=t=>e.$emit("close")),onSaved:t[1]||(t[1]=t=>e.$emit("saved",t))},null,8,["run","preselected-model-ids","preselected-design-id"]))}),Xs={class:"runs-view"},Ys={class:"header"},Qs={key:0,class:"loading"},ea={key:1,class:"empty-state"},ta={key:2,class:"runs-container"},sa={class:"sort-controls"},aa={class:"runs-table"},la={class:"run-main"},na={class:"run-info"},oa={class:"run-header"},ia={class:"run-name"},ra={class:"run-meta"},ca={key:0},ua={class:"run-actions"},da=["onClick"],pa=["onClick"],va=["onClick"],ma=["onClick"],ga=["onClick"],ba=["onClick"],ha=E(s({__name:"RunsView",setup(e){const t=f(),s=k(),n=T(),{runs:g,loading:h}=_(n),D=a(!1),E=a(null),O=a("updated_at"),M=a("desc"),I=l(()=>[...g.value].sort((e,t)=>{let s,a;switch(O.value){case"name":s=e.name.toLowerCase(),a=t.name.toLowerCase();break;case"created_at":s=new Date(e.created_at||0).getTime(),a=new Date(t.created_at||0).getTime();break;case"updated_at":s=new Date(e.updated_at||e.created_at||0).getTime(),a=new Date(t.updated_at||t.created_at||0).getTime();break;case"status":const l={pending:0,running:1,completed:2,failed:3};s=l[e.status]??999,a=l[t.status]??999;break;default:return 0}return s<a?"asc"===M.value?-1:1:s>a?"asc"===M.value?1:-1:0})),$=l(()=>{const e=s.query.create;return e?parseInt(e):null});async function S(e){if(E.value)await n.updateRun(E.value.id,e);else{const s=await n.createRun(e);await n.startRun(s.id),t.push("/active")}R()}function R(){D.value=!1,E.value=null,s.query.create&&("designs"===s.query.from?t.push({name:"designs"}):t.replace({name:"runs"}))}function L(){}function A(){M.value="asc"===M.value?"desc":"asc"}function j(e){return e?new Date(e).toLocaleDateString():"N/A"}return v(()=>{n.loadRuns(),$.value&&(D.value=!0)}),(e,s)=>(i(),o("div",Xs,[r("div",Ys,[s[3]||(s[3]=r("h2",null,"Runs",-1)),r("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=e=>D.value=!0)}," Create Run ")]),x(h)?(i(),o("div",Qs," Loading runs... ")):0===x(g).length?(i(),o("div",ea,[s[4]||(s[4]=r("p",null,"No runs created yet",-1)),r("button",{class:"btn btn-primary",onClick:s[1]||(s[1]=e=>D.value=!0)}," Create your first run ")])):(i(),o("div",ta,[r("div",sa,[s[6]||(s[6]=r("label",null,"Sort by:",-1)),m(r("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>O.value=e),onChange:L},s[5]||(s[5]=[r("option",{value:"updated_at"}," Last Updated ",-1),r("option",{value:"name"}," Name ",-1),r("option",{value:"created_at"}," Created Date ",-1),r("option",{value:"status"}," Status ",-1)]),544),[[C,O.value]]),r("button",{class:"sort-toggle",onClick:A},p("desc"===M.value?"‚Üì":"‚Üë"),1)]),r("div",aa,[(i(!0),o(u,null,d(I.value,e=>(i(),o("div",{key:e.id,class:"run-row"},[r("div",la,[r("div",na,[r("div",oa,[r("h3",ia,p(e.name),1),r("span",{class:b(["run-status",`status-${e.status}`])},p(e.status),3)]),r("p",ra,[w(p(e.total_tasks||0)+" tasks ("+p(e.completed_tasks||0)+" completed) ‚Ä¢ Created "+p(j(e.created_at))+" ",1),e.updated_at&&e.updated_at!==e.created_at?(i(),o("span",ca," ‚Ä¢ Updated "+p(j(e.updated_at)),1)):c("",!0)])]),r("div",ua,["pending"===e.status?(i(),o("button",{key:0,class:"btn btn-primary btn-small",onClick:s=>async function(e){await n.startRun(e.id),t.push("/active")}(e)}," Start ",8,da)):c("",!0),"running"===e.status?(i(),o("button",{key:1,class:"btn btn-danger btn-small",onClick:t=>async function(e){await n.stopRun(e.id)}(e)}," Stop ",8,pa)):c("",!0),r("button",{class:"btn btn-secondary btn-small",onClick:s=>function(e){t.push(`/results/${e.id}`)}(e)}," Results ",8,va),r("button",{class:"btn btn-secondary btn-small",onClick:t=>async function(e){if(e.id){const t=await n.getRunById(e.id);E.value=t||e}else E.value=e}(e)}," Edit ",8,ma),r("button",{class:"btn btn-secondary btn-small",onClick:t=>function(e){const t={version:"1.0",exportDate:(new Date).toISOString(),run:e},s=JSON.stringify(t,null,2),a=new Blob([s],{type:"application/json"}),l=URL.createObjectURL(a),n=document.createElement("a");n.href=l,n.download=`run_${e.name.replace(/[^a-zA-Z0-9]/g,"_")}_${(new Date).toISOString().split("T")[0]}.json`,n.click(),URL.revokeObjectURL(l)}(e)}," Export ",8,ga),r("button",{class:"btn btn-danger btn-small",onClick:t=>async function(e){confirm(`Delete run "${e.name}"? This action cannot be undone.`)&&await n.deleteRun(e.id)}(e)}," Delete ",8,ba)])])]))),128))])])),D.value||E.value?(i(),y(Zs,{key:3,run:E.value||void 0,"preselected-design-id":$.value||void 0,onSaved:S,onClose:R},null,8,["run","preselected-design-id"])):c("",!0)]))}}),[["__scopeId","data-v-544f9eaf"]]);export{ha as default};
