import{d as s,i as e,b as t,e as a,f as l,t as n,O as o,g as u,F as r,D as i,k as c,n as d,p as v,r as p,w as g,o as m,j as k,I as f,m as y,v as h,q as b,u as _,$ as w,a0 as T,s as C}from"./vendor-DdqHZeTC.js";import{_ as R,e as I}from"./index-C9s_qmww.js";import{P as L,T as M,q as S}from"./TaskDetailModal-CV8OFGy6.js";import"./db-ftwlfnxb.js";import"./apiLogger-wE3EW76_.js";import"./safeJson-BfKuju6h.js";function $(){return{formatTime:function(s){return s.toLocaleTimeString()},formatDateTime:function(s){return s.toLocaleString()},formatDuration:function(s){return s<1e3?`${s}ms`:s<6e4?`${(s/1e3).toFixed(1)}s`:`${Math.round(s/6e4)}m`},truncateText:function(s,e){return!s||s.length<=e?s:s.substring(0,e)+"..."},formatValue:function(s){return null==s?"null":"boolean"==typeof s?s?"true":"false":"number"==typeof s?s.toString():"object"==typeof s?JSON.stringify(s):String(s)},getValueClass:function(s){return null==s?"value-null":"boolean"==typeof s?s?"value-true":"value-false":"number"==typeof s?"value-number":"object"==typeof s?"value-object":"value-string"},getStatusClass:function(s){return{pending:"status-pending",processing:"status-processing",running:"status-running",completed:"status-completed",error:"status-error",cancelled:"status-cancelled",paused:"status-paused",stopped:"status-stopped"}[s]||"status-unknown"},getStatusIcon:function(s){return{pending:"⏳",processing:"⚡",running:"▶️",completed:"✅",error:"❌",cancelled:"🚫",paused:"⏸️",stopped:"⏹️"}[s]||"❓"}}}const j={class:"progress-section"},D={class:"progress-header"},P={class:"progress-text"},x={class:"progress-bar"},F={class:"progress-details"},N={key:0,class:"error-info"},V={key:1,class:"time-info"},A=R(s({__name:"RunProgress",props:{completedTasks:{},totalTasks:{},errorCount:{default:0},startTime:{}},setup(s){const r=s,{formatDuration:i}=$(),c=e(()=>r.totalTasks?Math.round(r.completedTasks/r.totalTasks*100):0),d=e(()=>{if(!r.startTime||0===r.completedTasks)return null;const s=Date.now()-r.startTime.getTime(),e=r.completedTasks/s,t=(r.totalTasks-r.completedTasks)/e;return i(Math.round(t))});return(s,e)=>(a(),t("div",j,[l("div",D,[e[0]||(e[0]=l("h3",null,"Progress",-1)),l("span",P,n(s.completedTasks)+" / "+n(s.totalTasks)+" ("+n(c.value)+"%) ",1)]),l("div",x,[l("div",{class:"progress-fill",style:o({width:c.value+"%"})},null,4)]),l("div",F,[s.errorCount>0?(a(),t("div",N," ⚠️ "+n(s.errorCount)+" errors encountered ",1)):u("",!0),d.value?(a(),t("div",V," ⏱️ Estimated time remaining: "+n(d.value),1)):u("",!0)])]))}}),[["__scopeId","data-v-bff11202"]]),E={class:"task-list"},O={key:0,class:"no-results"},U={key:1,class:"results-container"},q={class:"results-table"},B={key:0},J=["onClick"],z={class:"model-cell"},G={class:"variables-cell"},K={class:"variables-compact"},W={class:"status-cell"},H={class:"raw-response-cell"},Q={class:"raw-text"},X={key:0,class:"parsed-results-cell"},Y={key:0,class:"parsed-items"},Z={key:1,class:"no-parsing"},ss={class:"time-cell"},es={class:"timing-info"},ts={key:0},as={class:"timestamp"},ls=R(s({__name:"TaskList",props:{tasks:{},emptyMessage:{default:"No tasks yet..."},showParsedResults:{type:Boolean,default:!0}},emits:["task-click"],setup(s){const{formatTime:e,formatDuration:o,truncateText:p,formatValue:g,getValueClass:m,getStatusClass:k,getStatusIcon:f}=$();return(s,y)=>(a(),t("div",E,[0===s.tasks.length?(a(),t("div",O,n(s.emptyMessage),1)):(a(),t("div",U,[l("div",q,[l("table",null,[l("thead",null,[l("tr",null,[y[0]||(y[0]=l("th",null,"Model",-1)),y[1]||(y[1]=l("th",null,"Variables",-1)),y[2]||(y[2]=l("th",null,"Status",-1)),y[3]||(y[3]=l("th",null,"Raw Response",-1)),s.showParsedResults?(a(),t("th",B," Parsed Results ")):u("",!0),y[4]||(y[4]=l("th",null,"Time",-1))])]),l("tbody",null,[(a(!0),t(r,null,i(s.tasks,y=>(a(),t("tr",{key:y.id,class:"task-row",onClick:e=>s.$emit("task-click",y)},[l("td",z,n(y.model),1),l("td",G,[l("div",K,[(a(!0),t(r,null,i(y.variables,(s,e)=>(a(),t("span",{key:e,class:"variable-item"},n(e)+": "+n(c(p)(String(s),15)),1))),128))])]),l("td",W,[l("span",{class:d(["status-badge",c(k)(y.status)])},n(c(f)(y.status))+" "+n(y.status),3)]),l("td",H,[l("pre",Q,n(c(p)(y.result||y.error||"No result",100)),1)]),s.showParsedResults?(a(),t("td",X,[y.parsed_results?(a(),t("div",Y,[(a(!0),t(r,null,i(y.parsed_results,(s,e)=>(a(),t("span",{key:e,class:"parsed-item"},[v(n(e)+": ",1),l("span",{class:d(c(m)(s))},n(c(g)(s)),3)]))),128))])):(a(),t("span",Z,"No parsing"))])):u("",!0),l("td",ss,[l("div",es,[y.response_time?(a(),t("div",ts,n(c(o)(y.response_time)),1)):u("",!0),l("div",as,n(c(e)(new Date(y.created_at||Date.now()))),1)])])],8,J))),128))])])])]))]))}}),[["__scopeId","data-v-de081175"]]),ns={class:"task-log"},os={class:"header-controls"},us={key:0,class:"log-container"},rs={key:0,class:"no-logs"},is={key:1,class:"log-entries"},cs=["onClick"],ds={class:"log-time"},vs={class:"log-message"},ps=R(s({__name:"TaskLog",props:{logs:{},emptyMessage:{default:"Waiting for tasks to start..."}},emits:["clear","log-click"],setup(s){const{formatTime:e}=$(),o=p(!0);function v(){o.value=!o.value}return(s,p)=>(a(),t("div",ns,[l("div",{class:"log-header",onClick:v},[l("h3",null,"Task Log "+n(o.value?`(${s.logs.length})`:""),1),l("div",os,[s.logs.length>0&&!o.value?(a(),t("button",{key:0,class:"clear-btn",onClick:p[0]||(p[0]=g(e=>s.$emit("clear"),["stop"]))}," Clear ")):u("",!0),l("button",{class:"collapse-btn",onClick:g(v,["stop"])},n(o.value?"▼":"▲"),1)])]),o.value?u("",!0):(a(),t("div",us,[0===s.logs.length?(a(),t("div",rs,n(s.emptyMessage),1)):(a(),t("div",is,[(a(!0),t(r,null,i(s.logs,o=>(a(),t("div",{key:o.id,class:d(["log-entry",`log-${o.type}`]),onClick:e=>s.$emit("log-click",o)},[l("span",ds,n(c(e)(o.timestamp)),1),l("span",vs,n(o.message),1)],10,cs))),128))]))]))]))}}),[["__scopeId","data-v-1bbfbe91"]]),gs={class:"pivot-header"},ms={class:"controls"},ks=["disabled"],fs={class:"auto-update"},ys={key:0,class:"loading"},hs={key:1,class:"pivot-content"},bs={class:"pivot-summary"},_s={class:"summary-stats"},ws={class:"stat"},Ts={class:"stat"},Cs={class:"stat"},Rs={class:"stat"},Is={key:0,class:"pivot-insights"},Ls={key:2,class:"empty-state"},Ms=R(s({__name:"LivePivot",props:{runId:{}},setup(s){const o=s,c=p(!1),g=p(!1),_=p(null),w=p(""),T=p([]),C=p(null),R=p(!1),I=p(null),$=p({rowField:"",columnField:"model",valueField:"match_1",aggregation:"mean"}),j=e(()=>T.value.filter(s=>"completed"===s.status)),D=e(()=>{if(0===j.value.length)return[];const s=[],e=T.value.filter(s=>"pending"===s.status).length,t=T.value.filter(s=>"error"===s.status).length;e>0&&s.push(`${e} tasks remaining`),t>0&&s.push(`${t} tasks failed`);const a=new Map,l=new Map;T.value.forEach(s=>{const e=s.model||"Unknown";a.set(e,(a.get(e)||0)+1),"error"===s.status&&l.set(e,(l.get(e)||0)+1)});let n="",o=0;return a.forEach((s,e)=>{const t=1-(l.get(e)||0)/s;t>o&&(o=t,n=e)}),n&&a.size>1&&s.push(`Best performing model: ${n} (${Math.round(100*o)}% success)`),s});async function P(){if(o.runId){c.value=!0;try{const s=await S(o.runId);if((s.length!==T.value.length||s.filter(s=>"completed"===s.status).length!==j.value.length)&&(T.value=s,!$.value.rowField&&s.length>0)){const e=s.find(s=>s.variables)||s[0];if(e?.variables){const s=Object.keys(e.variables);$.value.rowField=s[0]||"model"}if(e?.parsed_results){const s=Object.keys(e.parsed_results);$.value.valueField=s.find(s=>"match_1"===s)||s[0]||"response_time"}}w.value=(new Date).toLocaleTimeString()}catch(s){console.error("Error updating pivot:",s)}finally{c.value=!1}}}function x(s){$.value=s}function F(s){s.cell&&s.cell.tasks&&(s.cell.tasks.length,I.value=s.cell.tasks[0])}function N(){g.value?_.value=window.setInterval(P,3e3):_.value&&(clearInterval(_.value),_.value=null)}function V(){R.value=!R.value,R.value?document.body.style.overflow="hidden":document.body.style.overflow=""}return m(async()=>{o.runId&&(await P(),g.value=!0,N())}),k(()=>{_.value&&clearInterval(_.value),C.value&&clearTimeout(C.value),R.value&&(document.body.style.overflow="")}),(s,e)=>(a(),t("div",{class:d(["live-pivot",{fullscreen:R.value}])},[l("div",gs,[e[3]||(e[3]=l("h3",null,"Live Pivot Analysis",-1)),l("div",ms,[l("button",{class:"refresh-btn",disabled:c.value,onClick:P},n(c.value?"Updating...":"Refresh"),9,ks),l("label",fs,[y(l("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),type:"checkbox",onChange:N},null,544),[[h,g.value]]),e[2]||(e[2]=v(" Auto-update "))]),l("button",{class:"fullscreen-btn",onClick:V},n(R.value?"⊟":"⊞"),1)])]),c.value&&!T.value.length?(a(),t("div",ys,e[4]||(e[4]=[l("div",{class:"spinner"},null,-1),v(" Loading pivot analysis... ")]))):T.value.length>0?(a(),t("div",hs,[b(L,{tasks:j.value,config:$.value,"max-table-rows":1e4,"show-totals":!0,onConfigChange:x,onCellClick:F},null,8,["tasks","config"]),l("div",bs,[l("div",_s,[l("span",ws,n(T.value.length)+" total tasks",1),l("span",Ts,n(j.value.length)+" completed",1),l("span",Cs,n(Math.round(j.value.length/T.value.length*100))+"% progress",1),l("span",Rs,"Updated "+n(w.value),1)]),D.value.length>0?(a(),t("div",Is,[e[5]||(e[5]=l("h4",null,"Key Insights:",-1)),l("ul",null,[(a(!0),t(r,null,i(D.value,s=>(a(),t("li",{key:s},n(s),1))),128))])])):u("",!0)])])):(a(),t("div",Ls,e[6]||(e[6]=[l("p",null,"No tasks found for this run. Tasks will appear here once they start processing.",-1)]))),I.value?(a(),f(M,{key:3,task:I.value,onClose:e[1]||(e[1]=s=>I.value=null)},null,8,["task"])):u("",!0)],2))}}),[["__scopeId","data-v-08da3483"]]),Ss={class:"active-view"},$s={key:0,class:"no-active-run"},js={key:1,class:"active-run-container"},Ds={class:"run-header"},Ps={class:"run-info"},xs={class:"run-controls"},Fs={class:"live-results-section"},Ns={key:0,class:"completion-section"},Vs=R(s({__name:"ActiveView",setup(s){const o=_(),r=I(),i=p(null),{activeRun:d,designName:g,taskLogs:y,recentTasks:h,progressPercent:R}=w(r),L=e(()=>{if(d.value?.started_at)return new Date(d.value.started_at)});async function S(){await r.pauseRun()}async function $(){await r.resumeRun()}async function j(){confirm("Are you sure you want to stop this run?")&&(await r.stopRun(),o.push("/runs"))}function D(s){i.value=s}function P(s){s.taskId&&console.log("Log clicked for task:",s.taskId)}function x(){r.clearLogs()}return m(async()=>{await r.detectActiveRun()}),k(()=>{}),(s,e)=>{const o=T("router-link");return a(),t("div",Ss,[c(d)?(a(),t("div",js,[l("div",Ds,[l("div",null,[l("h2",null,n(c(d).name),1),l("p",Ps," Design: "+n(c(g))+" | Models: "+n(c(d).models.length)+" | Total Tasks: "+n(c(d).total_tasks),1)]),l("div",xs,["running"===c(d).status?(a(),t("button",{key:0,class:"btn btn-danger",onClick:S}," Pause ")):"paused"===c(d).status?(a(),t("button",{key:1,class:"btn btn-primary",onClick:$}," Resume ")):u("",!0),l("button",{class:"btn btn-secondary",onClick:j}," Stop ")])]),b(A,{"completed-tasks":c(d).completed_tasks,"total-tasks":c(d).total_tasks,"error-count":c(d).error_count,"start-time":L.value},null,8,["completed-tasks","total-tasks","error-count","start-time"]),l("div",Fs,[e[4]||(e[4]=l("h3",null,"Live Results",-1)),b(ls,{tasks:c(h),"empty-message":"No results yet...",onTaskClick:D},null,8,["tasks"])]),b(Ms,{"run-id":c(d)?.id||null},null,8,["run-id"]),b(ps,{logs:c(y),onClear:x,onLogClick:P},null,8,["logs"]),"completed"===c(d).status?(a(),t("div",Ns,[e[6]||(e[6]=l("h3",null,"Run Complete!",-1)),e[7]||(e[7]=l("p",null,"All tasks have been processed.",-1)),b(o,{to:`/results?run=${c(d).id}`,class:"btn btn-primary"},{default:C(()=>e[5]||(e[5]=[v(" View Results ")])),_:1,__:[5]},8,["to"])])):u("",!0)])):(a(),t("div",$s,[e[2]||(e[2]=l("h2",null,"No Active Run",-1)),e[3]||(e[3]=l("p",null,"Start a run from the Runs tab to begin processing tasks.",-1)),b(o,{to:"/runs",class:"btn btn-primary"},{default:C(()=>e[1]||(e[1]=[v(" Go to Runs ")])),_:1,__:[1]})])),i.value?(a(),f(M,{key:2,task:i.value,onClose:e[0]||(e[0]=s=>i.value=null)},null,8,["task"])):u("",!0)])}}}),[["__scopeId","data-v-fd65369c"]]);export{Vs as default};
