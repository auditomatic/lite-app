import{d as a,f as e,c as t,o as s,a3 as l,Y as n,_ as o,F as i,a5 as r,W as c,a7 as u,q as d,a9 as p}from"./vendor-DCf9YP3r.js";import{i as b,_ as v}from"./index-dQqVkRMY.js";import{u as m}from"./designs-db-D4FnITPe.js";import{u as f}from"./variables-db-BMGRJyAs.js";import{u as g}from"./trials-db-V2RTzc2h.js";import{s as w}from"./storage-calculation.service-CLY4-4t3.js";import"./db-CL8uhZCz.js";import"./defaultData-DyqJdH2z.js";import"./registry-DiQCbBcP.js";import"./logger.service-_k__GSpu.js";import"./mock-provider.service-BAPeV6CB.js";import"./settings-db-CBuX-T7S.js";const y={class:"debug-view"},k={class:"section"},h={class:"info-grid"},C={class:"info-item"},x={class:"info-item"},D={class:"info-item"},j={class:"info-item"},S={class:"section"},_={class:"table-header"},I={class:"table-actions"},L=["onClick"],A=["onClick"],O=["onClick","disabled"],U={key:0,class:"table-content"},E={class:"table-controls"},R=["onUpdate:modelValue"],V=["onClick"],T={class:"table-data"},P=["onClick"],$=v(a({__name:"DebugView",setup(a){const v=m(),$=f(),M=g(),J=e(new Set),N=e({}),z=e({}),F=e(""),q=e(),B=e(null),W=t(()=>({dbVersion:"1.0.0",totalRecords:Object.values(z.value).reduce((a,e)=>a+e.length,0),storageUsed:B.value?B.value.formattedUsed:"Calculating...",lastUpdated:(new Date).toLocaleString()})),Y=t(()=>[{name:"designs",count:z.value.designs?.length||0},{name:"variableLists",count:z.value.variableLists?.length||0},{name:"trials",count:z.value.trials?.length||0},{name:"models",count:z.value.models?.length||0},{name:"apiCalls",count:z.value.apiCalls?.length||0},{name:"settings",count:z.value.settings?.length||0}]);async function Z(){try{z.value={designs:await b.designs.toArray(),variableLists:await b.variableLists.toArray(),trials:await b.trials.toArray(),models:await b.models.toArray(),apiCalls:await b.apiCalls.toArray(),settings:await b.settings.toArray()}}catch(a){console.error("Failed to load table data:",a)}}function G(a){const e=z.value[a]||[],t=N.value[a]?.toLowerCase()||"";if(!t)return JSON.stringify(e.slice(0,10),null,2);const s=e.filter(a=>JSON.stringify(a).toLowerCase().includes(t));return JSON.stringify(s.slice(0,10),null,2)}async function H(){da({version:"1.0.0",exported:(new Date).toISOString(),data:z.value},`auditomatic_full_export_${Date.now()}.json`)}async function K(){const a=z.value.designs||[],e=z.value.variableLists||[];da({version:"1.0.0",exported:(new Date).toISOString(),designs:a,variableLists:e},`designs_variables_export_${Date.now()}.json`)}async function Q(){const a=z.value.trials||[],e=z.value.apiCalls||[];da({version:"1.0.0",exported:(new Date).toISOString(),trials:a,apiCalls:e},`trials_export_${Date.now()}.json`)}async function X(){da(z.value.models||[],`models_export_${Date.now()}.json`)}async function aa(){da((z.value.models||[]).map(a=>({id:a.id,provider:a.provider,modelId:a.modelId,enabled:a.enabled})),`model_states_export_${Date.now()}.json`)}function ea(){F.value="fullDatabase",q.value?.click()}function ta(){F.value="designsAndVariables",q.value?.click()}function sa(){F.value="trials",q.value?.click()}function la(){F.value="models",q.value?.click()}function na(){F.value="modelStates",q.value?.click()}async function oa(a){const e=a.target.files?.[0];if(e){try{const a=await e.text(),t=JSON.parse(a);switch(F.value){case"fullDatabase":await async function(a){if(a.data)for(const[e,t]of Object.entries(a.data))await ia(e,t)}(t);break;case"designsAndVariables":await async function(a){a.designs&&await b.designs.bulkPut(a.designs);a.variableLists&&await b.variableLists.bulkPut(a.variableLists)}(t);break;case"trials":await async function(a){a.trials&&await b.trials.bulkPut(a.trials);a.apiCalls&&await b.apiCalls.bulkPut(a.apiCalls)}(t);break;case"models":await async function(a){await b.models.bulkPut(a)}(t);break;case"modelStates":await async function(a){for(const e of a)await b.models.update(e.id,{enabled:e.enabled})}(t);break;default:z.value[F.value]&&await ia(F.value,t)}await Z(),alert("Import completed successfully!")}catch(t){console.error("Import failed:",t),alert("Import failed: "+(t instanceof Error?t.message:"Unknown error"))}q.value&&(q.value.value="")}}async function ia(a,e){const t=b[a];t&&await t.bulkPut(e)}async function ra(){confirm("Are you sure you want to clear ALL data? This cannot be undone.")&&(await b.delete(),await b.open(),await Z())}async function ca(){confirm("Reset all settings to defaults? This will clear all data.")&&(await ra(),await Promise.all([v.initialize(),$.initialize(),M.initialize()]))}async function ua(){confirm("Regenerate database? This will clear all data and rebuild.")&&(await b.delete(),await b.open(),await Z())}function da(a,e){const t=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),l=document.createElement("a");l.href=s,l.download=e,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s)}return s(async()=>{await Z();try{B.value=await w.getStorageInfo()}catch(a){console.warn("Failed to get storage info:",a)}}),(a,e)=>(c(),l("div",y,[e[14]||(e[14]=n("div",{class:"header"},[n("h1",null,"Debug & Data Management"),n("p",null,"System diagnostics, database viewer, and import/export tools")],-1)),n("div",k,[e[4]||(e[4]=n("h2",null,"System Information",-1)),n("div",h,[n("div",C,[e[0]||(e[0]=n("label",null,"Database Version:",-1)),n("span",null,o(W.value.dbVersion),1)]),n("div",x,[e[1]||(e[1]=n("label",null,"Records Count:",-1)),n("span",null,o(W.value.totalRecords),1)]),n("div",D,[e[2]||(e[2]=n("label",null,"Storage Used:",-1)),n("span",null,o(W.value.storageUsed),1)]),n("div",j,[e[3]||(e[3]=n("label",null,"Last Updated:",-1)),n("span",null,o(W.value.lastUpdated),1)])])]),n("div",S,[e[5]||(e[5]=n("h2",null,"Database Tables",-1)),(c(!0),l(i,null,r(Y.value,a=>(c(),l("div",{key:a.name,class:"table-section"},[n("div",_,[n("h3",null,o(a.name)+" ("+o(a.count)+" records)",1),n("div",I,[n("button",{onClick:e=>async function(a){da(z.value[a]||[],`${a}_export.json`)}(a.name),class:"export-btn"},"Export",8,L),n("button",{onClick:e=>{return t=a.name,F.value=t,void q.value?.click();var t},class:"import-btn"},"Import",8,A),n("button",{onClick:e=>async function(a){if(!confirm(`Are you sure you want to clear all ${a} data? This cannot be undone.`))return;const e=b[a];e&&(await e.clear(),await Z())}(a.name),class:"clear-btn",disabled:0===a.count}," Clear All ",8,O)])]),J.value.has(a.name)?(c(),l("div",U,[n("div",E,[d(n("input",{"onUpdate:modelValue":e=>N.value[a.name]=e,placeholder:"Search records...",class:"search-input"},null,8,R),[[p,N.value[a.name]]]),n("button",{onClick:e=>async function(){await Z()}(a.name),class:"refresh-btn"},"Refresh",8,V)]),n("div",T,[n("pre",null,o(G(a.name)),1)])])):u("",!0),n("button",{onClick:e=>{return t=a.name,void(J.value.has(t)?J.value.delete(t):J.value.add(t));var t},class:"toggle-btn"},o(J.value.has(a.name)?"Collapse":"Expand"),9,P)]))),128))]),n("div",{class:"section"},[e[12]||(e[12]=n("h2",null,"Import/Export Tools",-1)),n("div",{class:"export-group"},[e[6]||(e[6]=n("h3",null,"Complete Database",-1)),n("div",{class:"export-actions"},[n("button",{onClick:H,class:"export-all-btn"},"Export All Data"),n("button",{onClick:ea,class:"import-all-btn"},"Import All Data")])]),n("div",{class:"export-group"},[e[7]||(e[7]=n("h3",null,"Designs & Variables",-1)),e[8]||(e[8]=n("p",{class:"export-desc"},"Exports designs with their linked variable lists",-1)),n("div",{class:"export-actions"},[n("button",{onClick:K,class:"export-btn"},"Export Designs+Variables"),n("button",{onClick:ta,class:"import-btn"},"Import Designs+Variables")])]),n("div",{class:"export-group"},[e[9]||(e[9]=n("h3",null,"Trials",-1)),e[10]||(e[10]=n("p",{class:"export-desc"},"Exports trials with configuration snapshots and results",-1)),n("div",{class:"export-actions"},[n("button",{onClick:Q,class:"export-btn"},"Export Trials"),n("button",{onClick:sa,class:"import-btn"},"Import Trials")])]),n("div",{class:"export-group"},[e[11]||(e[11]=n("h3",null,"Models",-1)),n("div",{class:"export-actions"},[n("button",{onClick:X,class:"export-btn"},"Export All Models"),n("button",{onClick:la,class:"import-btn"},"Import All Models")]),n("div",{class:"export-actions"},[n("button",{onClick:aa,class:"export-state-btn"},"Export Model States Only"),n("button",{onClick:na,class:"import-state-btn"},"Import Model States Only")])])]),n("div",{class:"section danger-zone"},[e[13]||(e[13]=n("h2",null,"Danger Zone",-1)),n("div",{class:"danger-actions"},[n("button",{onClick:ra,class:"danger-btn"},"Clear All Data"),n("button",{onClick:ca,class:"danger-btn"},"Reset to Defaults"),n("button",{onClick:ua,class:"danger-btn"},"Regenerate Database")])]),n("input",{ref_key:"fileInput",ref:q,type:"file",accept:".json",onChange:oa,style:{display:"none"}},null,544)]))}}),[["__scopeId","data-v-bcc213e7"]]);export{$ as default};
