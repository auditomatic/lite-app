const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/trial-bundle.service-qdj7kZ7W.js","assets/index-Di6ivXEn.js","assets/vue-vendor-DPw1dQYc.js","assets/ui-vendor-IRGmExUJ.js","assets/utils-vendor-B76-F3_P.js","assets/tauri-vendor-1uBLmS9u.js","assets/index-BgLjcsEF.css","assets/data-vendor-DVqNsW2V.js","assets/index-BXW77j_9.js","assets/toast-CdlfWUDp.js","assets/useCostEstimation-cAWOZeCd.js","assets/ParserSelector-D5MEWkLd.js","assets/parser.store-D4ITkzAS.js","assets/ParserSelector-DMLEdzpb.css","assets/trial-stream-manager-v4-CMwXG_NN.js","assets/execution-control-v4-Jb2X4DoF.js","assets/useV4TrialCommands-CEujC8Ua.js","assets/useHeatmapStylingV3-EIqmbVQM.js","assets/useV4Models-D-NnnuCz.js","assets/useV4LiveQuery-Do0jdBW3.js"])))=>i.map(i=>d[i]);
var ws=Object.defineProperty;var ks=(i,e,t)=>e in i?ws(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var Be=(i,e,t)=>ks(i,typeof e!="symbol"?e+"":e,t);import{d as de,f as B,c as U,o as Fe,b as Le,w as re,R as m,a0 as ne,S as s,_ as E,a9 as We,a3 as fe,Y as u,y as ze,aa as Ss,ab as Is,ac as Es,$ as ee,ad as Rs,ae as Fs,af as Qt,q as es,n as je,k as w,Z as x,F as te,W as oe,a5 as Vt,ag as xs,ah as Ps,u as W,a4 as ht,V as y,G as D,M as Ke,ai as Ze,U as ts,B as Oe,A as ss,aj as As,r as Vs,a7 as Os,a1 as as,X as it,a6 as yt}from"./vue-vendor-DPw1dQYc.js";import{t as Ee}from"./toast-CdlfWUDp.js";import{j as ce,a as I,u as Ds,b as Ot,F as et,G as Ls,E as Ns,_ as He,d as qe,H as Ms,g as Us,e as Dt,I as zs}from"./index-Di6ivXEn.js";import{aH as ns,z as os,aS as Bs,n as xe,P as Ws,aT as ls,aU as js,s as Et,az as Hs,M as Rt,t as Ft,v as Gs,a1 as is,I as Lt,aV as qs,aa as Js,av as Xs,aM as rs,V as Ks,aI as Zs,X as Ys,C as xt,r as Qs,w as ea,x as Me,ax as us,aN as Je,T as rt,J as ut,D as ta,N as ue,aJ as sa,am as ds,a5 as aa,a6 as na,a4 as cs,aW as oa,ai as ps,ak as la,al as ia,G as ra,o as ua,aA as da,aX as Nt,R as ca,Y as pa,au as Pt,aw as fa,aY as At,m as fs,a0 as ma,E as va}from"./ui-vendor-IRGmExUJ.js";import{b as ms}from"./utils-vendor-B76-F3_P.js";import{u as dt}from"./useCostEstimation-cAWOZeCd.js";import{P as ga}from"./ParserSelector-D5MEWkLd.js";import{u as ct,a as vs}from"./trial-stream-manager-v4-CMwXG_NN.js";import{u as ha}from"./parser.store-D4ITkzAS.js";import{v as Mt,u as ya,a as ba,b as _a}from"./useV4TrialCommands-CEujC8Ua.js";import{u as Ta}from"./useHeatmapStylingV3-EIqmbVQM.js";import{u as mt,w as Ca}from"./data-vendor-DVqNsW2V.js";import{u as $a}from"./execution-control-v4-Jb2X4DoF.js";import{u as wa}from"./useV4Models-D-NnnuCz.js";const ka={class:"right-panel"},Sa=de({__name:"ResizablePanelContainer",props:{storageKey:{default:"trial-list-width"},defaultWidth:{default:250},minWidth:{default:200},maxWidth:{default:600},mobileBreakpoint:{default:768}},emits:["resize","mobile-overlay-change"],setup(i,{expose:e,emit:t}){const a=i,n=t,o=B(a.defaultWidth),d=B(!1),p=B(0),r=B(0),c=B(window.innerWidth),g=B(!1),_=U(()=>c.value<a.mobileBreakpoint),v=U(()=>_.value?{width:`${Math.min(c.value*.85,400)}px`}:{width:`${o.value}px`});function T(){const h=localStorage.getItem(a.storageKey);if(h){const f=parseInt(h,10);!isNaN(f)&&f>=a.minWidth&&f<=a.maxWidth&&(o.value=f)}}function C(h){localStorage.setItem(a.storageKey,h.toString()),n("resize",h)}function b(h){d.value=!0,p.value=h.clientX,r.value=o.value,document.addEventListener("mousemove",V),document.addEventListener("mouseup",N),document.body.style.userSelect="none",document.body.style.cursor="col-resize"}function V(h){if(!d.value)return;const f=h.clientX-p.value,L=Math.max(a.minWidth,Math.min(a.maxWidth,r.value+f));o.value=L}function N(){d.value&&(d.value=!1,C(o.value),document.removeEventListener("mousemove",V),document.removeEventListener("mouseup",N),document.body.style.userSelect="",document.body.style.cursor="")}function j(){o.value=a.defaultWidth,C(a.defaultWidth)}function R(){c.value=window.innerWidth,!_.value&&g.value&&(g.value=!1,n("mobile-overlay-change",!1))}function $(){_.value&&(g.value=!g.value,n("mobile-overlay-change",g.value))}function O(){g.value=!1,n("mobile-overlay-change",!1)}return e({toggleMobileOverlay:$,closeMobileOverlay:O}),Fe(()=>{T(),window.addEventListener("resize",R)}),Le(()=>{window.removeEventListener("resize",R),N()}),re(()=>a.defaultWidth,h=>{o.value===a.defaultWidth&&(o.value=h)}),(h,f)=>(u(),m("div",{class:ne(["resizable-panel-container",{"mobile-overlay":_.value}])},[s("div",{class:ne(["left-panel",{"overlay-visible":_.value&&g.value}]),style:fe(v.value)},[We(h.$slots,"left",{},void 0,!0)],6),_.value?E("",!0):(u(),m("div",{key:0,class:ne(["resize-handle",{dragging:d.value}]),onMousedown:b,onDblclick:j},f[0]||(f[0]=[s("div",{class:"handle-bar"},null,-1)]),34)),s("div",ka,[We(h.$slots,"right",{},void 0,!0)]),_.value&&g.value?(u(),m("div",{key:1,class:"mobile-overlay-bg",onClick:O})):E("",!0)],2))}}),Ia=ce(Sa,[["__scopeId","data-v-949e1df1"]]);function Ea(){var i=window.navigator.userAgent,e=i.indexOf("MSIE ");if(e>0)return parseInt(i.substring(e+5,i.indexOf(".",e)),10);var t=i.indexOf("Trident/");if(t>0){var a=i.indexOf("rv:");return parseInt(i.substring(a+3,i.indexOf(".",a)),10)}var n=i.indexOf("Edge/");return n>0?parseInt(i.substring(n+5,i.indexOf(".",n)),10):-1}let st;function bt(){bt.init||(bt.init=!0,st=Ea()!==-1)}var pt={name:"ResizeObserver",props:{emitOnMount:{type:Boolean,default:!1},ignoreWidth:{type:Boolean,default:!1},ignoreHeight:{type:Boolean,default:!1}},emits:["notify"],mounted(){bt(),ze(()=>{this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitOnMount&&this.emitSize()});const i=document.createElement("object");this._resizeObject=i,i.setAttribute("aria-hidden","true"),i.setAttribute("tabindex",-1),i.onload=this.addResizeHandlers,i.type="text/html",st&&this.$el.appendChild(i),i.data="about:blank",st||this.$el.appendChild(i)},beforeUnmount(){this.removeResizeHandlers()},methods:{compareAndNotify(){(!this.ignoreWidth&&this._w!==this.$el.offsetWidth||!this.ignoreHeight&&this._h!==this.$el.offsetHeight)&&(this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitSize())},emitSize(){this.$emit("notify",{width:this._w,height:this._h})},addResizeHandlers(){this._resizeObject.contentDocument.defaultView.addEventListener("resize",this.compareAndNotify),this.compareAndNotify()},removeResizeHandlers(){this._resizeObject&&this._resizeObject.onload&&(!st&&this._resizeObject.contentDocument&&this._resizeObject.contentDocument.defaultView.removeEventListener("resize",this.compareAndNotify),this.$el.removeChild(this._resizeObject),this._resizeObject.onload=null,this._resizeObject=null)}}};const Ra=Es();Ss("data-v-b329ee4c");const Fa={class:"resize-observer",tabindex:"-1"};Is();const xa=Ra((i,e,t,a,n,o)=>(u(),ee("div",Fa)));pt.render=xa;pt.__scopeId="data-v-b329ee4c";pt.__file="src/components/ResizeObserver.vue";function at(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?at=function(e){return typeof e}:at=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},at(i)}function Pa(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Aa(i,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,a.key,a)}}function Va(i,e,t){return e&&Aa(i.prototype,e),i}function Ut(i){return Oa(i)||Da(i)||La(i)||Na()}function Oa(i){if(Array.isArray(i))return _t(i)}function Da(i){if(typeof Symbol<"u"&&Symbol.iterator in Object(i))return Array.from(i)}function La(i,e){if(i){if(typeof i=="string")return _t(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _t(i,e)}}function _t(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,a=new Array(e);t<e;t++)a[t]=i[t];return a}function Na(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ma(i){var e;return typeof i=="function"?e={callback:i}:e=i,e}function Ua(i,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a,n,o,d=function(r){for(var c=arguments.length,g=new Array(c>1?c-1:0),_=1;_<c;_++)g[_-1]=arguments[_];if(o=g,!(a&&r===n)){var v=t.leading;typeof v=="function"&&(v=v(r,n)),(!a||r!==n)&&v&&i.apply(void 0,[r].concat(Ut(o))),n=r,clearTimeout(a),a=setTimeout(function(){i.apply(void 0,[r].concat(Ut(o))),a=0},e)}};return d._clear=function(){clearTimeout(a),a=null},d}function gs(i,e){if(i===e)return!0;if(at(i)==="object"){for(var t in i)if(!gs(i[t],e[t]))return!1;return!0}return!1}var za=(function(){function i(e,t,a){Pa(this,i),this.el=e,this.observer=null,this.frozen=!1,this.createObserver(t,a)}return Va(i,[{key:"createObserver",value:function(t,a){var n=this;if(this.observer&&this.destroyObserver(),!this.frozen){if(this.options=Ma(t),this.callback=function(p,r){n.options.callback(p,r),p&&n.options.once&&(n.frozen=!0,n.destroyObserver())},this.callback&&this.options.throttle){var o=this.options.throttleOptions||{},d=o.leading;this.callback=Ua(this.callback,this.options.throttle,{leading:function(r){return d==="both"||d==="visible"&&r||d==="hidden"&&!r}})}this.oldResult=void 0,this.observer=new IntersectionObserver(function(p){var r=p[0];if(p.length>1){var c=p.find(function(_){return _.isIntersecting});c&&(r=c)}if(n.callback){var g=r.isIntersecting&&r.intersectionRatio>=n.threshold;if(g===n.oldResult)return;n.oldResult=g,n.callback(g,r)}},this.options.intersection),ze(function(){n.observer&&n.observer.observe(n.el)})}}},{key:"destroyObserver",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null),this.callback&&this.callback._clear&&(this.callback._clear(),this.callback=null)}},{key:"threshold",get:function(){return this.options.intersection&&typeof this.options.intersection.threshold=="number"?this.options.intersection.threshold:0}}]),i})();function hs(i,e,t){var a=e.value;if(a)if(typeof IntersectionObserver>"u")console.warn("[vue-observe-visibility] IntersectionObserver API is not available in your browser. Please install this polyfill: https://github.com/w3c/IntersectionObserver/tree/master/polyfill");else{var n=new za(i,a,t);i._vue_visibilityState=n}}function Ba(i,e,t){var a=e.value,n=e.oldValue;if(!gs(a,n)){var o=i._vue_visibilityState;if(!a){ys(i);return}o?o.createObserver(a,t):hs(i,{value:a},t)}}function ys(i){var e=i._vue_visibilityState;e&&(e.destroyObserver(),delete i._vue_visibilityState)}var Wa={beforeMount:hs,updated:Ba,unmounted:ys},ja={itemsLimit:1e3},Ha=/(auto|scroll)/;function bs(i,e){return i.parentNode===null?e:bs(i.parentNode,e.concat([i]))}var vt=function(e,t){return getComputedStyle(e,null).getPropertyValue(t)},Ga=function(e){return vt(e,"overflow")+vt(e,"overflow-y")+vt(e,"overflow-x")},qa=function(e){return Ha.test(Ga(e))};function zt(i){if(i instanceof HTMLElement||i instanceof SVGElement){for(var e=bs(i.parentNode,[]),t=0;t<e.length;t+=1)if(qa(e[t]))return e[t];return document.scrollingElement||document.documentElement}}function Tt(i){"@babel/helpers - typeof";return Tt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tt(i)}var Ja={items:{type:Array,required:!0},keyField:{type:String,default:"id"},direction:{type:String,default:"vertical",validator:function(e){return["vertical","horizontal"].includes(e)}},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"}};function Xa(){return this.items.length&&Tt(this.items[0])!=="object"}var Ct=!1;if(typeof window<"u"){Ct=!1;try{var Ka=Object.defineProperty({},"passive",{get:function(){Ct=!0}});window.addEventListener("test",null,Ka)}catch{}}let Za=0;var ft={name:"RecycleScroller",components:{ResizeObserver:pt},directives:{ObserveVisibility:Wa},props:{...Ja,itemSize:{type:Number,default:null},gridItems:{type:Number,default:void 0},itemSecondarySize:{type:Number,default:void 0},minItemSize:{type:[Number,String],default:null},sizeField:{type:String,default:"size"},typeField:{type:String,default:"type"},buffer:{type:Number,default:200},pageMode:{type:Boolean,default:!1},prerender:{type:Number,default:0},emitUpdate:{type:Boolean,default:!1},updateInterval:{type:Number,default:0},skipHover:{type:Boolean,default:!1},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},listClass:{type:[String,Object,Array],default:""},itemClass:{type:[String,Object,Array],default:""}},emits:["resize","visible","hidden","update","scroll-start","scroll-end"],data(){return{pool:[],totalSize:0,ready:!1,hoverKey:null}},computed:{sizes(){if(this.itemSize===null){const i={"-1":{accumulator:0}},e=this.items,t=this.sizeField,a=this.minItemSize;let n=1e4,o=0,d;for(let p=0,r=e.length;p<r;p++)d=e[p][t]||a,d<n&&(n=d),o+=d,i[p]={accumulator:o,size:d};return this.$_computedMinItemSize=n,i}return[]},simpleArray:Xa,itemIndexByKey(){const{keyField:i,items:e}=this,t={};for(let a=0,n=e.length;a<n;a++)t[e[a][i]]=a;return t}},watch:{items(){this.updateVisibleItems(!0)},pageMode(){this.applyPageMode(),this.updateVisibleItems(!1)},sizes:{handler(){this.updateVisibleItems(!1)},deep:!0},gridItems(){this.updateVisibleItems(!0)},itemSecondarySize(){this.updateVisibleItems(!0)}},created(){this.$_startIndex=0,this.$_endIndex=0,this.$_views=new Map,this.$_unusedViews=new Map,this.$_scrollDirty=!1,this.$_lastUpdateScrollPosition=0,this.prerender&&(this.$_prerender=!0,this.updateVisibleItems(!1)),this.gridItems&&!this.itemSize&&console.error("[vue-recycle-scroller] You must provide an itemSize when using gridItems")},mounted(){this.applyPageMode(),this.$nextTick(()=>{this.$_prerender=!1,this.updateVisibleItems(!0),this.ready=!0})},activated(){const i=this.$_lastUpdateScrollPosition;typeof i=="number"&&this.$nextTick(()=>{this.scrollToPosition(i)})},beforeUnmount(){this.removeListeners()},methods:{addView(i,e,t,a,n){const o=Rs({id:Za++,index:e,used:!0,key:a,type:n}),d=Fs({item:t,position:0,nr:o});return i.push(d),d},unuseView(i,e=!1){const t=this.$_unusedViews,a=i.nr.type;let n=t.get(a);n||(n=[],t.set(a,n)),n.push(i),e||(i.nr.used=!1,i.position=-9999)},handleResize(){this.$emit("resize"),this.ready&&this.updateVisibleItems(!1)},handleScroll(i){if(!this.$_scrollDirty){if(this.$_scrollDirty=!0,this.$_updateTimeout)return;const e=()=>requestAnimationFrame(()=>{this.$_scrollDirty=!1;const{continuous:t}=this.updateVisibleItems(!1,!0);t||(clearTimeout(this.$_refreshTimout),this.$_refreshTimout=setTimeout(this.handleScroll,this.updateInterval+100))});e(),this.updateInterval&&(this.$_updateTimeout=setTimeout(()=>{this.$_updateTimeout=0,this.$_scrollDirty&&e()},this.updateInterval))}},handleVisibilityChange(i,e){this.ready&&(i||e.boundingClientRect.width!==0||e.boundingClientRect.height!==0?(this.$emit("visible"),requestAnimationFrame(()=>{this.updateVisibleItems(!1)})):this.$emit("hidden"))},updateVisibleItems(i,e=!1){const t=this.itemSize,a=this.gridItems||1,n=this.itemSecondarySize||t,o=this.$_computedMinItemSize,d=this.typeField,p=this.simpleArray?null:this.keyField,r=this.items,c=r.length,g=this.sizes,_=this.$_views,v=this.$_unusedViews,T=this.pool,C=this.itemIndexByKey;let b,V,N,j,R;if(!c)b=V=j=R=N=0;else if(this.$_prerender)b=j=0,V=R=Math.min(this.prerender,r.length),N=null;else{const l=this.getScroll();if(e){let A=l.start-this.$_lastUpdateScrollPosition;if(A<0&&(A=-A),t===null&&A<o||A<t)return{continuous:!0}}this.$_lastUpdateScrollPosition=l.start;const G=this.buffer;l.start-=G,l.end+=G;let Y=0;if(this.$refs.before&&(Y=this.$refs.before.scrollHeight,l.start-=Y),this.$refs.after){const A=this.$refs.after.scrollHeight;l.end+=A}if(t===null){let A,X=0,S=c-1,F=~~(c/2),P;do P=F,A=g[F].accumulator,A<l.start?X=F:F<c-1&&g[F+1].accumulator>l.start&&(S=F),F=~~((X+S)/2);while(F!==P);for(F<0&&(F=0),b=F,N=g[c-1].accumulator,V=F;V<c&&g[V].accumulator<l.end;V++);for(V===-1?V=r.length-1:(V++,V>c&&(V=c)),j=b;j<c&&Y+g[j].accumulator<l.start;j++);for(R=j;R<c&&Y+g[R].accumulator<l.end;R++);}else{b=~~(l.start/t*a);const A=b%a;b-=A,V=Math.ceil(l.end/t*a),j=Math.max(0,Math.floor((l.start-Y)/t*a)),R=Math.floor((l.end-Y)/t*a),b<0&&(b=0),V>c&&(V=c),j<0&&(j=0),R>c&&(R=c),N=Math.ceil(c/a)*t}}V-b>ja.itemsLimit&&this.itemsLimitError(),this.totalSize=N;let $;const O=b<=this.$_endIndex&&V>=this.$_startIndex;if(O)for(let l=0,G=T.length;l<G;l++)$=T[l],$.nr.used&&(i&&($.nr.index=C[$.item[p]]),($.nr.index==null||$.nr.index<b||$.nr.index>=V)&&this.unuseView($));const h=O?null:new Map;let f,L,k;for(let l=b;l<V;l++){f=r[l];const G=p?f[p]:f;if(G==null)throw new Error(`Key is ${G} on item (keyField is '${p}')`);if($=_.get(G),!t&&!g[l].size){$&&this.unuseView($);continue}L=f[d];let Y=v.get(L),A=!1;if(!$)O?Y&&Y.length?$=Y.pop():$=this.addView(T,l,f,G,L):(k=h.get(L)||0,(!Y||k>=Y.length)&&($=this.addView(T,l,f,G,L),this.unuseView($,!0),Y=v.get(L)),$=Y[k],h.set(L,k+1)),_.delete($.nr.key),$.nr.used=!0,$.nr.index=l,$.nr.key=G,$.nr.type=L,_.set(G,$),A=!0;else if(!$.nr.used&&($.nr.used=!0,A=!0,Y)){const X=Y.indexOf($);X!==-1&&Y.splice(X,1)}$.item=f,A&&(l===r.length-1&&this.$emit("scroll-end"),l===0&&this.$emit("scroll-start")),t===null?($.position=g[l-1].accumulator,$.offset=0):($.position=Math.floor(l/a)*t,$.offset=l%a*n)}return this.$_startIndex=b,this.$_endIndex=V,this.emitUpdate&&this.$emit("update",b,V,j,R),clearTimeout(this.$_sortTimer),this.$_sortTimer=setTimeout(this.sortViews,this.updateInterval+300),{continuous:O}},getListenerTarget(){let i=zt(this.$el);return window.document&&(i===window.document.documentElement||i===window.document.body)&&(i=window),i},getScroll(){const{$el:i,direction:e}=this,t=e==="vertical";let a;if(this.pageMode){const n=i.getBoundingClientRect(),o=t?n.height:n.width;let d=-(t?n.top:n.left),p=t?window.innerHeight:window.innerWidth;d<0&&(p+=d,d=0),d+p>o&&(p=o-d),a={start:d,end:d+p}}else t?a={start:i.scrollTop,end:i.scrollTop+i.clientHeight}:a={start:i.scrollLeft,end:i.scrollLeft+i.clientWidth};return a},applyPageMode(){this.pageMode?this.addListeners():this.removeListeners()},addListeners(){this.listenerTarget=this.getListenerTarget(),this.listenerTarget.addEventListener("scroll",this.handleScroll,Ct?{passive:!0}:!1),this.listenerTarget.addEventListener("resize",this.handleResize)},removeListeners(){this.listenerTarget&&(this.listenerTarget.removeEventListener("scroll",this.handleScroll),this.listenerTarget.removeEventListener("resize",this.handleResize),this.listenerTarget=null)},scrollToItem(i){let e;const t=this.gridItems||1;this.itemSize===null?e=i>0?this.sizes[i-1].accumulator:0:e=Math.floor(i/t)*this.itemSize,this.scrollToPosition(e)},scrollToPosition(i){const e=this.direction==="vertical"?{scroll:"scrollTop",start:"top"}:{scroll:"scrollLeft",start:"left"};let t,a,n;if(this.pageMode){const o=zt(this.$el),d=o.tagName==="HTML"?0:o[e.scroll],p=o.getBoundingClientRect(),c=this.$el.getBoundingClientRect()[e.start]-p[e.start];t=o,a=e.scroll,n=i+d+c}else t=this.$el,a=e.scroll,n=i;t[a]=n},itemsLimitError(){throw setTimeout(()=>{console.log("It seems the scroller element isn't scrolling, so it tries to render all the items at once.","Scroller:",this.$el),console.log("Make sure the scroller has a fixed height (or width) and 'overflow-y' (or 'overflow-x') set to 'auto' so it can scroll correctly and only render the items visible in the scroll viewport.")}),new Error("Rendered items limit reached")},sortViews(){this.pool.sort((i,e)=>i.nr.index-e.nr.index)}}};const Ya={key:0,ref:"before",class:"vue-recycle-scroller__slot"},Qa={key:1,ref:"after",class:"vue-recycle-scroller__slot"};function en(i,e,t,a,n,o){const d=Qt("ResizeObserver"),p=es("observe-visibility");return je((u(),m("div",{class:ne(["vue-recycle-scroller",{ready:n.ready,"page-mode":t.pageMode,[`direction-${i.direction}`]:!0}]),onScrollPassive:e[0]||(e[0]=(...r)=>o.handleScroll&&o.handleScroll(...r))},[i.$slots.before?(u(),m("div",Ya,[We(i.$slots,"before")],512)):E("v-if",!0),(u(),ee(Vt(t.listTag),{ref:"wrapper",style:fe({[i.direction==="vertical"?"minHeight":"minWidth"]:n.totalSize+"px"}),class:ne(["vue-recycle-scroller__item-wrapper",t.listClass])},{default:x(()=>[(u(!0),m(te,null,oe(n.pool,r=>(u(),ee(Vt(t.itemTag),xs({key:r.nr.id,style:n.ready?{transform:`translate${i.direction==="vertical"?"Y":"X"}(${r.position}px) translate${i.direction==="vertical"?"X":"Y"}(${r.offset}px)`,width:t.gridItems?`${i.direction==="vertical"&&t.itemSecondarySize||t.itemSize}px`:void 0,height:t.gridItems?`${i.direction==="horizontal"&&t.itemSecondarySize||t.itemSize}px`:void 0}:null,class:["vue-recycle-scroller__item-view",[t.itemClass,{hover:!t.skipHover&&n.hoverKey===r.nr.key}]]},Ps(t.skipHover?{}:{mouseenter:()=>{n.hoverKey=r.nr.key},mouseleave:()=>{n.hoverKey=null}})),{default:x(()=>[We(i.$slots,"default",{item:r.item,index:r.nr.index,active:r.nr.used})]),_:2},1040,["style","class"]))),128)),We(i.$slots,"empty")]),_:3},8,["style","class"])),i.$slots.after?(u(),m("div",Qa,[We(i.$slots,"after")],512)):E("v-if",!0),w(d,{onNotify:o.handleResize},null,8,["onNotify"])],34)),[[p,o.handleVisibilityChange]])}ft.render=en;ft.__file="src/components/RecycleScroller.vue";const tn={class:"trial-list-search"},sn=["value"],an=de({__name:"TrialListSearch",props:{modelValue:{}},emits:["update:modelValue"],setup(i,{emit:e}){const t=e,a=B(),n=ms(c=>{t("update:modelValue",c)},300);function o(c){const g=c.target.value;n(g)}function d(){t("update:modelValue",""),a.value?.focus()}function p(){a.value?.focus(),a.value?.select()}function r(c){c.type==="focus-trial-search"&&p()}return Fe(()=>{window.addEventListener("focus-trial-search",r)}),Le(()=>{window.removeEventListener("focus-trial-search",r)}),(c,g)=>(u(),m("div",tn,[w(W(ns),{class:"search-icon"}),s("input",{ref_key:"searchInput",ref:a,type:"text",class:"search-input",placeholder:"Filter trials...",value:c.modelValue,onInput:o,onKeydown:ht(d,["escape"])},null,40,sn),c.modelValue?(u(),ee(W(os),{key:0,class:"clear-icon",onClick:d})):E("",!0)]))}}),nn=ce(an,[["__scopeId","data-v-3a032c2b"]]),on={class:"item-content"},ln={class:"item-header"},rn=["title"],un={key:0,class:"progress-bar"},dn={class:"item-metadata"},cn={class:"meta-item"},pn={class:"meta-item"},fn={key:0,class:"meta-separator"},mn={key:1,class:"meta-item cost"},vn=de({__name:"TrialListItem",props:{trial:{},selected:{type:Boolean}},emits:["click"],setup(i){const e=i,{calculateTemplateTokens:t,calculatePromptTokens:a,estimateTotalCost:n,sumEstimates:o,formatCost:d}=dt(),p=U(()=>{if(e.trial.progress.total===0)return 0;const _=e.trial.progress.completed+e.trial.progress.failed;return Math.round(_/e.trial.progress.total*100)}),r=U(()=>{const{completed:_,failed:v,total:T}=e.trial.progress;return e.trial.status==="draft"?`${T} tasks`:`${_+v}/${T} tasks`}),c=U(()=>{const _=e.trial.started||e.trial.created;if(!_)return"";const T=new Date().getTime()-_.getTime(),C=Math.floor(T/1e3),b=Math.floor(C/60),V=Math.floor(b/60),N=Math.floor(V/24);return C<60?"now":b<60?`${b}m`:V<24?`${V}h`:`${N}d`}),g=U(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let _=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)_=t(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const C=a(e.trial.spreadsheetConfig.promptPattern),b=e.trial.progress.total/e.trial.configurations.length;_={totalTokens:C*b,combinationCount:b,perCallAverage:C}}else if(e.trial.type==="playground")return null;if(!_||_.totalTokens===0)return null;const v=e.trial.configurations.map(C=>{const b=C.modelSnapshot;return b?n(_.totalTokens,_.combinationCount,b,C.parameters):null}).filter(Boolean);if(v.length===0)return null;const T=o(v);return`${d(T,"compact")} total`});return(_,v)=>(u(),m("div",{class:ne(["trial-list-item",{selected:_.selected,"has-progress":_.trial.status==="running"}]),onClick:v[0]||(v[0]=T=>_.$emit("click"))},[s("div",{class:ne(["status-indicator",`status-${_.trial.status}`])},null,2),s("div",on,[s("div",ln,[s("span",{class:"trial-name",title:_.trial.name},y(_.trial.name),9,rn),s("span",{class:ne(["status-tag",`status-${_.trial.status}`])},y(_.trial.status.toUpperCase()),3)]),_.trial.status==="running"?(u(),m("div",un,[s("div",{class:"progress-fill",style:fe({width:`${p.value}%`})},null,4)])):E("",!0),s("div",dn,[s("span",cn,y(r.value),1),v[1]||(v[1]=s("span",{class:"meta-separator"},"â€¢",-1)),s("span",pn,y(c.value),1),g.value?(u(),m("span",fn,"â€¢")):E("",!0),g.value?(u(),m("span",mn,y(g.value),1)):E("",!0)])])],2))}}),Bt=ce(vn,[["__scopeId","data-v-037b1757"]]),gn={class:"section-title"},hn=de({__name:"TrialListSection",props:{title:{},background:{type:Boolean}},setup(i){return(e,t)=>(u(),m("div",{class:ne(["trial-list-section",{"with-background":e.background}])},[s("span",gn,y(e.title),1)],2))}}),Wt=ce(hn,[["__scopeId","data-v-07a26c58"]]),yn={class:"panel-header"},bn={class:"header-title"},_n={key:0,class:"title-text"},Tn={class:"trial-count"},Cn={key:0,class:"header-actions"},$n={class:"filter-count"},wn={class:"filter-count"},kn={class:"filter-count"},Sn={class:"filter-count"},In={class:"filter-count"},En={key:1,class:"status-tabs"},Rn={class:"tab-count"},Fn={class:"tab-count"},xn={class:"tab-count"},Pn={class:"trial-list-container"},An={key:1,class:"trial-list"},Vn={key:2,class:"collapsed-list"},On=["onClick"],Dn={class:"collapsed-count"},Ln={key:3,class:"empty-state"},Nn=de({__name:"TrialListPanelV3",props:{trials:{},selectedTrialId:{},searchQuery:{},filterStatus:{}},emits:["select-trial","create-trial","import-trial","update-search","update-filter","refresh"],setup(i,{emit:e}){const t=i,a=e,n=B(!1),o=B("all"),d=B(250),p=U(()=>d.value<50),r=U(()=>t.trials.filter(h=>h.status==="running"||h.status==="paused").length),c=U(()=>t.trials.filter(h=>h.status==="completed"||h.status==="failed").length),g=U(()=>{let h=t.trials;if(t.searchQuery){const l=t.searchQuery.toLowerCase();h=h.filter(G=>{const Y=G.name.toLowerCase().includes(l),A=G.templateConfig?.template?.toLowerCase().includes(l),X=G.configurations.some(S=>S.modelId.toLowerCase().includes(l)||S.provider.toLowerCase().includes(l));return Y||A||X})}t.filterStatus!=="all"&&(h=h.filter(l=>l.status===t.filterStatus)),o.value==="active"?h=h.filter(l=>l.status==="running"||l.status==="paused"):o.value==="done"&&(h=h.filter(l=>l.status==="completed"||l.status==="failed"));const f=h.filter(l=>l.status==="running"),L=h.filter(l=>l.status!=="running"),k=[];return f.length>0&&(k.push({type:"section",title:"RUNNING",background:!0,id:"section-running"}),k.push(...f.sort((l,G)=>(G.started?.getTime()||0)-(l.started?.getTime()||0)))),L.length>0&&(f.length>0&&k.push({type:"section",title:"RECENT",background:!1,id:"section-recent"}),k.push(...L.sort((l,G)=>(G.created?.getTime()||0)-(l.created?.getTime()||0)))),k}),_=U(()=>g.value.map(h=>({...h,height:N(h)}))),v=U(()=>t.trials.filter(h=>o.value==="active"?h.status==="running"||h.status==="paused":o.value==="done"?h.status==="completed"||h.status==="failed":!0)),T=U(()=>t.searchQuery?"No trials found":t.filterStatus==="running"?"No trials are currently running":"No trials found"),C=U(()=>t.searchQuery?"No trials match your search":t.filterStatus!=="all"?`No ${t.filterStatus} trials`:"Create your first trial to get started"),b=U(()=>t.filterStatus==="all"&&!t.searchQuery);function V(h){return t.trials.filter(f=>f.status===h).length}function N(h){if(h.type==="section")return 32;const f=h.status==="running",L=h.configurations?.some(k=>k.repeatCount>1);return f||L?96:80}function j(h){const f=h.progress.completed+h.progress.failed;return h.status==="running"?`${Math.round(f/h.progress.total*100)}%`:f.toString()}async function R(){n.value=!0;try{await new Promise(h=>setTimeout(h,500)),a("refresh")}finally{n.value=!1}}function $({key:h}){a("update-filter",h)}function O(){const h=document.querySelector(".trial-list-panel");h&&(d.value=h.clientWidth)}return Fe(()=>{O(),window.addEventListener("resize",O);const h=document.querySelector(".trial-list-panel");h&&new ResizeObserver(()=>O()).observe(h)}),Le(()=>{window.removeEventListener("resize",O)}),(h,f)=>{const L=xe,k=Ft,l=Gs,G=Rt,Y=Et;return u(),m("div",{class:ne(["trial-list-panel",{collapsed:p.value}])},[s("div",yn,[s("div",bn,[w(W(Bs),{class:"title-icon"}),p.value?E("",!0):(u(),m("span",_n,"Trials")),s("span",Tn,y(h.trials.length),1)]),p.value?E("",!0):(u(),m("div",Cn,[w(L,{type:"primary",size:"small",onClick:f[0]||(f[0]=A=>h.$emit("create-trial"))},{default:x(()=>[w(W(Ws)),f[7]||(f[7]=D(" New Trial "))]),_:1,__:[7]}),w(L,{size:"small",onClick:f[1]||(f[1]=A=>h.$emit("import-trial"))},{default:x(()=>[w(W(ls)),f[8]||(f[8]=D(" Import "))]),_:1,__:[8]}),w(L,{size:"small",onClick:R,loading:n.value},{default:x(()=>[w(W(js),{spin:n.value},null,8,["spin"])]),_:1},8,["loading"]),w(Y,null,{overlay:x(()=>[w(G,{onClick:$},{default:x(()=>[w(k,{key:"all"},{default:x(()=>f[9]||(f[9]=[s("span",null,"All Trials",-1)])),_:1,__:[9]}),w(l),w(k,{key:"running"},{default:x(()=>[f[10]||(f[10]=s("span",null,"Running Only",-1)),s("span",$n,y(V("running")),1)]),_:1,__:[10]}),w(k,{key:"completed"},{default:x(()=>[f[11]||(f[11]=s("span",null,"Completed Only",-1)),s("span",wn,y(V("completed")),1)]),_:1,__:[11]}),w(k,{key:"failed"},{default:x(()=>[f[12]||(f[12]=s("span",null,"Failed Only",-1)),s("span",kn,y(V("failed")),1)]),_:1,__:[12]}),w(k,{key:"paused"},{default:x(()=>[f[13]||(f[13]=s("span",null,"Paused Only",-1)),s("span",Sn,y(V("paused")),1)]),_:1,__:[13]}),w(k,{key:"draft"},{default:x(()=>[f[14]||(f[14]=s("span",null,"Draft Only",-1)),s("span",In,y(V("draft")),1)]),_:1,__:[14]})]),_:1})]),default:x(()=>[w(L,{size:"small"},{default:x(()=>[w(W(Hs))]),_:1})]),_:1})]))]),p.value?E("",!0):(u(),ee(nn,{key:0,"model-value":h.searchQuery,"onUpdate:modelValue":f[2]||(f[2]=A=>h.$emit("update-search",A))},null,8,["model-value"])),p.value?E("",!0):(u(),m("div",En,[s("div",{class:ne(["status-tab",{active:o.value==="all"}]),onClick:f[3]||(f[3]=A=>o.value="all")},[f[15]||(f[15]=s("span",{class:"tab-icon"},"ðŸ“Š",-1)),f[16]||(f[16]=s("span",{class:"tab-label"},"ALL",-1)),s("span",Rn,y(h.trials.length),1)],2),s("div",{class:ne(["status-tab",{active:o.value==="active"}]),onClick:f[4]||(f[4]=A=>o.value="active")},[f[17]||(f[17]=s("span",{class:"tab-icon"},"ðŸŸ¢",-1)),f[18]||(f[18]=s("span",{class:"tab-label"},"Active",-1)),s("span",Fn,y(r.value),1)],2),s("div",{class:ne(["status-tab",{active:o.value==="done"}]),onClick:f[5]||(f[5]=A=>o.value="done")},[f[19]||(f[19]=s("span",{class:"tab-icon"},"âœ…",-1)),f[20]||(f[20]=s("span",{class:"tab-label"},"Done",-1)),s("span",xn,y(c.value),1)],2)])),s("div",Pn,[!p.value&&g.value.length>100?(u(),ee(W(ft),{key:0,class:"trial-list virtual-list",items:_.value,"size-field":"height","key-field":"id",buffer:10},{default:x(({item:A})=>[A.type==="section"?(u(),ee(Wt,{key:0,title:A.title,background:A.background},null,8,["title","background"])):(u(),ee(Bt,{key:1,trial:A,selected:A.id===h.selectedTrialId,"data-trial-id":A.id,onClick:X=>h.$emit("select-trial",A.id)},null,8,["trial","selected","data-trial-id","onClick"]))]),_:1},8,["items"])):p.value?(u(),m("div",Vn,[(u(!0),m(te,null,oe(v.value,A=>(u(),m("div",{key:A.id,class:ne(["collapsed-item",{selected:A.id===h.selectedTrialId}]),onClick:X=>h.$emit("select-trial",A.id)},[s("div",{class:ne(["status-dot",`status-${A.status}`])},null,2),s("span",Dn,y(j(A)),1)],10,On))),128))])):(u(),m("div",An,[(u(!0),m(te,null,oe(g.value,(A,X)=>(u(),m(te,{key:A.id||`section-${X}`},[A.type==="section"?(u(),ee(Wt,{key:0,title:A.title,background:A.background},null,8,["title","background"])):(u(),ee(Bt,{key:1,trial:A,selected:A.id===h.selectedTrialId,"data-trial-id":A.id,onClick:S=>h.$emit("select-trial",A.id)},null,8,["trial","selected","data-trial-id","onClick"]))],64))),128))])),g.value.length===0&&!p.value?(u(),m("div",Ln,[w(W(is),{class:"empty-icon"}),s("h3",null,y(T.value),1),s("p",null,y(C.value),1),b.value?(u(),ee(L,{key:0,type:"primary",size:"large",onClick:f[6]||(f[6]=A=>h.$emit("create-trial"))},{default:x(()=>f[21]||(f[21]=[D(" Create New Trial ")])),_:1,__:[21]})):E("",!0)])):E("",!0)])],2)}}}),Mn=ce(Nn,[["__scopeId","data-v-ad2a17cf"]]),Un={class:"trial-header"},zn={class:"header-main"},Bn={class:"header-title"},Wn={class:"trial-name"},jn={key:0,class:"progress-container"},Hn={class:"progress-bar"},Gn={class:"progress-stats-inline"},qn={class:"progress-text"},Jn={key:0,class:"progress-stat"},Xn={class:"stat-number"},Kn={key:1,class:"progress-stat"},Zn={class:"stat-number"},Yn={key:2,class:"progress-stat"},Qn={class:"stat-number"},eo=de({__name:"TrialHeaderV3",props:{trial:{},progress:{},isExecuting:{type:Boolean}},setup(i){const e=i,t=U(()=>{let C=e.trial.name;return C=C.replace(/\s*-\s*\d{1,2}\/\d{1,2}\/\d{4}$/,""),C=C.replace(/\s*\(Copy\)(\s*\(Copy\))*/g,""),C.trim()}),a=U(()=>!0),n=U(()=>e.progress?e.progress.completed+e.progress.failed:0),o=U(()=>{if(!e.progress||e.progress.total===0)return 0;const C=e.progress.completed+e.progress.failed;return Math.round(C/e.progress.total*100)}),d=U(()=>{const C=e.trial.started||e.trial.created;if(!C)return"0m";let b;if(e.trial.status==="draft")return"0m";e.trial.completed?b=e.trial.completed:b=new Date;const V=b.getTime()-C.getTime(),N=Math.floor(V/(1e3*60*60)),j=Math.floor(V%(1e3*60*60)/(1e3*60));return N>0?`${N}h ${j}m`:`${j}m`}),p=U(()=>{if(!e.progress?.avgLatencyMs)return null;const C=e.progress.avgLatencyMs;return C<1e3?`${Math.round(C)}ms`:`${(C/1e3).toFixed(1)}s`}),{calculateTemplateTokens:r,calculatePromptTokens:c,estimateTotalCost:g,sumEstimates:_,formatCost:v}=dt();U(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let C=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)C=r(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const N=c(e.trial.spreadsheetConfig.promptPattern),R=(e.progress?.total||e.trial.progress.total)/e.trial.configurations.length;C={totalTokens:N*R,combinationCount:R,perCallAverage:N}}else if(e.trial.type==="playground")return null;if(!C||C.totalTokens===0)return null;const b=e.trial.configurations.map(N=>{const j=N.modelSnapshot;return j?g(C.totalTokens,C.combinationCount,j,N.parameters):null}).filter(Boolean);if(b.length===0)return null;const V=_(b);return`${v(V,"compact")} total`});const T=U(()=>{if(e.trial.status!=="running"||!e.progress||e.progress.completed===0)return null;const b=(Date.now()-(e.trial.started?.getTime()||0))/e.progress.completed,V=e.progress.pending*b,N=Math.floor(V/(1e3*60)),j=Math.floor(V%(1e3*60)/1e3);if(N>60){const R=Math.floor(N/60),$=N%60;return`${R}h ${$}m`}return`${N}m ${j}s`});return(C,b)=>(u(),m("div",Un,[s("div",zn,[s("div",Bn,[s("h2",Wn,y(t.value),1),s("span",{class:ne(["status-tag",`status-${C.trial.status}`])},y(C.trial.status.toUpperCase()),3)]),a.value?(u(),m("div",jn,[s("div",Hn,[s("div",{class:"progress-fill",style:fe({width:`${o.value}%`})},null,4)]),s("div",Gn,[s("span",qn,y(n.value)+"/"+y(C.progress?.total||0)+" ("+y(o.value)+"%) ",1),d.value?(u(),m("span",Jn,[b[0]||(b[0]=s("span",{class:"stat-label"},"Duration:",-1)),b[1]||(b[1]=D()),s("span",Xn,y(d.value),1)])):E("",!0),p.value?(u(),m("span",Kn,[b[2]||(b[2]=s("span",{class:"stat-label"},"Avg:",-1)),b[3]||(b[3]=D()),s("span",Zn,y(p.value),1)])):E("",!0),T.value?(u(),m("span",Yn,[b[4]||(b[4]=s("span",{class:"stat-label"},"Remaining:",-1)),b[5]||(b[5]=D()),s("span",Qn,"~"+y(T.value),1)])):E("",!0)])])):E("",!0)]),E("",!0)]))}}),to=ce(eo,[["__scopeId","data-v-248be564"]]),so={class:"trial-actions"},ao={class:"action-group execution-controls"},no={class:"action-group data-actions"},oo={class:"action-group management-actions"},lo=de({__name:"TrialActionsV3",props:{trial:{},isLeader:{type:Boolean},executionState:{}},emits:["start","pause","resume","cancel","duplicate","edit","delete","export-data","export-python","refresh"],setup(i,{emit:e}){const t=i,a=e,n=B(!1),o=B(!1),d=B(!1);U(()=>t.executionState?.currentTrialId===t.trial.id);const p=U(()=>["draft","failed","cancelled"].includes(t.trial.status)),r=U(()=>t.trial.status==="running"),c=U(()=>t.trial.status==="paused"),g=U(()=>["running","paused"].includes(t.trial.status));function _(){a("start")}async function v(){n.value=!0,o.value=!1,a("pause"),setTimeout(()=>{n.value=!1},1e3)}async function T(){o.value=!0,n.value=!1,a("resume"),setTimeout(()=>{o.value=!1},3e3)}function C(){Me.confirm({title:"Cancel trial?",content:"This will stop all pending API calls.",okText:"Cancel Trial",okType:"danger",onOk:()=>a("cancel")})}async function b(){d.value=!0,a("refresh"),setTimeout(()=>{d.value=!1},500)}function V({key:$}){$==="data"?a("export-data"):$==="python"&&a("export-python")}function N(){a("duplicate")}function j(){a("edit")}function R(){const $=t.trial.progress.total;Me.confirm({title:"Delete trial?",content:`Delete trial and all ${$} API calls?`,okText:"Delete",okType:"danger",cancelText:"Cancel",onOk:()=>{a("delete")}})}return($,O)=>{const h=xe,f=Ft,L=Rt,k=Et;return u(),m("div",so,[s("div",ao,[p.value?(u(),ee(h,{key:0,type:"primary",size:"large",disabled:!$.isLeader,onClick:_},{default:x(()=>[w(W(Lt)),O[0]||(O[0]=D(" Start Trial "))]),_:1,__:[0]},8,["disabled"])):E("",!0),r.value?(u(),ee(h,{key:1,size:"large",disabled:!$.isLeader,loading:n.value,onClick:v},{default:x(()=>[n.value?E("",!0):(u(),ee(W(qs),{key:0})),D(" "+y(n.value?"Pausing...":"Pause"),1)]),_:1},8,["disabled","loading"])):E("",!0),c.value?(u(),ee(h,{key:2,type:"primary",size:"large",disabled:!$.isLeader||o.value,loading:o.value,onClick:T},{default:x(()=>[o.value?E("",!0):(u(),ee(W(Lt),{key:0})),D(" "+y(o.value?"Resuming...":"Resume"),1)]),_:1},8,["disabled","loading"])):E("",!0),g.value?(u(),ee(h,{key:3,danger:"",size:"large",disabled:!$.isLeader,onClick:C},{default:x(()=>[w(W(Js)),O[1]||(O[1]=D(" Cancel "))]),_:1,__:[1]},8,["disabled"])):E("",!0)]),s("div",no,[w(h,{size:"large",loading:d.value,onClick:b,title:"Refresh trial data from database"},{default:x(()=>[d.value?(u(),ee(W(rs),{key:1,spin:""})):(u(),ee(W(Xs),{key:0})),D(" "+y(d.value?"Refreshing...":"Refresh"),1)]),_:1},8,["loading"]),w(k,null,{overlay:x(()=>[w(L,{onClick:V},{default:x(()=>[w(f,{key:"data"},{default:x(()=>[w(W(Zs)),O[3]||(O[3]=D(" Export Data "))]),_:1,__:[3]}),w(f,{key:"python"},{default:x(()=>[w(W(Ys)),O[4]||(O[4]=D(" Export Python Script "))]),_:1,__:[4]})]),_:1})]),default:x(()=>[w(h,{size:"large"},{default:x(()=>[O[2]||(O[2]=D(" Export ")),w(W(Ks))]),_:1,__:[2]})]),_:1})]),s("div",oo,[w(h,{size:"large",disabled:!$.isLeader,onClick:N},{default:x(()=>[w(W(xt)),O[5]||(O[5]=D(" Duplicate "))]),_:1,__:[5]},8,["disabled"]),$.trial.status==="draft"?(u(),ee(h,{key:0,size:"large",disabled:!$.isLeader,onClick:j},{default:x(()=>[w(W(Qs)),O[6]||(O[6]=D(" Edit "))]),_:1,__:[6]},8,["disabled"])):E("",!0),w(h,{danger:"",size:"large",disabled:!$.isLeader,onClick:R},{default:x(()=>[w(W(ea)),O[7]||(O[7]=D(" Delete "))]),_:1,__:[7]},8,["disabled"])])])}}}),io=ce(lo,[["__scopeId","data-v-e642c431"]]),ro={class:"snapshot-debug"},uo={class:"debug-header"},co={class:"status-row"},po={key:0,class:"badge success"},fo={key:1,class:"badge warning"},mo={key:0,class:"status-row"},vo={key:0,class:"variables-section"},go={class:"variable-header"},ho={class:"var-name"},yo={class:"var-type"},bo={key:0,class:"snapshot-content"},_o={class:"snapshot-meta"},To={key:0},Co={class:"snapshot-items"},$o={class:"items-preview"},wo={class:"item-index"},ko={class:"item-value"},So={key:0,class:"item-attrs"},Io={key:0,class:"more-indicator"},Eo={key:1,class:"no-snapshot"},Ro={key:0},Fo={key:1,class:"legacy-warning"},xo={class:"debug-footer"},Po=de({__name:"SnapshotDebugModal",props:{visible:{type:Boolean},trial:{},migrating:{type:Boolean}},emits:["close","migrate"],setup(i){const e=i,t=U(()=>e.trial.templateConfig?.hasSnapshots===!0),a=U(()=>e.trial.templateConfig?.variables||{});function n(c){return"snapshot"in c&&c.snapshot!=null}function o(c){return c.snapshot}function d(c){return n(c)?`${o(c).source.type} (snapshot)`:c.type==="value"?"Direct values":c.type==="list"?"List reference":"Unknown"}function p(){for(const c of Object.values(a.value))if(n(c)){const g=o(c);if(g.source?.snapshotDate)return new Date(g.source.snapshotDate).toLocaleString()}return"Unknown"}function r(){const c={trialId:e.trial.id,trialName:e.trial.name,hasSnapshots:t.value,variables:a.value};navigator.clipboard.writeText(JSON.stringify(c,null,2)),ue.success("Debug info copied to clipboard")}return(c,g)=>{const _=rt,v=ut,T=xe,C=Me;return u(),ee(C,{visible:c.visible,title:"Variable Snapshot Debug View",width:"80%",footer:null,onCancel:g[2]||(g[2]=b=>c.$emit("close"))},{default:x(()=>[s("div",ro,[s("div",uo,[s("div",co,[g[5]||(g[5]=s("span",{class:"label"},"Snapshot Status:",-1)),t.value?(u(),m("span",po,[w(W(us)),g[3]||(g[3]=D(" Snapshots Enabled "))])):(u(),m("span",fo,[w(W(Je)),g[4]||(g[4]=D(" Legacy Mode (No Snapshots) "))]))]),t.value?(u(),m("div",mo,[g[6]||(g[6]=s("span",{class:"label"},"Snapshot Date:",-1)),s("span",null,y(p()),1)])):E("",!0)]),t.value?(u(),m("div",vo,[g[8]||(g[8]=s("h3",null,"Variable Snapshots",-1)),(u(!0),m(te,null,oe(a.value,(b,V)=>(u(),m("div",{key:V,class:"variable-card"},[s("div",go,[s("span",ho,y(V),1),s("span",yo,y(d(b)),1)]),n(b)?(u(),m("div",bo,[s("div",_o,[s("span",null,"Source: "+y(o(b).source.type),1),o(b).source.listName?(u(),m("span",To," List: "+y(o(b).source.listName),1)):E("",!0),s("span",null,"Items: "+y(o(b).items.length),1)]),s("div",Co,[s("div",$o,[(u(!0),m(te,null,oe(o(b).items.slice(0,5),(N,j)=>(u(),m("div",{key:j,class:"item-row"},[s("span",wo,y(j+1)+".",1),s("span",ko,y(N.value),1),N.attributes&&Object.keys(N.attributes).length>0?(u(),m("span",So,[(u(!0),m(te,null,oe(N.attributes,(R,$)=>(u(),ee(_,{key:$,size:"small"},{default:x(()=>[D(y($)+": "+y(R),1)]),_:2},1024))),128))])):E("",!0)]))),128)),o(b).items.length>5?(u(),m("div",Io," ... and "+y(o(b).items.length-5)+" more items ",1)):E("",!0)])])])):(u(),m("div",Eo,[w(W(Je)),g[7]||(g[7]=D(" No snapshot - using live reference ")),b.listId?(u(),m("span",Ro,"List ID: "+y(b.listId),1)):E("",!0)]))]))),128))])):(u(),m("div",Fo,[w(v,{message:"Legacy Trial",description:"This trial was created before snapshots were implemented. Variable lists are loaded dynamically from the database, which means changes to lists will affect trial duplication.",type:"warning","show-icon":""}),w(T,{type:"primary",onClick:g[0]||(g[0]=b=>c.$emit("migrate")),loading:c.migrating,style:{"margin-top":"16px"}},{default:x(()=>[w(W(ta)),g[9]||(g[9]=D(" Migrate to Snapshots "))]),_:1,__:[9]},8,["loading"])])),s("div",xo,[w(T,{onClick:r},{default:x(()=>[w(W(xt)),g[10]||(g[10]=D(" Copy Debug Info "))]),_:1,__:[10]}),w(T,{onClick:g[1]||(g[1]=b=>c.$emit("close"))},{default:x(()=>g[11]||(g[11]=[D("Close")])),_:1,__:[11]})])])]),_:1},8,["visible"])}}}),Ao=ce(Po,[["__scopeId","data-v-726379cc"]]),Vo={class:"trial-detail-view"},Oo={key:0,class:"detail-content"},Do={class:"detail-section"},Lo={class:"detail-grid"},No={class:"detail-item"},Mo={key:0,class:"detail-item"},Uo={key:1,class:"detail-item"},zo={class:"detail-item"},Bo={class:"detail-item"},Wo={class:"detail-section"},jo={class:"detail-grid"},Ho={key:0,class:"detail-item full-width"},Go={key:1,class:"detail-item full-width"},qo={class:"detail-item"},Jo={class:"detail-item"},Xo={style:{display:"flex","align-items":"center",gap:"8px"}},Ko={key:0,class:"snapshot-badge success"},Zo={key:1,class:"snapshot-badge warning"},Yo={class:"detail-item"},Qo={key:2,class:"detail-item"},el={key:0,class:"detail-section"},tl={class:"detail-grid"},sl={class:"detail-item"},al={class:"detail-item"},nl={class:"detail-item"},ol={class:"detail-section"},ll={class:"model-configs"},il={class:"config-header"},rl=["src","alt"],ul={class:"provider-name"},dl={class:"config-details"},cl={class:"config-item"},pl={class:"config-params"},fl={class:"param-list"},ml={key:0,class:"config-item"},vl={class:"cost"},gl={key:1,class:"config-item"},hl={class:"cost"},yl={class:"config-item"},bl={class:"snapshot-debug"},_l=de({__name:"TrialDetailView",props:{trial:{},isCollapsed:{type:Boolean}},emits:["toggle-collapse"],setup(i){const e=i,t=B(!1),{calculateTemplateTokens:a,estimateTotalCost:n,formatCost:o}=dt(),d=U(()=>{const h=e.trial.started||e.trial.created,L=(e.trial.completed||new Date).getTime()-h.getTime(),k=Math.floor(L/(1e3*60*60)),l=Math.floor(L%(1e3*60*60)/(1e3*60));return k>0?`${k}h ${l}m`:`${l}m`}),p=U(()=>({draft:"Not started",pending:"Waiting to start",running:"Executing API calls",paused:"Execution paused",completed:"All calls completed",failed:"Execution failed",cancelled:"Execution cancelled"})[e.trial.status]||e.trial.status),r=U(()=>e.trial.type==="template"&&e.trial.templateConfig?.variables?Object.keys(e.trial.templateConfig.variables).length:0),c=U(()=>Math.round(e.trial.progress.total*750)),g=U(()=>e.trial.type==="template"&&e.trial.templateConfig?e.trial.templateConfig.hasSnapshots===!0:!1),_=U(()=>"text"),v=U(()=>1),T=U(()=>e.trial.progress.total/v.value);function C(h){return h?new Date(h).toLocaleString():"N/A"}function b(){if(e.trial.templateConfig?.templateName)return e.trial.templateConfig.templateName;const h=e.trial.templateConfig?.template||"Unknown Template";return h.length>50?h.substring(0,50)+"...":h}function V(){return e.trial.spreadsheetConfig?.datasetId||"Unknown Dataset"}function N(h){return{"openai-chat":"OpenAI","anthropic-messages":"Anthropic",openrouter:"OpenRouter","ollama-chat":"Ollama","ollama-generate":"Ollama"}[h]||h}function j(h){}async function R(){try{ue.info("Migration feature coming soon"),t.value=!1}catch(h){ue.error("Failed to migrate trial"),I.error("Migration error:",h)}}function $(h){const f=h.modelSnapshot;return f?.capabilities?.inputCostPerToken?`$${((f.capabilities.inputCostPerToken+f.capabilities.outputCostPerToken)*1e3).toFixed(8)}/1k tokens`:null}function O(h){if(!e.trial.configurations||!h.modelSnapshot)return null;let f=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)f=a(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else return null;if(!f||f.totalTokens===0)return null;const L=n(f.totalTokens,f.combinationCount,h.modelSnapshot,h.parameters);if(!L.meta.hasValidCost||L.cost.total.expected===-1)return null;const k=(e.trial.repeatCount||1)*L.cost.total.expected;return o({...L,cost:{...L.cost,total:{...L.cost.total,expected:k}}},"compact")}return(h,f)=>{const L=xe;return u(),m("div",Vo,[s("div",{class:"detail-header",onClick:f[0]||(f[0]=k=>h.$emit("toggle-collapse"))},[f[3]||(f[3]=s("h3",null,"Trial Details",-1)),w(W(sa),{class:ne(["collapse-icon",{rotated:h.isCollapsed}])},null,8,["class"])]),h.isCollapsed?E("",!0):(u(),m("div",Oo,[s("div",Do,[f[9]||(f[9]=s("h4",null,"Basic Information",-1)),s("div",Lo,[s("div",No,[f[4]||(f[4]=s("label",null,"Created:",-1)),s("span",null,y(C(h.trial.created)),1)]),h.trial.started?(u(),m("div",Mo,[f[5]||(f[5]=s("label",null,"Started:",-1)),s("span",null,y(C(h.trial.started)),1)])):E("",!0),h.trial.completed?(u(),m("div",Uo,[f[6]||(f[6]=s("label",null,"Completed:",-1)),s("span",null,y(C(h.trial.completed)),1)])):E("",!0),s("div",zo,[f[7]||(f[7]=s("label",null,"Duration:",-1)),s("span",null,y(d.value),1)]),s("div",Bo,[f[8]||(f[8]=s("label",null,"Status:",-1)),s("span",null,y(h.trial.status)+" - "+y(p.value),1)])])]),s("div",Wo,[f[19]||(f[19]=s("h4",null,"Configuration",-1)),s("div",jo,[h.trial.type==="template"?(u(),m("div",Ho,[f[10]||(f[10]=s("label",null,"Template:",-1)),s("span",null,y(b()),1)])):E("",!0),h.trial.type==="spreadsheet"?(u(),m("div",Go,[f[11]||(f[11]=s("label",null,"Dataset:",-1)),s("span",null,y(V()),1)])):E("",!0),s("div",qo,[f[12]||(f[12]=s("label",null,"Variable Lists:",-1)),s("span",null,y(r.value)+" lists",1)]),s("div",Jo,[f[16]||(f[16]=s("label",null,"Data Snapshot:",-1)),s("div",Xo,[g.value?(u(),m("span",Ko,[w(W(us)),f[13]||(f[13]=D(" Captured "))])):(u(),m("span",Zo,[w(W(Je)),f[14]||(f[14]=D(" Live Reference "))])),h.trial.type==="template"?(u(),ee(L,{key:2,size:"small",type:"link",onClick:f[1]||(f[1]=k=>t.value=!0)},{default:x(()=>[w(W(ds)),f[15]||(f[15]=D(" Debug "))]),_:1,__:[15]})):E("",!0)])]),s("div",Yo,[f[17]||(f[17]=s("label",null,"Token Estimate:",-1)),s("span",null,"~"+y(c.value)+" tokens",1)]),_.value?(u(),m("div",Qo,[f[18]||(f[18]=s("label",null,"Output Type:",-1)),s("span",{class:ne(["output-type",`type-${_.value}`])},y(_.value),3)])):E("",!0)])]),v.value>1?(u(),m("div",el,[f[23]||(f[23]=s("h4",null,"Repeat Configuration",-1)),s("div",tl,[s("div",sl,[f[20]||(f[20]=s("label",null,"Times per prompt:",-1)),s("span",null,y(v.value),1)]),s("div",al,[f[21]||(f[21]=s("label",null,"Total combinations:",-1)),s("span",null,y(T.value),1)]),s("div",nl,[f[22]||(f[22]=s("label",null,"Total API calls:",-1)),s("span",null,y(h.trial.progress.total),1)])])])):E("",!0),s("div",ol,[f[29]||(f[29]=s("h4",null,"Model Configurations",-1)),s("div",ll,[(u(!0),m(te,null,oe(h.trial.configurations,(k,l)=>(u(),m("div",{key:l,class:"model-config-card"},[s("div",il,[(k.provider,void 0)?(u(),m("img",{key:0,src:(k.provider,void 0),alt:k.provider,class:"provider-logo"},null,8,rl)):E("",!0),s("span",ul,y(N(k.provider)),1)]),s("div",dl,[s("div",cl,[f[24]||(f[24]=s("label",null,"Model:",-1)),s("span",null,y(k.modelId),1)]),s("div",pl,[f[25]||(f[25]=s("label",null,"Parameters:",-1)),s("div",fl,[(u(!0),m(te,null,oe(k.parameters,(G,Y)=>(u(),m("span",{key:Y,class:"param-tag"},y(Y)+": "+y(G),1))),128))])]),$(k)?(u(),m("div",ml,[f[26]||(f[26]=s("label",null,"Cost Rate:",-1)),s("span",vl,y($(k)),1)])):E("",!0),O(k)?(u(),m("div",gl,[f[27]||(f[27]=s("label",null,"Total Trial Cost:",-1)),s("span",hl,y(O(k)),1)])):E("",!0),s("div",yl,[f[28]||(f[28]=s("label",null,"Model Snapshot:",-1)),s("pre",bl,y(JSON.stringify(k.modelSnapshot,null,2)),1)])])]))),128))])])])),t.value?(u(),ee(Ao,{key:1,visible:t.value,trial:h.trial,onClose:f[2]||(f[2]=k=>t.value=!1),onMigrate:R},null,8,["visible","trial"])):E("",!0)])}}}),Tl=ce(_l,[["__scopeId","data-v-e677baaf"]]),Cl={class:"filter-bar"},$l={class:"search-container"},wl={class:"zoom-controls"},kl=["disabled"],Sl={class:"zoom-level"},Il=["disabled"],El=de({__name:"TrialResultsFilterBar",props:{statusFilter:{},configFilter:{},searchQuery:{},visibleColumns:{},configurations:{},apiCalls:{},showRepeatColumn:{type:Boolean},zoomLevel:{},isFullscreen:{type:Boolean}},emits:["update:statusFilter","update:configFilter","update:searchQuery","update:visibleColumns","openPostProcessing","toggleFullscreen","zoomIn","zoomOut","resetZoom"],setup(i,{emit:e}){const t=i,a=e,n=U(()=>{const c=[{key:"status",label:"Status"},{key:"configuration",label:"Configuration"},{key:"variables",label:"Variables"},{key:"response",label:"Response"},{key:"parsedResponse",label:"Parsed Response"},{key:"postProcessedResponse",label:"Post-Processed"},{key:"length",label:"Length"},{key:"latency",label:"Latency"}];return t.showRepeatColumn&&c.splice(2,0,{key:"repeat",label:"Repeat Index"}),c}),o=U(()=>{const c={total:t.apiCalls.length,completed:0,failed:0,running:0,pending:0};return t.apiCalls.forEach(g=>{g.status==="completed"?c.completed++:g.status==="failed"?c.failed++:g.status==="running"?c.running++:g.status==="pending"&&c.pending++}),c});function d(c){return c.modelSnapshot?.displayName||`${c.provider} - ${c.modelId}`}const p=ms(c=>{const g=c.target.value;a("update:searchQuery",g)},300);function r(c){const g=[...t.visibleColumns],_=g.indexOf(c);if(_>-1)g.splice(_,1);else{const v=n.value.map(b=>b.key),T=v.indexOf(c);let C=0;for(let b=0;b<T;b++)g.includes(v[b])&&C++;g.splice(C,0,c)}a("update:visibleColumns",g)}return(c,g)=>{const _=na,v=aa,T=cs,C=xe,b=ps,V=Ft,N=Rt,j=Et;return u(),m("div",Cl,[w(v,{value:c.statusFilter,onChange:g[0]||(g[0]=R=>c.$emit("update:statusFilter",R)),placeholder:"Filter by status",style:{width:"150px"}},{default:x(()=>[w(_,{value:"all"},{default:x(()=>[D(" All ("+y(o.value.total)+") ",1)]),_:1}),w(_,{value:"completed"},{default:x(()=>[D(" Completed ("+y(o.value.completed)+") ",1)]),_:1}),w(_,{value:"failed"},{default:x(()=>[D(" Failed ("+y(o.value.failed)+") ",1)]),_:1}),w(_,{value:"running"},{default:x(()=>[D(" Running ("+y(o.value.running)+") ",1)]),_:1}),w(_,{value:"pending"},{default:x(()=>[D(" Pending ("+y(o.value.pending)+") ",1)]),_:1})]),_:1},8,["value"]),w(v,{value:c.configFilter,onChange:g[1]||(g[1]=R=>c.$emit("update:configFilter",R)),mode:"multiple",placeholder:"Filter by configuration",style:{width:"250px"},"max-tag-count":2},{default:x(()=>[w(_,{value:""},{default:x(()=>g[6]||(g[6]=[D("All Configurations")])),_:1,__:[6]}),(u(!0),m(te,null,oe(c.configurations,(R,$)=>(u(),ee(_,{key:$,value:$.toString()},{default:x(()=>[D(y(d(R)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s("div",$l,[w(T,{value:c.searchQuery,onInput:W(p),placeholder:"Search in variables and responses...",style:{width:"200px"},"allow-clear":""},{prefix:x(()=>[w(W(ns))]),_:1},8,["value","onInput"])]),w(j,null,{overlay:x(()=>[w(N,null,{default:x(()=>[(u(!0),m(te,null,oe(n.value,R=>(u(),ee(V,{key:R.key},{default:x(()=>[w(b,{checked:c.visibleColumns.includes(R.key),disabled:R.key==="status",onChange:$=>r(R.key)},{default:x(()=>[D(y(R.label),1)]),_:2},1032,["checked","disabled","onChange"])]),_:2},1024))),128))]),_:1})]),default:x(()=>[w(C,null,{default:x(()=>[w(W(oa)),g[7]||(g[7]=D(" Columns "))]),_:1,__:[7]})]),_:1}),s("div",wl,[s("button",{type:"button",class:"zoom-btn",disabled:(c.zoomLevel??1)<=.5,title:"Zoom out",onClick:g[2]||(g[2]=R=>c.$emit("zoomOut"))}," âˆ’ ",8,kl),s("span",Sl,y(Math.round((c.zoomLevel??1)*100))+"%",1),s("button",{type:"button",class:"zoom-btn",disabled:(c.zoomLevel??1)>=2,title:"Zoom in",onClick:g[3]||(g[3]=R=>c.$emit("zoomIn"))}," + ",8,Il),s("button",{type:"button",class:"zoom-btn reset",title:"Reset zoom",onClick:g[4]||(g[4]=R=>c.$emit("resetZoom"))}," â†º ")]),w(C,{onClick:g[5]||(g[5]=R=>c.$emit("toggleFullscreen")),title:c.isFullscreen?"Exit Fullscreen":"Enter Fullscreen"},{default:x(()=>[D(y(c.isFullscreen?"âŠŸ Exit":"âŠž Fullscreen"),1)]),_:1},8,["title"])])}}}),Rl=ce(El,[["__scopeId","data-v-87828574"]]),Fl={class:"modal-content"},xl={class:"section"},Pl={class:"info-grid"},Al={class:"info-item"},Vl={class:"monospace"},Ol={class:"info-item"},Dl={class:"info-item"},Ll={key:0,class:"info-item"},Nl={class:"info-item"},Ml={key:1,class:"info-item"},Ul={key:2,class:"info-item"},zl={key:3,class:"info-item"},Bl={key:0,class:"info-row"},Wl={class:"monospace"},jl={key:0,class:"section"},Hl={class:"variables-list"},Gl={class:"variable-main"},ql={class:"variable-label"},Jl={class:"variable-value"},Xl={key:0,class:"variable-attributes"},Kl={class:"attribute-label"},Zl={class:"attribute-value"},Yl={class:"section"},Ql={class:"content-box prompt-display"},ei={key:1,class:"section"},ti={key:0,class:"error-result"},si={key:1,class:"success-result"},ai={class:"content-box response-content"},ni={key:0,class:"parsed-content-section"},oi={class:"content-box parsed-content"},li={key:1,class:"post-processed-section"},ii={class:"content-box post-processed-content"},ri={key:2,class:"refusal-warning"},ui={key:3,class:"refusal-warning"},di={class:"extraction-config-section"},ci={class:"config-grid"},pi={key:0,class:"config-item"},fi={class:"config-value"},mi={key:1,class:"config-item"},vi={class:"config-value"},gi={key:2,class:"config-item"},hi={class:"config-value pattern"},yi={key:3,class:"config-item"},bi={class:"config-value"},_i={key:4,class:"config-item"},Ti={class:"config-value"},Ci={key:5,class:"config-item"},$i={class:"config-value"},wi={key:6,class:"config-item no-extraction"},ki={key:4,class:"post-processing-config-section"},Si={class:"config-grid"},Ii={class:"config-item post-processing-item"},Ei={class:"config-value"},Ri={key:0,class:"config-item post-processing-item"},Fi={class:"config-value"},xi={key:1,class:"config-item post-processing-item"},Pi={class:"config-value pattern"},Ai={key:2,class:"config-item post-processing-item"},Vi={class:"config-value"},Oi={key:3,class:"config-item post-processing-item"},Di={class:"config-value"},Li={key:4,class:"config-item post-processing-item"},Ni={class:"config-value"},Mi={key:5,class:"usage-info"},Ui={class:"info-grid"},zi={class:"info-item"},Bi={class:"info-item"},Wi={class:"info-item"},ji={key:0,class:"info-item"},Hi={class:"raw-data-section"},Gi={class:"raw-data"},qi={key:0},Ji={key:1,class:"raw-data"},Xi={key:2},Ki={key:3,class:"raw-data"},Zi={class:"modal-footer"},Yi={key:0,class:"footer-left"},Qi={class:"position-indicator"},er={class:"footer-right"},tr=de({__name:"APICallDetailModalV3",props:{visible:{type:Boolean},apiCall:{},trial:{},allApiCalls:{}},emits:["update:visible","navigate"],setup(i,{emit:e}){const t=i,a=e,n=Ds(),o=U(()=>t.allApiCalls?t.allApiCalls.findIndex(S=>S.id===t.apiCall.id):-1),d=U(()=>t.allApiCalls?.length||0),p=U(()=>o.value>0),r=U(()=>o.value>=0&&o.value<d.value-1),c=U(()=>!p.value||!t.allApiCalls?null:t.allApiCalls[o.value-1]),g=U(()=>!r.value||!t.allApiCalls?null:t.allApiCalls[o.value+1]),_=U(()=>{if(t.apiCall.duration!==void 0)return t.apiCall.duration;if(!t.apiCall.completed||!t.apiCall.created)return null;const S=new Date(t.apiCall.created).getTime();return new Date(t.apiCall.completed).getTime()-S}),v=U(()=>{if(t.apiCall.modelName){const F=t.trial.configurations[t.apiCall.configurationIndex];return F?`${F.provider} / ${t.apiCall.modelName}`:t.apiCall.modelName}const S=t.trial.configurations[t.apiCall.configurationIndex];return S?`${S.provider} / ${S.modelId}`:null}),T=U(()=>{if(t.apiCall.cost!==void 0)return t.apiCall.cost;if(!t.apiCall.result?.usage)return null;const S=t.trial.configurations[t.apiCall.configurationIndex];if(!S)return null;const F=n.models.value.find(be=>be.provider===S.provider&&be.modelId===S.modelId);if(!F?.capabilities?.inputCostPerToken&&!F?.capabilities?.outputCostPerToken)return null;const P=(t.apiCall.result.usage.prompt_tokens||0)*(F.capabilities.inputCostPerToken||0),le=(t.apiCall.result.usage.completion_tokens||0)*(F.capabilities.outputCostPerToken||0);return P+le}),C=U(()=>{if(!t.apiCall.request)return"No request data";const S=JSON.parse(JSON.stringify(t.apiCall.request));return S.headers&&Object.keys(S.headers).forEach(F=>{(F.toLowerCase().includes("authorization")||F.toLowerCase().includes("api-key")||F.toLowerCase().includes("x-api-key"))&&(S.headers[F]="[REDACTED]")}),S.body&&typeof S.body=="object"&&(S.body.api_key&&(S.body.api_key="[REDACTED]"),S.body.apiKey&&(S.body.apiKey="[REDACTED]")),JSON.stringify(S,null,2)}),b=U(()=>t.apiCall.parserId?{parserId:t.apiCall.parserId,outputType:t.trial.type==="template"?t.trial.templateConfig?.outputType:void 0,extractPattern:t.trial.type==="template"?t.trial.templateConfig?.extractPattern:void 0,refusalWords:t.trial.type==="template"?t.trial.templateConfig?.refusalWords:void 0,refusalMode:t.trial.type==="template"?t.trial.templateConfig?.refusalMode:void 0,rejectRefusalWords:t.trial.type==="template"?t.trial.templateConfig?.rejectRefusalWords:void 0}:t.trial.type!=="template"||!t.trial.templateConfig?{}:{parserId:t.trial.templateConfig.parserId,outputType:t.trial.templateConfig.outputType,extractPattern:t.trial.templateConfig.extractPattern,refusalWords:t.trial.templateConfig.refusalWords,refusalMode:t.trial.templateConfig.refusalMode,rejectRefusalWords:t.trial.templateConfig.rejectRefusalWords}),V=U(()=>{const S=b.value;return!!(S.parserId||S.outputType||S.extractPattern||S.refusalWords&&S.refusalWords.length>0)}),N=U(()=>t.trial.postProcessingConfig||null),j=U(()=>t.apiCall.response?JSON.stringify({status:t.apiCall.response.status,headers:t.apiCall.response.headers,body:t.apiCall.response.body,latencyMs:t.apiCall.response.latencyMs},null,2):"No response data available"),R=U(()=>t.apiCall.result?JSON.stringify(t.apiCall.result,null,2):"No processed result available");function $(S){return{completed:"success",failed:"error",running:"processing",pending:"warning"}[S]||"default"}function O(){const S=t.trial.configurations[t.apiCall.configurationIndex];return S?.modelSnapshot?.displayName||S?.modelId||`Configuration ${t.apiCall.configurationIndex+1}`}function h(S){return(typeof S=="string"?new Date(S):S).toLocaleString()}function f(S){return S<1e3?`${S}ms`:S<6e4?`${(S/1e3).toFixed(1)}s`:`${Math.floor(S/6e4)}m ${(S%6e4/1e3).toFixed(0)}s`}function L(S){return S==null?"null":typeof S=="string"?S:typeof S=="number"||typeof S=="boolean"?String(S):JSON.stringify(S,null,2)}function k(S){return{network_error_no_response:"Network Error (No Response)",api_error_received:"API Error Response",parsing_error:"Response Parsing Error",timeout:"Request Timeout",rate_limit:"Rate Limit Exceeded"}[S]||S}function l(){a("update:visible",!1)}function G(){c.value&&a("navigate",c.value)}function Y(){g.value&&a("navigate",g.value)}function A(S){if(t.visible)switch(S.key){case"ArrowLeft":S.preventDefault(),G();break;case"ArrowRight":S.preventDefault(),Y();break;case"Escape":S.preventDefault(),l();break}}Fe(()=>{document.addEventListener("keydown",A)}),Le(()=>{document.removeEventListener("keydown",A)});async function X(){const S={id:t.apiCall.id,status:t.apiCall.status,configuration:O(),provider:v.value,variables:t.apiCall.variables,variableAttributes:t.apiCall.variableAttributes,prompt:t.apiCall.prompt,fullApiResponse:t.apiCall.response,processedResult:t.apiCall.result,extractionConfig:b.value,postProcessingConfig:N.value,created:t.apiCall.created,completed:t.apiCall.completed,duration:_.value?`${_.value}ms`:null,cost:T.value?`$${T.value.toFixed(4)}`:null},F=JSON.stringify(S,null,2);try{await navigator.clipboard.writeText(F),ue.success("Details copied to clipboard!")}catch(P){I.error("Failed to copy to clipboard",P),ue.error("Failed to copy to clipboard")}}return(S,F)=>{const P=rt,le=ut,be=ia,ve=la,ge=xe,me=Me;return u(),ee(me,{open:S.visible,onCancel:F[0]||(F[0]=ye=>a("update:visible",!1)),title:"API Call Details",width:1400,footer:null,"body-style":{padding:0,height:"85vh",display:"flex",flexDirection:"column"},centered:!0,"destroy-on-close":!0,class:"api-call-detail-modal"},{default:x(()=>[s("div",Fl,[s("div",xl,[F[10]||(F[10]=s("h3",null,"Overview",-1)),s("div",Pl,[s("div",Al,[F[1]||(F[1]=s("label",null,"Call ID:",-1)),s("span",Vl,y(S.apiCall.id),1)]),s("div",Ol,[F[2]||(F[2]=s("label",null,"Status:",-1)),w(P,{color:$(S.apiCall.status)},{default:x(()=>[D(y(S.apiCall.status.toUpperCase()),1)]),_:1},8,["color"])]),s("div",Dl,[F[3]||(F[3]=s("label",null,"Configuration:",-1)),s("span",null,y(O()),1)]),S.apiCall.repeatIndex!==void 0?(u(),m("div",Ll,[F[4]||(F[4]=s("label",null,"Repeat:",-1)),s("span",null,"#"+y(S.apiCall.repeatIndex+1),1)])):E("",!0),s("div",Nl,[F[5]||(F[5]=s("label",null,"Created:",-1)),s("span",null,y(h(S.apiCall.created)),1)]),S.apiCall.completed?(u(),m("div",Ml,[F[6]||(F[6]=s("label",null,"Completed:",-1)),s("span",null,y(h(S.apiCall.completed)),1)])):E("",!0),_.value?(u(),m("div",Ul,[F[7]||(F[7]=s("label",null,"Duration:",-1)),s("span",null,y(f(_.value)),1)])):E("",!0),S.apiCall.result?.latency?(u(),m("div",zl,[F[8]||(F[8]=s("label",null,"API Latency:",-1)),s("span",null,y(S.apiCall.result.latency)+"ms",1)])):E("",!0)]),v.value?(u(),m("div",Bl,[F[9]||(F[9]=s("label",null,"Provider/Model:",-1)),s("span",Wl,y(v.value),1)])):E("",!0)]),S.apiCall.variables&&Object.keys(S.apiCall.variables).length>0?(u(),m("div",jl,[F[11]||(F[11]=s("h3",null,"Variables",-1)),s("div",Hl,[(u(!0),m(te,null,oe(S.apiCall.variables,(ye,Se)=>(u(),m("div",{key:Se,class:"variable-group"},[s("div",Gl,[s("label",ql,y(Se)+":",1),s("span",Jl,y(ye),1)]),S.apiCall.variableAttributes&&S.apiCall.variableAttributes[Se]?(u(),m("div",Xl,[(u(!0),m(te,null,oe(S.apiCall.variableAttributes[Se],(Ue,Ae)=>(u(),m("div",{key:Ae,class:"attribute-item"},[s("label",Kl,y(Ae)+":",1),s("span",Zl,y(Ue),1)]))),128))])):E("",!0)]))),128))])])):E("",!0),s("div",Yl,[F[12]||(F[12]=s("h3",null,"Resolved Prompt",-1)),s("div",Ql,y(S.apiCall.prompt),1)]),S.apiCall.result?(u(),m("div",ei,[F[36]||(F[36]=s("h3",null,"Response",-1)),S.apiCall.status==="failed"&&S.apiCall.result.error?(u(),m("div",ti,[w(le,{type:"error",message:S.apiCall.result.error,description:S.apiCall.result.errorType?`Error Type: ${k(S.apiCall.result.errorType)}`:void 0,"show-icon":""},null,8,["message","description"])])):S.apiCall.result.content?(u(),m("div",si,[s("div",ai,y(S.apiCall.result.content),1),S.apiCall.result.parsedContent!==void 0?(u(),m("div",ni,[F[13]||(F[13]=s("h4",null,"Extracted Value (Original)",-1)),s("div",oi,y(L(S.apiCall.result.parsedContent)),1)])):E("",!0),S.apiCall.result.postParsedContent!==void 0?(u(),m("div",li,[F[14]||(F[14]=s("h4",null,"Post-Processed Value",-1)),s("div",ii,y(L(S.apiCall.result.postParsedContent)),1)])):E("",!0),S.apiCall.result.refused?(u(),m("div",ri,[w(le,{type:"warning",message:"Response flagged as refusal (Original Extraction)",description:"This response matched configured refusal patterns","show-icon":""})])):E("",!0),S.apiCall.result.postRefused?(u(),m("div",ui,[w(le,{type:"warning",message:"Response flagged as refusal (Post-Processing)",description:"This response matched post-processing refusal patterns","show-icon":""})])):E("",!0),s("div",di,[F[22]||(F[22]=s("h4",null,"Original Extraction Configuration",-1)),s("div",ci,[b.value.parserId?(u(),m("div",pi,[F[15]||(F[15]=s("label",null,"Parser ID:",-1)),s("span",fi,y(b.value.parserId),1)])):E("",!0),b.value.outputType?(u(),m("div",mi,[F[16]||(F[16]=s("label",null,"Output Type:",-1)),s("span",vi,y(b.value.outputType),1)])):E("",!0),b.value.extractPattern?(u(),m("div",gi,[F[17]||(F[17]=s("label",null,"Extract Pattern:",-1)),s("span",hi,y(b.value.extractPattern),1)])):E("",!0),b.value.refusalWords&&b.value.refusalWords.length>0?(u(),m("div",yi,[F[18]||(F[18]=s("label",null,"Refusal Words:",-1)),s("span",bi,y(b.value.refusalWords.join(", ")),1)])):E("",!0),b.value.refusalMode?(u(),m("div",_i,[F[19]||(F[19]=s("label",null,"Refusal Mode:",-1)),s("span",Ti,y(b.value.refusalMode==="parse_anyway"?"Parse normally":"Replace with REFUSED"),1)])):b.value.rejectRefusalWords!==void 0?(u(),m("div",Ci,[F[20]||(F[20]=s("label",null,"Reject on Refusal (Legacy):",-1)),s("span",$i,y(b.value.rejectRefusalWords?"Yes":"No"),1)])):E("",!0),V.value?E("",!0):(u(),m("div",wi,F[21]||(F[21]=[s("span",{class:"no-config-message"},"No extraction configuration set for this trial",-1)])))])]),N.value&&N.value.enabled?(u(),m("div",ki,[F[30]||(F[30]=s("h4",null,"Post-Processing Configuration",-1)),s("div",Si,[s("div",Ii,[F[24]||(F[24]=s("label",null,"Status:",-1)),s("span",Ei,[w(P,{color:"processing"},{default:x(()=>F[23]||(F[23]=[D("Enabled")])),_:1,__:[23]})])]),N.value.outputType?(u(),m("div",Ri,[F[25]||(F[25]=s("label",null,"Output Type:",-1)),s("span",Fi,y(N.value.outputType),1)])):E("",!0),N.value.extractPattern?(u(),m("div",xi,[F[26]||(F[26]=s("label",null,"Extract Pattern:",-1)),s("span",Pi,y(N.value.extractPattern),1)])):E("",!0),N.value.refusalWords&&N.value.refusalWords.length>0?(u(),m("div",Ai,[F[27]||(F[27]=s("label",null,"Refusal Words:",-1)),s("span",Vi,y(N.value.refusalWords.join(", ")),1)])):E("",!0),N.value.rejectRefusalWords!==void 0?(u(),m("div",Oi,[F[28]||(F[28]=s("label",null,"Reject on Refusal:",-1)),s("span",Di,y(N.value.rejectRefusalWords?"Yes":"No"),1)])):E("",!0),N.value.updatedAt?(u(),m("div",Li,[F[29]||(F[29]=s("label",null,"Last Updated:",-1)),s("span",Ni,y(h(N.value.updatedAt)),1)])):E("",!0)])])):E("",!0),S.apiCall.result.usage?(u(),m("div",Mi,[F[35]||(F[35]=s("h4",null,"Token Usage",-1)),s("div",Ui,[s("div",zi,[F[31]||(F[31]=s("label",null,"Prompt Tokens:",-1)),s("span",null,y(S.apiCall.result.usage.prompt_tokens||0),1)]),s("div",Bi,[F[32]||(F[32]=s("label",null,"Completion Tokens:",-1)),s("span",null,y(S.apiCall.result.usage.completion_tokens||0),1)]),s("div",Wi,[F[33]||(F[33]=s("label",null,"Total Tokens:",-1)),s("span",null,y(S.apiCall.result.usage.total_tokens||0),1)]),T.value?(u(),m("div",ji,[F[34]||(F[34]=s("label",null,"Cost:",-1)),s("span",null,"$"+y(T.value.toFixed(4)),1)])):E("",!0)])])):E("",!0)])):E("",!0)])):E("",!0),w(ve,{ghost:""},{default:x(()=>[w(be,{key:"raw",header:"Raw Data"},{default:x(()=>[s("div",Hi,[F[37]||(F[37]=s("h4",null,"HTTP Request",-1)),s("pre",Gi,y(C.value),1),S.apiCall.response?(u(),m("h4",qi,"Full API Response")):E("",!0),S.apiCall.response?(u(),m("pre",Ji,y(j.value),1)):E("",!0),S.apiCall.result?(u(),m("h4",Xi,"Processed Result")):E("",!0),S.apiCall.result?(u(),m("pre",Ki,y(R.value),1)):E("",!0)])]),_:1})]),_:1})]),s("div",Zi,[S.allApiCalls&&d.value>1?(u(),m("div",Yi,[w(ge,{onClick:G,disabled:!p.value,size:"large",class:"nav-button"},{default:x(()=>F[38]||(F[38]=[D(" â† Previous ")])),_:1,__:[38]},8,["disabled"]),s("span",Qi,y(o.value+1)+" of "+y(d.value),1),w(ge,{onClick:Y,disabled:!r.value,size:"large",class:"nav-button"},{default:x(()=>F[39]||(F[39]=[D(" Next â†’ ")])),_:1,__:[39]},8,["disabled"])])):E("",!0),s("div",er,[w(ge,{onClick:l,size:"large"},{default:x(()=>F[40]||(F[40]=[D(" Close ")])),_:1,__:[40]}),w(ge,{type:"primary",onClick:X,size:"large"},{default:x(()=>[w(W(xt)),F[41]||(F[41]=D(" Copy Details "))]),_:1,__:[41]})])])]),_:1},8,["open"])}}}),_s=ce(tr,[["__scopeId","data-v-f7da98a4"]]),sr={class:"post-processing-modal"},ar={key:2,class:"current-extraction"},nr={class:"parser-info"},or={class:"parser-name"},lr={key:3,class:"current-post-processing"},ir={class:"parser-info"},rr={class:"parser-name"},ur={key:4,class:"test-results"},dr={class:"footer-container"},cr={key:0,class:"footer-statistics"},pr={class:"stat-inline"},fr={class:"stat-inline"},mr={class:"stat-inline"},vr={class:"stat-inline"},gr={key:0,class:"stat-sample-note"},hr={key:1,class:"footer-progress"},yr={class:"processing-message"},br={class:"footer-buttons"},_r=de({__name:"PostProcessingModalV2",props:{visible:{type:Boolean},trial:{}},emits:["close"],setup(i,{emit:e}){const t=i,a=e,n=ct(),o=ha(),d=B(t.visible),p=B(!1),r=B(!1),c=B(!1),g=B(null),_=B({postParserId:null}),v=B(""),T=B(0),C=B([]),b=B(null),V=[{title:"Variables",dataIndex:"variables",key:"variables",width:200,customRender:({text:A})=>Object.entries(A).map(([X,S])=>`${X}: ${S}`).join(", ")},{title:"Original",dataIndex:"original",key:"original",slots:{customRender:"original"}},{title:"Post-Processed",dataIndex:"postProcessed",key:"postProcessed",slots:{customRender:"postProcessed"}},{title:"Changed",dataIndex:"changed",key:"changed",width:100,slots:{customRender:"changed"}}],N=U(()=>t.trial.parserId?o.parsers.find(A=>A.id===t.trial.parserId):null),j=U(()=>t.trial.postParserId?o.parsers.find(A=>A.id===t.trial.postParserId):null);function R(A){switch(A){case"regex":return"blue";case"javascript":return"orange";case"python":return"green";default:return"default"}}function $(A){return A===void 0?"(no match)":A===null?"null":typeof A=="string"&&A.length>50?A.substring(0,50)+"...":String(A)}function O(){r.value=!0}function h(A){g.value=A,c.value=!0}async function f(A,X){if(!A||!X){C.value=[],b.value=null;return}await L(X),await k(X)}async function L(A){const X=n.apiCalls.value.filter(F=>F.result?.content).slice(0,10),S=[];for(const F of X){const P=await Ot.executeParser(F.result.content,A);S.push({id:F.id,variables:F.variables,original:F.result.parsedContent,postProcessed:P.success?P.value:null,changed:P.success&&P.value!==F.result.parsedContent})}C.value=S}async function k(A){if(!n.apiCalls.value.length){b.value=null;return}const X=n.apiCalls.value,S=X.length,F=X.filter(ye=>ye.result?.content),P=F.length,le=Math.min(50,P),be=F.slice(0,le);let ve=0,ge=0;for(const ye of be){const Se=await Ot.executeParser(ye.result.content,A);Se.success&&Se.value!==void 0&&(ve++,Se.value!==ye.result.parsedContent&&ge++)}const me=le<P;if(me&&le>0){const ye=P/le;ve=Math.round(ve*ye),ge=Math.round(ge*ye)}b.value={total:S,withContent:P,matches:ve,changed:ge,sampled:me,sampleSize:le}}async function l(){p.value=!0,v.value="Clearing post-processing...";try{const A=await Mt.updatePostParserId(t.trial.id,null,!1);if(A.ok)_.value.postParserId=null,C.value=[],b.value=null,ue.success("Post-processing cleared"),await n.refreshFromDatabase(t.trial.id);else throw A.error}catch(A){I.error("Failed to clear post-processing:",A),ue.error("Failed to clear post-processing")}finally{p.value=!1,v.value=""}}async function G(){if(!_.value.postParserId){ue.warning("Please select a parser");return}p.value=!0,T.value=0;try{const A=n.apiCalls.value.filter(P=>P.status==="completed"&&P.result?.content),X=A.length>0;let S=!1;if(X){const be=(o.parsers.find(ve=>ve.id===_.value.postParserId)?.type||"parser")==="python"?`Apply post-processing to ${A.length} existing calls?

Note: Python parsers may take several minutes for large trials.`:`Apply post-processing to ${A.length} existing calls?`;S=confirm(be)}S?(v.value=`Applying to ${A.length} calls...`,T.value=10):(v.value="Saving configuration...",T.value=50);const F=await Mt.updatePostParserId(t.trial.id,_.value.postParserId,S);if(F.ok)T.value=90,v.value="Refreshing data...",await n.refreshFromDatabase(t.trial.id),T.value=100,v.value="Complete!",ue.success(S?`Post-processing applied to ${A.length} calls`:"Post-processing configured for future calls"),p.value=!1,setTimeout(()=>{Y()},1e3);else throw F.error}catch(A){I.error("Failed to apply post-processing:",A),ue.error("Failed to apply post-processing"),p.value=!1,v.value="",T.value=0}}function Y(){p.value||a("close")}return Fe(async()=>{if(await o.initialize(),t.trial.postParserId){_.value.postParserId=t.trial.postParserId;const A=o.parsers.find(X=>X.id===t.trial.postParserId);A&&(await L(A),await k(A))}else t.trial.postProcessingConfig?.enabled&&ue.info("Legacy post-processing config detected. Please select a parser to continue.")}),re(()=>t.visible,A=>{d.value=A}),re(d,A=>{!A&&!p.value&&a("close")}),(A,X)=>{const S=ut,F=rt,P=ra,le=ua,be=da,ve=xe,ge=Me;return u(),ee(ge,{visible:d.value,"onUpdate:visible":X[1]||(X[1]=me=>d.value=me),title:"Post-Process Extraction",width:"80%","mask-closable":!p.value,closable:!p.value,onCancel:Y},{footer:x(()=>[s("div",dr,[b.value&&_.value.postParserId&&!p.value?(u(),m("div",cr,[s("span",pr,[X[5]||(X[5]=s("span",{class:"stat-label"},"Total:",-1)),X[6]||(X[6]=D()),s("strong",null,y(b.value.total),1)]),X[13]||(X[13]=s("span",{class:"stat-divider"},"|",-1)),s("span",fr,[X[7]||(X[7]=s("span",{class:"stat-label"},"With Content:",-1)),X[8]||(X[8]=D()),s("strong",null,y(b.value.withContent),1)]),X[14]||(X[14]=s("span",{class:"stat-divider"},"|",-1)),s("span",mr,[X[9]||(X[9]=s("span",{class:"stat-label"},"Est. Matches:",-1)),X[10]||(X[10]=D()),s("strong",null,y(b.value.matches),1)]),X[15]||(X[15]=s("span",{class:"stat-divider"},"|",-1)),s("span",vr,[X[11]||(X[11]=s("span",{class:"stat-label"},"Est. Changed:",-1)),X[12]||(X[12]=D()),s("strong",null,y(b.value.changed),1)]),b.value.sampled?(u(),m("span",gr," ("+y(b.value.sampleSize)+" samples) ",1)):E("",!0)])):E("",!0),p.value?(u(),m("div",hr,[s("div",yr,y(v.value),1),w(be,{percent:T.value,status:T.value===100?"success":"active","stroke-width":4,style:{width:"100%"}},null,8,["percent","status"])])):E("",!0),s("div",br,[j.value?(u(),ee(ve,{key:0,onClick:l,disabled:p.value,danger:""},{default:x(()=>X[16]||(X[16]=[D(" Clear Post-Processing ")])),_:1,__:[16]},8,["disabled"])):E("",!0),w(ve,{onClick:Y,disabled:p.value},{default:x(()=>[D(y(p.value?"Processing...":"Close"),1)]),_:1},8,["disabled"]),w(ve,{type:"primary",onClick:G,loading:p.value,disabled:!_.value.postParserId||_.value.postParserId===A.trial.postParserId},{default:x(()=>[D(y(p.value?v.value:"Apply Post-Processing"),1)]),_:1},8,["loading","disabled"])])])]),default:x(()=>[s("div",sr,[A.trial.status==="running"?(u(),ee(S,{key:0,message:"Trial is currently running",description:"Post-processing will apply to all completed calls and future results as they arrive.",type:"info","show-icon":"",style:{"margin-bottom":"20px"}})):A.trial.status==="draft"?(u(),ee(S,{key:1,message:"Trial not started",description:"Configure post-processing now. It will apply when the trial runs.",type:"warning","show-icon":"",style:{"margin-bottom":"20px"}})):E("",!0),N.value?(u(),m("div",ar,[X[2]||(X[2]=s("h4",null,"Current Primary Parser",-1)),s("div",nr,[s("span",or,y(N.value.name),1),w(F,{color:R(N.value.type)},{default:x(()=>[D(y(N.value.type),1)]),_:1},8,["color"]),w(F,null,{default:x(()=>[D(y(N.value.outputType),1)]),_:1})])])):E("",!0),j.value?(u(),m("div",lr,[X[3]||(X[3]=s("h4",null,"Active Post-Processing Parser",-1)),s("div",ir,[s("span",rr,y(j.value.name),1),w(F,{color:R(j.value.type)},{default:x(()=>[D(y(j.value.type),1)]),_:1},8,["color"]),w(F,null,{default:x(()=>[D(y(j.value.outputType),1)]),_:1})])])):E("",!0),w(P,{label:j.value?"Change Post-Processing Parser":"Select Post-Processing Parser"},{default:x(()=>[w(ga,{modelValue:_.value.postParserId,"onUpdate:modelValue":X[0]||(X[0]=me=>_.value.postParserId=me),"allow-create":!0,"show-preview":!0,placeholder:"Select or create a parser for post-processing",onCreate:O,onTest:h,onChange:f},null,8,["modelValue"])]),_:1},8,["label"]),C.value.length>0&&_.value.postParserId?(u(),m("div",ur,[X[4]||(X[4]=s("h4",null,"Preview Results (First 10 calls)",-1)),w(le,{columns:V,"data-source":C.value,pagination:!1,size:"small",scroll:{x:800}},{original:x(({text:me})=>[s("code",null,y($(me)),1)]),postProcessed:x(({text:me,record:ye})=>[s("code",{class:ne({"value-changed":ye.changed})},y($(me)),3)]),changed:x(({text:me})=>[w(F,{color:me?"green":"default"},{default:x(()=>[D(y(me?"Changed":"Same"),1)]),_:2},1032,["color"])]),_:1},8,["data-source"])])):E("",!0)])]),_:1},8,["visible","mask-closable","closable"])}}}),Tr=ce(_r,[["__scopeId","data-v-17edda1c"]]),Cr={class:"table-container"},$r={class:"virtual-header"},wr={key:0,class:"col-status header-cell"},kr={key:1,class:"col-configuration header-cell"},Sr={key:2,class:"col-repeat header-cell"},Ir={key:3,class:"col-variables header-cell"},Er={key:4,class:"col-response header-cell"},Rr={key:5,class:"col-parsed header-cell"},Fr={key:6,class:"col-post-processed header-cell"},xr={key:0,class:"post-process-indicator"},Pr={key:7,class:"col-length header-cell"},Ar={key:8,class:"col-latency header-cell"},Vr=["onClick"],Or={key:0,class:"col-status cell"},Dr={class:"status-cell"},Lr={class:"status-time"},Nr={key:1,class:"col-configuration cell"},Mr={key:2,class:"col-repeat cell"},Ur={key:3,class:"col-variables cell"},zr={class:"variable-tags"},Br={key:0,class:"var-item"},Wr={key:1,class:"var-item"},jr={key:2},Hr={key:3},Gr={key:4,class:"col-response cell"},qr={class:"response-content"},Jr={key:5,class:"col-parsed cell"},Xr={class:"parsed-content"},Kr={key:6,class:"col-post-processed cell"},Zr={class:"parsed-content"},Yr={key:7,class:"col-length cell"},Qr={key:8,class:"col-latency cell"},eu={key:0,class:"col-status"},tu={key:1,class:"col-configuration"},su={key:2,class:"col-repeat"},au={key:3,class:"col-variables"},nu={key:4,class:"col-response"},ou={key:5,class:"col-parsed"},lu={key:6,class:"col-post-processed"},iu={key:0,class:"post-process-indicator"},ru={key:7,class:"col-length"},uu={key:8,class:"col-latency"},du=["onClick"],cu={key:0,class:"col-status"},pu={class:"status-cell"},fu={class:"status-time"},mu={key:1,class:"col-configuration"},vu={key:2,class:"col-repeat"},gu={key:3,class:"col-variables"},hu={class:"variable-tags"},yu={key:0,class:"var-item"},bu={key:1,class:"var-item"},_u={key:2},Tu={key:3},Cu={key:4,class:"col-response"},$u={class:"response-content"},wu={key:5,class:"col-parsed"},ku={class:"parsed-content"},Su={key:6,class:"col-post-processed"},Iu={class:"parsed-content"},Eu={key:7,class:"col-length"},Ru={key:8,class:"col-latency"},Fu={key:0},xu=["colspan"],Pu={key:0},Au={key:1},jt="trial-results-visible-columns",Vu=de({__name:"TrialResultsTableV3",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(i){const e=i,t=B("all"),a=B([]),n=B(""),o=B("");let d=null;const p=re(n,H=>{d&&clearTimeout(d),d=setTimeout(()=>{o.value=H},300)}),r=B(["status","configuration","variables","response","parsedResponse","length","latency"]),c=B(null),g=B(!1),_=B(!1),v=B(1),T=B(null),C=ct(),b=U(()=>C.apiCalls?.value||[]),V=U(()=>e.apiCalls||b.value),N=re(V,(H,Z)=>{const ie=performance.now();I.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 calls data changed from ${Z?.length||0} to ${H.length} calls`),setTimeout(()=>{const Q=performance.now();I.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 reactive update completed in ${(Q-ie).toFixed(1)}ms`)},0)}),j=H=>{if(!o.value)return H;const Z=o.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),ie=new RegExp(`(${Z})`,"gi");return H.replace(ie,"<mark>$1</mark>")},R=U(()=>{const H=performance.now();if(!(t.value!=="all"||a.value.length>0||o.value))return performance.now()-H>5&&I.info(`V4_OPTIMIZE: No filtering needed, returning ${V.value.length} calls directly`),V.value;let ie=V.value.filter(pe=>{if(t.value!=="all"&&pe.status!==t.value||a.value.length>0&&!a.value.includes(String(pe.configurationIndex)))return!1;if(o.value){const _e=o.value.toLowerCase();if(!(pe.prompt?.toLowerCase().includes(_e)||pe.result?.content?.toLowerCase().includes(_e)||pe.result?.error?.toLowerCase().includes(_e)))return!1}return!0});const Q=performance.now();return Q-H>10&&I.info(`V4_OPTIMIZE: Filtered ${V.value.length} â†’ ${ie.length} calls in ${(Q-H).toFixed(1)}ms`),ie}),$=re(R,(H,Z)=>{const ie=performance.now();I.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls changed from ${Z?.length||0} to ${H.length} items`),setTimeout(()=>{const Q=performance.now();I.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls render completed in ${(Q-ie).toFixed(1)}ms`)},0)}),O=U(()=>V.value),h=U(()=>V.value.length),f=U(()=>e.trial.configurations.some(H=>H.repeatCount>1)),L=U(()=>Math.round(60*v.value));function k(H){}function l(H){const Z=e.trial.configurations[H];return Z?Z.modelSnapshot?.displayName||`${Z.modelId}`:`Config ${H+1}`}function G(H){return H.status==="pending"?"Waiting...":H.status==="running"?"Processing...":H.status==="failed"?H.result?.errorType==="refusal_detected"||H.result?.error==="REFUSED"?H.result?.content||"REFUSED":H.result?.error||"Error occurred":H.result?.content||""}function Y(H){if(!H.result)return"";if(H.result.parsedContent!==void 0){const Z=H.result.parsedContent;return Z===null?"null":typeof Z=="string"?Z:typeof Z=="number"||typeof Z=="boolean"?String(Z):JSON.stringify(Z)}return""}function A(H){if(!H.result||H.result.postParsedContent===void 0)return"";const Z=H.result.postParsedContent;return Z===null?"null":Z==="REFUSED"||H.result.postRefused?"REFUSED":typeof Z=="string"?Z:typeof Z=="number"||typeof Z=="boolean"?String(Z):JSON.stringify(Z)}function X(H){const Z=H.result?.content||"";if(!Z)return"";const ie=Z.length;return ie>1e3?`${(ie/1e3).toFixed(1)}k chars`:`${ie} chars`}function S(H){return H?H<1e3?`${H}ms`:`${(H/1e3).toFixed(1)}s`:""}function F(H){return H.status==="completed"&&H.result?.refused?"REFUSED":H.status.toUpperCase()}function P(H){return H.status==="completed"&&H.result?.refused?"status-refused":`status-${H.status}`}function le(H){let Z;switch(H.status){case"completed":case"failed":Z=H.completed;break;case"running":Z=H.started;break;case"pending":case"cancelled":Z=H.created;break}if(!Z)return"";const ie=new Date(Z),Q=ie.getHours().toString().padStart(2,"0"),pe=ie.getMinutes().toString().padStart(2,"0"),_e=ie.getSeconds().toString().padStart(2,"0");return`Â Â ${Q}:${pe}:${_e}`}function be(H){return H?H<1e3?"latency-fast":H<5e3?"latency-medium":"latency-slow":""}function ve(H){return j(H)}function ge(H){c.value=H}function me(H){c.value=H}function ye(){_.value=!_.value,_.value?document.body.style.overflow="hidden":document.body.style.overflow=""}function Se(){v.value<2&&(v.value=Math.min(2,v.value+.1))}function Ue(){v.value>.5&&(v.value=Math.max(.5,v.value-.1))}function Ae(){v.value=1}const Ge=re(r,H=>{localStorage.setItem(jt,JSON.stringify(H))},{deep:!0});return Fe(()=>{const H=performance.now();I.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 MOUNTED with ${V.value.length} calls`);const Z=localStorage.getItem(jt);if(Z)try{r.value=JSON.parse(Z)}catch{}ze(()=>{const ie=performance.now();I.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 DOM ready in ${(ie-H).toFixed(1)}ms`),setTimeout(()=>{const Q=performance.now();I.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 virtual scrolling ready in ${(Q-H).toFixed(1)}ms`)},100)}),setTimeout(()=>{const ie=performance.now();I.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 mount completed in ${(ie-H).toFixed(1)}ms`)},0)}),Ke(()=>{I.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 ACTIVATED (cache hit) with ${V.value.length} calls`)}),Ze(()=>{I.info("V4_TRIAL_SWITCH: TrialResultsTableV3 DEACTIVATED (cached)")}),Le(()=>{I.info("V4_TRIAL_SWITCH: TrialResultsTableV3 UNMOUNTED (evicted)"),_.value&&(document.body.style.overflow=""),d&&(clearTimeout(d),d=null),p(),N(),$(),Ge()}),(H,Z)=>{const ie=es("dompurify-html");return u(),m("div",{class:ne(["trial-results-table",{fullscreen:_.value}]),ref_key:"tableContainer",ref:T},[w(Rl,{"status-filter":t.value,"onUpdate:statusFilter":Z[0]||(Z[0]=Q=>t.value=Q),"config-filter":a.value,"onUpdate:configFilter":Z[1]||(Z[1]=Q=>a.value=Q),"search-query":n.value,"onUpdate:searchQuery":Z[2]||(Z[2]=Q=>n.value=Q),"visible-columns":r.value,"onUpdate:visibleColumns":Z[3]||(Z[3]=Q=>r.value=Q),configurations:H.trial.configurations,"api-calls":O.value,"show-repeat-column":f.value,"zoom-level":v.value,"is-fullscreen":_.value,onOpenPostProcessing:Z[4]||(Z[4]=Q=>g.value=!0),onToggleFullscreen:ye,onZoomIn:Se,onZoomOut:Ue,onResetZoom:Ae},null,8,["status-filter","config-filter","search-query","visible-columns","configurations","api-calls","show-repeat-column","zoom-level","is-fullscreen"]),s("div",Cr,[h.value>100?(u(),ee(W(ft),{key:0,class:"results-scroller",items:R.value,"item-size":L.value,"key-field":"id",buffer:10,onVisibleRange:k,style:fe({fontSize:`${14*v.value}px`})},{before:x(()=>[s("div",$r,[r.value.includes("status")?(u(),m("div",wr,"Status")):E("",!0),r.value.includes("configuration")?(u(),m("div",kr,"Configuration")):E("",!0),r.value.includes("repeat")&&f.value?(u(),m("div",Sr,"Repeat")):E("",!0),r.value.includes("variables")?(u(),m("div",Ir,"Variables")):E("",!0),r.value.includes("response")?(u(),m("div",Er,"Response")):E("",!0),r.value.includes("parsedResponse")?(u(),m("div",Rr,"Parsed Response")):E("",!0),r.value.includes("postProcessedResponse")?(u(),m("div",Fr,[Z[7]||(Z[7]=D(" Post-Processed ")),H.trial.postProcessingConfig?.enabled?(u(),m("span",xr,"âœ¨")):E("",!0)])):E("",!0),r.value.includes("length")?(u(),m("div",Pr,"Length")):E("",!0),r.value.includes("latency")?(u(),m("div",Ar,"Latency")):E("",!0)])]),default:x(({item:Q})=>[s("div",{class:ne(["result-row virtual-row",`status-${Q.status}`]),onClick:pe=>ge(Q)},[r.value.includes("status")?(u(),m("div",Or,[s("div",Dr,[s("span",{class:ne(["status-tag",P(Q)])},y(F(Q)),3),s("span",Lr,y(le(Q)),1)])])):E("",!0),r.value.includes("configuration")?(u(),m("div",Nr,y(l(Q.configurationIndex)),1)):E("",!0),r.value.includes("repeat")&&f.value?(u(),m("div",Mr," #"+y((Q.repeatIndex||0)+1),1)):E("",!0),r.value.includes("variables")?(u(),m("div",Ur,[s("div",zr,[(u(!0),m(te,null,oe(Object.entries(Q.variables),([pe,_e],Re)=>(u(),m(te,{key:pe},[Z[9]||(Z[9]=s("span",{class:"var-bullet"},"â€¢ ",-1)),Object.keys(Q.variables).length<=2?(u(),m("span",Br,y(pe)+": "+y(_e),1)):(u(),m("span",Wr,y(_e),1)),Object.keys(Q.variables).length===2&&Re===0?(u(),m("span",jr,Z[8]||(Z[8]=[s("br",null,null,-1)]))):Re<Object.keys(Q.variables).length-1?(u(),m("span",Hr,y("Â Â "))):E("",!0)],64))),128))])])):E("",!0),r.value.includes("response")?(u(),m("div",Gr,[je(s("div",qr,null,512),[[ie,ve(G(Q)),"apiResponse"]])])):E("",!0),r.value.includes("parsedResponse")?(u(),m("div",Jr,[s("div",Xr,y(Y(Q)),1)])):E("",!0),r.value.includes("postProcessedResponse")?(u(),m("div",Kr,[s("div",Zr,y(A(Q)),1)])):E("",!0),r.value.includes("length")?(u(),m("div",Yr,y(X(Q)),1)):E("",!0),r.value.includes("latency")?(u(),m("div",Qr,[s("span",{class:ne(be(Q.response?.latencyMs))},y(S(Q.response?.latencyMs)),3)])):E("",!0)],10,Vr)]),_:1},8,["items","item-size","style"])):(u(),m("table",{key:1,class:"results-table",style:fe({fontSize:`${14*v.value}px`})},[s("thead",null,[s("tr",null,[r.value.includes("status")?(u(),m("th",eu,"Status")):E("",!0),r.value.includes("configuration")?(u(),m("th",tu,"Configuration")):E("",!0),r.value.includes("repeat")&&f.value?(u(),m("th",su,"Repeat")):E("",!0),r.value.includes("variables")?(u(),m("th",au,"Variables")):E("",!0),r.value.includes("response")?(u(),m("th",nu,"Response")):E("",!0),r.value.includes("parsedResponse")?(u(),m("th",ou,"Parsed Response")):E("",!0),r.value.includes("postProcessedResponse")?(u(),m("th",lu,[Z[10]||(Z[10]=D(" Post-Processed ")),H.trial.postProcessingConfig?.enabled?(u(),m("span",iu,"âœ¨")):E("",!0)])):E("",!0),r.value.includes("length")?(u(),m("th",ru,"Length")):E("",!0),r.value.includes("latency")?(u(),m("th",uu,"Latency")):E("",!0)])]),s("tbody",null,[(u(!0),m(te,null,oe(R.value,Q=>(u(),m("tr",{key:Q.id,class:ne(["result-row",`status-${Q.status}`]),onClick:pe=>ge(Q)},[r.value.includes("status")?(u(),m("td",cu,[s("div",pu,[s("span",{class:ne(["status-tag",P(Q)])},y(F(Q)),3),s("span",fu,y(le(Q)),1)])])):E("",!0),r.value.includes("configuration")?(u(),m("td",mu,y(l(Q.configurationIndex)),1)):E("",!0),r.value.includes("repeat")&&f.value?(u(),m("td",vu," #"+y((Q.repeatIndex||0)+1),1)):E("",!0),r.value.includes("variables")?(u(),m("td",gu,[s("div",hu,[(u(!0),m(te,null,oe(Q.variables,(pe,_e,Re)=>(u(),m(te,{key:_e},[Z[12]||(Z[12]=s("span",{class:"var-bullet"},"â€¢ ",-1)),Object.keys(Q.variables).length<=2?(u(),m("span",yu,y(_e)+": "+y(pe),1)):(u(),m("span",bu,y(pe),1)),Object.keys(Q.variables).length===2&&Re===0?(u(),m("span",_u,Z[11]||(Z[11]=[s("br",null,null,-1)]))):Re<Object.keys(Q.variables).length-1?(u(),m("span",Tu,y("Â Â "))):E("",!0)],64))),128))])])):E("",!0),r.value.includes("response")?(u(),m("td",Cu,[je(s("div",$u,null,512),[[ie,ve(G(Q)),"apiResponse"]])])):E("",!0),r.value.includes("parsedResponse")?(u(),m("td",wu,[s("div",ku,y(Y(Q)),1)])):E("",!0),r.value.includes("postProcessedResponse")?(u(),m("td",Su,[s("div",Iu,y(A(Q)),1)])):E("",!0),r.value.includes("length")?(u(),m("td",Eu,y(X(Q)),1)):E("",!0),r.value.includes("latency")?(u(),m("td",Ru,[s("span",{class:ne(be(Q.response?.latencyMs))},y(S(Q.response?.latencyMs)),3)])):E("",!0)],10,du))),128)),R.value.length===0?(u(),m("tr",Fu,[s("td",{colspan:r.value.length,class:"empty-state"},[b.value.length===0?(u(),m("div",Pu," No API calls yet. Start the trial to begin execution. ")):(u(),m("div",Au," No results match your filters. "))],8,xu)])):E("",!0)])],4))]),c.value?(u(),ee(_s,{key:0,visible:!!c.value,"api-call":c.value,trial:H.trial,"all-api-calls":O.value,"onUpdate:visible":Z[5]||(Z[5]=Q=>c.value=null),onNavigate:me},null,8,["visible","api-call","trial","all-api-calls"])):E("",!0),g.value?(u(),ee(Tr,{key:1,visible:g.value,trial:H.trial,onClose:Z[6]||(Z[6]=Q=>g.value=!1)},null,8,["visible","trial"])):E("",!0)],2)}}}),Ou=ce(Vu,[["__scopeId","data-v-ba3dd604"]]),Du={class:"trial-analysis-view"},Lu=de({__name:"TrialAnalysisView",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(i){const e=i;return Fe(()=>{const t=performance.now();I.info(`V4_TRIAL_SWITCH: TrialAnalysisView MOUNTED for trial ${e.trial.id}`),ze(()=>{const a=performance.now();I.info(`V4_TRIAL_SWITCH: TrialAnalysisView DOM ready in ${(a-t).toFixed(1)}ms`)}),setTimeout(()=>{const a=performance.now();I.info(`V4_TRIAL_SWITCH: TrialAnalysisView mount completed in ${(a-t).toFixed(1)}ms`)},0)}),Ke(()=>{I.info(`V4_TRIAL_SWITCH: TrialAnalysisView ACTIVATED (cache hit) for trial ${e.trial.id}`)}),Ze(()=>{I.info(`V4_TRIAL_SWITCH: TrialAnalysisView DEACTIVATED (cached) for trial ${e.trial.id}`)}),Le(()=>{I.info(`V4_TRIAL_SWITCH: TrialAnalysisView UNMOUNTED (evicted) for trial ${e.trial.id}`)}),(t,a)=>(u(),m("div",Du,[w(Ou,{trial:t.trial,progress:t.progress,"is-executing":t.isExecuting,"api-calls":t.apiCalls,"is-streaming":t.isStreaming,"is-loading":t.isLoading},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])]))}}),Nu=ce(Lu,[["__scopeId","data-v-602f5d5a"]]);function Ht(i,e){const t=new Set,a=new Set,n=new Set;i.forEach(g=>{g.variables&&Object.keys(g.variables).forEach(_=>t.add(_)),g.variableAttributes&&Object.values(g.variableAttributes).forEach(_=>{_&&Object.keys(_).forEach(v=>a.add(v))})});const o=Array.from(t).sort(),d=Array.from(a).sort(),p=Array.from(n).sort(),r=[],c=["success","refused","parsed_response",...r,...p];return{categorical:[...o,...d,"model","status","error_type"],numeric:["response_time","total_tokens","prompt_tokens","completion_tokens",...r].sort(),extracted:c}}function $t(i,e,t){switch(e){case"model":return t&&i.configurationIndex<t.configurations.length&&t.configurations[i.configurationIndex].modelId||"Unknown";case"status":return i.status;case"response_time":return Ns(i.response?.latencyMs);case"total_tokens":if(i.response?.body?.usage){const a=i.response.body.usage;return a.total_tokens||Ls(a.prompt_tokens,a.completion_tokens)||et(null)}return et(null);case"prompt_tokens":return et(i.response?.body?.usage?.prompt_tokens||i.response?.body?.usage?.input_tokens);case"completion_tokens":return et(i.response?.body?.usage?.completion_tokens||i.response?.body?.usage?.output_tokens);case"error_type":return i.result?.errorType||(i.result?.success===!1?"api_error":"success");case"success":return i.result?.success?1:0;case"refused":return i.result?.refused?1:0;case"parsed_response":if(i.result?.parsedContent!==void 0){const a=i.result.parsedContent;return typeof a=="object"?JSON.stringify(a):a}return null}if(i.variables?.[e]!==void 0)return i.variables[e];if(i.variableAttributes)for(const a of Object.keys(i.variableAttributes)){const n=i.variableAttributes[a];if(n&&n[e]!==void 0)return n[e]}return null}const Ye={count:{label:"Count",calculate:i=>i.length,format:i=>i.toString(),needsNumeric:!1},sum:{label:"Sum",calculate:i=>{const e=i.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0):null},format:i=>i?.toFixed(2)||"-",needsNumeric:!0},mean:{label:"Mean",calculate:i=>{const e=i.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0)/e.length:null},format:i=>i?.toFixed(2)||"-",needsNumeric:!0},median:{label:"Median",calculate:i=>{const e=i.map(n=>typeof n=="number"?n:null).filter(n=>n!==null);if(e.length===0)return null;const t=[...e].sort((n,o)=>n-o),a=Math.floor(t.length/2);return t.length%2===0?(t[a-1]+t[a])/2:t[a]},format:i=>i?.toFixed(2)||"-",needsNumeric:!0},mode:{label:"Mode",calculate:i=>{if(i.length===0)return null;const e=new Map;i.forEach(n=>e.set(n,(e.get(n)||0)+1));let t=0,a=null;return e.forEach((n,o)=>{n>t&&(t=n,a=o)}),{value:a,count:t,total:i.length}},format:i=>i?`${i.value} (${i.count}/${i.total})`:"-",needsNumeric:!1},variance:{label:"Variance",calculate:i=>{const e=i.map(n=>typeof n=="number"?n:null).filter(n=>n!==null);if(e.length<=1)return null;const t=e.reduce((n,o)=>n+o,0)/e.length;return e.reduce((n,o)=>n+Math.pow(o-t,2),0)/(e.length-1)},format:i=>i?.toFixed(3)||"-",needsNumeric:!0},std_dev:{label:"Std Dev",calculate:i=>{const e=Ye.variance.calculate(i);return e!==null?Math.sqrt(e):null},format:i=>i?.toFixed(3)||"-",needsNumeric:!0},min:{label:"Min",calculate:i=>{const e=i.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.min(...e):null},format:i=>i?.toFixed(2)||"-",needsNumeric:!0},max:{label:"Max",calculate:i=>{const e=i.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.max(...e):null},format:i=>i?.toFixed(2)||"-",needsNumeric:!0},success_rate:{label:"Success Rate",calculate:(i,e)=>{const t=e.filter(a=>a.result?.success).length;return e.length>0?t/e.length:0},format:i=>`${Math.round(i*100)}%`,needsNumeric:!1,usesApiCalls:!0},refusal_rate:{label:"Refusal Rate",calculate:(i,e)=>{const t=e.filter(a=>a.result?.refused).length;return e.length>0?t/e.length:0},format:i=>`${Math.round(i*100)}%`,needsNumeric:!1,usesApiCalls:!0},avg_time:{label:"Avg Time (ms)",calculate:(i,e)=>{const t=e.filter(a=>a.response?.latencyMs).map(a=>a.response.latencyMs);return t.length>0?t.reduce((a,n)=>a+n,0)/t.length:null},format:i=>i?`${Math.round(i)}ms`:"-",needsNumeric:!1,usesApiCalls:!0},percent_non_numeric:{label:"% Non-Numeric",calculate:i=>i.length===0?0:i.filter(t=>!!(t==null||typeof t!="number"||Number.isNaN(t)||!Number.isFinite(t))).length/i.length*100,format:i=>`${Math.round(i)}%`,needsNumeric:!1}};function Mu(i,e,t){const a=performance.now(),n=new Map,o=new Set,d=new Set,p=new Map,r=(R,$)=>{p.has($)||p.set($,new Map);const O=p.get($);return O.has(R)||O.set(R,$t(R,$,t)),O.get(R)};for(const R of i){const $=String(r(R,e.rowField)||"Unknown"),O=String(r(R,e.columnField)||"Unknown");o.add($),d.add(O),n.has($)||n.set($,new Map);const h=n.get($);h.has(O)||h.set(O,[]),h.get(O).push(R)}const c=performance.now()-a;c>50&&I.info(`PIVOT_OPTIMIZE: Grouped ${i.length} calls in ${c.toFixed(1)}ms`);const g=R=>R.every(O=>!isNaN(Number(O))&&O.trim()!=="")?R.sort((O,h)=>Number(O)-Number(h)):R.sort(),_=(R,$)=>(t&&(t.type,t.type),g(R)),v=e.rowSort==="original"?_(Array.from(o),e.rowField):g(Array.from(o)),T=e.columnSort==="original"?_(Array.from(d),e.columnField):g(Array.from(d)),C=Ye[e.aggregation];function b(R,$=!1){const O=$?R.map(k=>r(k,e.valueField)):R.map(k=>$t(k,e.valueField,t));if(!C||typeof C.calculate!="function")return I.error("Invalid aggregation function:",e.aggregation,C),{value:null,count:R.length,apiCalls:R,rawValues:O,error:"Invalid aggregation function"};const h={nonNumeric:0,nullUndefined:0};return C.needsNumeric&&(h.nonNumeric=O.filter(k=>typeof k!="number").length),h.nullUndefined=O.filter(k=>k==null).length,{value:C.usesApiCalls?C.calculate(O,R):C.calculate(O),count:R.length,apiCalls:R,rawValues:O,excludedCounts:h}}const V=v.map(R=>{const $=[],O=[];return T.forEach(h=>{const f=n.get(R)?.get(h)||[];$.push(f.length>0?b(f,!0):null),O.push(...f)}),{label:R,cells:$,total:b(O,!0)}}),N=T.map(R=>{const $=[];return v.forEach(O=>{const h=n.get(O)?.get(R)||[];$.push(...h)}),b($,!0)}),j=performance.now()-a;return j>100&&I.info(`PIVOT_OPTIMIZE: Total pivot calculation took ${j.toFixed(1)}ms for ${i.length} calls`),{rows:V,columns:T,totals:N,grandTotal:b(i,!0)}}function we(i,e){return!i||i.value===null?"-":Ye[e].format(i.value)}function Uu(i){if(!i||Object.keys(i).length===0)return"";const e=[];return i.temperature!==void 0&&e.push(`T:${i.temperature}`),i.max_tokens!==void 0?e.push(`${i.max_tokens}t`):i.maxTokens!==void 0?e.push(`${i.maxTokens}t`):i.num_predict!==void 0&&e.push(`${i.num_predict}t`),i.top_p!==void 0&&e.push(`p:${i.top_p}`),i.top_k!==void 0&&e.push(`k:${i.top_k}`),e.length>0?`(${e.join(", ")})`:""}function zu(i,e,t,a=B({}),n={}){const o=B({rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}}),d=B({categorical:[],numeric:[],extracted:[]}),p=B(!1),r=B(0),c=B(!1),g=B(0),_=U(()=>{const N=a.value;return Object.values(N).some(R=>R!=="")?i.value.filter(R=>{if(N.model&&N.model!==""){if(!t.value||R.configurationIndex>=t.value.configurations.length)return!1;const $=t.value.configurations[R.configurationIndex],O=$.modelId||"Unknown",h=Uu($.parameters);if((h?`${O} ${h}`:O)!==N.model)return!1}if(N.status&&N.status!==""&&R.status!==N.status)return!1;for(const[$,O]of Object.entries(N))if(O&&O!==""&&$!=="model"&&$!=="status"&&R.variables?.[$]!==O)return!1;return!0}):i.value});let v=null;const T=N=>{v&&v.cancel();let j;switch(N){case"trial":j=0;break;case"tab":j=0;break;case"stream":j=100;break;case"config":j=300;break;default:j=100}v=Nt(()=>{if(_.value.length===0){o.value={rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}};return}p.value=!0;const R=performance.now();try{o.value=Mu(_.value,e.value,t.value);const $=performance.now()-R;r.value=$,I.debug(`Pivot computed from ${N}`,{apiCallCount:_.value.length,computeTimeMs:$,rowCount:o.value.rows.length,columnCount:o.value.columns.length,source:N})}catch($){I.error("Error computing pivot data",$)}finally{p.value=!1,(N==="tab"||N==="stream")&&(c.value=!1)}},j),v()},C=Nt(()=>{d.value=Ht(i.value,t.value)},200),b=typeof window<"u"?window.__trialDataStoreV4?.():null;re([e],()=>{I.info("PIVOT_DEBUG: Config changed, recomputing pivot"),T("config")},{deep:!0}),re(_,(N,j)=>{if(b&&b.activeTab?.value!=="pivot"){c.value=!0,g.value=N.length,I.info(`PIVOT_OPTIMIZE: Marked pending update for ${N.length} calls`);return}const R=j?.length||0,$=N.length;c.value&&(I.info(`PIVOT_FIX: Processing pending update for ${$} calls`),c.value=!1),I.info(`PIVOT_DEBUG: filteredApiCalls changed from ${R} to ${$}`),(R!==$||$>0)&&T("stream")},{immediate:!0}),b&&re(()=>b.activeTab?.value,(N,j)=>{N==="pivot"&&j!=="pivot"&&c.value&&(I.info(`PIVOT_FIX: Tab became active, processing ${g.value} pending calls`),T("tab"))});let V=null;return re([i,t],([N,j])=>{const R=j?.id!==V;V=j?.id||null,R?(I.info(`PIVOT_FIX: Trial changed to ${j?.id}, immediate field update`),d.value=Ht(N),T("trial")):(I.info(`PIVOT_DEBUG: apiCalls (${N.length}) changed, updating fields`),C())},{immediate:!0}),C(),{pivotData:U(()=>o.value),availableFields:U(()=>d.value),isComputing:U(()=>p.value),lastComputeTime:U(()=>r.value),formatCellValue:we,extractFieldValue:$t,aggregationFunctions:Ye}}class Bu{getMimeType(e){switch(e){case"csv":return"text/csv";case"excel":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"tsv":return"text/tab-separated-values";case"json":return"application/json";case"jsonl":return"application/x-jsonlines";case"python":return"text/x-python";case"zip":return"application/zip";default:return"application/octet-stream"}}getFileExtension(e){switch(e){case"csv":return"csv";case"excel":return"xlsx";case"tsv":return"tsv";case"json":return"json";case"jsonl":return"jsonl";case"python":return"py";case"zip":return"zip";default:return"bin"}}generateFilename(e,t,a){const n=this.sanitizeFilename(e),d=(a||new Date).toISOString().split("T")[0],p=this.getFileExtension(t);return`${n}_${t}_${d}.${p}`}estimateFileSize(e,t,a,n=50){let o=e*t*n;switch(a){case"json":o*=2.5;break;case"jsonl":o*=2.2;break;case"csv":o*=1.3;break;case"excel":o*=.8;break;case"tsv":o*=1.1;break;case"python":o=Math.max(o*1.5,5e3);break}return Math.round(o)}formatFileSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:`${(e/(1024*1024*1024)).toFixed(1)} GB`}createDownloadBlob(e,t,a=!1){let n=e;return a&&(n="\uFEFF"+n),new Blob([n],{type:t})}createDownloadBlobFromBase64(e,t){const a=atob(e),n=new Uint8Array(a.length);for(let o=0;o<a.length;o++)n[o]=a.charCodeAt(o);return new Blob([n],{type:t})}triggerDownload(e,t){const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>URL.revokeObjectURL(a),100)}downloadFile(e,t,a,n=!1){const o=this.getMimeType(t),d=this.generateFilename(a,t);let p;t==="excel"?p=this.createDownloadBlobFromBase64(e,o):p=this.createDownloadBlob(e,o,n),this.triggerDownload(p,d)}sanitizeFilename(e){return e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_+/g,"_").substring(0,50).replace(/^_+|_+$/g,"")||"trial"}}const $e=new Bu;let wt=null,kt=null,nt=!1;try{typeof window<"u"&&("__TAURI__"in window||"__TAURI_INTERNALS__"in window)&&(nt=!0)}catch{}async function Wu(){if(!nt)return!1;try{return wt||(wt=await He(()=>import("./tauri-vendor-1uBLmS9u.js").then(i=>i.c),[])),kt||(kt=await He(()=>import("./tauri-vendor-1uBLmS9u.js").then(i=>i.g),[])),!0}catch(i){return I.warn("Failed to load Tauri modules:",i),nt=!1,!1}}class Ts{async downloadFile(e,t,a,n=!1){await this.useTauriSaveDialog(e,t,a,n)||this.useBrowserDownload(e,t,a,n)}async useTauriSaveDialog(e,t,a,n){if(!await Wu())return!1;try{const o=$e.generateFilename(a,t),d=$e.getFileExtension(t),p=await wt.save({defaultPath:o,filters:[{name:this.getFilterName(t),extensions:[d]}],title:`Save ${this.getFilterName(t)} File`});if(!p)return!0;let r;if(typeof e=="string"){const c=n?"\uFEFF"+e:e;r=new TextEncoder().encode(c)}else r=e;return await kt.writeFile(p,r),I.info(`File saved successfully: ${p}`),!0}catch(o){return I.error("Tauri save dialog error:",o),!1}}useBrowserDownload(e,t,a,n){if(e instanceof Uint8Array&&(t==="zip"||t==="excel")){const _=$e.getMimeType(t),v=$e.generateFilename(a,t),T=new Blob([e],{type:_}),C=window.URL.createObjectURL(T),b=document.createElement("a");b.href=C,b.download=v,document.body.appendChild(b),b.click(),document.body.removeChild(b),window.URL.revokeObjectURL(C);return}e instanceof Uint8Array&&(e=new TextDecoder().decode(e));const o=$e.getMimeType(t),d=$e.generateFilename(a,t),p=n?"\uFEFF"+e:e,r=new Blob([p],{type:o}),c=window.URL.createObjectURL(r),g=document.createElement("a");g.href=c,g.download=d,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(c)}async downloadExcelFile(e,t){const a=atob(e),n=new Uint8Array(a.length);for(let o=0;o<a.length;o++)n[o]=a.charCodeAt(o);await this.downloadFile(n,"excel",t,!1)}getFilterName(e){switch(e){case"csv":return"CSV";case"excel":return"Excel";case"tsv":return"TSV";case"json":return"JSON";case"jsonl":return"JSON Lines";case"python":return"Python Script";case"zip":return"ZIP Archive";default:return"Binary"}}isInTauri(){return nt}generateFilename(e,t,a){return $e.generateFilename(e,t,a)}getMimeType(e){return $e.getMimeType(e)}getFileExtension(e){return $e.getFileExtension(e)}estimateFileSize(e,t,a,n=50){return $e.estimateFileSize(e,t,a,n)}formatFileSize(e){return $e.formatFileSize(e)}}const Xe=new Ts,ju=Object.freeze(Object.defineProperty({__proto__:null,TauriDownloadUtilities:Ts,tauriDownloadUtilities:Xe},Symbol.toStringTag,{value:"Module"}));async function Hu(i,e,t,a={}){if(!i||!i.rows.length||!i.columns.length)throw new Error("No data available to export");const{includeHeaders:n=!0,includeTotals:o=!0,addBOM:d=!0}=a,p=[];if(n){const v=[],T=ot(e.rowField)||"Row",C=ot(e.columnField)||"Column";v.push(Ne(`${T} / ${C}`)),i.columns.forEach(b=>{v.push(Ne(b))}),o&&e.columnField&&v.push(Ne("Total")),p.push(v.join(","))}if(i.rows.forEach(v=>{const T=[];if(T.push(Ne(v.label)),v.cells.forEach(C=>{const b=we(C,e.aggregation);T.push(Ne(b))}),o&&e.columnField&&v.total){const C=we(v.total,e.aggregation);T.push(Ne(C))}p.push(T.join(","))}),o&&e.rowField&&i.totals){const v=[];if(v.push(Ne("Total")),i.totals.forEach(T=>{const C=we(T,e.aggregation);v.push(Ne(C))}),e.columnField&&i.grandTotal){const T=we(i.grandTotal,e.aggregation);v.push(Ne(T))}p.push(v.join(","))}const r=p.join(`
`),g=`pivot_${e.rowField}_by_${e.columnField}_${e.aggregation}`.replace(/[^a-zA-Z0-9_-]/g,"_").substring(0,50),_=`${t}_${g}`;await Xe.downloadFile(r,"csv",_,d)}function ot(i){return i?{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[i]||i.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()):""}function Ne(i){if(i==null)return"";const e=String(i);return e.includes(",")||e.includes('"')||e.includes(`
`)||e.includes("\r")?`"${e.replace(/"/g,'""')}"`:e}async function Gu(i,e,t={}){if(!i||!i.rows.length||!i.columns.length)throw new Error("No data available to copy");const{includeHeaders:a=!0,includeTotals:n=!0}=t,o=[];if(a){const p=[],r=ot(e.rowField)||"Row",c=ot(e.columnField)||"Column";p.push(`${r} / ${c}`),i.columns.forEach(g=>{p.push(g)}),n&&e.columnField&&p.push("Total"),o.push(p.join("	"))}if(i.rows.forEach(p=>{const r=[];if(r.push(p.label),p.cells.forEach(c=>{const g=we(c,e.aggregation);r.push(g)}),n&&e.columnField&&p.total){const c=we(p.total,e.aggregation);r.push(c)}o.push(r.join("	"))}),n&&e.rowField&&i.totals){const p=[];if(p.push("Total"),i.totals.forEach(r=>{const c=we(r,e.aggregation);p.push(c)}),e.columnField&&i.grandTotal){const r=we(i.grandTotal,e.aggregation);p.push(r)}o.push(p.join("	"))}const d=o.join(`
`);try{await navigator.clipboard.writeText(d)}catch{const r=document.createElement("textarea");r.value=d,r.style.position="fixed",r.style.opacity="0",document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r)}}const qu={class:"pivot-config-v3"},Ju={class:"config-row"},Xu={class:"config-group"},Ku=["value","aria-label"],Zu={label:"Categorical"},Yu=["value"],Qu={class:"config-group sort-group"},ed=["value","aria-label"],td={class:"config-group"},sd=["value","aria-label"],ad={label:"Categorical"},nd=["value"],od={class:"config-group sort-group"},ld=["value","aria-label"],id={class:"config-group"},rd=["value","aria-label"],ud={label:"Extracted Values"},dd=["value"],cd={label:"Numeric Fields"},pd=["value"],fd={class:"config-group"},md=["value","aria-label"],vd=de({__name:"PivotConfigurationV3",props:{config:{},availableFields:{}},emits:["update-config"],setup(i,{emit:e}){const t=e;function a(o,d){t("update-config",o,d)}function n(o){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[o]||o.replace(/_/g," ").replace(/\b\w/g,p=>p.toUpperCase())}return(o,d)=>(u(),m("div",qu,[s("div",Ju,[s("div",Xu,[d[6]||(d[6]=s("label",{for:"pivot-row-field"},"Rows (Group by):",-1)),s("select",{id:"pivot-row-field",value:o.config.rowField,"aria-label":"Group rows by "+n(o.config.rowField),onChange:d[0]||(d[0]=p=>a("rowField",p.target.value))},[s("optgroup",Zu,[(u(!0),m(te,null,oe(o.availableFields.categorical,p=>(u(),m("option",{key:p,value:p},y(n(p)),9,Yu))),128))])],40,Ku)]),s("div",Qu,[d[8]||(d[8]=s("label",{for:"pivot-row-sort"},"Sort Rows:",-1)),s("select",{id:"pivot-row-sort",value:o.config.rowSort||"original","aria-label":"Sort rows by "+(o.config.rowSort||"original")+" order",onChange:d[1]||(d[1]=p=>a("rowSort",p.target.value))},d[7]||(d[7]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,ed)]),s("div",td,[d[9]||(d[9]=s("label",{for:"pivot-column-field"},"Columns (Group by):",-1)),s("select",{id:"pivot-column-field",value:o.config.columnField,"aria-label":"Group columns by "+n(o.config.columnField),onChange:d[2]||(d[2]=p=>a("columnField",p.target.value))},[s("optgroup",ad,[(u(!0),m(te,null,oe(o.availableFields.categorical,p=>(u(),m("option",{key:p,value:p},y(n(p)),9,nd))),128))])],40,sd)]),s("div",od,[d[11]||(d[11]=s("label",{for:"pivot-column-sort"},"Sort Columns:",-1)),s("select",{id:"pivot-column-sort",value:o.config.columnSort||"original","aria-label":"Sort columns by "+(o.config.columnSort||"original")+" order",onChange:d[3]||(d[3]=p=>a("columnSort",p.target.value))},d[10]||(d[10]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,ld)]),s("div",id,[d[12]||(d[12]=s("label",{for:"pivot-value-field"},"Values (Aggregate):",-1)),s("select",{id:"pivot-value-field",value:o.config.valueField,"aria-label":"Aggregate "+o.config.valueField+" values",onChange:d[4]||(d[4]=p=>a("valueField",p.target.value))},[s("optgroup",ud,[(u(!0),m(te,null,oe(o.availableFields.extracted,p=>(u(),m("option",{key:p,value:p},y(p),9,dd))),128))]),s("optgroup",cd,[(u(!0),m(te,null,oe(o.availableFields.numeric,p=>(u(),m("option",{key:p,value:p},y(n(p)),9,pd))),128))])],40,rd)]),s("div",fd,[d[14]||(d[14]=s("label",{for:"pivot-aggregation"},"Aggregation:",-1)),s("select",{id:"pivot-aggregation",value:o.config.aggregation,"aria-label":"Aggregation method: "+o.config.aggregation,onChange:d[5]||(d[5]=p=>a("aggregation",p.target.value))},d[13]||(d[13]=[ts('<optgroup label="Statistical" data-v-2f1516e5><option value="mean" data-v-2f1516e5>Mean</option><option value="median" data-v-2f1516e5>Median</option><option value="variance" data-v-2f1516e5>Variance</option><option value="std_dev" data-v-2f1516e5>Std Dev</option><option value="min" data-v-2f1516e5>Min</option><option value="max" data-v-2f1516e5>Max</option><option value="sum" data-v-2f1516e5>Sum</option></optgroup><optgroup label="Frequency" data-v-2f1516e5><option value="count" data-v-2f1516e5>Count</option><option value="mode" data-v-2f1516e5>Mode</option></optgroup><optgroup label="Data Quality" data-v-2f1516e5><option value="percent_non_numeric" data-v-2f1516e5>% Non-Numeric</option></optgroup><optgroup label="Performance" data-v-2f1516e5><option value="success_rate" data-v-2f1516e5>Success Rate</option><option value="refusal_rate" data-v-2f1516e5>Refusal Rate</option><option value="avg_time" data-v-2f1516e5>Avg Time</option></optgroup>',4)]),40,md)])])]))}}),gd=ce(vd,[["__scopeId","data-v-2f1516e5"]]),hd={class:"heatmap-controls-v3"},yd={class:"control-row"},bd=["value","aria-label"],_d={class:"control-row"},Td=["value","aria-label"],Cd=de({__name:"PivotHeatmapV3",props:{selectedColorScale:{},gradientMode:{}},emits:["update-color-scale","update-gradient-mode"],setup(i,{emit:e}){const t=e;function a(o){const d=o.target.value;t("update-color-scale",d)}function n(o){const d=o.target.value;t("update-gradient-mode",d)}return(o,d)=>(u(),m("div",hd,[s("div",yd,[d[1]||(d[1]=s("label",{for:"heatmap-color-scale",class:"control-label"},"Color Scale:",-1)),s("select",{id:"heatmap-color-scale",class:"color-scale-select",value:o.selectedColorScale,"aria-label":"Color scale: "+o.selectedColorScale,onChange:a},d[0]||(d[0]=[ts('<option value="blue-subtle" data-v-c3794a0d>Blue (Subtle)</option><option value="green-red" data-v-c3794a0d>Green-Red (Success)</option><option value="blue-yellow" data-v-c3794a0d>Blue-Yellow (Performance)</option><option value="purple-orange" data-v-c3794a0d>Purple-Orange (General)</option><option value="viridis" data-v-c3794a0d>Viridis</option><option value="inferno" data-v-c3794a0d>Inferno</option><option value="magma" data-v-c3794a0d>Magma</option><option value="plasma" data-v-c3794a0d>Plasma</option><option value="grayscale" data-v-c3794a0d>Grayscale</option>',9)]),40,bd)]),s("div",_d,[d[3]||(d[3]=s("label",{for:"gradient-mode",class:"control-label"},"Gradient Mode:",-1)),s("select",{id:"gradient-mode",class:"gradient-mode-select",value:o.gradientMode,"aria-label":"Gradient mode: "+o.gradientMode,onChange:n},d[2]||(d[2]=[s("option",{value:"global"},"Global",-1),s("option",{value:"column"},"Per Column",-1),s("option",{value:"row"},"Per Row",-1)]),40,Td)])]))}}),$d=ce(Cd,[["__scopeId","data-v-c3794a0d"]]),wd={class:"pivot-filters-v3"},kd={class:"filters-row"},Sd={key:0,class:"filter-group"},Id=["value"],Ed=["value"],Rd=["for"],Fd=["id","value","aria-label","onChange"],xd={value:""},Pd=["value"],Ad={key:1,class:"filter-group"},Vd=["value"],Od=["value"],Dd=de({__name:"PivotFiltersV3",props:{apiCalls:{},trial:{},activeFilters:{}},emits:["update-filters","clear-filters"],setup(i,{emit:e}){const t=i,a=e,n=B({});let o=0;const d=()=>{if(t.apiCalls.length===0){n.value={};return}const v={};t.apiCalls.forEach(C=>{if(t.trial&&C.configurationIndex<t.trial.configurations.length){const b=t.trial.configurations[C.configurationIndex],V=b.modelId||"Unknown",N=c(b.parameters),j=N?`${V} ${N}`:V;v.model||(v.model=new Set),v.model.add(j)}C.status&&(v.status||(v.status=new Set),v.status.add(C.status)),C.variables&&Object.entries(C.variables).forEach(([b,V])=>{V&&String(V).trim()&&(v[b]||(v[b]=new Set),v[b].add(String(V)))})});const T={};Object.entries(v).forEach(([C,b])=>{T[C]=Array.from(b).sort()}),n.value=T};re(()=>t.apiCalls.length,v=>{(v===0||o===0||v-o>=5)&&(d(),o=v)},{immediate:!0});const p=U(()=>{const{model:v,status:T,...C}=n.value;return C}),r=U(()=>Object.values(t.activeFilters).some(v=>v!==""));function c(v){if(!v||Object.keys(v).length===0)return"";const T=[];return v.temperature!==void 0&&T.push(`T:${v.temperature}`),v.max_tokens!==void 0?T.push(`${v.max_tokens}t`):v.maxTokens!==void 0?T.push(`${v.maxTokens}t`):v.num_predict!==void 0&&T.push(`${v.num_predict}t`),v.top_p!==void 0&&T.push(`p:${v.top_p}`),v.top_k!==void 0&&T.push(`k:${v.top_k}`),T.length>0?`(${T.join(", ")})`:""}function g(v){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",extracted_value:"Extracted Value"}[v]||v.replace(/_/g," ").replace(/\b\w/g,C=>C.toUpperCase())}function _(v,T){const C={...t.activeFilters};T===""?delete C[v]:C[v]=T,a("update-filters",C)}return(v,T)=>(u(),m("div",wd,[s("div",kd,[n.value.model&&n.value.model.length>1?(u(),m("div",Sd,[T[4]||(T[4]=s("label",{for:"filter-model",class:"filter-label"},"Model:",-1)),s("select",{id:"filter-model",value:v.activeFilters.model||"",class:"filter-select","aria-label":"Filter by model",onChange:T[0]||(T[0]=C=>_("model",C.target.value))},[T[3]||(T[3]=s("option",{value:""},"All Models",-1)),(u(!0),m(te,null,oe(n.value.model,C=>(u(),m("option",{key:C,value:C},y(C),9,Ed))),128))],40,Id)])):E("",!0),(u(!0),m(te,null,oe(p.value,(C,b)=>(u(),m("div",{key:b,class:"filter-group"},[s("label",{for:`filter-${b}`,class:"filter-label"},y(g(String(b)))+": ",9,Rd),s("select",{id:`filter-${b}`,value:v.activeFilters[b]||"",class:"filter-select","aria-label":`Filter by ${g(String(b))}`,onChange:V=>_(String(b),V.target.value)},[s("option",xd,"All "+y(g(String(b))),1),(u(!0),m(te,null,oe(C,V=>(u(),m("option",{key:V,value:V},y(V),9,Pd))),128))],40,Fd)]))),128)),n.value.status&&n.value.status.length>1?(u(),m("div",Ad,[T[6]||(T[6]=s("label",{for:"filter-status",class:"filter-label"},"Status:",-1)),s("select",{id:"filter-status",value:v.activeFilters.status||"",class:"filter-select","aria-label":"Filter by status",onChange:T[1]||(T[1]=C=>_("status",C.target.value))},[T[5]||(T[5]=s("option",{value:""},"All Statuses",-1)),(u(!0),m(te,null,oe(n.value.status,C=>(u(),m("option",{key:C,value:C},y(C),9,Od))),128))],40,Vd)])):E("",!0),r.value?(u(),m("button",{key:2,type:"button",class:"clear-filters-btn",title:"Clear all filters","aria-label":"Clear all filters",onClick:T[2]||(T[2]=C=>v.$emit("clear-filters"))}," Clear Filters ")):E("",!0)])]))}}),Ld=ce(Dd,[["__scopeId","data-v-d5848163"]]),Nd={class:"options-header"},Md={class:"header-left"},Ud={class:"header-buttons"},zd=["disabled"],Bd=["disabled"],Wd={class:"header-controls"},jd={class:"fit-toggles"},Hd=["title"],Gd=["title"],qd={class:"zoom-controls"},Jd=["disabled"],Xd={class:"zoom-level"},Kd=["disabled"],Zd=["title","aria-label"],Yd={class:"options-content"},Qd={class:"controls-row"},ec={key:0,class:"performance-info"},tc={class:"table-view"},sc={key:0,class:"empty-state","data-testid":"empty-data-message"},ac={key:1,class:"error-state","data-testid":"invalid-aggregation-error"},nc={key:2,class:"loading-state","data-testid":"computing-state"},oc=["onMousedown"],lc={class:"header-resize-row"},ic=["colspan"],rc={class:"row-header",role:"rowheader"},uc=["data-testid","title","aria-label","role","onClick","onKeydown"],dc={key:0,class:"cell-content"},cc=["title"],pc={class:"cell-value"},fc={class:"error-message"},mc={key:1},vc=80,Gt=150,gc=32,qt=.5,Jt=2,Xt=.1,hc=de({__name:"PivotTableV3",props:{apiCalls:{},trial:{default:null},config:{},maxTableRows:{default:1e4},showTotals:{type:Boolean,default:!0},showPerformanceInfo:{type:Boolean,default:!1}},emits:["config-change","cell-click"],setup(i,{emit:e}){const t=i,a=e,n=B(!1),o=B("blue-yellow"),d=B("global"),p=B(!1),r=B("ðŸ“‹ Copy"),c=B({rowField:t.config?.rowField||"",columnField:t.config?.columnField||"",valueField:t.config?.valueField||"",aggregation:t.config?.aggregation||"mean",rowSort:t.config?.rowSort||"original",columnSort:t.config?.columnSort||"original"}),g=B({}),_=B(null),v=B(45),T=B(null),C=B("scroll"),b=B("scroll"),V=B(1),N=U(()=>C.value!=="fit"||!l.value.columns?"auto":`${100/(l.value.columns.length+1+(c.value.columnField&&t.showTotals?1:0))}%`),j=U(()=>{if(C.value!=="fit"||!l.value.columns)return 1;const M=l.value.columns.length;return M>20?.7:M>15?.8:M>10?.9:1}),R=U(()=>`${13*j.value*V.value}px`),$=U(()=>{const K=v.value-16,se=Math.floor(K/20);return Math.max(1,se)});re(()=>t.config,M=>{M&&Object.assign(c.value,M)},{deep:!0}),re(()=>t.trial?.id,(M,J)=>{M&&M!==J&&(I.info(`PIVOT_FIX: Trial changed from ${J} to ${M}, resetting configuration`),c.value={rowField:"",columnField:"",valueField:"",aggregation:"mean",rowSort:"original",columnSort:"original"},O.value={})});const O=B({}),h=ct(),f=U(()=>h.apiCalls?h.apiCalls.value||[]:t.apiCalls||[]),L=f,k=U(()=>t.trial),{pivotData:l,availableFields:G,isComputing:Y,lastComputeTime:A}=zu(L,c,k,O,{});re(l,(M,J)=>{const K=performance.now(),se=M?.rows?.length||0;M?.columns&&H();const he=M?.columns?.length||0;I.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData computed: ${se}x${he} matrix`),setTimeout(()=>{const Ie=performance.now();I.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData render completed in ${(Ie-K).toFixed(1)}ms`)},0)}),re(Y,M=>{M?I.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING STARTED with ${f.value.length} API calls`):I.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING FINISHED in ${A.value.toFixed(1)}ms`)}),re(f,(M,J)=>{const K=performance.now();I.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls changed from ${J?.length||0} to ${M.length} calls`),setTimeout(()=>{const se=performance.now();I.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls prop update completed in ${(se-K).toFixed(1)}ms`)},0)});const X=U(()=>l.value.rows.slice(0,t.maxTableRows)),S=U(()=>Object.values(O.value).some(J=>J!=="")?f.value.filter(J=>{if(O.value.model&&O.value.model!==""){if(!t.trial||J.configurationIndex>=t.trial.configurations.length)return!1;const K=t.trial.configurations[J.configurationIndex],se=K.modelId||"Unknown",he=be(K.parameters);if((he?`${se} ${he}`:se)!==O.value.model)return!1}if(O.value.status&&O.value.status!==""&&J.status!==O.value.status)return!1;for(const[K,se]of Object.entries(O.value))if(se&&se!==""&&K!=="model"&&K!=="status"&&J.variables?.[K]!==se)return!1;return!0}).length:f.value.length),{getCellStyle:F,getSummaryStyle:P,styleKey:le}=Ta(l,o,d);function be(M){if(!M||Object.keys(M).length===0)return"";const J=[];return M.temperature!==void 0&&J.push(`T:${M.temperature}`),M.max_tokens!==void 0?J.push(`${M.max_tokens}t`):M.maxTokens!==void 0?J.push(`${M.maxTokens}t`):M.num_predict!==void 0&&J.push(`${M.num_predict}t`),M.top_p!==void 0&&J.push(`p:${M.top_p}`),M.top_k!==void 0&&J.push(`k:${M.top_k}`),J.length>0?`(${J.join(", ")})`:""}function ve(M){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[M]||M.replace(/_/g," ").replace(/\b\w/g,K=>K.toUpperCase())}function ge(M,J,K){if(!K)return`${M} Ã— ${J}: No data`;const se=we(K,c.value.aggregation);let he=`${M} Ã— ${J}: ${se} (${K.count} calls)`;if(K.excludedCounts){const Ie=[];K.excludedCounts.nonNumeric>0&&Ie.push(`${K.excludedCounts.nonNumeric} non-numeric responses excluded`),K.excludedCounts.nullUndefined>0&&Ie.push(`${K.excludedCounts.nullUndefined} null/empty responses`),Ie.length>0&&(he+=` | ${Ie.join(", ")}`)}return K.error&&(he+=` - ERROR: ${K.error}`),he}function me(M,J,K){if(!K)return`${M} by ${J}: No data`;const se=we(K,c.value.aggregation);return K.error?`${M} by ${J}: ${se} with data integrity error: ${K.error}`:`${M} by ${J}: ${se} from ${K.count} API calls`}function ye(M,J){(M==="rowField"||M==="columnField"||M==="valueField"||M==="aggregation"||M==="rowSort"||M==="columnSort")&&(c.value[M]=J),a("config-change",{...c.value})}function Se(M){O.value={...M}}function Ue(){O.value={}}function Ae(M,J,K){K&&a("cell-click",{row:M,column:J,cell:K})}function Ge(){p.value=!p.value}function H(){const M={};M.corner=200,l.value.columns.forEach(J=>{g.value[J]?M[J]=g.value[J]:M[J]=Gt}),c.value.columnField&&t.showTotals&&(M.total=100),g.value=M}function Z(M,J){J.preventDefault(),J.stopPropagation(),_.value={column:M,startX:J.pageX,startWidth:g.value[M]||Gt},document.addEventListener("mousemove",ie),document.addEventListener("mouseup",Q),document.body.classList.add("resizing-column")}function ie(M){if(!_.value)return;const J=M.pageX-_.value.startX,K=Math.max(vc,_.value.startWidth+J);g.value[_.value.column]=K}function Q(){_.value=null,document.removeEventListener("mousemove",ie),document.removeEventListener("mouseup",Q),document.body.classList.remove("resizing-column")}function pe(M){M.preventDefault(),M.stopPropagation(),T.value={startY:M.pageY,startHeight:v.value},document.addEventListener("mousemove",_e),document.addEventListener("mouseup",Re),document.body.classList.add("resizing-header")}function _e(M){if(!T.value)return;const J=M.pageY-T.value.startY,K=Math.max(gc,T.value.startHeight+J);v.value=K}function Re(){T.value=null,document.removeEventListener("mousemove",_e),document.removeEventListener("mouseup",Re),document.body.classList.remove("resizing-header")}function z(){V.value=Math.min(Jt,Math.round((V.value+Xt)*10)/10)}function q(){V.value=Math.max(qt,Math.round((V.value-Xt)*10)/10)}function ae(){V.value=1}function Ve(){n.value=!n.value,n.value?document.body.style.overflow="hidden":document.body.style.overflow=""}async function Pe(){try{const M=t.trial?.name||"pivot_table";await Hu(l.value,c.value,M,{includeHeaders:!0,includeTotals:t.showTotals,addBOM:!0}),I.info("Pivot table exported successfully")}catch(M){I.error("Failed to export pivot table:",M),alert("Failed to export pivot table: "+M.message)}}async function Te(){try{await Gu(l.value,c.value,{includeHeaders:!0,includeTotals:t.showTotals}),r.value="âœ“ Copied!",I.info("Pivot table copied to clipboard"),setTimeout(()=>{r.value="ðŸ“‹ Copy"},2e3)}catch(M){I.error("Failed to copy pivot table:",M),r.value="âŒ Failed",setTimeout(()=>{r.value="ðŸ“‹ Copy"},2e3)}}return Fe(()=>{const M=performance.now();I.info(`V4_TRIAL_SWITCH: PivotTableV3 MOUNTED for trial ${t.trial?.id||"unknown"} with ${f.value.length} calls`),ze(()=>{const J=performance.now();I.info(`V4_TRIAL_SWITCH: PivotTableV3 DOM ready in ${(J-M).toFixed(1)}ms`)}),setTimeout(()=>{const J=performance.now();I.info(`V4_TRIAL_SWITCH: PivotTableV3 mount completed in ${(J-M).toFixed(1)}ms`)},0)}),Ke(()=>{I.info(`V4_TRIAL_SWITCH: PivotTableV3 ACTIVATED (cache hit) for trial ${t.trial?.id||"unknown"} with ${f.value.length} calls`)}),Ze(()=>{I.info(`V4_TRIAL_SWITCH: PivotTableV3 DEACTIVATED (cached) for trial ${t.trial?.id||"unknown"}`)}),Le(()=>{I.info(`V4_TRIAL_SWITCH: PivotTableV3 UNMOUNTED (evicted) for trial ${t.trial?.id||"unknown"}`),n.value&&(document.body.style.overflow=""),_.value&&Q(),T.value&&Re()}),re([G,f],([M])=>{const J=!c.value.rowField&&!c.value.columnField&&!c.value.valueField;f.value.length>0&&J&&M.categorical.length>0&&(I.info("PIVOT_FIX: Auto-initializing empty config"),c.value.rowField=M.categorical.find(K=>K!=="model"&&K!=="status"&&K!=="error_type")||M.categorical[0]||"model",c.value.columnField="model",c.value.valueField="parsed_response",c.value.aggregation="mean",a("config-change",{...c.value}))},{immediate:!0}),(M,J)=>(u(),m("div",{class:ne(["pivot-table-v3",{fullscreen:n.value}])},[s("div",{class:ne(["pivot-options-container",{collapsed:p.value}])},[s("div",Nd,[s("div",Md,[J[6]||(J[6]=s("span",{class:"options-title"},"Pivot Table Options",-1)),s("button",{type:"button",class:"collapse-btn",onClick:Ge},y(p.value?"Expand":"Collapse"),1)]),s("div",Ud,[s("button",{type:"button",class:"copy-btn",disabled:!W(l)||W(l).rows.length===0,title:"Copy table to clipboard (paste into Excel/Sheets)",onClick:Oe(Te,["stop"])},y(r.value),9,zd),s("button",{type:"button",class:"export-btn",disabled:!W(l)||W(l).rows.length===0,title:"Export pivot table to CSV",onClick:Oe(Pe,["stop"])}," â¬‡ Export CSV ",8,Bd)]),s("div",Wd,[s("div",jd,[s("button",{type:"button",class:ne(["fit-toggle-btn",{active:C.value==="fit"}]),title:C.value==="fit"?"Allow horizontal scroll":"Fit to width",onClick:J[0]||(J[0]=Oe(K=>C.value=C.value==="fit"?"scroll":"fit",["stop"]))},y(C.value==="fit"?"â†” Fitted":"â†” Scroll"),11,Hd),s("button",{type:"button",class:ne(["fit-toggle-btn",{active:b.value==="fit"}]),title:b.value==="fit"?"Allow vertical scroll":"Fit to height",onClick:J[1]||(J[1]=Oe(K=>b.value=b.value==="fit"?"scroll":"fit",["stop"]))},y(b.value==="fit"?"â†• Fitted":"â†• Scroll"),11,Gd)]),s("div",qd,[s("button",{type:"button",class:"zoom-btn",disabled:V.value<=qt,title:"Zoom out",onClick:Oe(q,["stop"])}," âˆ’ ",8,Jd),s("span",Xd,y(Math.round(V.value*100))+"%",1),s("button",{type:"button",class:"zoom-btn",disabled:V.value>=Jt,title:"Zoom in",onClick:Oe(z,["stop"])}," + ",8,Kd),s("button",{type:"button",class:"zoom-btn reset",title:"Reset zoom",onClick:Oe(ae,["stop"])}," â†º ")]),s("button",{type:"button",class:"fullscreen-btn",title:n.value?"Exit Fullscreen":"Enter Fullscreen","aria-label":n.value?"Exit fullscreen mode":"Enter fullscreen mode",onClick:Oe(Ve,["stop"])},y(n.value?"âŠŸ Exit Fullscreen":"âŠž Fullscreen"),9,Zd)])]),je(s("div",Yd,[As([W(G),c.value],()=>(u(),m("div",null,[w(gd,{config:c.value,"available-fields":W(G),onUpdateConfig:ye},null,8,["config","available-fields"])])),J,2),s("div",Qd,[f.value.length>0?(u(),ee(Ld,{key:0,"api-calls":f.value,trial:M.trial,"active-filters":O.value,onUpdateFilters:Se,onClearFilters:Ue},null,8,["api-calls","trial","active-filters"])):E("",!0),w($d,{"selected-color-scale":o.value,"gradient-mode":d.value,onUpdateColorScale:J[3]||(J[3]=K=>o.value=K),onUpdateGradientMode:J[4]||(J[4]=K=>d.value=K)},null,8,["selected-color-scale","gradient-mode"])])],512),[[ss,!p.value]])],2),M.showPerformanceInfo?(u(),m("div",ec,[s("span",null,"Computing: "+y(W(Y)?"Yes":"No"),1),s("span",null,"Last Compute: "+y(W(A).toFixed(1))+"ms",1),s("span",null,"API Calls: "+y(f.value.length),1),s("span",null,"Filtered: "+y(S.value),1)])):E("",!0),s("div",tc,[f.value.length===0?(u(),m("div",sc,J[7]||(J[7]=[s("p",null,"No data available for pivot table analysis.",-1)]))):c.value.aggregation in W(Ye)?W(Y)?(u(),m("div",nc,J[9]||(J[9]=[s("p",null,"Computing pivot table...",-1)]))):(u(),m("div",{key:3,class:ne(["pivot-table-container",{"fit-horizontal":C.value==="fit","fit-vertical":b.value==="fit"}])},[s("table",{class:ne(["pivot-table-grid responsive-table resizable-table",{"fit-width":C.value==="fit"}]),style:fe({fontSize:R.value}),role:"table"},[s("colgroup",null,[s("col",{style:fe(C.value==="scroll"?{width:g.value.corner+"px"}:{width:N.value})},null,4),(u(!0),m(te,null,oe(W(l).columns,K=>(u(),m("col",{key:"col-"+K,style:fe(C.value==="scroll"?{width:g.value[K]+"px"}:{width:N.value})},null,4))),128)),c.value.columnField&&M.showTotals?(u(),m("col",{key:0,style:fe(C.value==="scroll"?{width:g.value.total+"px"}:{width:N.value})},null,4)):E("",!0)]),s("thead",null,[s("tr",{role:"row",style:fe({height:v.value+"px"})},[s("th",{class:"corner-cell",role:"columnheader",style:fe({height:v.value+"px"})},[s("div",{class:"header-content",style:fe({"-webkit-line-clamp":$.value})},y(ve(c.value.rowField)||"Items")+" / "+y(ve(c.value.columnField)||"Aggregated"),5),C.value==="scroll"?(u(),m("div",{key:0,class:"resize-handle",onMousedown:J[5]||(J[5]=K=>Z("corner",K))},null,32)):E("",!0)],4),(u(!0),m(te,null,oe(W(l).columns,K=>(u(),m("th",{key:K,class:"column-header",role:"columnheader",style:fe({height:v.value+"px"})},[s("div",{class:"header-content",style:fe({"-webkit-line-clamp":$.value})},y(K),5),C.value==="scroll"?(u(),m("div",{key:0,class:"resize-handle",onMousedown:se=>Z(K,se)},null,40,oc)):E("",!0)],4))),128)),c.value.columnField&&M.showTotals?(u(),m("th",{key:0,class:"total-header",role:"columnheader",style:fe({height:v.value+"px"})},[s("div",{class:"header-content",style:fe({"-webkit-line-clamp":$.value})},"Total",4)],4)):E("",!0)],4),s("tr",lc,[s("td",{colspan:W(l).columns.length+1+(c.value.columnField&&M.showTotals?1:0)},[s("div",{class:"header-resize-handle",onMousedown:pe},null,32)],8,ic)])]),s("tbody",null,[(u(!0),m(te,null,oe(X.value,K=>(u(),m("tr",{key:`${K.label}-${W(le)}`,class:"data-row",role:"row"},[s("td",rc,y(K.label),1),(u(!0),m(te,null,oe(K.cells,(se,he)=>(u(),m("td",{key:`${he}-${W(le)}`,class:ne(["data-cell",{"error-cell":se?.error}]),"data-testid":se?.error?"pivot-cell-error":"pivot-cell",style:fe(W(F)(se,K.label,he)),title:ge(K.label,W(l).columns[he],se),"aria-label":me(K.label,W(l).columns[he],se),role:se?.error?"alert":"cell",tabindex:"0",onClick:Ie=>Ae(K.label,W(l).columns[he],se),onKeydown:[ht(Ie=>Ae(K.label,W(l).columns[he],se),["enter"]),ht(Oe(Ie=>Ae(K.label,W(l).columns[he],se),["prevent"]),["space"])]},[se?.error?(u(),m("div",dc,[s("span",{class:"error-indicator",title:se.error},"âš ï¸",8,cc),s("span",pc,y(se?W(we)(se,c.value.aggregation):"-"),1),s("div",fc,y(se.error),1)])):(u(),m("span",mc,y(se?W(we)(se,c.value.aggregation):"-"),1))],46,uc))),128)),c.value.columnField&&M.showTotals?(u(),m("td",{key:0,class:"total-cell",style:fe(W(P)(K.total)),role:"cell"},y(W(we)(K.total,c.value.aggregation)),5)):E("",!0)]))),128)),c.value.rowField&&M.showTotals?(u(),m("tr",{key:`totals-${W(le)}`,class:"total-row",role:"row"},[J[10]||(J[10]=s("td",{class:"row-header",role:"rowheader"},"Total",-1)),(u(!0),m(te,null,oe(W(l).totals,(K,se)=>(u(),m("td",{key:`total-${se}-${W(le)}`,class:"total-cell",style:fe(W(P)(K)),role:"cell"},y(W(we)(K,c.value.aggregation)),5))),128)),c.value.columnField?(u(),m("td",{key:0,class:"grand-total-cell",style:fe(W(P)(W(l).grandTotal)),role:"cell"},y(W(we)(W(l).grandTotal,c.value.aggregation)),5)):E("",!0)])):E("",!0)])],6)],2)):(u(),m("div",ac,[s("p",null,"Invalid aggregation function: "+y(c.value.aggregation),1),J[8]||(J[8]=s("p",null,"Please select a valid aggregation method.",-1))]))])],2))}}),yc=ce(hc,[["__scopeId","data-v-8462bb4c"]]),bc={class:"modal-content"},_c={class:"modal-header"},Tc={class:"modal-title"},Cc={class:"summary-row"},$c={key:0},wc={key:0,class:"filter-row"},kc=["onUpdate:modelValue","aria-label"],Sc={value:""},Ic=["value"],Ec={class:"table-container"},Rc={class:"api-calls-table"},Fc=["onClick"],xc=["title"],Pc=["title"],Ac=de({__name:"PivotCellDetailV3",props:{visible:{type:Boolean},row:{},column:{},apiCalls:{},trial:{},value:{}},emits:["close"],setup(i){const e=i,t=Vs({}),a=B(null),{formatSingleCost:n}=dt(),o=U(()=>{const f=new Set;return e.apiCalls.forEach(L=>{L.variables&&Object.keys(L.variables).forEach(k=>f.add(k)),L.attributedVariables&&Object.entries(L.attributedVariables).forEach(([k,l])=>{l&&typeof l=="object"&&Object.keys(l).forEach(G=>{f.add(`${k}.${G}`)})})}),Array.from(f).sort()}),d=U(()=>o.value.map(f=>({title:f,dataIndex:`var_${f}`,key:`var_${f}`,width:150}))),p=[{title:"Status",dataIndex:"status",key:"status",width:100},{title:"Model",dataIndex:"model",key:"model",width:150}],r=[{title:"Response",dataIndex:"response",key:"response",width:300},{title:"Parsed Content",dataIndex:"parsedContent",key:"parsedContent",width:150},{title:"Duration",dataIndex:"duration",key:"duration",width:100},{title:"Cost",dataIndex:"cost",key:"cost",width:100}],c=U(()=>[...p,...d.value,...r]),g=U(()=>`${e.row} Ã— ${e.column} - ${e.apiCalls.length} API Calls`),_=U(()=>e.apiCalls.map(f=>{const L={id:f.id,status:f.status,model:f.modelName||"-",response:f.result?.content||f.result?.error||"-",parsedContent:N(f.result?.parsedContent),duration:f.duration!==void 0?`${f.duration}ms`:"-",cost:f.cost!==void 0?f.cost:"-"};return o.value.forEach(k=>{if(k.includes(".")){const[l,G]=k.split("."),Y=f.attributedVariables?.[l]?.[G];L[`var_${k}`]=Y!==void 0?String(Y):"-"}else L[`var_${k}`]=f.variables?.[k]||"-"}),L})),v=U(()=>Object.values(t).some(f=>f!==void 0&&f!=="")),T=U(()=>v.value?_.value.filter(f=>Object.entries(t).every(([L,k])=>k?f[L]===k:!0)):_.value),C=U(()=>{const f=e.apiCalls.filter(L=>L.status==="completed").length;return Math.round(f/e.apiCalls.length*100)}),b=U(()=>{const f=e.apiCalls.filter(L=>L.duration).map(L=>L.duration);return f.length===0?0:Math.round(f.reduce((L,k)=>L+k,0)/f.length)}),V=U(()=>{const f=e.apiCalls.filter(L=>L.cost!==void 0).map(L=>L.cost);if(f.length!==0)return f.reduce((L,k)=>L+k,0)});function N(f){if(f==null)return"-";if(typeof f=="string")return f;if(typeof f=="number"||typeof f=="boolean")return String(f);if(typeof f=="object")try{return JSON.stringify(f,null,2).substring(0,100)}catch{return"[Object]"}return String(f)}function j(f){switch(f){case"completed":return"status-success";case"failed":return"status-error";case"pending":return"status-warning";case"running":return"status-processing";default:return"status-default"}}function R(f,L=200){if(!f)return"";if(f.length<=L)return f;const k=f.slice(0,100),l=f.slice(-100);return`${k} [...TRUNCATED...] ${l}`}function $(f){const L=new Set;return _.value.forEach(k=>{const l=k[f];l&&l!=="-"&&L.add(l)}),Array.from(L).sort()}function O(){Object.keys(t).forEach(f=>{delete t[f]})}function h(f){const L=e.apiCalls.find(k=>k.id===f.id);L&&(a.value=L)}return(f,L)=>(u(),m(te,null,[s("div",{class:ne(["pivot-cell-detail-modal-v3",{visible:f.visible}]),onClick:L[1]||(L[1]=Oe(k=>f.$emit("close"),["self"]))},[s("div",bc,[s("div",_c,[s("h3",Tc,y(g.value),1),s("button",{type:"button",class:"close-btn","aria-label":"Close modal",onClick:L[0]||(L[0]=k=>f.$emit("close"))}," Ã— ")]),s("div",Cc,[s("span",null,[L[3]||(L[3]=s("b",null,"Total:",-1)),D(" "+y(f.apiCalls.length),1)]),s("span",null,[L[4]||(L[4]=s("b",null,"Success Rate:",-1)),D(" "+y(C.value)+"%",1)]),s("span",null,[L[5]||(L[5]=s("b",null,"Avg Duration:",-1)),D(" "+y(b.value)+"ms",1)]),V.value!==void 0?(u(),m("span",$c,[L[6]||(L[6]=s("b",null,"Total Cost:",-1)),D(" "+y(W(n)(V.value)),1)])):E("",!0)]),d.value.length>0?(u(),m("div",wc,[(u(!0),m(te,null,oe(d.value,k=>(u(),m("div",{key:k.key,class:"variable-filter"},[je(s("select",{"onUpdate:modelValue":l=>t[k.key]=l,"aria-label":`Filter ${k.title}`,class:"filter-select"},[s("option",Sc,"All "+y(k.title),1),(u(!0),m(te,null,oe($(k.key),l=>(u(),m("option",{key:l,value:l},y(l),9,Ic))),128))],8,kc),[[Os,t[k.key]]])]))),128)),v.value?(u(),m("button",{key:0,type:"button",class:"clear-filters-btn",onClick:O}," Clear Filters ")):E("",!0)])):E("",!0),s("div",Ec,[s("table",Rc,[s("thead",null,[s("tr",null,[(u(!0),m(te,null,oe(c.value,k=>(u(),m("th",{key:k.key,class:"table-header",style:fe({width:k.width?`${k.width}px`:"auto"})},y(k.title),5))),128))])]),s("tbody",null,[(u(!0),m(te,null,oe(T.value,k=>(u(),m("tr",{key:k.id,class:"table-row clickable-row",onClick:l=>h(k)},[(u(!0),m(te,null,oe(c.value,l=>(u(),m("td",{key:l.key,class:ne(["table-cell",{"status-cell":l.key==="status"}])},[l.key==="status"?(u(),m("span",{key:0,class:ne(["status-tag",j(k.status)])},y(k.status),3)):l.key==="response"?(u(),m("span",{key:1,class:"response-cell",title:k.response},y(R(k.response)),9,xc)):l.key==="cost"?(u(),m(te,{key:2},[D(y(k.cost==="-"?"-":W(n)(k.cost)),1)],64)):l.key.startsWith("var_")?(u(),m("span",{key:3,class:"variable-cell",title:k[l.key]},y(k[l.key]||"-"),9,Pc)):(u(),m(te,{key:4},[D(y(k[l.key]||"-"),1)],64))],2))),128))],8,Fc))),128))])])])])],2),a.value?(u(),ee(_s,{key:0,visible:!!a.value,"api-call":a.value,trial:f.trial,"onUpdate:visible":L[2]||(L[2]=k=>a.value=null)},null,8,["visible","api-call","trial"])):E("",!0)],64))}}),Vc=ce(Ac,[["__scopeId","data-v-ddbda380"]]),Oc={class:"trial-tab-content"},Dc={class:"tab-pane-content"},Lc={class:"tab-pane-content"},Nc={key:0,class:"no-data-message"},Mc={class:"tab-pane-content"},Kt="trial-details-active-tab",Uc=de({__name:"TrialTabContentV3",props:{trial:{},progress:{},isLeader:{type:Boolean},executionState:{}},setup(i){const e=i,t=as(),a=it(),n=ct(),o=U(()=>n.apiCalls?.value||[]),d=U(()=>n.isStreaming?.value||!1),p=re(o,(h,f)=>{const L=performance.now();I.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls changed from ${f?.length||0} to ${h.length} calls`),setTimeout(()=>{const k=performance.now();I.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls reactive update completed in ${(k-L).toFixed(1)}ms`)},0)}),r=U(()=>!1),g=B((()=>{const h=t.query.tab;return h==="status"?"details":h&&["details","tasks","pivot"].includes(h)?h:"tasks"})()),_=B(!1),v=re(g,h=>{n.setActiveTab(h)},{immediate:!0}),T=B(!1),C=B({row:"",column:"",apiCalls:[],value:null}),b=U(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial.id),V=U(()=>e.trial.progress.completed>0);function N(){localStorage.setItem(Kt,g.value);const h={...t.query};h.tab=g.value,t.query.tab!==g.value&&(a.replace({query:h}),I.info(`TAB_ROUTING: Updated URL tab parameter to '${g.value}'`))}function j(){const h=localStorage.getItem(Kt);h==="status"?g.value="details":h&&["details","tasks","pivot"].includes(h)&&(g.value=h)}function R(h){!h.cell||!h.cell.apiCalls.length||(C.value={row:h.row,column:h.column,apiCalls:h.cell.apiCalls,value:h.cell.value},T.value=!0)}const $=re(g,()=>{N()}),O=re(()=>t.query.tab,h=>{if(h&&typeof h=="string"){let f=h==="status"?"details":h;["details","tasks","pivot"].includes(f)&&g.value!==f&&(g.value=f,I.info(`TAB_ROUTING: Synced tab to URL parameter '${f}'`))}});return Fe(()=>{const h=performance.now();if(I.info(`V4_TRIAL_SWITCH: TrialTabContentV3 MOUNTED for trial ${e.trial.id}`),!t.query.tab){const f={...t.query};f.tab=g.value,a.replace({query:f}),I.info(`TAB_ROUTING: Set initial URL tab parameter to '${g.value}'`)}j(),setTimeout(()=>{const f=performance.now();I.info(`V4_TRIAL_SWITCH: TrialTabContentV3 mount completed in ${(f-h).toFixed(1)}ms`)},0)}),Ke(()=>{I.info(`V4_TRIAL_SWITCH: TrialTabContentV3 ACTIVATED (cache hit) for trial ${e.trial.id}`)}),Ze(()=>{I.info(`V4_TRIAL_SWITCH: TrialTabContentV3 DEACTIVATED (cached) for trial ${e.trial.id}`)}),Le(()=>{I.info(`V4_TRIAL_SWITCH: TrialTabContentV3 UNMOUNTED (evicted) for trial ${e.trial.id}`),p(),v(),$(),O()}),(h,f)=>{const L=pa,k=ca;return u(),m("div",Oc,[w(k,{activeKey:g.value,"onUpdate:activeKey":f[1]||(f[1]=l=>g.value=l),type:"card",class:"trial-tabs"},{default:x(()=>[w(L,{key:"tasks",tab:"Task View"},{default:x(()=>[s("div",Dc,[(u(),ee(yt,null,[w(Nu,{trial:h.trial,progress:h.progress,"is-executing":b.value,"api-calls":o.value,"is-streaming":d.value,"is-loading":r.value},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])],1024))])]),_:1}),w(L,{key:"pivot",tab:"Pivot Table"},{default:x(()=>[s("div",Lc,[(u(),ee(yt,null,[V.value&&o.value.length>0?(u(),ee(yc,{key:0,"api-calls":o.value,trial:h.trial,"show-performance-info":!1,onCellClick:R},null,8,["api-calls","trial"])):E("",!0)],1024)),V.value&&o.value.length>0?E("",!0):(u(),m("div",Nc,f[3]||(f[3]=[s("p",null,"No completed API calls available for pivot analysis.",-1),s("p",null,"Run the trial to see pivot table data.",-1)])))])]),_:1}),w(L,{key:"details",tab:"Details"},{default:x(()=>[s("div",Mc,[w(Tl,{trial:h.trial,"is-collapsed":_.value,onToggleCollapse:f[0]||(f[0]=l=>_.value=!_.value)},null,8,["trial","is-collapsed"])])]),_:1})]),_:1},8,["activeKey"]),T.value?(u(),ee(Vc,{key:0,visible:T.value,row:C.value.row,column:C.value.column,"api-calls":C.value.apiCalls,trial:h.trial,value:C.value.value,onClose:f[2]||(f[2]=l=>T.value=!1)},null,8,["visible","row","column","api-calls","trial","value"])):E("",!0)])}}}),zc=ce(Uc,[["__scopeId","data-v-e6f399f4"]]);class ke extends Error{constructor(t,a,n){super(a);Be(this,"code");Be(this,"details");this.name="ExportError",this.code=t,this.details=n}}function Zt(i){return typeof TextEncoder<"u"?new TextEncoder().encode(i).length:typeof Buffer<"u"?Buffer.byteLength(i,"utf8"):unescape(encodeURIComponent(i)).length}const Ce=class Ce{async loadTrialForExport(e){try{const t=this.getCachedData(e);if(t)return{ok:!0,value:t};const a=await qe.trials.get(e);if(!a)return{ok:!1,error:new ke("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})};const n=await qe.apiCalls.where("trialId").equals(e).toArray(),o={trial:a,apiCalls:n,fieldDefinitions:[],parameterFields:[],totalRecords:n.length};return this.setCachedData(e,o),{ok:!0,value:o}}catch(t){return{ok:!1,error:new ke("GENERATION_FAILED",`Failed to load trial data: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateTrialForExport(e){try{return await qe.trials.get(e)?await qe.apiCalls.where("trialId").equals(e).count()===0?{ok:!1,error:new ke("GENERATION_FAILED","Trial has no API calls to export",{trialId:e,apiCallCount:0})}:{ok:!0,value:!0}:{ok:!1,error:new ke("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})}}catch(t){return{ok:!1,error:new ke("GENERATION_FAILED",`Failed to validate trial: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async getApiCallCount(e){try{return await qe.apiCalls.where("trialId").equals(e).count()}catch(t){return I.warn(`Failed to get API call count for trial ${e}:`,t),0}}clearCache(e){Ce.cache.delete(e),Ce.cacheExpiry.delete(e)}clearAllCache(){Ce.cache.clear(),Ce.cacheExpiry.clear()}getCachedData(e){const t=Ce.cacheExpiry.get(e);return!t||Date.now()>t?(Ce.cache.delete(e),Ce.cacheExpiry.delete(e),null):Ce.cache.get(e)||null}setCachedData(e,t){Ce.cache.set(e,t),Ce.cacheExpiry.set(e,Date.now()+Ce.CACHE_TTL)}};Be(Ce,"cache",new Map),Be(Ce,"cacheExpiry",new Map),Be(Ce,"CACHE_TTL",6e4);let St=Ce;const tt=new St;class Bc{discoverAllParameters(e){const t=new Map;return e.configurations.forEach((a,n)=>{!a.parameters||typeof a.parameters!="object"||Object.entries(a.parameters).forEach(([o,d])=>{const p=`param_${o}`;t.has(p)||t.set(p,{parameterName:o,fieldId:p,usedByConfigurations:[],dataType:this.inferDataType(d),sampleValues:[]});const r=t.get(p);r.usedByConfigurations.push(n),r.sampleValues.length<3&&!r.sampleValues.includes(d)&&r.sampleValues.push(d)})}),Array.from(t.values()).map(a=>this.createParameterFieldDefinition(a,e)).sort((a,n)=>a.id.localeCompare(n.id))}getParameterUsageStats(e){const t=this.discoverAllParameters(e),a={},n=[],o=[];e.configurations.forEach((p,r)=>{const c=p.provider;a[c]||(a[c]=[]),t.forEach(g=>{g.usedByConfigurations.includes(r)&&(a[c].includes(g.parameterName)||a[c].push(g.parameterName))})});const d=Object.keys(a);return t.forEach(p=>{d.filter(c=>a[c].includes(p.parameterName)).length>1?n.push(p.parameterName):o.push(p.parameterName)}),{totalUniqueParameters:t.length,parametersByProvider:a,sharedParameters:n.sort(),providerSpecificParameters:o.sort()}}validateParameterFields(e,t){const n=this.discoverAllParameters(e).map(r=>r.id),o=t.filter(r=>r.startsWith("param_")),d=[],p=[];return o.forEach(r=>{n.includes(r)?d.push(r):p.push(r)}),{validFields:d,invalidFields:p,availableFields:n}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}createParameterFieldDefinition(e,t){const a=e.usedByConfigurations.map(o=>t.configurations[o]?.provider||"unknown").filter((o,d,p)=>p.indexOf(o)===d).sort(),n=this.generateParameterDescription(e,a);return{id:e.fieldId,name:e.parameterName,description:n,group:"parameters",dataType:e.dataType,isRequired:!1,parameterName:e.parameterName,usedByConfigurations:e.usedByConfigurations}}generateParameterDescription(e,t){const a=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(o=>JSON.stringify(o)).join(", ")})`:"";return`${t.length===1?`Used by ${t[0]}`:`Used by ${t.join(", ")}`}${a}. Empty for configurations that don't use this parameter.`}}const lt=new Bc;class Wc{discoverAllVariables(e,t){I.info("EXPORT_DEBUG: VARIABLE_DISCOVERY analyzing",{trialId:e.id,apiCallCount:t.length});const a=new Map,n=new Map;t.forEach(g=>{g.variables&&typeof g.variables=="object"&&Object.entries(g.variables).forEach(([_,v])=>{const T=`var_${_}`;a.has(T)||a.set(T,{variableName:_,fieldId:T,usedByCallCount:0,dataType:this.inferDataType(v),sampleValues:[]});const C=a.get(T);C.usedByCallCount++,C.sampleValues.length<3&&!C.sampleValues.includes(v)&&C.sampleValues.push(v)}),g.variableAttributes&&typeof g.variableAttributes=="object"&&Object.entries(g.variableAttributes).forEach(([_,v])=>{!v||typeof v!="object"||Object.entries(v).forEach(([T,C])=>{const b=`attr_${_}_${T}`;n.has(b)||n.set(b,{attributeName:T,fieldId:b,usedByCallCount:0,dataType:this.inferDataType(C),sampleValues:[]});const V=n.get(b);V.usedByCallCount++,V.sampleValues.length<3&&!V.sampleValues.includes(C)&&V.sampleValues.push(C)})})});const o=Array.from(a.values()).map(g=>this.createVariableFieldDefinition(g,t.length)),d=Array.from(n.values()).map(g=>this.createAttributeFieldDefinition(g,t.length)),p=[];t.some(g=>g.variableIndices&&Object.keys(g.variableIndices).length>0)&&Array.from(a.values()).forEach(g=>{const _=g.variableName;p.push({id:`source_${_}_list`,name:`${_} Source List`,description:`Name of the list that provided the value for ${_}`,group:"source",dataType:"string",isRequired:!1}),p.push({id:`source_${_}_index`,name:`${_} Source Index`,description:`Position in the list (0-based) for ${_}`,group:"source",dataType:"number",isRequired:!1})});const c=[...o,...d,...p].sort((g,_)=>g.id.localeCompare(_.id));return I.info("EXPORT_DEBUG: VARIABLE_DISCOVERY discovered",{variableCount:o.length,attributeCount:d.length,sourceCount:p.length,totalCount:c.length,variableNames:o.map(g=>g.id),attributeNames:d.map(g=>g.id)}),c}getVariableUsageStats(e,t){const a=this.discoverAllVariables(e,t),n={};a.forEach(p=>{const r=p.name,c=this.getVariableInfo(r,t);n[r]=c.usedByCallCount});const o=Object.entries(n).sort(([,p],[,r])=>r-p).map(([p])=>p),d=t.filter(p=>p.variables&&typeof p.variables=="object"&&Object.keys(p.variables).length>0).length;return{totalUniqueVariables:a.length,variableUsageCounts:n,mostCommonVariables:o.slice(0,10),totalCallsWithVariables:d}}validateVariableFields(e,t,a){const o=this.discoverAllVariables(e,t).map(c=>c.id),d=a.filter(c=>c.startsWith("var_")),p=[],r=[];return d.forEach(c=>{o.includes(c)?p.push(c):r.push(c)}),{validFields:p,invalidFields:r,availableFields:o}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}getVariableInfo(e,t){let a=0;const n=[];return t.forEach(o=>{if(o.variables&&o.variables[e]!==void 0){a++;const d=o.variables[e];n.length<3&&!n.includes(d)&&n.push(d)}}),{attributeName:e,fieldId:`attr_${e}`,usedByCallCount:a,dataType:n.length>0?this.inferDataType(n[0]):"string",sampleValues:n}}createVariableFieldDefinition(e,t){const a=this.generateVariableDescription(e,t);return{id:e.fieldId,name:e.variableName,description:a,group:"content",dataType:e.dataType,isRequired:!1}}createAttributeFieldDefinition(e,t){const a=this.generateAttributeDescription(e,t),n=e.fieldId.replace("attr_","").split("_"),o=n[0],d=n.slice(1).join("_"),p=`${o} attr ${d}`;return{id:e.fieldId,name:p,description:a,group:"content",dataType:e.dataType,isRequired:!1}}generateVariableDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),n=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(o=>JSON.stringify(o)).join(", ")})`:"";return`Template variable used in ${e.usedByCallCount}/${t} calls (${a}%)${n}. Empty for calls that don't use this variable.`}generateAttributeDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),n=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(o=>JSON.stringify(o)).join(", ")})`:"";return`Variable attribute used in ${e.usedByCallCount}/${t} calls (${a}%)${n}. Empty for calls that don't use this attribute.`}}const Cs=new Wc;class jc{isAuthField(e){return e==="request"}sanitizeFieldValue(e,t,a,n){return!t||t.length===0?t:(I.info("EXPORT_DEBUG: EXPORT_SANITIZATION checking field",{fieldId:e,valueLength:t.length,isAuthField:this.isAuthField(e),callId:a.id}),e==="request"?this.sanitizeRequestField(t,a,n):t)}sanitizeRequestField(e,t,a){try{const n=JSON.parse(e),o=this.getProviderIdForCall(t,a);if(!o)return I.info("EXPORT_DEBUG: EXPORT_SANITIZATION no provider found for call",{callId:t.id}),this.sanitizeGenericRequest(e);I.info("EXPORT_DEBUG: EXPORT_SANITIZATION sanitizing request with provider",{providerId:o,callId:t.id});const d=Ms(n,o);return JSON.stringify(d,null,2)}catch(n){return I.info("EXPORT_DEBUG: EXPORT_SANITIZATION failed to parse request JSON",{error:n instanceof Error?n.message:String(n),callId:t.id}),"[MALFORMED_REQUEST_JSON_REDACTED_FOR_SAFETY]"}}sanitizeGenericRequest(e){try{const t=JSON.parse(e);if(t.headers){const a={...t.headers},n=["authorization","api-key","x-api-key","bearer","x-auth-token"];for(const[o,d]of Object.entries(a)){const p=o.toLowerCase();n.some(r=>p.includes(r))&&(a[o]=`${String(d).substring(0,8)}...REDACTED`)}t.headers=a}return JSON.stringify(t,null,2)}catch(t){return I.info("EXPORT_DEBUG: EXPORT_SANITIZATION generic sanitization failed",{error:t instanceof Error?t.message:String(t)}),"[REQUEST_JSON_PARSE_FAILED_REDACTED]"}}getProviderIdForCall(e,t){try{return t.configurations[e.configurationIndex]?.provider||null}catch(a){return I.info("EXPORT_DEBUG: EXPORT_SANITIZATION failed to get provider ID",{error:a instanceof Error?a.message:String(a),callId:e.id}),null}}getFieldsRequiringSanitization(){return["request"]}createSanitizationSummary(e){const t=e.filter(a=>this.isAuthField(a));return{sanitizationEnabled:t.length>0,sanitizedFields:t}}}const Yt=new jc;class Hc{extractFieldValue(e,t,a){if(t.startsWith("param_"))return this.extractParameterValue(e,t,a);if(t.startsWith("var_"))return I.info("EXPORT_DEBUG: FIELD_EXTRACTOR extracting variable field",{field:t,callId:e.id,variables:e.variables}),this.extractVariableValue(e,t);if(t.startsWith("attr_")){I.info("EXPORT_DEBUG: FIELD_EXTRACTOR extracting attribute field",{field:t,callId:e.id,variableAttributes:e.variableAttributes});const o=this.extractAttributeValue(e,t);return I.info("EXPORT_DEBUG: FIELD_EXTRACTOR attribute field result",{field:t,callId:e.id,result:o}),o}if(t.startsWith("source_"))return this.extractSourceValue(e,t,a);const n=this.extractRawFieldValue(e,t,a);return Yt.isAuthField(t)?(I.info("EXPORT_DEBUG: FIELD_EXTRACTOR sanitizing auth field",{field:t,callId:e.id}),Yt.sanitizeFieldValue(t,n,e,a)):n}extractRawFieldValue(e,t,a){switch(t){case"id":return e.id;case"order":return String(e.order);case"status":return e.status;case"created":return e.created.toISOString();case"completed":return e.completed?.toISOString()||"";case"configuration":return this.getConfigurationName(e,a);case"provider":return a.configurations[e.configurationIndex]?.provider||"";case"modelId":return a.configurations[e.configurationIndex]?.modelId||"";case"parameters":return this.getParametersJson(e,a);case"prompt":return e.prompt;case"variables":return JSON.stringify(e.variables||{});case"response":return e.result?.content||"";case"parsedResponse":return JSON.stringify(e.result?.parsedContent||{});case"latency":return String(e.response?.latencyMs||e.result?.latency||"");case"promptTokens":return String(e.result?.usage?.prompt_tokens||"");case"completionTokens":return String(e.result?.usage?.completion_tokens||"");case"totalTokens":return String(e.result?.usage?.total_tokens||"");case"request":return JSON.stringify(e.request||{});case"response_raw":return JSON.stringify(e.response||{});case"error":return e.result?.error||"";case"repeatIndex":return String(e.repeatIndex||"");case"cost":return e.cost!==void 0?String(e.cost):this.calculateCost(e,a);case"refused":return String(e.result?.refused||!1);default:return`UNKNOWN_FIELD: ${t}`}}extractMultipleFields(e,t,a){const n={};return t.forEach(o=>{n[o]=this.extractFieldValue(e,o,a)}),n}getFieldDefinitions(e,t){const a=this.getStandardFieldDefinitions(),n=lt.discoverAllParameters(e),o=t?Cs.discoverAllVariables(e,t):[];return[...a,...n,...o]}getStandardFieldDefinitions(){return[{id:"id",name:"Call ID",description:"Unique identifier for the API call",group:"basic",dataType:"string",isRequired:!0},{id:"order",name:"Order",description:"Execution order of the API call within the trial",group:"basic",dataType:"number",isRequired:!0},{id:"status",name:"Status",description:"Current status of the API call (pending, running, completed, failed, cancelled)",group:"basic",dataType:"string",isRequired:!0},{id:"created",name:"Created Time",description:"When the API call was created (ISO timestamp)",group:"basic",dataType:"date",isRequired:!0},{id:"completed",name:"Completed Time",description:"When the API call was completed (ISO timestamp, empty if not completed)",group:"basic",dataType:"date",isRequired:!1},{id:"configuration",name:"Configuration",description:"Configuration name or model ID used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"provider",name:"Provider",description:"LLM provider used (e.g., openai-chat, anthropic, ollama)",group:"configuration",dataType:"string",isRequired:!0},{id:"modelId",name:"Model ID",description:"Specific model identifier used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"parameters",name:"Parameters (JSON)",description:"Model parameters as JSON object",group:"configuration",dataType:"json",isRequired:!1},{id:"prompt",name:"Prompt",description:"The input prompt sent to the model",group:"content",dataType:"string",isRequired:!0},{id:"variables",name:"Variables (JSON)",description:"Template variables as JSON object",group:"content",dataType:"json",isRequired:!1},{id:"response",name:"Response",description:"The text response from the model",group:"content",dataType:"string",isRequired:!1},{id:"parsedResponse",name:"Parsed Response",description:"Structured/parsed response data (JSON)",group:"content",dataType:"json",isRequired:!1},{id:"latency",name:"Latency (ms)",description:"Response time in milliseconds",group:"performance",dataType:"number",isRequired:!1},{id:"promptTokens",name:"Prompt Tokens",description:"Number of tokens in the input prompt",group:"performance",dataType:"number",isRequired:!1},{id:"completionTokens",name:"Completion Tokens",description:"Number of tokens in the model response",group:"performance",dataType:"number",isRequired:!1},{id:"totalTokens",name:"Total Tokens",description:"Total tokens used (prompt + completion)",group:"performance",dataType:"number",isRequired:!1},{id:"request",name:"Full Request",description:"Complete API request sent to the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"response_raw",name:"Raw Response",description:"Full API response from the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"error",name:"Error Details",description:"Error message if the call failed",group:"technical",dataType:"string",isRequired:!1},{id:"repeatIndex",name:"Repeat Index",description:"Index for repeated calls (empty for single calls)",group:"technical",dataType:"number",isRequired:!1},{id:"cost",name:"Cost (USD)",description:"Calculated cost of the API call based on token usage",group:"performance",dataType:"number",isRequired:!1},{id:"refused",name:"Refused",description:"Whether the model refused to respond (true/false)",group:"content",dataType:"boolean",isRequired:!1}]}validateFields(e,t){const n=this.getFieldDefinitions(e).map(p=>p.id),o=[],d=[];return t.forEach(p=>{n.includes(p)?o.push(p):d.push(p)}),{validFields:o,invalidFields:d,availableFields:n}}extractParameterValue(e,t,a){const n=t.replace("param_",""),o=a.configurations[e.configurationIndex];if(!o||!o.parameters)return"";const d=o.parameters[n];return d==null?"":typeof d=="object"?JSON.stringify(d):String(d)}getConfigurationName(e,t){const a=t.configurations[e.configurationIndex];return a?a.modelId||`Config ${e.configurationIndex+1}`:`Config ${e.configurationIndex+1}`}getParametersJson(e,t){const a=t.configurations[e.configurationIndex];if(!a||!a.parameters)return"{}";const n=Us();let o={...a.parameters};if(a.providerSnapshot?.requestTransform?.nestParams){const p=a.providerSnapshot.requestTransform.nestParams,r=a.providerSnapshot.requestTransform.rootLevelParams||[],c={},g={};Object.entries(o).forEach(([_,v])=>{r.includes(_)?g[_]=v:c[_]=v}),o=g,Object.keys(c).length>0&&(o[p]=c)}const d=n.unflattenParameters(o);return JSON.stringify(d)}extractVariableValue(e,t){const a=t.replace("var_","");if(!e.variables||typeof e.variables!="object")return"";const n=e.variables[a];return n==null?"":typeof n=="object"?JSON.stringify(n):String(n)}extractAttributeValue(e,t){const a=t.replace("attr_","").split("_");if(a.length<2)return"";const n=a[0],o=a.slice(1).join("_");if(!e.variableAttributes||typeof e.variableAttributes!="object")return"";const d=e.variableAttributes[n];if(!d||typeof d!="object")return"";const p=d[o];return p==null?"":typeof p=="object"?JSON.stringify(p):String(p)}extractSourceValue(e,t,a){const n=t.replace("source_","").split("_");if(n.length<2)return"";const o=n[n.length-1],d=n.slice(0,-1).join("_");if(!e.variableIndices||typeof e.variableIndices!="object")return"";const p=e.variableIndices[d];if(p==null)return"";if(o==="index")return String(p);if(o==="list"){if(a.type==="template"&&a.templateConfig?.variables){const r=a.templateConfig.variables[d];if(r&&"snapshot"in r&&r.snapshot?.source?.listName)return r.snapshot.source.listName;if(r?.listId)return r.listId}return""}return""}calculateCost(e,t){if(!e.result?.usage)return"0";const a=t.configurations[e.configurationIndex];if(!a)return"0";const n=a.modelSnapshot;if(!n)return"0";const o=e.result.usage.prompt_tokens,d=e.result.usage.completion_tokens,p=Dt(o,n.capabilities?.inputCostPerToken),r=Dt(d,n.capabilities?.outputCostPerToken);if(p===null||r===null)return"N/A";const c=p+r;return zs(c).replace("$","")}}const De=new Hc;class Gc{validateFormat(e){const t=["csv","tsv","excel","json","jsonl","python"];return t.includes(e)?{isValid:!0,errors:[],warnings:[]}:{isValid:!1,errors:[`Invalid format: ${e}. Supported formats: ${t.join(", ")}`],warnings:[]}}validateFields(e,t,a){if(!t||t.length===0)return{isValid:!1,errors:["No fields selected for export"],warnings:[],unknownFields:[],supportedFields:De.getFieldDefinitions(e,a).map(c=>c.id)};const n=De.validateFields(e,t),o=n.invalidFields.filter(c=>!c.startsWith("var_")&&!c.startsWith("attr_")),d={isValid:o.length===0,errors:[],warnings:[],unknownFields:o,supportedFields:n.availableFields};o.length>0&&d.errors.push(`Unknown fields requested: ${o.join(", ")}`),(t.includes("request")||t.includes("response_raw"))&&d.warnings.push("Technical fields (request, response_raw) contain large JSON objects and may significantly increase file size");const p=t.filter(c=>c.startsWith("param_"));p.length>10&&d.warnings.push(`Large number of parameter fields selected (${p.length}). This may result in a very wide export file with many empty cells.`);const r=t.filter(c=>c.startsWith("var_"));return r.length>10&&d.warnings.push(`Large number of variable fields selected (${r.length}). This may result in a very wide export file with many empty cells.`),d}validateExportSize(e,t,a){const n=$e.estimateFileSize(e,t,a),o=n/(1024*1024),d={isValid:!0,errors:[],warnings:[]};return o>500?(d.isValid=!1,d.errors.push(`Export too large: ${$e.formatFileSize(n)}. Maximum allowed: 500MB. Consider reducing the number of fields or using filters.`)):o>100&&d.warnings.push(`Large export: ${$e.formatFileSize(n)}. This may take several minutes to generate and download.`),e>1e5&&d.warnings.push(`Large number of records: ${e.toLocaleString()}. Export generation may take several minutes.`),t>50&&d.warnings.push(`Large number of fields: ${t}. Resulting file will be very wide and may be difficult to work with in spreadsheet applications.`),d}validateExportOptions(e,t,a){const n=[],o=[],d=this.validateFormat(t.format);if(d.isValid||n.push(...d.errors),t.fields){const p=this.validateFields(e,t.fields,a);p.isValid||n.push(...p.errors),o.push(...p.warnings);const r=this.validateExportSize(e.progress?.total||0,t.fields.length,t.format);r.isValid||n.push(...r.errors),o.push(...r.warnings)}return t.format==="python"&&t.fields&&t.fields.length>0&&o.push("Field selection is ignored for Python exports. Python scripts include all available data."),{isValid:n.length===0,errors:n,warnings:o}}getRecommendedFields(e){const t=["order","status","configuration","prompt","response","latency"],a=De.getFieldDefinitions(e).filter(d=>d.group==="parameters").map(d=>d.id),n=["param_temperature","param_max_tokens","param_top_p"],o=a.filter(d=>n.includes(d));return[...t,...o]}}const gt=new Gc;class Qe{validateOptions(e){const t=[],a=[];e.fields&&e.fields.length===0&&t.push("At least one field must be selected");const n=this.getFormatInfo();return e.includeHeaders&&!n.supportsHeaders&&a.push(`${n.name} format does not support headers - ignoring includeHeaders option`),e.addBOM&&!n.supportsBOM&&a.push(`${n.name} format does not support BOM - ignoring addBOM option`),{isValid:t.length===0,errors:t,warnings:a}}prepareFieldList(e,t){if(t&&t.length>0){const p=t.filter(_=>_.startsWith("var_")),r=t.filter(_=>_.startsWith("attr_")),c=t.filter(_=>!_.startsWith("var_")&&!_.startsWith("attr_")),g=De.validateFields(e,c);return g.invalidFields.length>0&&I.warn("Invalid fields requested:",g.invalidFields),[...g.validFields,...p,...r]}const a=["id","order","status","configuration","provider","modelId","prompt","response","refused","latency"],n=lt.discoverAllParameters(e),o=["param_temperature","param_max_tokens","param_top_p"],d=n.filter(p=>o.includes(p.id)).map(p=>p.id);return[...a,...d]}prepareDataRows(e,t,a){return e.map(n=>t.map(o=>De.extractFieldValue(n,o,a)))}prepareHeaderRow(e){return e.map(t=>t.startsWith("param_")?`param_${t.replace("param_","")}`:t.replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase()).trim())}hasParameterFields(e){return e.some(t=>t.startsWith("param_"))}escapeFieldValue(e){return e==null?"":String(e)}}class qc extends Qe{async generate(e,t,a){const n=this.prepareFieldList(t,a.fields),o=[];if(a.includeHeaders!==!1){const c=this.prepareHeaderRow(n).map(g=>this.escapeCSVValue(g)).join(",");o.push(c)}this.prepareDataRows(e,n,t).forEach(r=>{const c=r.map(g=>this.escapeCSVValue(g)).join(",");o.push(c)});let p=o.join(`
`);return a.addBOM&&(p="\uFEFF"+p),p}getFormatInfo(){return{name:"CSV",description:"Comma-separated values format, compatible with Excel and other spreadsheet applications",mimeType:"text/csv",extension:"csv",supportsHeaders:!0,supportsBOM:!0}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];if(e.fields&&e.fields.length>30&&a.push("Large number of columns may make the CSV difficult to work with in spreadsheet applications"),e.fields){const n=["variables","parsedResponse","request","response_raw"];e.fields.some(d=>n.includes(d))&&a.push("JSON fields (variables, parsedResponse, request, response_raw) may not display well in spreadsheet applications")}return{...t,warnings:a}}escapeCSVValue(e){if(e==null)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes(`
`)||t.includes("\r")?`"${t.replace(/"/g,'""')}"`:t}}class Jc extends Qe{async generate(e,t,a){const n=this.prepareFieldList(t,a.fields),o=[];if(a.includeHeaders!==!1){const r=this.prepareHeaderRow(n).map(c=>this.escapeTSVValue(c)).join("	");o.push(r)}return this.prepareDataRows(e,n,t).forEach(p=>{const r=p.map(c=>this.escapeTSVValue(c)).join("	");o.push(r)}),o.join(`
`)}getFormatInfo(){return{name:"TSV",description:"Tab-separated values format, useful for data analysis tools and database imports",mimeType:"text/tab-separated-values",extension:"tsv",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return a.push("TSV format may not be directly supported by all spreadsheet applications"),{...t,warnings:a}}escapeTSVValue(e){return e==null?"":String(e).replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}}class Xc extends Qe{async generate(e,t,a){const n=this.prepareFieldList(t,a.fields),o=mt.book_new(),d=[];if(a.includeHeaders!==!1){const _=this.prepareHeaderRow(n);d.push(_)}const p=this.prepareDataRows(e,n,t);d.push(...p);const r=mt.aoa_to_sheet(d),c=this.calculateColumnWidths(d);return r["!cols"]=c,mt.book_append_sheet(o,r,"Export Data"),Ca(o,{type:"base64",bookType:"xlsx",compression:!0})}getFormatInfo(){return{name:"Excel",description:"Microsoft Excel .xlsx format with proper formatting and auto-sized columns",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",extension:"xlsx",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.fields&&e.fields.length>16384&&a.push("Excel has a limit of 16,384 columns - some fields may not display correctly"),e.addBOM&&a.push("Excel .xlsx format is binary - ignoring addBOM option"),a.push("Excel format provides native spreadsheet functionality with auto-sized columns"),{...t,warnings:a}}calculateColumnWidths(e){if(e.length===0)return[];const t=Math.max(...e.map(n=>n.length)),a=[];for(let n=0;n<t;n++){let o=10;for(const d of e)if(d[n]!==void 0){const p=String(d[n]).length;o=Math.max(o,Math.min(p*1.2,50))}a.push({wch:o})}return a}}class Kc extends Qe{async generate(e,t,a){const n=this.prepareFieldList(t,a.fields),o={metadata:{trialId:t.id,trialName:t.name,trialType:t.type,exportDate:new Date().toISOString(),recordCount:e.length,fieldCount:n.length,hasParameterFields:this.hasParameterFields(n)},trial:{id:t.id,name:t.name,description:t.description,type:t.type,status:t.status,created:t.created.toISOString(),configurations:t.configurations.map((d,p)=>({index:p,provider:d.provider,modelId:d.modelId,parameters:d.parameters||{}}))},fields:n.map(d=>{const p=De.getFieldDefinitions(t).find(r=>r.id===d);return{id:d,name:p?.name||d,description:p?.description||"",group:p?.group||"unknown",dataType:p?.dataType||"string"}}),apiCalls:e.map(d=>{const p={};return n.forEach(r=>{const c=De.extractFieldValue(d,r,t);p[r]=this.parseJSONValue(c,r)}),p})};return JSON.stringify(o,null,2)}getFormatInfo(){return{name:"JSON",description:"JavaScript Object Notation format with complete trial metadata and structured data",mimeType:"application/json",extension:"json",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSON format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSON format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("Large number of fields in JSON format may result in large file sizes and memory usage"),{...t,warnings:a}}parseJSONValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const o=Number(e);return isNaN(o)?null:o}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const o=Number(e);if(!isNaN(o))return o;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return e}}class Zc extends Qe{async generate(e,t,a){const n=this.prepareFieldList(t,a.fields),o=[];return e.forEach(d=>{const p={};n.forEach(r=>{const c=De.extractFieldValue(d,r,t);p[r]=this.parseJSONLValue(c,r)}),o.push(JSON.stringify(p))}),o.join(`
`)}getFormatInfo(){return{name:"JSONL",description:"JSON Lines format with one JSON object per line, ideal for streaming and big data processing",mimeType:"application/x-jsonlines",extension:"jsonl",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSONL format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSONL format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("JSONL format handles large datasets well, but many fields may impact readability"),{...t,warnings:a}}parseJSONLValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const d=Number(e);return isNaN(d)?null:d}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const d=Number(e);if(!isNaN(d))return d;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return["created","completed"].includes(t),e}}function Yc(i){switch(i){case"csv":return new qc;case"tsv":return new Jc;case"excel":return new Xc;case"json":return new Kc;case"jsonl":return new Zc;default:throw new Error(`Unsupported format: ${i}`)}}class Qc{async exportTrialData(e,t){const a=Date.now();I.info("EXPORT_DEBUG: DATA_EXPORT START",{trialId:e,format:t.format,startTime:a});try{const n=await tt.loadTrialForExport(e);if(!n.ok){const C=n.error;return{ok:!1,error:new ke("GENERATION_FAILED",`Failed to load trial data: ${C.message}`,{trialId:e,originalError:C})}}const{trial:o,apiCalls:d}=n.value;I.info("EXPORT_DEBUG: DATA_EXPORT VALIDATING_OPTIONS",{trialId:e,format:t.format});const p=await this.validateExportOptions(e,t,d);if(!p.ok){const C=p.error;return{ok:!1,error:new ke("GENERATION_FAILED",`Validation failed: ${C.message}`,{trialId:e,options:t,originalError:C})}}if(!p.value.isValid)return{ok:!1,error:new ke("INVALID_FIELDS",`Export validation failed: ${p.value.errors.join(", ")}`,{errors:p.value.errors})};I.info("EXPORT_DEBUG: DATA_EXPORT GETTING_GENERATOR",{format:t.format});const r=Yc(t.format);I.info("EXPORT_DEBUG: DATA_EXPORT GENERATING_DATA",{format:t.format,apiCallCount:d.length,fieldCount:t.fields?.length||0,requestedFields:t.fields,paramFields:t.fields?.filter(C=>C.startsWith("param_")),varFields:t.fields?.filter(C=>C.startsWith("var_")),attrFields:t.fields?.filter(C=>C.startsWith("attr_"))});const c=Date.now(),g=await r.generate(d,o,t);I.info("EXPORT_DEBUG: DATA_EXPORT GENERATION_COMPLETE",{durationMs:Date.now()-c,dataLength:g.length,estimatedBytes:Zt(g)});const _=t.fields||[],v=Date.now()-a,T={filename:$e.generateFilename(o.name,t.format),mimeType:r.getFormatInfo().mimeType,data:g,metadata:{trialName:o.name,trialId:o.id,exportDate:new Date,callCount:d.length,fieldCount:_.length,format:t.format,estimatedSizeBytes:Zt(g)},format:t.format,recordCount:d.length,fieldCount:_.length,hasParameterFields:_.some(C=>C.startsWith("param_")),generationTimeMs:v};return I.info("EXPORT_DEBUG: DATA_EXPORT SUCCESS",{trialId:e,format:t.format,filename:T.filename,sizeBytes:T.metadata.estimatedSizeBytes,generationTimeMs:T.generationTimeMs}),{ok:!0,value:T}}catch(n){const o=n instanceof Error?n:new Error(String(n));return I.info("EXPORT_DEBUG: DATA_EXPORT UNEXPECTED_ERROR",{error:o,errorMessage:o.message,errorStack:o.stack,errorName:o.name,errorConstructor:o.constructor.name,trialId:e,format:t.format,generationTimeMs:Date.now()-a,originalError:n}),{ok:!1,error:new ke("GENERATION_FAILED",`Export generation failed: ${o.message}`,{trialId:e,options:t,originalError:n,generationTimeMs:Date.now()-a})}}}async previewExport(e,t){try{const a=await tt.loadTrialForExport(e);if(!a.ok){const v=a.error;return{ok:!1,error:new ke("GENERATION_FAILED",`Failed to load trial data: ${v.message}`,{trialId:e,originalError:v})}}const{trial:n,apiCalls:o}=a.value,d=De.getFieldDefinitions(n),p=lt.discoverAllParameters(n),r=t.fields||this.getDefaultFields(n),c=t.format||"csv",g=$e.estimateFileSize(o.length,r.length,c);return{ok:!0,value:{fieldCount:r.length,recordCount:o.length,estimatedSizeBytes:g,availableFields:d,parameterFields:p}}}catch(a){return{ok:!1,error:new ke("GENERATION_FAILED",`Preview generation failed: ${a instanceof Error?a.message:"Unknown error"}`,{trialId:e,options:t,originalError:a})}}}async getAvailableFields(e){try{const t=await tt.loadTrialForExport(e);if(!t.ok){const c=t.error;return{ok:!1,error:new ke("GENERATION_FAILED",`Failed to load trial data: ${c.message}`,{trialId:e,originalError:c})}}const{trial:a,apiCalls:n}=t.value,o=De.getStandardFieldDefinitions(),d=lt.discoverAllParameters(a),p=Cs.discoverAllVariables(a,n),r=gt.getRecommendedFields(a);return{ok:!0,value:{standardFields:o,parameterFields:d,variableFields:p,recommendedFields:r}}}catch(t){return{ok:!1,error:new ke("GENERATION_FAILED",`Field discovery failed: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateExportOptions(e,t,a){try{const n=await tt.loadTrialForExport(e);if(!n.ok){const p=n.error;return{ok:!1,error:new ke("GENERATION_FAILED",`Failed to load trial data: ${p.message}`,{trialId:e,originalError:p})}}const{trial:o}=n.value;return{ok:!0,value:gt.validateExportOptions(o,t,a)}}catch(n){return{ok:!1,error:new ke("GENERATION_FAILED",`Validation failed: ${n instanceof Error?n.message:"Unknown error"}`,{trialId:e,options:t,originalError:n})}}}getDefaultFields(e){return gt.getRecommendedFields(e)}}const It=new Qc,ep={class:"export-content"},tp={class:"section"},sp={key:0,class:"section"},ap={class:"bundle-info"},np={key:0},op={key:1,class:"section"},lp={class:"field-actions"},ip={class:"field-groups"},rp={class:"field-group"},up={class:"field-list"},dp={class:"field-group"},cp={class:"field-list"},pp={class:"field-group"},fp={class:"field-list"},mp={class:"field-group"},vp={class:"field-list"},gp={class:"field-group"},hp={class:"field-list"},yp={key:0,class:"field-group"},bp={class:"field-list"},_p={key:1,class:"field-group"},Tp={class:"field-list"},Cp={class:"section"},$p={class:"preview-info"},wp={class:"info-item"},kp={class:"value"},Sp={class:"info-item"},Ip={class:"value"},Ep={class:"info-item"},Rp={class:"value"},Fp={class:"export-actions"},xp=de({__name:"ExportDataModalV3",props:{visible:{type:Boolean},trial:{}},emits:["update:visible"],setup(i,{emit:e}){const t=i,a=e,n=B("csv"),o=B(["order","status","configuration","prompt","response","latency"]),d=B(!1),p=B("draft"),r=B({}),c=B([]),g=B([]),_=B([]),v=["order","status","configuration","prompt","response","latency"],T=B([]),C=["id","order","status","created","completed","configuration","provider","modelId","parameters","prompt","variables","response","parsedResponse","latency","promptTokens","completionTokens","totalTokens","cost","request","response_raw","error","repeatIndex"],b=U(()=>{const k=t.trial.progress?.completed||0,l=t.trial.progress?.failed||0;return k+l}),V=U(()=>{const l=o.value.length*50*b.value;return l<1024?`${l} B`:l<1024*1024?`${(l/1024).toFixed(1)} KB`:`${(l/(1024*1024)).toFixed(1)} MB`});function N(){I.info("EXPORT_DEBUG: ExportModal initializeFieldSelection with allFields",T.value.length),T.value.forEach(G=>{r.value[G]=!1}),v.forEach(G=>{r.value[G]=!0});const k=g.value.map(G=>G.id),l=_.value.map(G=>G.id);k.forEach(G=>{r.value[G]=!0}),l.forEach(G=>{r.value[G]=!0}),I.info("EXPORT_DEBUG: ExportModal default selection includes",{standardDefaults:v.length,parameterDefaults:k.length,variableDefaults:l.length,totalDefaults:v.length+k.length+l.length}),j()}function j(){o.value=T.value.filter(k=>r.value[k])}function R(k,l){r.value[k]=l,j()}function $(){T.value.forEach(k=>{r.value[k]=!0}),j()}function O(){T.value.forEach(G=>{r.value[G]=!1}),v.forEach(G=>{r.value[G]=!0});const k=g.value.map(G=>G.id),l=_.value.map(G=>G.id);k.forEach(G=>{r.value[G]=!0}),l.forEach(G=>{r.value[G]=!0}),j()}function h(){T.value.forEach(k=>{r.value[k]=!1}),j()}function f(){a("update:visible",!1)}async function L(){if(n.value==="bundle"){d.value=!0;try{const{trialBundleExportService:k}=await He(async()=>{const{trialBundleExportService:Y}=await import("./trial-bundle.service-qdj7kZ7W.js");return{trialBundleExportService:Y}},__vite__mapDeps([0,1,2,3,4,5,6,7])),l=p.value==="completed",G=await k.exportTrialBundle(t.trial.id,{includeResults:l,includeApiCalls:l,format:"json"});G.ok?(ue.success(`Trial bundle exported: ${G.value.filename}`),a("update:visible",!1)):ue.error(`Bundle export failed: ${G.error.message}`)}catch(k){ue.error(`Bundle export failed: ${k instanceof Error?k.message:"Unknown error"}`)}finally{d.value=!1}return}if(o.value.length===0){ue.warning("Please select at least one field to export");return}d.value=!0;try{const k={format:n.value,fields:o.value,includeHeaders:!0,addBOM:n.value==="excel"||n.value==="csv"},l=await It.exportTrialData(t.trial.id,k);l.ok?(k.format==="excel"&&typeof l.value.data=="string"?await Xe.downloadExcelFile(l.value.data,l.value.metadata.trialName):await Xe.downloadFile(l.value.data,k.format,l.value.metadata.trialName,k.addBOM),ue.success("Export completed successfully"),a("update:visible",!1)):ue.error(`Export failed: ${l.error.message}`)}catch(k){ue.error("Export failed: "+k.message)}finally{d.value=!1}}return Fe(async()=>{I.info("EXPORT_DEBUG: ExportModal discovering available fields for trial",t.trial.id);const k=await It.getAvailableFields(t.trial.id);if(k.ok){c.value=k.value.standardFields,g.value=k.value.parameterFields,_.value=(k.value.variableFields||[]).filter(A=>!A.id.startsWith("source_"));const l=k.value.standardFields.map(A=>A.id),G=k.value.parameterFields.map(A=>A.id),Y=_.value.map(A=>A.id);T.value=[...l,...G,...Y],I.info("EXPORT_DEBUG: ExportModal discovered fields",{standardFields:k.value.standardFields.length,parameterFields:k.value.parameterFields.length,variableFields:(k.value.variableFields||[]).length,totalFields:T.value.length,parameterFieldNames:k.value.parameterFields.map(A=>A.id),variableFieldNames:(k.value.variableFields||[]).map(A=>A.id),allFieldNames:T.value})}else I.info("EXPORT_DEBUG: ExportModal field discovery failed",k.error),T.value=[...C];N()}),(k,l)=>{const G=fa,Y=Pt,A=At,X=xe,S=ps,F=Me;return u(),ee(F,{visible:k.visible,"onUpdate:visible":l[46]||(l[46]=P=>k.$emit("update:visible",P)),title:"Export Trial Data",width:800,footer:null,"destroy-on-close":!0,class:"export-data-modal"},{default:x(()=>[s("div",ep,[s("div",tp,[l[53]||(l[53]=s("h4",null,"Export Format",-1)),w(Y,{value:n.value,"onUpdate:value":l[0]||(l[0]=P=>n.value=P),class:"format-options"},{default:x(()=>[w(G,{value:"csv"},{default:x(()=>l[47]||(l[47]=[D("CSV")])),_:1,__:[47]}),w(G,{value:"tsv"},{default:x(()=>l[48]||(l[48]=[D("TSV")])),_:1,__:[48]}),w(G,{value:"excel"},{default:x(()=>l[49]||(l[49]=[D("Excel")])),_:1,__:[49]}),w(G,{value:"json"},{default:x(()=>l[50]||(l[50]=[D("JSON")])),_:1,__:[50]}),w(G,{value:"jsonl"},{default:x(()=>l[51]||(l[51]=[D("JSONL")])),_:1,__:[51]}),w(G,{value:"bundle"},{default:x(()=>l[52]||(l[52]=[D("Auditomatic Trial Format")])),_:1,__:[52]})]),_:1},8,["value"])]),n.value==="bundle"?(u(),m("div",sp,[l[64]||(l[64]=s("h4",null,"Auditomatic Trial Format",-1)),s("div",ap,[l[61]||(l[61]=s("p",{style:{"margin-bottom":"16px",color:"var(--color-text-secondary)"}}," Export your trial in Auditomatic's native format to recreate the exact trial on another browser or computer. Perfect for sharing experiments with collaborators or backing up your work. ",-1)),w(Y,{value:p.value,"onUpdate:value":l[1]||(l[1]=P=>p.value=P),style:{"margin-bottom":"16px"}},{default:x(()=>[w(A,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:x(()=>l[54]||(l[54]=[s("strong",null,"Export as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Trial configuration only - recreate the trial setup and run a fresh experiment ",-1)])),_:1,__:[54]}),w(A,{value:"completed",style:{display:"block"}},{default:x(()=>l[55]||(l[55]=[s("strong",null,"Export with Results",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Complete trial with all execution results - review past experiments or continue where you left off ",-1)])),_:1,__:[55]})]),_:1},8,["value"]),l[62]||(l[62]=s("p",null,"The exported file contains:",-1)),s("ul",null,[l[56]||(l[56]=s("li",null,"âœ… Complete trial configuration",-1)),l[57]||(l[57]=s("li",null,"âœ… Template with metadata",-1)),l[58]||(l[58]=s("li",null,"âœ… All variable lists",-1)),l[59]||(l[59]=s("li",null,"âœ… Model configurations",-1)),p.value==="completed"?(u(),m("li",np,"âœ… Execution results and API calls")):E("",!0),l[60]||(l[60]=s("li",null,"âœ… Variable index tracking for lineage",-1))]),l[63]||(l[63]=s("p",{style:{"margin-top":"12px"}},[s("strong",null,"To import:"),D(' Use the "Import Trial" button on the Trials page to load this file on any Auditomatic instance. ')],-1))])])):(u(),m("div",op,[l[97]||(l[97]=s("h4",null,"Fields to Export",-1)),s("div",lp,[w(X,{size:"small",onClick:$},{default:x(()=>l[65]||(l[65]=[D("Select All")])),_:1,__:[65]}),w(X,{size:"small",onClick:O},{default:x(()=>l[66]||(l[66]=[D("Select Defaults")])),_:1,__:[66]}),w(X,{size:"small",onClick:h},{default:x(()=>l[67]||(l[67]=[D("Clear All")])),_:1,__:[67]})]),s("div",ip,[s("div",rp,[l[73]||(l[73]=s("h5",null,"Basic Information",-1)),s("div",up,[w(S,{checked:r.value.id,"onUpdate:checked":l[2]||(l[2]=P=>r.value.id=P),onChange:l[3]||(l[3]=P=>R("id",P.target.checked))},{default:x(()=>l[68]||(l[68]=[D("Call ID")])),_:1,__:[68]},8,["checked"]),w(S,{checked:r.value.order,"onUpdate:checked":l[4]||(l[4]=P=>r.value.order=P),onChange:l[5]||(l[5]=P=>R("order",P.target.checked))},{default:x(()=>l[69]||(l[69]=[D("Order")])),_:1,__:[69]},8,["checked"]),w(S,{checked:r.value.status,"onUpdate:checked":l[6]||(l[6]=P=>r.value.status=P),onChange:l[7]||(l[7]=P=>R("status",P.target.checked))},{default:x(()=>l[70]||(l[70]=[D("Status")])),_:1,__:[70]},8,["checked"]),w(S,{checked:r.value.created,"onUpdate:checked":l[8]||(l[8]=P=>r.value.created=P),onChange:l[9]||(l[9]=P=>R("created",P.target.checked))},{default:x(()=>l[71]||(l[71]=[D("Created Time")])),_:1,__:[71]},8,["checked"]),w(S,{checked:r.value.completed,"onUpdate:checked":l[10]||(l[10]=P=>r.value.completed=P),onChange:l[11]||(l[11]=P=>R("completed",P.target.checked))},{default:x(()=>l[72]||(l[72]=[D("Completed Time")])),_:1,__:[72]},8,["checked"])])]),s("div",dp,[l[78]||(l[78]=s("h5",null,"Configuration",-1)),s("div",cp,[w(S,{checked:r.value.configuration,"onUpdate:checked":l[12]||(l[12]=P=>r.value.configuration=P),onChange:l[13]||(l[13]=P=>R("configuration",P.target.checked))},{default:x(()=>l[74]||(l[74]=[D("Configuration Name")])),_:1,__:[74]},8,["checked"]),w(S,{checked:r.value.provider,"onUpdate:checked":l[14]||(l[14]=P=>r.value.provider=P),onChange:l[15]||(l[15]=P=>R("provider",P.target.checked))},{default:x(()=>l[75]||(l[75]=[D("Provider")])),_:1,__:[75]},8,["checked"]),w(S,{checked:r.value.modelId,"onUpdate:checked":l[16]||(l[16]=P=>r.value.modelId=P),onChange:l[17]||(l[17]=P=>R("modelId",P.target.checked))},{default:x(()=>l[76]||(l[76]=[D("Model ID")])),_:1,__:[76]},8,["checked"]),w(S,{checked:r.value.parameters,"onUpdate:checked":l[18]||(l[18]=P=>r.value.parameters=P),onChange:l[19]||(l[19]=P=>R("parameters",P.target.checked))},{default:x(()=>l[77]||(l[77]=[D("Parameters (JSON Object)")])),_:1,__:[77]},8,["checked"])])]),s("div",pp,[l[83]||(l[83]=s("h5",null,"Content",-1)),s("div",fp,[w(S,{checked:r.value.prompt,"onUpdate:checked":l[20]||(l[20]=P=>r.value.prompt=P),onChange:l[21]||(l[21]=P=>R("prompt",P.target.checked))},{default:x(()=>l[79]||(l[79]=[D("Prompt")])),_:1,__:[79]},8,["checked"]),w(S,{checked:r.value.variables,"onUpdate:checked":l[22]||(l[22]=P=>r.value.variables=P),onChange:l[23]||(l[23]=P=>R("variables",P.target.checked))},{default:x(()=>l[80]||(l[80]=[D("Variables (JSON Object)")])),_:1,__:[80]},8,["checked"]),w(S,{checked:r.value.response,"onUpdate:checked":l[24]||(l[24]=P=>r.value.response=P),onChange:l[25]||(l[25]=P=>R("response",P.target.checked))},{default:x(()=>l[81]||(l[81]=[D("Response")])),_:1,__:[81]},8,["checked"]),w(S,{checked:r.value.parsedResponse,"onUpdate:checked":l[26]||(l[26]=P=>r.value.parsedResponse=P),onChange:l[27]||(l[27]=P=>R("parsedResponse",P.target.checked))},{default:x(()=>l[82]||(l[82]=[D("Parsed Response")])),_:1,__:[82]},8,["checked"])])]),s("div",mp,[l[89]||(l[89]=s("h5",null,"Performance",-1)),s("div",vp,[w(S,{checked:r.value.latency,"onUpdate:checked":l[28]||(l[28]=P=>r.value.latency=P),onChange:l[29]||(l[29]=P=>R("latency",P.target.checked))},{default:x(()=>l[84]||(l[84]=[D("Latency (ms)")])),_:1,__:[84]},8,["checked"]),w(S,{checked:r.value.promptTokens,"onUpdate:checked":l[30]||(l[30]=P=>r.value.promptTokens=P),onChange:l[31]||(l[31]=P=>R("promptTokens",P.target.checked))},{default:x(()=>l[85]||(l[85]=[D("Prompt Tokens")])),_:1,__:[85]},8,["checked"]),w(S,{checked:r.value.completionTokens,"onUpdate:checked":l[32]||(l[32]=P=>r.value.completionTokens=P),onChange:l[33]||(l[33]=P=>R("completionTokens",P.target.checked))},{default:x(()=>l[86]||(l[86]=[D("Completion Tokens")])),_:1,__:[86]},8,["checked"]),w(S,{checked:r.value.totalTokens,"onUpdate:checked":l[34]||(l[34]=P=>r.value.totalTokens=P),onChange:l[35]||(l[35]=P=>R("totalTokens",P.target.checked))},{default:x(()=>l[87]||(l[87]=[D("Total Tokens")])),_:1,__:[87]},8,["checked"]),w(S,{checked:r.value.cost,"onUpdate:checked":l[36]||(l[36]=P=>r.value.cost=P),onChange:l[37]||(l[37]=P=>R("cost",P.target.checked))},{default:x(()=>l[88]||(l[88]=[D("Cost (USD)")])),_:1,__:[88]},8,["checked"])])]),s("div",gp,[l[94]||(l[94]=s("h5",null,"Technical Details",-1)),s("div",hp,[w(S,{checked:r.value.request,"onUpdate:checked":l[38]||(l[38]=P=>r.value.request=P),onChange:l[39]||(l[39]=P=>R("request",P.target.checked))},{default:x(()=>l[90]||(l[90]=[D("Full Request")])),_:1,__:[90]},8,["checked"]),w(S,{checked:r.value.response_raw,"onUpdate:checked":l[40]||(l[40]=P=>r.value.response_raw=P),onChange:l[41]||(l[41]=P=>R("response_raw",P.target.checked))},{default:x(()=>l[91]||(l[91]=[D("Raw Response")])),_:1,__:[91]},8,["checked"]),w(S,{checked:r.value.error,"onUpdate:checked":l[42]||(l[42]=P=>r.value.error=P),onChange:l[43]||(l[43]=P=>R("error",P.target.checked))},{default:x(()=>l[92]||(l[92]=[D("Error Details")])),_:1,__:[92]},8,["checked"]),w(S,{checked:r.value.repeatIndex,"onUpdate:checked":l[44]||(l[44]=P=>r.value.repeatIndex=P),onChange:l[45]||(l[45]=P=>R("repeatIndex",P.target.checked))},{default:x(()=>l[93]||(l[93]=[D("Repeat Index")])),_:1,__:[93]},8,["checked"])])]),g.value.length>0?(u(),m("div",yp,[l[95]||(l[95]=s("h5",null,"Parameters (Individual Columns)",-1)),s("div",bp,[(u(!0),m(te,null,oe(g.value,P=>(u(),ee(S,{key:P.id,checked:r.value[P.id],"onUpdate:checked":le=>r.value[P.id]=le,onChange:le=>R(P.id,le.target.checked)},{default:x(()=>[D(y(P.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):E("",!0),_.value.length>0?(u(),m("div",_p,[l[96]||(l[96]=s("h5",null,"Attributes (Individual Columns)",-1)),s("div",Tp,[(u(!0),m(te,null,oe(_.value,P=>(u(),ee(S,{key:P.id,checked:r.value[P.id],"onUpdate:checked":le=>r.value[P.id]=le,onChange:le=>R(P.id,le.target.checked)},{default:x(()=>[D(y(P.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):E("",!0)])])),s("div",Cp,[l[101]||(l[101]=s("h4",null,"Export Preview",-1)),s("div",$p,[s("div",wp,[l[98]||(l[98]=s("span",{class:"label"},"Records:",-1)),s("span",kp,y(b.value),1)]),s("div",Sp,[l[99]||(l[99]=s("span",{class:"label"},"Fields:",-1)),s("span",Ip,y(o.value.length),1)]),s("div",Ep,[l[100]||(l[100]=s("span",{class:"label"},"Estimated Size:",-1)),s("span",Rp,y(V.value),1)])])]),s("div",Fp,[w(X,{onClick:f},{default:x(()=>l[102]||(l[102]=[D("Cancel")])),_:1,__:[102]}),w(X,{type:"primary",onClick:L,loading:d.value,disabled:o.value.length===0},{default:x(()=>[w(W(fs)),l[103]||(l[103]=D(" Export "))]),_:1,__:[103]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),Pp=ce(xp,[["__scopeId","data-v-f982f044"]]),Ap={class:"trial-details-panel"},Vp={key:0,class:"loading-state"},Op={key:1,class:"error-state"},Dp={class:"error-actions"},Lp=de({__name:"TrialDetailsPanelV3",props:{trial:{},isLeader:{type:Boolean},executionState:{},progress:{}},emits:["start-trial","pause-trial","resume-trial","cancel-trial","duplicate-trial","edit-trial","delete-trial","export-data","export-python"],setup(i){const e=i,t=it(),a=B(!1),n=B(null),o=B(!1),d=vs(),p=U(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial?.id);function r(){n.value=null}function c(){t.push("/trials")}function g(){o.value=!0}async function _(){if(e.trial){I.info(`REFRESH: Manually refreshing trial ${e.trial.id} data from database`);try{d.isActive&&d.currentTrialId===e.trial.id&&(I.info("REFRESH: Temporarily stopping active stream to reload data"),d.stopStreaming()),await d.loadHistoricalData(e.trial.id),I.info(`REFRESH: Successfully refreshed trial ${e.trial.id} data`),(e.trial.status==="running"||e.trial.status==="paused")&&(I.info("REFRESH: Restarting streaming for active trial"),await d.startStreaming(e.trial.id))}catch(v){I.error("REFRESH: Failed to refresh trial data:",v)}}}return re(()=>e.trial,(v,T)=>{v&&v.id!==T?.id&&(n.value=null,I.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 switching from ${T?.id} to ${v.id}`))}),Fe(()=>{const v=e.trial?.id;I.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 MOUNTED for trial ${v}`)}),Ke(()=>{const v=e.trial?.id;I.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 ACTIVATED (cache hit) for trial ${v}`)}),Ze(()=>{const v=e.trial?.id;I.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 DEACTIVATED (cached) for trial ${v}`)}),Le(()=>{const v=e.trial?.id;I.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 UNMOUNTED (evicted) for trial ${v}`)}),(v,T)=>{const C=xe;return u(),m("div",Ap,[a.value?(u(),m("div",Vp,[w(W(rs),{class:"loading-spinner",spin:""}),T[9]||(T[9]=s("span",null,"Loading trial details...",-1))])):n.value?(u(),m("div",Op,[w(W(Je),{class:"error-icon"}),T[12]||(T[12]=s("h3",null,"Failed to load trial",-1)),s("p",null,y(n.value),1),s("div",Dp,[w(C,{onClick:r},{default:x(()=>T[10]||(T[10]=[D("Retry")])),_:1,__:[10]}),w(C,{type:"link",onClick:c},{default:x(()=>T[11]||(T[11]=[D("Go Back")])),_:1,__:[11]})])])):v.trial?(u(),m(te,{key:2},[w(to,{trial:v.trial,progress:v.progress,"is-executing":p.value},null,8,["trial","progress","is-executing"]),w(io,{trial:v.trial,"is-leader":v.isLeader,"execution-state":v.executionState,onStart:T[0]||(T[0]=b=>v.$emit("start-trial")),onPause:T[1]||(T[1]=b=>v.$emit("pause-trial")),onResume:T[2]||(T[2]=b=>v.$emit("resume-trial")),onCancel:T[3]||(T[3]=b=>v.$emit("cancel-trial")),onDuplicate:T[4]||(T[4]=b=>v.$emit("duplicate-trial",v.trial.id)),onEdit:T[5]||(T[5]=b=>v.$emit("edit-trial",v.trial.id)),onDelete:T[6]||(T[6]=b=>v.$emit("delete-trial",v.trial.id)),onExportData:g,onExportPython:T[7]||(T[7]=b=>v.$emit("export-python",v.trial.id)),onRefresh:_},null,8,["trial","is-leader","execution-state"]),v.trial&&o.value?(u(),ee(Pp,{key:0,visible:o.value,trial:v.trial,"onUpdate:visible":T[8]||(T[8]=b=>o.value=!1)},null,8,["visible","trial"])):E("",!0),w(zc,{trial:v.trial,progress:v.progress,"is-leader":v.isLeader,"execution-state":v.executionState},null,8,["trial","progress","is-leader","execution-state"])],64)):E("",!0)])}}}),Np=ce(Lp,[["__scopeId","data-v-081db72e"]]),Mp={class:"import-content"},Up={class:"upload-section"},zp={class:"ant-upload-drag-icon"},Bp={key:0,class:"preview-section"},Wp={class:"bundle-details"},jp={class:"detail-row"},Hp={class:"value"},Gp={class:"detail-row"},qp={class:"value"},Jp={class:"detail-row"},Xp={class:"value"},Kp={class:"detail-row"},Zp={class:"value"},Yp={key:0,style:{color:"green","margin-left":"8px"}},Qp={key:1,style:{color:"orange","margin-left":"8px"}},ef={key:0,class:"detail-row"},tf={class:"value"},sf={class:"detail-row"},af={class:"value"},nf={class:"import-options"},of={key:0,style:{"margin-bottom":"12px"}},lf={key:1,style:{"margin-bottom":"12px",padding:"8px",background:"#f0f0f0","border-radius":"4px"}},rf={key:0,class:"warnings"},uf={class:"modal-actions"},df=de({__name:"ImportTrialDialog",props:{visible:{type:Boolean}},emits:["update:visible","trial-imported"],setup(i,{emit:e}){const t=i,a=e,n=it(),o=B([]),d=B(null),p=B(!1),r=B([]),c=B({mode:"draft",namePrefix:"Imported: "}),g=U({get:()=>t.visible,set:R=>a("update:visible",R)}),_=U(()=>d.value?.execution?.apiCalls&&d.value.execution.apiCalls.length>0);function v(R){return!1}async function T(R){const $=R.file.originFileObj||R.file;if($)try{const O=await C($),h=JSON.parse(O);r.value=b(h),d.value=h,h.execution?.apiCalls&&h.execution.apiCalls.length>0,c.value.mode="draft"}catch{ue.error("Failed to read bundle file: Invalid JSON format"),d.value=null}}function C(R){return new Promise(($,O)=>{const h=new FileReader;h.onload=f=>$(f.target?.result),h.onerror=O,h.readAsText(R)})}function b(R){const $=[];return R.version||$.push("Bundle version is missing"),R.configuration?.trial||$.push("Trial configuration is missing"),(!R.configuration?.variableLists||R.configuration.variableLists.length===0)&&$.push("No variable lists found in bundle"),R.version!=="1.0"&&$.push(`Bundle version ${R.version} may not be fully compatible`),$}function V(R){return new Date(R).toLocaleString()}function N(){o.value=[],d.value=null,r.value=[],g.value=!1}async function j(){if(!d.value){ue.error("No bundle to import");return}p.value=!0;try{const{trialBundleImportService:R}=await He(async()=>{const{trialBundleImportService:h}=await import("./trial-bundle.service-qdj7kZ7W.js");return{trialBundleImportService:h}},__vite__mapDeps([0,1,2,3,4,5,6,7])),$=_.value&&c.value.mode==="completed",O=await R.importTrialBundle(JSON.stringify(d.value),{importResults:$,importAsCompleted:$,namePrefix:c.value.namePrefix||void 0});O.ok?(ue.success("Trial imported successfully!"),n.push(`/trials?trialId=${O.value.trialId}`),a("trial-imported",O.value.trialId),N()):ue.error(`Import failed: ${O.error.message}`)}catch(R){ue.error(`Import failed: ${R instanceof Error?R.message:"Unknown error"}`)}finally{p.value=!1}}return(R,$)=>{const O=ma,h=At,f=Pt,L=cs,k=ut,l=xe,G=Me;return u(),ee(G,{visible:g.value,"onUpdate:visible":$[3]||($[3]=Y=>g.value=Y),title:"Import Trial Bundle",width:600,footer:null,"destroy-on-close":!0,class:"import-trial-modal"},{default:x(()=>[s("div",Mp,[s("div",Up,[w(O,{fileList:o.value,"onUpdate:fileList":$[0]||($[0]=Y=>o.value=Y),"before-upload":v,"max-count":1,accept:".json",onChange:T},{default:x(()=>[s("p",zp,[w(W(is))]),$[4]||($[4]=s("p",{class:"ant-upload-text"},"Click or drag trial bundle file here",-1)),$[5]||($[5]=s("p",{class:"ant-upload-hint"}," Supports .json files exported from trials ",-1))]),_:1,__:[4,5]},8,["fileList"])]),d.value?(u(),m("div",Bp,[$[17]||($[17]=s("h3",null,"Bundle Contents",-1)),s("div",Wp,[s("div",jp,[$[6]||($[6]=s("span",{class:"label"},"Trial Name:",-1)),s("span",Hp,y(d.value.metadata.trialName),1)]),s("div",Gp,[$[7]||($[7]=s("span",{class:"label"},"Export Date:",-1)),s("span",qp,y(V(d.value.metadata.exportDate)),1)]),s("div",Jp,[$[8]||($[8]=s("span",{class:"label"},"Status:",-1)),s("span",Xp,y(d.value.metadata.trialStatus),1)]),s("div",Kp,[$[9]||($[9]=s("span",{class:"label"},"API Calls:",-1)),s("span",Zp,[D(y(d.value.metadata.apiCallCount)+" ",1),_.value?(u(),m("span",Yp," (with results) ")):(u(),m("span",Qp," (configuration only) "))])]),d.value.configuration.template?(u(),m("div",ef,[$[10]||($[10]=s("span",{class:"label"},"Template:",-1)),s("span",tf,y(d.value.configuration.template.name),1)])):E("",!0),s("div",sf,[$[11]||($[11]=s("span",{class:"label"},"Variable Lists:",-1)),s("span",af,y(d.value.configuration.variableLists?.length||0),1)])]),s("div",nf,[$[16]||($[16]=s("h4",null,"Import Options",-1)),_.value?(u(),m("div",of,[w(f,{value:c.value.mode,"onUpdate:value":$[1]||($[1]=Y=>c.value.mode=Y),style:{display:"block"}},{default:x(()=>[w(h,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:x(()=>$[12]||($[12]=[s("strong",null,"Import as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Create fresh trial ready to run new experiment ",-1)])),_:1,__:[12]}),w(h,{value:"completed",style:{display:"block"}},{default:x(()=>$[13]||($[13]=[s("strong",null,"Import as Completed",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Preserve historical results for review/analysis ",-1)])),_:1,__:[13]})]),_:1},8,["value"])])):(u(),m("div",lf,$[14]||($[14]=[s("strong",null,"Draft Trial",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px"}}," This bundle contains configuration only - will import as draft ready to run ",-1)]))),w(L,{value:c.value.namePrefix,"onUpdate:value":$[2]||($[2]=Y=>c.value.namePrefix=Y),placeholder:"Name prefix (optional)",style:{"margin-top":"8px"}},{prefix:x(()=>$[15]||($[15]=[D("Name:")])),_:1},8,["value"])]),r.value.length>0?(u(),m("div",rf,[w(k,{message:"Import Warnings",type:"warning","show-icon":""},{description:x(()=>[s("ul",null,[(u(!0),m(te,null,oe(r.value,Y=>(u(),m("li",{key:Y},y(Y),1))),128))])]),_:1})])):E("",!0)])):E("",!0),s("div",uf,[w(l,{onClick:N},{default:x(()=>$[18]||($[18]=[D("Cancel")])),_:1,__:[18]}),w(l,{type:"primary",onClick:j,loading:p.value,disabled:!d.value},{default:x(()=>[w(W(ls)),$[19]||($[19]=D(" Import Trial "))]),_:1,__:[19]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),cf=ce(df,[["__scopeId","data-v-1d9366d6"]]),pf={class:"option-content"},ff={class:"option-header"},mf={class:"modal-footer"},vf=de({__name:"PythonExportModal",props:{visible:{type:Boolean},trialId:{}},emits:["update:visible"],setup(i,{emit:e}){const t=i,a=e,n=U({get:()=>t.visible,set:r=>a("update:visible",r)}),o=B("script-config-data"),d=B(!1);re(n,r=>{r&&(o.value="script-config-data",d.value=!1)});async function p(){if(o.value){d.value=!0;try{const{reproducibilityBundleService:r}=await He(async()=>{const{reproducibilityBundleService:g}=await import("./index-BXW77j_9.js");return{reproducibilityBundleService:g}},__vite__mapDeps([8,1,2,3,4,5,6,0,7,9,10,11,12,13,14,15,16,17,18,19])),c=await r.exportBundle(t.trialId,{bundleType:o.value,includeComments:!0});if(c.ok){const{tauriDownloadUtilities:g}=await He(async()=>{const{tauriDownloadUtilities:_}=await Promise.resolve().then(()=>ju);return{tauriDownloadUtilities:_}},void 0);if(o.value==="script-only"){const _=await c.value.zipBlob.text();await g.downloadFile(_,"python",c.value.filename.replace(".zip",""),!1),ue.success("Python script downloaded successfully")}else{const _=await c.value.zipBlob.arrayBuffer(),v=new Uint8Array(_);await g.downloadFile(v,"zip",c.value.filename.replace(".zip",""),!1);const T=o.value==="script-config-data"?"Complete archive bundle":"Reproducibility bundle";ue.success(`${T} downloaded successfully`)}n.value=!1}else throw new Error(c.error?.message||"Export failed")}catch(r){I.error("Export failed:",r),ue.error(`Failed to export: ${r instanceof Error?r.message:"Unknown error"}`)}finally{d.value=!1}}}return(r,c)=>{const g=At,_=rt,v=Pt,T=xe,C=Me;return u(),ee(C,{visible:n.value,"onUpdate:visible":c[1]||(c[1]=b=>n.value=b),title:"Export for Reproducibility",width:600,footer:null,"destroy-on-close":!0},{default:x(()=>[c[10]||(c[10]=s("p",{class:"export-description"}," Choose your export format: ",-1)),w(v,{value:o.value,"onUpdate:value":c[0]||(c[0]=b=>o.value=b),class:"export-options"},{default:x(()=>[w(g,{value:"script-only",class:"export-option"},{default:x(()=>c[2]||(c[2]=[s("div",{class:"option-content"},[s("div",{class:"option-header"},[s("span",{class:"option-icon"},"ðŸ“„"),s("strong",{class:"option-title"},"Python Script Only")]),s("div",{class:"option-description"}," Minimal Python script (~200-400 lines) with clear experimental design. "),s("div",{class:"option-files"},"â€¢ experiment.py")],-1)])),_:1,__:[2]}),w(g,{value:"script-config",class:"export-option"},{default:x(()=>c[3]||(c[3]=[s("div",{class:"option-content"},[s("div",{class:"option-header"},[s("span",{class:"option-icon"},"ðŸ“¦"),s("strong",{class:"option-title"},"Reproducibility Bundle")]),s("div",{class:"option-description"}," Python script + complete trial configuration. "),s("div",{class:"option-files"}," â€¢ experiment.py â€¢ trial_config.json â€¢ README.md ")],-1)])),_:1,__:[3]}),w(g,{value:"script-config-data",class:"export-option recommended"},{default:x(()=>[s("div",pf,[s("div",ff,[c[5]||(c[5]=s("span",{class:"option-icon"},"ðŸ—‚ï¸",-1)),c[6]||(c[6]=s("strong",{class:"option-title"},"Complete Archive Bundle",-1)),w(_,{color:"green",style:{"margin-left":"8px"}},{default:x(()=>c[4]||(c[4]=[D("Recommended")])),_:1,__:[4]})]),c[7]||(c[7]=s("div",{class:"option-description"}," Everything: Python script + configuration + all experimental results. ",-1)),c[8]||(c[8]=s("div",{class:"option-files"}," â€¢ experiment.py â€¢ trial_config.json â€¢ data/results.{csv,xlsx,jsonl} â€¢ README.md ",-1))])]),_:1})]),_:1},8,["value"]),s("div",mf,[w(T,{type:"primary",size:"large",disabled:!o.value,loading:d.value,onClick:p},{default:x(()=>[w(W(fs)),c[9]||(c[9]=D(" Download "))]),_:1,__:[9]},8,["disabled","loading"])])]),_:1,__:[10]},8,["visible"])}}}),gf=ce(vf,[["__scopeId","data-v-6cec199d"]]),hf={class:"trials-view-v3"},yf={key:0,class:"provider-warning-banner"},bf={class:"banner-content"},_f={key:1,class:"observer-mode-banner"},Tf={class:"banner-content"},Cf={key:1,class:"loading-left-pane"},$f={key:0,class:"no-selection"},wf={key:0,class:"observer-note"},kf=de({__name:"TrialsViewV3",setup(i){const e=$a(),{trials:t}=ya(),{enabledModels:a,loading:n}=wa(),{duplicateTrial:o,deleteTrial:d}=ba(),p=vs(),r=as(),c=it(),g=B(),_=B(!0),v=B(null),T=B(""),C=B("all"),b=B(-1),V=B(!1),N=B(!1),j=B(!1),R=U(()=>a.value.length>0),$=U(()=>!n.value&&!R.value&&!j.value),O=e.isLeader,h=e.execution,{trial:f}=_a(v),L=U(()=>{const z=f.value?.progress;return z?{trialId:v.value||"",...z,lastUpdated:new Date}:null}),k=U(()=>{let z=t.value;if(T.value){const q=T.value.toLowerCase();z=z.filter(ae=>{const Ve=ae.name.toLowerCase().includes(q),Pe=ae.templateConfig?.template?.toLowerCase().includes(q),Te=ae.configurations.some(M=>M.modelId.toLowerCase().includes(q)||M.provider.toLowerCase().includes(q));return Ve||Pe||Te})}return C.value!=="all"&&(z=z.filter(q=>q.status===C.value)),z});async function l(){const z=r.query;if(z.duplicate){const q=z.duplicate,ae=await o(q);ae.ok?await c.push({path:"/trials/create",query:{duplicate:ae.value,edit:z.edit==="true"?"true":void 0}}):Ee.error(`Failed to duplicate trial: ${ae.error?.message||"Unknown error"}`),await c.replace({query:{}});return}if(z.designId||z.promptSource){await c.push({path:"/trials/create",query:z});return}if(r.query.trialId){const q=r.query.trialId;Y(q)}}function G(){if(v.value)return;if(t.value.length===0){I.info("V4_TRIALS: No trials available for auto-selection");return}const z=t.value.find(q=>q.status==="running");if(z){Y(z.id);return}Y(t.value[0].id)}async function Y(z){const q=performance.now();I.info(`V4_TRIAL_SWITCH: Starting trial selection: ${z}`),v.value=z;const ae=performance.now();if(I.info(`V4_TRIAL_SWITCH: UI updated in ${(ae-q).toFixed(1)}ms`),t.value.length>0){const Te=k.value.findIndex(M=>M.id===z);Te>=0&&(b.value=Te)}const Ve=performance.now();if(I.info(`V4_TRIAL_SWITCH: Starting stream manager for trial ${z} at ${(Ve-q).toFixed(1)}ms`),p.startStreaming(z).catch(Te=>{I.error(`V4_TRIAL_SWITCH: Failed to start streaming for trial ${z}`,Te)}),r.query.trialId!==z){const Te={...r.query};Te.trialId=z,Te.tab||(Te.tab="status"),c.push({path:"/trials",query:Te}),I.info(`V4_TRIAL_SWITCH: URL updated to preserve tab '${Te.tab}' at ${(performance.now()-q).toFixed(1)}ms`)}g.value&&g.value.closeMobileOverlay();const Pe=performance.now();I.info(`V4_TRIAL_SWITCH: selectTrial() completed in ${(Pe-q).toFixed(1)}ms`)}function A(z){T.value=z,b.value=-1}function X(z){C.value=z,b.value=-1}async function S(){Ee.info("Refreshing trial list...")}function F(z){const q=k.value;if(q.length!==0){if((z.metaKey||z.ctrlKey)&&z.key==="k"){z.preventDefault(),window.dispatchEvent(new CustomEvent("focus-trial-search"));return}(z.key==="j"||z.key==="ArrowDown")&&(z.preventDefault(),b.value=Math.min(b.value+1,q.length-1),b.value>=0&&(Y(q[b.value].id),P(q[b.value].id))),(z.key==="k"||z.key==="ArrowUp")&&(z.preventDefault(),b.value=Math.max(b.value-1,0),Y(q[b.value].id),P(q[b.value].id)),z.key==="Enter"&&v.value,z.key==="Escape"&&(T.value="",v.value=null,b.value=-1)}}function P(z){ze(()=>{const q=document.querySelector(`[data-trial-id="${z}"]`);q&&q.scrollIntoView({behavior:"smooth",block:"nearest"})})}function le(z){I.debug("Trial list panel resized",{width:z})}function be(z){I.debug("Mobile overlay changed",{visible:z})}function ve(){j.value=!0}async function ge(){await c.push("/trials/create")}function me(){N.value=!0}function ye(z){S(),Y(z)}async function Se(){if(v.value){if(V.value){I.info("Start trial already in progress, ignoring duplicate request");return}V.value=!0,I.info("V4_EXECUTION:",e.execution?.value),I.info("V4_STATUS:",e.execution?.value?.status);try{I.info("V4: Starting trial with streaming",v.value);const z=await e.startTrialWithStreaming(v.value);if(!z.ok){Ee.error(z.error?.message||"Unknown error");return}I.info("V4_STREAMING: Restarting stream manager after trial start"),await p.startStreaming(v.value),I.info("V4: Trial started with streaming, stream manager connected");const q={...r.query};q.tab="tasks",c.replace({query:q})}finally{V.value=!1}}}async function Ue(){I.info(`PAUSE_RESUME_BUG: UI pauseTrial() called for trial: ${v.value}`),I.info(`V4_TRIAL_DEBUG_PAUSE: UI pauseTrial() called for trial: ${v.value}`),I.info(`V4_TRIAL_DEBUG_PAUSE: Current execution state: ${e.execution.value.status}`),I.info(`V4_TRIAL_DEBUG_PAUSE: Is leader: ${e.isLeader.value}`),I.info("PAUSE_RESUME_BUG: UI calling v4ExecutionControl.pauseExecution()");const z=await e.pauseExecution();I.info("PAUSE_RESUME_BUG: UI pauseTrial result:",z?.ok?"SUCCESS":"FAILED"),I.info("V4_TRIAL_DEBUG_PAUSE: UI pauseTrial result:",z),z.ok?I.info(`V4_TRIAL_DEBUG_PAUSE: Pause successful, execution state: ${e.execution.value.status}`):(I.info("V4_TRIAL_DEBUG_PAUSE: Pause failed from UI:",z.error.message),Ee.error(z.error?.message||"Unknown error"))}async function Ae(){if(!v.value)return;I.info(`PAUSE_RESUME_BUG: UI resumeTrial() called for trial: ${v.value}`),I.info(`V4_TRIAL_DEBUG_RESUME: UI resumeTrial() called for trial: ${v.value}`),I.info(`V4_TRIAL_DEBUG_RESUME: Current execution state: ${e.execution.value.status}`),I.info(`V4_TRIAL_DEBUG_RESUME: Is leader: ${e.isLeader.value}`);const z=e.execution.value?.status||"idle";I.info(`V4_TRIAL_DEBUG_RESUME: Current execution status: ${z}`);const q=e.execution.value?.currentTrialId;if(z==="paused"&&q===v.value){I.info(`V4_TRIAL_DEBUG_RESUME: Execution is paused for THIS trial (${v.value}), using resumeExecution()`);const ae=await e.resumeExecution(v.value);I.info("V4_TRIAL_DEBUG_RESUME: resumeExecution result:",ae),ae.ok?(I.info("V4_TRIAL_DEBUG_RESUME: Resume successful - existing pipeline will continue automatically via pause$ = false"),I.info("V4_TRIAL_DEBUG_RESUME: Resume complete - existing V3 pipeline should continue processing pending calls")):(I.info("V4_TRIAL_DEBUG_RESUME: Resume failed:",ae.error.message),Ee.error(ae.error.message))}else{I.info("V4_TRIAL_DEBUG_RESUME: No paused execution found, using startTrialWithStreaming (fresh start)");const ae=await e.startTrialWithStreaming(v.value);I.info("V4_TRIAL_DEBUG_RESUME: startTrialWithStreaming result for fresh start:",ae),ae.ok?(I.info("V4_TRIAL_DEBUG_RESUME: Fresh start successful, starting stream manager"),await p.startStreaming(v.value),I.info("V4_TRIAL_DEBUG_RESUME: Stream manager started for fresh execution")):(I.info("V4_TRIAL_DEBUG_RESUME: Fresh start failed:",ae.error.message),Ee.error(ae.error?.message||"Unknown error"))}}async function Ge(){const z=await e.cancelExecution();z.ok||Ee.error(z.error?.message||"Unknown error")}async function H(z){const q=await o(z);q.ok?(Ee.success("Trial duplicated"),q.value&&Y(q.value)):Ee.error(q.error?.message||"Unknown error")}async function Z(z){await c.push({path:"/trials/create",query:{duplicate:z,edit:"true"}})}async function ie(z){const q=await d(z);q.ok?(Ee.success("Trial deleted"),v.value===z&&(v.value=null)):Ee.error(q.error?.message||"Unknown error")}async function Q(z,q){const ae=await It.exportTrialData(z,{format:q,fields:void 0,includeHeaders:!0,addBOM:q==="excel"||q==="csv"});ae.ok?(await Xe.downloadFile(ae.value.data,q,ae.value.metadata.trialName,q==="excel"||q==="csv"),Ee.success(`Exported ${ae.value.recordCount} API calls to ${ae.value.filename}`)):Ee.error(ae.error?.message||"Unknown error")}const pe=B(!1),_e=B("");function Re(z){_e.value=z,pe.value=!0}return re(()=>r.query.trialId,z=>{z&&z!==v.value&&Y(z)}),re(_,(z,q)=>{const ae=performance.now();I.info(`V4_TRIAL_SWITCH: isLoadingInitial changed from ${q} to ${z} at ${ae}`),z||I.info("V4_TRIAL_SWITCH: Both panes should now be VISIBLE (no longer loading initial)")},{immediate:!0}),re(t,(z,q)=>{const ae=performance.now();I.info(`V4_TRIAL_SWITCH: trials array changed from ${q?.length||0} to ${z.length} trials at ${ae}`)},{immediate:!0}),Fe(async()=>{const z=performance.now();I.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() ENTRY at ${z}`);const q=performance.now();I.info(`V4_TRIAL_SWITCH: Starting V4 execution system initialization at ${(q-z).toFixed(1)}ms`);try{await e.initialize();const Ie=performance.now();I.info(`V4_TRIAL_SWITCH: V4 execution system initialized in ${(Ie-q).toFixed(1)}ms`)}catch(Ie){const $s=performance.now();I.error(`V4_TRIAL_SWITCH: V4 initialization failed in ${($s-q).toFixed(1)}ms:`,Ie)}const ae=performance.now();window.addEventListener("keydown",F),I.info(`V4_TRIAL_SWITCH: Keyboard listener added in ${(ae-z).toFixed(1)}ms`);const Ve=performance.now();I.info(`V4_TRIAL_SWITCH: Starting nextTick wait at ${(Ve-z).toFixed(1)}ms`),await ze();const Pe=performance.now();I.info(`V4_TRIAL_SWITCH: nextTick completed in ${(Pe-Ve).toFixed(1)}ms`);const Te=performance.now();_.value=!1,I.info(`V4_TRIAL_SWITCH: isLoadingInitial set to false at ${(Te-z).toFixed(1)}ms`);const M=performance.now();I.info(`V4_TRIAL_SWITCH: Starting URL parameter processing at ${(M-z).toFixed(1)}ms`),await l();const J=performance.now();I.info(`V4_TRIAL_SWITCH: URL parameter processing completed in ${(J-M).toFixed(1)}ms`);const K=performance.now();I.info(`V4_TRIAL_SWITCH: Starting auto-selection at ${(K-z).toFixed(1)}ms`),G();const se=performance.now();I.info(`V4_TRIAL_SWITCH: Auto-selection completed in ${(se-K).toFixed(1)}ms`);const he=performance.now();I.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() TOTAL: ${(he-z).toFixed(1)}ms`)}),Le(()=>{I.info("V4_SINGLETON_DEBUG: TrialsViewV3 onUnmounted() - NOT calling v4ExecutionControl.cleanup() to preserve singleton"),window.removeEventListener("keydown",F),p.destroy(),I.info("V4_SINGLETON_DEBUG: V4 execution system preserved, initialized flag should remain true")}),(z,q)=>{const ae=Qt("router-link"),Ve=xe;return u(),m("div",hf,[$.value?(u(),m("div",yf,[s("div",bf,[w(W(Je),{class:"warning-icon"}),q[3]||(q[3]=s("span",null,"No LLM providers configured. Please add API keys in Settings to run trials.",-1)),w(ae,{to:"/settings",class:"settings-link"},{default:x(()=>q[2]||(q[2]=[D("Go to Settings")])),_:1,__:[2]}),w(W(os),{class:"close-icon",onClick:ve})]),q[4]||(q[4]=s("div",{class:"banner-note"},"Note: Ollama doesn't require API keys",-1))])):E("",!0),W(O)?E("",!0):(u(),m("div",_f,[s("div",Tf,[w(W(ds),{class:"observer-icon"}),q[5]||(q[5]=s("span",null,[s("strong",null,"Observer Mode: Multiple Tabs Detected")],-1)),q[6]||(q[6]=s("div",{class:"leader-hint"}," You can only open one Auditomatic tab at a time. Close other tabs, or refresh if this is your only tab. Your templates and trials are safely saved. ",-1))])])),w(Ia,{ref_key:"splitPanel",ref:g,"storage-key":"trial-list-width","default-width":250,"min-width":200,"max-width":600,onResize:le,onMobileOverlayChange:be},{left:x(()=>[_.value?(u(),m("div",Cf," Loading trials... ")):(u(),ee(Mn,{key:0,trials:W(t),"selected-trial-id":v.value,"search-query":T.value,"filter-status":C.value,onSelectTrial:Y,onCreateTrial:ge,onImportTrial:me,onUpdateSearch:A,onUpdateFilter:X,onRefresh:S},null,8,["trials","selected-trial-id","search-query","filter-status"]))]),right:x(()=>[(u(),ee(yt,{max:5},[v.value?(u(),ee(Np,{key:v.value,trial:W(f),"is-leader":W(O),"execution-state":W(h),progress:L.value,onStartTrial:Se,onPauseTrial:Ue,onResumeTrial:Ae,onCancelTrial:Ge,onDuplicateTrial:H,onEditTrial:Z,onDeleteTrial:ie,onExportData:Q,onExportPython:Re},null,8,["trial","is-leader","execution-state","progress"])):E("",!0)],1024)),!v.value||!W(f)?je((u(),m("div",$f,[w(W(va),{class:"empty-icon"}),q[8]||(q[8]=s("h3",null,"Select a trial to view details",-1)),q[9]||(q[9]=s("p",null,"Choose from the list or create a new one",-1)),w(Ve,{type:"primary",size:"large",disabled:!W(O),onClick:ge},{default:x(()=>q[7]||(q[7]=[D(" Create New Trial ")])),_:1,__:[7]},8,["disabled"]),W(O)?E("",!0):(u(),m("div",wf," Close other tabs to enable trial creation "))],512)),[[ss,!_.value]]):E("",!0)]),_:1},512),w(cf,{visible:N.value,"onUpdate:visible":q[0]||(q[0]=Pe=>N.value=Pe),onTrialImported:ye},null,8,["visible"]),w(gf,{visible:pe.value,"onUpdate:visible":q[1]||(q[1]=Pe=>pe.value=Pe),"trial-id":_e.value},null,8,["visible","trial-id"])])}}}),Sf=ce(kf,[["__scopeId","data-v-f6a9d9db"]]),Bf=Object.freeze(Object.defineProperty({__proto__:null,default:Sf},Symbol.toStringTag,{value:"Module"}));export{ke as E,Bf as T,It as d,Zt as g,tt as t};
