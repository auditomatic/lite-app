import{h as X,u as de,a as ie}from"./index-Bva3c6Vs.js";import{d as Z,f as E,c as U,w as G,R as d,Y as o,S as a,a0 as ce,n as Y,q as ve,a3 as pe,y as ze,_ as I,k as g,V as b,F as A,W as D,a2 as te,Z as y,G as R,$ as K,a4 as ne,B as De,b as Oe,u as H,a1 as Ke,o as qe,X as He}from"./vue-vendor-Cg89ltm_.js";import{u as Ge}from"./useV4Templates-UkzoAPxx.js";import{u as Ye}from"./useV4TemplateCommands-BjILZiGC.js";import{a as Xe}from"./useV4VariableLists-DFe4bMp_.js";import{m as Q,am as Ze,Y as Je,an as me,M as fe,r as ge,G as be,o as Qe,L as et,p as tt,q as at,t as lt,I as st,y as it,s as nt,K as ot,k as oe}from"./ui-vendor-COTxn_WH.js";import{P as rt}from"./ParserSelector-D1ib8GrU.js";import"./utils-vendor-BXgHPvEJ.js";import"./data-vendor-lJS7wsn4.js";import"./useV4LiveQuery-BFmmrRUn.js";import"./parser.store-DHhq7MF7.js";const ut={class:"template-editor"},dt=["placeholder","rows","data-testid","aria-label"],ct=Z({__name:"TemplateEditorV3C",props:{modelValue:{},label:{},placeholder:{default:"Enter your prompt template..."},required:{type:Boolean},rows:{default:4},variables:{default:()=>[]},variableColors:{default:()=>({})}},emits:["update:modelValue"],setup(O,{expose:N,emit:p}){const F=O,P=p,m=E(),$=E(),B=E(!1),S=U({get:()=>F.modelValue,set:u=>P("update:modelValue",u)}),T=U(()=>{let u=i(S.value);return u=u.replace(/\{\{(\w+)\}\}/g,(f,s)=>{const n=/^\w+$/.test(s),w=F.variableColors[s];return n&&w?`<span class="variable-highlight" style="background-color: ${w.bg}; box-shadow: 0 0 0 1px ${w.bg};">${i(f)}</span>`:n?`<span class="variable-highlight">${i(f)}</span>`:`<span class="variable-error">${i(f)}</span>`}),u=u.replace(/\n/g,"<br>"),u=u.replace(/  /g," &nbsp;"),u.endsWith("<br>")||(u+="<br>"),u});function i(u){const f=document.createElement("div");return f.textContent=u,f.innerHTML}function h(){!m.value||!$.value||($.value.scrollTop=m.value.scrollTop,$.value.scrollLeft=m.value.scrollLeft)}return G(S,async()=>{await ze(),h()}),N({focus:()=>m.value?.focus()}),(u,f)=>{const s=ve("dompurify-html");return o(),d("div",ut,[a("div",{class:ce(["editor-container",{focused:B.value}])},[Y(a("div",{ref_key:"highlightRef",ref:$,class:"editor-highlight","aria-hidden":"true"},null,512),[[s,T.value,"template"]]),Y(a("textarea",{ref_key:"textareaRef",ref:m,"onUpdate:modelValue":f[0]||(f[0]=n=>S.value=n),class:"editor-textarea",placeholder:u.placeholder,rows:u.rows,"data-testid":u.$attrs["data-testid"]||"textarea-template-editor","aria-label":u.$attrs["aria-label"]||"Template editor textarea",onFocus:f[1]||(f[1]=n=>B.value=!0),onBlur:f[2]||(f[2]=n=>B.value=!1),onScroll:h},null,40,dt),[[pe,S.value]])],2)])}}}),vt=X(ct,[["__scopeId","data-v-da627e6e"]]),pt={class:"variable-chip-input"},mt={key:0,class:"attributed-list-display"},ft={class:"list-header"},gt={class:"source-name"},bt={key:0,class:"attribute-breakdown"},_t={key:0,class:"separator"},yt={class:"total-conditions"},ht={class:"attributed-chips-container"},kt={class:"item-name"},wt={key:0,class:"attributes-wrapper"},$t={key:1,class:"direct-values"},Ct={key:0,class:"simple-list-display"},Vt={class:"list-header"},Lt={class:"source-name"},Rt={class:"tag-input-wrapper"},Tt={class:"custom-tag-input"},It={class:"tag-container tag-container-readonly"},St=["title"],Et={key:0,class:"readonly-hint"},xt={key:0,class:"helper-text"},Wt={key:1,class:"tag-input-wrapper"},Pt={class:"custom-tag-input"},Bt={class:"tag-container"},Ft={class:"floating-actions"},Ut=["title"],Mt=["onClick","data-testid","aria-label"],jt=["placeholder","aria-label","onKeydown"],At={key:0,class:"helper-text"},Nt=Z({__name:"VariableChipInputV3C",props:{values:{},listRef:{},listName:{},source:{},placeholder:{},attributedSamples:{},attributeBreakdown:{},attributeKeys:{},previewValues:{},totalCount:{}},emits:["update:values","clear-source","clear-list","select-list"],setup(O,{emit:N}){const p=O,F=N,P=E(""),m=E();function $(){return[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}]}function B(s){return p.attributeKeys?Object.entries(s).map(([n,w])=>{const t=p.attributeKeys.indexOf(n)%5;return{value:w,colorIndex:t}}):[]}function S(s){F("update:values",s),p.source&&F("clear-source")}function T(){const s=P.value.trim();s&&(p.values.includes(s)||S([...p.values,s]),P.value="")}function i(s){s.preventDefault();const w=(s.clipboardData?.getData("text")||"").split(/\r?\n/).map(t=>t.trim()).filter(t=>t.length>0);if(w.length>0){const t=new Set(p.values),v=w.filter(C=>!t.has(C));v.length>0&&S([...p.values,...v]),P.value=""}}function h(s){const n=[...p.values];n.splice(s,1),S(n)}function u(){if(P.value===""&&p.values.length>0){const s=[...p.values];s.pop(),S(s)}}function f(){S([]),p.source&&F("clear-source")}return(s,n)=>{const w=Q;return o(),d("div",pt,[s.listRef&&s.attributedSamples?(o(),d("div",mt,[a("div",ft,[n[6]||(n[6]=a("span",{class:"source-label"},"From list:",-1)),a("span",gt,b(s.listName||"Unknown List"),1),s.attributeBreakdown&&s.attributeBreakdown.parts.length>0?(o(),d("div",bt,[(o(!0),d(A,null,D(s.attributeBreakdown.parts,(t,v)=>(o(),d(A,{key:`part-${t.text}-${v}`},[a("span",{class:"attribute-part",style:te({backgroundColor:$()[t.colorIndex].bg,color:$()[t.colorIndex].text})},b(t.text),5),v<s.attributeBreakdown.parts.length-1?(o(),d("span",_t," × ")):I("",!0)],64))),128)),n[4]||(n[4]=a("span",{class:"arrow"}," → ",-1)),a("span",yt,b(s.attributeBreakdown.totalItems)+" conditions",1)])):I("",!0),g(w,{size:"small",danger:"",onClick:n[0]||(n[0]=t=>s.$emit("clear-list")),"data-testid":"btn-remove-list","aria-label":"Remove linked variable list"},{default:y(()=>n[5]||(n[5]=[R(" Remove List ")])),_:1,__:[5]})]),a("div",ht,[n[9]||(n[9]=a("span",{class:"sample-hint"},"Sample values:",-1)),(o(!0),d(A,null,D(s.attributedSamples,t=>(o(),d("div",{key:t.value,class:"attributed-item-chip"},[a("span",kt,b(t.value),1),t.attributes?(o(),d("span",wt,[n[7]||(n[7]=R(" (")),(o(!0),d(A,null,D(B(t.attributes),(v,C)=>(o(),d("span",{key:`attr-${v.value}-${C}`,class:"attribute-value",style:te({backgroundColor:$()[v.colorIndex].bg,color:$()[v.colorIndex].text})},b(v.value),5))),128)),n[8]||(n[8]=R(") "))])):I("",!0)]))),128))])])):(o(),d("div",$t,[s.source?(o(),d("div",Ct,[a("div",Vt,[n[12]||(n[12]=a("span",{class:"source-label"},"From list:",-1)),a("span",Lt,b(s.source.listName),1),n[13]||(n[13]=a("span",{class:"edit-hint"},"(Unlink list to edit)",-1)),g(w,{size:"small",type:"primary",onClick:n[1]||(n[1]=t=>s.$emit("clear-source")),"data-testid":"btn-unlink-list","aria-label":"Unlink list and edit values directly"},{default:y(()=>n[10]||(n[10]=[R(" Unlink List and Edit Directly ")])),_:1,__:[10]}),g(w,{size:"small",danger:"",onClick:f,"data-testid":"btn-clear-values","aria-label":"Remove all values from list"},{default:y(()=>n[11]||(n[11]=[R(" Remove List ")])),_:1,__:[11]})]),a("div",Rt,[a("div",Tt,[a("div",It,[(o(!0),d(A,null,D(s.values,(t,v)=>(o(),d("div",{key:`${t}-${v}`,class:"tag tag-readonly"},[a("span",{class:"tag-text",title:t.length>100?t:""},b(t.length>100?t.substring(0,100)+"...":t),9,St)]))),128)),s.values.length===0?(o(),d("span",Et," Values from linked list will appear here ")):I("",!0)]),s.values.length>0?(o(),d("div",xt,b(s.values.length)+" values ",1)):I("",!0)])])])):I("",!0),s.source?I("",!0):(o(),d("div",Wt,[a("div",Pt,[a("div",Bt,[a("div",Ft,[s.values.length>0?(o(),K(w,{key:0,size:"small",danger:"",onClick:f,"data-testid":"btn-clear-all","aria-label":"Clear all values"},{default:y(()=>n[14]||(n[14]=[R(" Clear ")])),_:1,__:[14]})):I("",!0),g(w,{size:"small",onClick:n[2]||(n[2]=t=>s.$emit("select-list")),"data-testid":"btn-select-list","aria-label":"Replace values with a variable list"},{default:y(()=>n[15]||(n[15]=[R(" Replace with List ")])),_:1,__:[15]})]),(o(!0),d(A,null,D(s.values,(t,v)=>(o(),d("div",{key:`${t}-${v}`,class:"tag"},[a("span",{class:"tag-text",title:t.length>100?t:""},b(t.length>100?t.substring(0,100)+"...":t),9,Ut),a("button",{type:"button",class:"tag-remove",onClick:C=>h(v),"data-testid":`btn-remove-tag-${v}`,"aria-label":`Remove value ${t}`}," × ",8,Mt)]))),128)),Y(a("input",{ref_key:"inputField",ref:m,"onUpdate:modelValue":n[3]||(n[3]=t=>P.value=t),placeholder:s.placeholder,class:"tag-input-field","data-testid":"input-variable-value","aria-label":s.placeholder||"Enter variable value",onKeydown:[ne(De(T,["prevent"]),["enter"]),ne(u,["backspace"])],onPaste:i},null,40,jt),[[pe,P.value]])]),s.values.length>0?(o(),d("div",At,b(s.values.length)+" values ",1)):I("",!0)])]))]))])}}}),re=X(Nt,[["__scopeId","data-v-33f1ece4"]]),zt={class:"variable-preview-cycler"},Dt={class:"preview-controls"},Ot={key:0,class:"cycle-info","data-testid":"cycle-info",role:"status","aria-live":"polite"},Kt=["aria-label"],qt={key:0,class:"preview-content"},Ht={key:0,class:"no-variables"},Gt={key:1,class:"single-preview","data-testid":"single-preview"},Yt={class:"preview-template","data-testid":"preview-template",role:"region","aria-label":"Preview of filled-in prompt"},Xt={key:2,class:"cycling-preview","data-testid":"cycling-preview"},Zt={class:"preview-template","data-testid":"preview-template-cycling",role:"region","aria-label":"Preview of filled-in prompt with cycling variables"},Jt={class:"variable-legend"},Qt=["data-testid"],ea={class:"variable-value"},ta=Z({__name:"VariablePreviewCyclerV3C",props:{template:{},variableBindings:{},variables:{},variableListRefs:{}},emits:["toggle-preview"],setup(O,{emit:N}){const p=O,F=N,P=de(),m=E(!1),$=E(0);let B=null;const S=["variable-highlight-blue","variable-highlight-green","variable-highlight-purple","variable-highlight-orange","variable-highlight-pink","variable-highlight-teal"],T=U(()=>{let t=[];if(p.variableBindings?t=Object.keys(p.variableBindings):p.variables&&(t=Object.keys(p.variables)),p.variableListRefs){const v=Object.keys(p.variableListRefs);t=[...new Set([...t,...v])]}return t}),i=U(()=>{if(T.value.length===0)return[];const t=[],v=P.variableLists.value;for(const V of T.value){let k=[];if(p.variableBindings){const W=p.variableBindings[V];if(W.type==="value"&&W.values)k=[...W.values];else if(W.type==="list"&&W.listId){const L=v.find(j=>j.id===W.listId);L&&(L.category==="simple"&&L.values?k=[...L.values]:L.category==="attributed"&&L.items&&(k=L.items.map(j=>j.value)))}}else if(p.variables&&p.variables[V]&&p.variables[V].length>0)k=[...p.variables[V]];else if(p.variableListRefs&&p.variableListRefs[V]){const W=p.variableListRefs[V],L=v.find(j=>j.id===W);L&&(L.category==="simple"&&L.values?k=[...L.values]:L.category==="attributed"&&L.items&&(k=L.items.map(j=>j.value)))}k.length>0&&t.push({name:V,values:k})}if(t.length===0)return[];function C(V){return V.reduce((k,W)=>k.flatMap(L=>W.map(j=>[...L,j])),[[]])}const M=t.map(V=>V.values);return C(M).map(V=>{const k={};return t.forEach((W,L)=>{k[W.name]=V[L]}),k})});function h(){m.value=!m.value,F("toggle-preview",m.value),m.value&&i.value.length>1?u():f()}function u(){f(),B=setInterval(()=>{$.value=($.value+1)%i.value.length},1e3)}function f(){B&&(clearInterval(B),B=null)}function s(t){return S[t%S.length]}function n(t){let v=w(p.template);return T.value.forEach((C,M)=>{if(t[C]!==void 0){const x=w(C),V=new RegExp(`\\{\\{\\s*${x}\\s*\\}\\}`,"g"),W=`<span class="${s(M)}">${w(String(t[C]))}</span>`;v=v.replace(V,W)}}),v}function w(t){const v=document.createElement("div");return v.textContent=t,v.innerHTML}return G(()=>p.template,()=>{$.value=0}),G(i,t=>{t.length===0?f():m.value&&t.length>1&&u(),$.value>=t.length&&($.value=0)}),Oe(()=>{f()}),(t,v)=>{const C=Q,M=ve("dompurify-html");return o(),d("div",zt,[a("div",Dt,[g(C,{type:m.value?"default":"primary",ghost:!m.value,onClick:h,class:"toggle-button","data-testid":"btn-toggle-preview-mode","aria-label":m.value?"Return to editor mode":"Preview filled-in prompts","aria-pressed":m.value},{default:y(()=>[m.value?(o(),K(H(Je),{key:1})):(o(),K(H(Ze),{key:0})),R(" "+b(m.value?"Return to Editor Mode":"Preview Filled-In Prompts"),1)]),_:1},8,["type","ghost","aria-label","aria-pressed"]),m.value&&i.value.length>1?(o(),d("div",Ot,[a("span",{class:"cycle-counter","data-testid":"cycle-counter","aria-label":`Showing combination ${$.value+1} of ${i.value.length}`},b($.value+1)+" / "+b(i.value.length),9,Kt),v[0]||(v[0]=a("span",{class:"cycle-hint"},"Auto-cycling every second",-1))])):I("",!0)]),m.value?(o(),d("div",qt,[i.value.length===0?(o(),d("div",Ht,[g(H(me)),v[1]||(v[1]=a("span",null,"No variables detected in template",-1))])):i.value.length===1?(o(),d("div",Gt,[Y(a("div",Yt,null,512),[[M,n(i.value[0]),"template"]])])):(o(),d("div",Xt,[Y(a("div",Zt,null,512),[[M,n(i.value[$.value]),"template"]]),a("div",Jt,[(o(!0),d(A,null,D(T.value,(x,V)=>(o(),d("div",{key:x,class:"legend-item","data-testid":`legend-item-${x}`},[a("span",{class:ce(s(V))},b(x),3),a("span",ea,b(i.value[$.value][x]),1)],8,Qt))),128))])]))])):I("",!0)])}}}),aa=X(ta,[["__scopeId","data-v-2f9c69f3"]]),la={class:"list-selector"},sa={key:0,class:"loading-container"},ia={key:0,class:"list-grid"},na=["onClick"],oa={class:"list-header"},ra={class:"item-count"},ua={key:0,class:"list-description"},da={class:"list-preview"},ca={key:0,class:"preview-more"},va={key:1,class:"attributed-badge"},pa={key:1,class:"empty-state"},ma=Z({__name:"ListSelectorV3C",props:{modelValue:{type:Boolean},listType:{}},emits:["update:modelValue","select"],setup(O,{emit:N}){const p=O,F=N,P=de(),m=U(()=>P.variableLists.value),$=U(()=>!1),B=U(()=>null),S=U(()=>{if(!m.value)return[];let h=[];return p.listType==="all"?h=m.value.filter(u=>u.category!=="tabular"):p.listType==="simple"?h=m.value.filter(u=>u.category==="simple"):p.listType==="refusal"&&(h=m.value.filter(u=>u.category==="refusal")),h}),T=h=>h.category==="attributed"&&h.items?h.items.slice(0,5).map(u=>u.value):h.values?.slice(0,5)??[],i=h=>{F("select",h),F("update:modelValue",!1)};return(h,u)=>{const f=ge,s=be,n=Q,w=fe;return o(),K(w,{open:h.modelValue,title:"Select List",width:"80vw",style:{maxWidth:"800px"},"onUpdate:open":u[1]||(u[1]=t=>h.$emit("update:modelValue",t)),onCancel:u[2]||(u[2]=t=>h.$emit("update:modelValue",!1))},{footer:y(()=>[g(n,{onClick:u[0]||(u[0]=t=>h.$emit("update:modelValue",!1))},{default:y(()=>u[3]||(u[3]=[R(" Cancel ")])),_:1,__:[3]})]),default:y(()=>[a("div",la,[$.value?(o(),d("div",sa,[g(f,{size:"large",tip:"Loading lists..."})])):B.value?(o(),K(s,{key:1,type:"error",message:B.value.message||"Failed to load lists",class:"error-alert"},null,8,["message"])):(o(),d(A,{key:2},[S.value.length>0?(o(),d("div",ia,[(o(!0),d(A,null,D(S.value,t=>(o(),d("div",{key:t.id,class:"list-option",onClick:v=>i(t)},[a("div",oa,[a("h4",null,b(t.name),1),a("span",ra,b(t.itemCount)+" items",1)]),t.description?(o(),d("p",ua,b(t.description),1)):I("",!0),a("div",da,[(o(!0),d(A,null,D(T(t),(v,C)=>(o(),d("span",{key:`${t.id}-preview-${C}-${v}`,class:"preview-value"},b(v),1))),128)),t.itemCount>5?(o(),d("span",ca," +"+b(t.itemCount-5)+" more ",1)):I("",!0)]),t.category==="attributed"?(o(),d("div",va," Attributed List ")):I("",!0)],8,na))),128))])):(o(),d("div",pa," No "+b(h.listType)+" lists available ",1))],64))])]),_:1},8,["open"])}}}),ue=X(ma,[["__scopeId","data-v-9aca871d"]]),fa={class:"template-editor-page"},ga={class:"header-content"},ba={class:"page-title"},_a={class:"design-form-container"},ya={key:0,class:"loading-container"},ha={class:"name-desc-row"},ka={key:0,class:"variable-hint"},wa={key:0,class:"variables-container"},$a={class:"variable-label"},Ca={class:"variable-content"},Va={class:"parser-row"},La={style:{flex:"1"}},Ra={class:"refusal-row"},Ta={class:"refusal-content"},Ia={class:"footer-content"},Sa={class:"stats"},Ea={class:"actions"},xa={class:"pricing-content"},Wa={key:0,class:"token-stats"},Pa={class:"stats-grid"},Ba={class:"pricing-placeholder"},Fa=Z({__name:"TemplateEditorViewV3C",setup(O){const N=Ke(),p=He(),{templates:F,loading:P}=Ge(),{variableLists:m}=Xe(),{createTemplate:$,updateTemplate:B,isExecuting:S}=Ye(),T=U(()=>N.params.id),i=E({name:"",description:"",template:"",parserId:null,refusalWords:[],refusalWordsListRef:"",refusalWordsSource:null,rejectRefusalWords:!1}),h=U(()=>P.value||S.value),u=E([]),f=E({}),s=E({}),n=E({}),w=E(!1),t=E(!1),v=E("all"),C=E(""),M=E(!1),x=E(null),V=[{bg:"#E8D5F2",text:"#6B21A8"},{bg:"#D5F2E8",text:"#047857"},{bg:"#FFE4D6",text:"#C2410C"},{bg:"#D6E4FF",text:"#1E40AF"},{bg:"#F3E8D5",text:"#92400E"}],k=U(()=>{if(!i.value.template)return[];const l=/\{\{([^}]+)\}\}/g,e=new Set;let r;for(;(r=l.exec(i.value.template))!==null;){const _=r[1].trim();/^\w+$/.test(_)&&e.add(_)}return Array.from(e)}),W=U(()=>{const l={};return k.value.forEach((e,r)=>{l[e]=V[r%V.length]}),l}),L=U(()=>{let l=1;for(const e of k.value){const r=f.value[e]||[],_=s.value[e];if(_){const z=m.value.find(q=>q.id===_);z&&(l*=z.itemCount||1)}else r.length>0&&(l*=r.length)}return{total:l,formatted:l.toLocaleString()}});function j(l){const e=k.value.indexOf(l);return V[e%V.length]}function _e(l){return`{{${l}}}`}function ye(l){}function he(l){const e=s.value[l];return e?m.value.find(_=>_.id===e)?.name:void 0}function ke(l){const e=s.value[l];return e?m.value.find(_=>_.id===e)?.itemCount:void 0}function we(l){const e=s.value[l];if(!e)return;const r=m.value.find(_=>_.id===e);if(!(!r||r.category!=="attributed"||!r.items))return r.items.slice(0,10)}function $e(l){const e=s.value[l];if(!e)return;const r=m.value.find(z=>z.id===e);if(!r||r.category!=="attributed")return;const _=[];return r.attributeKeys&&_.push(...r.attributeKeys.map((z,q)=>({text:z,colorIndex:q%5}))),{parts:_,totalItems:r.itemCount||0}}function Ce(l){const e=s.value[l];if(!e)return;const r=m.value.find(_=>_.id===e);return r?.attributeKeys?[...r.attributeKeys]:void 0}function Ve(l){const e=s.value[l];if(!e)return;const r=m.value.find(_=>_.id===e);if(!(!r||r.category!=="simple"))return r.values?.slice(0,10)}function Le(l,e){f.value[l]=e}function Re(l){n.value[l]=null}function Te(l){s.value[l]="",f.value[l]=[]}function Ie(l){C.value=l,v.value="all",w.value=!0}function Se(l){C.value&&(l.category==="simple"?(f.value[C.value]=[...l.values||[]],s.value[C.value]="",n.value[C.value]={listId:l.id,listName:l.name}):(s.value[C.value]=l.id,f.value[C.value]=[],n.value[C.value]=null)),w.value=!1}function Ee(){return i.value.refusalWordsListRef?m.value.find(e=>e.id===i.value.refusalWordsListRef)?.name:void 0}function xe(){i.value.refusalWordsListRef="",i.value.refusalWords=[]}function We(l){(l.category==="simple"||l.category==="refusal")&&l.values&&(i.value.refusalWords=[...l.values],i.value.refusalWordsListRef="",i.value.refusalWordsSource=null),t.value=!1}function Pe(l,e){i.value.parserId=l}function ae(){p.push({name:"templates"})}async function le(){try{if(u.value=[],!i.value.name.trim()){u.value.push("Template name is required");return}if(!i.value.template.trim()){u.value.push("Template content is required");return}const l={};for(const r of k.value)s.value[r]?l[r]={type:"list",listId:s.value[r]}:f.value[r]?.length>0&&(l[r]={type:"value",values:[...f.value[r]]});const e={name:i.value.name,description:i.value.description,template:i.value.template,variables:l,category:"Custom",tags:[],parserId:i.value.parserId||void 0,refusalWords:i.value.refusalWords.length>0?[...i.value.refusalWords]:void 0,rejectRefusalWords:i.value.rejectRefusalWords};if(T.value){const r=await B(T.value,e);if(r.ok)oe.success("Template updated successfully");else{u.value=[r.error.message];return}}else{const r=await $(e);if(r.ok)oe.success("Template created successfully");else{u.value=[r.error.message];return}}p.push({name:"templates"})}catch(l){ie.error("Failed to save template:",l),u.value=[l instanceof Error?l.message:"Failed to save template"]}}function se(){if(!T.value)return;const l=F.value.find(e=>e.id===T.value);if(!l){P.value||(u.value=["Template not found"]);return}i.value.name=l.name,i.value.description=l.description||"",i.value.template=l.template,i.value.parserId=l.parserId||null,i.value.refusalWords=l.refusalWords?[...l.refusalWords]:[],i.value.rejectRefusalWords=l.rejectRefusalWords||!1,f.value={},s.value={},n.value={};for(const[e,r]of Object.entries(l.variables))if(r.type==="list"&&r.listId){const _=m.value.find(z=>z.id===r.listId);_&&(_.category==="simple"||_.category==="refusal"?(f.value[e]=[..._.values||[]],s.value[e]="",n.value[e]={listId:_.id,listName:_.name}):(s.value[e]=r.listId,f.value[e]=[],n.value[e]=null))}else r.type==="value"&&r.values&&(f.value[e]=[...r.values])}return G(M,async l=>{l&&!x.value&&(x.value={promptTokens:Math.ceil(i.value.template.length/4),totalEstimate:Math.ceil(i.value.template.length/3),variableTokens:{}})}),qe(()=>{T.value,T.value,T.value&&se()}),G([()=>N.params.id,F,m],()=>{T.value&&se()},{immediate:!0}),(l,e)=>{const r=Q,_=et,z=ge,q=st,ee=lt,Be=it,Fe=be,Ue=nt,Me=at,je=ot,Ae=Qe,Ne=fe;return o(),d("div",fa,[g(Ae,null,{default:y(()=>[g(_,{class:"editor-header"},{default:y(()=>[a("div",ga,[g(r,{type:"text",onClick:ae,class:"back-button","data-testid":"btn-back-to-templates"},{icon:y(()=>[g(H(tt))]),default:y(()=>[e[14]||(e[14]=R(" Back to Templates "))]),_:1,__:[14]}),a("h1",ba,b(T.value?"Edit Template":"Create Template"),1)])]),_:1}),g(Me,{class:"editor-content"},{default:y(()=>[a("div",_a,[h.value?(o(),d("div",ya,[g(z,{size:"large",tip:"Loading template..."})])):(o(),K(Ue,{key:1,model:i.value,layout:"vertical",onFinish:le},{default:y(()=>[a("div",ha,[e[15]||(e[15]=a("label",{class:"inline-field-label"},"Name",-1)),g(ee,{name:"name",rules:[{required:!0,message:"Required"}],class:"name-field"},{default:y(()=>[g(q,{value:i.value.name,"onUpdate:value":e[0]||(e[0]=c=>i.value.name=c),placeholder:"Enter template name",size:"large","data-testid":"input-template-name","aria-label":"Template name"},null,8,["value"])]),_:1}),e[16]||(e[16]=a("label",{class:"inline-field-label"},"Description",-1)),g(ee,{name:"description",class:"desc-field"},{default:y(()=>[g(q,{value:i.value.description,"onUpdate:value":e[1]||(e[1]=c=>i.value.description=c),placeholder:"Optional description",size:"large","data-testid":"input-template-description","aria-label":"Template description"},null,8,["value"])]),_:1})]),g(ee,{label:"Template",name:"template",rules:[{required:!0,message:"Required"}],class:"template-form-item"},{default:y(()=>[k.value.length===0?(o(),d("div",ka,[g(H(me)),e[17]||(e[17]=a("span",null,[R("Type a prompt and use double curly braces to add a variable with conditions to vary, like "),a("code",null,"{{name}}"),R(" or "),a("code",null,"{{system_prompt}}"),R(". Variable names cannot contain spaces or punctuation except underscores (_).")],-1))])):I("",!0),g(vt,{modelValue:i.value.template,"onUpdate:modelValue":e[2]||(e[2]=c=>i.value.template=c),placeholder:"Enter your prompt template... Use {{variable}} for variables",rows:7,variables:k.value,"variable-colors":W.value,"data-testid":"template-editor","aria-label":"Prompt template editor"},null,8,["modelValue","variables","variable-colors"]),k.value.length>0&&i.value.template?(o(),K(aa,{key:1,template:i.value.template,variables:f.value,"variable-list-refs":s.value,onTogglePreview:ye},null,8,["template","variables","variable-list-refs"])):I("",!0)]),_:1}),k.value.length>0?(o(),d("div",wa,[(o(!0),d(A,null,D(k.value,c=>(o(),d("div",{key:c,class:"variable-row"},[a("div",$a,[e[18]||(e[18]=a("span",{class:"variable-text"},"Variable:",-1)),a("span",{style:te({backgroundColor:j(c).bg,color:j(c).text}),class:"variable-badge"},b(_e(c)),5)]),a("div",Ca,[g(re,{values:f.value[c]||[],"list-ref":s.value[c],"list-name":he(c),source:n.value[c]||null,placeholder:`Enter a value for {{${c}}} and hit enter`,"attributed-samples":we(c),"attribute-breakdown":$e(c),"attribute-keys":Ce(c),"preview-values":Ve(c),"total-count":ke(c),"onUpdate:values":J=>Le(c,J),onClearSource:J=>Re(c),onClearList:J=>Te(c),onSelectList:J=>Ie(c)},null,8,["values","list-ref","list-name","source","placeholder","attributed-samples","attribute-breakdown","attribute-keys","preview-values","total-count","onUpdate:values","onClearSource","onClearList","onSelectList"])])]))),128))])):I("",!0),a("div",Va,[e[19]||(e[19]=a("label",{class:"row-label"},"Response Parser",-1)),a("div",La,[g(rt,{modelValue:i.value.parserId,"onUpdate:modelValue":e[3]||(e[3]=c=>i.value.parserId=c),placeholder:"Select Parser (Optional - leave blank for full response)","allow-clear":!0,context:"template-editor",onChange:Pe},null,8,["modelValue"])])]),a("div",Ra,[e[21]||(e[21]=a("label",{class:"row-label"},"Parse Refusals",-1)),a("div",Ta,[g(re,{values:i.value.refusalWords,"list-ref":i.value.refusalWordsListRef,"list-name":Ee(),source:i.value.refusalWordsSource||null,placeholder:"Enter a refusal word and hit enter (e.g., cannot, unable, refuse)","onUpdate:values":e[4]||(e[4]=c=>i.value.refusalWords=c),onClearSource:e[5]||(e[5]=c=>i.value.refusalWordsSource=null),onClearList:e[6]||(e[6]=c=>xe()),onSelectList:e[7]||(e[7]=c=>t.value=!0)},null,8,["values","list-ref","list-name","source"])]),g(Be,{checked:i.value.rejectRefusalWords,"onUpdate:checked":e[8]||(e[8]=c=>i.value.rejectRefusalWords=c),class:"reject-checkbox","data-testid":"checkbox-reject-refusals","aria-label":"Reject responses containing refusal words"},{default:y(()=>e[20]||(e[20]=[R(" Reject on match ")])),_:1,__:[20]},8,["checked"])]),u.value.length>0?(o(),K(Fe,{key:1,type:"error","show-icon":"",class:"error-alert"},{message:y(()=>[R(b(u.value.join(", ")),1)]),_:1})):I("",!0)]),_:1},8,["model"]))])]),_:1}),g(je,{class:"editor-footer"},{default:y(()=>[a("div",Ia,[a("div",Sa,b(k.value.length)+" variables • "+b(L.value.formatted)+" combinations ",1),a("div",Ea,[g(r,{size:"large",onClick:e[9]||(e[9]=c=>M.value=!0),"data-testid":"btn-calculate-pricing","aria-label":"Calculate pricing for this template"},{default:y(()=>e[22]||(e[22]=[R(" Calculate Pricing ")])),_:1,__:[22]}),g(r,{size:"large",onClick:ae,"data-testid":"btn-cancel-template","aria-label":"Cancel and go back to templates"},{default:y(()=>e[23]||(e[23]=[R(" Cancel ")])),_:1,__:[23]}),g(r,{size:"large",type:"primary",onClick:le,"data-testid":"btn-save-template","aria-label":"Save template and go back to templates"},{default:y(()=>e[24]||(e[24]=[R(" Save ")])),_:1,__:[24]})])])]),_:1})]),_:1}),g(ue,{modelValue:w.value,"onUpdate:modelValue":e[10]||(e[10]=c=>w.value=c),"list-type":v.value,onSelect:Se},null,8,["modelValue","list-type"]),g(ue,{modelValue:t.value,"onUpdate:modelValue":e[11]||(e[11]=c=>t.value=c),"list-type":"refusal",onSelect:We},null,8,["modelValue"]),g(Ne,{open:M.value,"onUpdate:open":e[13]||(e[13]=c=>M.value=c),title:"Cost Estimation",width:"90vw",style:{maxWidth:"1000px"}},{footer:y(()=>[g(r,{onClick:e[12]||(e[12]=c=>M.value=!1)},{default:y(()=>e[30]||(e[30]=[R("Close")])),_:1,__:[30]})]),default:y(()=>[a("div",xa,[x.value?(o(),d("div",Wa,[e[25]||(e[25]=a("h4",null,"Token Analysis",-1)),a("div",Pa,[a("div",null,"Min: "+b(x.value.promptTokens),1),a("div",null,"Max: "+b(x.value.totalEstimate),1),a("div",null,"Avg: "+b(Math.round((x.value.promptTokens+x.value.totalEstimate)/2)),1),a("div",null,"Variables: "+b(Object.keys(x.value.variableTokens).length),1)])])):I("",!0),a("div",Ba,[e[29]||(e[29]=a("p",null,"Pricing calculation will be implemented with V3 backend integration.",-1)),a("p",null,[e[26]||(e[26]=R("Template: ")),a("strong",null,b(i.value.name||"Untitled"),1)]),a("p",null,[e[27]||(e[27]=R("Variables: ")),a("strong",null,b(k.value.length),1)]),a("p",null,[e[28]||(e[28]=R("Combinations: ")),a("strong",null,b(L.value.formatted),1)])])])]),_:1},8,["open"])])}}}),Ga=X(Fa,[["__scopeId","data-v-c372f568"]]);export{Ga as default};
