const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/trial-bundle.service-RXJifw-s.js","assets/index-BtStMksw.js","assets/vue-vendor-DPw1dQYc.js","assets/ui-vendor-IRGmExUJ.js","assets/utils-vendor-B76-F3_P.js","assets/index-DaHEOU6Y.css","assets/data-vendor-BIyl9aCN.js","assets/index-Bq-8JkxP.js","assets/toast-CdlfWUDp.js","assets/useCostEstimation-BaQYbkqD.js","assets/ParserSelector-th1jWH2J.js","assets/parser.store-BcDiOwi5.js","assets/ParserSelector-DMLEdzpb.css","assets/trial-stream-manager-v4-C-5MxKht.js","assets/execution-control-v4-CjO8f1-5.js","assets/useV4TrialCommands-C8-eZmHc.js","assets/useHeatmapStylingV3-CCIdVOn4.js","assets/useV4Models-CqMhH-Fc.js","assets/useV4LiveQuery-Do0jdBW3.js"])))=>i.map(i=>d[i]);
var ys=Object.defineProperty;var bs=(l,e,t)=>e in l?ys(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var Se=(l,e,t)=>bs(l,typeof e!="symbol"?e+"":e,t);import{d as re,f as q,c as M,o as me,b as ye,w as oe,R as p,a0 as te,S as s,_ as F,a9 as Ie,a3 as _e,Y as i,y as we,aa as _s,ab as Ts,ac as $s,$ as Q,ad as Cs,ae as ks,af as Nt,q as Lt,n as Ee,k as S,Z as P,F as Y,W as ee,a5 as $t,ag as ws,ah as Ss,u as H,a4 as at,V as _,G as D,M as xe,ai as Ae,U as Mt,A as Ut,aj as Is,B as zt,r as Es,a7 as Rs,a1 as Bt,X as je,a6 as nt}from"./vue-vendor-DPw1dQYc.js";import{t as fe}from"./toast-CdlfWUDp.js";import{j as le,a as A,u as Fs,b as Ct,y as Ne,z as Ps,x as xs,d as Fe,B as As,e as kt,C as Vs,_ as Re}from"./index-BtStMksw.js";import{aH as Wt,z as jt,aS as Os,n as ve,P as Ds,aT as Ht,aU as Ns,s as mt,az as Ls,M as vt,t as gt,v as Ms,a1 as qt,I as wt,aV as Us,aa as zs,av as Bs,aM as Gt,V as Ws,aI as js,X as Hs,C as ht,r as qs,w as Gs,x as Ce,ax as Jt,aN as Pe,T as He,J as qe,D as Js,N as ne,aJ as Xs,am as Xt,a5 as Ks,a6 as Qs,a4 as Kt,aW as Ys,ai as Qt,E as Yt,ak as Zs,al as ea,G as ta,o as sa,aA as aa,aX as St,R as na,Y as oa,au as yt,aw as ra,aY as bt,m as Zt,a0 as la}from"./ui-vendor-IRGmExUJ.js";import{b as es}from"./utils-vendor-B76-F3_P.js";import{u as Ge}from"./useCostEstimation-BaQYbkqD.js";import{P as ia}from"./ParserSelector-th1jWH2J.js";import{u as Je,a as ts}from"./trial-stream-manager-v4-C-5MxKht.js";import{u as ua}from"./parser.store-BcDiOwi5.js";import{v as It,u as da,a as ca,b as pa}from"./useV4TrialCommands-C8-eZmHc.js";import{u as fa}from"./useHeatmapStylingV3-CCIdVOn4.js";import{u as et,w as ma}from"./data-vendor-BIyl9aCN.js";import{u as va}from"./execution-control-v4-CjO8f1-5.js";import{u as ga}from"./useV4Models-CqMhH-Fc.js";const ha={class:"right-panel"},ya=re({__name:"ResizablePanelContainer",props:{storageKey:{default:"trial-list-width"},defaultWidth:{default:250},minWidth:{default:200},maxWidth:{default:600},mobileBreakpoint:{default:768}},emits:["resize","mobile-overlay-change"],setup(l,{expose:e,emit:t}){const a=l,o=t,n=q(a.defaultWidth),u=q(!1),c=q(0),d=q(0),f=q(window.innerWidth),h=q(!1),b=M(()=>f.value<a.mobileBreakpoint),T=M(()=>b.value?{width:`${Math.min(f.value*.85,400)}px`}:{width:`${n.value}px`});function E(){const $=localStorage.getItem(a.storageKey);if($){const m=parseInt($,10);!isNaN(m)&&m>=a.minWidth&&m<=a.maxWidth&&(n.value=m)}}function k($){localStorage.setItem(a.storageKey,$.toString()),o("resize",$)}function C($){u.value=!0,c.value=$.clientX,d.value=n.value,document.addEventListener("mousemove",z),document.addEventListener("mouseup",N),document.body.style.userSelect="none",document.body.style.cursor="col-resize"}function z($){if(!u.value)return;const m=$.clientX-c.value,L=Math.max(a.minWidth,Math.min(a.maxWidth,d.value+m));n.value=L}function N(){u.value&&(u.value=!1,k(n.value),document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",N),document.body.style.userSelect="",document.body.style.cursor="")}function O(){n.value=a.defaultWidth,k(a.defaultWidth)}function I(){f.value=window.innerWidth,!b.value&&h.value&&(h.value=!1,o("mobile-overlay-change",!1))}function w(){b.value&&(h.value=!h.value,o("mobile-overlay-change",h.value))}function U(){h.value=!1,o("mobile-overlay-change",!1)}return e({toggleMobileOverlay:w,closeMobileOverlay:U}),me(()=>{E(),window.addEventListener("resize",I)}),ye(()=>{window.removeEventListener("resize",I),N()}),oe(()=>a.defaultWidth,$=>{n.value===a.defaultWidth&&(n.value=$)}),($,m)=>(i(),p("div",{class:te(["resizable-panel-container",{"mobile-overlay":b.value}])},[s("div",{class:te(["left-panel",{"overlay-visible":b.value&&h.value}]),style:_e(T.value)},[Ie($.$slots,"left",{},void 0,!0)],6),b.value?F("",!0):(i(),p("div",{key:0,class:te(["resize-handle",{dragging:u.value}]),onMousedown:C,onDblclick:O},m[0]||(m[0]=[s("div",{class:"handle-bar"},null,-1)]),34)),s("div",ha,[Ie($.$slots,"right",{},void 0,!0)]),b.value&&h.value?(i(),p("div",{key:1,class:"mobile-overlay-bg",onClick:U})):F("",!0)],2))}}),ba=le(ya,[["__scopeId","data-v-949e1df1"]]);function _a(){var l=window.navigator.userAgent,e=l.indexOf("MSIE ");if(e>0)return parseInt(l.substring(e+5,l.indexOf(".",e)),10);var t=l.indexOf("Trident/");if(t>0){var a=l.indexOf("rv:");return parseInt(l.substring(a+3,l.indexOf(".",a)),10)}var o=l.indexOf("Edge/");return o>0?parseInt(l.substring(o+5,l.indexOf(".",o)),10):-1}let Me;function ot(){ot.init||(ot.init=!0,Me=_a()!==-1)}var Xe={name:"ResizeObserver",props:{emitOnMount:{type:Boolean,default:!1},ignoreWidth:{type:Boolean,default:!1},ignoreHeight:{type:Boolean,default:!1}},emits:["notify"],mounted(){ot(),we(()=>{this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitOnMount&&this.emitSize()});const l=document.createElement("object");this._resizeObject=l,l.setAttribute("aria-hidden","true"),l.setAttribute("tabindex",-1),l.onload=this.addResizeHandlers,l.type="text/html",Me&&this.$el.appendChild(l),l.data="about:blank",Me||this.$el.appendChild(l)},beforeUnmount(){this.removeResizeHandlers()},methods:{compareAndNotify(){(!this.ignoreWidth&&this._w!==this.$el.offsetWidth||!this.ignoreHeight&&this._h!==this.$el.offsetHeight)&&(this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitSize())},emitSize(){this.$emit("notify",{width:this._w,height:this._h})},addResizeHandlers(){this._resizeObject.contentDocument.defaultView.addEventListener("resize",this.compareAndNotify),this.compareAndNotify()},removeResizeHandlers(){this._resizeObject&&this._resizeObject.onload&&(!Me&&this._resizeObject.contentDocument&&this._resizeObject.contentDocument.defaultView.removeEventListener("resize",this.compareAndNotify),this.$el.removeChild(this._resizeObject),this._resizeObject.onload=null,this._resizeObject=null)}}};const Ta=$s();_s("data-v-b329ee4c");const $a={class:"resize-observer",tabindex:"-1"};Ts();const Ca=Ta((l,e,t,a,o,n)=>(i(),Q("div",$a)));Xe.render=Ca;Xe.__scopeId="data-v-b329ee4c";Xe.__file="src/components/ResizeObserver.vue";function Ue(l){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ue=function(e){return typeof e}:Ue=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ue(l)}function ka(l,e){if(!(l instanceof e))throw new TypeError("Cannot call a class as a function")}function wa(l,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(l,a.key,a)}}function Sa(l,e,t){return e&&wa(l.prototype,e),l}function Et(l){return Ia(l)||Ea(l)||Ra(l)||Fa()}function Ia(l){if(Array.isArray(l))return rt(l)}function Ea(l){if(typeof Symbol<"u"&&Symbol.iterator in Object(l))return Array.from(l)}function Ra(l,e){if(l){if(typeof l=="string")return rt(l,e);var t=Object.prototype.toString.call(l).slice(8,-1);if(t==="Object"&&l.constructor&&(t=l.constructor.name),t==="Map"||t==="Set")return Array.from(l);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return rt(l,e)}}function rt(l,e){(e==null||e>l.length)&&(e=l.length);for(var t=0,a=new Array(e);t<e;t++)a[t]=l[t];return a}function Fa(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pa(l){var e;return typeof l=="function"?e={callback:l}:e=l,e}function xa(l,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a,o,n,u=function(d){for(var f=arguments.length,h=new Array(f>1?f-1:0),b=1;b<f;b++)h[b-1]=arguments[b];if(n=h,!(a&&d===o)){var T=t.leading;typeof T=="function"&&(T=T(d,o)),(!a||d!==o)&&T&&l.apply(void 0,[d].concat(Et(n))),o=d,clearTimeout(a),a=setTimeout(function(){l.apply(void 0,[d].concat(Et(n))),a=0},e)}};return u._clear=function(){clearTimeout(a),a=null},u}function ss(l,e){if(l===e)return!0;if(Ue(l)==="object"){for(var t in l)if(!ss(l[t],e[t]))return!1;return!0}return!1}var Aa=(function(){function l(e,t,a){ka(this,l),this.el=e,this.observer=null,this.frozen=!1,this.createObserver(t,a)}return Sa(l,[{key:"createObserver",value:function(t,a){var o=this;if(this.observer&&this.destroyObserver(),!this.frozen){if(this.options=Pa(t),this.callback=function(c,d){o.options.callback(c,d),c&&o.options.once&&(o.frozen=!0,o.destroyObserver())},this.callback&&this.options.throttle){var n=this.options.throttleOptions||{},u=n.leading;this.callback=xa(this.callback,this.options.throttle,{leading:function(d){return u==="both"||u==="visible"&&d||u==="hidden"&&!d}})}this.oldResult=void 0,this.observer=new IntersectionObserver(function(c){var d=c[0];if(c.length>1){var f=c.find(function(b){return b.isIntersecting});f&&(d=f)}if(o.callback){var h=d.isIntersecting&&d.intersectionRatio>=o.threshold;if(h===o.oldResult)return;o.oldResult=h,o.callback(h,d)}},this.options.intersection),we(function(){o.observer&&o.observer.observe(o.el)})}}},{key:"destroyObserver",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null),this.callback&&this.callback._clear&&(this.callback._clear(),this.callback=null)}},{key:"threshold",get:function(){return this.options.intersection&&typeof this.options.intersection.threshold=="number"?this.options.intersection.threshold:0}}]),l})();function as(l,e,t){var a=e.value;if(a)if(typeof IntersectionObserver>"u")console.warn("[vue-observe-visibility] IntersectionObserver API is not available in your browser. Please install this polyfill: https://github.com/w3c/IntersectionObserver/tree/master/polyfill");else{var o=new Aa(l,a,t);l._vue_visibilityState=o}}function Va(l,e,t){var a=e.value,o=e.oldValue;if(!ss(a,o)){var n=l._vue_visibilityState;if(!a){ns(l);return}n?n.createObserver(a,t):as(l,{value:a},t)}}function ns(l){var e=l._vue_visibilityState;e&&(e.destroyObserver(),delete l._vue_visibilityState)}var Oa={beforeMount:as,updated:Va,unmounted:ns},Da={itemsLimit:1e3},Na=/(auto|scroll)/;function os(l,e){return l.parentNode===null?e:os(l.parentNode,e.concat([l]))}var tt=function(e,t){return getComputedStyle(e,null).getPropertyValue(t)},La=function(e){return tt(e,"overflow")+tt(e,"overflow-y")+tt(e,"overflow-x")},Ma=function(e){return Na.test(La(e))};function Rt(l){if(l instanceof HTMLElement||l instanceof SVGElement){for(var e=os(l.parentNode,[]),t=0;t<e.length;t+=1)if(Ma(e[t]))return e[t];return document.scrollingElement||document.documentElement}}function lt(l){"@babel/helpers - typeof";return lt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lt(l)}var Ua={items:{type:Array,required:!0},keyField:{type:String,default:"id"},direction:{type:String,default:"vertical",validator:function(e){return["vertical","horizontal"].includes(e)}},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"}};function za(){return this.items.length&&lt(this.items[0])!=="object"}var it=!1;if(typeof window<"u"){it=!1;try{var Ba=Object.defineProperty({},"passive",{get:function(){it=!0}});window.addEventListener("test",null,Ba)}catch{}}let Wa=0;var Ke={name:"RecycleScroller",components:{ResizeObserver:Xe},directives:{ObserveVisibility:Oa},props:{...Ua,itemSize:{type:Number,default:null},gridItems:{type:Number,default:void 0},itemSecondarySize:{type:Number,default:void 0},minItemSize:{type:[Number,String],default:null},sizeField:{type:String,default:"size"},typeField:{type:String,default:"type"},buffer:{type:Number,default:200},pageMode:{type:Boolean,default:!1},prerender:{type:Number,default:0},emitUpdate:{type:Boolean,default:!1},updateInterval:{type:Number,default:0},skipHover:{type:Boolean,default:!1},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},listClass:{type:[String,Object,Array],default:""},itemClass:{type:[String,Object,Array],default:""}},emits:["resize","visible","hidden","update","scroll-start","scroll-end"],data(){return{pool:[],totalSize:0,ready:!1,hoverKey:null}},computed:{sizes(){if(this.itemSize===null){const l={"-1":{accumulator:0}},e=this.items,t=this.sizeField,a=this.minItemSize;let o=1e4,n=0,u;for(let c=0,d=e.length;c<d;c++)u=e[c][t]||a,u<o&&(o=u),n+=u,l[c]={accumulator:n,size:u};return this.$_computedMinItemSize=o,l}return[]},simpleArray:za,itemIndexByKey(){const{keyField:l,items:e}=this,t={};for(let a=0,o=e.length;a<o;a++)t[e[a][l]]=a;return t}},watch:{items(){this.updateVisibleItems(!0)},pageMode(){this.applyPageMode(),this.updateVisibleItems(!1)},sizes:{handler(){this.updateVisibleItems(!1)},deep:!0},gridItems(){this.updateVisibleItems(!0)},itemSecondarySize(){this.updateVisibleItems(!0)}},created(){this.$_startIndex=0,this.$_endIndex=0,this.$_views=new Map,this.$_unusedViews=new Map,this.$_scrollDirty=!1,this.$_lastUpdateScrollPosition=0,this.prerender&&(this.$_prerender=!0,this.updateVisibleItems(!1)),this.gridItems&&!this.itemSize&&console.error("[vue-recycle-scroller] You must provide an itemSize when using gridItems")},mounted(){this.applyPageMode(),this.$nextTick(()=>{this.$_prerender=!1,this.updateVisibleItems(!0),this.ready=!0})},activated(){const l=this.$_lastUpdateScrollPosition;typeof l=="number"&&this.$nextTick(()=>{this.scrollToPosition(l)})},beforeUnmount(){this.removeListeners()},methods:{addView(l,e,t,a,o){const n=Cs({id:Wa++,index:e,used:!0,key:a,type:o}),u=ks({item:t,position:0,nr:n});return l.push(u),u},unuseView(l,e=!1){const t=this.$_unusedViews,a=l.nr.type;let o=t.get(a);o||(o=[],t.set(a,o)),o.push(l),e||(l.nr.used=!1,l.position=-9999)},handleResize(){this.$emit("resize"),this.ready&&this.updateVisibleItems(!1)},handleScroll(l){if(!this.$_scrollDirty){if(this.$_scrollDirty=!0,this.$_updateTimeout)return;const e=()=>requestAnimationFrame(()=>{this.$_scrollDirty=!1;const{continuous:t}=this.updateVisibleItems(!1,!0);t||(clearTimeout(this.$_refreshTimout),this.$_refreshTimout=setTimeout(this.handleScroll,this.updateInterval+100))});e(),this.updateInterval&&(this.$_updateTimeout=setTimeout(()=>{this.$_updateTimeout=0,this.$_scrollDirty&&e()},this.updateInterval))}},handleVisibilityChange(l,e){this.ready&&(l||e.boundingClientRect.width!==0||e.boundingClientRect.height!==0?(this.$emit("visible"),requestAnimationFrame(()=>{this.updateVisibleItems(!1)})):this.$emit("hidden"))},updateVisibleItems(l,e=!1){const t=this.itemSize,a=this.gridItems||1,o=this.itemSecondarySize||t,n=this.$_computedMinItemSize,u=this.typeField,c=this.simpleArray?null:this.keyField,d=this.items,f=d.length,h=this.sizes,b=this.$_views,T=this.$_unusedViews,E=this.pool,k=this.itemIndexByKey;let C,z,N,O,I;if(!f)C=z=O=I=N=0;else if(this.$_prerender)C=O=0,z=I=Math.min(this.prerender,d.length),N=null;else{const r=this.getScroll();if(e){let V=r.start-this.$_lastUpdateScrollPosition;if(V<0&&(V=-V),t===null&&V<n||V<t)return{continuous:!0}}this.$_lastUpdateScrollPosition=r.start;const j=this.buffer;r.start-=j,r.end+=j;let K=0;if(this.$refs.before&&(K=this.$refs.before.scrollHeight,r.start-=K),this.$refs.after){const V=this.$refs.after.scrollHeight;r.end+=V}if(t===null){let V,G=0,v=f-1,y=~~(f/2),g;do g=y,V=h[y].accumulator,V<r.start?G=y:y<f-1&&h[y+1].accumulator>r.start&&(v=y),y=~~((G+v)/2);while(y!==g);for(y<0&&(y=0),C=y,N=h[f-1].accumulator,z=y;z<f&&h[z].accumulator<r.end;z++);for(z===-1?z=d.length-1:(z++,z>f&&(z=f)),O=C;O<f&&K+h[O].accumulator<r.start;O++);for(I=O;I<f&&K+h[I].accumulator<r.end;I++);}else{C=~~(r.start/t*a);const V=C%a;C-=V,z=Math.ceil(r.end/t*a),O=Math.max(0,Math.floor((r.start-K)/t*a)),I=Math.floor((r.end-K)/t*a),C<0&&(C=0),z>f&&(z=f),O<0&&(O=0),I>f&&(I=f),N=Math.ceil(f/a)*t}}z-C>Da.itemsLimit&&this.itemsLimitError(),this.totalSize=N;let w;const U=C<=this.$_endIndex&&z>=this.$_startIndex;if(U)for(let r=0,j=E.length;r<j;r++)w=E[r],w.nr.used&&(l&&(w.nr.index=k[w.item[c]]),(w.nr.index==null||w.nr.index<C||w.nr.index>=z)&&this.unuseView(w));const $=U?null:new Map;let m,L,R;for(let r=C;r<z;r++){m=d[r];const j=c?m[c]:m;if(j==null)throw new Error(`Key is ${j} on item (keyField is '${c}')`);if(w=b.get(j),!t&&!h[r].size){w&&this.unuseView(w);continue}L=m[u];let K=T.get(L),V=!1;if(!w)U?K&&K.length?w=K.pop():w=this.addView(E,r,m,j,L):(R=$.get(L)||0,(!K||R>=K.length)&&(w=this.addView(E,r,m,j,L),this.unuseView(w,!0),K=T.get(L)),w=K[R],$.set(L,R+1)),b.delete(w.nr.key),w.nr.used=!0,w.nr.index=r,w.nr.key=j,w.nr.type=L,b.set(j,w),V=!0;else if(!w.nr.used&&(w.nr.used=!0,V=!0,K)){const G=K.indexOf(w);G!==-1&&K.splice(G,1)}w.item=m,V&&(r===d.length-1&&this.$emit("scroll-end"),r===0&&this.$emit("scroll-start")),t===null?(w.position=h[r-1].accumulator,w.offset=0):(w.position=Math.floor(r/a)*t,w.offset=r%a*o)}return this.$_startIndex=C,this.$_endIndex=z,this.emitUpdate&&this.$emit("update",C,z,O,I),clearTimeout(this.$_sortTimer),this.$_sortTimer=setTimeout(this.sortViews,this.updateInterval+300),{continuous:U}},getListenerTarget(){let l=Rt(this.$el);return window.document&&(l===window.document.documentElement||l===window.document.body)&&(l=window),l},getScroll(){const{$el:l,direction:e}=this,t=e==="vertical";let a;if(this.pageMode){const o=l.getBoundingClientRect(),n=t?o.height:o.width;let u=-(t?o.top:o.left),c=t?window.innerHeight:window.innerWidth;u<0&&(c+=u,u=0),u+c>n&&(c=n-u),a={start:u,end:u+c}}else t?a={start:l.scrollTop,end:l.scrollTop+l.clientHeight}:a={start:l.scrollLeft,end:l.scrollLeft+l.clientWidth};return a},applyPageMode(){this.pageMode?this.addListeners():this.removeListeners()},addListeners(){this.listenerTarget=this.getListenerTarget(),this.listenerTarget.addEventListener("scroll",this.handleScroll,it?{passive:!0}:!1),this.listenerTarget.addEventListener("resize",this.handleResize)},removeListeners(){this.listenerTarget&&(this.listenerTarget.removeEventListener("scroll",this.handleScroll),this.listenerTarget.removeEventListener("resize",this.handleResize),this.listenerTarget=null)},scrollToItem(l){let e;const t=this.gridItems||1;this.itemSize===null?e=l>0?this.sizes[l-1].accumulator:0:e=Math.floor(l/t)*this.itemSize,this.scrollToPosition(e)},scrollToPosition(l){const e=this.direction==="vertical"?{scroll:"scrollTop",start:"top"}:{scroll:"scrollLeft",start:"left"};let t,a,o;if(this.pageMode){const n=Rt(this.$el),u=n.tagName==="HTML"?0:n[e.scroll],c=n.getBoundingClientRect(),f=this.$el.getBoundingClientRect()[e.start]-c[e.start];t=n,a=e.scroll,o=l+u+f}else t=this.$el,a=e.scroll,o=l;t[a]=o},itemsLimitError(){throw setTimeout(()=>{this.$el}),new Error("Rendered items limit reached")},sortViews(){this.pool.sort((l,e)=>l.nr.index-e.nr.index)}}};const ja={key:0,ref:"before",class:"vue-recycle-scroller__slot"},Ha={key:1,ref:"after",class:"vue-recycle-scroller__slot"};function qa(l,e,t,a,o,n){const u=Nt("ResizeObserver"),c=Lt("observe-visibility");return Ee((i(),p("div",{class:te(["vue-recycle-scroller",{ready:o.ready,"page-mode":t.pageMode,[`direction-${l.direction}`]:!0}]),onScrollPassive:e[0]||(e[0]=(...d)=>n.handleScroll&&n.handleScroll(...d))},[l.$slots.before?(i(),p("div",ja,[Ie(l.$slots,"before")],512)):F("v-if",!0),(i(),Q($t(t.listTag),{ref:"wrapper",style:_e({[l.direction==="vertical"?"minHeight":"minWidth"]:o.totalSize+"px"}),class:te(["vue-recycle-scroller__item-wrapper",t.listClass])},{default:P(()=>[(i(!0),p(Y,null,ee(o.pool,d=>(i(),Q($t(t.itemTag),ws({key:d.nr.id,style:o.ready?{transform:`translate${l.direction==="vertical"?"Y":"X"}(${d.position}px) translate${l.direction==="vertical"?"X":"Y"}(${d.offset}px)`,width:t.gridItems?`${l.direction==="vertical"&&t.itemSecondarySize||t.itemSize}px`:void 0,height:t.gridItems?`${l.direction==="horizontal"&&t.itemSecondarySize||t.itemSize}px`:void 0}:null,class:["vue-recycle-scroller__item-view",[t.itemClass,{hover:!t.skipHover&&o.hoverKey===d.nr.key}]]},Ss(t.skipHover?{}:{mouseenter:()=>{o.hoverKey=d.nr.key},mouseleave:()=>{o.hoverKey=null}})),{default:P(()=>[Ie(l.$slots,"default",{item:d.item,index:d.nr.index,active:d.nr.used})]),_:2},1040,["style","class"]))),128)),Ie(l.$slots,"empty")]),_:3},8,["style","class"])),l.$slots.after?(i(),p("div",Ha,[Ie(l.$slots,"after")],512)):F("v-if",!0),S(u,{onNotify:n.handleResize},null,8,["onNotify"])],34)),[[c,n.handleVisibilityChange]])}Ke.render=qa;Ke.__file="src/components/RecycleScroller.vue";const Ga={class:"trial-list-search"},Ja=["value"],Xa=re({__name:"TrialListSearch",props:{modelValue:{}},emits:["update:modelValue"],setup(l,{emit:e}){const t=e,a=q(),o=es(f=>{t("update:modelValue",f)},300);function n(f){const h=f.target.value;o(h)}function u(){t("update:modelValue",""),a.value?.focus()}function c(){a.value?.focus(),a.value?.select()}function d(f){f.type==="focus-trial-search"&&c()}return me(()=>{window.addEventListener("focus-trial-search",d)}),ye(()=>{window.removeEventListener("focus-trial-search",d)}),(f,h)=>(i(),p("div",Ga,[S(H(Wt),{class:"search-icon"}),s("input",{ref_key:"searchInput",ref:a,type:"text",class:"search-input",placeholder:"Filter trials...",value:f.modelValue,onInput:n,onKeydown:at(u,["escape"])},null,40,Ja),f.modelValue?(i(),Q(H(jt),{key:0,class:"clear-icon",onClick:u})):F("",!0)]))}}),Ka=le(Xa,[["__scopeId","data-v-3a032c2b"]]),Qa={class:"item-content"},Ya={class:"item-header"},Za=["title"],en={key:0,class:"progress-bar"},tn={class:"item-metadata"},sn={class:"meta-item"},an={class:"meta-item"},nn={key:0,class:"meta-separator"},on={key:1,class:"meta-item cost"},rn=re({__name:"TrialListItem",props:{trial:{},selected:{type:Boolean}},emits:["click"],setup(l){const e=l,{calculateTemplateTokens:t,calculatePromptTokens:a,estimateTotalCost:o,sumEstimates:n,formatCost:u}=Ge(),c=M(()=>{if(e.trial.progress.total===0)return 0;const b=e.trial.progress.completed+e.trial.progress.failed;return Math.round(b/e.trial.progress.total*100)}),d=M(()=>{const{completed:b,failed:T,total:E}=e.trial.progress;return e.trial.status==="draft"?`${E} tasks`:`${b+T}/${E} tasks`}),f=M(()=>{const b=e.trial.started||e.trial.created;if(!b)return"";const E=new Date().getTime()-b.getTime(),k=Math.floor(E/1e3),C=Math.floor(k/60),z=Math.floor(C/60),N=Math.floor(z/24);return k<60?"now":C<60?`${C}m`:z<24?`${z}h`:`${N}d`}),h=M(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let b=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)b=t(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const k=a(e.trial.spreadsheetConfig.promptPattern),C=e.trial.progress.total/e.trial.configurations.length;b={totalTokens:k*C,combinationCount:C,perCallAverage:k}}else if(e.trial.type==="playground")return null;if(!b||b.totalTokens===0)return null;const T=e.trial.configurations.map(k=>{const C=k.modelSnapshot;return C?o(b.totalTokens,b.combinationCount,C,k.parameters):null}).filter(Boolean);if(T.length===0)return null;const E=n(T);return`${u(E,"compact")} total`});return(b,T)=>(i(),p("div",{class:te(["trial-list-item",{selected:b.selected,"has-progress":b.trial.status==="running"}]),onClick:T[0]||(T[0]=E=>b.$emit("click"))},[s("div",{class:te(["status-indicator",`status-${b.trial.status}`])},null,2),s("div",Qa,[s("div",Ya,[s("span",{class:"trial-name",title:b.trial.name},_(b.trial.name),9,Za),s("span",{class:te(["status-tag",`status-${b.trial.status}`])},_(b.trial.status.toUpperCase()),3)]),b.trial.status==="running"?(i(),p("div",en,[s("div",{class:"progress-fill",style:_e({width:`${c.value}%`})},null,4)])):F("",!0),s("div",tn,[s("span",sn,_(d.value),1),T[1]||(T[1]=s("span",{class:"meta-separator"},"•",-1)),s("span",an,_(f.value),1),h.value?(i(),p("span",nn,"•")):F("",!0),h.value?(i(),p("span",on,_(h.value),1)):F("",!0)])])],2))}}),Ft=le(rn,[["__scopeId","data-v-037b1757"]]),ln={class:"section-title"},un=re({__name:"TrialListSection",props:{title:{},background:{type:Boolean}},setup(l){return(e,t)=>(i(),p("div",{class:te(["trial-list-section",{"with-background":e.background}])},[s("span",ln,_(e.title),1)],2))}}),Pt=le(un,[["__scopeId","data-v-07a26c58"]]),dn={class:"panel-header"},cn={class:"header-title"},pn={key:0,class:"title-text"},fn={class:"trial-count"},mn={key:0,class:"header-actions"},vn={class:"filter-count"},gn={class:"filter-count"},hn={class:"filter-count"},yn={class:"filter-count"},bn={class:"filter-count"},_n={key:1,class:"status-tabs"},Tn={class:"tab-count"},$n={class:"tab-count"},Cn={class:"tab-count"},kn={class:"trial-list-container"},wn={key:1,class:"trial-list"},Sn={key:2,class:"collapsed-list"},In=["onClick"],En={class:"collapsed-count"},Rn={key:3,class:"empty-state"},Fn=re({__name:"TrialListPanelV3",props:{trials:{},selectedTrialId:{},searchQuery:{},filterStatus:{}},emits:["select-trial","create-trial","import-trial","update-search","update-filter","refresh"],setup(l,{emit:e}){const t=l,a=e,o=q(!1),n=q("all"),u=q(250),c=M(()=>u.value<50),d=M(()=>t.trials.filter($=>$.status==="running"||$.status==="paused").length),f=M(()=>t.trials.filter($=>$.status==="completed"||$.status==="failed").length),h=M(()=>{let $=t.trials;if(t.searchQuery){const r=t.searchQuery.toLowerCase();$=$.filter(j=>{const K=j.name.toLowerCase().includes(r),V=j.templateConfig?.template?.toLowerCase().includes(r),G=j.configurations.some(v=>v.modelId.toLowerCase().includes(r)||v.provider.toLowerCase().includes(r));return K||V||G})}t.filterStatus!=="all"&&($=$.filter(r=>r.status===t.filterStatus)),n.value==="active"?$=$.filter(r=>r.status==="running"||r.status==="paused"):n.value==="done"&&($=$.filter(r=>r.status==="completed"||r.status==="failed"));const m=$.filter(r=>r.status==="running"),L=$.filter(r=>r.status!=="running"),R=[];return m.length>0&&(R.push({type:"section",title:"RUNNING",background:!0,id:"section-running"}),R.push(...m.sort((r,j)=>(j.started?.getTime()||0)-(r.started?.getTime()||0)))),L.length>0&&(m.length>0&&R.push({type:"section",title:"RECENT",background:!1,id:"section-recent"}),R.push(...L.sort((r,j)=>(j.created?.getTime()||0)-(r.created?.getTime()||0)))),R}),b=M(()=>h.value.map($=>({...$,height:N($)}))),T=M(()=>t.trials.filter($=>n.value==="active"?$.status==="running"||$.status==="paused":n.value==="done"?$.status==="completed"||$.status==="failed":!0)),E=M(()=>t.searchQuery?"No trials found":t.filterStatus==="running"?"No trials are currently running":"No trials found"),k=M(()=>t.searchQuery?"No trials match your search":t.filterStatus!=="all"?`No ${t.filterStatus} trials`:"Create your first trial to get started"),C=M(()=>t.filterStatus==="all"&&!t.searchQuery);function z($){return t.trials.filter(m=>m.status===$).length}function N($){if($.type==="section")return 32;const m=$.status==="running",L=$.configurations?.some(R=>R.repeatCount>1);return m||L?96:80}function O($){const m=$.progress.completed+$.progress.failed;return $.status==="running"?`${Math.round(m/$.progress.total*100)}%`:m.toString()}async function I(){o.value=!0;try{await new Promise($=>setTimeout($,500)),a("refresh")}finally{o.value=!1}}function w({key:$}){a("update-filter",$)}function U(){const $=document.querySelector(".trial-list-panel");$&&(u.value=$.clientWidth)}return me(()=>{U(),window.addEventListener("resize",U);const $=document.querySelector(".trial-list-panel");$&&new ResizeObserver(()=>U()).observe($)}),ye(()=>{window.removeEventListener("resize",U)}),($,m)=>{const L=ve,R=gt,r=Ms,j=vt,K=mt;return i(),p("div",{class:te(["trial-list-panel",{collapsed:c.value}])},[s("div",dn,[s("div",cn,[S(H(Os),{class:"title-icon"}),c.value?F("",!0):(i(),p("span",pn,"Trials")),s("span",fn,_($.trials.length),1)]),c.value?F("",!0):(i(),p("div",mn,[S(L,{type:"primary",size:"small",onClick:m[0]||(m[0]=V=>$.$emit("create-trial"))},{default:P(()=>[S(H(Ds)),m[7]||(m[7]=D(" New Trial "))]),_:1,__:[7]}),S(L,{size:"small",onClick:m[1]||(m[1]=V=>$.$emit("import-trial"))},{default:P(()=>[S(H(Ht)),m[8]||(m[8]=D(" Import "))]),_:1,__:[8]}),S(L,{size:"small",onClick:I,loading:o.value},{default:P(()=>[S(H(Ns),{spin:o.value},null,8,["spin"])]),_:1},8,["loading"]),S(K,null,{overlay:P(()=>[S(j,{onClick:w},{default:P(()=>[S(R,{key:"all"},{default:P(()=>m[9]||(m[9]=[s("span",null,"All Trials",-1)])),_:1,__:[9]}),S(r),S(R,{key:"running"},{default:P(()=>[m[10]||(m[10]=s("span",null,"Running Only",-1)),s("span",vn,_(z("running")),1)]),_:1,__:[10]}),S(R,{key:"completed"},{default:P(()=>[m[11]||(m[11]=s("span",null,"Completed Only",-1)),s("span",gn,_(z("completed")),1)]),_:1,__:[11]}),S(R,{key:"failed"},{default:P(()=>[m[12]||(m[12]=s("span",null,"Failed Only",-1)),s("span",hn,_(z("failed")),1)]),_:1,__:[12]}),S(R,{key:"paused"},{default:P(()=>[m[13]||(m[13]=s("span",null,"Paused Only",-1)),s("span",yn,_(z("paused")),1)]),_:1,__:[13]}),S(R,{key:"draft"},{default:P(()=>[m[14]||(m[14]=s("span",null,"Draft Only",-1)),s("span",bn,_(z("draft")),1)]),_:1,__:[14]})]),_:1})]),default:P(()=>[S(L,{size:"small"},{default:P(()=>[S(H(Ls))]),_:1})]),_:1})]))]),c.value?F("",!0):(i(),Q(Ka,{key:0,"model-value":$.searchQuery,"onUpdate:modelValue":m[2]||(m[2]=V=>$.$emit("update-search",V))},null,8,["model-value"])),c.value?F("",!0):(i(),p("div",_n,[s("div",{class:te(["status-tab",{active:n.value==="all"}]),onClick:m[3]||(m[3]=V=>n.value="all")},[m[15]||(m[15]=s("span",{class:"tab-icon"},"📊",-1)),m[16]||(m[16]=s("span",{class:"tab-label"},"ALL",-1)),s("span",Tn,_($.trials.length),1)],2),s("div",{class:te(["status-tab",{active:n.value==="active"}]),onClick:m[4]||(m[4]=V=>n.value="active")},[m[17]||(m[17]=s("span",{class:"tab-icon"},"🟢",-1)),m[18]||(m[18]=s("span",{class:"tab-label"},"Active",-1)),s("span",$n,_(d.value),1)],2),s("div",{class:te(["status-tab",{active:n.value==="done"}]),onClick:m[5]||(m[5]=V=>n.value="done")},[m[19]||(m[19]=s("span",{class:"tab-icon"},"✅",-1)),m[20]||(m[20]=s("span",{class:"tab-label"},"Done",-1)),s("span",Cn,_(f.value),1)],2)])),s("div",kn,[!c.value&&h.value.length>100?(i(),Q(H(Ke),{key:0,class:"trial-list virtual-list",items:b.value,"size-field":"height","key-field":"id",buffer:10},{default:P(({item:V})=>[V.type==="section"?(i(),Q(Pt,{key:0,title:V.title,background:V.background},null,8,["title","background"])):(i(),Q(Ft,{key:1,trial:V,selected:V.id===$.selectedTrialId,"data-trial-id":V.id,onClick:G=>$.$emit("select-trial",V.id)},null,8,["trial","selected","data-trial-id","onClick"]))]),_:1},8,["items"])):c.value?(i(),p("div",Sn,[(i(!0),p(Y,null,ee(T.value,V=>(i(),p("div",{key:V.id,class:te(["collapsed-item",{selected:V.id===$.selectedTrialId}]),onClick:G=>$.$emit("select-trial",V.id)},[s("div",{class:te(["status-dot",`status-${V.status}`])},null,2),s("span",En,_(O(V)),1)],10,In))),128))])):(i(),p("div",wn,[(i(!0),p(Y,null,ee(h.value,(V,G)=>(i(),p(Y,{key:V.id||`section-${G}`},[V.type==="section"?(i(),Q(Pt,{key:0,title:V.title,background:V.background},null,8,["title","background"])):(i(),Q(Ft,{key:1,trial:V,selected:V.id===$.selectedTrialId,"data-trial-id":V.id,onClick:v=>$.$emit("select-trial",V.id)},null,8,["trial","selected","data-trial-id","onClick"]))],64))),128))])),h.value.length===0&&!c.value?(i(),p("div",Rn,[S(H(qt),{class:"empty-icon"}),s("h3",null,_(E.value),1),s("p",null,_(k.value),1),C.value?(i(),Q(L,{key:0,type:"primary",size:"large",onClick:m[6]||(m[6]=V=>$.$emit("create-trial"))},{default:P(()=>m[21]||(m[21]=[D(" Create New Trial ")])),_:1,__:[21]})):F("",!0)])):F("",!0)])],2)}}}),Pn=le(Fn,[["__scopeId","data-v-ad2a17cf"]]),xn={class:"trial-header"},An={class:"header-main"},Vn={class:"header-title"},On={class:"trial-name"},Dn={key:0,class:"progress-container"},Nn={class:"progress-bar"},Ln={class:"progress-stats-inline"},Mn={class:"progress-text"},Un={key:0,class:"progress-stat"},zn={class:"stat-number"},Bn={key:1,class:"progress-stat"},Wn={class:"stat-number"},jn={key:2,class:"progress-stat"},Hn={class:"stat-number"},qn=re({__name:"TrialHeaderV3",props:{trial:{},progress:{},isExecuting:{type:Boolean}},setup(l){const e=l,t=M(()=>{let k=e.trial.name;return k=k.replace(/\s*-\s*\d{1,2}\/\d{1,2}\/\d{4}$/,""),k=k.replace(/\s*\(Copy\)(\s*\(Copy\))*/g,""),k.trim()}),a=M(()=>!0),o=M(()=>e.progress?e.progress.completed+e.progress.failed:0),n=M(()=>{if(!e.progress||e.progress.total===0)return 0;const k=e.progress.completed+e.progress.failed;return Math.round(k/e.progress.total*100)}),u=M(()=>{const k=e.trial.started||e.trial.created;if(!k)return"0m";let C;if(e.trial.status==="draft")return"0m";e.trial.completed?C=e.trial.completed:C=new Date;const z=C.getTime()-k.getTime(),N=Math.floor(z/(1e3*60*60)),O=Math.floor(z%(1e3*60*60)/(1e3*60));return N>0?`${N}h ${O}m`:`${O}m`}),c=M(()=>{if(!e.progress?.avgLatencyMs)return null;const k=e.progress.avgLatencyMs;return k<1e3?`${Math.round(k)}ms`:`${(k/1e3).toFixed(1)}s`}),{calculateTemplateTokens:d,calculatePromptTokens:f,estimateTotalCost:h,sumEstimates:b,formatCost:T}=Ge();M(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let k=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)k=d(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const N=f(e.trial.spreadsheetConfig.promptPattern),I=(e.progress?.total||e.trial.progress.total)/e.trial.configurations.length;k={totalTokens:N*I,combinationCount:I,perCallAverage:N}}else if(e.trial.type==="playground")return null;if(!k||k.totalTokens===0)return null;const C=e.trial.configurations.map(N=>{const O=N.modelSnapshot;return O?h(k.totalTokens,k.combinationCount,O,N.parameters):null}).filter(Boolean);if(C.length===0)return null;const z=b(C);return`${T(z,"compact")} total`});const E=M(()=>{if(e.trial.status!=="running"||!e.progress||e.progress.completed===0)return null;const C=(Date.now()-(e.trial.started?.getTime()||0))/e.progress.completed,z=e.progress.pending*C,N=Math.floor(z/(1e3*60)),O=Math.floor(z%(1e3*60)/1e3);if(N>60){const I=Math.floor(N/60),w=N%60;return`${I}h ${w}m`}return`${N}m ${O}s`});return(k,C)=>(i(),p("div",xn,[s("div",An,[s("div",Vn,[s("h2",On,_(t.value),1),s("span",{class:te(["status-tag",`status-${k.trial.status}`])},_(k.trial.status.toUpperCase()),3)]),a.value?(i(),p("div",Dn,[s("div",Nn,[s("div",{class:"progress-fill",style:_e({width:`${n.value}%`})},null,4)]),s("div",Ln,[s("span",Mn,_(o.value)+"/"+_(k.progress?.total||0)+" ("+_(n.value)+"%) ",1),u.value?(i(),p("span",Un,[C[0]||(C[0]=s("span",{class:"stat-label"},"Duration:",-1)),C[1]||(C[1]=D()),s("span",zn,_(u.value),1)])):F("",!0),c.value?(i(),p("span",Bn,[C[2]||(C[2]=s("span",{class:"stat-label"},"Avg:",-1)),C[3]||(C[3]=D()),s("span",Wn,_(c.value),1)])):F("",!0),E.value?(i(),p("span",jn,[C[4]||(C[4]=s("span",{class:"stat-label"},"Remaining:",-1)),C[5]||(C[5]=D()),s("span",Hn,"~"+_(E.value),1)])):F("",!0)])])):F("",!0)]),F("",!0)]))}}),Gn=le(qn,[["__scopeId","data-v-248be564"]]),Jn={class:"trial-actions"},Xn={class:"action-group execution-controls"},Kn={class:"action-group data-actions"},Qn={class:"action-group management-actions"},Yn=re({__name:"TrialActionsV3",props:{trial:{},isLeader:{type:Boolean},executionState:{}},emits:["start","pause","resume","cancel","duplicate","edit","delete","export-data","export-python","refresh"],setup(l,{emit:e}){const t=l,a=e,o=q(!1),n=q(!1),u=q(!1);M(()=>t.executionState?.currentTrialId===t.trial.id);const c=M(()=>["draft","failed","cancelled"].includes(t.trial.status)),d=M(()=>t.trial.status==="running"),f=M(()=>t.trial.status==="paused"),h=M(()=>["running","paused"].includes(t.trial.status));function b(){a("start")}async function T(){o.value=!0,n.value=!1,a("pause"),setTimeout(()=>{o.value=!1},1e3)}async function E(){n.value=!0,o.value=!1,a("resume"),setTimeout(()=>{n.value=!1},3e3)}function k(){Ce.confirm({title:"Cancel trial?",content:"This will stop all pending API calls.",okText:"Cancel Trial",okType:"danger",onOk:()=>a("cancel")})}async function C(){u.value=!0,a("refresh"),setTimeout(()=>{u.value=!1},500)}function z({key:w}){w==="data"?a("export-data"):w==="python"&&a("export-python")}function N(){a("duplicate")}function O(){a("edit")}function I(){const w=t.trial.progress.total;Ce.confirm({title:"Delete trial?",content:`Delete trial and all ${w} API calls?`,okText:"Delete",okType:"danger",cancelText:"Cancel",onOk:()=>{a("delete")}})}return(w,U)=>{const $=ve,m=gt,L=vt,R=mt;return i(),p("div",Jn,[s("div",Xn,[c.value?(i(),Q($,{key:0,type:"primary",size:"large",disabled:!w.isLeader,onClick:b},{default:P(()=>[S(H(wt)),U[0]||(U[0]=D(" Start Trial "))]),_:1,__:[0]},8,["disabled"])):F("",!0),d.value?(i(),Q($,{key:1,size:"large",disabled:!w.isLeader,loading:o.value,onClick:T},{default:P(()=>[o.value?F("",!0):(i(),Q(H(Us),{key:0})),D(" "+_(o.value?"Pausing...":"Pause"),1)]),_:1},8,["disabled","loading"])):F("",!0),f.value?(i(),Q($,{key:2,type:"primary",size:"large",disabled:!w.isLeader||n.value,loading:n.value,onClick:E},{default:P(()=>[n.value?F("",!0):(i(),Q(H(wt),{key:0})),D(" "+_(n.value?"Resuming...":"Resume"),1)]),_:1},8,["disabled","loading"])):F("",!0),h.value?(i(),Q($,{key:3,danger:"",size:"large",disabled:!w.isLeader,onClick:k},{default:P(()=>[S(H(zs)),U[1]||(U[1]=D(" Cancel "))]),_:1,__:[1]},8,["disabled"])):F("",!0)]),s("div",Kn,[S($,{size:"large",loading:u.value,onClick:C,title:"Refresh trial data from database"},{default:P(()=>[u.value?(i(),Q(H(Gt),{key:1,spin:""})):(i(),Q(H(Bs),{key:0})),D(" "+_(u.value?"Refreshing...":"Refresh"),1)]),_:1},8,["loading"]),S(R,null,{overlay:P(()=>[S(L,{onClick:z},{default:P(()=>[S(m,{key:"data"},{default:P(()=>[S(H(js)),U[3]||(U[3]=D(" Export Data "))]),_:1,__:[3]}),S(m,{key:"python"},{default:P(()=>[S(H(Hs)),U[4]||(U[4]=D(" Export Python Script "))]),_:1,__:[4]})]),_:1})]),default:P(()=>[S($,{size:"large"},{default:P(()=>[U[2]||(U[2]=D(" Export ")),S(H(Ws))]),_:1,__:[2]})]),_:1})]),s("div",Qn,[S($,{size:"large",disabled:!w.isLeader,onClick:N},{default:P(()=>[S(H(ht)),U[5]||(U[5]=D(" Duplicate "))]),_:1,__:[5]},8,["disabled"]),w.trial.status==="draft"?(i(),Q($,{key:0,size:"large",disabled:!w.isLeader,onClick:O},{default:P(()=>[S(H(qs)),U[6]||(U[6]=D(" Edit "))]),_:1,__:[6]},8,["disabled"])):F("",!0),S($,{danger:"",size:"large",disabled:!w.isLeader,onClick:I},{default:P(()=>[S(H(Gs)),U[7]||(U[7]=D(" Delete "))]),_:1,__:[7]},8,["disabled"])])])}}}),Zn=le(Yn,[["__scopeId","data-v-e642c431"]]),eo={class:"snapshot-debug"},to={class:"debug-header"},so={class:"status-row"},ao={key:0,class:"badge success"},no={key:1,class:"badge warning"},oo={key:0,class:"status-row"},ro={key:0,class:"variables-section"},lo={class:"variable-header"},io={class:"var-name"},uo={class:"var-type"},co={key:0,class:"snapshot-content"},po={class:"snapshot-meta"},fo={key:0},mo={class:"snapshot-items"},vo={class:"items-preview"},go={class:"item-index"},ho={class:"item-value"},yo={key:0,class:"item-attrs"},bo={key:0,class:"more-indicator"},_o={key:1,class:"no-snapshot"},To={key:0},$o={key:1,class:"legacy-warning"},Co={class:"debug-footer"},ko=re({__name:"SnapshotDebugModal",props:{visible:{type:Boolean},trial:{},migrating:{type:Boolean}},emits:["close","migrate"],setup(l){const e=l,t=M(()=>e.trial.templateConfig?.hasSnapshots===!0),a=M(()=>e.trial.templateConfig?.variables||{});function o(f){return"snapshot"in f&&f.snapshot!=null}function n(f){return f.snapshot}function u(f){return o(f)?`${n(f).source.type} (snapshot)`:f.type==="value"?"Direct values":f.type==="list"?"List reference":"Unknown"}function c(){for(const f of Object.values(a.value))if(o(f)){const h=n(f);if(h.source?.snapshotDate)return new Date(h.source.snapshotDate).toLocaleString()}return"Unknown"}function d(){const f={trialId:e.trial.id,trialName:e.trial.name,hasSnapshots:t.value,variables:a.value};navigator.clipboard.writeText(JSON.stringify(f,null,2)),ne.success("Debug info copied to clipboard")}return(f,h)=>{const b=He,T=qe,E=ve,k=Ce;return i(),Q(k,{visible:f.visible,title:"Variable Snapshot Debug View",width:"80%",footer:null,onCancel:h[2]||(h[2]=C=>f.$emit("close"))},{default:P(()=>[s("div",eo,[s("div",to,[s("div",so,[h[5]||(h[5]=s("span",{class:"label"},"Snapshot Status:",-1)),t.value?(i(),p("span",ao,[S(H(Jt)),h[3]||(h[3]=D(" Snapshots Enabled "))])):(i(),p("span",no,[S(H(Pe)),h[4]||(h[4]=D(" Legacy Mode (No Snapshots) "))]))]),t.value?(i(),p("div",oo,[h[6]||(h[6]=s("span",{class:"label"},"Snapshot Date:",-1)),s("span",null,_(c()),1)])):F("",!0)]),t.value?(i(),p("div",ro,[h[8]||(h[8]=s("h3",null,"Variable Snapshots",-1)),(i(!0),p(Y,null,ee(a.value,(C,z)=>(i(),p("div",{key:z,class:"variable-card"},[s("div",lo,[s("span",io,_(z),1),s("span",uo,_(u(C)),1)]),o(C)?(i(),p("div",co,[s("div",po,[s("span",null,"Source: "+_(n(C).source.type),1),n(C).source.listName?(i(),p("span",fo," List: "+_(n(C).source.listName),1)):F("",!0),s("span",null,"Items: "+_(n(C).items.length),1)]),s("div",mo,[s("div",vo,[(i(!0),p(Y,null,ee(n(C).items.slice(0,5),(N,O)=>(i(),p("div",{key:O,class:"item-row"},[s("span",go,_(O+1)+".",1),s("span",ho,_(N.value),1),N.attributes&&Object.keys(N.attributes).length>0?(i(),p("span",yo,[(i(!0),p(Y,null,ee(N.attributes,(I,w)=>(i(),Q(b,{key:w,size:"small"},{default:P(()=>[D(_(w)+": "+_(I),1)]),_:2},1024))),128))])):F("",!0)]))),128)),n(C).items.length>5?(i(),p("div",bo," ... and "+_(n(C).items.length-5)+" more items ",1)):F("",!0)])])])):(i(),p("div",_o,[S(H(Pe)),h[7]||(h[7]=D(" No snapshot - using live reference ")),C.listId?(i(),p("span",To,"List ID: "+_(C.listId),1)):F("",!0)]))]))),128))])):(i(),p("div",$o,[S(T,{message:"Legacy Trial",description:"This trial was created before snapshots were implemented. Variable lists are loaded dynamically from the database, which means changes to lists will affect trial duplication.",type:"warning","show-icon":""}),S(E,{type:"primary",onClick:h[0]||(h[0]=C=>f.$emit("migrate")),loading:f.migrating,style:{"margin-top":"16px"}},{default:P(()=>[S(H(Js)),h[9]||(h[9]=D(" Migrate to Snapshots "))]),_:1,__:[9]},8,["loading"])])),s("div",Co,[S(E,{onClick:d},{default:P(()=>[S(H(ht)),h[10]||(h[10]=D(" Copy Debug Info "))]),_:1,__:[10]}),S(E,{onClick:h[1]||(h[1]=C=>f.$emit("close"))},{default:P(()=>h[11]||(h[11]=[D("Close")])),_:1,__:[11]})])])]),_:1},8,["visible"])}}}),wo=le(ko,[["__scopeId","data-v-726379cc"]]),So={class:"trial-detail-view"},Io={key:0,class:"detail-content"},Eo={class:"detail-section"},Ro={class:"detail-grid"},Fo={class:"detail-item"},Po={key:0,class:"detail-item"},xo={key:1,class:"detail-item"},Ao={class:"detail-item"},Vo={class:"detail-item"},Oo={class:"detail-section"},Do={class:"detail-grid"},No={key:0,class:"detail-item full-width"},Lo={key:1,class:"detail-item full-width"},Mo={class:"detail-item"},Uo={class:"detail-item"},zo={style:{display:"flex","align-items":"center",gap:"8px"}},Bo={key:0,class:"snapshot-badge success"},Wo={key:1,class:"snapshot-badge warning"},jo={class:"detail-item"},Ho={key:2,class:"detail-item"},qo={key:0,class:"detail-section"},Go={class:"detail-grid"},Jo={class:"detail-item"},Xo={class:"detail-item"},Ko={class:"detail-item"},Qo={class:"detail-section"},Yo={class:"model-configs"},Zo={class:"config-header"},er=["src","alt"],tr={class:"provider-name"},sr={class:"config-details"},ar={class:"config-item"},nr={class:"config-params"},or={class:"param-list"},rr={key:0,class:"config-item"},lr={class:"cost"},ir={key:1,class:"config-item"},ur={class:"cost"},dr={class:"config-item"},cr={class:"snapshot-debug"},pr=re({__name:"TrialDetailView",props:{trial:{},isCollapsed:{type:Boolean}},emits:["toggle-collapse"],setup(l){const e=l,t=q(!1),{calculateTemplateTokens:a,estimateTotalCost:o,formatCost:n}=Ge(),u=M(()=>{const $=e.trial.started||e.trial.created,L=(e.trial.completed||new Date).getTime()-$.getTime(),R=Math.floor(L/(1e3*60*60)),r=Math.floor(L%(1e3*60*60)/(1e3*60));return R>0?`${R}h ${r}m`:`${r}m`}),c=M(()=>({draft:"Not started",pending:"Waiting to start",running:"Executing API calls",paused:"Execution paused",completed:"All calls completed",failed:"Execution failed",cancelled:"Execution cancelled"})[e.trial.status]||e.trial.status),d=M(()=>e.trial.type==="template"&&e.trial.templateConfig?.variables?Object.keys(e.trial.templateConfig.variables).length:0),f=M(()=>Math.round(e.trial.progress.total*750)),h=M(()=>e.trial.type==="template"&&e.trial.templateConfig?e.trial.templateConfig.hasSnapshots===!0:!1),b=M(()=>"text"),T=M(()=>1),E=M(()=>e.trial.progress.total/T.value);function k($){return $?new Date($).toLocaleString():"N/A"}function C(){if(e.trial.templateConfig?.templateName)return e.trial.templateConfig.templateName;const $=e.trial.templateConfig?.template||"Unknown Template";return $.length>50?$.substring(0,50)+"...":$}function z(){return e.trial.spreadsheetConfig?.datasetId||"Unknown Dataset"}function N($){return{"openai-chat":"OpenAI","anthropic-messages":"Anthropic",openrouter:"OpenRouter","ollama-chat":"Ollama","ollama-generate":"Ollama"}[$]||$}function O($){}async function I(){try{ne.info("Migration feature coming soon"),t.value=!1}catch($){ne.error("Failed to migrate trial"),A.error("Migration error:",$)}}function w($){const m=$.modelSnapshot;return m?.capabilities?.inputCostPerToken?`$${((m.capabilities.inputCostPerToken+m.capabilities.outputCostPerToken)*1e3).toFixed(8)}/1k tokens`:null}function U($){if(!e.trial.configurations||!$.modelSnapshot)return null;let m=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)m=a(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else return null;if(!m||m.totalTokens===0)return null;const L=o(m.totalTokens,m.combinationCount,$.modelSnapshot,$.parameters);if(!L.meta.hasValidCost||L.cost.total.expected===-1)return null;const R=(e.trial.repeatCount||1)*L.cost.total.expected;return n({...L,cost:{...L.cost,total:{...L.cost.total,expected:R}}},"compact")}return($,m)=>{const L=ve;return i(),p("div",So,[s("div",{class:"detail-header",onClick:m[0]||(m[0]=R=>$.$emit("toggle-collapse"))},[m[3]||(m[3]=s("h3",null,"Trial Details",-1)),S(H(Xs),{class:te(["collapse-icon",{rotated:$.isCollapsed}])},null,8,["class"])]),$.isCollapsed?F("",!0):(i(),p("div",Io,[s("div",Eo,[m[9]||(m[9]=s("h4",null,"Basic Information",-1)),s("div",Ro,[s("div",Fo,[m[4]||(m[4]=s("label",null,"Created:",-1)),s("span",null,_(k($.trial.created)),1)]),$.trial.started?(i(),p("div",Po,[m[5]||(m[5]=s("label",null,"Started:",-1)),s("span",null,_(k($.trial.started)),1)])):F("",!0),$.trial.completed?(i(),p("div",xo,[m[6]||(m[6]=s("label",null,"Completed:",-1)),s("span",null,_(k($.trial.completed)),1)])):F("",!0),s("div",Ao,[m[7]||(m[7]=s("label",null,"Duration:",-1)),s("span",null,_(u.value),1)]),s("div",Vo,[m[8]||(m[8]=s("label",null,"Status:",-1)),s("span",null,_($.trial.status)+" - "+_(c.value),1)])])]),s("div",Oo,[m[19]||(m[19]=s("h4",null,"Configuration",-1)),s("div",Do,[$.trial.type==="template"?(i(),p("div",No,[m[10]||(m[10]=s("label",null,"Template:",-1)),s("span",null,_(C()),1)])):F("",!0),$.trial.type==="spreadsheet"?(i(),p("div",Lo,[m[11]||(m[11]=s("label",null,"Dataset:",-1)),s("span",null,_(z()),1)])):F("",!0),s("div",Mo,[m[12]||(m[12]=s("label",null,"Variable Lists:",-1)),s("span",null,_(d.value)+" lists",1)]),s("div",Uo,[m[16]||(m[16]=s("label",null,"Data Snapshot:",-1)),s("div",zo,[h.value?(i(),p("span",Bo,[S(H(Jt)),m[13]||(m[13]=D(" Captured "))])):(i(),p("span",Wo,[S(H(Pe)),m[14]||(m[14]=D(" Live Reference "))])),$.trial.type==="template"?(i(),Q(L,{key:2,size:"small",type:"link",onClick:m[1]||(m[1]=R=>t.value=!0)},{default:P(()=>[S(H(Xt)),m[15]||(m[15]=D(" Debug "))]),_:1,__:[15]})):F("",!0)])]),s("div",jo,[m[17]||(m[17]=s("label",null,"Token Estimate:",-1)),s("span",null,"~"+_(f.value)+" tokens",1)]),b.value?(i(),p("div",Ho,[m[18]||(m[18]=s("label",null,"Output Type:",-1)),s("span",{class:te(["output-type",`type-${b.value}`])},_(b.value),3)])):F("",!0)])]),T.value>1?(i(),p("div",qo,[m[23]||(m[23]=s("h4",null,"Repeat Configuration",-1)),s("div",Go,[s("div",Jo,[m[20]||(m[20]=s("label",null,"Times per prompt:",-1)),s("span",null,_(T.value),1)]),s("div",Xo,[m[21]||(m[21]=s("label",null,"Total combinations:",-1)),s("span",null,_(E.value),1)]),s("div",Ko,[m[22]||(m[22]=s("label",null,"Total API calls:",-1)),s("span",null,_($.trial.progress.total),1)])])])):F("",!0),s("div",Qo,[m[29]||(m[29]=s("h4",null,"Model Configurations",-1)),s("div",Yo,[(i(!0),p(Y,null,ee($.trial.configurations,(R,r)=>(i(),p("div",{key:r,class:"model-config-card"},[s("div",Zo,[(R.provider,void 0)?(i(),p("img",{key:0,src:(R.provider,void 0),alt:R.provider,class:"provider-logo"},null,8,er)):F("",!0),s("span",tr,_(N(R.provider)),1)]),s("div",sr,[s("div",ar,[m[24]||(m[24]=s("label",null,"Model:",-1)),s("span",null,_(R.modelId),1)]),s("div",nr,[m[25]||(m[25]=s("label",null,"Parameters:",-1)),s("div",or,[(i(!0),p(Y,null,ee(R.parameters,(j,K)=>(i(),p("span",{key:K,class:"param-tag"},_(K)+": "+_(j),1))),128))])]),w(R)?(i(),p("div",rr,[m[26]||(m[26]=s("label",null,"Cost Rate:",-1)),s("span",lr,_(w(R)),1)])):F("",!0),U(R)?(i(),p("div",ir,[m[27]||(m[27]=s("label",null,"Total Trial Cost:",-1)),s("span",ur,_(U(R)),1)])):F("",!0),s("div",dr,[m[28]||(m[28]=s("label",null,"Model Snapshot:",-1)),s("pre",cr,_(JSON.stringify(R.modelSnapshot,null,2)),1)])])]))),128))])])])),t.value?(i(),Q(wo,{key:1,visible:t.value,trial:$.trial,onClose:m[2]||(m[2]=R=>t.value=!1),onMigrate:I},null,8,["visible","trial"])):F("",!0)])}}}),fr=le(pr,[["__scopeId","data-v-e677baaf"]]),mr={class:"filter-bar"},vr={class:"search-container"},gr=re({__name:"TrialResultsFilterBar",props:{statusFilter:{},configFilter:{},searchQuery:{},visibleColumns:{},configurations:{},apiCalls:{},showRepeatColumn:{type:Boolean}},emits:["update:statusFilter","update:configFilter","update:searchQuery","update:visibleColumns","openPostProcessing"],setup(l,{emit:e}){const t=l,a=e,o=M(()=>{const f=[{key:"status",label:"Status"},{key:"configuration",label:"Configuration"},{key:"variables",label:"Variables"},{key:"response",label:"Response"},{key:"parsedResponse",label:"Parsed Response"},{key:"postProcessedResponse",label:"Post-Processed"},{key:"length",label:"Length"},{key:"latency",label:"Latency"}];return t.showRepeatColumn&&f.splice(2,0,{key:"repeat",label:"Repeat Index"}),f}),n=M(()=>{const f={total:t.apiCalls.length,completed:0,failed:0,running:0,pending:0};return t.apiCalls.forEach(h=>{h.status==="completed"?f.completed++:h.status==="failed"?f.failed++:h.status==="running"?f.running++:h.status==="pending"&&f.pending++}),f});function u(f){return f.modelSnapshot?.displayName||`${f.provider} - ${f.modelId}`}const c=es(f=>{const h=f.target.value;a("update:searchQuery",h)},300);function d(f){const h=[...t.visibleColumns],b=h.indexOf(f);if(b>-1)h.splice(b,1);else{const T=o.value.map(C=>C.key),E=T.indexOf(f);let k=0;for(let C=0;C<E;C++)h.includes(T[C])&&k++;h.splice(k,0,f)}a("update:visibleColumns",h)}return(f,h)=>{const b=Qs,T=Ks,E=Kt,k=ve,C=Qt,z=gt,N=vt,O=mt;return i(),p("div",mr,[S(T,{value:f.statusFilter,onChange:h[0]||(h[0]=I=>f.$emit("update:statusFilter",I)),placeholder:"Filter by status",style:{width:"150px"}},{default:P(()=>[S(b,{value:"all"},{default:P(()=>[D(" All ("+_(n.value.total)+") ",1)]),_:1}),S(b,{value:"completed"},{default:P(()=>[D(" Completed ("+_(n.value.completed)+") ",1)]),_:1}),S(b,{value:"failed"},{default:P(()=>[D(" Failed ("+_(n.value.failed)+") ",1)]),_:1}),S(b,{value:"running"},{default:P(()=>[D(" Running ("+_(n.value.running)+") ",1)]),_:1}),S(b,{value:"pending"},{default:P(()=>[D(" Pending ("+_(n.value.pending)+") ",1)]),_:1})]),_:1},8,["value"]),S(T,{value:f.configFilter,onChange:h[1]||(h[1]=I=>f.$emit("update:configFilter",I)),mode:"multiple",placeholder:"Filter by configuration",style:{width:"250px"},"max-tag-count":2},{default:P(()=>[S(b,{value:""},{default:P(()=>h[3]||(h[3]=[D("All Configurations")])),_:1,__:[3]}),(i(!0),p(Y,null,ee(f.configurations,(I,w)=>(i(),Q(b,{key:w,value:w.toString()},{default:P(()=>[D(_(u(I)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s("div",vr,[S(E,{value:f.searchQuery,onInput:H(c),placeholder:"Search in variables and responses...",style:{width:"400px"},"allow-clear":""},{prefix:P(()=>[S(H(Wt))]),_:1},8,["value","onInput"])]),S(O,null,{overlay:P(()=>[S(N,null,{default:P(()=>[(i(!0),p(Y,null,ee(o.value,I=>(i(),Q(z,{key:I.key},{default:P(()=>[S(C,{checked:f.visibleColumns.includes(I.key),disabled:I.key==="status",onChange:w=>d(I.key)},{default:P(()=>[D(_(I.label),1)]),_:2},1032,["checked","disabled","onChange"])]),_:2},1024))),128))]),_:1})]),default:P(()=>[S(k,null,{default:P(()=>[S(H(Ys)),h[4]||(h[4]=D(" Columns "))]),_:1,__:[4]})]),_:1}),S(k,{type:"primary",onClick:h[2]||(h[2]=I=>f.$emit("openPostProcessing"))},{default:P(()=>[S(H(Yt)),h[5]||(h[5]=D(" Post-Process "))]),_:1,__:[5]})])}}}),hr=le(gr,[["__scopeId","data-v-e6112af3"]]),yr={class:"modal-content"},br={class:"section"},_r={class:"info-grid"},Tr={class:"info-item"},$r={class:"monospace"},Cr={class:"info-item"},kr={class:"info-item"},wr={key:0,class:"info-item"},Sr={class:"info-item"},Ir={key:1,class:"info-item"},Er={key:2,class:"info-item"},Rr={key:3,class:"info-item"},Fr={key:0,class:"info-row"},Pr={class:"monospace"},xr={key:0,class:"section"},Ar={class:"variables-list"},Vr={class:"variable-main"},Or={class:"variable-label"},Dr={class:"variable-value"},Nr={key:0,class:"variable-attributes"},Lr={class:"attribute-label"},Mr={class:"attribute-value"},Ur={class:"section"},zr={class:"content-box prompt-display"},Br={key:1,class:"section"},Wr={key:0,class:"error-result"},jr={key:1,class:"success-result"},Hr={class:"content-box response-content"},qr={key:0,class:"parsed-content-section"},Gr={class:"content-box parsed-content"},Jr={key:1,class:"post-processed-section"},Xr={class:"content-box post-processed-content"},Kr={key:2,class:"refusal-warning"},Qr={key:3,class:"refusal-warning"},Yr={class:"extraction-config-section"},Zr={class:"config-grid"},el={key:0,class:"config-item"},tl={class:"config-value"},sl={key:1,class:"config-item"},al={class:"config-value"},nl={key:2,class:"config-item"},ol={class:"config-value pattern"},rl={key:3,class:"config-item"},ll={class:"config-value"},il={key:4,class:"config-item"},ul={class:"config-value"},dl={key:5,class:"config-item"},cl={class:"config-value"},pl={key:6,class:"config-item no-extraction"},fl={key:4,class:"post-processing-config-section"},ml={class:"config-grid"},vl={class:"config-item post-processing-item"},gl={class:"config-value"},hl={key:0,class:"config-item post-processing-item"},yl={class:"config-value"},bl={key:1,class:"config-item post-processing-item"},_l={class:"config-value pattern"},Tl={key:2,class:"config-item post-processing-item"},$l={class:"config-value"},Cl={key:3,class:"config-item post-processing-item"},kl={class:"config-value"},wl={key:4,class:"config-item post-processing-item"},Sl={class:"config-value"},Il={key:5,class:"usage-info"},El={class:"info-grid"},Rl={class:"info-item"},Fl={class:"info-item"},Pl={class:"info-item"},xl={key:0,class:"info-item"},Al={class:"raw-data-section"},Vl={class:"raw-data"},Ol={key:0},Dl={key:1,class:"raw-data"},Nl={key:2},Ll={key:3,class:"raw-data"},Ml={class:"modal-footer"},Ul={key:0,class:"footer-left"},zl={class:"position-indicator"},Bl={class:"footer-right"},Wl=re({__name:"APICallDetailModalV3",props:{visible:{type:Boolean},apiCall:{},trial:{},allApiCalls:{}},emits:["update:visible","navigate"],setup(l,{emit:e}){const t=l,a=e,o=Fs(),n=M(()=>t.allApiCalls?t.allApiCalls.findIndex(v=>v.id===t.apiCall.id):-1),u=M(()=>t.allApiCalls?.length||0),c=M(()=>n.value>0),d=M(()=>n.value>=0&&n.value<u.value-1),f=M(()=>!c.value||!t.allApiCalls?null:t.allApiCalls[n.value-1]),h=M(()=>!d.value||!t.allApiCalls?null:t.allApiCalls[n.value+1]),b=M(()=>{if(t.apiCall.duration!==void 0)return t.apiCall.duration;if(!t.apiCall.completed||!t.apiCall.created)return null;const v=new Date(t.apiCall.created).getTime();return new Date(t.apiCall.completed).getTime()-v}),T=M(()=>{if(t.apiCall.modelName){const y=t.trial.configurations[t.apiCall.configurationIndex];return y?`${y.provider} / ${t.apiCall.modelName}`:t.apiCall.modelName}const v=t.trial.configurations[t.apiCall.configurationIndex];return v?`${v.provider} / ${v.modelId}`:null}),E=M(()=>{if(t.apiCall.cost!==void 0)return t.apiCall.cost;if(!t.apiCall.result?.usage)return null;const v=t.trial.configurations[t.apiCall.configurationIndex];if(!v)return null;const y=o.models.value.find(W=>W.provider===v.provider&&W.modelId===v.modelId);if(!y?.capabilities?.inputCostPerToken&&!y?.capabilities?.outputCostPerToken)return null;const g=(t.apiCall.result.usage.prompt_tokens||0)*(y.capabilities.inputCostPerToken||0),x=(t.apiCall.result.usage.completion_tokens||0)*(y.capabilities.outputCostPerToken||0);return g+x}),k=M(()=>{if(!t.apiCall.request)return"No request data";const v=JSON.parse(JSON.stringify(t.apiCall.request));return v.headers&&Object.keys(v.headers).forEach(y=>{(y.toLowerCase().includes("authorization")||y.toLowerCase().includes("api-key")||y.toLowerCase().includes("x-api-key"))&&(v.headers[y]="[REDACTED]")}),v.body&&typeof v.body=="object"&&(v.body.api_key&&(v.body.api_key="[REDACTED]"),v.body.apiKey&&(v.body.apiKey="[REDACTED]")),JSON.stringify(v,null,2)}),C=M(()=>t.apiCall.parserId?{parserId:t.apiCall.parserId,outputType:t.trial.type==="template"?t.trial.templateConfig?.outputType:void 0,extractPattern:t.trial.type==="template"?t.trial.templateConfig?.extractPattern:void 0,refusalWords:t.trial.type==="template"?t.trial.templateConfig?.refusalWords:void 0,refusalMode:t.trial.type==="template"?t.trial.templateConfig?.refusalMode:void 0,rejectRefusalWords:t.trial.type==="template"?t.trial.templateConfig?.rejectRefusalWords:void 0}:t.trial.type!=="template"||!t.trial.templateConfig?{}:{parserId:t.trial.templateConfig.parserId,outputType:t.trial.templateConfig.outputType,extractPattern:t.trial.templateConfig.extractPattern,refusalWords:t.trial.templateConfig.refusalWords,refusalMode:t.trial.templateConfig.refusalMode,rejectRefusalWords:t.trial.templateConfig.rejectRefusalWords}),z=M(()=>{const v=C.value;return!!(v.parserId||v.outputType||v.extractPattern||v.refusalWords&&v.refusalWords.length>0)}),N=M(()=>t.trial.postProcessingConfig||null),O=M(()=>t.apiCall.response?JSON.stringify({status:t.apiCall.response.status,headers:t.apiCall.response.headers,body:t.apiCall.response.body,latencyMs:t.apiCall.response.latencyMs},null,2):"No response data available"),I=M(()=>t.apiCall.result?JSON.stringify(t.apiCall.result,null,2):"No processed result available");function w(v){return{completed:"success",failed:"error",running:"processing",pending:"warning"}[v]||"default"}function U(){const v=t.trial.configurations[t.apiCall.configurationIndex];return v?.modelSnapshot?.displayName||v?.modelId||`Configuration ${t.apiCall.configurationIndex+1}`}function $(v){return(typeof v=="string"?new Date(v):v).toLocaleString()}function m(v){return v<1e3?`${v}ms`:v<6e4?`${(v/1e3).toFixed(1)}s`:`${Math.floor(v/6e4)}m ${(v%6e4/1e3).toFixed(0)}s`}function L(v){return v==null?"null":typeof v=="string"?v:typeof v=="number"||typeof v=="boolean"?String(v):JSON.stringify(v,null,2)}function R(v){return{network_error_no_response:"Network Error (No Response)",api_error_received:"API Error Response",parsing_error:"Response Parsing Error",timeout:"Request Timeout",rate_limit:"Rate Limit Exceeded"}[v]||v}function r(){a("update:visible",!1)}function j(){f.value&&a("navigate",f.value)}function K(){h.value&&a("navigate",h.value)}function V(v){if(t.visible)switch(v.key){case"ArrowLeft":v.preventDefault(),j();break;case"ArrowRight":v.preventDefault(),K();break;case"Escape":v.preventDefault(),r();break}}me(()=>{document.addEventListener("keydown",V)}),ye(()=>{document.removeEventListener("keydown",V)});async function G(){const v={id:t.apiCall.id,status:t.apiCall.status,configuration:U(),provider:T.value,variables:t.apiCall.variables,variableAttributes:t.apiCall.variableAttributes,prompt:t.apiCall.prompt,fullApiResponse:t.apiCall.response,processedResult:t.apiCall.result,extractionConfig:C.value,postProcessingConfig:N.value,created:t.apiCall.created,completed:t.apiCall.completed,duration:b.value?`${b.value}ms`:null,cost:E.value?`$${E.value.toFixed(4)}`:null},y=JSON.stringify(v,null,2);try{await navigator.clipboard.writeText(y),ne.success("Details copied to clipboard!")}catch(g){A.error("Failed to copy to clipboard",g),ne.error("Failed to copy to clipboard")}}return(v,y)=>{const g=He,x=qe,W=ea,X=Zs,Z=ve,ae=Ce;return i(),Q(ae,{open:v.visible,onCancel:y[0]||(y[0]=ce=>a("update:visible",!1)),title:"API Call Details",width:1400,footer:null,"body-style":{padding:0,height:"85vh",display:"flex",flexDirection:"column"},centered:!0,"destroy-on-close":!0,class:"api-call-detail-modal"},{default:P(()=>[s("div",yr,[s("div",br,[y[10]||(y[10]=s("h3",null,"Overview",-1)),s("div",_r,[s("div",Tr,[y[1]||(y[1]=s("label",null,"Call ID:",-1)),s("span",$r,_(v.apiCall.id),1)]),s("div",Cr,[y[2]||(y[2]=s("label",null,"Status:",-1)),S(g,{color:w(v.apiCall.status)},{default:P(()=>[D(_(v.apiCall.status.toUpperCase()),1)]),_:1},8,["color"])]),s("div",kr,[y[3]||(y[3]=s("label",null,"Configuration:",-1)),s("span",null,_(U()),1)]),v.apiCall.repeatIndex!==void 0?(i(),p("div",wr,[y[4]||(y[4]=s("label",null,"Repeat:",-1)),s("span",null,"#"+_(v.apiCall.repeatIndex+1),1)])):F("",!0),s("div",Sr,[y[5]||(y[5]=s("label",null,"Created:",-1)),s("span",null,_($(v.apiCall.created)),1)]),v.apiCall.completed?(i(),p("div",Ir,[y[6]||(y[6]=s("label",null,"Completed:",-1)),s("span",null,_($(v.apiCall.completed)),1)])):F("",!0),b.value?(i(),p("div",Er,[y[7]||(y[7]=s("label",null,"Duration:",-1)),s("span",null,_(m(b.value)),1)])):F("",!0),v.apiCall.result?.latency?(i(),p("div",Rr,[y[8]||(y[8]=s("label",null,"API Latency:",-1)),s("span",null,_(v.apiCall.result.latency)+"ms",1)])):F("",!0)]),T.value?(i(),p("div",Fr,[y[9]||(y[9]=s("label",null,"Provider/Model:",-1)),s("span",Pr,_(T.value),1)])):F("",!0)]),v.apiCall.variables&&Object.keys(v.apiCall.variables).length>0?(i(),p("div",xr,[y[11]||(y[11]=s("h3",null,"Variables",-1)),s("div",Ar,[(i(!0),p(Y,null,ee(v.apiCall.variables,(ce,ge)=>(i(),p("div",{key:ge,class:"variable-group"},[s("div",Vr,[s("label",Or,_(ge)+":",1),s("span",Dr,_(ce),1)]),v.apiCall.variableAttributes&&v.apiCall.variableAttributes[ge]?(i(),p("div",Nr,[(i(!0),p(Y,null,ee(v.apiCall.variableAttributes[ge],(Qe,De)=>(i(),p("div",{key:De,class:"attribute-item"},[s("label",Lr,_(De)+":",1),s("span",Mr,_(Qe),1)]))),128))])):F("",!0)]))),128))])])):F("",!0),s("div",Ur,[y[12]||(y[12]=s("h3",null,"Resolved Prompt",-1)),s("div",zr,_(v.apiCall.prompt),1)]),v.apiCall.result?(i(),p("div",Br,[y[36]||(y[36]=s("h3",null,"Response",-1)),v.apiCall.status==="failed"&&v.apiCall.result.error?(i(),p("div",Wr,[S(x,{type:"error",message:v.apiCall.result.error,description:v.apiCall.result.errorType?`Error Type: ${R(v.apiCall.result.errorType)}`:void 0,"show-icon":""},null,8,["message","description"])])):v.apiCall.result.content?(i(),p("div",jr,[s("div",Hr,_(v.apiCall.result.content),1),v.apiCall.result.parsedContent!==void 0?(i(),p("div",qr,[y[13]||(y[13]=s("h4",null,"Extracted Value (Original)",-1)),s("div",Gr,_(L(v.apiCall.result.parsedContent)),1)])):F("",!0),v.apiCall.result.postParsedContent!==void 0?(i(),p("div",Jr,[y[14]||(y[14]=s("h4",null,"Post-Processed Value",-1)),s("div",Xr,_(L(v.apiCall.result.postParsedContent)),1)])):F("",!0),v.apiCall.result.refused?(i(),p("div",Kr,[S(x,{type:"warning",message:"Response flagged as refusal (Original Extraction)",description:"This response matched configured refusal patterns","show-icon":""})])):F("",!0),v.apiCall.result.postRefused?(i(),p("div",Qr,[S(x,{type:"warning",message:"Response flagged as refusal (Post-Processing)",description:"This response matched post-processing refusal patterns","show-icon":""})])):F("",!0),s("div",Yr,[y[22]||(y[22]=s("h4",null,"Original Extraction Configuration",-1)),s("div",Zr,[C.value.parserId?(i(),p("div",el,[y[15]||(y[15]=s("label",null,"Parser ID:",-1)),s("span",tl,_(C.value.parserId),1)])):F("",!0),C.value.outputType?(i(),p("div",sl,[y[16]||(y[16]=s("label",null,"Output Type:",-1)),s("span",al,_(C.value.outputType),1)])):F("",!0),C.value.extractPattern?(i(),p("div",nl,[y[17]||(y[17]=s("label",null,"Extract Pattern:",-1)),s("span",ol,_(C.value.extractPattern),1)])):F("",!0),C.value.refusalWords&&C.value.refusalWords.length>0?(i(),p("div",rl,[y[18]||(y[18]=s("label",null,"Refusal Words:",-1)),s("span",ll,_(C.value.refusalWords.join(", ")),1)])):F("",!0),C.value.refusalMode?(i(),p("div",il,[y[19]||(y[19]=s("label",null,"Refusal Mode:",-1)),s("span",ul,_(C.value.refusalMode==="parse_anyway"?"Parse normally":"Replace with REFUSED"),1)])):C.value.rejectRefusalWords!==void 0?(i(),p("div",dl,[y[20]||(y[20]=s("label",null,"Reject on Refusal (Legacy):",-1)),s("span",cl,_(C.value.rejectRefusalWords?"Yes":"No"),1)])):F("",!0),z.value?F("",!0):(i(),p("div",pl,y[21]||(y[21]=[s("span",{class:"no-config-message"},"No extraction configuration set for this trial",-1)])))])]),N.value&&N.value.enabled?(i(),p("div",fl,[y[30]||(y[30]=s("h4",null,"Post-Processing Configuration",-1)),s("div",ml,[s("div",vl,[y[24]||(y[24]=s("label",null,"Status:",-1)),s("span",gl,[S(g,{color:"processing"},{default:P(()=>y[23]||(y[23]=[D("Enabled")])),_:1,__:[23]})])]),N.value.outputType?(i(),p("div",hl,[y[25]||(y[25]=s("label",null,"Output Type:",-1)),s("span",yl,_(N.value.outputType),1)])):F("",!0),N.value.extractPattern?(i(),p("div",bl,[y[26]||(y[26]=s("label",null,"Extract Pattern:",-1)),s("span",_l,_(N.value.extractPattern),1)])):F("",!0),N.value.refusalWords&&N.value.refusalWords.length>0?(i(),p("div",Tl,[y[27]||(y[27]=s("label",null,"Refusal Words:",-1)),s("span",$l,_(N.value.refusalWords.join(", ")),1)])):F("",!0),N.value.rejectRefusalWords!==void 0?(i(),p("div",Cl,[y[28]||(y[28]=s("label",null,"Reject on Refusal:",-1)),s("span",kl,_(N.value.rejectRefusalWords?"Yes":"No"),1)])):F("",!0),N.value.updatedAt?(i(),p("div",wl,[y[29]||(y[29]=s("label",null,"Last Updated:",-1)),s("span",Sl,_($(N.value.updatedAt)),1)])):F("",!0)])])):F("",!0),v.apiCall.result.usage?(i(),p("div",Il,[y[35]||(y[35]=s("h4",null,"Token Usage",-1)),s("div",El,[s("div",Rl,[y[31]||(y[31]=s("label",null,"Prompt Tokens:",-1)),s("span",null,_(v.apiCall.result.usage.prompt_tokens||0),1)]),s("div",Fl,[y[32]||(y[32]=s("label",null,"Completion Tokens:",-1)),s("span",null,_(v.apiCall.result.usage.completion_tokens||0),1)]),s("div",Pl,[y[33]||(y[33]=s("label",null,"Total Tokens:",-1)),s("span",null,_(v.apiCall.result.usage.total_tokens||0),1)]),E.value?(i(),p("div",xl,[y[34]||(y[34]=s("label",null,"Cost:",-1)),s("span",null,"$"+_(E.value.toFixed(4)),1)])):F("",!0)])])):F("",!0)])):F("",!0)])):F("",!0),S(X,{ghost:""},{default:P(()=>[S(W,{key:"raw",header:"Raw Data"},{default:P(()=>[s("div",Al,[y[37]||(y[37]=s("h4",null,"HTTP Request",-1)),s("pre",Vl,_(k.value),1),v.apiCall.response?(i(),p("h4",Ol,"Full API Response")):F("",!0),v.apiCall.response?(i(),p("pre",Dl,_(O.value),1)):F("",!0),v.apiCall.result?(i(),p("h4",Nl,"Processed Result")):F("",!0),v.apiCall.result?(i(),p("pre",Ll,_(I.value),1)):F("",!0)])]),_:1})]),_:1})]),s("div",Ml,[v.allApiCalls&&u.value>1?(i(),p("div",Ul,[S(Z,{onClick:j,disabled:!c.value,size:"large",class:"nav-button"},{default:P(()=>y[38]||(y[38]=[D(" ← Previous ")])),_:1,__:[38]},8,["disabled"]),s("span",zl,_(n.value+1)+" of "+_(u.value),1),S(Z,{onClick:K,disabled:!d.value,size:"large",class:"nav-button"},{default:P(()=>y[39]||(y[39]=[D(" Next → ")])),_:1,__:[39]},8,["disabled"])])):F("",!0),s("div",Bl,[S(Z,{onClick:r,size:"large"},{default:P(()=>y[40]||(y[40]=[D(" Close ")])),_:1,__:[40]}),S(Z,{type:"primary",onClick:G,size:"large"},{default:P(()=>[S(H(ht)),y[41]||(y[41]=D(" Copy Details "))]),_:1,__:[41]})])])]),_:1},8,["open"])}}}),rs=le(Wl,[["__scopeId","data-v-f7da98a4"]]),jl={class:"post-processing-modal"},Hl={key:2,class:"current-extraction"},ql={class:"parser-info"},Gl={class:"parser-name"},Jl={key:3,class:"current-post-processing"},Xl={class:"parser-info"},Kl={class:"parser-name"},Ql={key:4,class:"test-results"},Yl={class:"footer-container"},Zl={key:0,class:"footer-statistics"},ei={class:"stat-inline"},ti={class:"stat-inline"},si={class:"stat-inline"},ai={class:"stat-inline"},ni={key:0,class:"stat-sample-note"},oi={key:1,class:"footer-progress"},ri={class:"processing-message"},li={class:"footer-buttons"},ii=re({__name:"PostProcessingModalV2",props:{visible:{type:Boolean},trial:{}},emits:["close"],setup(l,{emit:e}){const t=l,a=e,o=Je(),n=ua(),u=q(t.visible),c=q(!1),d=q(!1),f=q(!1),h=q(null),b=q({postParserId:null}),T=q(""),E=q(0),k=q([]),C=q(null),z=[{title:"Variables",dataIndex:"variables",key:"variables",width:200,customRender:({text:V})=>Object.entries(V).map(([G,v])=>`${G}: ${v}`).join(", ")},{title:"Original",dataIndex:"original",key:"original",slots:{customRender:"original"}},{title:"Post-Processed",dataIndex:"postProcessed",key:"postProcessed",slots:{customRender:"postProcessed"}},{title:"Changed",dataIndex:"changed",key:"changed",width:100,slots:{customRender:"changed"}}],N=M(()=>t.trial.parserId?n.parsers.find(V=>V.id===t.trial.parserId):null),O=M(()=>t.trial.postParserId?n.parsers.find(V=>V.id===t.trial.postParserId):null);function I(V){switch(V){case"regex":return"blue";case"javascript":return"orange";case"python":return"green";default:return"default"}}function w(V){return V===void 0?"(no match)":V===null?"null":typeof V=="string"&&V.length>50?V.substring(0,50)+"...":String(V)}function U(){d.value=!0}function $(V){h.value=V,f.value=!0}async function m(V,G){if(!V||!G){k.value=[],C.value=null;return}await L(G),await R(G)}async function L(V){const G=o.apiCalls.value.filter(y=>y.result?.content).slice(0,10),v=[];for(const y of G){const g=await Ct.executeParser(y.result.content,V);v.push({id:y.id,variables:y.variables,original:y.result.parsedContent,postProcessed:g.success?g.value:null,changed:g.success&&g.value!==y.result.parsedContent})}k.value=v}async function R(V){if(!o.apiCalls.value.length){C.value=null;return}const G=o.apiCalls.value,v=G.length,y=G.filter(ce=>ce.result?.content),g=y.length,x=Math.min(50,g),W=y.slice(0,x);let X=0,Z=0;for(const ce of W){const ge=await Ct.executeParser(ce.result.content,V);ge.success&&ge.value!==void 0&&(X++,ge.value!==ce.result.parsedContent&&Z++)}const ae=x<g;if(ae&&x>0){const ce=g/x;X=Math.round(X*ce),Z=Math.round(Z*ce)}C.value={total:v,withContent:g,matches:X,changed:Z,sampled:ae,sampleSize:x}}async function r(){c.value=!0,T.value="Clearing post-processing...";try{const V=await It.updatePostParserId(t.trial.id,null,!1);if(V.ok)b.value.postParserId=null,k.value=[],C.value=null,ne.success("Post-processing cleared"),await o.refreshFromDatabase(t.trial.id);else throw V.error}catch(V){A.error("Failed to clear post-processing:",V),ne.error("Failed to clear post-processing")}finally{c.value=!1,T.value=""}}async function j(){if(!b.value.postParserId){ne.warning("Please select a parser");return}c.value=!0,E.value=0;try{const V=o.apiCalls.value.filter(g=>g.status==="completed"&&g.result?.content),G=V.length>0;let v=!1;if(G){const W=(n.parsers.find(X=>X.id===b.value.postParserId)?.type||"parser")==="python"?`Apply post-processing to ${V.length} existing calls?

Note: Python parsers may take several minutes for large trials.`:`Apply post-processing to ${V.length} existing calls?`;v=confirm(W)}v?(T.value=`Applying to ${V.length} calls...`,E.value=10):(T.value="Saving configuration...",E.value=50);const y=await It.updatePostParserId(t.trial.id,b.value.postParserId,v);if(y.ok)E.value=90,T.value="Refreshing data...",await o.refreshFromDatabase(t.trial.id),E.value=100,T.value="Complete!",ne.success(v?`Post-processing applied to ${V.length} calls`:"Post-processing configured for future calls"),c.value=!1,setTimeout(()=>{K()},1e3);else throw y.error}catch(V){A.error("Failed to apply post-processing:",V),ne.error("Failed to apply post-processing"),c.value=!1,T.value="",E.value=0}}function K(){c.value||a("close")}return me(async()=>{if(await n.initialize(),t.trial.postParserId){b.value.postParserId=t.trial.postParserId;const V=n.parsers.find(G=>G.id===t.trial.postParserId);V&&(await L(V),await R(V))}else t.trial.postProcessingConfig?.enabled&&ne.info("Legacy post-processing config detected. Please select a parser to continue.")}),oe(()=>t.visible,V=>{u.value=V}),oe(u,V=>{!V&&!c.value&&a("close")}),(V,G)=>{const v=qe,y=He,g=ta,x=sa,W=aa,X=ve,Z=Ce;return i(),Q(Z,{visible:u.value,"onUpdate:visible":G[1]||(G[1]=ae=>u.value=ae),title:"Post-Process Extraction",width:"80%","mask-closable":!c.value,closable:!c.value,onCancel:K},{footer:P(()=>[s("div",Yl,[C.value&&b.value.postParserId&&!c.value?(i(),p("div",Zl,[s("span",ei,[G[5]||(G[5]=s("span",{class:"stat-label"},"Total:",-1)),G[6]||(G[6]=D()),s("strong",null,_(C.value.total),1)]),G[13]||(G[13]=s("span",{class:"stat-divider"},"|",-1)),s("span",ti,[G[7]||(G[7]=s("span",{class:"stat-label"},"With Content:",-1)),G[8]||(G[8]=D()),s("strong",null,_(C.value.withContent),1)]),G[14]||(G[14]=s("span",{class:"stat-divider"},"|",-1)),s("span",si,[G[9]||(G[9]=s("span",{class:"stat-label"},"Est. Matches:",-1)),G[10]||(G[10]=D()),s("strong",null,_(C.value.matches),1)]),G[15]||(G[15]=s("span",{class:"stat-divider"},"|",-1)),s("span",ai,[G[11]||(G[11]=s("span",{class:"stat-label"},"Est. Changed:",-1)),G[12]||(G[12]=D()),s("strong",null,_(C.value.changed),1)]),C.value.sampled?(i(),p("span",ni," ("+_(C.value.sampleSize)+" samples) ",1)):F("",!0)])):F("",!0),c.value?(i(),p("div",oi,[s("div",ri,_(T.value),1),S(W,{percent:E.value,status:E.value===100?"success":"active","stroke-width":4,style:{width:"100%"}},null,8,["percent","status"])])):F("",!0),s("div",li,[O.value?(i(),Q(X,{key:0,onClick:r,disabled:c.value,danger:""},{default:P(()=>G[16]||(G[16]=[D(" Clear Post-Processing ")])),_:1,__:[16]},8,["disabled"])):F("",!0),S(X,{onClick:K,disabled:c.value},{default:P(()=>[D(_(c.value?"Processing...":"Close"),1)]),_:1},8,["disabled"]),S(X,{type:"primary",onClick:j,loading:c.value,disabled:!b.value.postParserId||b.value.postParserId===V.trial.postParserId},{default:P(()=>[D(_(c.value?T.value:"Apply Post-Processing"),1)]),_:1},8,["loading","disabled"])])])]),default:P(()=>[s("div",jl,[V.trial.status==="running"?(i(),Q(v,{key:0,message:"Trial is currently running",description:"Post-processing will apply to all completed calls and future results as they arrive.",type:"info","show-icon":"",style:{"margin-bottom":"20px"}})):V.trial.status==="draft"?(i(),Q(v,{key:1,message:"Trial not started",description:"Configure post-processing now. It will apply when the trial runs.",type:"warning","show-icon":"",style:{"margin-bottom":"20px"}})):F("",!0),N.value?(i(),p("div",Hl,[G[2]||(G[2]=s("h4",null,"Current Primary Parser",-1)),s("div",ql,[s("span",Gl,_(N.value.name),1),S(y,{color:I(N.value.type)},{default:P(()=>[D(_(N.value.type),1)]),_:1},8,["color"]),S(y,null,{default:P(()=>[D(_(N.value.outputType),1)]),_:1})])])):F("",!0),O.value?(i(),p("div",Jl,[G[3]||(G[3]=s("h4",null,"Active Post-Processing Parser",-1)),s("div",Xl,[s("span",Kl,_(O.value.name),1),S(y,{color:I(O.value.type)},{default:P(()=>[D(_(O.value.type),1)]),_:1},8,["color"]),S(y,null,{default:P(()=>[D(_(O.value.outputType),1)]),_:1})])])):F("",!0),S(g,{label:O.value?"Change Post-Processing Parser":"Select Post-Processing Parser"},{default:P(()=>[S(ia,{modelValue:b.value.postParserId,"onUpdate:modelValue":G[0]||(G[0]=ae=>b.value.postParserId=ae),"allow-create":!0,"show-preview":!0,placeholder:"Select or create a parser for post-processing",onCreate:U,onTest:$,onChange:m},null,8,["modelValue"])]),_:1},8,["label"]),k.value.length>0&&b.value.postParserId?(i(),p("div",Ql,[G[4]||(G[4]=s("h4",null,"Preview Results (First 10 calls)",-1)),S(x,{columns:z,"data-source":k.value,pagination:!1,size:"small",scroll:{x:800}},{original:P(({text:ae})=>[s("code",null,_(w(ae)),1)]),postProcessed:P(({text:ae,record:ce})=>[s("code",{class:te({"value-changed":ce.changed})},_(w(ae)),3)]),changed:P(({text:ae})=>[S(y,{color:ae?"green":"default"},{default:P(()=>[D(_(ae?"Changed":"Same"),1)]),_:2},1032,["color"])]),_:1},8,["data-source"])])):F("",!0)])]),_:1},8,["visible","mask-closable","closable"])}}}),ui=le(ii,[["__scopeId","data-v-17edda1c"]]),di={class:"trial-results-table"},ci={class:"table-container"},pi={class:"virtual-header"},fi={key:0,class:"col-status header-cell"},mi={key:1,class:"col-configuration header-cell"},vi={key:2,class:"col-repeat header-cell"},gi={key:3,class:"col-variables header-cell"},hi={key:4,class:"col-response header-cell"},yi={key:5,class:"col-parsed header-cell"},bi={key:6,class:"col-post-processed header-cell"},_i={key:0,class:"post-process-indicator"},Ti={key:7,class:"col-length header-cell"},$i={key:8,class:"col-latency header-cell"},Ci=["onClick"],ki={key:0,class:"col-status cell"},wi={class:"status-cell"},Si={class:"status-time"},Ii={key:1,class:"col-configuration cell"},Ei={key:2,class:"col-repeat cell"},Ri={key:3,class:"col-variables cell"},Fi={class:"variable-tags"},Pi={key:0,class:"var-item"},xi={key:1,class:"var-item"},Ai={key:2},Vi={key:3},Oi={key:4,class:"col-response cell"},Di={class:"response-content"},Ni={key:5,class:"col-parsed cell"},Li={class:"parsed-content"},Mi={key:6,class:"col-post-processed cell"},Ui={class:"parsed-content"},zi={key:7,class:"col-length cell"},Bi={key:8,class:"col-latency cell"},Wi={key:1,class:"results-table"},ji={key:0,class:"col-status"},Hi={key:1,class:"col-configuration"},qi={key:2,class:"col-repeat"},Gi={key:3,class:"col-variables"},Ji={key:4,class:"col-response"},Xi={key:5,class:"col-parsed"},Ki={key:6,class:"col-post-processed"},Qi={key:0,class:"post-process-indicator"},Yi={key:7,class:"col-length"},Zi={key:8,class:"col-latency"},eu=["onClick"],tu={key:0,class:"col-status"},su={class:"status-cell"},au={class:"status-time"},nu={key:1,class:"col-configuration"},ou={key:2,class:"col-repeat"},ru={key:3,class:"col-variables"},lu={class:"variable-tags"},iu={key:0,class:"var-item"},uu={key:1,class:"var-item"},du={key:2},cu={key:3},pu={key:4,class:"col-response"},fu={class:"response-content"},mu={key:5,class:"col-parsed"},vu={class:"parsed-content"},gu={key:6,class:"col-post-processed"},hu={class:"parsed-content"},yu={key:7,class:"col-length"},bu={key:8,class:"col-latency"},_u={key:0},Tu=["colspan"],$u={key:0},Cu={key:1},xt="trial-results-visible-columns",ku=re({__name:"TrialResultsTableV3",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(l){const e=l,t=q("all"),a=q([]),o=q(""),n=q(["status","configuration","variables","response","parsedResponse","postProcessedResponse","length","latency"]),u=q(null),c=q(!1),d=Je(),f=M(()=>d.apiCalls?.value||[]),h=M(()=>e.apiCalls||f.value);oe(h,(v,y)=>{const g=performance.now();A.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 calls data changed from ${y?.length||0} to ${v.length} calls`),setTimeout(()=>{const x=performance.now();A.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 reactive update completed in ${(x-g).toFixed(1)}ms`)},0)});const b=v=>{if(!o.value)return v;const y=o.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),g=new RegExp(`(${y})`,"gi");return v.replace(g,"<mark>$1</mark>")},T=M(()=>{const v=performance.now();if(!(t.value!=="all"||a.value.length>0||o.value))return performance.now()-v>5&&A.info(`V4_OPTIMIZE: No filtering needed, returning ${h.value.length} calls directly`),h.value;let g=h.value.filter(W=>{if(t.value!=="all"&&W.status!==t.value||a.value.length>0&&!a.value.includes(String(W.configurationIndex)))return!1;if(o.value){const X=o.value.toLowerCase();if(!(W.prompt?.toLowerCase().includes(X)||W.result?.content?.toLowerCase().includes(X)||W.result?.error?.toLowerCase().includes(X)))return!1}return!0});const x=performance.now();return x-v>10&&A.info(`V4_OPTIMIZE: Filtered ${h.value.length} → ${g.length} calls in ${(x-v).toFixed(1)}ms`),g});oe(T,(v,y)=>{const g=performance.now();A.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls changed from ${y?.length||0} to ${v.length} items`),setTimeout(()=>{const x=performance.now();A.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls render completed in ${(x-g).toFixed(1)}ms`)},0)});const E=M(()=>h.value),k=M(()=>h.value.length),C=M(()=>e.trial.configurations.some(v=>v.repeatCount>1)),z=M(()=>60);function N(v){}function O(v){const y=e.trial.configurations[v];return y?y.modelSnapshot?.displayName||`${y.modelId}`:`Config ${v+1}`}function I(v){return v.status==="pending"?"Waiting...":v.status==="running"?"Processing...":v.status==="failed"?v.result?.errorType==="refusal_detected"||v.result?.error==="REFUSED"?v.result?.content||"REFUSED":v.result?.error||"Error occurred":v.result?.content||""}function w(v){if(!v.result)return"";if(v.result.parsedContent!==void 0){const y=v.result.parsedContent;return y===null?"null":typeof y=="string"?y:typeof y=="number"||typeof y=="boolean"?String(y):JSON.stringify(y)}return""}function U(v){if(!v.result||v.result.postParsedContent===void 0)return"";const y=v.result.postParsedContent;return y===null?"null":y==="REFUSED"||v.result.postRefused?"REFUSED":typeof y=="string"?y:typeof y=="number"||typeof y=="boolean"?String(y):JSON.stringify(y)}function $(v){const y=v.result?.content||"";if(!y)return"";const g=y.length;return g>1e3?`${(g/1e3).toFixed(1)}k chars`:`${g} chars`}function m(v){return v?v<1e3?`${v}ms`:`${(v/1e3).toFixed(1)}s`:""}function L(v){return v.status==="completed"&&v.result?.refused?"REFUSED":v.status.toUpperCase()}function R(v){return v.status==="completed"&&v.result?.refused?"status-refused":`status-${v.status}`}function r(v){let y;switch(v.status){case"completed":case"failed":y=v.completed;break;case"running":y=v.started;break;case"pending":case"cancelled":y=v.created;break}if(!y)return"";const g=new Date(y),x=g.getHours().toString().padStart(2,"0"),W=g.getMinutes().toString().padStart(2,"0"),X=g.getSeconds().toString().padStart(2,"0");return`  ${x}:${W}:${X}`}function j(v){return v?v<1e3?"latency-fast":v<5e3?"latency-medium":"latency-slow":""}function K(v){return b(v)}function V(v){u.value=v}function G(v){u.value=v}return oe(n,v=>{localStorage.setItem(xt,JSON.stringify(v))},{deep:!0}),me(()=>{const v=performance.now();A.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 MOUNTED with ${h.value.length} calls`);const y=localStorage.getItem(xt);if(y)try{n.value=JSON.parse(y)}catch{}we(()=>{const g=performance.now();A.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 DOM ready in ${(g-v).toFixed(1)}ms`),setTimeout(()=>{const x=performance.now();A.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 virtual scrolling ready in ${(x-v).toFixed(1)}ms`)},100)}),setTimeout(()=>{const g=performance.now();A.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 mount completed in ${(g-v).toFixed(1)}ms`)},0)}),xe(()=>{A.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 ACTIVATED (cache hit) with ${h.value.length} calls`)}),Ae(()=>{A.info("V4_TRIAL_SWITCH: TrialResultsTableV3 DEACTIVATED (cached)")}),ye(()=>{A.info("V4_TRIAL_SWITCH: TrialResultsTableV3 UNMOUNTED (evicted)")}),(v,y)=>{const g=Lt("dompurify-html");return i(),p("div",di,[S(hr,{"status-filter":t.value,"onUpdate:statusFilter":y[0]||(y[0]=x=>t.value=x),"config-filter":a.value,"onUpdate:configFilter":y[1]||(y[1]=x=>a.value=x),"search-query":o.value,"onUpdate:searchQuery":y[2]||(y[2]=x=>o.value=x),"visible-columns":n.value,"onUpdate:visibleColumns":y[3]||(y[3]=x=>n.value=x),configurations:v.trial.configurations,"api-calls":E.value,"show-repeat-column":C.value,onOpenPostProcessing:y[4]||(y[4]=x=>c.value=!0)},null,8,["status-filter","config-filter","search-query","visible-columns","configurations","api-calls","show-repeat-column"]),s("div",ci,[k.value>100?(i(),Q(H(Ke),{key:0,class:"results-scroller",items:Array.from(T.value),"item-size":z.value,"key-field":"id",buffer:10,onVisibleRange:N},{before:P(()=>[s("div",pi,[n.value.includes("status")?(i(),p("div",fi,"Status")):F("",!0),n.value.includes("configuration")?(i(),p("div",mi,"Configuration")):F("",!0),n.value.includes("repeat")&&C.value?(i(),p("div",vi,"Repeat")):F("",!0),n.value.includes("variables")?(i(),p("div",gi,"Variables")):F("",!0),n.value.includes("response")?(i(),p("div",hi,"Response")):F("",!0),n.value.includes("parsedResponse")?(i(),p("div",yi,"Parsed Response")):F("",!0),n.value.includes("postProcessedResponse")?(i(),p("div",bi,[y[7]||(y[7]=D(" Post-Processed ")),v.trial.postProcessingConfig?.enabled?(i(),p("span",_i,"✨")):F("",!0)])):F("",!0),n.value.includes("length")?(i(),p("div",Ti,"Length")):F("",!0),n.value.includes("latency")?(i(),p("div",$i,"Latency")):F("",!0)])]),default:P(({item:x})=>[s("div",{class:te(["result-row virtual-row",`status-${x.status}`]),onClick:W=>V(x)},[n.value.includes("status")?(i(),p("div",ki,[s("div",wi,[s("span",{class:te(["status-tag",R(x)])},_(L(x)),3),s("span",Si,_(r(x)),1)])])):F("",!0),n.value.includes("configuration")?(i(),p("div",Ii,_(O(x.configurationIndex)),1)):F("",!0),n.value.includes("repeat")&&C.value?(i(),p("div",Ei," #"+_((x.repeatIndex||0)+1),1)):F("",!0),n.value.includes("variables")?(i(),p("div",Ri,[s("div",Fi,[(i(!0),p(Y,null,ee(Object.entries(x.variables),([W,X],Z)=>(i(),p(Y,{key:W},[y[9]||(y[9]=s("span",{class:"var-bullet"},"• ",-1)),Object.keys(x.variables).length<=2?(i(),p("span",Pi,_(W)+": "+_(X),1)):(i(),p("span",xi,_(X),1)),Object.keys(x.variables).length===2&&Z===0?(i(),p("span",Ai,y[8]||(y[8]=[s("br",null,null,-1)]))):Z<Object.keys(x.variables).length-1?(i(),p("span",Vi,_("  "))):F("",!0)],64))),128))])])):F("",!0),n.value.includes("response")?(i(),p("div",Oi,[Ee(s("div",Di,null,512),[[g,K(I(x)),"apiResponse"]])])):F("",!0),n.value.includes("parsedResponse")?(i(),p("div",Ni,[s("div",Li,_(w(x)),1)])):F("",!0),n.value.includes("postProcessedResponse")?(i(),p("div",Mi,[s("div",Ui,_(U(x)),1)])):F("",!0),n.value.includes("length")?(i(),p("div",zi,_($(x)),1)):F("",!0),n.value.includes("latency")?(i(),p("div",Bi,[s("span",{class:te(j(x.response?.latencyMs))},_(m(x.response?.latencyMs)),3)])):F("",!0)],10,Ci)]),_:1},8,["items","item-size"])):(i(),p("table",Wi,[s("thead",null,[s("tr",null,[n.value.includes("status")?(i(),p("th",ji,"Status")):F("",!0),n.value.includes("configuration")?(i(),p("th",Hi,"Configuration")):F("",!0),n.value.includes("repeat")&&C.value?(i(),p("th",qi,"Repeat")):F("",!0),n.value.includes("variables")?(i(),p("th",Gi,"Variables")):F("",!0),n.value.includes("response")?(i(),p("th",Ji,"Response")):F("",!0),n.value.includes("parsedResponse")?(i(),p("th",Xi,"Parsed Response")):F("",!0),n.value.includes("postProcessedResponse")?(i(),p("th",Ki,[y[10]||(y[10]=D(" Post-Processed ")),v.trial.postProcessingConfig?.enabled?(i(),p("span",Qi,"✨")):F("",!0)])):F("",!0),n.value.includes("length")?(i(),p("th",Yi,"Length")):F("",!0),n.value.includes("latency")?(i(),p("th",Zi,"Latency")):F("",!0)])]),s("tbody",null,[(i(!0),p(Y,null,ee(T.value,x=>(i(),p("tr",{key:x.id,class:te(["result-row",`status-${x.status}`]),onClick:W=>V(x)},[n.value.includes("status")?(i(),p("td",tu,[s("div",su,[s("span",{class:te(["status-tag",R(x)])},_(L(x)),3),s("span",au,_(r(x)),1)])])):F("",!0),n.value.includes("configuration")?(i(),p("td",nu,_(O(x.configurationIndex)),1)):F("",!0),n.value.includes("repeat")&&C.value?(i(),p("td",ou," #"+_((x.repeatIndex||0)+1),1)):F("",!0),n.value.includes("variables")?(i(),p("td",ru,[s("div",lu,[(i(!0),p(Y,null,ee(x.variables,(W,X,Z)=>(i(),p(Y,{key:X},[y[12]||(y[12]=s("span",{class:"var-bullet"},"• ",-1)),Object.keys(x.variables).length<=2?(i(),p("span",iu,_(X)+": "+_(W),1)):(i(),p("span",uu,_(W),1)),Object.keys(x.variables).length===2&&Z===0?(i(),p("span",du,y[11]||(y[11]=[s("br",null,null,-1)]))):Z<Object.keys(x.variables).length-1?(i(),p("span",cu,_("  "))):F("",!0)],64))),128))])])):F("",!0),n.value.includes("response")?(i(),p("td",pu,[Ee(s("div",fu,null,512),[[g,K(I(x)),"apiResponse"]])])):F("",!0),n.value.includes("parsedResponse")?(i(),p("td",mu,[s("div",vu,_(w(x)),1)])):F("",!0),n.value.includes("postProcessedResponse")?(i(),p("td",gu,[s("div",hu,_(U(x)),1)])):F("",!0),n.value.includes("length")?(i(),p("td",yu,_($(x)),1)):F("",!0),n.value.includes("latency")?(i(),p("td",bu,[s("span",{class:te(j(x.response?.latencyMs))},_(m(x.response?.latencyMs)),3)])):F("",!0)],10,eu))),128)),T.value.length===0?(i(),p("tr",_u,[s("td",{colspan:n.value.length,class:"empty-state"},[f.value.length===0?(i(),p("div",$u," No API calls yet. Start the trial to begin execution. ")):(i(),p("div",Cu," No results match your filters. "))],8,Tu)])):F("",!0)])]))]),u.value?(i(),Q(rs,{key:0,visible:!!u.value,"api-call":u.value,trial:v.trial,"all-api-calls":E.value,"onUpdate:visible":y[5]||(y[5]=x=>u.value=null),onNavigate:G},null,8,["visible","api-call","trial","all-api-calls"])):F("",!0),c.value?(i(),Q(ui,{key:1,visible:c.value,trial:v.trial,onClose:y[6]||(y[6]=x=>c.value=!1)},null,8,["visible","trial"])):F("",!0)])}}}),wu=le(ku,[["__scopeId","data-v-ebe1cb1d"]]),Su={class:"trial-analysis-view"},Iu=re({__name:"TrialAnalysisView",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(l){const e=l;return me(()=>{const t=performance.now();A.info(`V4_TRIAL_SWITCH: TrialAnalysisView MOUNTED for trial ${e.trial.id}`),we(()=>{const a=performance.now();A.info(`V4_TRIAL_SWITCH: TrialAnalysisView DOM ready in ${(a-t).toFixed(1)}ms`)}),setTimeout(()=>{const a=performance.now();A.info(`V4_TRIAL_SWITCH: TrialAnalysisView mount completed in ${(a-t).toFixed(1)}ms`)},0)}),xe(()=>{A.info(`V4_TRIAL_SWITCH: TrialAnalysisView ACTIVATED (cache hit) for trial ${e.trial.id}`)}),Ae(()=>{A.info(`V4_TRIAL_SWITCH: TrialAnalysisView DEACTIVATED (cached) for trial ${e.trial.id}`)}),ye(()=>{A.info(`V4_TRIAL_SWITCH: TrialAnalysisView UNMOUNTED (evicted) for trial ${e.trial.id}`)}),(t,a)=>(i(),p("div",Su,[S(wu,{trial:t.trial,progress:t.progress,"is-executing":t.isExecuting,"api-calls":t.apiCalls,"is-streaming":t.isStreaming,"is-loading":t.isLoading},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])]))}}),Eu=le(Iu,[["__scopeId","data-v-602f5d5a"]]);function At(l,e){const t=new Set,a=new Set,o=new Set;l.forEach(h=>{h.variables&&Object.keys(h.variables).forEach(b=>t.add(b)),h.variableAttributes&&Object.values(h.variableAttributes).forEach(b=>{b&&Object.keys(b).forEach(T=>a.add(T))})});const n=Array.from(t).sort(),u=Array.from(a).sort(),c=Array.from(o).sort(),d=[],f=["success","refused","parsed_response",...d,...c];return{categorical:[...n,...u,"model","status","error_type"],numeric:["response_time","total_tokens","prompt_tokens","completion_tokens",...d].sort(),extracted:f}}function ut(l,e,t){switch(e){case"model":return t&&l.configurationIndex<t.configurations.length&&t.configurations[l.configurationIndex].modelId||"Unknown";case"status":return l.status;case"response_time":return xs(l.response?.latencyMs);case"total_tokens":if(l.response?.body?.usage){const a=l.response.body.usage;return a.total_tokens||Ps(a.prompt_tokens,a.completion_tokens)||Ne(null)}return Ne(null);case"prompt_tokens":return Ne(l.response?.body?.usage?.prompt_tokens||l.response?.body?.usage?.input_tokens);case"completion_tokens":return Ne(l.response?.body?.usage?.completion_tokens||l.response?.body?.usage?.output_tokens);case"error_type":return l.result?.errorType||(l.result?.success===!1?"api_error":"success");case"success":return l.result?.success?1:0;case"refused":return l.result?.refused?1:0;case"parsed_response":if(l.result?.parsedContent!==void 0){const a=l.result.parsedContent;return typeof a=="object"?JSON.stringify(a):a}return null}if(l.variables?.[e]!==void 0)return l.variables[e];if(l.variableAttributes)for(const a of Object.keys(l.variableAttributes)){const o=l.variableAttributes[a];if(o&&o[e]!==void 0)return o[e]}return null}const Ve={count:{label:"Count",calculate:l=>l.length,format:l=>l.toString(),needsNumeric:!1},sum:{label:"Sum",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0):null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},mean:{label:"Mean",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0)/e.length:null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},median:{label:"Median",calculate:l=>{const e=l.map(o=>typeof o=="number"?o:null).filter(o=>o!==null);if(e.length===0)return null;const t=[...e].sort((o,n)=>o-n),a=Math.floor(t.length/2);return t.length%2===0?(t[a-1]+t[a])/2:t[a]},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},mode:{label:"Mode",calculate:l=>{if(l.length===0)return null;const e=new Map;l.forEach(o=>e.set(o,(e.get(o)||0)+1));let t=0,a=null;return e.forEach((o,n)=>{o>t&&(t=o,a=n)}),{value:a,count:t,total:l.length}},format:l=>l?`${l.value} (${l.count}/${l.total})`:"-",needsNumeric:!1},variance:{label:"Variance",calculate:l=>{const e=l.map(o=>typeof o=="number"?o:null).filter(o=>o!==null);if(e.length<=1)return null;const t=e.reduce((o,n)=>o+n,0)/e.length;return e.reduce((o,n)=>o+Math.pow(n-t,2),0)/(e.length-1)},format:l=>l?.toFixed(3)||"-",needsNumeric:!0},std_dev:{label:"Std Dev",calculate:l=>{const e=Ve.variance.calculate(l);return e!==null?Math.sqrt(e):null},format:l=>l?.toFixed(3)||"-",needsNumeric:!0},min:{label:"Min",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.min(...e):null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},max:{label:"Max",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.max(...e):null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},success_rate:{label:"Success Rate",calculate:(l,e)=>{const t=e.filter(a=>a.result?.success).length;return e.length>0?t/e.length:0},format:l=>`${Math.round(l*100)}%`,needsNumeric:!1,usesApiCalls:!0},refusal_rate:{label:"Refusal Rate",calculate:(l,e)=>{const t=e.filter(a=>a.result?.refused).length;return e.length>0?t/e.length:0},format:l=>`${Math.round(l*100)}%`,needsNumeric:!1,usesApiCalls:!0},avg_time:{label:"Avg Time (ms)",calculate:(l,e)=>{const t=e.filter(a=>a.response?.latencyMs).map(a=>a.response.latencyMs);return t.length>0?t.reduce((a,o)=>a+o,0)/t.length:null},format:l=>l?`${Math.round(l)}ms`:"-",needsNumeric:!1,usesApiCalls:!0},percent_non_numeric:{label:"% Non-Numeric",calculate:l=>l.length===0?0:l.filter(t=>!!(t==null||typeof t!="number"||Number.isNaN(t)||!Number.isFinite(t))).length/l.length*100,format:l=>`${Math.round(l)}%`,needsNumeric:!1}};function Ru(l,e,t){const a=performance.now(),o=new Map,n=new Set,u=new Set,c=new Map,d=(I,w)=>{c.has(w)||c.set(w,new Map);const U=c.get(w);return U.has(I)||U.set(I,ut(I,w,t)),U.get(I)};for(const I of l){const w=String(d(I,e.rowField)||"Unknown"),U=String(d(I,e.columnField)||"Unknown");n.add(w),u.add(U),o.has(w)||o.set(w,new Map);const $=o.get(w);$.has(U)||$.set(U,[]),$.get(U).push(I)}const f=performance.now()-a;f>50&&`${l.length}${f.toFixed(1)}`;const h=I=>I.every(U=>!isNaN(Number(U))&&U.trim()!=="")?I.sort((U,$)=>Number(U)-Number($)):I.sort(),b=(I,w)=>(t&&(t.type,t.type),h(I)),T=e.rowSort==="original"?b(Array.from(n),e.rowField):h(Array.from(n)),E=e.columnSort==="original"?b(Array.from(u),e.columnField):h(Array.from(u)),k=Ve[e.aggregation];function C(I,w=!1){const U=w?I.map(R=>d(R,e.valueField)):I.map(R=>ut(R,e.valueField,t));if(!k||typeof k.calculate!="function")return A.error("Invalid aggregation function:",e.aggregation,k),{value:null,count:I.length,apiCalls:I,rawValues:U,error:"Invalid aggregation function"};const $={nonNumeric:0,nullUndefined:0};return k.needsNumeric&&($.nonNumeric=U.filter(R=>typeof R!="number").length),$.nullUndefined=U.filter(R=>R==null).length,{value:k.usesApiCalls?k.calculate(U,I):k.calculate(U),count:I.length,apiCalls:I,rawValues:U,excludedCounts:$}}const z=T.map(I=>{const w=[],U=[];return E.forEach($=>{const m=o.get(I)?.get($)||[];w.push(m.length>0?C(m,!0):null),U.push(...m)}),{label:I,cells:w,total:C(U,!0)}}),N=E.map(I=>{const w=[];return T.forEach(U=>{const $=o.get(U)?.get(I)||[];w.push(...$)}),C(w,!0)}),O=performance.now()-a;return O>100&&`${O.toFixed(1)}${l.length}`,{rows:z,columns:E,totals:N,grandTotal:C(l,!0)}}function $e(l,e){return!l||l.value===null?"-":Ve[e].format(l.value)}function Fu(l){if(!l||Object.keys(l).length===0)return"";const e=[];return l.temperature!==void 0&&e.push(`T:${l.temperature}`),l.max_tokens!==void 0?e.push(`${l.max_tokens}t`):l.maxTokens!==void 0?e.push(`${l.maxTokens}t`):l.num_predict!==void 0&&e.push(`${l.num_predict}t`),l.top_p!==void 0&&e.push(`p:${l.top_p}`),l.top_k!==void 0&&e.push(`k:${l.top_k}`),e.length>0?`(${e.join(", ")})`:""}function Pu(l,e,t,a=q({}),o={}){const n=q({rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}}),u=q({categorical:[],numeric:[],extracted:[]}),c=q(!1),d=q(0),f=q(!1),h=q(0),b=M(()=>{const N=a.value;return Object.values(N).some(I=>I!=="")?l.value.filter(I=>{if(N.model&&N.model!==""){if(!t.value||I.configurationIndex>=t.value.configurations.length)return!1;const w=t.value.configurations[I.configurationIndex],U=w.modelId||"Unknown",$=Fu(w.parameters);if(($?`${U} ${$}`:U)!==N.model)return!1}if(N.status&&N.status!==""&&I.status!==N.status)return!1;for(const[w,U]of Object.entries(N))if(U&&U!==""&&w!=="model"&&w!=="status"&&I.variables?.[w]!==U)return!1;return!0}):l.value});let T=null;const E=N=>{T&&T.cancel();let O;switch(N){case"trial":O=0;break;case"tab":O=0;break;case"stream":O=100;break;case"config":O=300;break;default:O=100}T=St(()=>{if(b.value.length===0){n.value={rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}};return}c.value=!0;const I=performance.now();try{n.value=Ru(b.value,e.value,t.value);const w=performance.now()-I;d.value=w,A.debug(`Pivot computed from ${N}`,{apiCallCount:b.value.length,computeTimeMs:w,rowCount:n.value.rows.length,columnCount:n.value.columns.length,source:N})}catch(w){A.error("Error computing pivot data",w)}finally{c.value=!1,(N==="tab"||N==="stream")&&(f.value=!1)}},O),T()},k=St(()=>{u.value=At(l.value,t.value)},200),C=typeof window<"u"?window.__trialDataStoreV4?.():null;oe([e],()=>{E("config")},{deep:!0}),oe(b,(N,O)=>{if(C&&C.activeTab?.value!=="pivot"){f.value=!0,h.value=N.length,`${N.length}`;return}const I=O?.length||0,w=N.length;f.value&&(f.value=!1),(I!==w||w>0)&&E("stream")},{immediate:!0}),C&&oe(()=>C.activeTab?.value,(N,O)=>{N==="pivot"&&O!=="pivot"&&f.value&&(`${h.value}`,E("tab"))});let z=null;return oe([l,t],([N,O])=>{const I=O?.id!==z;z=O?.id||null,I?(`${O?.id}`,u.value=At(N),E("trial")):(`${N.length}`,k())},{immediate:!0}),k(),{pivotData:M(()=>n.value),availableFields:M(()=>u.value),isComputing:M(()=>c.value),lastComputeTime:M(()=>d.value),formatCellValue:$e,extractFieldValue:ut,aggregationFunctions:Ve}}const xu={class:"pivot-config-v3"},Au={class:"config-row"},Vu={class:"config-group"},Ou=["value","aria-label"],Du={label:"Categorical"},Nu=["value"],Lu={class:"config-group sort-group"},Mu=["value","aria-label"],Uu={class:"config-group"},zu=["value","aria-label"],Bu={label:"Categorical"},Wu=["value"],ju={class:"config-group sort-group"},Hu=["value","aria-label"],qu={class:"config-group"},Gu=["value","aria-label"],Ju={label:"Extracted Values"},Xu=["value"],Ku={label:"Numeric Fields"},Qu=["value"],Yu={class:"config-group"},Zu=["value","aria-label"],ed=re({__name:"PivotConfigurationV3",props:{config:{},availableFields:{}},emits:["update-config"],setup(l,{emit:e}){const t=e;function a(n,u){t("update-config",n,u)}function o(n){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[n]||n.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase())}return(n,u)=>(i(),p("div",xu,[s("div",Au,[s("div",Vu,[u[6]||(u[6]=s("label",{for:"pivot-row-field"},"Rows (Group by):",-1)),s("select",{id:"pivot-row-field",value:n.config.rowField,"aria-label":"Group rows by "+o(n.config.rowField),onChange:u[0]||(u[0]=c=>a("rowField",c.target.value))},[s("optgroup",Du,[(i(!0),p(Y,null,ee(n.availableFields.categorical,c=>(i(),p("option",{key:c,value:c},_(o(c)),9,Nu))),128))])],40,Ou)]),s("div",Lu,[u[8]||(u[8]=s("label",{for:"pivot-row-sort"},"Sort Rows:",-1)),s("select",{id:"pivot-row-sort",value:n.config.rowSort||"original","aria-label":"Sort rows by "+(n.config.rowSort||"original")+" order",onChange:u[1]||(u[1]=c=>a("rowSort",c.target.value))},u[7]||(u[7]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,Mu)]),s("div",Uu,[u[9]||(u[9]=s("label",{for:"pivot-column-field"},"Columns (Group by):",-1)),s("select",{id:"pivot-column-field",value:n.config.columnField,"aria-label":"Group columns by "+o(n.config.columnField),onChange:u[2]||(u[2]=c=>a("columnField",c.target.value))},[s("optgroup",Bu,[(i(!0),p(Y,null,ee(n.availableFields.categorical,c=>(i(),p("option",{key:c,value:c},_(o(c)),9,Wu))),128))])],40,zu)]),s("div",ju,[u[11]||(u[11]=s("label",{for:"pivot-column-sort"},"Sort Columns:",-1)),s("select",{id:"pivot-column-sort",value:n.config.columnSort||"original","aria-label":"Sort columns by "+(n.config.columnSort||"original")+" order",onChange:u[3]||(u[3]=c=>a("columnSort",c.target.value))},u[10]||(u[10]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,Hu)]),s("div",qu,[u[12]||(u[12]=s("label",{for:"pivot-value-field"},"Values (Aggregate):",-1)),s("select",{id:"pivot-value-field",value:n.config.valueField,"aria-label":"Aggregate "+n.config.valueField+" values",onChange:u[4]||(u[4]=c=>a("valueField",c.target.value))},[s("optgroup",Ju,[(i(!0),p(Y,null,ee(n.availableFields.extracted,c=>(i(),p("option",{key:c,value:c},_(c),9,Xu))),128))]),s("optgroup",Ku,[(i(!0),p(Y,null,ee(n.availableFields.numeric,c=>(i(),p("option",{key:c,value:c},_(o(c)),9,Qu))),128))])],40,Gu)]),s("div",Yu,[u[14]||(u[14]=s("label",{for:"pivot-aggregation"},"Aggregation:",-1)),s("select",{id:"pivot-aggregation",value:n.config.aggregation,"aria-label":"Aggregation method: "+n.config.aggregation,onChange:u[5]||(u[5]=c=>a("aggregation",c.target.value))},u[13]||(u[13]=[Mt('<optgroup label="Statistical" data-v-2f1516e5><option value="mean" data-v-2f1516e5>Mean</option><option value="median" data-v-2f1516e5>Median</option><option value="variance" data-v-2f1516e5>Variance</option><option value="std_dev" data-v-2f1516e5>Std Dev</option><option value="min" data-v-2f1516e5>Min</option><option value="max" data-v-2f1516e5>Max</option><option value="sum" data-v-2f1516e5>Sum</option></optgroup><optgroup label="Frequency" data-v-2f1516e5><option value="count" data-v-2f1516e5>Count</option><option value="mode" data-v-2f1516e5>Mode</option></optgroup><optgroup label="Data Quality" data-v-2f1516e5><option value="percent_non_numeric" data-v-2f1516e5>% Non-Numeric</option></optgroup><optgroup label="Performance" data-v-2f1516e5><option value="success_rate" data-v-2f1516e5>Success Rate</option><option value="refusal_rate" data-v-2f1516e5>Refusal Rate</option><option value="avg_time" data-v-2f1516e5>Avg Time</option></optgroup>',4)]),40,Zu)])])]))}}),td=le(ed,[["__scopeId","data-v-2f1516e5"]]),sd={class:"heatmap-controls-v3"},ad={class:"color-scale-selector"},nd=["value","aria-label"],od={class:"gradient-mode-selector"},rd={class:"gradient-toggle",role:"group","aria-label":"Gradient mode selector"},ld=["aria-pressed"],id=["aria-pressed"],ud=["aria-pressed"],dd=["title","aria-label"],cd=re({__name:"PivotHeatmapV3",props:{selectedColorScale:{},gradientMode:{},isFullscreen:{type:Boolean}},emits:["update-color-scale","update-gradient-mode","toggle-fullscreen"],setup(l,{emit:e}){const t=e;function a(n){const u=n.target.value;t("update-color-scale",u)}function o(n){t("update-gradient-mode",n)}return(n,u)=>(i(),p("div",sd,[s("div",ad,[u[5]||(u[5]=s("label",{for:"heatmap-color-scale"},"Color Scale:",-1)),s("select",{id:"heatmap-color-scale",value:n.selectedColorScale,"aria-label":"Color scale: "+n.selectedColorScale,onChange:a},u[4]||(u[4]=[Mt('<option value="blue-subtle" data-v-dcb6369b>Blue (Subtle)</option><option value="green-red" data-v-dcb6369b>Green-Red (Success)</option><option value="blue-yellow" data-v-dcb6369b>Blue-Yellow (Performance)</option><option value="purple-orange" data-v-dcb6369b>Purple-Orange (General)</option><option value="viridis" data-v-dcb6369b>Viridis</option><option value="inferno" data-v-dcb6369b>Inferno</option><option value="magma" data-v-dcb6369b>Magma</option><option value="plasma" data-v-dcb6369b>Plasma</option><option value="grayscale" data-v-dcb6369b>Grayscale</option>',9)]),40,nd)]),s("div",od,[u[6]||(u[6]=s("label",null,"Gradient Mode:",-1)),s("div",rd,[s("button",{type:"button",class:te(["toggle-btn",{active:n.gradientMode==="global"}]),"aria-pressed":n.gradientMode==="global",onClick:u[0]||(u[0]=c=>o("global"))}," Global ",10,ld),s("button",{type:"button",class:te(["toggle-btn",{active:n.gradientMode==="column"}]),"aria-pressed":n.gradientMode==="column",onClick:u[1]||(u[1]=c=>o("column"))}," Per Column ",10,id),s("button",{type:"button",class:te(["toggle-btn",{active:n.gradientMode==="row"}]),"aria-pressed":n.gradientMode==="row",onClick:u[2]||(u[2]=c=>o("row"))}," Per Row ",10,ud)])]),s("button",{type:"button",class:"fullscreen-btn",title:n.isFullscreen?"Exit Fullscreen":"Enter Fullscreen","aria-label":n.isFullscreen?"Exit fullscreen mode":"Enter fullscreen mode",onClick:u[3]||(u[3]=c=>n.$emit("toggle-fullscreen"))},_(n.isFullscreen?"⊟":"⊞"),9,dd)]))}}),pd=le(cd,[["__scopeId","data-v-dcb6369b"]]),fd={class:"pivot-filters-v3"},md={class:"filters-row"},vd={key:0,class:"filter-group"},gd=["value"],hd=["value"],yd=["for"],bd=["id","value","aria-label","onChange"],_d={value:""},Td=["value"],$d={key:1,class:"filter-group"},Cd=["value"],kd=["value"],wd=re({__name:"PivotFiltersV3",props:{apiCalls:{},trial:{},activeFilters:{}},emits:["update-filters","clear-filters"],setup(l,{emit:e}){const t=l,a=e,o=q({});let n=0;const u=()=>{if(t.apiCalls.length===0){o.value={};return}const T={};t.apiCalls.forEach(k=>{if(t.trial&&k.configurationIndex<t.trial.configurations.length){const C=t.trial.configurations[k.configurationIndex],z=C.modelId||"Unknown",N=f(C.parameters),O=N?`${z} ${N}`:z;T.model||(T.model=new Set),T.model.add(O)}k.status&&(T.status||(T.status=new Set),T.status.add(k.status)),k.variables&&Object.entries(k.variables).forEach(([C,z])=>{z&&String(z).trim()&&(T[C]||(T[C]=new Set),T[C].add(String(z)))})});const E={};Object.entries(T).forEach(([k,C])=>{E[k]=Array.from(C).sort()}),o.value=E};oe(()=>t.apiCalls.length,T=>{(T===0||n===0||T-n>=5)&&(u(),n=T)},{immediate:!0});const c=M(()=>{const{model:T,status:E,...k}=o.value;return k}),d=M(()=>Object.values(t.activeFilters).some(T=>T!==""));function f(T){if(!T||Object.keys(T).length===0)return"";const E=[];return T.temperature!==void 0&&E.push(`T:${T.temperature}`),T.max_tokens!==void 0?E.push(`${T.max_tokens}t`):T.maxTokens!==void 0?E.push(`${T.maxTokens}t`):T.num_predict!==void 0&&E.push(`${T.num_predict}t`),T.top_p!==void 0&&E.push(`p:${T.top_p}`),T.top_k!==void 0&&E.push(`k:${T.top_k}`),E.length>0?`(${E.join(", ")})`:""}function h(T){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",extracted_value:"Extracted Value"}[T]||T.replace(/_/g," ").replace(/\b\w/g,k=>k.toUpperCase())}function b(T,E){const k={...t.activeFilters};E===""?delete k[T]:k[T]=E,a("update-filters",k)}return(T,E)=>(i(),p("div",fd,[s("div",md,[o.value.model&&o.value.model.length>1?(i(),p("div",vd,[E[4]||(E[4]=s("label",{for:"filter-model",class:"filter-label"},"Model:",-1)),s("select",{id:"filter-model",value:T.activeFilters.model||"",class:"filter-select","aria-label":"Filter by model",onChange:E[0]||(E[0]=k=>b("model",k.target.value))},[E[3]||(E[3]=s("option",{value:""},"All Models",-1)),(i(!0),p(Y,null,ee(o.value.model,k=>(i(),p("option",{key:k,value:k},_(k),9,hd))),128))],40,gd)])):F("",!0),(i(!0),p(Y,null,ee(c.value,(k,C)=>(i(),p("div",{key:C,class:"filter-group"},[s("label",{for:`filter-${C}`,class:"filter-label"},_(h(String(C)))+": ",9,yd),s("select",{id:`filter-${C}`,value:T.activeFilters[C]||"",class:"filter-select","aria-label":`Filter by ${h(String(C))}`,onChange:z=>b(String(C),z.target.value)},[s("option",_d,"All "+_(h(String(C))),1),(i(!0),p(Y,null,ee(k,z=>(i(),p("option",{key:z,value:z},_(z),9,Td))),128))],40,bd)]))),128)),o.value.status&&o.value.status.length>1?(i(),p("div",$d,[E[6]||(E[6]=s("label",{for:"filter-status",class:"filter-label"},"Status:",-1)),s("select",{id:"filter-status",value:T.activeFilters.status||"",class:"filter-select","aria-label":"Filter by status",onChange:E[1]||(E[1]=k=>b("status",k.target.value))},[E[5]||(E[5]=s("option",{value:""},"All Statuses",-1)),(i(!0),p(Y,null,ee(o.value.status,k=>(i(),p("option",{key:k,value:k},_(k),9,kd))),128))],40,Cd)])):F("",!0),d.value?(i(),p("button",{key:2,type:"button",class:"clear-filters-btn",title:"Clear all filters","aria-label":"Clear all filters",onClick:E[2]||(E[2]=k=>T.$emit("clear-filters"))}," Clear Filters ")):F("",!0)])]))}}),Sd=le(wd,[["__scopeId","data-v-d5848163"]]),Id={class:"collapse-icon"},Ed={class:"options-content"},Rd={class:"controls-row"},Fd={key:0,class:"performance-info"},Pd={class:"table-view"},xd={key:0,class:"empty-state","data-testid":"empty-data-message"},Ad={key:1,class:"error-state","data-testid":"invalid-aggregation-error"},Vd={key:2,class:"loading-state","data-testid":"computing-state"},Od={key:3,class:"pivot-table-container"},Dd={class:"pivot-table-grid responsive-table",role:"table"},Nd={role:"row"},Ld={class:"corner-cell",role:"columnheader"},Md={key:0,class:"total-header",role:"columnheader"},Ud={class:"row-header",role:"rowheader"},zd=["data-testid","title","aria-label","role","onClick","onKeydown"],Bd={key:0,class:"cell-content"},Wd=["title"],jd={class:"cell-value"},Hd={class:"error-message"},qd={key:1},Gd=re({__name:"PivotTableV3",props:{apiCalls:{},trial:{default:null},config:{},maxTableRows:{default:1e4},showTotals:{type:Boolean,default:!0},showPerformanceInfo:{type:Boolean,default:!1}},emits:["config-change","cell-click"],setup(l,{emit:e}){const t=l,a=e,o=q(!1),n=q("blue-yellow"),u=q("global"),c=q(!1),d=q({rowField:t.config?.rowField||"",columnField:t.config?.columnField||"",valueField:t.config?.valueField||"",aggregation:t.config?.aggregation||"mean",rowSort:t.config?.rowSort||"original",columnSort:t.config?.columnSort||"original"});oe(()=>t.config,g=>{g&&Object.assign(d.value,g)},{deep:!0}),oe(()=>t.trial?.id,(g,x)=>{g&&g!==x&&(A.info(`PIVOT_FIX: Trial changed from ${x} to ${g}, resetting configuration`),d.value={rowField:"",columnField:"",valueField:"",aggregation:"mean",rowSort:"original",columnSort:"original"},f.value={})});const f=q({}),h=Je(),b=M(()=>h.apiCalls?h.apiCalls.value||[]:t.apiCalls||[]),T=b,E=M(()=>t.trial),{pivotData:k,availableFields:C,isComputing:z,lastComputeTime:N}=Pu(T,d,E,f,{});oe(k,(g,x)=>{const W=performance.now(),X=g?.rows?.length||0,Z=g?.columns?.length||0;A.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData computed: ${X}x${Z} matrix`),setTimeout(()=>{const ae=performance.now();A.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData render completed in ${(ae-W).toFixed(1)}ms`)},0)}),oe(z,g=>{g?A.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING STARTED with ${b.value.length} API calls`):A.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING FINISHED in ${N.value.toFixed(1)}ms`)}),oe(b,(g,x)=>{const W=performance.now();A.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls changed from ${x?.length||0} to ${g.length} calls`),setTimeout(()=>{const X=performance.now();A.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls prop update completed in ${(X-W).toFixed(1)}ms`)},0)});const O=M(()=>k.value.rows.slice(0,t.maxTableRows)),I=M(()=>Object.values(f.value).some(x=>x!=="")?b.value.filter(x=>{if(f.value.model&&f.value.model!==""){if(!t.trial||x.configurationIndex>=t.trial.configurations.length)return!1;const W=t.trial.configurations[x.configurationIndex],X=W.modelId||"Unknown",Z=m(W.parameters);if((Z?`${X} ${Z}`:X)!==f.value.model)return!1}if(f.value.status&&f.value.status!==""&&x.status!==f.value.status)return!1;for(const[W,X]of Object.entries(f.value))if(X&&X!==""&&W!=="model"&&W!=="status"&&x.variables?.[W]!==X)return!1;return!0}).length:b.value.length),{getCellStyle:w,getSummaryStyle:U,styleKey:$}=fa(k,n,u);function m(g){if(!g||Object.keys(g).length===0)return"";const x=[];return g.temperature!==void 0&&x.push(`T:${g.temperature}`),g.max_tokens!==void 0?x.push(`${g.max_tokens}t`):g.maxTokens!==void 0?x.push(`${g.maxTokens}t`):g.num_predict!==void 0&&x.push(`${g.num_predict}t`),g.top_p!==void 0&&x.push(`p:${g.top_p}`),g.top_k!==void 0&&x.push(`k:${g.top_k}`),x.length>0?`(${x.join(", ")})`:""}function L(g){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[g]||g.replace(/_/g," ").replace(/\b\w/g,W=>W.toUpperCase())}function R(g,x,W){if(!W)return`${g} × ${x}: No data`;const X=$e(W,d.value.aggregation);let Z=`${g} × ${x}: ${X} (${W.count} calls)`;if(W.excludedCounts){const ae=[];W.excludedCounts.nonNumeric>0&&ae.push(`${W.excludedCounts.nonNumeric} non-numeric responses excluded`),W.excludedCounts.nullUndefined>0&&ae.push(`${W.excludedCounts.nullUndefined} null/empty responses`),ae.length>0&&(Z+=` | ${ae.join(", ")}`)}return W.error&&(Z+=` - ERROR: ${W.error}`),Z}function r(g,x,W){if(!W)return`${g} by ${x}: No data`;const X=$e(W,d.value.aggregation);return W.error?`${g} by ${x}: ${X} with data integrity error: ${W.error}`:`${g} by ${x}: ${X} from ${W.count} API calls`}function j(g,x){(g==="rowField"||g==="columnField"||g==="valueField"||g==="aggregation"||g==="rowSort"||g==="columnSort")&&(d.value[g]=x),a("config-change",{...d.value})}function K(g){f.value={...g}}function V(){f.value={}}function G(g,x,W){W&&a("cell-click",{row:g,column:x,cell:W})}function v(){c.value=!c.value}function y(){o.value=!o.value,o.value?document.body.style.overflow="hidden":document.body.style.overflow=""}return me(()=>{const g=performance.now();A.info(`V4_TRIAL_SWITCH: PivotTableV3 MOUNTED for trial ${t.trial?.id||"unknown"} with ${b.value.length} calls`),we(()=>{const x=performance.now();A.info(`V4_TRIAL_SWITCH: PivotTableV3 DOM ready in ${(x-g).toFixed(1)}ms`)}),setTimeout(()=>{const x=performance.now();A.info(`V4_TRIAL_SWITCH: PivotTableV3 mount completed in ${(x-g).toFixed(1)}ms`)},0)}),xe(()=>{A.info(`V4_TRIAL_SWITCH: PivotTableV3 ACTIVATED (cache hit) for trial ${t.trial?.id||"unknown"} with ${b.value.length} calls`)}),Ae(()=>{A.info(`V4_TRIAL_SWITCH: PivotTableV3 DEACTIVATED (cached) for trial ${t.trial?.id||"unknown"}`)}),ye(()=>{A.info(`V4_TRIAL_SWITCH: PivotTableV3 UNMOUNTED (evicted) for trial ${t.trial?.id||"unknown"}`),o.value&&(document.body.style.overflow="")}),oe([C,b],([g])=>{const x=!d.value.rowField&&!d.value.columnField&&!d.value.valueField;b.value.length>0&&x&&g.categorical.length>0&&(A.info("PIVOT_FIX: Auto-initializing empty config"),d.value.rowField=g.categorical.find(W=>W!=="model"&&W!=="status"&&W!=="error_type")||g.categorical[0]||"model",d.value.columnField="model",d.value.valueField="parsed_response",d.value.aggregation="mean",a("config-change",{...d.value}))},{immediate:!0}),(g,x)=>(i(),p("div",{class:te(["pivot-table-v3",{fullscreen:o.value}])},[s("div",{class:te(["pivot-options-container",{collapsed:c.value}])},[s("div",{class:"options-header",onClick:v},[x[3]||(x[3]=s("span",{class:"options-title"},"Pivot Table Options",-1)),s("span",Id,_(c.value?"▶":"▼"),1)]),Ee(s("div",Ed,[Is([H(C),d.value],()=>(i(),p("div",null,[S(td,{config:d.value,"available-fields":H(C),onUpdateConfig:j},null,8,["config","available-fields"])])),x,0),s("div",Rd,[b.value.length>0?(i(),Q(Sd,{key:0,"api-calls":b.value,trial:g.trial,"active-filters":f.value,onUpdateFilters:K,onClearFilters:V},null,8,["api-calls","trial","active-filters"])):F("",!0),S(pd,{"selected-color-scale":n.value,"gradient-mode":u.value,"is-fullscreen":o.value,onUpdateColorScale:x[1]||(x[1]=W=>n.value=W),onUpdateGradientMode:x[2]||(x[2]=W=>u.value=W),onToggleFullscreen:y},null,8,["selected-color-scale","gradient-mode","is-fullscreen"])])],512),[[Ut,!c.value]])],2),g.showPerformanceInfo?(i(),p("div",Fd,[s("span",null,"Computing: "+_(H(z)?"Yes":"No"),1),s("span",null,"Last Compute: "+_(H(N).toFixed(1))+"ms",1),s("span",null,"API Calls: "+_(b.value.length),1),s("span",null,"Filtered: "+_(I.value),1)])):F("",!0),s("div",Pd,[b.value.length===0?(i(),p("div",xd,x[4]||(x[4]=[s("p",null,"No data available for pivot table analysis.",-1)]))):d.value.aggregation in H(Ve)?H(z)?(i(),p("div",Vd,x[6]||(x[6]=[s("p",null,"Computing pivot table...",-1)]))):(i(),p("div",Od,[s("table",Dd,[s("thead",null,[s("tr",Nd,[s("th",Ld,_(L(d.value.rowField)||"Items")+" / "+_(L(d.value.columnField)||"Aggregated"),1),(i(!0),p(Y,null,ee(H(k).columns,W=>(i(),p("th",{key:W,class:"column-header",role:"columnheader"},_(W),1))),128)),d.value.columnField&&g.showTotals?(i(),p("th",Md," Total ")):F("",!0)])]),s("tbody",null,[(i(!0),p(Y,null,ee(O.value,W=>(i(),p("tr",{key:`${W.label}-${H($)}`,class:"data-row",role:"row"},[s("td",Ud,_(W.label),1),(i(!0),p(Y,null,ee(W.cells,(X,Z)=>(i(),p("td",{key:`${Z}-${H($)}`,class:te(["data-cell",{"error-cell":X?.error}]),"data-testid":X?.error?"pivot-cell-error":"pivot-cell",style:_e(H(w)(X,W.label,Z)),title:R(W.label,H(k).columns[Z],X),"aria-label":r(W.label,H(k).columns[Z],X),role:X?.error?"alert":"cell",tabindex:"0",onClick:ae=>G(W.label,H(k).columns[Z],X),onKeydown:[at(ae=>G(W.label,H(k).columns[Z],X),["enter"]),at(zt(ae=>G(W.label,H(k).columns[Z],X),["prevent"]),["space"])]},[X?.error?(i(),p("div",Bd,[s("span",{class:"error-indicator",title:X.error},"⚠️",8,Wd),s("span",jd,_(X?H($e)(X,d.value.aggregation):"-"),1),s("div",Hd,_(X.error),1)])):(i(),p("span",qd,_(X?H($e)(X,d.value.aggregation):"-"),1))],46,zd))),128)),d.value.columnField&&g.showTotals?(i(),p("td",{key:0,class:"total-cell",style:_e(H(U)(W.total)),role:"cell"},_(H($e)(W.total,d.value.aggregation)),5)):F("",!0)]))),128)),d.value.rowField&&g.showTotals?(i(),p("tr",{key:`totals-${H($)}`,class:"total-row",role:"row"},[x[7]||(x[7]=s("td",{class:"row-header",role:"rowheader"},"Total",-1)),(i(!0),p(Y,null,ee(H(k).totals,(W,X)=>(i(),p("td",{key:`total-${X}-${H($)}`,class:"total-cell",style:_e(H(U)(W)),role:"cell"},_(H($e)(W,d.value.aggregation)),5))),128)),d.value.columnField?(i(),p("td",{key:0,class:"grand-total-cell",style:_e(H(U)(H(k).grandTotal)),role:"cell"},_(H($e)(H(k).grandTotal,d.value.aggregation)),5)):F("",!0)])):F("",!0)])])])):(i(),p("div",Ad,[s("p",null,"Invalid aggregation function: "+_(d.value.aggregation),1),x[5]||(x[5]=s("p",null,"Please select a valid aggregation method.",-1))]))])],2))}}),Jd=le(Gd,[["__scopeId","data-v-38de767b"]]),Xd={class:"modal-content"},Kd={class:"modal-header"},Qd={class:"modal-title"},Yd={class:"summary-row"},Zd={key:0},ec={key:0,class:"filter-row"},tc=["onUpdate:modelValue","aria-label"],sc={value:""},ac=["value"],nc={class:"table-container"},oc={class:"api-calls-table"},rc=["onClick"],lc=["title"],ic=["title"],uc=re({__name:"PivotCellDetailV3",props:{visible:{type:Boolean},row:{},column:{},apiCalls:{},trial:{},value:{}},emits:["close"],setup(l){const e=l,t=Es({}),a=q(null),{formatSingleCost:o}=Ge(),n=M(()=>{const m=new Set;return e.apiCalls.forEach(L=>{L.variables&&Object.keys(L.variables).forEach(R=>m.add(R)),L.attributedVariables&&Object.entries(L.attributedVariables).forEach(([R,r])=>{r&&typeof r=="object"&&Object.keys(r).forEach(j=>{m.add(`${R}.${j}`)})})}),Array.from(m).sort()}),u=M(()=>n.value.map(m=>({title:m,dataIndex:`var_${m}`,key:`var_${m}`,width:150}))),c=[{title:"Status",dataIndex:"status",key:"status",width:100},{title:"Model",dataIndex:"model",key:"model",width:150}],d=[{title:"Response",dataIndex:"response",key:"response",width:300},{title:"Parsed Content",dataIndex:"parsedContent",key:"parsedContent",width:150},{title:"Duration",dataIndex:"duration",key:"duration",width:100},{title:"Cost",dataIndex:"cost",key:"cost",width:100}],f=M(()=>[...c,...u.value,...d]),h=M(()=>`${e.row} × ${e.column} - ${e.apiCalls.length} API Calls`),b=M(()=>e.apiCalls.map(m=>{const L={id:m.id,status:m.status,model:m.modelName||"-",response:m.result?.content||m.result?.error||"-",parsedContent:N(m.result?.parsedContent),duration:m.duration!==void 0?`${m.duration}ms`:"-",cost:m.cost!==void 0?m.cost:"-"};return n.value.forEach(R=>{if(R.includes(".")){const[r,j]=R.split("."),K=m.attributedVariables?.[r]?.[j];L[`var_${R}`]=K!==void 0?String(K):"-"}else L[`var_${R}`]=m.variables?.[R]||"-"}),L})),T=M(()=>Object.values(t).some(m=>m!==void 0&&m!=="")),E=M(()=>T.value?b.value.filter(m=>Object.entries(t).every(([L,R])=>R?m[L]===R:!0)):b.value),k=M(()=>{const m=e.apiCalls.filter(L=>L.status==="completed").length;return Math.round(m/e.apiCalls.length*100)}),C=M(()=>{const m=e.apiCalls.filter(L=>L.duration).map(L=>L.duration);return m.length===0?0:Math.round(m.reduce((L,R)=>L+R,0)/m.length)}),z=M(()=>{const m=e.apiCalls.filter(L=>L.cost!==void 0).map(L=>L.cost);if(m.length!==0)return m.reduce((L,R)=>L+R,0)});function N(m){if(m==null)return"-";if(typeof m=="string")return m;if(typeof m=="number"||typeof m=="boolean")return String(m);if(typeof m=="object")try{return JSON.stringify(m,null,2).substring(0,100)}catch{return"[Object]"}return String(m)}function O(m){switch(m){case"completed":return"status-success";case"failed":return"status-error";case"pending":return"status-warning";case"running":return"status-processing";default:return"status-default"}}function I(m,L=200){if(!m)return"";if(m.length<=L)return m;const R=m.slice(0,100),r=m.slice(-100);return`${R} [...TRUNCATED...] ${r}`}function w(m){const L=new Set;return b.value.forEach(R=>{const r=R[m];r&&r!=="-"&&L.add(r)}),Array.from(L).sort()}function U(){Object.keys(t).forEach(m=>{delete t[m]})}function $(m){const L=e.apiCalls.find(R=>R.id===m.id);L&&(a.value=L)}return(m,L)=>(i(),p(Y,null,[s("div",{class:te(["pivot-cell-detail-modal-v3",{visible:m.visible}]),onClick:L[1]||(L[1]=zt(R=>m.$emit("close"),["self"]))},[s("div",Xd,[s("div",Kd,[s("h3",Qd,_(h.value),1),s("button",{type:"button",class:"close-btn","aria-label":"Close modal",onClick:L[0]||(L[0]=R=>m.$emit("close"))}," × ")]),s("div",Yd,[s("span",null,[L[3]||(L[3]=s("b",null,"Total:",-1)),D(" "+_(m.apiCalls.length),1)]),s("span",null,[L[4]||(L[4]=s("b",null,"Success Rate:",-1)),D(" "+_(k.value)+"%",1)]),s("span",null,[L[5]||(L[5]=s("b",null,"Avg Duration:",-1)),D(" "+_(C.value)+"ms",1)]),z.value!==void 0?(i(),p("span",Zd,[L[6]||(L[6]=s("b",null,"Total Cost:",-1)),D(" "+_(H(o)(z.value)),1)])):F("",!0)]),u.value.length>0?(i(),p("div",ec,[(i(!0),p(Y,null,ee(u.value,R=>(i(),p("div",{key:R.key,class:"variable-filter"},[Ee(s("select",{"onUpdate:modelValue":r=>t[R.key]=r,"aria-label":`Filter ${R.title}`,class:"filter-select"},[s("option",sc,"All "+_(R.title),1),(i(!0),p(Y,null,ee(w(R.key),r=>(i(),p("option",{key:r,value:r},_(r),9,ac))),128))],8,tc),[[Rs,t[R.key]]])]))),128)),T.value?(i(),p("button",{key:0,type:"button",class:"clear-filters-btn",onClick:U}," Clear Filters ")):F("",!0)])):F("",!0),s("div",nc,[s("table",oc,[s("thead",null,[s("tr",null,[(i(!0),p(Y,null,ee(f.value,R=>(i(),p("th",{key:R.key,class:"table-header",style:_e({width:R.width?`${R.width}px`:"auto"})},_(R.title),5))),128))])]),s("tbody",null,[(i(!0),p(Y,null,ee(E.value,R=>(i(),p("tr",{key:R.id,class:"table-row clickable-row",onClick:r=>$(R)},[(i(!0),p(Y,null,ee(f.value,r=>(i(),p("td",{key:r.key,class:te(["table-cell",{"status-cell":r.key==="status"}])},[r.key==="status"?(i(),p("span",{key:0,class:te(["status-tag",O(R.status)])},_(R.status),3)):r.key==="response"?(i(),p("span",{key:1,class:"response-cell",title:R.response},_(I(R.response)),9,lc)):r.key==="cost"?(i(),p(Y,{key:2},[D(_(R.cost==="-"?"-":H(o)(R.cost)),1)],64)):r.key.startsWith("var_")?(i(),p("span",{key:3,class:"variable-cell",title:R[r.key]},_(R[r.key]||"-"),9,ic)):(i(),p(Y,{key:4},[D(_(R[r.key]||"-"),1)],64))],2))),128))],8,rc))),128))])])])])],2),a.value?(i(),Q(rs,{key:0,visible:!!a.value,"api-call":a.value,trial:m.trial,"onUpdate:visible":L[2]||(L[2]=R=>a.value=null)},null,8,["visible","api-call","trial"])):F("",!0)],64))}}),dc=le(uc,[["__scopeId","data-v-ddbda380"]]),cc={class:"trial-tab-content"},pc={class:"tab-pane-content"},fc={class:"tab-pane-content"},mc={key:0,class:"no-data-message"},vc={class:"tab-pane-content"},Vt="trial-details-active-tab",gc=re({__name:"TrialTabContentV3",props:{trial:{},progress:{},isLeader:{type:Boolean},executionState:{}},setup(l){const e=l,t=Bt(),a=je(),o=Je(),n=M(()=>o.apiCalls?.value||[]),u=M(()=>o.isStreaming?.value||!1);oe(n,(O,I)=>{const w=performance.now();A.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls changed from ${I?.length||0} to ${O.length} calls`),setTimeout(()=>{const U=performance.now();A.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls reactive update completed in ${(U-w).toFixed(1)}ms`)},0)});const c=M(()=>!1),f=q((()=>{const O=t.query.tab;return O==="status"?"details":O&&["details","tasks","pivot"].includes(O)?O:"tasks"})()),h=q(!1);oe(f,O=>{o.setActiveTab(O)},{immediate:!0});const b=q(!1),T=q({row:"",column:"",apiCalls:[],value:null}),E=M(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial.id),k=M(()=>e.trial.progress.completed>0);function C(){localStorage.setItem(Vt,f.value);const O={...t.query};O.tab=f.value,t.query.tab!==f.value&&(a.replace({query:O}),`${f.value}`)}function z(){const O=localStorage.getItem(Vt);O==="status"?f.value="details":O&&["details","tasks","pivot"].includes(O)&&(f.value=O)}function N(O){!O.cell||!O.cell.apiCalls.length||(T.value={row:O.row,column:O.column,apiCalls:O.cell.apiCalls,value:O.cell.value},b.value=!0)}return oe(f,()=>{C()}),oe(()=>t.query.tab,O=>{if(O&&typeof O=="string"){let I=O==="status"?"details":O;["details","tasks","pivot"].includes(I)&&f.value!==I&&(f.value=I)}}),me(()=>{const O=performance.now();if(A.info(`V4_TRIAL_SWITCH: TrialTabContentV3 MOUNTED for trial ${e.trial.id}`),!t.query.tab){const I={...t.query};I.tab=f.value,a.replace({query:I}),`${f.value}`}z(),setTimeout(()=>{const I=performance.now();A.info(`V4_TRIAL_SWITCH: TrialTabContentV3 mount completed in ${(I-O).toFixed(1)}ms`)},0)}),xe(()=>{A.info(`V4_TRIAL_SWITCH: TrialTabContentV3 ACTIVATED (cache hit) for trial ${e.trial.id}`)}),Ae(()=>{A.info(`V4_TRIAL_SWITCH: TrialTabContentV3 DEACTIVATED (cached) for trial ${e.trial.id}`)}),ye(()=>{A.info(`V4_TRIAL_SWITCH: TrialTabContentV3 UNMOUNTED (evicted) for trial ${e.trial.id}`)}),(O,I)=>{const w=oa,U=na;return i(),p("div",cc,[S(U,{activeKey:f.value,"onUpdate:activeKey":I[1]||(I[1]=$=>f.value=$),type:"card",class:"trial-tabs"},{default:P(()=>[S(w,{key:"tasks",tab:"Task View"},{default:P(()=>[s("div",pc,[(i(),Q(nt,null,[S(Eu,{trial:O.trial,progress:O.progress,"is-executing":E.value,"api-calls":n.value,"is-streaming":u.value,"is-loading":c.value},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])],1024))])]),_:1}),S(w,{key:"pivot",tab:"Pivot Table"},{default:P(()=>[s("div",fc,[(i(),Q(nt,null,[k.value&&n.value.length>0?(i(),Q(Jd,{key:0,"api-calls":n.value,trial:O.trial,"show-performance-info":!1,onCellClick:N},null,8,["api-calls","trial"])):F("",!0)],1024)),k.value&&n.value.length>0?F("",!0):(i(),p("div",mc,I[3]||(I[3]=[s("p",null,"No completed API calls available for pivot analysis.",-1),s("p",null,"Run the trial to see pivot table data.",-1)])))])]),_:1}),S(w,{key:"details",tab:"Details"},{default:P(()=>[s("div",vc,[S(fr,{trial:O.trial,"is-collapsed":h.value,onToggleCollapse:I[0]||(I[0]=$=>h.value=!h.value)},null,8,["trial","is-collapsed"])])]),_:1})]),_:1},8,["activeKey"]),b.value?(i(),Q(dc,{key:0,visible:b.value,row:T.value.row,column:T.value.column,"api-calls":T.value.apiCalls,trial:O.trial,value:T.value.value,onClose:I[2]||(I[2]=$=>b.value=!1)},null,8,["visible","row","column","api-calls","trial","value"])):F("",!0)])}}}),hc=le(gc,[["__scopeId","data-v-743ec3c1"]]);class de extends Error{constructor(t,a,o){super(a);Se(this,"code");Se(this,"details");this.name="ExportError",this.code=t,this.details=o}}function Ot(l){return typeof TextEncoder<"u"?new TextEncoder().encode(l).length:typeof Buffer<"u"?Buffer.byteLength(l,"utf8"):unescape(encodeURIComponent(l)).length}const ie=class ie{async loadTrialForExport(e){try{const t=this.getCachedData(e);if(t)return{ok:!0,value:t};const a=await Fe.trials.get(e);if(!a)return{ok:!1,error:new de("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})};const o=await Fe.apiCalls.where("trialId").equals(e).toArray(),n={trial:a,apiCalls:o,fieldDefinitions:[],parameterFields:[],totalRecords:o.length};return this.setCachedData(e,n),{ok:!0,value:n}}catch(t){return{ok:!1,error:new de("GENERATION_FAILED",`Failed to load trial data: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateTrialForExport(e){try{return await Fe.trials.get(e)?await Fe.apiCalls.where("trialId").equals(e).count()===0?{ok:!1,error:new de("GENERATION_FAILED","Trial has no API calls to export",{trialId:e,apiCallCount:0})}:{ok:!0,value:!0}:{ok:!1,error:new de("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})}}catch(t){return{ok:!1,error:new de("GENERATION_FAILED",`Failed to validate trial: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async getApiCallCount(e){try{return await Fe.apiCalls.where("trialId").equals(e).count()}catch(t){return A.warn(`Failed to get API call count for trial ${e}:`,t),0}}clearCache(e){ie.cache.delete(e),ie.cacheExpiry.delete(e)}clearAllCache(){ie.cache.clear(),ie.cacheExpiry.clear()}getCachedData(e){const t=ie.cacheExpiry.get(e);return!t||Date.now()>t?(ie.cache.delete(e),ie.cacheExpiry.delete(e),null):ie.cache.get(e)||null}setCachedData(e,t){ie.cache.set(e,t),ie.cacheExpiry.set(e,Date.now()+ie.CACHE_TTL)}};Se(ie,"cache",new Map),Se(ie,"cacheExpiry",new Map),Se(ie,"CACHE_TTL",6e4);let dt=ie;const Le=new dt;class yc{discoverAllParameters(e){const t=new Map;return e.configurations.forEach((a,o)=>{!a.parameters||typeof a.parameters!="object"||Object.entries(a.parameters).forEach(([n,u])=>{const c=`param_${n}`;t.has(c)||t.set(c,{parameterName:n,fieldId:c,usedByConfigurations:[],dataType:this.inferDataType(u),sampleValues:[]});const d=t.get(c);d.usedByConfigurations.push(o),d.sampleValues.length<3&&!d.sampleValues.includes(u)&&d.sampleValues.push(u)})}),Array.from(t.values()).map(a=>this.createParameterFieldDefinition(a,e)).sort((a,o)=>a.id.localeCompare(o.id))}getParameterUsageStats(e){const t=this.discoverAllParameters(e),a={},o=[],n=[];e.configurations.forEach((c,d)=>{const f=c.provider;a[f]||(a[f]=[]),t.forEach(h=>{h.usedByConfigurations.includes(d)&&(a[f].includes(h.parameterName)||a[f].push(h.parameterName))})});const u=Object.keys(a);return t.forEach(c=>{u.filter(f=>a[f].includes(c.parameterName)).length>1?o.push(c.parameterName):n.push(c.parameterName)}),{totalUniqueParameters:t.length,parametersByProvider:a,sharedParameters:o.sort(),providerSpecificParameters:n.sort()}}validateParameterFields(e,t){const o=this.discoverAllParameters(e).map(d=>d.id),n=t.filter(d=>d.startsWith("param_")),u=[],c=[];return n.forEach(d=>{o.includes(d)?u.push(d):c.push(d)}),{validFields:u,invalidFields:c,availableFields:o}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}createParameterFieldDefinition(e,t){const a=e.usedByConfigurations.map(n=>t.configurations[n]?.provider||"unknown").filter((n,u,c)=>c.indexOf(n)===u).sort(),o=this.generateParameterDescription(e,a);return{id:e.fieldId,name:e.parameterName,description:o,group:"parameters",dataType:e.dataType,isRequired:!1,parameterName:e.parameterName,usedByConfigurations:e.usedByConfigurations}}generateParameterDescription(e,t){const a=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(n=>JSON.stringify(n)).join(", ")})`:"";return`${t.length===1?`Used by ${t[0]}`:`Used by ${t.join(", ")}`}${a}. Empty for configurations that don't use this parameter.`}}const ze=new yc;class bc{discoverAllVariables(e,t){e.id,t.length;const a=new Map,o=new Map;t.forEach(h=>{h.variables&&typeof h.variables=="object"&&Object.entries(h.variables).forEach(([b,T])=>{const E=`var_${b}`;a.has(E)||a.set(E,{variableName:b,fieldId:E,usedByCallCount:0,dataType:this.inferDataType(T),sampleValues:[]});const k=a.get(E);k.usedByCallCount++,k.sampleValues.length<3&&!k.sampleValues.includes(T)&&k.sampleValues.push(T)}),h.variableAttributes&&typeof h.variableAttributes=="object"&&Object.entries(h.variableAttributes).forEach(([b,T])=>{!T||typeof T!="object"||Object.entries(T).forEach(([E,k])=>{const C=`attr_${b}_${E}`;o.has(C)||o.set(C,{attributeName:E,fieldId:C,usedByCallCount:0,dataType:this.inferDataType(k),sampleValues:[]});const z=o.get(C);z.usedByCallCount++,z.sampleValues.length<3&&!z.sampleValues.includes(k)&&z.sampleValues.push(k)})})});const n=Array.from(a.values()).map(h=>this.createVariableFieldDefinition(h,t.length)),u=Array.from(o.values()).map(h=>this.createAttributeFieldDefinition(h,t.length)),c=[];t.some(h=>h.variableIndices&&Object.keys(h.variableIndices).length>0)&&Array.from(a.values()).forEach(h=>{const b=h.variableName;c.push({id:`source_${b}_list`,name:`${b} Source List`,description:`Name of the list that provided the value for ${b}`,group:"source",dataType:"string",isRequired:!1}),c.push({id:`source_${b}_index`,name:`${b} Source Index`,description:`Position in the list (0-based) for ${b}`,group:"source",dataType:"number",isRequired:!1})});const f=[...n,...u,...c].sort((h,b)=>h.id.localeCompare(b.id));return n.length,u.length,c.length,f.length,n.map(h=>h.id),u.map(h=>h.id),f}getVariableUsageStats(e,t){const a=this.discoverAllVariables(e,t),o={};a.forEach(c=>{const d=c.name,f=this.getVariableInfo(d,t);o[d]=f.usedByCallCount});const n=Object.entries(o).sort(([,c],[,d])=>d-c).map(([c])=>c),u=t.filter(c=>c.variables&&typeof c.variables=="object"&&Object.keys(c.variables).length>0).length;return{totalUniqueVariables:a.length,variableUsageCounts:o,mostCommonVariables:n.slice(0,10),totalCallsWithVariables:u}}validateVariableFields(e,t,a){const n=this.discoverAllVariables(e,t).map(f=>f.id),u=a.filter(f=>f.startsWith("var_")),c=[],d=[];return u.forEach(f=>{n.includes(f)?c.push(f):d.push(f)}),{validFields:c,invalidFields:d,availableFields:n}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}getVariableInfo(e,t){let a=0;const o=[];return t.forEach(n=>{if(n.variables&&n.variables[e]!==void 0){a++;const u=n.variables[e];o.length<3&&!o.includes(u)&&o.push(u)}}),{attributeName:e,fieldId:`attr_${e}`,usedByCallCount:a,dataType:o.length>0?this.inferDataType(o[0]):"string",sampleValues:o}}createVariableFieldDefinition(e,t){const a=this.generateVariableDescription(e,t);return{id:e.fieldId,name:e.variableName,description:a,group:"content",dataType:e.dataType,isRequired:!1}}createAttributeFieldDefinition(e,t){const a=this.generateAttributeDescription(e,t),o=e.fieldId.replace("attr_","").split("_"),n=o[0],u=o.slice(1).join("_"),c=`${n} attr ${u}`;return{id:e.fieldId,name:c,description:a,group:"content",dataType:e.dataType,isRequired:!1}}generateVariableDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),o=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(n=>JSON.stringify(n)).join(", ")})`:"";return`Template variable used in ${e.usedByCallCount}/${t} calls (${a}%)${o}. Empty for calls that don't use this variable.`}generateAttributeDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),o=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(n=>JSON.stringify(n)).join(", ")})`:"";return`Variable attribute used in ${e.usedByCallCount}/${t} calls (${a}%)${o}. Empty for calls that don't use this attribute.`}}const ls=new bc;class _c{isAuthField(e){return e==="request"}sanitizeFieldValue(e,t,a,o){return!t||t.length===0?t:(t.length,this.isAuthField(e),a.id,e==="request"?this.sanitizeRequestField(t,a,o):t)}sanitizeRequestField(e,t,a){try{const o=JSON.parse(e),n=this.getProviderIdForCall(t,a);if(!n)return t.id,this.sanitizeGenericRequest(e);t.id;const u=As(o,n);return JSON.stringify(u,null,2)}catch(o){return o instanceof Error?o.message:String(o),t.id,"[MALFORMED_REQUEST_JSON_REDACTED_FOR_SAFETY]"}}sanitizeGenericRequest(e){try{const t=JSON.parse(e);if(t.headers){const a={...t.headers},o=["authorization","api-key","x-api-key","bearer","x-auth-token"];for(const[n,u]of Object.entries(a)){const c=n.toLowerCase();o.some(d=>c.includes(d))&&(a[n]=`${String(u).substring(0,8)}...REDACTED`)}t.headers=a}return JSON.stringify(t,null,2)}catch(t){return t instanceof Error?t.message:String(t),"[REQUEST_JSON_PARSE_FAILED_REDACTED]"}}getProviderIdForCall(e,t){try{return t.configurations[e.configurationIndex]?.provider||null}catch(a){return a instanceof Error?a.message:String(a),e.id,null}}getFieldsRequiringSanitization(){return["request"]}createSanitizationSummary(e){const t=e.filter(a=>this.isAuthField(a));return{sanitizationEnabled:t.length>0,sanitizedFields:t}}}const Dt=new _c;class Tc{extractFieldValue(e,t,a){if(t.startsWith("param_"))return this.extractParameterValue(e,t,a);if(t.startsWith("var_"))return e.id,e.variables,this.extractVariableValue(e,t);if(t.startsWith("attr_")){e.id,e.variableAttributes;const n=this.extractAttributeValue(e,t);return e.id,n}if(t.startsWith("source_"))return this.extractSourceValue(e,t,a);const o=this.extractRawFieldValue(e,t,a);return Dt.isAuthField(t)?(e.id,Dt.sanitizeFieldValue(t,o,e,a)):o}extractRawFieldValue(e,t,a){switch(t){case"id":return e.id;case"order":return String(e.order);case"status":return e.status;case"created":return e.created.toISOString();case"completed":return e.completed?.toISOString()||"";case"configuration":return this.getConfigurationName(e,a);case"provider":return a.configurations[e.configurationIndex]?.provider||"";case"modelId":return a.configurations[e.configurationIndex]?.modelId||"";case"parameters":return this.getParametersJson(e,a);case"prompt":return e.prompt;case"variables":return JSON.stringify(e.variables||{});case"response":return e.result?.content||"";case"parsedResponse":return JSON.stringify(e.result?.parsedContent||{});case"latency":return String(e.response?.latencyMs||e.result?.latency||"");case"promptTokens":return String(e.result?.usage?.prompt_tokens||"");case"completionTokens":return String(e.result?.usage?.completion_tokens||"");case"totalTokens":return String(e.result?.usage?.total_tokens||"");case"request":return JSON.stringify(e.request||{});case"response_raw":return JSON.stringify(e.response||{});case"error":return e.result?.error||"";case"repeatIndex":return String(e.repeatIndex||"");case"cost":return e.cost!==void 0?String(e.cost):this.calculateCost(e,a);case"refused":return String(e.result?.refused||!1);default:return`UNKNOWN_FIELD: ${t}`}}extractMultipleFields(e,t,a){const o={};return t.forEach(n=>{o[n]=this.extractFieldValue(e,n,a)}),o}getFieldDefinitions(e,t){const a=this.getStandardFieldDefinitions(),o=ze.discoverAllParameters(e),n=t?ls.discoverAllVariables(e,t):[];return[...a,...o,...n]}getStandardFieldDefinitions(){return[{id:"id",name:"Call ID",description:"Unique identifier for the API call",group:"basic",dataType:"string",isRequired:!0},{id:"order",name:"Order",description:"Execution order of the API call within the trial",group:"basic",dataType:"number",isRequired:!0},{id:"status",name:"Status",description:"Current status of the API call (pending, running, completed, failed, cancelled)",group:"basic",dataType:"string",isRequired:!0},{id:"created",name:"Created Time",description:"When the API call was created (ISO timestamp)",group:"basic",dataType:"date",isRequired:!0},{id:"completed",name:"Completed Time",description:"When the API call was completed (ISO timestamp, empty if not completed)",group:"basic",dataType:"date",isRequired:!1},{id:"configuration",name:"Configuration",description:"Configuration name or model ID used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"provider",name:"Provider",description:"LLM provider used (e.g., openai-chat, anthropic, ollama)",group:"configuration",dataType:"string",isRequired:!0},{id:"modelId",name:"Model ID",description:"Specific model identifier used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"prompt",name:"Prompt",description:"The input prompt sent to the model",group:"content",dataType:"string",isRequired:!0},{id:"response",name:"Response",description:"The text response from the model",group:"content",dataType:"string",isRequired:!1},{id:"parsedResponse",name:"Parsed Response",description:"Structured/parsed response data (JSON)",group:"content",dataType:"json",isRequired:!1},{id:"latency",name:"Latency (ms)",description:"Response time in milliseconds",group:"performance",dataType:"number",isRequired:!1},{id:"promptTokens",name:"Prompt Tokens",description:"Number of tokens in the input prompt",group:"performance",dataType:"number",isRequired:!1},{id:"completionTokens",name:"Completion Tokens",description:"Number of tokens in the model response",group:"performance",dataType:"number",isRequired:!1},{id:"totalTokens",name:"Total Tokens",description:"Total tokens used (prompt + completion)",group:"performance",dataType:"number",isRequired:!1},{id:"request",name:"Full Request",description:"Complete API request sent to the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"response_raw",name:"Raw Response",description:"Full API response from the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"error",name:"Error Details",description:"Error message if the call failed",group:"technical",dataType:"string",isRequired:!1},{id:"repeatIndex",name:"Repeat Index",description:"Index for repeated calls (empty for single calls)",group:"technical",dataType:"number",isRequired:!1},{id:"cost",name:"Cost (USD)",description:"Calculated cost of the API call based on token usage",group:"performance",dataType:"number",isRequired:!1},{id:"refused",name:"Refused",description:"Whether the model refused to respond (true/false)",group:"content",dataType:"boolean",isRequired:!1}]}validateFields(e,t){const o=this.getFieldDefinitions(e).map(c=>c.id),n=[],u=[];return t.forEach(c=>{o.includes(c)?n.push(c):u.push(c)}),{validFields:n,invalidFields:u,availableFields:o}}extractParameterValue(e,t,a){const o=t.replace("param_",""),n=a.configurations[e.configurationIndex];if(!n||!n.parameters)return"";const u=n.parameters[o];return u==null?"":typeof u=="object"?JSON.stringify(u):String(u)}getConfigurationName(e,t){const a=t.configurations[e.configurationIndex];return a?a.modelId||`Config ${e.configurationIndex+1}`:`Config ${e.configurationIndex+1}`}getParametersJson(e,t){const a=t.configurations[e.configurationIndex];return!a||!a.parameters?"{}":JSON.stringify(a.parameters)}extractVariableValue(e,t){const a=t.replace("var_","");if(!e.variables||typeof e.variables!="object")return"";const o=e.variables[a];return o==null?"":typeof o=="object"?JSON.stringify(o):String(o)}extractAttributeValue(e,t){const a=t.replace("attr_","").split("_");if(a.length<2)return"";const o=a[0],n=a.slice(1).join("_");if(!e.variableAttributes||typeof e.variableAttributes!="object")return"";const u=e.variableAttributes[o];if(!u||typeof u!="object")return"";const c=u[n];return c==null?"":typeof c=="object"?JSON.stringify(c):String(c)}extractSourceValue(e,t,a){const o=t.replace("source_","").split("_");if(o.length<2)return"";const n=o[o.length-1],u=o.slice(0,-1).join("_");if(!e.variableIndices||typeof e.variableIndices!="object")return"";const c=e.variableIndices[u];if(c==null)return"";if(n==="index")return String(c);if(n==="list"){if(a.type==="template"&&a.templateConfig?.variables){const d=a.templateConfig.variables[u];if(d&&"snapshot"in d&&d.snapshot?.source?.listName)return d.snapshot.source.listName;if(d?.listId)return d.listId}return""}return""}calculateCost(e,t){if(!e.result?.usage)return"0";const a=t.configurations[e.configurationIndex];if(!a)return"0";const o=a.modelSnapshot;if(!o)return"0";const n=e.result.usage.prompt_tokens,u=e.result.usage.completion_tokens,c=kt(n,o.capabilities?.inputCostPerToken),d=kt(u,o.capabilities?.outputCostPerToken);if(c===null||d===null)return"N/A";const f=c+d;return Vs(f).replace("$","")}}const he=new Tc;class $c{getMimeType(e){switch(e){case"csv":return"text/csv";case"excel":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"tsv":return"text/tab-separated-values";case"json":return"application/json";case"jsonl":return"application/x-jsonlines";case"python":return"text/x-python";case"zip":return"application/zip";default:return"application/octet-stream"}}getFileExtension(e){switch(e){case"csv":return"csv";case"excel":return"xlsx";case"tsv":return"tsv";case"json":return"json";case"jsonl":return"jsonl";case"python":return"py";case"zip":return"zip";default:return"bin"}}generateFilename(e,t,a){const o=this.sanitizeFilename(e),u=(a||new Date).toISOString().split("T")[0],c=this.getFileExtension(t);return`${o}_${t}_${u}.${c}`}estimateFileSize(e,t,a,o=50){let n=e*t*o;switch(a){case"json":n*=2.5;break;case"jsonl":n*=2.2;break;case"csv":n*=1.3;break;case"excel":n*=.8;break;case"tsv":n*=1.1;break;case"python":n=Math.max(n*1.5,5e3);break}return Math.round(n)}formatFileSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:`${(e/(1024*1024*1024)).toFixed(1)} GB`}createDownloadBlob(e,t,a=!1){let o=e;return a&&(o="\uFEFF"+o),new Blob([o],{type:t})}createDownloadBlobFromBase64(e,t){const a=atob(e),o=new Uint8Array(a.length);for(let n=0;n<a.length;n++)o[n]=a.charCodeAt(n);return new Blob([o],{type:t})}triggerDownload(e,t){const a=URL.createObjectURL(e),o=document.createElement("a");o.href=a,o.download=t,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(a),100)}downloadFile(e,t,a,o=!1){const n=this.getMimeType(t),u=this.generateFilename(a,t);let c;t==="excel"?c=this.createDownloadBlobFromBase64(e,n):c=this.createDownloadBlob(e,n,o),this.triggerDownload(c,u)}sanitizeFilename(e){return e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_+/g,"_").substring(0,50).replace(/^_+|_+$/g,"")||"trial"}}const ue=new $c;class Cc{validateFormat(e){const t=["csv","tsv","excel","json","jsonl","python"];return t.includes(e)?{isValid:!0,errors:[],warnings:[]}:{isValid:!1,errors:[`Invalid format: ${e}. Supported formats: ${t.join(", ")}`],warnings:[]}}validateFields(e,t,a){if(!t||t.length===0)return{isValid:!1,errors:["No fields selected for export"],warnings:[],unknownFields:[],supportedFields:he.getFieldDefinitions(e,a).map(f=>f.id)};const o=he.validateFields(e,t),n=o.invalidFields.filter(f=>!f.startsWith("var_")&&!f.startsWith("attr_")),u={isValid:n.length===0,errors:[],warnings:[],unknownFields:n,supportedFields:o.availableFields};n.length>0&&u.errors.push(`Unknown fields requested: ${n.join(", ")}`),(t.includes("request")||t.includes("response_raw"))&&u.warnings.push("Technical fields (request, response_raw) contain large JSON objects and may significantly increase file size");const c=t.filter(f=>f.startsWith("param_"));c.length>10&&u.warnings.push(`Large number of parameter fields selected (${c.length}). This may result in a very wide export file with many empty cells.`);const d=t.filter(f=>f.startsWith("var_"));return d.length>10&&u.warnings.push(`Large number of variable fields selected (${d.length}). This may result in a very wide export file with many empty cells.`),u}validateExportSize(e,t,a){const o=ue.estimateFileSize(e,t,a),n=o/(1024*1024),u={isValid:!0,errors:[],warnings:[]};return n>500?(u.isValid=!1,u.errors.push(`Export too large: ${ue.formatFileSize(o)}. Maximum allowed: 500MB. Consider reducing the number of fields or using filters.`)):n>100&&u.warnings.push(`Large export: ${ue.formatFileSize(o)}. This may take several minutes to generate and download.`),e>1e5&&u.warnings.push(`Large number of records: ${e.toLocaleString()}. Export generation may take several minutes.`),t>50&&u.warnings.push(`Large number of fields: ${t}. Resulting file will be very wide and may be difficult to work with in spreadsheet applications.`),u}validateExportOptions(e,t,a){const o=[],n=[],u=this.validateFormat(t.format);if(u.isValid||o.push(...u.errors),t.fields){const c=this.validateFields(e,t.fields,a);c.isValid||o.push(...c.errors),n.push(...c.warnings);const d=this.validateExportSize(e.progress?.total||0,t.fields.length,t.format);d.isValid||o.push(...d.errors),n.push(...d.warnings)}return t.format==="python"&&t.fields&&t.fields.length>0&&n.push("Field selection is ignored for Python exports. Python scripts include all available data."),{isValid:o.length===0,errors:o,warnings:n}}getRecommendedFields(e){const t=["order","status","configuration","prompt","response","latency"],a=he.getFieldDefinitions(e).filter(u=>u.group==="parameters").map(u=>u.id),o=["param_temperature","param_max_tokens","param_top_p"],n=a.filter(u=>o.includes(u));return[...t,...n]}}const st=new Cc;class Oe{validateOptions(e){const t=[],a=[];e.fields&&e.fields.length===0&&t.push("At least one field must be selected");const o=this.getFormatInfo();return e.includeHeaders&&!o.supportsHeaders&&a.push(`${o.name} format does not support headers - ignoring includeHeaders option`),e.addBOM&&!o.supportsBOM&&a.push(`${o.name} format does not support BOM - ignoring addBOM option`),{isValid:t.length===0,errors:t,warnings:a}}prepareFieldList(e,t){if(t&&t.length>0){const c=t.filter(b=>b.startsWith("var_")),d=t.filter(b=>b.startsWith("attr_")),f=t.filter(b=>!b.startsWith("var_")&&!b.startsWith("attr_")),h=he.validateFields(e,f);return h.invalidFields.length>0&&A.warn("Invalid fields requested:",h.invalidFields),[...h.validFields,...c,...d]}const a=["id","order","status","configuration","provider","modelId","prompt","response","refused","latency"],o=ze.discoverAllParameters(e),n=["param_temperature","param_max_tokens","param_top_p"],u=o.filter(c=>n.includes(c.id)).map(c=>c.id);return[...a,...u]}prepareDataRows(e,t,a){return e.map(o=>t.map(n=>he.extractFieldValue(o,n,a)))}prepareHeaderRow(e){return e.map(t=>t.startsWith("param_")?`param_${t.replace("param_","")}`:t.replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase()).trim())}hasParameterFields(e){return e.some(t=>t.startsWith("param_"))}escapeFieldValue(e){return e==null?"":String(e)}}class kc extends Oe{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=[];if(a.includeHeaders!==!1){const f=this.prepareHeaderRow(o).map(h=>this.escapeCSVValue(h)).join(",");n.push(f)}this.prepareDataRows(e,o,t).forEach(d=>{const f=d.map(h=>this.escapeCSVValue(h)).join(",");n.push(f)});let c=n.join(`
`);return a.addBOM&&(c="\uFEFF"+c),c}getFormatInfo(){return{name:"CSV",description:"Comma-separated values format, compatible with Excel and other spreadsheet applications",mimeType:"text/csv",extension:"csv",supportsHeaders:!0,supportsBOM:!0}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];if(e.fields&&e.fields.length>30&&a.push("Large number of columns may make the CSV difficult to work with in spreadsheet applications"),e.fields){const o=["variables","parsedResponse","request","response_raw"];e.fields.some(u=>o.includes(u))&&a.push("JSON fields (variables, parsedResponse, request, response_raw) may not display well in spreadsheet applications")}return{...t,warnings:a}}escapeCSVValue(e){if(e==null)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes(`
`)||t.includes("\r")?`"${t.replace(/"/g,'""')}"`:t}}class wc extends Oe{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=[];if(a.includeHeaders!==!1){const d=this.prepareHeaderRow(o).map(f=>this.escapeTSVValue(f)).join("	");n.push(d)}return this.prepareDataRows(e,o,t).forEach(c=>{const d=c.map(f=>this.escapeTSVValue(f)).join("	");n.push(d)}),n.join(`
`)}getFormatInfo(){return{name:"TSV",description:"Tab-separated values format, useful for data analysis tools and database imports",mimeType:"text/tab-separated-values",extension:"tsv",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return a.push("TSV format may not be directly supported by all spreadsheet applications"),{...t,warnings:a}}escapeTSVValue(e){return e==null?"":String(e).replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}}class Sc extends Oe{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=et.book_new(),u=[];if(a.includeHeaders!==!1){const b=this.prepareHeaderRow(o);u.push(b)}const c=this.prepareDataRows(e,o,t);u.push(...c);const d=et.aoa_to_sheet(u),f=this.calculateColumnWidths(u);return d["!cols"]=f,et.book_append_sheet(n,d,"Export Data"),ma(n,{type:"base64",bookType:"xlsx",compression:!0})}getFormatInfo(){return{name:"Excel",description:"Microsoft Excel .xlsx format with proper formatting and auto-sized columns",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",extension:"xlsx",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.fields&&e.fields.length>16384&&a.push("Excel has a limit of 16,384 columns - some fields may not display correctly"),e.addBOM&&a.push("Excel .xlsx format is binary - ignoring addBOM option"),a.push("Excel format provides native spreadsheet functionality with auto-sized columns"),{...t,warnings:a}}calculateColumnWidths(e){if(e.length===0)return[];const t=Math.max(...e.map(o=>o.length)),a=[];for(let o=0;o<t;o++){let n=10;for(const u of e)if(u[o]!==void 0){const c=String(u[o]).length;n=Math.max(n,Math.min(c*1.2,50))}a.push({wch:n})}return a}}class Ic extends Oe{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n={metadata:{trialId:t.id,trialName:t.name,trialType:t.type,exportDate:new Date().toISOString(),recordCount:e.length,fieldCount:o.length,hasParameterFields:this.hasParameterFields(o)},trial:{id:t.id,name:t.name,description:t.description,type:t.type,status:t.status,created:t.created.toISOString(),configurations:t.configurations.map((u,c)=>({index:c,provider:u.provider,modelId:u.modelId,parameters:u.parameters||{}}))},fields:o.map(u=>{const c=he.getFieldDefinitions(t).find(d=>d.id===u);return{id:u,name:c?.name||u,description:c?.description||"",group:c?.group||"unknown",dataType:c?.dataType||"string"}}),apiCalls:e.map(u=>{const c={};return o.forEach(d=>{const f=he.extractFieldValue(u,d,t);c[d]=this.parseJSONValue(f,d)}),c})};return JSON.stringify(n,null,2)}getFormatInfo(){return{name:"JSON",description:"JavaScript Object Notation format with complete trial metadata and structured data",mimeType:"application/json",extension:"json",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSON format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSON format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("Large number of fields in JSON format may result in large file sizes and memory usage"),{...t,warnings:a}}parseJSONValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const n=Number(e);return isNaN(n)?null:n}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const n=Number(e);if(!isNaN(n))return n;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return e}}class Ec extends Oe{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=[];return e.forEach(u=>{const c={};o.forEach(d=>{const f=he.extractFieldValue(u,d,t);c[d]=this.parseJSONLValue(f,d)}),n.push(JSON.stringify(c))}),n.join(`
`)}getFormatInfo(){return{name:"JSONL",description:"JSON Lines format with one JSON object per line, ideal for streaming and big data processing",mimeType:"application/x-jsonlines",extension:"jsonl",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSONL format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSONL format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("JSONL format handles large datasets well, but many fields may impact readability"),{...t,warnings:a}}parseJSONLValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const u=Number(e);return isNaN(u)?null:u}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const u=Number(e);if(!isNaN(u))return u;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return["created","completed"].includes(t),e}}function Rc(l){switch(l){case"csv":return new kc;case"tsv":return new wc;case"excel":return new Sc;case"json":return new Ic;case"jsonl":return new Ec;default:throw new Error(`Unsupported format: ${l}`)}}class Fc{async exportTrialData(e,t){const a=Date.now();t.format;try{const o=await Le.loadTrialForExport(e);if(!o.ok){const k=o.error;return{ok:!1,error:new de("GENERATION_FAILED",`Failed to load trial data: ${k.message}`,{trialId:e,originalError:k})}}const{trial:n,apiCalls:u}=o.value;t.format;const c=await this.validateExportOptions(e,t,u);if(!c.ok){const k=c.error;return{ok:!1,error:new de("GENERATION_FAILED",`Validation failed: ${k.message}`,{trialId:e,options:t,originalError:k})}}if(!c.value.isValid)return{ok:!1,error:new de("INVALID_FIELDS",`Export validation failed: ${c.value.errors.join(", ")}`,{errors:c.value.errors})};t.format;const d=Rc(t.format);t.format,u.length,t.fields?.length,t.fields,t.fields?.filter(k=>k.startsWith("param_")),t.fields?.filter(k=>k.startsWith("var_")),t.fields?.filter(k=>k.startsWith("attr_"));const f=Date.now(),h=await d.generate(u,n,t);Date.now()-f,h.length,Ot(h);const b=t.fields||[],T=Date.now()-a,E={filename:ue.generateFilename(n.name,t.format),mimeType:d.getFormatInfo().mimeType,data:h,metadata:{trialName:n.name,trialId:n.id,exportDate:new Date,callCount:u.length,fieldCount:b.length,format:t.format,estimatedSizeBytes:Ot(h)},format:t.format,recordCount:u.length,fieldCount:b.length,hasParameterFields:b.some(k=>k.startsWith("param_")),generationTimeMs:T};return t.format,E.filename,E.metadata.estimatedSizeBytes,E.generationTimeMs,{ok:!0,value:E}}catch(o){const n=o instanceof Error?o:new Error(String(o));return n.message,n.stack,n.name,n.constructor.name,t.format,Date.now()-a,{ok:!1,error:new de("GENERATION_FAILED",`Export generation failed: ${n.message}`,{trialId:e,options:t,originalError:o,generationTimeMs:Date.now()-a})}}}async previewExport(e,t){try{const a=await Le.loadTrialForExport(e);if(!a.ok){const T=a.error;return{ok:!1,error:new de("GENERATION_FAILED",`Failed to load trial data: ${T.message}`,{trialId:e,originalError:T})}}const{trial:o,apiCalls:n}=a.value,u=he.getFieldDefinitions(o),c=ze.discoverAllParameters(o),d=t.fields||this.getDefaultFields(o),f=t.format||"csv",h=ue.estimateFileSize(n.length,d.length,f);return{ok:!0,value:{fieldCount:d.length,recordCount:n.length,estimatedSizeBytes:h,availableFields:u,parameterFields:c}}}catch(a){return{ok:!1,error:new de("GENERATION_FAILED",`Preview generation failed: ${a instanceof Error?a.message:"Unknown error"}`,{trialId:e,options:t,originalError:a})}}}async getAvailableFields(e){try{const t=await Le.loadTrialForExport(e);if(!t.ok){const f=t.error;return{ok:!1,error:new de("GENERATION_FAILED",`Failed to load trial data: ${f.message}`,{trialId:e,originalError:f})}}const{trial:a,apiCalls:o}=t.value,n=he.getStandardFieldDefinitions(),u=ze.discoverAllParameters(a),c=ls.discoverAllVariables(a,o),d=st.getRecommendedFields(a);return{ok:!0,value:{standardFields:n,parameterFields:u,variableFields:c,recommendedFields:d}}}catch(t){return{ok:!1,error:new de("GENERATION_FAILED",`Field discovery failed: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateExportOptions(e,t,a){try{const o=await Le.loadTrialForExport(e);if(!o.ok){const c=o.error;return{ok:!1,error:new de("GENERATION_FAILED",`Failed to load trial data: ${c.message}`,{trialId:e,originalError:c})}}const{trial:n}=o.value;return{ok:!0,value:st.validateExportOptions(n,t,a)}}catch(o){return{ok:!1,error:new de("GENERATION_FAILED",`Validation failed: ${o instanceof Error?o.message:"Unknown error"}`,{trialId:e,options:t,originalError:o})}}}getDefaultFields(e){return st.getRecommendedFields(e)}}const ct=new Fc;let pt=null,ft=null,Be=!1;try{typeof window<"u"&&("__TAURI__"in window||"__TAURI_INTERNALS__"in window)&&(Be=!0)}catch{}async function Pc(){if(!Be)return!1;try{return pt||(pt=await Re(()=>import("./tauri-vendor-DvKxkFnM.js").then(l=>l.b),[])),ft||(ft=await Re(()=>import("./tauri-vendor-DvKxkFnM.js").then(l=>l.c),[])),!0}catch(l){return A.warn("Failed to load Tauri modules:",l),Be=!1,!1}}class is{async downloadFile(e,t,a,o=!1){await this.useTauriSaveDialog(e,t,a,o)||this.useBrowserDownload(e,t,a,o)}async useTauriSaveDialog(e,t,a,o){if(!await Pc())return!1;try{const n=ue.generateFilename(a,t),u=ue.getFileExtension(t),c=await pt.save({defaultPath:n,filters:[{name:this.getFilterName(t),extensions:[u]}],title:`Save ${this.getFilterName(t)} File`});if(!c)return!0;let d;if(typeof e=="string"){const f=o?"\uFEFF"+e:e;d=new TextEncoder().encode(f)}else d=e;return await ft.writeFile(c,d),`${c}`,!0}catch(n){return A.error("Tauri save dialog error:",n),!1}}useBrowserDownload(e,t,a,o){if(e instanceof Uint8Array&&(t==="zip"||t==="excel")){const b=ue.getMimeType(t),T=ue.generateFilename(a,t),E=new Blob([e],{type:b}),k=window.URL.createObjectURL(E),C=document.createElement("a");C.href=k,C.download=T,document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(k);return}e instanceof Uint8Array&&(e=new TextDecoder().decode(e));const n=ue.getMimeType(t),u=ue.generateFilename(a,t),c=o?"\uFEFF"+e:e,d=new Blob([c],{type:n}),f=window.URL.createObjectURL(d),h=document.createElement("a");h.href=f,h.download=u,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(f)}async downloadExcelFile(e,t){const a=atob(e),o=new Uint8Array(a.length);for(let n=0;n<a.length;n++)o[n]=a.charCodeAt(n);await this.downloadFile(o,"excel",t,!1)}getFilterName(e){switch(e){case"csv":return"CSV";case"excel":return"Excel";case"tsv":return"TSV";case"json":return"JSON";case"jsonl":return"JSON Lines";case"python":return"Python Script";case"zip":return"ZIP Archive";default:return"Binary"}}isInTauri(){return Be}generateFilename(e,t,a){return ue.generateFilename(e,t,a)}getMimeType(e){return ue.getMimeType(e)}getFileExtension(e){return ue.getFileExtension(e)}estimateFileSize(e,t,a,o=50){return ue.estimateFileSize(e,t,a,o)}formatFileSize(e){return ue.formatFileSize(e)}}const We=new is,xc=Object.freeze(Object.defineProperty({__proto__:null,TauriDownloadUtilities:is,tauriDownloadUtilities:We},Symbol.toStringTag,{value:"Module"})),Ac={class:"export-content"},Vc={class:"section"},Oc={key:0,class:"section"},Dc={class:"bundle-info"},Nc={key:0},Lc={key:1,class:"section"},Mc={class:"field-actions"},Uc={class:"field-groups"},zc={class:"field-group"},Bc={class:"field-list"},Wc={class:"field-group"},jc={class:"field-list"},Hc={class:"field-group"},qc={class:"field-list"},Gc={class:"field-group"},Jc={class:"field-list"},Xc={class:"field-group"},Kc={class:"field-list"},Qc={key:0,class:"field-group"},Yc={class:"field-list"},Zc={key:1,class:"field-group"},ep={class:"field-list"},tp={class:"section"},sp={class:"preview-info"},ap={class:"info-item"},np={class:"value"},op={class:"info-item"},rp={class:"value"},lp={class:"info-item"},ip={class:"value"},up={class:"export-actions"},dp=re({__name:"ExportDataModalV3",props:{visible:{type:Boolean},trial:{}},emits:["update:visible"],setup(l,{emit:e}){const t=l,a=e,o=q("csv"),n=q(["order","status","configuration","prompt","response","latency"]),u=q(!1),c=q("draft"),d=q({}),f=q([]),h=q([]),b=q([]),T=["order","status","configuration","prompt","response","latency"],E=q([]),k=["id","order","status","created","completed","configuration","provider","modelId","parameters","prompt","variables","response","parsedResponse","latency","promptTokens","completionTokens","totalTokens","cost","request","response_raw","error","repeatIndex"],C=M(()=>{const R=t.trial.progress?.completed||0,r=t.trial.progress?.failed||0;return R+r}),z=M(()=>{const r=n.value.length*50*C.value;return r<1024?`${r} B`:r<1024*1024?`${(r/1024).toFixed(1)} KB`:`${(r/(1024*1024)).toFixed(1)} MB`});function N(){E.value.length,E.value.forEach(j=>{d.value[j]=!1}),T.forEach(j=>{d.value[j]=!0});const R=h.value.map(j=>j.id),r=b.value.map(j=>j.id);R.forEach(j=>{d.value[j]=!0}),r.forEach(j=>{d.value[j]=!0}),T.length,R.length,r.length,T.length+R.length+r.length,O()}function O(){n.value=E.value.filter(R=>d.value[R])}function I(R,r){d.value[R]=r,O()}function w(){E.value.forEach(R=>{d.value[R]=!0}),O()}function U(){E.value.forEach(j=>{d.value[j]=!1}),T.forEach(j=>{d.value[j]=!0});const R=h.value.map(j=>j.id),r=b.value.map(j=>j.id);R.forEach(j=>{d.value[j]=!0}),r.forEach(j=>{d.value[j]=!0}),O()}function $(){E.value.forEach(R=>{d.value[R]=!1}),O()}function m(){a("update:visible",!1)}async function L(){if(o.value==="bundle"){u.value=!0;try{const{trialBundleExportService:R}=await Re(async()=>{const{trialBundleExportService:K}=await import("./trial-bundle.service-RXJifw-s.js");return{trialBundleExportService:K}},__vite__mapDeps([0,1,2,3,4,5,6])),r=c.value==="completed",j=await R.exportTrialBundle(t.trial.id,{includeResults:r,includeApiCalls:r,format:"json"});j.ok?(ne.success(`Trial bundle exported: ${j.value.filename}`),a("update:visible",!1)):ne.error(`Bundle export failed: ${j.error.message}`)}catch(R){ne.error(`Bundle export failed: ${R instanceof Error?R.message:"Unknown error"}`)}finally{u.value=!1}return}if(n.value.length===0){ne.warning("Please select at least one field to export");return}u.value=!0;try{const R={format:o.value,fields:n.value,includeHeaders:!0,addBOM:o.value==="excel"||o.value==="csv"},r=await ct.exportTrialData(t.trial.id,R);r.ok?(R.format==="excel"&&typeof r.value.data=="string"?await We.downloadExcelFile(r.value.data,r.value.metadata.trialName):await We.downloadFile(r.value.data,R.format,r.value.metadata.trialName,R.addBOM),ne.success("Export completed successfully"),a("update:visible",!1)):ne.error(`Export failed: ${r.error.message}`)}catch(R){ne.error("Export failed: "+R.message)}finally{u.value=!1}}return me(async()=>{t.trial.id;const R=await ct.getAvailableFields(t.trial.id);if(R.ok){f.value=R.value.standardFields,h.value=R.value.parameterFields,b.value=(R.value.variableFields||[]).filter(V=>!V.id.startsWith("source_"));const r=R.value.standardFields.map(V=>V.id).filter(V=>V!=="parameters"&&V!=="variables"),j=R.value.parameterFields.map(V=>V.id),K=b.value.map(V=>V.id);E.value=[...r,...j,...K],R.value.standardFields.length,R.value.parameterFields.length,(R.value.variableFields||[]).length,E.value.length,R.value.parameterFields.map(V=>V.id),(R.value.variableFields||[]).map(V=>V.id),E.value}else R.error,E.value=[...k];N()}),(R,r)=>{const j=ra,K=yt,V=bt,G=ve,v=Qt,y=Ce;return i(),Q(y,{visible:R.visible,"onUpdate:visible":r[46]||(r[46]=g=>R.$emit("update:visible",g)),title:"Export Trial Data",width:800,footer:null,"destroy-on-close":!0,class:"export-data-modal"},{default:P(()=>[s("div",Ac,[s("div",Vc,[r[53]||(r[53]=s("h4",null,"Export Format",-1)),S(K,{value:o.value,"onUpdate:value":r[0]||(r[0]=g=>o.value=g),class:"format-options"},{default:P(()=>[S(j,{value:"csv"},{default:P(()=>r[47]||(r[47]=[D("CSV")])),_:1,__:[47]}),S(j,{value:"tsv"},{default:P(()=>r[48]||(r[48]=[D("TSV")])),_:1,__:[48]}),S(j,{value:"excel"},{default:P(()=>r[49]||(r[49]=[D("Excel")])),_:1,__:[49]}),S(j,{value:"json"},{default:P(()=>r[50]||(r[50]=[D("JSON")])),_:1,__:[50]}),S(j,{value:"jsonl"},{default:P(()=>r[51]||(r[51]=[D("JSONL")])),_:1,__:[51]}),S(j,{value:"bundle"},{default:P(()=>r[52]||(r[52]=[D("Auditomatic Trial Format")])),_:1,__:[52]})]),_:1},8,["value"])]),o.value==="bundle"?(i(),p("div",Oc,[r[64]||(r[64]=s("h4",null,"Auditomatic Trial Format",-1)),s("div",Dc,[r[61]||(r[61]=s("p",{style:{"margin-bottom":"16px",color:"var(--color-text-secondary)"}}," Export your trial in Auditomatic's native format to recreate the exact trial on another browser or computer. Perfect for sharing experiments with collaborators or backing up your work. ",-1)),S(K,{value:c.value,"onUpdate:value":r[1]||(r[1]=g=>c.value=g),style:{"margin-bottom":"16px"}},{default:P(()=>[S(V,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:P(()=>r[54]||(r[54]=[s("strong",null,"Export as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Trial configuration only - recreate the trial setup and run a fresh experiment ",-1)])),_:1,__:[54]}),S(V,{value:"completed",style:{display:"block"}},{default:P(()=>r[55]||(r[55]=[s("strong",null,"Export with Results",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Complete trial with all execution results - review past experiments or continue where you left off ",-1)])),_:1,__:[55]})]),_:1},8,["value"]),r[62]||(r[62]=s("p",null,"The exported file contains:",-1)),s("ul",null,[r[56]||(r[56]=s("li",null,"✅ Complete trial configuration",-1)),r[57]||(r[57]=s("li",null,"✅ Template with metadata",-1)),r[58]||(r[58]=s("li",null,"✅ All variable lists",-1)),r[59]||(r[59]=s("li",null,"✅ Model configurations",-1)),c.value==="completed"?(i(),p("li",Nc,"✅ Execution results and API calls")):F("",!0),r[60]||(r[60]=s("li",null,"✅ Variable index tracking for lineage",-1))]),r[63]||(r[63]=s("p",{style:{"margin-top":"12px"}},[s("strong",null,"To import:"),D(' Use the "Import Trial" button on the Trials page to load this file on any Auditomatic instance. ')],-1))])])):(i(),p("div",Lc,[r[97]||(r[97]=s("h4",null,"Fields to Export",-1)),s("div",Mc,[S(G,{size:"small",onClick:w},{default:P(()=>r[65]||(r[65]=[D("Select All")])),_:1,__:[65]}),S(G,{size:"small",onClick:U},{default:P(()=>r[66]||(r[66]=[D("Select Defaults")])),_:1,__:[66]}),S(G,{size:"small",onClick:$},{default:P(()=>r[67]||(r[67]=[D("Clear All")])),_:1,__:[67]})]),s("div",Uc,[s("div",zc,[r[73]||(r[73]=s("h5",null,"Basic Information",-1)),s("div",Bc,[S(v,{checked:d.value.id,"onUpdate:checked":r[2]||(r[2]=g=>d.value.id=g),onChange:r[3]||(r[3]=g=>I("id",g.target.checked))},{default:P(()=>r[68]||(r[68]=[D("Call ID")])),_:1,__:[68]},8,["checked"]),S(v,{checked:d.value.order,"onUpdate:checked":r[4]||(r[4]=g=>d.value.order=g),onChange:r[5]||(r[5]=g=>I("order",g.target.checked))},{default:P(()=>r[69]||(r[69]=[D("Order")])),_:1,__:[69]},8,["checked"]),S(v,{checked:d.value.status,"onUpdate:checked":r[6]||(r[6]=g=>d.value.status=g),onChange:r[7]||(r[7]=g=>I("status",g.target.checked))},{default:P(()=>r[70]||(r[70]=[D("Status")])),_:1,__:[70]},8,["checked"]),S(v,{checked:d.value.created,"onUpdate:checked":r[8]||(r[8]=g=>d.value.created=g),onChange:r[9]||(r[9]=g=>I("created",g.target.checked))},{default:P(()=>r[71]||(r[71]=[D("Created Time")])),_:1,__:[71]},8,["checked"]),S(v,{checked:d.value.completed,"onUpdate:checked":r[10]||(r[10]=g=>d.value.completed=g),onChange:r[11]||(r[11]=g=>I("completed",g.target.checked))},{default:P(()=>r[72]||(r[72]=[D("Completed Time")])),_:1,__:[72]},8,["checked"])])]),s("div",Wc,[r[78]||(r[78]=s("h5",null,"Configuration",-1)),s("div",jc,[S(v,{checked:d.value.configuration,"onUpdate:checked":r[12]||(r[12]=g=>d.value.configuration=g),onChange:r[13]||(r[13]=g=>I("configuration",g.target.checked))},{default:P(()=>r[74]||(r[74]=[D("Configuration Name")])),_:1,__:[74]},8,["checked"]),S(v,{checked:d.value.provider,"onUpdate:checked":r[14]||(r[14]=g=>d.value.provider=g),onChange:r[15]||(r[15]=g=>I("provider",g.target.checked))},{default:P(()=>r[75]||(r[75]=[D("Provider")])),_:1,__:[75]},8,["checked"]),S(v,{checked:d.value.modelId,"onUpdate:checked":r[16]||(r[16]=g=>d.value.modelId=g),onChange:r[17]||(r[17]=g=>I("modelId",g.target.checked))},{default:P(()=>r[76]||(r[76]=[D("Model ID")])),_:1,__:[76]},8,["checked"]),S(v,{checked:d.value.parameters,"onUpdate:checked":r[18]||(r[18]=g=>d.value.parameters=g),onChange:r[19]||(r[19]=g=>I("parameters",g.target.checked))},{default:P(()=>r[77]||(r[77]=[D("Parameters")])),_:1,__:[77]},8,["checked"])])]),s("div",Hc,[r[83]||(r[83]=s("h5",null,"Content",-1)),s("div",qc,[S(v,{checked:d.value.prompt,"onUpdate:checked":r[20]||(r[20]=g=>d.value.prompt=g),onChange:r[21]||(r[21]=g=>I("prompt",g.target.checked))},{default:P(()=>r[79]||(r[79]=[D("Prompt")])),_:1,__:[79]},8,["checked"]),S(v,{checked:d.value.variables,"onUpdate:checked":r[22]||(r[22]=g=>d.value.variables=g),onChange:r[23]||(r[23]=g=>I("variables",g.target.checked))},{default:P(()=>r[80]||(r[80]=[D("Variables")])),_:1,__:[80]},8,["checked"]),S(v,{checked:d.value.response,"onUpdate:checked":r[24]||(r[24]=g=>d.value.response=g),onChange:r[25]||(r[25]=g=>I("response",g.target.checked))},{default:P(()=>r[81]||(r[81]=[D("Response")])),_:1,__:[81]},8,["checked"]),S(v,{checked:d.value.parsedResponse,"onUpdate:checked":r[26]||(r[26]=g=>d.value.parsedResponse=g),onChange:r[27]||(r[27]=g=>I("parsedResponse",g.target.checked))},{default:P(()=>r[82]||(r[82]=[D("Parsed Response")])),_:1,__:[82]},8,["checked"])])]),s("div",Gc,[r[89]||(r[89]=s("h5",null,"Performance",-1)),s("div",Jc,[S(v,{checked:d.value.latency,"onUpdate:checked":r[28]||(r[28]=g=>d.value.latency=g),onChange:r[29]||(r[29]=g=>I("latency",g.target.checked))},{default:P(()=>r[84]||(r[84]=[D("Latency (ms)")])),_:1,__:[84]},8,["checked"]),S(v,{checked:d.value.promptTokens,"onUpdate:checked":r[30]||(r[30]=g=>d.value.promptTokens=g),onChange:r[31]||(r[31]=g=>I("promptTokens",g.target.checked))},{default:P(()=>r[85]||(r[85]=[D("Prompt Tokens")])),_:1,__:[85]},8,["checked"]),S(v,{checked:d.value.completionTokens,"onUpdate:checked":r[32]||(r[32]=g=>d.value.completionTokens=g),onChange:r[33]||(r[33]=g=>I("completionTokens",g.target.checked))},{default:P(()=>r[86]||(r[86]=[D("Completion Tokens")])),_:1,__:[86]},8,["checked"]),S(v,{checked:d.value.totalTokens,"onUpdate:checked":r[34]||(r[34]=g=>d.value.totalTokens=g),onChange:r[35]||(r[35]=g=>I("totalTokens",g.target.checked))},{default:P(()=>r[87]||(r[87]=[D("Total Tokens")])),_:1,__:[87]},8,["checked"]),S(v,{checked:d.value.cost,"onUpdate:checked":r[36]||(r[36]=g=>d.value.cost=g),onChange:r[37]||(r[37]=g=>I("cost",g.target.checked))},{default:P(()=>r[88]||(r[88]=[D("Cost (USD)")])),_:1,__:[88]},8,["checked"])])]),s("div",Xc,[r[94]||(r[94]=s("h5",null,"Technical Details",-1)),s("div",Kc,[S(v,{checked:d.value.request,"onUpdate:checked":r[38]||(r[38]=g=>d.value.request=g),onChange:r[39]||(r[39]=g=>I("request",g.target.checked))},{default:P(()=>r[90]||(r[90]=[D("Full Request")])),_:1,__:[90]},8,["checked"]),S(v,{checked:d.value.response_raw,"onUpdate:checked":r[40]||(r[40]=g=>d.value.response_raw=g),onChange:r[41]||(r[41]=g=>I("response_raw",g.target.checked))},{default:P(()=>r[91]||(r[91]=[D("Raw Response")])),_:1,__:[91]},8,["checked"]),S(v,{checked:d.value.error,"onUpdate:checked":r[42]||(r[42]=g=>d.value.error=g),onChange:r[43]||(r[43]=g=>I("error",g.target.checked))},{default:P(()=>r[92]||(r[92]=[D("Error Details")])),_:1,__:[92]},8,["checked"]),S(v,{checked:d.value.repeatIndex,"onUpdate:checked":r[44]||(r[44]=g=>d.value.repeatIndex=g),onChange:r[45]||(r[45]=g=>I("repeatIndex",g.target.checked))},{default:P(()=>r[93]||(r[93]=[D("Repeat Index")])),_:1,__:[93]},8,["checked"])])]),h.value.length>0?(i(),p("div",Qc,[r[95]||(r[95]=s("h5",null,"Parameters (Individual Columns)",-1)),s("div",Yc,[(i(!0),p(Y,null,ee(h.value,g=>(i(),Q(v,{key:g.id,checked:d.value[g.id],"onUpdate:checked":x=>d.value[g.id]=x,onChange:x=>I(g.id,x.target.checked)},{default:P(()=>[D(_(g.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):F("",!0),b.value.length>0?(i(),p("div",Zc,[r[96]||(r[96]=s("h5",null,"Attributes (Individual Columns)",-1)),s("div",ep,[(i(!0),p(Y,null,ee(b.value,g=>(i(),Q(v,{key:g.id,checked:d.value[g.id],"onUpdate:checked":x=>d.value[g.id]=x,onChange:x=>I(g.id,x.target.checked)},{default:P(()=>[D(_(g.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):F("",!0)])])),s("div",tp,[r[101]||(r[101]=s("h4",null,"Export Preview",-1)),s("div",sp,[s("div",ap,[r[98]||(r[98]=s("span",{class:"label"},"Records:",-1)),s("span",np,_(C.value),1)]),s("div",op,[r[99]||(r[99]=s("span",{class:"label"},"Fields:",-1)),s("span",rp,_(n.value.length),1)]),s("div",lp,[r[100]||(r[100]=s("span",{class:"label"},"Estimated Size:",-1)),s("span",ip,_(z.value),1)])])]),s("div",up,[S(G,{onClick:m},{default:P(()=>r[102]||(r[102]=[D("Cancel")])),_:1,__:[102]}),S(G,{type:"primary",onClick:L,loading:u.value,disabled:n.value.length===0},{default:P(()=>[S(H(Zt)),r[103]||(r[103]=D(" Export "))]),_:1,__:[103]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),cp=le(dp,[["__scopeId","data-v-8229d46c"]]),pp={class:"trial-details-panel"},fp={key:0,class:"loading-state"},mp={key:1,class:"error-state"},vp={class:"error-actions"},gp=re({__name:"TrialDetailsPanelV3",props:{trial:{},isLeader:{type:Boolean},executionState:{},progress:{}},emits:["start-trial","pause-trial","resume-trial","cancel-trial","duplicate-trial","edit-trial","delete-trial","export-data","export-python"],setup(l){const e=l,t=je(),a=q(!1),o=q(null),n=q(!1),u=ts(),c=M(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial?.id);function d(){o.value=null}function f(){t.push("/trials")}function h(){n.value=!0}async function b(){if(e.trial){`${e.trial.id}`;try{u.isActive&&u.currentTrialId===e.trial.id&&u.stopStreaming(),await u.loadHistoricalData(e.trial.id),`${e.trial.id}`,(e.trial.status==="running"||e.trial.status==="paused")&&await u.startStreaming(e.trial.id)}catch(T){A.error("REFRESH: Failed to refresh trial data:",T)}}}return oe(()=>e.trial,(T,E)=>{T&&T.id!==E?.id&&(o.value=null,A.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 switching from ${E?.id} to ${T.id}`))}),me(()=>{const T=e.trial?.id;A.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 MOUNTED for trial ${T}`)}),xe(()=>{const T=e.trial?.id;A.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 ACTIVATED (cache hit) for trial ${T}`)}),Ae(()=>{const T=e.trial?.id;A.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 DEACTIVATED (cached) for trial ${T}`)}),ye(()=>{const T=e.trial?.id;A.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 UNMOUNTED (evicted) for trial ${T}`)}),(T,E)=>{const k=ve;return i(),p("div",pp,[a.value?(i(),p("div",fp,[S(H(Gt),{class:"loading-spinner",spin:""}),E[9]||(E[9]=s("span",null,"Loading trial details...",-1))])):o.value?(i(),p("div",mp,[S(H(Pe),{class:"error-icon"}),E[12]||(E[12]=s("h3",null,"Failed to load trial",-1)),s("p",null,_(o.value),1),s("div",vp,[S(k,{onClick:d},{default:P(()=>E[10]||(E[10]=[D("Retry")])),_:1,__:[10]}),S(k,{type:"link",onClick:f},{default:P(()=>E[11]||(E[11]=[D("Go Back")])),_:1,__:[11]})])])):T.trial?(i(),p(Y,{key:2},[S(Gn,{trial:T.trial,progress:T.progress,"is-executing":c.value},null,8,["trial","progress","is-executing"]),S(Zn,{trial:T.trial,"is-leader":T.isLeader,"execution-state":T.executionState,onStart:E[0]||(E[0]=C=>T.$emit("start-trial")),onPause:E[1]||(E[1]=C=>T.$emit("pause-trial")),onResume:E[2]||(E[2]=C=>T.$emit("resume-trial")),onCancel:E[3]||(E[3]=C=>T.$emit("cancel-trial")),onDuplicate:E[4]||(E[4]=C=>T.$emit("duplicate-trial",T.trial.id)),onEdit:E[5]||(E[5]=C=>T.$emit("edit-trial",T.trial.id)),onDelete:E[6]||(E[6]=C=>T.$emit("delete-trial",T.trial.id)),onExportData:h,onExportPython:E[7]||(E[7]=C=>T.$emit("export-python",T.trial.id)),onRefresh:b},null,8,["trial","is-leader","execution-state"]),T.trial&&n.value?(i(),Q(cp,{key:0,visible:n.value,trial:T.trial,"onUpdate:visible":E[8]||(E[8]=C=>n.value=!1)},null,8,["visible","trial"])):F("",!0),S(hc,{trial:T.trial,progress:T.progress,"is-leader":T.isLeader,"execution-state":T.executionState},null,8,["trial","progress","is-leader","execution-state"])],64)):F("",!0)])}}}),hp=le(gp,[["__scopeId","data-v-081db72e"]]),yp={class:"import-content"},bp={class:"upload-section"},_p={class:"ant-upload-drag-icon"},Tp={key:0,class:"preview-section"},$p={class:"bundle-details"},Cp={class:"detail-row"},kp={class:"value"},wp={class:"detail-row"},Sp={class:"value"},Ip={class:"detail-row"},Ep={class:"value"},Rp={class:"detail-row"},Fp={class:"value"},Pp={key:0,style:{color:"green","margin-left":"8px"}},xp={key:1,style:{color:"orange","margin-left":"8px"}},Ap={key:0,class:"detail-row"},Vp={class:"value"},Op={class:"detail-row"},Dp={class:"value"},Np={class:"import-options"},Lp={key:0,style:{"margin-bottom":"12px"}},Mp={key:1,style:{"margin-bottom":"12px",padding:"8px",background:"#f0f0f0","border-radius":"4px"}},Up={key:0,class:"warnings"},zp={class:"modal-actions"},Bp=re({__name:"ImportTrialDialog",props:{visible:{type:Boolean}},emits:["update:visible","trial-imported"],setup(l,{emit:e}){const t=l,a=e,o=je(),n=q([]),u=q(null),c=q(!1),d=q([]),f=q({mode:"draft",namePrefix:"Imported: "}),h=M({get:()=>t.visible,set:I=>a("update:visible",I)}),b=M(()=>u.value?.execution?.apiCalls&&u.value.execution.apiCalls.length>0);function T(I){return!1}async function E(I){const w=I.file.originFileObj||I.file;if(w)try{const U=await k(w),$=JSON.parse(U);d.value=C($),u.value=$,$.execution?.apiCalls&&$.execution.apiCalls.length>0,f.value.mode="draft"}catch{ne.error("Failed to read bundle file: Invalid JSON format"),u.value=null}}function k(I){return new Promise((w,U)=>{const $=new FileReader;$.onload=m=>w(m.target?.result),$.onerror=U,$.readAsText(I)})}function C(I){const w=[];return I.version||w.push("Bundle version is missing"),I.configuration?.trial||w.push("Trial configuration is missing"),(!I.configuration?.variableLists||I.configuration.variableLists.length===0)&&w.push("No variable lists found in bundle"),I.version!=="1.0"&&w.push(`Bundle version ${I.version} may not be fully compatible`),w}function z(I){return new Date(I).toLocaleString()}function N(){n.value=[],u.value=null,d.value=[],h.value=!1}async function O(){if(!u.value){ne.error("No bundle to import");return}c.value=!0;try{const{trialBundleImportService:I}=await Re(async()=>{const{trialBundleImportService:$}=await import("./trial-bundle.service-RXJifw-s.js");return{trialBundleImportService:$}},__vite__mapDeps([0,1,2,3,4,5,6])),w=b.value&&f.value.mode==="completed",U=await I.importTrialBundle(JSON.stringify(u.value),{importResults:w,importAsCompleted:w,namePrefix:f.value.namePrefix||void 0});U.ok?(ne.success("Trial imported successfully!"),o.push(`/trials?trialId=${U.value.trialId}`),a("trial-imported",U.value.trialId),N()):ne.error(`Import failed: ${U.error.message}`)}catch(I){ne.error(`Import failed: ${I instanceof Error?I.message:"Unknown error"}`)}finally{c.value=!1}}return(I,w)=>{const U=la,$=bt,m=yt,L=Kt,R=qe,r=ve,j=Ce;return i(),Q(j,{visible:h.value,"onUpdate:visible":w[3]||(w[3]=K=>h.value=K),title:"Import Trial Bundle",width:600,footer:null,"destroy-on-close":!0,class:"import-trial-modal"},{default:P(()=>[s("div",yp,[s("div",bp,[S(U,{fileList:n.value,"onUpdate:fileList":w[0]||(w[0]=K=>n.value=K),"before-upload":T,"max-count":1,accept:".json",onChange:E},{default:P(()=>[s("p",_p,[S(H(qt))]),w[4]||(w[4]=s("p",{class:"ant-upload-text"},"Click or drag trial bundle file here",-1)),w[5]||(w[5]=s("p",{class:"ant-upload-hint"}," Supports .json files exported from trials ",-1))]),_:1,__:[4,5]},8,["fileList"])]),u.value?(i(),p("div",Tp,[w[17]||(w[17]=s("h3",null,"Bundle Contents",-1)),s("div",$p,[s("div",Cp,[w[6]||(w[6]=s("span",{class:"label"},"Trial Name:",-1)),s("span",kp,_(u.value.metadata.trialName),1)]),s("div",wp,[w[7]||(w[7]=s("span",{class:"label"},"Export Date:",-1)),s("span",Sp,_(z(u.value.metadata.exportDate)),1)]),s("div",Ip,[w[8]||(w[8]=s("span",{class:"label"},"Status:",-1)),s("span",Ep,_(u.value.metadata.trialStatus),1)]),s("div",Rp,[w[9]||(w[9]=s("span",{class:"label"},"API Calls:",-1)),s("span",Fp,[D(_(u.value.metadata.apiCallCount)+" ",1),b.value?(i(),p("span",Pp," (with results) ")):(i(),p("span",xp," (configuration only) "))])]),u.value.configuration.template?(i(),p("div",Ap,[w[10]||(w[10]=s("span",{class:"label"},"Template:",-1)),s("span",Vp,_(u.value.configuration.template.name),1)])):F("",!0),s("div",Op,[w[11]||(w[11]=s("span",{class:"label"},"Variable Lists:",-1)),s("span",Dp,_(u.value.configuration.variableLists?.length||0),1)])]),s("div",Np,[w[16]||(w[16]=s("h4",null,"Import Options",-1)),b.value?(i(),p("div",Lp,[S(m,{value:f.value.mode,"onUpdate:value":w[1]||(w[1]=K=>f.value.mode=K),style:{display:"block"}},{default:P(()=>[S($,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:P(()=>w[12]||(w[12]=[s("strong",null,"Import as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Create fresh trial ready to run new experiment ",-1)])),_:1,__:[12]}),S($,{value:"completed",style:{display:"block"}},{default:P(()=>w[13]||(w[13]=[s("strong",null,"Import as Completed",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Preserve historical results for review/analysis ",-1)])),_:1,__:[13]})]),_:1},8,["value"])])):(i(),p("div",Mp,w[14]||(w[14]=[s("strong",null,"Draft Trial",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px"}}," This bundle contains configuration only - will import as draft ready to run ",-1)]))),S(L,{value:f.value.namePrefix,"onUpdate:value":w[2]||(w[2]=K=>f.value.namePrefix=K),placeholder:"Name prefix (optional)",style:{"margin-top":"8px"}},{prefix:P(()=>w[15]||(w[15]=[D("Name:")])),_:1},8,["value"])]),d.value.length>0?(i(),p("div",Up,[S(R,{message:"Import Warnings",type:"warning","show-icon":""},{description:P(()=>[s("ul",null,[(i(!0),p(Y,null,ee(d.value,K=>(i(),p("li",{key:K},_(K),1))),128))])]),_:1})])):F("",!0)])):F("",!0),s("div",zp,[S(r,{onClick:N},{default:P(()=>w[18]||(w[18]=[D("Cancel")])),_:1,__:[18]}),S(r,{type:"primary",onClick:O,loading:c.value,disabled:!u.value},{default:P(()=>[S(H(Ht)),w[19]||(w[19]=D(" Import Trial "))]),_:1,__:[19]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),Wp=le(Bp,[["__scopeId","data-v-1d9366d6"]]),jp={class:"option-content"},Hp={class:"option-header"},qp={class:"modal-footer"},Gp=re({__name:"PythonExportModal",props:{visible:{type:Boolean},trialId:{}},emits:["update:visible"],setup(l,{emit:e}){const t=l,a=e,o=M({get:()=>t.visible,set:d=>a("update:visible",d)}),n=q("script-config-data"),u=q(!1);oe(o,d=>{d&&(n.value="script-config-data",u.value=!1)});async function c(){if(n.value){u.value=!0;try{const{reproducibilityBundleService:d}=await Re(async()=>{const{reproducibilityBundleService:h}=await import("./index-Bq-8JkxP.js");return{reproducibilityBundleService:h}},__vite__mapDeps([7,1,2,3,4,5,0,6,8,9,10,11,12,13,14,15,16,17,18])),f=await d.exportBundle(t.trialId,{bundleType:n.value,includeComments:!0});if(f.ok){const{tauriDownloadUtilities:h}=await Re(async()=>{const{tauriDownloadUtilities:b}=await Promise.resolve().then(()=>xc);return{tauriDownloadUtilities:b}},void 0);if(n.value==="script-only"){const b=await f.value.zipBlob.text();await h.downloadFile(b,"python",f.value.filename.replace(".zip",""),!1),ne.success("Python script downloaded successfully")}else{const b=await f.value.zipBlob.arrayBuffer(),T=new Uint8Array(b);await h.downloadFile(T,"zip",f.value.filename.replace(".zip",""),!1);const E=n.value==="script-config-data"?"Complete archive bundle":"Reproducibility bundle";ne.success(`${E} downloaded successfully`)}o.value=!1}else throw new Error(f.error?.message||"Export failed")}catch(d){A.error("Export failed:",d),ne.error(`Failed to export: ${d instanceof Error?d.message:"Unknown error"}`)}finally{u.value=!1}}}return(d,f)=>{const h=bt,b=He,T=yt,E=ve,k=Ce;return i(),Q(k,{visible:o.value,"onUpdate:visible":f[1]||(f[1]=C=>o.value=C),title:"Export for Reproducibility",width:600,footer:null,"destroy-on-close":!0},{default:P(()=>[f[10]||(f[10]=s("p",{class:"export-description"}," Choose your export format: ",-1)),S(T,{value:n.value,"onUpdate:value":f[0]||(f[0]=C=>n.value=C),class:"export-options"},{default:P(()=>[S(h,{value:"script-only",class:"export-option"},{default:P(()=>f[2]||(f[2]=[s("div",{class:"option-content"},[s("div",{class:"option-header"},[s("span",{class:"option-icon"},"📄"),s("strong",{class:"option-title"},"Python Script Only")]),s("div",{class:"option-description"}," Minimal Python script (~200-400 lines) with clear experimental design. "),s("div",{class:"option-files"},"• experiment.py")],-1)])),_:1,__:[2]}),S(h,{value:"script-config",class:"export-option"},{default:P(()=>f[3]||(f[3]=[s("div",{class:"option-content"},[s("div",{class:"option-header"},[s("span",{class:"option-icon"},"📦"),s("strong",{class:"option-title"},"Reproducibility Bundle")]),s("div",{class:"option-description"}," Python script + complete trial configuration. "),s("div",{class:"option-files"}," • experiment.py • trial_config.json • README.md ")],-1)])),_:1,__:[3]}),S(h,{value:"script-config-data",class:"export-option recommended"},{default:P(()=>[s("div",jp,[s("div",Hp,[f[5]||(f[5]=s("span",{class:"option-icon"},"🗂️",-1)),f[6]||(f[6]=s("strong",{class:"option-title"},"Complete Archive Bundle",-1)),S(b,{color:"green",style:{"margin-left":"8px"}},{default:P(()=>f[4]||(f[4]=[D("Recommended")])),_:1,__:[4]})]),f[7]||(f[7]=s("div",{class:"option-description"}," Everything: Python script + configuration + all experimental results. ",-1)),f[8]||(f[8]=s("div",{class:"option-files"}," • experiment.py • trial_config.json • data/results.{csv,xlsx,jsonl} • README.md ",-1))])]),_:1})]),_:1},8,["value"]),s("div",qp,[S(E,{type:"primary",size:"large",disabled:!n.value,loading:u.value,onClick:c},{default:P(()=>[S(H(Zt)),f[9]||(f[9]=D(" Download "))]),_:1,__:[9]},8,["disabled","loading"])])]),_:1,__:[10]},8,["visible"])}}}),Jp=le(Gp,[["__scopeId","data-v-6cec199d"]]),Xp={class:"trials-view-v3"},Kp={key:0,class:"provider-warning-banner"},Qp={class:"banner-content"},Yp={key:1,class:"observer-mode-banner"},Zp={class:"banner-content"},ef={key:1,class:"loading-left-pane"},tf={key:0,class:"no-selection"},sf={key:0,class:"observer-note"},af=re({__name:"TrialsViewV3",setup(l){const e=va(),{trials:t}=da(),{enabledModels:a}=ga(),{duplicateTrial:o,deleteTrial:n}=ca(),u=ts(),c=Bt(),d=je(),f=q(),h=q(!0),b=q(null),T=q(""),E=q("all"),k=q(-1),C=q(!1),z=q(!1),N=q(!1),O=M(()=>a.value.length>0),I=M(()=>!O.value&&!N.value),w=e.isLeader,U=e.execution,{trial:$}=pa(b),m=M(()=>{const B=$.value?.progress;return B?{trialId:b.value||"",...B,lastUpdated:new Date}:null}),L=M(()=>{let B=t.value;if(T.value){const J=T.value.toLowerCase();B=B.filter(se=>{const Te=se.name.toLowerCase().includes(J),be=se.templateConfig?.template?.toLowerCase().includes(J),pe=se.configurations.some(ke=>ke.modelId.toLowerCase().includes(J)||ke.provider.toLowerCase().includes(J));return Te||be||pe})}return E.value!=="all"&&(B=B.filter(J=>J.status===E.value)),B});async function R(){const B=c.query;if(B.duplicate){const J=B.duplicate,se=await o(J);se.ok?await d.push({path:"/trials/create",query:{duplicate:se.value,edit:B.edit==="true"?"true":void 0}}):fe.error(`Failed to duplicate trial: ${se.error?.message||"Unknown error"}`),await d.replace({query:{}});return}if(B.designId||B.promptSource){await d.push({path:"/trials/create",query:B});return}if(c.query.trialId){const J=c.query.trialId;j(J)}}function r(){if(b.value||t.value.length===0)return;const B=t.value.find(J=>J.status==="running");if(B){j(B.id);return}j(t.value[0].id)}async function j(B){const J=performance.now();A.info(`V4_TRIAL_SWITCH: Starting trial selection: ${B}`),b.value=B;const se=performance.now();if(A.info(`V4_TRIAL_SWITCH: UI updated in ${(se-J).toFixed(1)}ms`),t.value.length>0){const pe=L.value.findIndex(ke=>ke.id===B);pe>=0&&(k.value=pe)}const Te=performance.now();if(A.info(`V4_TRIAL_SWITCH: Starting stream manager for trial ${B} at ${(Te-J).toFixed(1)}ms`),u.startStreaming(B).catch(pe=>{A.error(`V4_TRIAL_SWITCH: Failed to start streaming for trial ${B}`,pe)}),c.query.trialId!==B){const pe={...c.query};pe.trialId=B,pe.tab||(pe.tab="status"),d.push({path:"/trials",query:pe}),A.info(`V4_TRIAL_SWITCH: URL updated to preserve tab '${pe.tab}' at ${(performance.now()-J).toFixed(1)}ms`)}f.value&&f.value.closeMobileOverlay();const be=performance.now();A.info(`V4_TRIAL_SWITCH: selectTrial() completed in ${(be-J).toFixed(1)}ms`)}function K(B){T.value=B,k.value=-1}function V(B){E.value=B,k.value=-1}async function G(){fe.info("Refreshing trial list...")}function v(B){const J=L.value;if(J.length!==0){if((B.metaKey||B.ctrlKey)&&B.key==="k"){B.preventDefault(),window.dispatchEvent(new CustomEvent("focus-trial-search"));return}(B.key==="j"||B.key==="ArrowDown")&&(B.preventDefault(),k.value=Math.min(k.value+1,J.length-1),k.value>=0&&(j(J[k.value].id),y(J[k.value].id))),(B.key==="k"||B.key==="ArrowUp")&&(B.preventDefault(),k.value=Math.max(k.value-1,0),j(J[k.value].id),y(J[k.value].id)),B.key==="Enter"&&b.value,B.key==="Escape"&&(T.value="",b.value=null,k.value=-1)}}function y(B){we(()=>{const J=document.querySelector(`[data-trial-id="${B}"]`);J&&J.scrollIntoView({behavior:"smooth",block:"nearest"})})}function g(B){A.debug("Trial list panel resized",{width:B})}function x(B){A.debug("Mobile overlay changed",{visible:B})}function W(){N.value=!0}async function X(){await d.push("/trials/create")}function Z(){z.value=!0}function ae(B){G(),j(B)}async function ce(){if(b.value&&!C.value){C.value=!0,e.execution?.value,e.execution?.value?.status;try{b.value;const B=await e.startTrialWithStreaming(b.value);if(!B.ok){fe.error(B.error?.message||"Unknown error");return}await u.startStreaming(b.value);const J={...c.query};J.tab="tasks",d.replace({query:J})}finally{C.value=!1}}}async function ge(){`${b.value}`,`${b.value}`,`${e.execution.value.status}`,`${e.isLeader.value}`;const B=await e.pauseExecution();B?.ok,B.ok?`${e.execution.value.status}`:(B.error.message,fe.error(B.error?.message||"Unknown error"))}async function Qe(){if(!b.value)return;`${b.value}`,`${b.value}`,`${e.execution.value.status}`,`${e.isLeader.value}`;const B=e.execution.value?.status||"idle",J=e.execution.value?.currentTrialId;if(B==="paused"&&J===b.value){`${b.value}`;const se=await e.resumeExecution(b.value);se.ok||(se.error.message,fe.error(se.error.message))}else{const se=await e.startTrialWithStreaming(b.value);se.ok?await u.startStreaming(b.value):(se.error.message,fe.error(se.error?.message||"Unknown error"))}}async function De(){const B=await e.cancelExecution();B.ok||fe.error(B.error?.message||"Unknown error")}async function us(B){const J=await o(B);J.ok?(fe.success("Trial duplicated"),J.value&&j(J.value)):fe.error(J.error?.message||"Unknown error")}async function ds(B){await d.push({path:"/trials/create",query:{duplicate:B,edit:"true"}})}async function cs(B){const J=await n(B);J.ok?(fe.success("Trial deleted"),b.value===B&&(b.value=null)):fe.error(J.error?.message||"Unknown error")}async function ps(B,J){const se=await ct.exportTrialData(B,{format:J,fields:void 0,includeHeaders:!0,addBOM:J==="excel"||J==="csv"});se.ok?(await We.downloadFile(se.value.data,J,se.value.metadata.trialName,J==="excel"||J==="csv"),fe.success(`Exported ${se.value.recordCount} API calls to ${se.value.filename}`)):fe.error(se.error?.message||"Unknown error")}const Ye=q(!1),_t=q("");function fs(B){_t.value=B,Ye.value=!0}return oe(()=>c.query.trialId,B=>{B&&B!==b.value&&j(B)}),oe(h,(B,J)=>{const se=performance.now();A.info(`V4_TRIAL_SWITCH: isLoadingInitial changed from ${J} to ${B} at ${se}`),B||A.info("V4_TRIAL_SWITCH: Both panes should now be VISIBLE (no longer loading initial)")},{immediate:!0}),oe(t,(B,J)=>{const se=performance.now();A.info(`V4_TRIAL_SWITCH: trials array changed from ${J?.length||0} to ${B.length} trials at ${se}`)},{immediate:!0}),me(async()=>{const B=performance.now();A.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() ENTRY at ${B}`);const J=performance.now();A.info(`V4_TRIAL_SWITCH: Starting V4 execution system initialization at ${(J-B).toFixed(1)}ms`);try{await e.initialize();const Ze=performance.now();A.info(`V4_TRIAL_SWITCH: V4 execution system initialized in ${(Ze-J).toFixed(1)}ms`)}catch(Ze){const hs=performance.now();A.error(`V4_TRIAL_SWITCH: V4 initialization failed in ${(hs-J).toFixed(1)}ms:`,Ze)}const se=performance.now();window.addEventListener("keydown",v),A.info(`V4_TRIAL_SWITCH: Keyboard listener added in ${(se-B).toFixed(1)}ms`);const Te=performance.now();A.info(`V4_TRIAL_SWITCH: Starting nextTick wait at ${(Te-B).toFixed(1)}ms`),await we();const be=performance.now();A.info(`V4_TRIAL_SWITCH: nextTick completed in ${(be-Te).toFixed(1)}ms`);const pe=performance.now();h.value=!1,A.info(`V4_TRIAL_SWITCH: isLoadingInitial set to false at ${(pe-B).toFixed(1)}ms`);const ke=performance.now();A.info(`V4_TRIAL_SWITCH: Starting URL parameter processing at ${(ke-B).toFixed(1)}ms`),await R();const ms=performance.now();A.info(`V4_TRIAL_SWITCH: URL parameter processing completed in ${(ms-ke).toFixed(1)}ms`);const Tt=performance.now();A.info(`V4_TRIAL_SWITCH: Starting auto-selection at ${(Tt-B).toFixed(1)}ms`),r();const vs=performance.now();A.info(`V4_TRIAL_SWITCH: Auto-selection completed in ${(vs-Tt).toFixed(1)}ms`);const gs=performance.now();A.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() TOTAL: ${(gs-B).toFixed(1)}ms`)}),ye(()=>{window.removeEventListener("keydown",v),u.destroy()}),(B,J)=>{const se=Nt("router-link"),Te=ve;return i(),p("div",Xp,[I.value?(i(),p("div",Kp,[s("div",Qp,[S(H(Pe),{class:"warning-icon"}),J[3]||(J[3]=s("span",null,"No LLM providers configured. Please add API keys in Settings to run trials.",-1)),S(se,{to:"/settings",class:"settings-link"},{default:P(()=>J[2]||(J[2]=[D("Go to Settings")])),_:1,__:[2]}),S(H(jt),{class:"close-icon",onClick:W})]),J[4]||(J[4]=s("div",{class:"banner-note"},"Note: Ollama doesn't require API keys",-1))])):F("",!0),H(w)?F("",!0):(i(),p("div",Yp,[s("div",Zp,[S(H(Xt),{class:"observer-icon"}),J[5]||(J[5]=s("span",null,[s("strong",null,"Observer Mode: Multiple Tabs Detected")],-1)),J[6]||(J[6]=s("div",{class:"leader-hint"}," You can only open one Auditomatic tab at a time. Close other tabs, or refresh if this is your only tab. Your templates and trials are safely saved. ",-1))])])),S(ba,{ref_key:"splitPanel",ref:f,"storage-key":"trial-list-width","default-width":250,"min-width":200,"max-width":600,onResize:g,onMobileOverlayChange:x},{left:P(()=>[h.value?(i(),p("div",ef," Loading trials... ")):(i(),Q(Pn,{key:0,trials:H(t),"selected-trial-id":b.value,"search-query":T.value,"filter-status":E.value,onSelectTrial:j,onCreateTrial:X,onImportTrial:Z,onUpdateSearch:K,onUpdateFilter:V,onRefresh:G},null,8,["trials","selected-trial-id","search-query","filter-status"]))]),right:P(()=>[(i(),Q(nt,{max:5},[b.value?(i(),Q(hp,{key:b.value,trial:H($),"is-leader":H(w),"execution-state":H(U),progress:m.value,onStartTrial:ce,onPauseTrial:ge,onResumeTrial:Qe,onCancelTrial:De,onDuplicateTrial:us,onEditTrial:ds,onDeleteTrial:cs,onExportData:ps,onExportPython:fs},null,8,["trial","is-leader","execution-state","progress"])):F("",!0)],1024)),!b.value||!H($)?Ee((i(),p("div",tf,[S(H(Yt),{class:"empty-icon"}),J[8]||(J[8]=s("h3",null,"Select a trial to view details",-1)),J[9]||(J[9]=s("p",null,"Choose from the list or create a new one",-1)),S(Te,{type:"primary",size:"large",disabled:!H(w),onClick:X},{default:P(()=>J[7]||(J[7]=[D(" Create New Trial ")])),_:1,__:[7]},8,["disabled"]),H(w)?F("",!0):(i(),p("div",sf," Close other tabs to enable trial creation "))],512)),[[Ut,!h.value]]):F("",!0)]),_:1},512),S(Wp,{visible:z.value,"onUpdate:visible":J[0]||(J[0]=be=>z.value=be),onTrialImported:ae},null,8,["visible"]),S(Jp,{visible:Ye.value,"onUpdate:visible":J[1]||(J[1]=be=>Ye.value=be),"trial-id":_t.value},null,8,["visible","trial-id"])])}}}),nf=le(af,[["__scopeId","data-v-84d2df98"]]),Tf=Object.freeze(Object.defineProperty({__proto__:null,default:nf},Symbol.toStringTag,{value:"Module"}));export{de as E,Tf as T,ct as d,Ot as g,Le as t};
