import{g as E,a as y,e as F}from"./index-Bva3c6Vs.js";const b=10;function O(){const M=E(),f=F();function w(t,e,o){if(!t)return{totalTokens:0,combinationCount:1,perCallAverage:0};let n=t;const i=/\{\{?\s*(\w+)\s*\}?\}/g,a=new Set;n=n.replace(i,(c,s)=>(a.add(s),""));const u=f.estimateTokens(n),p=new Map,_=c=>(p.has(c)||p.set(c,f.estimateTokens(c)),p.get(c));let m=1;const T=new Map;for(const[c,s]of Object.entries(e)){if(!a.has(c))continue;let l=[];if(s.type==="value"&&s.values)l=s.values;else if(s.type==="list"&&s.listId&&o){const d=o.find(x=>x.id===s.listId);d&&(d.category==="simple"?l=d.values||[]:d.category==="attributed"&&(l=d.items?.map(x=>x.value)||[]))}if(l.length>0){m*=l.length;const d=l.reduce((x,L)=>x+_(L),0);T.set(c,{tokenSum:d,valueCount:l.length})}}let $=0;for(const[,c]of T){const s=m/c.valueCount;$+=c.tokenSum*s}const v=u*m+$;return{totalTokens:Math.ceil(v),combinationCount:m,perCallAverage:m>0?Math.ceil(v/m):0}}function S(t){return t?f.estimateTokens(t):0}function g(t,e,o){const n=M.getOutputTokenLimit(t,e,o);if(!n)return y.warn("No output token limit found for model",{provider:t,modelId:e}),{min:-1,max:-1,expected:-1};const i=["max_tokens","max_completion_tokens","max_output_tokens","num_predict","maxTokens"];let a=0;for(const u of i)if(o[u]!==void 0){a=o[u];break}return a||(a=n),{min:b,max:n,expected:Math.min(a,n)}}function I(t,e,o,n={}){const i=e>0?t/e:0,a=C(i,o,n);return h(a,e)}function C(t,e,o={}){if(!e)return k();const n=g(e.provider,e.modelId,o);if(n.expected===-1)return{tokens:{input:t,output:{min:-1,max:-1,expected:-1}},cost:{input:0,output:{min:-1,max:-1,expected:-1},total:{min:-1,max:-1,expected:-1}},meta:{hasValidCost:!1,isLocalModel:e.provider.includes("ollama")||e.provider==="deterministic",confidence:"low",provider:e.provider,modelId:e.modelId}};const i=e.capabilities?.inputCostPerToken||0,a=e.capabilities?.outputCostPerToken||0,u=t*i;let p="low";return i>0&&a>0&&(n.expected>0?p="high":p="medium"),{tokens:{input:t,output:n},cost:{input:u,output:{min:n.min*a,max:n.max*a,expected:n.expected*a},total:{min:u+n.min*a,max:u+n.max*a,expected:u+n.expected*a}},meta:{hasValidCost:i>0||a>0,isLocalModel:e.provider.includes("ollama")||e.provider==="deterministic",confidence:p,provider:e.provider,modelId:e.modelId}}}function P(t,e="range"){if(t.cost.total.expected===-1)return"Unable to estimate";if(t.meta.isLocalModel)return"Free (local)";if(!t.meta.hasValidCost)return"No pricing data";if(t.cost.total.max===0)return"Free";switch(e){case"compact":return r(t.cost.total.expected);case"range":const o=r(t.cost.total.min),n=r(t.cost.total.max),i=r(t.cost.total.expected);return Math.abs(t.cost.total.max-t.cost.total.min)<1e-4?i:`~${i} (${o}-${n})`;case"detailed":const a=`${t.tokens.input} input`,u=`${t.tokens.output.min}-${t.tokens.output.max} output`,p=`${r(t.cost.total.min)}-${r(t.cost.total.max)}`;return`${a} + ${u} tokens: ${p}`;case"tokens":return`${t.tokens.input} + ${t.tokens.output.min}-${t.tokens.output.max} tokens`}}function r(t){if(t===0)return"$0.00";if(t<.01){let e=2,o=t;for(;o<.1;)o*=10,e++;return`$${t.toFixed(e)}`}return t<1?`$${t.toFixed(3)}`:t<10?`$${t.toFixed(2)}`:t<100?`$${t.toFixed(1)}`:`$${Math.round(t).toLocaleString()}`}function V(t){return t.length===0?k():t.reduce((e,o)=>({tokens:{input:e.tokens.input+o.tokens.input,output:{min:e.tokens.output.min+o.tokens.output.min,max:e.tokens.output.max+o.tokens.output.max,expected:e.tokens.output.expected+o.tokens.output.expected}},cost:{input:e.cost.input+o.cost.input,output:{min:e.cost.output.min+o.cost.output.min,max:e.cost.output.max+o.cost.output.max,expected:e.cost.output.expected+o.cost.output.expected},total:{min:e.cost.total.min+o.cost.total.min,max:e.cost.total.max+o.cost.total.max,expected:e.cost.total.expected+o.cost.total.expected}},meta:{hasValidCost:o.meta.hasValidCost||e.meta.hasValidCost,isLocalModel:o.meta.isLocalModel&&e.meta.isLocalModel,confidence:o.meta.confidence==="low"?"low":e.meta.confidence,provider:"multiple",modelId:"multiple"}}),k())}function h(t,e){return{tokens:{input:t.tokens.input*e,output:{min:t.tokens.output.min*e,max:t.tokens.output.max*e,expected:t.tokens.output.expected*e}},cost:{input:t.cost.input*e,output:{min:t.cost.output.min*e,max:t.cost.output.max*e,expected:t.cost.output.expected*e},total:{min:t.cost.total.min*e,max:t.cost.total.max*e,expected:t.cost.total.expected*e}},meta:t.meta}}function k(){return{tokens:{input:0,output:{min:0,max:0,expected:0}},cost:{input:0,output:{min:0,max:0,expected:0},total:{min:0,max:0,expected:0}},meta:{hasValidCost:!1,isLocalModel:!1,confidence:"low",provider:"",modelId:""}}}return{calculateTemplateTokens:w,calculatePromptTokens:S,getOutputTokenRange:g,estimateCost:C,estimateTotalCost:I,formatCost:P,formatSingleCost:r,sumEstimates:V,multiplyEstimate:h,createEmptyEstimate:k,MIN_OUTPUT_TOKENS:b}}export{O as u};
