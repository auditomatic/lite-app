const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/trial-bundle.service-Bc9YrTG8.js","assets/index-CGnIGpg5.js","assets/vue-vendor-DPw1dQYc.js","assets/ui-vendor-IRGmExUJ.js","assets/utils-vendor-B76-F3_P.js","assets/index-DaHEOU6Y.css","assets/data-vendor-BIyl9aCN.js","assets/index-7lsd8V0A.js","assets/toast-CdlfWUDp.js","assets/useCostEstimation-ZltCLeBX.js","assets/ParserSelector-BdZuaHD5.js","assets/parser.store-CaNNd-Sj.js","assets/ParserSelector-DMLEdzpb.css","assets/trial-stream-manager-v4-BBgWEDtq.js","assets/execution-control-v4-Co6uUe4x.js","assets/useV4TrialCommands-B3rfkugh.js","assets/useHeatmapStylingV3-CCIdVOn4.js","assets/useV4Models-DnrxToiB.js","assets/useV4LiveQuery-Do0jdBW3.js"])))=>i.map(i=>d[i]);
var ks=Object.defineProperty;var ws=(l,e,t)=>e in l?ks(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var Ue=(l,e,t)=>ws(l,typeof e!="symbol"?e+"":e,t);import{d as de,f as H,c as M,o as Ie,b as Ve,w as ue,R as f,a0 as ae,S as s,_ as E,a9 as ze,a3 as fe,Y as r,y as Me,aa as Ss,ab as Is,ac as Es,$ as ee,ad as Fs,ae as Rs,af as Qt,q as es,n as Be,k,Z as R,F as te,W as ne,a5 as Vt,ag as xs,ah as Ps,u as j,a4 as ht,V as h,G as O,M as Ge,ai as Je,U as ts,B as Pe,A as ss,aj as As,r as Vs,a7 as Os,a1 as as,X as it,a6 as yt}from"./vue-vendor-DPw1dQYc.js";import{t as we}from"./toast-CdlfWUDp.js";import{j as ce,a as x,u as Ds,b as Ot,E as et,F as Ls,C as Ns,_ as We,d as je,G as Ms,e as Dt,H as Us}from"./index-CGnIGpg5.js";import{aH as ns,z as os,aS as zs,n as Ee,P as Bs,aT as ls,aU as Ws,s as Et,az as js,M as Ft,t as Rt,v as Hs,a1 as is,I as Lt,aV as qs,aa as Gs,av as Js,aM as rs,V as Xs,aI as Ks,X as Zs,C as xt,r as Ys,w as Qs,x as Le,ax as us,aN as He,T as rt,J as ut,D as ea,N as re,aJ as ta,am as ds,a5 as sa,a6 as aa,a4 as cs,aW as na,ai as ps,E as fs,ak as oa,al as la,G as ia,o as ra,aA as ua,aX as Nt,R as da,Y as ca,au as Pt,aw as pa,aY as At,m as ms,a0 as fa}from"./ui-vendor-IRGmExUJ.js";import{b as vs}from"./utils-vendor-B76-F3_P.js";import{u as dt}from"./useCostEstimation-ZltCLeBX.js";import{P as ma}from"./ParserSelector-BdZuaHD5.js";import{u as ct,a as gs}from"./trial-stream-manager-v4-BBgWEDtq.js";import{u as va}from"./parser.store-CaNNd-Sj.js";import{v as Mt,u as ga,a as ha,b as ya}from"./useV4TrialCommands-B3rfkugh.js";import{u as ba}from"./useHeatmapStylingV3-CCIdVOn4.js";import{u as mt,w as _a}from"./data-vendor-BIyl9aCN.js";import{u as Ta}from"./execution-control-v4-Co6uUe4x.js";import{u as Ca}from"./useV4Models-DnrxToiB.js";const $a={class:"right-panel"},ka=de({__name:"ResizablePanelContainer",props:{storageKey:{default:"trial-list-width"},defaultWidth:{default:250},minWidth:{default:200},maxWidth:{default:600},mobileBreakpoint:{default:768}},emits:["resize","mobile-overlay-change"],setup(l,{expose:e,emit:t}){const a=l,o=t,n=H(a.defaultWidth),u=H(!1),c=H(0),p=H(0),d=H(window.innerWidth),v=H(!1),y=M(()=>d.value<a.mobileBreakpoint),g=M(()=>y.value?{width:`${Math.min(d.value*.85,400)}px`}:{width:`${n.value}px`});function T(){const C=localStorage.getItem(a.storageKey);if(C){const m=parseInt(C,10);!isNaN(m)&&m>=a.minWidth&&m<=a.maxWidth&&(n.value=m)}}function b(C){localStorage.setItem(a.storageKey,C.toString()),o("resize",C)}function _(C){u.value=!0,c.value=C.clientX,p.value=n.value,document.addEventListener("mousemove",U),document.addEventListener("mouseup",L),document.body.style.userSelect="none",document.body.style.cursor="col-resize"}function U(C){if(!u.value)return;const m=C.clientX-c.value,N=Math.max(a.minWidth,Math.min(a.maxWidth,p.value+m));n.value=N}function L(){u.value&&(u.value=!1,b(n.value),document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",L),document.body.style.userSelect="",document.body.style.cursor="")}function V(){n.value=a.defaultWidth,b(a.defaultWidth)}function w(){d.value=window.innerWidth,!y.value&&v.value&&(v.value=!1,o("mobile-overlay-change",!1))}function $(){y.value&&(v.value=!v.value,o("mobile-overlay-change",v.value))}function D(){v.value=!1,o("mobile-overlay-change",!1)}return e({toggleMobileOverlay:$,closeMobileOverlay:D}),Ie(()=>{T(),window.addEventListener("resize",w)}),Ve(()=>{window.removeEventListener("resize",w),L()}),ue(()=>a.defaultWidth,C=>{n.value===a.defaultWidth&&(n.value=C)}),(C,m)=>(r(),f("div",{class:ae(["resizable-panel-container",{"mobile-overlay":y.value}])},[s("div",{class:ae(["left-panel",{"overlay-visible":y.value&&v.value}]),style:fe(g.value)},[ze(C.$slots,"left",{},void 0,!0)],6),y.value?E("",!0):(r(),f("div",{key:0,class:ae(["resize-handle",{dragging:u.value}]),onMousedown:_,onDblclick:V},m[0]||(m[0]=[s("div",{class:"handle-bar"},null,-1)]),34)),s("div",$a,[ze(C.$slots,"right",{},void 0,!0)]),y.value&&v.value?(r(),f("div",{key:1,class:"mobile-overlay-bg",onClick:D})):E("",!0)],2))}}),wa=ce(ka,[["__scopeId","data-v-949e1df1"]]);function Sa(){var l=window.navigator.userAgent,e=l.indexOf("MSIE ");if(e>0)return parseInt(l.substring(e+5,l.indexOf(".",e)),10);var t=l.indexOf("Trident/");if(t>0){var a=l.indexOf("rv:");return parseInt(l.substring(a+3,l.indexOf(".",a)),10)}var o=l.indexOf("Edge/");return o>0?parseInt(l.substring(o+5,l.indexOf(".",o)),10):-1}let st;function bt(){bt.init||(bt.init=!0,st=Sa()!==-1)}var pt={name:"ResizeObserver",props:{emitOnMount:{type:Boolean,default:!1},ignoreWidth:{type:Boolean,default:!1},ignoreHeight:{type:Boolean,default:!1}},emits:["notify"],mounted(){bt(),Me(()=>{this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitOnMount&&this.emitSize()});const l=document.createElement("object");this._resizeObject=l,l.setAttribute("aria-hidden","true"),l.setAttribute("tabindex",-1),l.onload=this.addResizeHandlers,l.type="text/html",st&&this.$el.appendChild(l),l.data="about:blank",st||this.$el.appendChild(l)},beforeUnmount(){this.removeResizeHandlers()},methods:{compareAndNotify(){(!this.ignoreWidth&&this._w!==this.$el.offsetWidth||!this.ignoreHeight&&this._h!==this.$el.offsetHeight)&&(this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitSize())},emitSize(){this.$emit("notify",{width:this._w,height:this._h})},addResizeHandlers(){this._resizeObject.contentDocument.defaultView.addEventListener("resize",this.compareAndNotify),this.compareAndNotify()},removeResizeHandlers(){this._resizeObject&&this._resizeObject.onload&&(!st&&this._resizeObject.contentDocument&&this._resizeObject.contentDocument.defaultView.removeEventListener("resize",this.compareAndNotify),this.$el.removeChild(this._resizeObject),this._resizeObject.onload=null,this._resizeObject=null)}}};const Ia=Es();Ss("data-v-b329ee4c");const Ea={class:"resize-observer",tabindex:"-1"};Is();const Fa=Ia((l,e,t,a,o,n)=>(r(),ee("div",Ea)));pt.render=Fa;pt.__scopeId="data-v-b329ee4c";pt.__file="src/components/ResizeObserver.vue";function at(l){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?at=function(e){return typeof e}:at=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},at(l)}function Ra(l,e){if(!(l instanceof e))throw new TypeError("Cannot call a class as a function")}function xa(l,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(l,a.key,a)}}function Pa(l,e,t){return e&&xa(l.prototype,e),l}function Ut(l){return Aa(l)||Va(l)||Oa(l)||Da()}function Aa(l){if(Array.isArray(l))return _t(l)}function Va(l){if(typeof Symbol<"u"&&Symbol.iterator in Object(l))return Array.from(l)}function Oa(l,e){if(l){if(typeof l=="string")return _t(l,e);var t=Object.prototype.toString.call(l).slice(8,-1);if(t==="Object"&&l.constructor&&(t=l.constructor.name),t==="Map"||t==="Set")return Array.from(l);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _t(l,e)}}function _t(l,e){(e==null||e>l.length)&&(e=l.length);for(var t=0,a=new Array(e);t<e;t++)a[t]=l[t];return a}function Da(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function La(l){var e;return typeof l=="function"?e={callback:l}:e=l,e}function Na(l,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a,o,n,u=function(p){for(var d=arguments.length,v=new Array(d>1?d-1:0),y=1;y<d;y++)v[y-1]=arguments[y];if(n=v,!(a&&p===o)){var g=t.leading;typeof g=="function"&&(g=g(p,o)),(!a||p!==o)&&g&&l.apply(void 0,[p].concat(Ut(n))),o=p,clearTimeout(a),a=setTimeout(function(){l.apply(void 0,[p].concat(Ut(n))),a=0},e)}};return u._clear=function(){clearTimeout(a),a=null},u}function hs(l,e){if(l===e)return!0;if(at(l)==="object"){for(var t in l)if(!hs(l[t],e[t]))return!1;return!0}return!1}var Ma=(function(){function l(e,t,a){Ra(this,l),this.el=e,this.observer=null,this.frozen=!1,this.createObserver(t,a)}return Pa(l,[{key:"createObserver",value:function(t,a){var o=this;if(this.observer&&this.destroyObserver(),!this.frozen){if(this.options=La(t),this.callback=function(c,p){o.options.callback(c,p),c&&o.options.once&&(o.frozen=!0,o.destroyObserver())},this.callback&&this.options.throttle){var n=this.options.throttleOptions||{},u=n.leading;this.callback=Na(this.callback,this.options.throttle,{leading:function(p){return u==="both"||u==="visible"&&p||u==="hidden"&&!p}})}this.oldResult=void 0,this.observer=new IntersectionObserver(function(c){var p=c[0];if(c.length>1){var d=c.find(function(y){return y.isIntersecting});d&&(p=d)}if(o.callback){var v=p.isIntersecting&&p.intersectionRatio>=o.threshold;if(v===o.oldResult)return;o.oldResult=v,o.callback(v,p)}},this.options.intersection),Me(function(){o.observer&&o.observer.observe(o.el)})}}},{key:"destroyObserver",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null),this.callback&&this.callback._clear&&(this.callback._clear(),this.callback=null)}},{key:"threshold",get:function(){return this.options.intersection&&typeof this.options.intersection.threshold=="number"?this.options.intersection.threshold:0}}]),l})();function ys(l,e,t){var a=e.value;if(a)if(typeof IntersectionObserver>"u")console.warn("[vue-observe-visibility] IntersectionObserver API is not available in your browser. Please install this polyfill: https://github.com/w3c/IntersectionObserver/tree/master/polyfill");else{var o=new Ma(l,a,t);l._vue_visibilityState=o}}function Ua(l,e,t){var a=e.value,o=e.oldValue;if(!hs(a,o)){var n=l._vue_visibilityState;if(!a){bs(l);return}n?n.createObserver(a,t):ys(l,{value:a},t)}}function bs(l){var e=l._vue_visibilityState;e&&(e.destroyObserver(),delete l._vue_visibilityState)}var za={beforeMount:ys,updated:Ua,unmounted:bs},Ba={itemsLimit:1e3},Wa=/(auto|scroll)/;function _s(l,e){return l.parentNode===null?e:_s(l.parentNode,e.concat([l]))}var vt=function(e,t){return getComputedStyle(e,null).getPropertyValue(t)},ja=function(e){return vt(e,"overflow")+vt(e,"overflow-y")+vt(e,"overflow-x")},Ha=function(e){return Wa.test(ja(e))};function zt(l){if(l instanceof HTMLElement||l instanceof SVGElement){for(var e=_s(l.parentNode,[]),t=0;t<e.length;t+=1)if(Ha(e[t]))return e[t];return document.scrollingElement||document.documentElement}}function Tt(l){"@babel/helpers - typeof";return Tt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tt(l)}var qa={items:{type:Array,required:!0},keyField:{type:String,default:"id"},direction:{type:String,default:"vertical",validator:function(e){return["vertical","horizontal"].includes(e)}},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"}};function Ga(){return this.items.length&&Tt(this.items[0])!=="object"}var Ct=!1;if(typeof window<"u"){Ct=!1;try{var Ja=Object.defineProperty({},"passive",{get:function(){Ct=!0}});window.addEventListener("test",null,Ja)}catch{}}let Xa=0;var ft={name:"RecycleScroller",components:{ResizeObserver:pt},directives:{ObserveVisibility:za},props:{...qa,itemSize:{type:Number,default:null},gridItems:{type:Number,default:void 0},itemSecondarySize:{type:Number,default:void 0},minItemSize:{type:[Number,String],default:null},sizeField:{type:String,default:"size"},typeField:{type:String,default:"type"},buffer:{type:Number,default:200},pageMode:{type:Boolean,default:!1},prerender:{type:Number,default:0},emitUpdate:{type:Boolean,default:!1},updateInterval:{type:Number,default:0},skipHover:{type:Boolean,default:!1},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},listClass:{type:[String,Object,Array],default:""},itemClass:{type:[String,Object,Array],default:""}},emits:["resize","visible","hidden","update","scroll-start","scroll-end"],data(){return{pool:[],totalSize:0,ready:!1,hoverKey:null}},computed:{sizes(){if(this.itemSize===null){const l={"-1":{accumulator:0}},e=this.items,t=this.sizeField,a=this.minItemSize;let o=1e4,n=0,u;for(let c=0,p=e.length;c<p;c++)u=e[c][t]||a,u<o&&(o=u),n+=u,l[c]={accumulator:n,size:u};return this.$_computedMinItemSize=o,l}return[]},simpleArray:Ga,itemIndexByKey(){const{keyField:l,items:e}=this,t={};for(let a=0,o=e.length;a<o;a++)t[e[a][l]]=a;return t}},watch:{items(){this.updateVisibleItems(!0)},pageMode(){this.applyPageMode(),this.updateVisibleItems(!1)},sizes:{handler(){this.updateVisibleItems(!1)},deep:!0},gridItems(){this.updateVisibleItems(!0)},itemSecondarySize(){this.updateVisibleItems(!0)}},created(){this.$_startIndex=0,this.$_endIndex=0,this.$_views=new Map,this.$_unusedViews=new Map,this.$_scrollDirty=!1,this.$_lastUpdateScrollPosition=0,this.prerender&&(this.$_prerender=!0,this.updateVisibleItems(!1)),this.gridItems&&!this.itemSize&&console.error("[vue-recycle-scroller] You must provide an itemSize when using gridItems")},mounted(){this.applyPageMode(),this.$nextTick(()=>{this.$_prerender=!1,this.updateVisibleItems(!0),this.ready=!0})},activated(){const l=this.$_lastUpdateScrollPosition;typeof l=="number"&&this.$nextTick(()=>{this.scrollToPosition(l)})},beforeUnmount(){this.removeListeners()},methods:{addView(l,e,t,a,o){const n=Fs({id:Xa++,index:e,used:!0,key:a,type:o}),u=Rs({item:t,position:0,nr:n});return l.push(u),u},unuseView(l,e=!1){const t=this.$_unusedViews,a=l.nr.type;let o=t.get(a);o||(o=[],t.set(a,o)),o.push(l),e||(l.nr.used=!1,l.position=-9999)},handleResize(){this.$emit("resize"),this.ready&&this.updateVisibleItems(!1)},handleScroll(l){if(!this.$_scrollDirty){if(this.$_scrollDirty=!0,this.$_updateTimeout)return;const e=()=>requestAnimationFrame(()=>{this.$_scrollDirty=!1;const{continuous:t}=this.updateVisibleItems(!1,!0);t||(clearTimeout(this.$_refreshTimout),this.$_refreshTimout=setTimeout(this.handleScroll,this.updateInterval+100))});e(),this.updateInterval&&(this.$_updateTimeout=setTimeout(()=>{this.$_updateTimeout=0,this.$_scrollDirty&&e()},this.updateInterval))}},handleVisibilityChange(l,e){this.ready&&(l||e.boundingClientRect.width!==0||e.boundingClientRect.height!==0?(this.$emit("visible"),requestAnimationFrame(()=>{this.updateVisibleItems(!1)})):this.$emit("hidden"))},updateVisibleItems(l,e=!1){const t=this.itemSize,a=this.gridItems||1,o=this.itemSecondarySize||t,n=this.$_computedMinItemSize,u=this.typeField,c=this.simpleArray?null:this.keyField,p=this.items,d=p.length,v=this.sizes,y=this.$_views,g=this.$_unusedViews,T=this.pool,b=this.itemIndexByKey;let _,U,L,V,w;if(!d)_=U=V=w=L=0;else if(this.$_prerender)_=V=0,U=w=Math.min(this.prerender,p.length),L=null;else{const i=this.getScroll();if(e){let A=i.start-this.$_lastUpdateScrollPosition;if(A<0&&(A=-A),t===null&&A<n||A<t)return{continuous:!0}}this.$_lastUpdateScrollPosition=i.start;const q=this.buffer;i.start-=q,i.end+=q;let Q=0;if(this.$refs.before&&(Q=this.$refs.before.scrollHeight,i.start-=Q),this.$refs.after){const A=this.$refs.after.scrollHeight;i.end+=A}if(t===null){let A,K=0,S=d-1,F=~~(d/2),P;do P=F,A=v[F].accumulator,A<i.start?K=F:F<d-1&&v[F+1].accumulator>i.start&&(S=F),F=~~((K+S)/2);while(F!==P);for(F<0&&(F=0),_=F,L=v[d-1].accumulator,U=F;U<d&&v[U].accumulator<i.end;U++);for(U===-1?U=p.length-1:(U++,U>d&&(U=d)),V=_;V<d&&Q+v[V].accumulator<i.start;V++);for(w=V;w<d&&Q+v[w].accumulator<i.end;w++);}else{_=~~(i.start/t*a);const A=_%a;_-=A,U=Math.ceil(i.end/t*a),V=Math.max(0,Math.floor((i.start-Q)/t*a)),w=Math.floor((i.end-Q)/t*a),_<0&&(_=0),U>d&&(U=d),V<0&&(V=0),w>d&&(w=d),L=Math.ceil(d/a)*t}}U-_>Ba.itemsLimit&&this.itemsLimitError(),this.totalSize=L;let $;const D=_<=this.$_endIndex&&U>=this.$_startIndex;if(D)for(let i=0,q=T.length;i<q;i++)$=T[i],$.nr.used&&(l&&($.nr.index=b[$.item[c]]),($.nr.index==null||$.nr.index<_||$.nr.index>=U)&&this.unuseView($));const C=D?null:new Map;let m,N,I;for(let i=_;i<U;i++){m=p[i];const q=c?m[c]:m;if(q==null)throw new Error(`Key is ${q} on item (keyField is '${c}')`);if($=y.get(q),!t&&!v[i].size){$&&this.unuseView($);continue}N=m[u];let Q=g.get(N),A=!1;if(!$)D?Q&&Q.length?$=Q.pop():$=this.addView(T,i,m,q,N):(I=C.get(N)||0,(!Q||I>=Q.length)&&($=this.addView(T,i,m,q,N),this.unuseView($,!0),Q=g.get(N)),$=Q[I],C.set(N,I+1)),y.delete($.nr.key),$.nr.used=!0,$.nr.index=i,$.nr.key=q,$.nr.type=N,y.set(q,$),A=!0;else if(!$.nr.used&&($.nr.used=!0,A=!0,Q)){const K=Q.indexOf($);K!==-1&&Q.splice(K,1)}$.item=m,A&&(i===p.length-1&&this.$emit("scroll-end"),i===0&&this.$emit("scroll-start")),t===null?($.position=v[i-1].accumulator,$.offset=0):($.position=Math.floor(i/a)*t,$.offset=i%a*o)}return this.$_startIndex=_,this.$_endIndex=U,this.emitUpdate&&this.$emit("update",_,U,V,w),clearTimeout(this.$_sortTimer),this.$_sortTimer=setTimeout(this.sortViews,this.updateInterval+300),{continuous:D}},getListenerTarget(){let l=zt(this.$el);return window.document&&(l===window.document.documentElement||l===window.document.body)&&(l=window),l},getScroll(){const{$el:l,direction:e}=this,t=e==="vertical";let a;if(this.pageMode){const o=l.getBoundingClientRect(),n=t?o.height:o.width;let u=-(t?o.top:o.left),c=t?window.innerHeight:window.innerWidth;u<0&&(c+=u,u=0),u+c>n&&(c=n-u),a={start:u,end:u+c}}else t?a={start:l.scrollTop,end:l.scrollTop+l.clientHeight}:a={start:l.scrollLeft,end:l.scrollLeft+l.clientWidth};return a},applyPageMode(){this.pageMode?this.addListeners():this.removeListeners()},addListeners(){this.listenerTarget=this.getListenerTarget(),this.listenerTarget.addEventListener("scroll",this.handleScroll,Ct?{passive:!0}:!1),this.listenerTarget.addEventListener("resize",this.handleResize)},removeListeners(){this.listenerTarget&&(this.listenerTarget.removeEventListener("scroll",this.handleScroll),this.listenerTarget.removeEventListener("resize",this.handleResize),this.listenerTarget=null)},scrollToItem(l){let e;const t=this.gridItems||1;this.itemSize===null?e=l>0?this.sizes[l-1].accumulator:0:e=Math.floor(l/t)*this.itemSize,this.scrollToPosition(e)},scrollToPosition(l){const e=this.direction==="vertical"?{scroll:"scrollTop",start:"top"}:{scroll:"scrollLeft",start:"left"};let t,a,o;if(this.pageMode){const n=zt(this.$el),u=n.tagName==="HTML"?0:n[e.scroll],c=n.getBoundingClientRect(),d=this.$el.getBoundingClientRect()[e.start]-c[e.start];t=n,a=e.scroll,o=l+u+d}else t=this.$el,a=e.scroll,o=l;t[a]=o},itemsLimitError(){throw setTimeout(()=>{this.$el}),new Error("Rendered items limit reached")},sortViews(){this.pool.sort((l,e)=>l.nr.index-e.nr.index)}}};const Ka={key:0,ref:"before",class:"vue-recycle-scroller__slot"},Za={key:1,ref:"after",class:"vue-recycle-scroller__slot"};function Ya(l,e,t,a,o,n){const u=Qt("ResizeObserver"),c=es("observe-visibility");return Be((r(),f("div",{class:ae(["vue-recycle-scroller",{ready:o.ready,"page-mode":t.pageMode,[`direction-${l.direction}`]:!0}]),onScrollPassive:e[0]||(e[0]=(...p)=>n.handleScroll&&n.handleScroll(...p))},[l.$slots.before?(r(),f("div",Ka,[ze(l.$slots,"before")],512)):E("v-if",!0),(r(),ee(Vt(t.listTag),{ref:"wrapper",style:fe({[l.direction==="vertical"?"minHeight":"minWidth"]:o.totalSize+"px"}),class:ae(["vue-recycle-scroller__item-wrapper",t.listClass])},{default:R(()=>[(r(!0),f(te,null,ne(o.pool,p=>(r(),ee(Vt(t.itemTag),xs({key:p.nr.id,style:o.ready?{transform:`translate${l.direction==="vertical"?"Y":"X"}(${p.position}px) translate${l.direction==="vertical"?"X":"Y"}(${p.offset}px)`,width:t.gridItems?`${l.direction==="vertical"&&t.itemSecondarySize||t.itemSize}px`:void 0,height:t.gridItems?`${l.direction==="horizontal"&&t.itemSecondarySize||t.itemSize}px`:void 0}:null,class:["vue-recycle-scroller__item-view",[t.itemClass,{hover:!t.skipHover&&o.hoverKey===p.nr.key}]]},Ps(t.skipHover?{}:{mouseenter:()=>{o.hoverKey=p.nr.key},mouseleave:()=>{o.hoverKey=null}})),{default:R(()=>[ze(l.$slots,"default",{item:p.item,index:p.nr.index,active:p.nr.used})]),_:2},1040,["style","class"]))),128)),ze(l.$slots,"empty")]),_:3},8,["style","class"])),l.$slots.after?(r(),f("div",Za,[ze(l.$slots,"after")],512)):E("v-if",!0),k(u,{onNotify:n.handleResize},null,8,["onNotify"])],34)),[[c,n.handleVisibilityChange]])}ft.render=Ya;ft.__file="src/components/RecycleScroller.vue";const Qa={class:"trial-list-search"},en=["value"],tn=de({__name:"TrialListSearch",props:{modelValue:{}},emits:["update:modelValue"],setup(l,{emit:e}){const t=e,a=H(),o=vs(d=>{t("update:modelValue",d)},300);function n(d){const v=d.target.value;o(v)}function u(){t("update:modelValue",""),a.value?.focus()}function c(){a.value?.focus(),a.value?.select()}function p(d){d.type==="focus-trial-search"&&c()}return Ie(()=>{window.addEventListener("focus-trial-search",p)}),Ve(()=>{window.removeEventListener("focus-trial-search",p)}),(d,v)=>(r(),f("div",Qa,[k(j(ns),{class:"search-icon"}),s("input",{ref_key:"searchInput",ref:a,type:"text",class:"search-input",placeholder:"Filter trials...",value:d.modelValue,onInput:n,onKeydown:ht(u,["escape"])},null,40,en),d.modelValue?(r(),ee(j(os),{key:0,class:"clear-icon",onClick:u})):E("",!0)]))}}),sn=ce(tn,[["__scopeId","data-v-3a032c2b"]]),an={class:"item-content"},nn={class:"item-header"},on=["title"],ln={key:0,class:"progress-bar"},rn={class:"item-metadata"},un={class:"meta-item"},dn={class:"meta-item"},cn={key:0,class:"meta-separator"},pn={key:1,class:"meta-item cost"},fn=de({__name:"TrialListItem",props:{trial:{},selected:{type:Boolean}},emits:["click"],setup(l){const e=l,{calculateTemplateTokens:t,calculatePromptTokens:a,estimateTotalCost:o,sumEstimates:n,formatCost:u}=dt(),c=M(()=>{if(e.trial.progress.total===0)return 0;const y=e.trial.progress.completed+e.trial.progress.failed;return Math.round(y/e.trial.progress.total*100)}),p=M(()=>{const{completed:y,failed:g,total:T}=e.trial.progress;return e.trial.status==="draft"?`${T} tasks`:`${y+g}/${T} tasks`}),d=M(()=>{const y=e.trial.started||e.trial.created;if(!y)return"";const T=new Date().getTime()-y.getTime(),b=Math.floor(T/1e3),_=Math.floor(b/60),U=Math.floor(_/60),L=Math.floor(U/24);return b<60?"now":_<60?`${_}m`:U<24?`${U}h`:`${L}d`}),v=M(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let y=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)y=t(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const b=a(e.trial.spreadsheetConfig.promptPattern),_=e.trial.progress.total/e.trial.configurations.length;y={totalTokens:b*_,combinationCount:_,perCallAverage:b}}else if(e.trial.type==="playground")return null;if(!y||y.totalTokens===0)return null;const g=e.trial.configurations.map(b=>{const _=b.modelSnapshot;return _?o(y.totalTokens,y.combinationCount,_,b.parameters):null}).filter(Boolean);if(g.length===0)return null;const T=n(g);return`${u(T,"compact")} total`});return(y,g)=>(r(),f("div",{class:ae(["trial-list-item",{selected:y.selected,"has-progress":y.trial.status==="running"}]),onClick:g[0]||(g[0]=T=>y.$emit("click"))},[s("div",{class:ae(["status-indicator",`status-${y.trial.status}`])},null,2),s("div",an,[s("div",nn,[s("span",{class:"trial-name",title:y.trial.name},h(y.trial.name),9,on),s("span",{class:ae(["status-tag",`status-${y.trial.status}`])},h(y.trial.status.toUpperCase()),3)]),y.trial.status==="running"?(r(),f("div",ln,[s("div",{class:"progress-fill",style:fe({width:`${c.value}%`})},null,4)])):E("",!0),s("div",rn,[s("span",un,h(p.value),1),g[1]||(g[1]=s("span",{class:"meta-separator"},"â€¢",-1)),s("span",dn,h(d.value),1),v.value?(r(),f("span",cn,"â€¢")):E("",!0),v.value?(r(),f("span",pn,h(v.value),1)):E("",!0)])])],2))}}),Bt=ce(fn,[["__scopeId","data-v-037b1757"]]),mn={class:"section-title"},vn=de({__name:"TrialListSection",props:{title:{},background:{type:Boolean}},setup(l){return(e,t)=>(r(),f("div",{class:ae(["trial-list-section",{"with-background":e.background}])},[s("span",mn,h(e.title),1)],2))}}),Wt=ce(vn,[["__scopeId","data-v-07a26c58"]]),gn={class:"panel-header"},hn={class:"header-title"},yn={key:0,class:"title-text"},bn={class:"trial-count"},_n={key:0,class:"header-actions"},Tn={class:"filter-count"},Cn={class:"filter-count"},$n={class:"filter-count"},kn={class:"filter-count"},wn={class:"filter-count"},Sn={key:1,class:"status-tabs"},In={class:"tab-count"},En={class:"tab-count"},Fn={class:"tab-count"},Rn={class:"trial-list-container"},xn={key:1,class:"trial-list"},Pn={key:2,class:"collapsed-list"},An=["onClick"],Vn={class:"collapsed-count"},On={key:3,class:"empty-state"},Dn=de({__name:"TrialListPanelV3",props:{trials:{},selectedTrialId:{},searchQuery:{},filterStatus:{}},emits:["select-trial","create-trial","import-trial","update-search","update-filter","refresh"],setup(l,{emit:e}){const t=l,a=e,o=H(!1),n=H("all"),u=H(250),c=M(()=>u.value<50),p=M(()=>t.trials.filter(C=>C.status==="running"||C.status==="paused").length),d=M(()=>t.trials.filter(C=>C.status==="completed"||C.status==="failed").length),v=M(()=>{let C=t.trials;if(t.searchQuery){const i=t.searchQuery.toLowerCase();C=C.filter(q=>{const Q=q.name.toLowerCase().includes(i),A=q.templateConfig?.template?.toLowerCase().includes(i),K=q.configurations.some(S=>S.modelId.toLowerCase().includes(i)||S.provider.toLowerCase().includes(i));return Q||A||K})}t.filterStatus!=="all"&&(C=C.filter(i=>i.status===t.filterStatus)),n.value==="active"?C=C.filter(i=>i.status==="running"||i.status==="paused"):n.value==="done"&&(C=C.filter(i=>i.status==="completed"||i.status==="failed"));const m=C.filter(i=>i.status==="running"),N=C.filter(i=>i.status!=="running"),I=[];return m.length>0&&(I.push({type:"section",title:"RUNNING",background:!0,id:"section-running"}),I.push(...m.sort((i,q)=>(q.started?.getTime()||0)-(i.started?.getTime()||0)))),N.length>0&&(m.length>0&&I.push({type:"section",title:"RECENT",background:!1,id:"section-recent"}),I.push(...N.sort((i,q)=>(q.created?.getTime()||0)-(i.created?.getTime()||0)))),I}),y=M(()=>v.value.map(C=>({...C,height:L(C)}))),g=M(()=>t.trials.filter(C=>n.value==="active"?C.status==="running"||C.status==="paused":n.value==="done"?C.status==="completed"||C.status==="failed":!0)),T=M(()=>t.searchQuery?"No trials found":t.filterStatus==="running"?"No trials are currently running":"No trials found"),b=M(()=>t.searchQuery?"No trials match your search":t.filterStatus!=="all"?`No ${t.filterStatus} trials`:"Create your first trial to get started"),_=M(()=>t.filterStatus==="all"&&!t.searchQuery);function U(C){return t.trials.filter(m=>m.status===C).length}function L(C){if(C.type==="section")return 32;const m=C.status==="running",N=C.configurations?.some(I=>I.repeatCount>1);return m||N?96:80}function V(C){const m=C.progress.completed+C.progress.failed;return C.status==="running"?`${Math.round(m/C.progress.total*100)}%`:m.toString()}async function w(){o.value=!0;try{await new Promise(C=>setTimeout(C,500)),a("refresh")}finally{o.value=!1}}function $({key:C}){a("update-filter",C)}function D(){const C=document.querySelector(".trial-list-panel");C&&(u.value=C.clientWidth)}return Ie(()=>{D(),window.addEventListener("resize",D);const C=document.querySelector(".trial-list-panel");C&&new ResizeObserver(()=>D()).observe(C)}),Ve(()=>{window.removeEventListener("resize",D)}),(C,m)=>{const N=Ee,I=Rt,i=Hs,q=Ft,Q=Et;return r(),f("div",{class:ae(["trial-list-panel",{collapsed:c.value}])},[s("div",gn,[s("div",hn,[k(j(zs),{class:"title-icon"}),c.value?E("",!0):(r(),f("span",yn,"Trials")),s("span",bn,h(C.trials.length),1)]),c.value?E("",!0):(r(),f("div",_n,[k(N,{type:"primary",size:"small",onClick:m[0]||(m[0]=A=>C.$emit("create-trial"))},{default:R(()=>[k(j(Bs)),m[7]||(m[7]=O(" New Trial "))]),_:1,__:[7]}),k(N,{size:"small",onClick:m[1]||(m[1]=A=>C.$emit("import-trial"))},{default:R(()=>[k(j(ls)),m[8]||(m[8]=O(" Import "))]),_:1,__:[8]}),k(N,{size:"small",onClick:w,loading:o.value},{default:R(()=>[k(j(Ws),{spin:o.value},null,8,["spin"])]),_:1},8,["loading"]),k(Q,null,{overlay:R(()=>[k(q,{onClick:$},{default:R(()=>[k(I,{key:"all"},{default:R(()=>m[9]||(m[9]=[s("span",null,"All Trials",-1)])),_:1,__:[9]}),k(i),k(I,{key:"running"},{default:R(()=>[m[10]||(m[10]=s("span",null,"Running Only",-1)),s("span",Tn,h(U("running")),1)]),_:1,__:[10]}),k(I,{key:"completed"},{default:R(()=>[m[11]||(m[11]=s("span",null,"Completed Only",-1)),s("span",Cn,h(U("completed")),1)]),_:1,__:[11]}),k(I,{key:"failed"},{default:R(()=>[m[12]||(m[12]=s("span",null,"Failed Only",-1)),s("span",$n,h(U("failed")),1)]),_:1,__:[12]}),k(I,{key:"paused"},{default:R(()=>[m[13]||(m[13]=s("span",null,"Paused Only",-1)),s("span",kn,h(U("paused")),1)]),_:1,__:[13]}),k(I,{key:"draft"},{default:R(()=>[m[14]||(m[14]=s("span",null,"Draft Only",-1)),s("span",wn,h(U("draft")),1)]),_:1,__:[14]})]),_:1})]),default:R(()=>[k(N,{size:"small"},{default:R(()=>[k(j(js))]),_:1})]),_:1})]))]),c.value?E("",!0):(r(),ee(sn,{key:0,"model-value":C.searchQuery,"onUpdate:modelValue":m[2]||(m[2]=A=>C.$emit("update-search",A))},null,8,["model-value"])),c.value?E("",!0):(r(),f("div",Sn,[s("div",{class:ae(["status-tab",{active:n.value==="all"}]),onClick:m[3]||(m[3]=A=>n.value="all")},[m[15]||(m[15]=s("span",{class:"tab-icon"},"ðŸ“Š",-1)),m[16]||(m[16]=s("span",{class:"tab-label"},"ALL",-1)),s("span",In,h(C.trials.length),1)],2),s("div",{class:ae(["status-tab",{active:n.value==="active"}]),onClick:m[4]||(m[4]=A=>n.value="active")},[m[17]||(m[17]=s("span",{class:"tab-icon"},"ðŸŸ¢",-1)),m[18]||(m[18]=s("span",{class:"tab-label"},"Active",-1)),s("span",En,h(p.value),1)],2),s("div",{class:ae(["status-tab",{active:n.value==="done"}]),onClick:m[5]||(m[5]=A=>n.value="done")},[m[19]||(m[19]=s("span",{class:"tab-icon"},"âœ…",-1)),m[20]||(m[20]=s("span",{class:"tab-label"},"Done",-1)),s("span",Fn,h(d.value),1)],2)])),s("div",Rn,[!c.value&&v.value.length>100?(r(),ee(j(ft),{key:0,class:"trial-list virtual-list",items:y.value,"size-field":"height","key-field":"id",buffer:10},{default:R(({item:A})=>[A.type==="section"?(r(),ee(Wt,{key:0,title:A.title,background:A.background},null,8,["title","background"])):(r(),ee(Bt,{key:1,trial:A,selected:A.id===C.selectedTrialId,"data-trial-id":A.id,onClick:K=>C.$emit("select-trial",A.id)},null,8,["trial","selected","data-trial-id","onClick"]))]),_:1},8,["items"])):c.value?(r(),f("div",Pn,[(r(!0),f(te,null,ne(g.value,A=>(r(),f("div",{key:A.id,class:ae(["collapsed-item",{selected:A.id===C.selectedTrialId}]),onClick:K=>C.$emit("select-trial",A.id)},[s("div",{class:ae(["status-dot",`status-${A.status}`])},null,2),s("span",Vn,h(V(A)),1)],10,An))),128))])):(r(),f("div",xn,[(r(!0),f(te,null,ne(v.value,(A,K)=>(r(),f(te,{key:A.id||`section-${K}`},[A.type==="section"?(r(),ee(Wt,{key:0,title:A.title,background:A.background},null,8,["title","background"])):(r(),ee(Bt,{key:1,trial:A,selected:A.id===C.selectedTrialId,"data-trial-id":A.id,onClick:S=>C.$emit("select-trial",A.id)},null,8,["trial","selected","data-trial-id","onClick"]))],64))),128))])),v.value.length===0&&!c.value?(r(),f("div",On,[k(j(is),{class:"empty-icon"}),s("h3",null,h(T.value),1),s("p",null,h(b.value),1),_.value?(r(),ee(N,{key:0,type:"primary",size:"large",onClick:m[6]||(m[6]=A=>C.$emit("create-trial"))},{default:R(()=>m[21]||(m[21]=[O(" Create New Trial ")])),_:1,__:[21]})):E("",!0)])):E("",!0)])],2)}}}),Ln=ce(Dn,[["__scopeId","data-v-ad2a17cf"]]),Nn={class:"trial-header"},Mn={class:"header-main"},Un={class:"header-title"},zn={class:"trial-name"},Bn={key:0,class:"progress-container"},Wn={class:"progress-bar"},jn={class:"progress-stats-inline"},Hn={class:"progress-text"},qn={key:0,class:"progress-stat"},Gn={class:"stat-number"},Jn={key:1,class:"progress-stat"},Xn={class:"stat-number"},Kn={key:2,class:"progress-stat"},Zn={class:"stat-number"},Yn=de({__name:"TrialHeaderV3",props:{trial:{},progress:{},isExecuting:{type:Boolean}},setup(l){const e=l,t=M(()=>{let b=e.trial.name;return b=b.replace(/\s*-\s*\d{1,2}\/\d{1,2}\/\d{4}$/,""),b=b.replace(/\s*\(Copy\)(\s*\(Copy\))*/g,""),b.trim()}),a=M(()=>!0),o=M(()=>e.progress?e.progress.completed+e.progress.failed:0),n=M(()=>{if(!e.progress||e.progress.total===0)return 0;const b=e.progress.completed+e.progress.failed;return Math.round(b/e.progress.total*100)}),u=M(()=>{const b=e.trial.started||e.trial.created;if(!b)return"0m";let _;if(e.trial.status==="draft")return"0m";e.trial.completed?_=e.trial.completed:_=new Date;const U=_.getTime()-b.getTime(),L=Math.floor(U/(1e3*60*60)),V=Math.floor(U%(1e3*60*60)/(1e3*60));return L>0?`${L}h ${V}m`:`${V}m`}),c=M(()=>{if(!e.progress?.avgLatencyMs)return null;const b=e.progress.avgLatencyMs;return b<1e3?`${Math.round(b)}ms`:`${(b/1e3).toFixed(1)}s`}),{calculateTemplateTokens:p,calculatePromptTokens:d,estimateTotalCost:v,sumEstimates:y,formatCost:g}=dt();M(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let b=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)b=p(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const L=d(e.trial.spreadsheetConfig.promptPattern),w=(e.progress?.total||e.trial.progress.total)/e.trial.configurations.length;b={totalTokens:L*w,combinationCount:w,perCallAverage:L}}else if(e.trial.type==="playground")return null;if(!b||b.totalTokens===0)return null;const _=e.trial.configurations.map(L=>{const V=L.modelSnapshot;return V?v(b.totalTokens,b.combinationCount,V,L.parameters):null}).filter(Boolean);if(_.length===0)return null;const U=y(_);return`${g(U,"compact")} total`});const T=M(()=>{if(e.trial.status!=="running"||!e.progress||e.progress.completed===0)return null;const _=(Date.now()-(e.trial.started?.getTime()||0))/e.progress.completed,U=e.progress.pending*_,L=Math.floor(U/(1e3*60)),V=Math.floor(U%(1e3*60)/1e3);if(L>60){const w=Math.floor(L/60),$=L%60;return`${w}h ${$}m`}return`${L}m ${V}s`});return(b,_)=>(r(),f("div",Nn,[s("div",Mn,[s("div",Un,[s("h2",zn,h(t.value),1),s("span",{class:ae(["status-tag",`status-${b.trial.status}`])},h(b.trial.status.toUpperCase()),3)]),a.value?(r(),f("div",Bn,[s("div",Wn,[s("div",{class:"progress-fill",style:fe({width:`${n.value}%`})},null,4)]),s("div",jn,[s("span",Hn,h(o.value)+"/"+h(b.progress?.total||0)+" ("+h(n.value)+"%) ",1),u.value?(r(),f("span",qn,[_[0]||(_[0]=s("span",{class:"stat-label"},"Duration:",-1)),_[1]||(_[1]=O()),s("span",Gn,h(u.value),1)])):E("",!0),c.value?(r(),f("span",Jn,[_[2]||(_[2]=s("span",{class:"stat-label"},"Avg:",-1)),_[3]||(_[3]=O()),s("span",Xn,h(c.value),1)])):E("",!0),T.value?(r(),f("span",Kn,[_[4]||(_[4]=s("span",{class:"stat-label"},"Remaining:",-1)),_[5]||(_[5]=O()),s("span",Zn,"~"+h(T.value),1)])):E("",!0)])])):E("",!0)]),E("",!0)]))}}),Qn=ce(Yn,[["__scopeId","data-v-248be564"]]),eo={class:"trial-actions"},to={class:"action-group execution-controls"},so={class:"action-group data-actions"},ao={class:"action-group management-actions"},no=de({__name:"TrialActionsV3",props:{trial:{},isLeader:{type:Boolean},executionState:{}},emits:["start","pause","resume","cancel","duplicate","edit","delete","export-data","export-python","refresh"],setup(l,{emit:e}){const t=l,a=e,o=H(!1),n=H(!1),u=H(!1);M(()=>t.executionState?.currentTrialId===t.trial.id);const c=M(()=>["draft","failed","cancelled"].includes(t.trial.status)),p=M(()=>t.trial.status==="running"),d=M(()=>t.trial.status==="paused"),v=M(()=>["running","paused"].includes(t.trial.status));function y(){a("start")}async function g(){o.value=!0,n.value=!1,a("pause"),setTimeout(()=>{o.value=!1},1e3)}async function T(){n.value=!0,o.value=!1,a("resume"),setTimeout(()=>{n.value=!1},3e3)}function b(){Le.confirm({title:"Cancel trial?",content:"This will stop all pending API calls.",okText:"Cancel Trial",okType:"danger",onOk:()=>a("cancel")})}async function _(){u.value=!0,a("refresh"),setTimeout(()=>{u.value=!1},500)}function U({key:$}){$==="data"?a("export-data"):$==="python"&&a("export-python")}function L(){a("duplicate")}function V(){a("edit")}function w(){const $=t.trial.progress.total;Le.confirm({title:"Delete trial?",content:`Delete trial and all ${$} API calls?`,okText:"Delete",okType:"danger",cancelText:"Cancel",onOk:()=>{a("delete")}})}return($,D)=>{const C=Ee,m=Rt,N=Ft,I=Et;return r(),f("div",eo,[s("div",to,[c.value?(r(),ee(C,{key:0,type:"primary",size:"large",disabled:!$.isLeader,onClick:y},{default:R(()=>[k(j(Lt)),D[0]||(D[0]=O(" Start Trial "))]),_:1,__:[0]},8,["disabled"])):E("",!0),p.value?(r(),ee(C,{key:1,size:"large",disabled:!$.isLeader,loading:o.value,onClick:g},{default:R(()=>[o.value?E("",!0):(r(),ee(j(qs),{key:0})),O(" "+h(o.value?"Pausing...":"Pause"),1)]),_:1},8,["disabled","loading"])):E("",!0),d.value?(r(),ee(C,{key:2,type:"primary",size:"large",disabled:!$.isLeader||n.value,loading:n.value,onClick:T},{default:R(()=>[n.value?E("",!0):(r(),ee(j(Lt),{key:0})),O(" "+h(n.value?"Resuming...":"Resume"),1)]),_:1},8,["disabled","loading"])):E("",!0),v.value?(r(),ee(C,{key:3,danger:"",size:"large",disabled:!$.isLeader,onClick:b},{default:R(()=>[k(j(Gs)),D[1]||(D[1]=O(" Cancel "))]),_:1,__:[1]},8,["disabled"])):E("",!0)]),s("div",so,[k(C,{size:"large",loading:u.value,onClick:_,title:"Refresh trial data from database"},{default:R(()=>[u.value?(r(),ee(j(rs),{key:1,spin:""})):(r(),ee(j(Js),{key:0})),O(" "+h(u.value?"Refreshing...":"Refresh"),1)]),_:1},8,["loading"]),k(I,null,{overlay:R(()=>[k(N,{onClick:U},{default:R(()=>[k(m,{key:"data"},{default:R(()=>[k(j(Ks)),D[3]||(D[3]=O(" Export Data "))]),_:1,__:[3]}),k(m,{key:"python"},{default:R(()=>[k(j(Zs)),D[4]||(D[4]=O(" Export Python Script "))]),_:1,__:[4]})]),_:1})]),default:R(()=>[k(C,{size:"large"},{default:R(()=>[D[2]||(D[2]=O(" Export ")),k(j(Xs))]),_:1,__:[2]})]),_:1})]),s("div",ao,[k(C,{size:"large",disabled:!$.isLeader,onClick:L},{default:R(()=>[k(j(xt)),D[5]||(D[5]=O(" Duplicate "))]),_:1,__:[5]},8,["disabled"]),$.trial.status==="draft"?(r(),ee(C,{key:0,size:"large",disabled:!$.isLeader,onClick:V},{default:R(()=>[k(j(Ys)),D[6]||(D[6]=O(" Edit "))]),_:1,__:[6]},8,["disabled"])):E("",!0),k(C,{danger:"",size:"large",disabled:!$.isLeader,onClick:w},{default:R(()=>[k(j(Qs)),D[7]||(D[7]=O(" Delete "))]),_:1,__:[7]},8,["disabled"])])])}}}),oo=ce(no,[["__scopeId","data-v-e642c431"]]),lo={class:"snapshot-debug"},io={class:"debug-header"},ro={class:"status-row"},uo={key:0,class:"badge success"},co={key:1,class:"badge warning"},po={key:0,class:"status-row"},fo={key:0,class:"variables-section"},mo={class:"variable-header"},vo={class:"var-name"},go={class:"var-type"},ho={key:0,class:"snapshot-content"},yo={class:"snapshot-meta"},bo={key:0},_o={class:"snapshot-items"},To={class:"items-preview"},Co={class:"item-index"},$o={class:"item-value"},ko={key:0,class:"item-attrs"},wo={key:0,class:"more-indicator"},So={key:1,class:"no-snapshot"},Io={key:0},Eo={key:1,class:"legacy-warning"},Fo={class:"debug-footer"},Ro=de({__name:"SnapshotDebugModal",props:{visible:{type:Boolean},trial:{},migrating:{type:Boolean}},emits:["close","migrate"],setup(l){const e=l,t=M(()=>e.trial.templateConfig?.hasSnapshots===!0),a=M(()=>e.trial.templateConfig?.variables||{});function o(d){return"snapshot"in d&&d.snapshot!=null}function n(d){return d.snapshot}function u(d){return o(d)?`${n(d).source.type} (snapshot)`:d.type==="value"?"Direct values":d.type==="list"?"List reference":"Unknown"}function c(){for(const d of Object.values(a.value))if(o(d)){const v=n(d);if(v.source?.snapshotDate)return new Date(v.source.snapshotDate).toLocaleString()}return"Unknown"}function p(){const d={trialId:e.trial.id,trialName:e.trial.name,hasSnapshots:t.value,variables:a.value};navigator.clipboard.writeText(JSON.stringify(d,null,2)),re.success("Debug info copied to clipboard")}return(d,v)=>{const y=rt,g=ut,T=Ee,b=Le;return r(),ee(b,{visible:d.visible,title:"Variable Snapshot Debug View",width:"80%",footer:null,onCancel:v[2]||(v[2]=_=>d.$emit("close"))},{default:R(()=>[s("div",lo,[s("div",io,[s("div",ro,[v[5]||(v[5]=s("span",{class:"label"},"Snapshot Status:",-1)),t.value?(r(),f("span",uo,[k(j(us)),v[3]||(v[3]=O(" Snapshots Enabled "))])):(r(),f("span",co,[k(j(He)),v[4]||(v[4]=O(" Legacy Mode (No Snapshots) "))]))]),t.value?(r(),f("div",po,[v[6]||(v[6]=s("span",{class:"label"},"Snapshot Date:",-1)),s("span",null,h(c()),1)])):E("",!0)]),t.value?(r(),f("div",fo,[v[8]||(v[8]=s("h3",null,"Variable Snapshots",-1)),(r(!0),f(te,null,ne(a.value,(_,U)=>(r(),f("div",{key:U,class:"variable-card"},[s("div",mo,[s("span",vo,h(U),1),s("span",go,h(u(_)),1)]),o(_)?(r(),f("div",ho,[s("div",yo,[s("span",null,"Source: "+h(n(_).source.type),1),n(_).source.listName?(r(),f("span",bo," List: "+h(n(_).source.listName),1)):E("",!0),s("span",null,"Items: "+h(n(_).items.length),1)]),s("div",_o,[s("div",To,[(r(!0),f(te,null,ne(n(_).items.slice(0,5),(L,V)=>(r(),f("div",{key:V,class:"item-row"},[s("span",Co,h(V+1)+".",1),s("span",$o,h(L.value),1),L.attributes&&Object.keys(L.attributes).length>0?(r(),f("span",ko,[(r(!0),f(te,null,ne(L.attributes,(w,$)=>(r(),ee(y,{key:$,size:"small"},{default:R(()=>[O(h($)+": "+h(w),1)]),_:2},1024))),128))])):E("",!0)]))),128)),n(_).items.length>5?(r(),f("div",wo," ... and "+h(n(_).items.length-5)+" more items ",1)):E("",!0)])])])):(r(),f("div",So,[k(j(He)),v[7]||(v[7]=O(" No snapshot - using live reference ")),_.listId?(r(),f("span",Io,"List ID: "+h(_.listId),1)):E("",!0)]))]))),128))])):(r(),f("div",Eo,[k(g,{message:"Legacy Trial",description:"This trial was created before snapshots were implemented. Variable lists are loaded dynamically from the database, which means changes to lists will affect trial duplication.",type:"warning","show-icon":""}),k(T,{type:"primary",onClick:v[0]||(v[0]=_=>d.$emit("migrate")),loading:d.migrating,style:{"margin-top":"16px"}},{default:R(()=>[k(j(ea)),v[9]||(v[9]=O(" Migrate to Snapshots "))]),_:1,__:[9]},8,["loading"])])),s("div",Fo,[k(T,{onClick:p},{default:R(()=>[k(j(xt)),v[10]||(v[10]=O(" Copy Debug Info "))]),_:1,__:[10]}),k(T,{onClick:v[1]||(v[1]=_=>d.$emit("close"))},{default:R(()=>v[11]||(v[11]=[O("Close")])),_:1,__:[11]})])])]),_:1},8,["visible"])}}}),xo=ce(Ro,[["__scopeId","data-v-726379cc"]]),Po={class:"trial-detail-view"},Ao={key:0,class:"detail-content"},Vo={class:"detail-section"},Oo={class:"detail-grid"},Do={class:"detail-item"},Lo={key:0,class:"detail-item"},No={key:1,class:"detail-item"},Mo={class:"detail-item"},Uo={class:"detail-item"},zo={class:"detail-section"},Bo={class:"detail-grid"},Wo={key:0,class:"detail-item full-width"},jo={key:1,class:"detail-item full-width"},Ho={class:"detail-item"},qo={class:"detail-item"},Go={style:{display:"flex","align-items":"center",gap:"8px"}},Jo={key:0,class:"snapshot-badge success"},Xo={key:1,class:"snapshot-badge warning"},Ko={class:"detail-item"},Zo={key:2,class:"detail-item"},Yo={key:0,class:"detail-section"},Qo={class:"detail-grid"},el={class:"detail-item"},tl={class:"detail-item"},sl={class:"detail-item"},al={class:"detail-section"},nl={class:"model-configs"},ol={class:"config-header"},ll=["src","alt"],il={class:"provider-name"},rl={class:"config-details"},ul={class:"config-item"},dl={class:"config-params"},cl={class:"param-list"},pl={key:0,class:"config-item"},fl={class:"cost"},ml={key:1,class:"config-item"},vl={class:"cost"},gl={class:"config-item"},hl={class:"snapshot-debug"},yl=de({__name:"TrialDetailView",props:{trial:{},isCollapsed:{type:Boolean}},emits:["toggle-collapse"],setup(l){const e=l,t=H(!1),{calculateTemplateTokens:a,estimateTotalCost:o,formatCost:n}=dt(),u=M(()=>{const C=e.trial.started||e.trial.created,N=(e.trial.completed||new Date).getTime()-C.getTime(),I=Math.floor(N/(1e3*60*60)),i=Math.floor(N%(1e3*60*60)/(1e3*60));return I>0?`${I}h ${i}m`:`${i}m`}),c=M(()=>({draft:"Not started",pending:"Waiting to start",running:"Executing API calls",paused:"Execution paused",completed:"All calls completed",failed:"Execution failed",cancelled:"Execution cancelled"})[e.trial.status]||e.trial.status),p=M(()=>e.trial.type==="template"&&e.trial.templateConfig?.variables?Object.keys(e.trial.templateConfig.variables).length:0),d=M(()=>Math.round(e.trial.progress.total*750)),v=M(()=>e.trial.type==="template"&&e.trial.templateConfig?e.trial.templateConfig.hasSnapshots===!0:!1),y=M(()=>"text"),g=M(()=>1),T=M(()=>e.trial.progress.total/g.value);function b(C){return C?new Date(C).toLocaleString():"N/A"}function _(){if(e.trial.templateConfig?.templateName)return e.trial.templateConfig.templateName;const C=e.trial.templateConfig?.template||"Unknown Template";return C.length>50?C.substring(0,50)+"...":C}function U(){return e.trial.spreadsheetConfig?.datasetId||"Unknown Dataset"}function L(C){return{"openai-chat":"OpenAI","anthropic-messages":"Anthropic",openrouter:"OpenRouter","ollama-chat":"Ollama","ollama-generate":"Ollama"}[C]||C}function V(C){}async function w(){try{re.info("Migration feature coming soon"),t.value=!1}catch(C){re.error("Failed to migrate trial"),x.error("Migration error:",C)}}function $(C){const m=C.modelSnapshot;return m?.capabilities?.inputCostPerToken?`$${((m.capabilities.inputCostPerToken+m.capabilities.outputCostPerToken)*1e3).toFixed(8)}/1k tokens`:null}function D(C){if(!e.trial.configurations||!C.modelSnapshot)return null;let m=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)m=a(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else return null;if(!m||m.totalTokens===0)return null;const N=o(m.totalTokens,m.combinationCount,C.modelSnapshot,C.parameters);if(!N.meta.hasValidCost||N.cost.total.expected===-1)return null;const I=(e.trial.repeatCount||1)*N.cost.total.expected;return n({...N,cost:{...N.cost,total:{...N.cost.total,expected:I}}},"compact")}return(C,m)=>{const N=Ee;return r(),f("div",Po,[s("div",{class:"detail-header",onClick:m[0]||(m[0]=I=>C.$emit("toggle-collapse"))},[m[3]||(m[3]=s("h3",null,"Trial Details",-1)),k(j(ta),{class:ae(["collapse-icon",{rotated:C.isCollapsed}])},null,8,["class"])]),C.isCollapsed?E("",!0):(r(),f("div",Ao,[s("div",Vo,[m[9]||(m[9]=s("h4",null,"Basic Information",-1)),s("div",Oo,[s("div",Do,[m[4]||(m[4]=s("label",null,"Created:",-1)),s("span",null,h(b(C.trial.created)),1)]),C.trial.started?(r(),f("div",Lo,[m[5]||(m[5]=s("label",null,"Started:",-1)),s("span",null,h(b(C.trial.started)),1)])):E("",!0),C.trial.completed?(r(),f("div",No,[m[6]||(m[6]=s("label",null,"Completed:",-1)),s("span",null,h(b(C.trial.completed)),1)])):E("",!0),s("div",Mo,[m[7]||(m[7]=s("label",null,"Duration:",-1)),s("span",null,h(u.value),1)]),s("div",Uo,[m[8]||(m[8]=s("label",null,"Status:",-1)),s("span",null,h(C.trial.status)+" - "+h(c.value),1)])])]),s("div",zo,[m[19]||(m[19]=s("h4",null,"Configuration",-1)),s("div",Bo,[C.trial.type==="template"?(r(),f("div",Wo,[m[10]||(m[10]=s("label",null,"Template:",-1)),s("span",null,h(_()),1)])):E("",!0),C.trial.type==="spreadsheet"?(r(),f("div",jo,[m[11]||(m[11]=s("label",null,"Dataset:",-1)),s("span",null,h(U()),1)])):E("",!0),s("div",Ho,[m[12]||(m[12]=s("label",null,"Variable Lists:",-1)),s("span",null,h(p.value)+" lists",1)]),s("div",qo,[m[16]||(m[16]=s("label",null,"Data Snapshot:",-1)),s("div",Go,[v.value?(r(),f("span",Jo,[k(j(us)),m[13]||(m[13]=O(" Captured "))])):(r(),f("span",Xo,[k(j(He)),m[14]||(m[14]=O(" Live Reference "))])),C.trial.type==="template"?(r(),ee(N,{key:2,size:"small",type:"link",onClick:m[1]||(m[1]=I=>t.value=!0)},{default:R(()=>[k(j(ds)),m[15]||(m[15]=O(" Debug "))]),_:1,__:[15]})):E("",!0)])]),s("div",Ko,[m[17]||(m[17]=s("label",null,"Token Estimate:",-1)),s("span",null,"~"+h(d.value)+" tokens",1)]),y.value?(r(),f("div",Zo,[m[18]||(m[18]=s("label",null,"Output Type:",-1)),s("span",{class:ae(["output-type",`type-${y.value}`])},h(y.value),3)])):E("",!0)])]),g.value>1?(r(),f("div",Yo,[m[23]||(m[23]=s("h4",null,"Repeat Configuration",-1)),s("div",Qo,[s("div",el,[m[20]||(m[20]=s("label",null,"Times per prompt:",-1)),s("span",null,h(g.value),1)]),s("div",tl,[m[21]||(m[21]=s("label",null,"Total combinations:",-1)),s("span",null,h(T.value),1)]),s("div",sl,[m[22]||(m[22]=s("label",null,"Total API calls:",-1)),s("span",null,h(C.trial.progress.total),1)])])])):E("",!0),s("div",al,[m[29]||(m[29]=s("h4",null,"Model Configurations",-1)),s("div",nl,[(r(!0),f(te,null,ne(C.trial.configurations,(I,i)=>(r(),f("div",{key:i,class:"model-config-card"},[s("div",ol,[(I.provider,void 0)?(r(),f("img",{key:0,src:(I.provider,void 0),alt:I.provider,class:"provider-logo"},null,8,ll)):E("",!0),s("span",il,h(L(I.provider)),1)]),s("div",rl,[s("div",ul,[m[24]||(m[24]=s("label",null,"Model:",-1)),s("span",null,h(I.modelId),1)]),s("div",dl,[m[25]||(m[25]=s("label",null,"Parameters:",-1)),s("div",cl,[(r(!0),f(te,null,ne(I.parameters,(q,Q)=>(r(),f("span",{key:Q,class:"param-tag"},h(Q)+": "+h(q),1))),128))])]),$(I)?(r(),f("div",pl,[m[26]||(m[26]=s("label",null,"Cost Rate:",-1)),s("span",fl,h($(I)),1)])):E("",!0),D(I)?(r(),f("div",ml,[m[27]||(m[27]=s("label",null,"Total Trial Cost:",-1)),s("span",vl,h(D(I)),1)])):E("",!0),s("div",gl,[m[28]||(m[28]=s("label",null,"Model Snapshot:",-1)),s("pre",hl,h(JSON.stringify(I.modelSnapshot,null,2)),1)])])]))),128))])])])),t.value?(r(),ee(xo,{key:1,visible:t.value,trial:C.trial,onClose:m[2]||(m[2]=I=>t.value=!1),onMigrate:w},null,8,["visible","trial"])):E("",!0)])}}}),bl=ce(yl,[["__scopeId","data-v-e677baaf"]]),_l={class:"filter-bar"},Tl={class:"search-container"},Cl={class:"zoom-controls"},$l=["disabled"],kl={class:"zoom-level"},wl=["disabled"],Sl=de({__name:"TrialResultsFilterBar",props:{statusFilter:{},configFilter:{},searchQuery:{},visibleColumns:{},configurations:{},apiCalls:{},showRepeatColumn:{type:Boolean},zoomLevel:{},isFullscreen:{type:Boolean}},emits:["update:statusFilter","update:configFilter","update:searchQuery","update:visibleColumns","openPostProcessing","toggleFullscreen","zoomIn","zoomOut","resetZoom"],setup(l,{emit:e}){const t=l,a=e,o=M(()=>{const d=[{key:"status",label:"Status"},{key:"configuration",label:"Configuration"},{key:"variables",label:"Variables"},{key:"response",label:"Response"},{key:"parsedResponse",label:"Parsed Response"},{key:"postProcessedResponse",label:"Post-Processed"},{key:"length",label:"Length"},{key:"latency",label:"Latency"}];return t.showRepeatColumn&&d.splice(2,0,{key:"repeat",label:"Repeat Index"}),d}),n=M(()=>{const d={total:t.apiCalls.length,completed:0,failed:0,running:0,pending:0};return t.apiCalls.forEach(v=>{v.status==="completed"?d.completed++:v.status==="failed"?d.failed++:v.status==="running"?d.running++:v.status==="pending"&&d.pending++}),d});function u(d){return d.modelSnapshot?.displayName||`${d.provider} - ${d.modelId}`}const c=vs(d=>{const v=d.target.value;a("update:searchQuery",v)},300);function p(d){const v=[...t.visibleColumns],y=v.indexOf(d);if(y>-1)v.splice(y,1);else{const g=o.value.map(_=>_.key),T=g.indexOf(d);let b=0;for(let _=0;_<T;_++)v.includes(g[_])&&b++;v.splice(b,0,d)}a("update:visibleColumns",v)}return(d,v)=>{const y=aa,g=sa,T=cs,b=Ee,_=ps,U=Rt,L=Ft,V=Et;return r(),f("div",_l,[k(g,{value:d.statusFilter,onChange:v[0]||(v[0]=w=>d.$emit("update:statusFilter",w)),placeholder:"Filter by status",style:{width:"150px"}},{default:R(()=>[k(y,{value:"all"},{default:R(()=>[O(" All ("+h(n.value.total)+") ",1)]),_:1}),k(y,{value:"completed"},{default:R(()=>[O(" Completed ("+h(n.value.completed)+") ",1)]),_:1}),k(y,{value:"failed"},{default:R(()=>[O(" Failed ("+h(n.value.failed)+") ",1)]),_:1}),k(y,{value:"running"},{default:R(()=>[O(" Running ("+h(n.value.running)+") ",1)]),_:1}),k(y,{value:"pending"},{default:R(()=>[O(" Pending ("+h(n.value.pending)+") ",1)]),_:1})]),_:1},8,["value"]),k(g,{value:d.configFilter,onChange:v[1]||(v[1]=w=>d.$emit("update:configFilter",w)),mode:"multiple",placeholder:"Filter by configuration",style:{width:"250px"},"max-tag-count":2},{default:R(()=>[k(y,{value:""},{default:R(()=>v[7]||(v[7]=[O("All Configurations")])),_:1,__:[7]}),(r(!0),f(te,null,ne(d.configurations,(w,$)=>(r(),ee(y,{key:$,value:$.toString()},{default:R(()=>[O(h(u(w)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s("div",Tl,[k(T,{value:d.searchQuery,onInput:j(c),placeholder:"Search in variables and responses...",style:{width:"400px"},"allow-clear":""},{prefix:R(()=>[k(j(ns))]),_:1},8,["value","onInput"])]),k(V,null,{overlay:R(()=>[k(L,null,{default:R(()=>[(r(!0),f(te,null,ne(o.value,w=>(r(),ee(U,{key:w.key},{default:R(()=>[k(_,{checked:d.visibleColumns.includes(w.key),disabled:w.key==="status",onChange:$=>p(w.key)},{default:R(()=>[O(h(w.label),1)]),_:2},1032,["checked","disabled","onChange"])]),_:2},1024))),128))]),_:1})]),default:R(()=>[k(b,null,{default:R(()=>[k(j(na)),v[8]||(v[8]=O(" Columns "))]),_:1,__:[8]})]),_:1}),k(b,{type:"primary",onClick:v[2]||(v[2]=w=>d.$emit("openPostProcessing"))},{default:R(()=>[k(j(fs)),v[9]||(v[9]=O(" Post-Process "))]),_:1,__:[9]}),s("div",Cl,[s("button",{type:"button",class:"zoom-btn",disabled:(d.zoomLevel??1)<=.5,title:"Zoom out",onClick:v[3]||(v[3]=w=>d.$emit("zoomOut"))}," âˆ’ ",8,$l),s("span",kl,h(Math.round((d.zoomLevel??1)*100))+"%",1),s("button",{type:"button",class:"zoom-btn",disabled:(d.zoomLevel??1)>=2,title:"Zoom in",onClick:v[4]||(v[4]=w=>d.$emit("zoomIn"))}," + ",8,wl),s("button",{type:"button",class:"zoom-btn reset",title:"Reset zoom",onClick:v[5]||(v[5]=w=>d.$emit("resetZoom"))}," â†º ")]),k(b,{onClick:v[6]||(v[6]=w=>d.$emit("toggleFullscreen")),title:d.isFullscreen?"Exit Fullscreen":"Enter Fullscreen"},{default:R(()=>[O(h(d.isFullscreen?"âŠŸ Exit":"âŠž Fullscreen"),1)]),_:1},8,["title"])])}}}),Il=ce(Sl,[["__scopeId","data-v-4de17877"]]),El={class:"modal-content"},Fl={class:"section"},Rl={class:"info-grid"},xl={class:"info-item"},Pl={class:"monospace"},Al={class:"info-item"},Vl={class:"info-item"},Ol={key:0,class:"info-item"},Dl={class:"info-item"},Ll={key:1,class:"info-item"},Nl={key:2,class:"info-item"},Ml={key:3,class:"info-item"},Ul={key:0,class:"info-row"},zl={class:"monospace"},Bl={key:0,class:"section"},Wl={class:"variables-list"},jl={class:"variable-main"},Hl={class:"variable-label"},ql={class:"variable-value"},Gl={key:0,class:"variable-attributes"},Jl={class:"attribute-label"},Xl={class:"attribute-value"},Kl={class:"section"},Zl={class:"content-box prompt-display"},Yl={key:1,class:"section"},Ql={key:0,class:"error-result"},ei={key:1,class:"success-result"},ti={class:"content-box response-content"},si={key:0,class:"parsed-content-section"},ai={class:"content-box parsed-content"},ni={key:1,class:"post-processed-section"},oi={class:"content-box post-processed-content"},li={key:2,class:"refusal-warning"},ii={key:3,class:"refusal-warning"},ri={class:"extraction-config-section"},ui={class:"config-grid"},di={key:0,class:"config-item"},ci={class:"config-value"},pi={key:1,class:"config-item"},fi={class:"config-value"},mi={key:2,class:"config-item"},vi={class:"config-value pattern"},gi={key:3,class:"config-item"},hi={class:"config-value"},yi={key:4,class:"config-item"},bi={class:"config-value"},_i={key:5,class:"config-item"},Ti={class:"config-value"},Ci={key:6,class:"config-item no-extraction"},$i={key:4,class:"post-processing-config-section"},ki={class:"config-grid"},wi={class:"config-item post-processing-item"},Si={class:"config-value"},Ii={key:0,class:"config-item post-processing-item"},Ei={class:"config-value"},Fi={key:1,class:"config-item post-processing-item"},Ri={class:"config-value pattern"},xi={key:2,class:"config-item post-processing-item"},Pi={class:"config-value"},Ai={key:3,class:"config-item post-processing-item"},Vi={class:"config-value"},Oi={key:4,class:"config-item post-processing-item"},Di={class:"config-value"},Li={key:5,class:"usage-info"},Ni={class:"info-grid"},Mi={class:"info-item"},Ui={class:"info-item"},zi={class:"info-item"},Bi={key:0,class:"info-item"},Wi={class:"raw-data-section"},ji={class:"raw-data"},Hi={key:0},qi={key:1,class:"raw-data"},Gi={key:2},Ji={key:3,class:"raw-data"},Xi={class:"modal-footer"},Ki={key:0,class:"footer-left"},Zi={class:"position-indicator"},Yi={class:"footer-right"},Qi=de({__name:"APICallDetailModalV3",props:{visible:{type:Boolean},apiCall:{},trial:{},allApiCalls:{}},emits:["update:visible","navigate"],setup(l,{emit:e}){const t=l,a=e,o=Ds(),n=M(()=>t.allApiCalls?t.allApiCalls.findIndex(S=>S.id===t.apiCall.id):-1),u=M(()=>t.allApiCalls?.length||0),c=M(()=>n.value>0),p=M(()=>n.value>=0&&n.value<u.value-1),d=M(()=>!c.value||!t.allApiCalls?null:t.allApiCalls[n.value-1]),v=M(()=>!p.value||!t.allApiCalls?null:t.allApiCalls[n.value+1]),y=M(()=>{if(t.apiCall.duration!==void 0)return t.apiCall.duration;if(!t.apiCall.completed||!t.apiCall.created)return null;const S=new Date(t.apiCall.created).getTime();return new Date(t.apiCall.completed).getTime()-S}),g=M(()=>{if(t.apiCall.modelName){const F=t.trial.configurations[t.apiCall.configurationIndex];return F?`${F.provider} / ${t.apiCall.modelName}`:t.apiCall.modelName}const S=t.trial.configurations[t.apiCall.configurationIndex];return S?`${S.provider} / ${S.modelId}`:null}),T=M(()=>{if(t.apiCall.cost!==void 0)return t.apiCall.cost;if(!t.apiCall.result?.usage)return null;const S=t.trial.configurations[t.apiCall.configurationIndex];if(!S)return null;const F=o.models.value.find(ye=>ye.provider===S.provider&&ye.modelId===S.modelId);if(!F?.capabilities?.inputCostPerToken&&!F?.capabilities?.outputCostPerToken)return null;const P=(t.apiCall.result.usage.prompt_tokens||0)*(F.capabilities.inputCostPerToken||0),le=(t.apiCall.result.usage.completion_tokens||0)*(F.capabilities.outputCostPerToken||0);return P+le}),b=M(()=>{if(!t.apiCall.request)return"No request data";const S=JSON.parse(JSON.stringify(t.apiCall.request));return S.headers&&Object.keys(S.headers).forEach(F=>{(F.toLowerCase().includes("authorization")||F.toLowerCase().includes("api-key")||F.toLowerCase().includes("x-api-key"))&&(S.headers[F]="[REDACTED]")}),S.body&&typeof S.body=="object"&&(S.body.api_key&&(S.body.api_key="[REDACTED]"),S.body.apiKey&&(S.body.apiKey="[REDACTED]")),JSON.stringify(S,null,2)}),_=M(()=>t.apiCall.parserId?{parserId:t.apiCall.parserId,outputType:t.trial.type==="template"?t.trial.templateConfig?.outputType:void 0,extractPattern:t.trial.type==="template"?t.trial.templateConfig?.extractPattern:void 0,refusalWords:t.trial.type==="template"?t.trial.templateConfig?.refusalWords:void 0,refusalMode:t.trial.type==="template"?t.trial.templateConfig?.refusalMode:void 0,rejectRefusalWords:t.trial.type==="template"?t.trial.templateConfig?.rejectRefusalWords:void 0}:t.trial.type!=="template"||!t.trial.templateConfig?{}:{parserId:t.trial.templateConfig.parserId,outputType:t.trial.templateConfig.outputType,extractPattern:t.trial.templateConfig.extractPattern,refusalWords:t.trial.templateConfig.refusalWords,refusalMode:t.trial.templateConfig.refusalMode,rejectRefusalWords:t.trial.templateConfig.rejectRefusalWords}),U=M(()=>{const S=_.value;return!!(S.parserId||S.outputType||S.extractPattern||S.refusalWords&&S.refusalWords.length>0)}),L=M(()=>t.trial.postProcessingConfig||null),V=M(()=>t.apiCall.response?JSON.stringify({status:t.apiCall.response.status,headers:t.apiCall.response.headers,body:t.apiCall.response.body,latencyMs:t.apiCall.response.latencyMs},null,2):"No response data available"),w=M(()=>t.apiCall.result?JSON.stringify(t.apiCall.result,null,2):"No processed result available");function $(S){return{completed:"success",failed:"error",running:"processing",pending:"warning"}[S]||"default"}function D(){const S=t.trial.configurations[t.apiCall.configurationIndex];return S?.modelSnapshot?.displayName||S?.modelId||`Configuration ${t.apiCall.configurationIndex+1}`}function C(S){return(typeof S=="string"?new Date(S):S).toLocaleString()}function m(S){return S<1e3?`${S}ms`:S<6e4?`${(S/1e3).toFixed(1)}s`:`${Math.floor(S/6e4)}m ${(S%6e4/1e3).toFixed(0)}s`}function N(S){return S==null?"null":typeof S=="string"?S:typeof S=="number"||typeof S=="boolean"?String(S):JSON.stringify(S,null,2)}function I(S){return{network_error_no_response:"Network Error (No Response)",api_error_received:"API Error Response",parsing_error:"Response Parsing Error",timeout:"Request Timeout",rate_limit:"Rate Limit Exceeded"}[S]||S}function i(){a("update:visible",!1)}function q(){d.value&&a("navigate",d.value)}function Q(){v.value&&a("navigate",v.value)}function A(S){if(t.visible)switch(S.key){case"ArrowLeft":S.preventDefault(),q();break;case"ArrowRight":S.preventDefault(),Q();break;case"Escape":S.preventDefault(),i();break}}Ie(()=>{document.addEventListener("keydown",A)}),Ve(()=>{document.removeEventListener("keydown",A)});async function K(){const S={id:t.apiCall.id,status:t.apiCall.status,configuration:D(),provider:g.value,variables:t.apiCall.variables,variableAttributes:t.apiCall.variableAttributes,prompt:t.apiCall.prompt,fullApiResponse:t.apiCall.response,processedResult:t.apiCall.result,extractionConfig:_.value,postProcessingConfig:L.value,created:t.apiCall.created,completed:t.apiCall.completed,duration:y.value?`${y.value}ms`:null,cost:T.value?`$${T.value.toFixed(4)}`:null},F=JSON.stringify(S,null,2);try{await navigator.clipboard.writeText(F),re.success("Details copied to clipboard!")}catch(P){x.error("Failed to copy to clipboard",P),re.error("Failed to copy to clipboard")}}return(S,F)=>{const P=rt,le=ut,ye=la,ve=oa,he=Ee,pe=Le;return r(),ee(pe,{open:S.visible,onCancel:F[0]||(F[0]=W=>a("update:visible",!1)),title:"API Call Details",width:1400,footer:null,"body-style":{padding:0,height:"85vh",display:"flex",flexDirection:"column"},centered:!0,"destroy-on-close":!0,class:"api-call-detail-modal"},{default:R(()=>[s("div",El,[s("div",Fl,[F[10]||(F[10]=s("h3",null,"Overview",-1)),s("div",Rl,[s("div",xl,[F[1]||(F[1]=s("label",null,"Call ID:",-1)),s("span",Pl,h(S.apiCall.id),1)]),s("div",Al,[F[2]||(F[2]=s("label",null,"Status:",-1)),k(P,{color:$(S.apiCall.status)},{default:R(()=>[O(h(S.apiCall.status.toUpperCase()),1)]),_:1},8,["color"])]),s("div",Vl,[F[3]||(F[3]=s("label",null,"Configuration:",-1)),s("span",null,h(D()),1)]),S.apiCall.repeatIndex!==void 0?(r(),f("div",Ol,[F[4]||(F[4]=s("label",null,"Repeat:",-1)),s("span",null,"#"+h(S.apiCall.repeatIndex+1),1)])):E("",!0),s("div",Dl,[F[5]||(F[5]=s("label",null,"Created:",-1)),s("span",null,h(C(S.apiCall.created)),1)]),S.apiCall.completed?(r(),f("div",Ll,[F[6]||(F[6]=s("label",null,"Completed:",-1)),s("span",null,h(C(S.apiCall.completed)),1)])):E("",!0),y.value?(r(),f("div",Nl,[F[7]||(F[7]=s("label",null,"Duration:",-1)),s("span",null,h(m(y.value)),1)])):E("",!0),S.apiCall.result?.latency?(r(),f("div",Ml,[F[8]||(F[8]=s("label",null,"API Latency:",-1)),s("span",null,h(S.apiCall.result.latency)+"ms",1)])):E("",!0)]),g.value?(r(),f("div",Ul,[F[9]||(F[9]=s("label",null,"Provider/Model:",-1)),s("span",zl,h(g.value),1)])):E("",!0)]),S.apiCall.variables&&Object.keys(S.apiCall.variables).length>0?(r(),f("div",Bl,[F[11]||(F[11]=s("h3",null,"Variables",-1)),s("div",Wl,[(r(!0),f(te,null,ne(S.apiCall.variables,(W,G)=>(r(),f("div",{key:G,class:"variable-group"},[s("div",jl,[s("label",Hl,h(G)+":",1),s("span",ql,h(W),1)]),S.apiCall.variableAttributes&&S.apiCall.variableAttributes[G]?(r(),f("div",Gl,[(r(!0),f(te,null,ne(S.apiCall.variableAttributes[G],(ie,Y)=>(r(),f("div",{key:Y,class:"attribute-item"},[s("label",Jl,h(Y)+":",1),s("span",Xl,h(ie),1)]))),128))])):E("",!0)]))),128))])])):E("",!0),s("div",Kl,[F[12]||(F[12]=s("h3",null,"Resolved Prompt",-1)),s("div",Zl,h(S.apiCall.prompt),1)]),S.apiCall.result?(r(),f("div",Yl,[F[36]||(F[36]=s("h3",null,"Response",-1)),S.apiCall.status==="failed"&&S.apiCall.result.error?(r(),f("div",Ql,[k(le,{type:"error",message:S.apiCall.result.error,description:S.apiCall.result.errorType?`Error Type: ${I(S.apiCall.result.errorType)}`:void 0,"show-icon":""},null,8,["message","description"])])):S.apiCall.result.content?(r(),f("div",ei,[s("div",ti,h(S.apiCall.result.content),1),S.apiCall.result.parsedContent!==void 0?(r(),f("div",si,[F[13]||(F[13]=s("h4",null,"Extracted Value (Original)",-1)),s("div",ai,h(N(S.apiCall.result.parsedContent)),1)])):E("",!0),S.apiCall.result.postParsedContent!==void 0?(r(),f("div",ni,[F[14]||(F[14]=s("h4",null,"Post-Processed Value",-1)),s("div",oi,h(N(S.apiCall.result.postParsedContent)),1)])):E("",!0),S.apiCall.result.refused?(r(),f("div",li,[k(le,{type:"warning",message:"Response flagged as refusal (Original Extraction)",description:"This response matched configured refusal patterns","show-icon":""})])):E("",!0),S.apiCall.result.postRefused?(r(),f("div",ii,[k(le,{type:"warning",message:"Response flagged as refusal (Post-Processing)",description:"This response matched post-processing refusal patterns","show-icon":""})])):E("",!0),s("div",ri,[F[22]||(F[22]=s("h4",null,"Original Extraction Configuration",-1)),s("div",ui,[_.value.parserId?(r(),f("div",di,[F[15]||(F[15]=s("label",null,"Parser ID:",-1)),s("span",ci,h(_.value.parserId),1)])):E("",!0),_.value.outputType?(r(),f("div",pi,[F[16]||(F[16]=s("label",null,"Output Type:",-1)),s("span",fi,h(_.value.outputType),1)])):E("",!0),_.value.extractPattern?(r(),f("div",mi,[F[17]||(F[17]=s("label",null,"Extract Pattern:",-1)),s("span",vi,h(_.value.extractPattern),1)])):E("",!0),_.value.refusalWords&&_.value.refusalWords.length>0?(r(),f("div",gi,[F[18]||(F[18]=s("label",null,"Refusal Words:",-1)),s("span",hi,h(_.value.refusalWords.join(", ")),1)])):E("",!0),_.value.refusalMode?(r(),f("div",yi,[F[19]||(F[19]=s("label",null,"Refusal Mode:",-1)),s("span",bi,h(_.value.refusalMode==="parse_anyway"?"Parse normally":"Replace with REFUSED"),1)])):_.value.rejectRefusalWords!==void 0?(r(),f("div",_i,[F[20]||(F[20]=s("label",null,"Reject on Refusal (Legacy):",-1)),s("span",Ti,h(_.value.rejectRefusalWords?"Yes":"No"),1)])):E("",!0),U.value?E("",!0):(r(),f("div",Ci,F[21]||(F[21]=[s("span",{class:"no-config-message"},"No extraction configuration set for this trial",-1)])))])]),L.value&&L.value.enabled?(r(),f("div",$i,[F[30]||(F[30]=s("h4",null,"Post-Processing Configuration",-1)),s("div",ki,[s("div",wi,[F[24]||(F[24]=s("label",null,"Status:",-1)),s("span",Si,[k(P,{color:"processing"},{default:R(()=>F[23]||(F[23]=[O("Enabled")])),_:1,__:[23]})])]),L.value.outputType?(r(),f("div",Ii,[F[25]||(F[25]=s("label",null,"Output Type:",-1)),s("span",Ei,h(L.value.outputType),1)])):E("",!0),L.value.extractPattern?(r(),f("div",Fi,[F[26]||(F[26]=s("label",null,"Extract Pattern:",-1)),s("span",Ri,h(L.value.extractPattern),1)])):E("",!0),L.value.refusalWords&&L.value.refusalWords.length>0?(r(),f("div",xi,[F[27]||(F[27]=s("label",null,"Refusal Words:",-1)),s("span",Pi,h(L.value.refusalWords.join(", ")),1)])):E("",!0),L.value.rejectRefusalWords!==void 0?(r(),f("div",Ai,[F[28]||(F[28]=s("label",null,"Reject on Refusal:",-1)),s("span",Vi,h(L.value.rejectRefusalWords?"Yes":"No"),1)])):E("",!0),L.value.updatedAt?(r(),f("div",Oi,[F[29]||(F[29]=s("label",null,"Last Updated:",-1)),s("span",Di,h(C(L.value.updatedAt)),1)])):E("",!0)])])):E("",!0),S.apiCall.result.usage?(r(),f("div",Li,[F[35]||(F[35]=s("h4",null,"Token Usage",-1)),s("div",Ni,[s("div",Mi,[F[31]||(F[31]=s("label",null,"Prompt Tokens:",-1)),s("span",null,h(S.apiCall.result.usage.prompt_tokens||0),1)]),s("div",Ui,[F[32]||(F[32]=s("label",null,"Completion Tokens:",-1)),s("span",null,h(S.apiCall.result.usage.completion_tokens||0),1)]),s("div",zi,[F[33]||(F[33]=s("label",null,"Total Tokens:",-1)),s("span",null,h(S.apiCall.result.usage.total_tokens||0),1)]),T.value?(r(),f("div",Bi,[F[34]||(F[34]=s("label",null,"Cost:",-1)),s("span",null,"$"+h(T.value.toFixed(4)),1)])):E("",!0)])])):E("",!0)])):E("",!0)])):E("",!0),k(ve,{ghost:""},{default:R(()=>[k(ye,{key:"raw",header:"Raw Data"},{default:R(()=>[s("div",Wi,[F[37]||(F[37]=s("h4",null,"HTTP Request",-1)),s("pre",ji,h(b.value),1),S.apiCall.response?(r(),f("h4",Hi,"Full API Response")):E("",!0),S.apiCall.response?(r(),f("pre",qi,h(V.value),1)):E("",!0),S.apiCall.result?(r(),f("h4",Gi,"Processed Result")):E("",!0),S.apiCall.result?(r(),f("pre",Ji,h(w.value),1)):E("",!0)])]),_:1})]),_:1})]),s("div",Xi,[S.allApiCalls&&u.value>1?(r(),f("div",Ki,[k(he,{onClick:q,disabled:!c.value,size:"large",class:"nav-button"},{default:R(()=>F[38]||(F[38]=[O(" â† Previous ")])),_:1,__:[38]},8,["disabled"]),s("span",Zi,h(n.value+1)+" of "+h(u.value),1),k(he,{onClick:Q,disabled:!p.value,size:"large",class:"nav-button"},{default:R(()=>F[39]||(F[39]=[O(" Next â†’ ")])),_:1,__:[39]},8,["disabled"])])):E("",!0),s("div",Yi,[k(he,{onClick:i,size:"large"},{default:R(()=>F[40]||(F[40]=[O(" Close ")])),_:1,__:[40]}),k(he,{type:"primary",onClick:K,size:"large"},{default:R(()=>[k(j(xt)),F[41]||(F[41]=O(" Copy Details "))]),_:1,__:[41]})])])]),_:1},8,["open"])}}}),Ts=ce(Qi,[["__scopeId","data-v-f7da98a4"]]),er={class:"post-processing-modal"},tr={key:2,class:"current-extraction"},sr={class:"parser-info"},ar={class:"parser-name"},nr={key:3,class:"current-post-processing"},or={class:"parser-info"},lr={class:"parser-name"},ir={key:4,class:"test-results"},rr={class:"footer-container"},ur={key:0,class:"footer-statistics"},dr={class:"stat-inline"},cr={class:"stat-inline"},pr={class:"stat-inline"},fr={class:"stat-inline"},mr={key:0,class:"stat-sample-note"},vr={key:1,class:"footer-progress"},gr={class:"processing-message"},hr={class:"footer-buttons"},yr=de({__name:"PostProcessingModalV2",props:{visible:{type:Boolean},trial:{}},emits:["close"],setup(l,{emit:e}){const t=l,a=e,o=ct(),n=va(),u=H(t.visible),c=H(!1),p=H(!1),d=H(!1),v=H(null),y=H({postParserId:null}),g=H(""),T=H(0),b=H([]),_=H(null),U=[{title:"Variables",dataIndex:"variables",key:"variables",width:200,customRender:({text:A})=>Object.entries(A).map(([K,S])=>`${K}: ${S}`).join(", ")},{title:"Original",dataIndex:"original",key:"original",slots:{customRender:"original"}},{title:"Post-Processed",dataIndex:"postProcessed",key:"postProcessed",slots:{customRender:"postProcessed"}},{title:"Changed",dataIndex:"changed",key:"changed",width:100,slots:{customRender:"changed"}}],L=M(()=>t.trial.parserId?n.parsers.find(A=>A.id===t.trial.parserId):null),V=M(()=>t.trial.postParserId?n.parsers.find(A=>A.id===t.trial.postParserId):null);function w(A){switch(A){case"regex":return"blue";case"javascript":return"orange";case"python":return"green";default:return"default"}}function $(A){return A===void 0?"(no match)":A===null?"null":typeof A=="string"&&A.length>50?A.substring(0,50)+"...":String(A)}function D(){p.value=!0}function C(A){v.value=A,d.value=!0}async function m(A,K){if(!A||!K){b.value=[],_.value=null;return}await N(K),await I(K)}async function N(A){const K=o.apiCalls.value.filter(F=>F.result?.content).slice(0,10),S=[];for(const F of K){const P=await Ot.executeParser(F.result.content,A);S.push({id:F.id,variables:F.variables,original:F.result.parsedContent,postProcessed:P.success?P.value:null,changed:P.success&&P.value!==F.result.parsedContent})}b.value=S}async function I(A){if(!o.apiCalls.value.length){_.value=null;return}const K=o.apiCalls.value,S=K.length,F=K.filter(W=>W.result?.content),P=F.length,le=Math.min(50,P),ye=F.slice(0,le);let ve=0,he=0;for(const W of ye){const G=await Ot.executeParser(W.result.content,A);G.success&&G.value!==void 0&&(ve++,G.value!==W.result.parsedContent&&he++)}const pe=le<P;if(pe&&le>0){const W=P/le;ve=Math.round(ve*W),he=Math.round(he*W)}_.value={total:S,withContent:P,matches:ve,changed:he,sampled:pe,sampleSize:le}}async function i(){c.value=!0,g.value="Clearing post-processing...";try{const A=await Mt.updatePostParserId(t.trial.id,null,!1);if(A.ok)y.value.postParserId=null,b.value=[],_.value=null,re.success("Post-processing cleared"),await o.refreshFromDatabase(t.trial.id);else throw A.error}catch(A){x.error("Failed to clear post-processing:",A),re.error("Failed to clear post-processing")}finally{c.value=!1,g.value=""}}async function q(){if(!y.value.postParserId){re.warning("Please select a parser");return}c.value=!0,T.value=0;try{const A=o.apiCalls.value.filter(P=>P.status==="completed"&&P.result?.content),K=A.length>0;let S=!1;if(K){const ye=(n.parsers.find(ve=>ve.id===y.value.postParserId)?.type||"parser")==="python"?`Apply post-processing to ${A.length} existing calls?

Note: Python parsers may take several minutes for large trials.`:`Apply post-processing to ${A.length} existing calls?`;S=confirm(ye)}S?(g.value=`Applying to ${A.length} calls...`,T.value=10):(g.value="Saving configuration...",T.value=50);const F=await Mt.updatePostParserId(t.trial.id,y.value.postParserId,S);if(F.ok)T.value=90,g.value="Refreshing data...",await o.refreshFromDatabase(t.trial.id),T.value=100,g.value="Complete!",re.success(S?`Post-processing applied to ${A.length} calls`:"Post-processing configured for future calls"),c.value=!1,setTimeout(()=>{Q()},1e3);else throw F.error}catch(A){x.error("Failed to apply post-processing:",A),re.error("Failed to apply post-processing"),c.value=!1,g.value="",T.value=0}}function Q(){c.value||a("close")}return Ie(async()=>{if(await n.initialize(),t.trial.postParserId){y.value.postParserId=t.trial.postParserId;const A=n.parsers.find(K=>K.id===t.trial.postParserId);A&&(await N(A),await I(A))}else t.trial.postProcessingConfig?.enabled&&re.info("Legacy post-processing config detected. Please select a parser to continue.")}),ue(()=>t.visible,A=>{u.value=A}),ue(u,A=>{!A&&!c.value&&a("close")}),(A,K)=>{const S=ut,F=rt,P=ia,le=ra,ye=ua,ve=Ee,he=Le;return r(),ee(he,{visible:u.value,"onUpdate:visible":K[1]||(K[1]=pe=>u.value=pe),title:"Post-Process Extraction",width:"80%","mask-closable":!c.value,closable:!c.value,onCancel:Q},{footer:R(()=>[s("div",rr,[_.value&&y.value.postParserId&&!c.value?(r(),f("div",ur,[s("span",dr,[K[5]||(K[5]=s("span",{class:"stat-label"},"Total:",-1)),K[6]||(K[6]=O()),s("strong",null,h(_.value.total),1)]),K[13]||(K[13]=s("span",{class:"stat-divider"},"|",-1)),s("span",cr,[K[7]||(K[7]=s("span",{class:"stat-label"},"With Content:",-1)),K[8]||(K[8]=O()),s("strong",null,h(_.value.withContent),1)]),K[14]||(K[14]=s("span",{class:"stat-divider"},"|",-1)),s("span",pr,[K[9]||(K[9]=s("span",{class:"stat-label"},"Est. Matches:",-1)),K[10]||(K[10]=O()),s("strong",null,h(_.value.matches),1)]),K[15]||(K[15]=s("span",{class:"stat-divider"},"|",-1)),s("span",fr,[K[11]||(K[11]=s("span",{class:"stat-label"},"Est. Changed:",-1)),K[12]||(K[12]=O()),s("strong",null,h(_.value.changed),1)]),_.value.sampled?(r(),f("span",mr," ("+h(_.value.sampleSize)+" samples) ",1)):E("",!0)])):E("",!0),c.value?(r(),f("div",vr,[s("div",gr,h(g.value),1),k(ye,{percent:T.value,status:T.value===100?"success":"active","stroke-width":4,style:{width:"100%"}},null,8,["percent","status"])])):E("",!0),s("div",hr,[V.value?(r(),ee(ve,{key:0,onClick:i,disabled:c.value,danger:""},{default:R(()=>K[16]||(K[16]=[O(" Clear Post-Processing ")])),_:1,__:[16]},8,["disabled"])):E("",!0),k(ve,{onClick:Q,disabled:c.value},{default:R(()=>[O(h(c.value?"Processing...":"Close"),1)]),_:1},8,["disabled"]),k(ve,{type:"primary",onClick:q,loading:c.value,disabled:!y.value.postParserId||y.value.postParserId===A.trial.postParserId},{default:R(()=>[O(h(c.value?g.value:"Apply Post-Processing"),1)]),_:1},8,["loading","disabled"])])])]),default:R(()=>[s("div",er,[A.trial.status==="running"?(r(),ee(S,{key:0,message:"Trial is currently running",description:"Post-processing will apply to all completed calls and future results as they arrive.",type:"info","show-icon":"",style:{"margin-bottom":"20px"}})):A.trial.status==="draft"?(r(),ee(S,{key:1,message:"Trial not started",description:"Configure post-processing now. It will apply when the trial runs.",type:"warning","show-icon":"",style:{"margin-bottom":"20px"}})):E("",!0),L.value?(r(),f("div",tr,[K[2]||(K[2]=s("h4",null,"Current Primary Parser",-1)),s("div",sr,[s("span",ar,h(L.value.name),1),k(F,{color:w(L.value.type)},{default:R(()=>[O(h(L.value.type),1)]),_:1},8,["color"]),k(F,null,{default:R(()=>[O(h(L.value.outputType),1)]),_:1})])])):E("",!0),V.value?(r(),f("div",nr,[K[3]||(K[3]=s("h4",null,"Active Post-Processing Parser",-1)),s("div",or,[s("span",lr,h(V.value.name),1),k(F,{color:w(V.value.type)},{default:R(()=>[O(h(V.value.type),1)]),_:1},8,["color"]),k(F,null,{default:R(()=>[O(h(V.value.outputType),1)]),_:1})])])):E("",!0),k(P,{label:V.value?"Change Post-Processing Parser":"Select Post-Processing Parser"},{default:R(()=>[k(ma,{modelValue:y.value.postParserId,"onUpdate:modelValue":K[0]||(K[0]=pe=>y.value.postParserId=pe),"allow-create":!0,"show-preview":!0,placeholder:"Select or create a parser for post-processing",onCreate:D,onTest:C,onChange:m},null,8,["modelValue"])]),_:1},8,["label"]),b.value.length>0&&y.value.postParserId?(r(),f("div",ir,[K[4]||(K[4]=s("h4",null,"Preview Results (First 10 calls)",-1)),k(le,{columns:U,"data-source":b.value,pagination:!1,size:"small",scroll:{x:800}},{original:R(({text:pe})=>[s("code",null,h($(pe)),1)]),postProcessed:R(({text:pe,record:W})=>[s("code",{class:ae({"value-changed":W.changed})},h($(pe)),3)]),changed:R(({text:pe})=>[k(F,{color:pe?"green":"default"},{default:R(()=>[O(h(pe?"Changed":"Same"),1)]),_:2},1032,["color"])]),_:1},8,["data-source"])])):E("",!0)])]),_:1},8,["visible","mask-closable","closable"])}}}),br=ce(yr,[["__scopeId","data-v-17edda1c"]]),_r={class:"table-container"},Tr={class:"virtual-header"},Cr={key:0,class:"col-status header-cell"},$r={key:1,class:"col-configuration header-cell"},kr={key:2,class:"col-repeat header-cell"},wr={key:3,class:"col-variables header-cell"},Sr={key:4,class:"col-response header-cell"},Ir={key:5,class:"col-parsed header-cell"},Er={key:6,class:"col-post-processed header-cell"},Fr={key:0,class:"post-process-indicator"},Rr={key:7,class:"col-length header-cell"},xr={key:8,class:"col-latency header-cell"},Pr=["onClick"],Ar={key:0,class:"col-status cell"},Vr={class:"status-cell"},Or={class:"status-time"},Dr={key:1,class:"col-configuration cell"},Lr={key:2,class:"col-repeat cell"},Nr={key:3,class:"col-variables cell"},Mr={class:"variable-tags"},Ur={key:0,class:"var-item"},zr={key:1,class:"var-item"},Br={key:2},Wr={key:3},jr={key:4,class:"col-response cell"},Hr={class:"response-content"},qr={key:5,class:"col-parsed cell"},Gr={class:"parsed-content"},Jr={key:6,class:"col-post-processed cell"},Xr={class:"parsed-content"},Kr={key:7,class:"col-length cell"},Zr={key:8,class:"col-latency cell"},Yr={key:0,class:"col-status"},Qr={key:1,class:"col-configuration"},eu={key:2,class:"col-repeat"},tu={key:3,class:"col-variables"},su={key:4,class:"col-response"},au={key:5,class:"col-parsed"},nu={key:6,class:"col-post-processed"},ou={key:0,class:"post-process-indicator"},lu={key:7,class:"col-length"},iu={key:8,class:"col-latency"},ru=["onClick"],uu={key:0,class:"col-status"},du={class:"status-cell"},cu={class:"status-time"},pu={key:1,class:"col-configuration"},fu={key:2,class:"col-repeat"},mu={key:3,class:"col-variables"},vu={class:"variable-tags"},gu={key:0,class:"var-item"},hu={key:1,class:"var-item"},yu={key:2},bu={key:3},_u={key:4,class:"col-response"},Tu={class:"response-content"},Cu={key:5,class:"col-parsed"},$u={class:"parsed-content"},ku={key:6,class:"col-post-processed"},wu={class:"parsed-content"},Su={key:7,class:"col-length"},Iu={key:8,class:"col-latency"},Eu={key:0},Fu=["colspan"],Ru={key:0},xu={key:1},jt="trial-results-visible-columns",Pu=de({__name:"TrialResultsTableV3",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(l){const e=l,t=H("all"),a=H([]),o=H(""),n=H(["status","configuration","variables","response","parsedResponse","length","latency"]),u=H(null),c=H(!1),p=H(!1),d=H(1),v=H(null),y=ct(),g=M(()=>y.apiCalls?.value||[]),T=M(()=>e.apiCalls||g.value);ue(T,(W,G)=>{const ie=performance.now();x.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 calls data changed from ${G?.length||0} to ${W.length} calls`),setTimeout(()=>{const Y=performance.now();x.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 reactive update completed in ${(Y-ie).toFixed(1)}ms`)},0)});const b=W=>{if(!o.value)return W;const G=o.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),ie=new RegExp(`(${G})`,"gi");return W.replace(ie,"<mark>$1</mark>")},_=M(()=>{const W=performance.now();if(!(t.value!=="all"||a.value.length>0||o.value))return performance.now()-W>5&&x.info(`V4_OPTIMIZE: No filtering needed, returning ${T.value.length} calls directly`),T.value;let ie=T.value.filter(ge=>{if(t.value!=="all"&&ge.status!==t.value||a.value.length>0&&!a.value.includes(String(ge.configurationIndex)))return!1;if(o.value){const $e=o.value.toLowerCase();if(!(ge.prompt?.toLowerCase().includes($e)||ge.result?.content?.toLowerCase().includes($e)||ge.result?.error?.toLowerCase().includes($e)))return!1}return!0});const Y=performance.now();return Y-W>10&&x.info(`V4_OPTIMIZE: Filtered ${T.value.length} â†’ ${ie.length} calls in ${(Y-W).toFixed(1)}ms`),ie});ue(_,(W,G)=>{const ie=performance.now();x.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls changed from ${G?.length||0} to ${W.length} items`),setTimeout(()=>{const Y=performance.now();x.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls render completed in ${(Y-ie).toFixed(1)}ms`)},0)});const U=M(()=>T.value),L=M(()=>T.value.length),V=M(()=>e.trial.configurations.some(W=>W.repeatCount>1)),w=M(()=>60);function $(W){}function D(W){const G=e.trial.configurations[W];return G?G.modelSnapshot?.displayName||`${G.modelId}`:`Config ${W+1}`}function C(W){return W.status==="pending"?"Waiting...":W.status==="running"?"Processing...":W.status==="failed"?W.result?.errorType==="refusal_detected"||W.result?.error==="REFUSED"?W.result?.content||"REFUSED":W.result?.error||"Error occurred":W.result?.content||""}function m(W){if(!W.result)return"";if(W.result.parsedContent!==void 0){const G=W.result.parsedContent;return G===null?"null":typeof G=="string"?G:typeof G=="number"||typeof G=="boolean"?String(G):JSON.stringify(G)}return""}function N(W){if(!W.result||W.result.postParsedContent===void 0)return"";const G=W.result.postParsedContent;return G===null?"null":G==="REFUSED"||W.result.postRefused?"REFUSED":typeof G=="string"?G:typeof G=="number"||typeof G=="boolean"?String(G):JSON.stringify(G)}function I(W){const G=W.result?.content||"";if(!G)return"";const ie=G.length;return ie>1e3?`${(ie/1e3).toFixed(1)}k chars`:`${ie} chars`}function i(W){return W?W<1e3?`${W}ms`:`${(W/1e3).toFixed(1)}s`:""}function q(W){return W.status==="completed"&&W.result?.refused?"REFUSED":W.status.toUpperCase()}function Q(W){return W.status==="completed"&&W.result?.refused?"status-refused":`status-${W.status}`}function A(W){let G;switch(W.status){case"completed":case"failed":G=W.completed;break;case"running":G=W.started;break;case"pending":case"cancelled":G=W.created;break}if(!G)return"";const ie=new Date(G),Y=ie.getHours().toString().padStart(2,"0"),ge=ie.getMinutes().toString().padStart(2,"0"),$e=ie.getSeconds().toString().padStart(2,"0");return`Â Â ${Y}:${ge}:${$e}`}function K(W){return W?W<1e3?"latency-fast":W<5e3?"latency-medium":"latency-slow":""}function S(W){return b(W)}function F(W){u.value=W}function P(W){u.value=W}function le(){document.fullscreenElement?document.exitFullscreen().then(()=>{p.value=!1}).catch(W=>{x.error("Failed to exit fullscreen:",W)}):v.value?.requestFullscreen().then(()=>{p.value=!0}).catch(W=>{x.error("Failed to enter fullscreen:",W)})}function ye(){d.value<2&&(d.value=Math.min(2,d.value+.1))}function ve(){d.value>.5&&(d.value=Math.max(.5,d.value-.1))}function he(){d.value=1}function pe(){p.value=!!document.fullscreenElement}return ue(n,W=>{localStorage.setItem(jt,JSON.stringify(W))},{deep:!0}),Ie(()=>{document.addEventListener("fullscreenchange",pe);const W=performance.now();x.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 MOUNTED with ${T.value.length} calls`);const G=localStorage.getItem(jt);if(G)try{n.value=JSON.parse(G)}catch{}Me(()=>{const ie=performance.now();x.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 DOM ready in ${(ie-W).toFixed(1)}ms`),setTimeout(()=>{const Y=performance.now();x.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 virtual scrolling ready in ${(Y-W).toFixed(1)}ms`)},100)}),setTimeout(()=>{const ie=performance.now();x.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 mount completed in ${(ie-W).toFixed(1)}ms`)},0)}),Ge(()=>{x.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 ACTIVATED (cache hit) with ${T.value.length} calls`)}),Je(()=>{x.info("V4_TRIAL_SWITCH: TrialResultsTableV3 DEACTIVATED (cached)")}),Ve(()=>{x.info("V4_TRIAL_SWITCH: TrialResultsTableV3 UNMOUNTED (evicted)"),document.removeEventListener("fullscreenchange",pe)}),(W,G)=>{const ie=es("dompurify-html");return r(),f("div",{class:ae(["trial-results-table",{fullscreen:p.value}]),ref_key:"tableContainer",ref:v},[k(Il,{"status-filter":t.value,"onUpdate:statusFilter":G[0]||(G[0]=Y=>t.value=Y),"config-filter":a.value,"onUpdate:configFilter":G[1]||(G[1]=Y=>a.value=Y),"search-query":o.value,"onUpdate:searchQuery":G[2]||(G[2]=Y=>o.value=Y),"visible-columns":n.value,"onUpdate:visibleColumns":G[3]||(G[3]=Y=>n.value=Y),configurations:W.trial.configurations,"api-calls":U.value,"show-repeat-column":V.value,"zoom-level":d.value,"is-fullscreen":p.value,onOpenPostProcessing:G[4]||(G[4]=Y=>c.value=!0),onToggleFullscreen:le,onZoomIn:ye,onZoomOut:ve,onResetZoom:he},null,8,["status-filter","config-filter","search-query","visible-columns","configurations","api-calls","show-repeat-column","zoom-level","is-fullscreen"]),s("div",_r,[L.value>100?(r(),ee(j(ft),{key:0,class:"results-scroller",items:Array.from(_.value),"item-size":w.value,"key-field":"id",buffer:10,onVisibleRange:$,style:fe({transform:`scale(${d.value})`,transformOrigin:"top left",width:`${100/d.value}%`})},{before:R(()=>[s("div",Tr,[n.value.includes("status")?(r(),f("div",Cr,"Status")):E("",!0),n.value.includes("configuration")?(r(),f("div",$r,"Configuration")):E("",!0),n.value.includes("repeat")&&V.value?(r(),f("div",kr,"Repeat")):E("",!0),n.value.includes("variables")?(r(),f("div",wr,"Variables")):E("",!0),n.value.includes("response")?(r(),f("div",Sr,"Response")):E("",!0),n.value.includes("parsedResponse")?(r(),f("div",Ir,"Parsed Response")):E("",!0),n.value.includes("postProcessedResponse")?(r(),f("div",Er,[G[7]||(G[7]=O(" Post-Processed ")),W.trial.postProcessingConfig?.enabled?(r(),f("span",Fr,"âœ¨")):E("",!0)])):E("",!0),n.value.includes("length")?(r(),f("div",Rr,"Length")):E("",!0),n.value.includes("latency")?(r(),f("div",xr,"Latency")):E("",!0)])]),default:R(({item:Y})=>[s("div",{class:ae(["result-row virtual-row",`status-${Y.status}`]),onClick:ge=>F(Y)},[n.value.includes("status")?(r(),f("div",Ar,[s("div",Vr,[s("span",{class:ae(["status-tag",Q(Y)])},h(q(Y)),3),s("span",Or,h(A(Y)),1)])])):E("",!0),n.value.includes("configuration")?(r(),f("div",Dr,h(D(Y.configurationIndex)),1)):E("",!0),n.value.includes("repeat")&&V.value?(r(),f("div",Lr," #"+h((Y.repeatIndex||0)+1),1)):E("",!0),n.value.includes("variables")?(r(),f("div",Nr,[s("div",Mr,[(r(!0),f(te,null,ne(Object.entries(Y.variables),([ge,$e],Fe)=>(r(),f(te,{key:ge},[G[9]||(G[9]=s("span",{class:"var-bullet"},"â€¢ ",-1)),Object.keys(Y.variables).length<=2?(r(),f("span",Ur,h(ge)+": "+h($e),1)):(r(),f("span",zr,h($e),1)),Object.keys(Y.variables).length===2&&Fe===0?(r(),f("span",Br,G[8]||(G[8]=[s("br",null,null,-1)]))):Fe<Object.keys(Y.variables).length-1?(r(),f("span",Wr,h("Â Â "))):E("",!0)],64))),128))])])):E("",!0),n.value.includes("response")?(r(),f("div",jr,[Be(s("div",Hr,null,512),[[ie,S(C(Y)),"apiResponse"]])])):E("",!0),n.value.includes("parsedResponse")?(r(),f("div",qr,[s("div",Gr,h(m(Y)),1)])):E("",!0),n.value.includes("postProcessedResponse")?(r(),f("div",Jr,[s("div",Xr,h(N(Y)),1)])):E("",!0),n.value.includes("length")?(r(),f("div",Kr,h(I(Y)),1)):E("",!0),n.value.includes("latency")?(r(),f("div",Zr,[s("span",{class:ae(K(Y.response?.latencyMs))},h(i(Y.response?.latencyMs)),3)])):E("",!0)],10,Pr)]),_:1},8,["items","item-size","style"])):(r(),f("table",{key:1,class:"results-table",style:fe({transform:`scale(${d.value})`,transformOrigin:"top left",width:`${100/d.value}%`})},[s("thead",null,[s("tr",null,[n.value.includes("status")?(r(),f("th",Yr,"Status")):E("",!0),n.value.includes("configuration")?(r(),f("th",Qr,"Configuration")):E("",!0),n.value.includes("repeat")&&V.value?(r(),f("th",eu,"Repeat")):E("",!0),n.value.includes("variables")?(r(),f("th",tu,"Variables")):E("",!0),n.value.includes("response")?(r(),f("th",su,"Response")):E("",!0),n.value.includes("parsedResponse")?(r(),f("th",au,"Parsed Response")):E("",!0),n.value.includes("postProcessedResponse")?(r(),f("th",nu,[G[10]||(G[10]=O(" Post-Processed ")),W.trial.postProcessingConfig?.enabled?(r(),f("span",ou,"âœ¨")):E("",!0)])):E("",!0),n.value.includes("length")?(r(),f("th",lu,"Length")):E("",!0),n.value.includes("latency")?(r(),f("th",iu,"Latency")):E("",!0)])]),s("tbody",null,[(r(!0),f(te,null,ne(_.value,Y=>(r(),f("tr",{key:Y.id,class:ae(["result-row",`status-${Y.status}`]),onClick:ge=>F(Y)},[n.value.includes("status")?(r(),f("td",uu,[s("div",du,[s("span",{class:ae(["status-tag",Q(Y)])},h(q(Y)),3),s("span",cu,h(A(Y)),1)])])):E("",!0),n.value.includes("configuration")?(r(),f("td",pu,h(D(Y.configurationIndex)),1)):E("",!0),n.value.includes("repeat")&&V.value?(r(),f("td",fu," #"+h((Y.repeatIndex||0)+1),1)):E("",!0),n.value.includes("variables")?(r(),f("td",mu,[s("div",vu,[(r(!0),f(te,null,ne(Y.variables,(ge,$e,Fe)=>(r(),f(te,{key:$e},[G[12]||(G[12]=s("span",{class:"var-bullet"},"â€¢ ",-1)),Object.keys(Y.variables).length<=2?(r(),f("span",gu,h($e)+": "+h(ge),1)):(r(),f("span",hu,h(ge),1)),Object.keys(Y.variables).length===2&&Fe===0?(r(),f("span",yu,G[11]||(G[11]=[s("br",null,null,-1)]))):Fe<Object.keys(Y.variables).length-1?(r(),f("span",bu,h("Â Â "))):E("",!0)],64))),128))])])):E("",!0),n.value.includes("response")?(r(),f("td",_u,[Be(s("div",Tu,null,512),[[ie,S(C(Y)),"apiResponse"]])])):E("",!0),n.value.includes("parsedResponse")?(r(),f("td",Cu,[s("div",$u,h(m(Y)),1)])):E("",!0),n.value.includes("postProcessedResponse")?(r(),f("td",ku,[s("div",wu,h(N(Y)),1)])):E("",!0),n.value.includes("length")?(r(),f("td",Su,h(I(Y)),1)):E("",!0),n.value.includes("latency")?(r(),f("td",Iu,[s("span",{class:ae(K(Y.response?.latencyMs))},h(i(Y.response?.latencyMs)),3)])):E("",!0)],10,ru))),128)),_.value.length===0?(r(),f("tr",Eu,[s("td",{colspan:n.value.length,class:"empty-state"},[g.value.length===0?(r(),f("div",Ru," No API calls yet. Start the trial to begin execution. ")):(r(),f("div",xu," No results match your filters. "))],8,Fu)])):E("",!0)])],4))]),u.value?(r(),ee(Ts,{key:0,visible:!!u.value,"api-call":u.value,trial:W.trial,"all-api-calls":U.value,"onUpdate:visible":G[5]||(G[5]=Y=>u.value=null),onNavigate:P},null,8,["visible","api-call","trial","all-api-calls"])):E("",!0),c.value?(r(),ee(br,{key:1,visible:c.value,trial:W.trial,onClose:G[6]||(G[6]=Y=>c.value=!1)},null,8,["visible","trial"])):E("",!0)],2)}}}),Au=ce(Pu,[["__scopeId","data-v-03ae2deb"]]),Vu={class:"trial-analysis-view"},Ou=de({__name:"TrialAnalysisView",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(l){const e=l;return Ie(()=>{const t=performance.now();x.info(`V4_TRIAL_SWITCH: TrialAnalysisView MOUNTED for trial ${e.trial.id}`),Me(()=>{const a=performance.now();x.info(`V4_TRIAL_SWITCH: TrialAnalysisView DOM ready in ${(a-t).toFixed(1)}ms`)}),setTimeout(()=>{const a=performance.now();x.info(`V4_TRIAL_SWITCH: TrialAnalysisView mount completed in ${(a-t).toFixed(1)}ms`)},0)}),Ge(()=>{x.info(`V4_TRIAL_SWITCH: TrialAnalysisView ACTIVATED (cache hit) for trial ${e.trial.id}`)}),Je(()=>{x.info(`V4_TRIAL_SWITCH: TrialAnalysisView DEACTIVATED (cached) for trial ${e.trial.id}`)}),Ve(()=>{x.info(`V4_TRIAL_SWITCH: TrialAnalysisView UNMOUNTED (evicted) for trial ${e.trial.id}`)}),(t,a)=>(r(),f("div",Vu,[k(Au,{trial:t.trial,progress:t.progress,"is-executing":t.isExecuting,"api-calls":t.apiCalls,"is-streaming":t.isStreaming,"is-loading":t.isLoading},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])]))}}),Du=ce(Ou,[["__scopeId","data-v-602f5d5a"]]);function Ht(l,e){const t=new Set,a=new Set,o=new Set;l.forEach(v=>{v.variables&&Object.keys(v.variables).forEach(y=>t.add(y)),v.variableAttributes&&Object.values(v.variableAttributes).forEach(y=>{y&&Object.keys(y).forEach(g=>a.add(g))})});const n=Array.from(t).sort(),u=Array.from(a).sort(),c=Array.from(o).sort(),p=[],d=["success","refused","parsed_response",...p,...c];return{categorical:[...n,...u,"model","status","error_type"],numeric:["response_time","total_tokens","prompt_tokens","completion_tokens",...p].sort(),extracted:d}}function $t(l,e,t){switch(e){case"model":return t&&l.configurationIndex<t.configurations.length&&t.configurations[l.configurationIndex].modelId||"Unknown";case"status":return l.status;case"response_time":return Ns(l.response?.latencyMs);case"total_tokens":if(l.response?.body?.usage){const a=l.response.body.usage;return a.total_tokens||Ls(a.prompt_tokens,a.completion_tokens)||et(null)}return et(null);case"prompt_tokens":return et(l.response?.body?.usage?.prompt_tokens||l.response?.body?.usage?.input_tokens);case"completion_tokens":return et(l.response?.body?.usage?.completion_tokens||l.response?.body?.usage?.output_tokens);case"error_type":return l.result?.errorType||(l.result?.success===!1?"api_error":"success");case"success":return l.result?.success?1:0;case"refused":return l.result?.refused?1:0;case"parsed_response":if(l.result?.parsedContent!==void 0){const a=l.result.parsedContent;return typeof a=="object"?JSON.stringify(a):a}return null}if(l.variables?.[e]!==void 0)return l.variables[e];if(l.variableAttributes)for(const a of Object.keys(l.variableAttributes)){const o=l.variableAttributes[a];if(o&&o[e]!==void 0)return o[e]}return null}const Xe={count:{label:"Count",calculate:l=>l.length,format:l=>l.toString(),needsNumeric:!1},sum:{label:"Sum",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0):null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},mean:{label:"Mean",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0)/e.length:null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},median:{label:"Median",calculate:l=>{const e=l.map(o=>typeof o=="number"?o:null).filter(o=>o!==null);if(e.length===0)return null;const t=[...e].sort((o,n)=>o-n),a=Math.floor(t.length/2);return t.length%2===0?(t[a-1]+t[a])/2:t[a]},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},mode:{label:"Mode",calculate:l=>{if(l.length===0)return null;const e=new Map;l.forEach(o=>e.set(o,(e.get(o)||0)+1));let t=0,a=null;return e.forEach((o,n)=>{o>t&&(t=o,a=n)}),{value:a,count:t,total:l.length}},format:l=>l?`${l.value} (${l.count}/${l.total})`:"-",needsNumeric:!1},variance:{label:"Variance",calculate:l=>{const e=l.map(o=>typeof o=="number"?o:null).filter(o=>o!==null);if(e.length<=1)return null;const t=e.reduce((o,n)=>o+n,0)/e.length;return e.reduce((o,n)=>o+Math.pow(n-t,2),0)/(e.length-1)},format:l=>l?.toFixed(3)||"-",needsNumeric:!0},std_dev:{label:"Std Dev",calculate:l=>{const e=Xe.variance.calculate(l);return e!==null?Math.sqrt(e):null},format:l=>l?.toFixed(3)||"-",needsNumeric:!0},min:{label:"Min",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.min(...e):null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},max:{label:"Max",calculate:l=>{const e=l.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.max(...e):null},format:l=>l?.toFixed(2)||"-",needsNumeric:!0},success_rate:{label:"Success Rate",calculate:(l,e)=>{const t=e.filter(a=>a.result?.success).length;return e.length>0?t/e.length:0},format:l=>`${Math.round(l*100)}%`,needsNumeric:!1,usesApiCalls:!0},refusal_rate:{label:"Refusal Rate",calculate:(l,e)=>{const t=e.filter(a=>a.result?.refused).length;return e.length>0?t/e.length:0},format:l=>`${Math.round(l*100)}%`,needsNumeric:!1,usesApiCalls:!0},avg_time:{label:"Avg Time (ms)",calculate:(l,e)=>{const t=e.filter(a=>a.response?.latencyMs).map(a=>a.response.latencyMs);return t.length>0?t.reduce((a,o)=>a+o,0)/t.length:null},format:l=>l?`${Math.round(l)}ms`:"-",needsNumeric:!1,usesApiCalls:!0},percent_non_numeric:{label:"% Non-Numeric",calculate:l=>l.length===0?0:l.filter(t=>!!(t==null||typeof t!="number"||Number.isNaN(t)||!Number.isFinite(t))).length/l.length*100,format:l=>`${Math.round(l)}%`,needsNumeric:!1}};function Lu(l,e,t){const a=performance.now(),o=new Map,n=new Set,u=new Set,c=new Map,p=(w,$)=>{c.has($)||c.set($,new Map);const D=c.get($);return D.has(w)||D.set(w,$t(w,$,t)),D.get(w)};for(const w of l){const $=String(p(w,e.rowField)||"Unknown"),D=String(p(w,e.columnField)||"Unknown");n.add($),u.add(D),o.has($)||o.set($,new Map);const C=o.get($);C.has(D)||C.set(D,[]),C.get(D).push(w)}const d=performance.now()-a;d>50&&`${l.length}${d.toFixed(1)}`;const v=w=>w.every(D=>!isNaN(Number(D))&&D.trim()!=="")?w.sort((D,C)=>Number(D)-Number(C)):w.sort(),y=(w,$)=>(t&&(t.type,t.type),v(w)),g=e.rowSort==="original"?y(Array.from(n),e.rowField):v(Array.from(n)),T=e.columnSort==="original"?y(Array.from(u),e.columnField):v(Array.from(u)),b=Xe[e.aggregation];function _(w,$=!1){const D=$?w.map(I=>p(I,e.valueField)):w.map(I=>$t(I,e.valueField,t));if(!b||typeof b.calculate!="function")return x.error("Invalid aggregation function:",e.aggregation,b),{value:null,count:w.length,apiCalls:w,rawValues:D,error:"Invalid aggregation function"};const C={nonNumeric:0,nullUndefined:0};return b.needsNumeric&&(C.nonNumeric=D.filter(I=>typeof I!="number").length),C.nullUndefined=D.filter(I=>I==null).length,{value:b.usesApiCalls?b.calculate(D,w):b.calculate(D),count:w.length,apiCalls:w,rawValues:D,excludedCounts:C}}const U=g.map(w=>{const $=[],D=[];return T.forEach(C=>{const m=o.get(w)?.get(C)||[];$.push(m.length>0?_(m,!0):null),D.push(...m)}),{label:w,cells:$,total:_(D,!0)}}),L=T.map(w=>{const $=[];return g.forEach(D=>{const C=o.get(D)?.get(w)||[];$.push(...C)}),_($,!0)}),V=performance.now()-a;return V>100&&`${V.toFixed(1)}${l.length}`,{rows:U,columns:T,totals:L,grandTotal:_(l,!0)}}function Ce(l,e){return!l||l.value===null?"-":Xe[e].format(l.value)}function Nu(l){if(!l||Object.keys(l).length===0)return"";const e=[];return l.temperature!==void 0&&e.push(`T:${l.temperature}`),l.max_tokens!==void 0?e.push(`${l.max_tokens}t`):l.maxTokens!==void 0?e.push(`${l.maxTokens}t`):l.num_predict!==void 0&&e.push(`${l.num_predict}t`),l.top_p!==void 0&&e.push(`p:${l.top_p}`),l.top_k!==void 0&&e.push(`k:${l.top_k}`),e.length>0?`(${e.join(", ")})`:""}function Mu(l,e,t,a=H({}),o={}){const n=H({rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}}),u=H({categorical:[],numeric:[],extracted:[]}),c=H(!1),p=H(0),d=H(!1),v=H(0),y=M(()=>{const L=a.value;return Object.values(L).some(w=>w!=="")?l.value.filter(w=>{if(L.model&&L.model!==""){if(!t.value||w.configurationIndex>=t.value.configurations.length)return!1;const $=t.value.configurations[w.configurationIndex],D=$.modelId||"Unknown",C=Nu($.parameters);if((C?`${D} ${C}`:D)!==L.model)return!1}if(L.status&&L.status!==""&&w.status!==L.status)return!1;for(const[$,D]of Object.entries(L))if(D&&D!==""&&$!=="model"&&$!=="status"&&w.variables?.[$]!==D)return!1;return!0}):l.value});let g=null;const T=L=>{g&&g.cancel();let V;switch(L){case"trial":V=0;break;case"tab":V=0;break;case"stream":V=100;break;case"config":V=300;break;default:V=100}g=Nt(()=>{if(y.value.length===0){n.value={rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}};return}c.value=!0;const w=performance.now();try{n.value=Lu(y.value,e.value,t.value);const $=performance.now()-w;p.value=$,x.debug(`Pivot computed from ${L}`,{apiCallCount:y.value.length,computeTimeMs:$,rowCount:n.value.rows.length,columnCount:n.value.columns.length,source:L})}catch($){x.error("Error computing pivot data",$)}finally{c.value=!1,(L==="tab"||L==="stream")&&(d.value=!1)}},V),g()},b=Nt(()=>{u.value=Ht(l.value,t.value)},200),_=typeof window<"u"?window.__trialDataStoreV4?.():null;ue([e],()=>{T("config")},{deep:!0}),ue(y,(L,V)=>{if(_&&_.activeTab?.value!=="pivot"){d.value=!0,v.value=L.length,`${L.length}`;return}const w=V?.length||0,$=L.length;d.value&&(d.value=!1),(w!==$||$>0)&&T("stream")},{immediate:!0}),_&&ue(()=>_.activeTab?.value,(L,V)=>{L==="pivot"&&V!=="pivot"&&d.value&&(`${v.value}`,T("tab"))});let U=null;return ue([l,t],([L,V])=>{const w=V?.id!==U;U=V?.id||null,w?(`${V?.id}`,u.value=Ht(L),T("trial")):(`${L.length}`,b())},{immediate:!0}),b(),{pivotData:M(()=>n.value),availableFields:M(()=>u.value),isComputing:M(()=>c.value),lastComputeTime:M(()=>p.value),formatCellValue:Ce,extractFieldValue:$t,aggregationFunctions:Xe}}class Uu{getMimeType(e){switch(e){case"csv":return"text/csv";case"excel":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"tsv":return"text/tab-separated-values";case"json":return"application/json";case"jsonl":return"application/x-jsonlines";case"python":return"text/x-python";case"zip":return"application/zip";default:return"application/octet-stream"}}getFileExtension(e){switch(e){case"csv":return"csv";case"excel":return"xlsx";case"tsv":return"tsv";case"json":return"json";case"jsonl":return"jsonl";case"python":return"py";case"zip":return"zip";default:return"bin"}}generateFilename(e,t,a){const o=this.sanitizeFilename(e),u=(a||new Date).toISOString().split("T")[0],c=this.getFileExtension(t);return`${o}_${t}_${u}.${c}`}estimateFileSize(e,t,a,o=50){let n=e*t*o;switch(a){case"json":n*=2.5;break;case"jsonl":n*=2.2;break;case"csv":n*=1.3;break;case"excel":n*=.8;break;case"tsv":n*=1.1;break;case"python":n=Math.max(n*1.5,5e3);break}return Math.round(n)}formatFileSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:`${(e/(1024*1024*1024)).toFixed(1)} GB`}createDownloadBlob(e,t,a=!1){let o=e;return a&&(o="\uFEFF"+o),new Blob([o],{type:t})}createDownloadBlobFromBase64(e,t){const a=atob(e),o=new Uint8Array(a.length);for(let n=0;n<a.length;n++)o[n]=a.charCodeAt(n);return new Blob([o],{type:t})}triggerDownload(e,t){const a=URL.createObjectURL(e),o=document.createElement("a");o.href=a,o.download=t,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(a),100)}downloadFile(e,t,a,o=!1){const n=this.getMimeType(t),u=this.generateFilename(a,t);let c;t==="excel"?c=this.createDownloadBlobFromBase64(e,n):c=this.createDownloadBlob(e,n,o),this.triggerDownload(c,u)}sanitizeFilename(e){return e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_+/g,"_").substring(0,50).replace(/^_+|_+$/g,"")||"trial"}}const Te=new Uu;let kt=null,wt=null,nt=!1;try{typeof window<"u"&&("__TAURI__"in window||"__TAURI_INTERNALS__"in window)&&(nt=!0)}catch{}async function zu(){if(!nt)return!1;try{return kt||(kt=await We(()=>import("./tauri-vendor-DRBsCdAf.js").then(l=>l.d),[])),wt||(wt=await We(()=>import("./tauri-vendor-DRBsCdAf.js").then(l=>l.f),[])),!0}catch(l){return x.warn("Failed to load Tauri modules:",l),nt=!1,!1}}class Cs{async downloadFile(e,t,a,o=!1){await this.useTauriSaveDialog(e,t,a,o)||this.useBrowserDownload(e,t,a,o)}async useTauriSaveDialog(e,t,a,o){if(!await zu())return!1;try{const n=Te.generateFilename(a,t),u=Te.getFileExtension(t),c=await kt.save({defaultPath:n,filters:[{name:this.getFilterName(t),extensions:[u]}],title:`Save ${this.getFilterName(t)} File`});if(!c)return!0;let p;if(typeof e=="string"){const d=o?"\uFEFF"+e:e;p=new TextEncoder().encode(d)}else p=e;return await wt.writeFile(c,p),`${c}`,!0}catch(n){return x.error("Tauri save dialog error:",n),!1}}useBrowserDownload(e,t,a,o){if(e instanceof Uint8Array&&(t==="zip"||t==="excel")){const y=Te.getMimeType(t),g=Te.generateFilename(a,t),T=new Blob([e],{type:y}),b=window.URL.createObjectURL(T),_=document.createElement("a");_.href=b,_.download=g,document.body.appendChild(_),_.click(),document.body.removeChild(_),window.URL.revokeObjectURL(b);return}e instanceof Uint8Array&&(e=new TextDecoder().decode(e));const n=Te.getMimeType(t),u=Te.generateFilename(a,t),c=o?"\uFEFF"+e:e,p=new Blob([c],{type:n}),d=window.URL.createObjectURL(p),v=document.createElement("a");v.href=d,v.download=u,document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(d)}async downloadExcelFile(e,t){const a=atob(e),o=new Uint8Array(a.length);for(let n=0;n<a.length;n++)o[n]=a.charCodeAt(n);await this.downloadFile(o,"excel",t,!1)}getFilterName(e){switch(e){case"csv":return"CSV";case"excel":return"Excel";case"tsv":return"TSV";case"json":return"JSON";case"jsonl":return"JSON Lines";case"python":return"Python Script";case"zip":return"ZIP Archive";default:return"Binary"}}isInTauri(){return nt}generateFilename(e,t,a){return Te.generateFilename(e,t,a)}getMimeType(e){return Te.getMimeType(e)}getFileExtension(e){return Te.getFileExtension(e)}estimateFileSize(e,t,a,o=50){return Te.estimateFileSize(e,t,a,o)}formatFileSize(e){return Te.formatFileSize(e)}}const qe=new Cs,Bu=Object.freeze(Object.defineProperty({__proto__:null,TauriDownloadUtilities:Cs,tauriDownloadUtilities:qe},Symbol.toStringTag,{value:"Module"}));async function Wu(l,e,t,a={}){if(!l||!l.rows.length||!l.columns.length)throw new Error("No data available to export");const{includeHeaders:o=!0,includeTotals:n=!0,addBOM:u=!0}=a,c=[];if(o){const g=[],T=ot(e.rowField)||"Row",b=ot(e.columnField)||"Column";g.push(De(`${T} / ${b}`)),l.columns.forEach(_=>{g.push(De(_))}),n&&e.columnField&&g.push(De("Total")),c.push(g.join(","))}if(l.rows.forEach(g=>{const T=[];if(T.push(De(g.label)),g.cells.forEach(b=>{const _=Ce(b,e.aggregation);T.push(De(_))}),n&&e.columnField&&g.total){const b=Ce(g.total,e.aggregation);T.push(De(b))}c.push(T.join(","))}),n&&e.rowField&&l.totals){const g=[];if(g.push(De("Total")),l.totals.forEach(T=>{const b=Ce(T,e.aggregation);g.push(De(b))}),e.columnField&&l.grandTotal){const T=Ce(l.grandTotal,e.aggregation);g.push(De(T))}c.push(g.join(","))}const p=c.join(`
`),v=`pivot_${e.rowField}_by_${e.columnField}_${e.aggregation}`.replace(/[^a-zA-Z0-9_-]/g,"_").substring(0,50),y=`${t}_${v}`;await qe.downloadFile(p,"csv",y,u)}function ot(l){return l?{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[l]||l.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()):""}function De(l){if(l==null)return"";const e=String(l);return e.includes(",")||e.includes('"')||e.includes(`
`)||e.includes("\r")?`"${e.replace(/"/g,'""')}"`:e}async function ju(l,e,t={}){if(!l||!l.rows.length||!l.columns.length)throw new Error("No data available to copy");const{includeHeaders:a=!0,includeTotals:o=!0}=t,n=[];if(a){const c=[],p=ot(e.rowField)||"Row",d=ot(e.columnField)||"Column";c.push(`${p} / ${d}`),l.columns.forEach(v=>{c.push(v)}),o&&e.columnField&&c.push("Total"),n.push(c.join("	"))}if(l.rows.forEach(c=>{const p=[];if(p.push(c.label),c.cells.forEach(d=>{const v=Ce(d,e.aggregation);p.push(v)}),o&&e.columnField&&c.total){const d=Ce(c.total,e.aggregation);p.push(d)}n.push(p.join("	"))}),o&&e.rowField&&l.totals){const c=[];if(c.push("Total"),l.totals.forEach(p=>{const d=Ce(p,e.aggregation);c.push(d)}),e.columnField&&l.grandTotal){const p=Ce(l.grandTotal,e.aggregation);c.push(p)}n.push(c.join("	"))}const u=n.join(`
`);try{await navigator.clipboard.writeText(u)}catch{const p=document.createElement("textarea");p.value=u,p.style.position="fixed",p.style.opacity="0",document.body.appendChild(p),p.select(),document.execCommand("copy"),document.body.removeChild(p)}}const Hu={class:"pivot-config-v3"},qu={class:"config-row"},Gu={class:"config-group"},Ju=["value","aria-label"],Xu={label:"Categorical"},Ku=["value"],Zu={class:"config-group sort-group"},Yu=["value","aria-label"],Qu={class:"config-group"},ed=["value","aria-label"],td={label:"Categorical"},sd=["value"],ad={class:"config-group sort-group"},nd=["value","aria-label"],od={class:"config-group"},ld=["value","aria-label"],id={label:"Extracted Values"},rd=["value"],ud={label:"Numeric Fields"},dd=["value"],cd={class:"config-group"},pd=["value","aria-label"],fd=de({__name:"PivotConfigurationV3",props:{config:{},availableFields:{}},emits:["update-config"],setup(l,{emit:e}){const t=e;function a(n,u){t("update-config",n,u)}function o(n){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[n]||n.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase())}return(n,u)=>(r(),f("div",Hu,[s("div",qu,[s("div",Gu,[u[6]||(u[6]=s("label",{for:"pivot-row-field"},"Rows (Group by):",-1)),s("select",{id:"pivot-row-field",value:n.config.rowField,"aria-label":"Group rows by "+o(n.config.rowField),onChange:u[0]||(u[0]=c=>a("rowField",c.target.value))},[s("optgroup",Xu,[(r(!0),f(te,null,ne(n.availableFields.categorical,c=>(r(),f("option",{key:c,value:c},h(o(c)),9,Ku))),128))])],40,Ju)]),s("div",Zu,[u[8]||(u[8]=s("label",{for:"pivot-row-sort"},"Sort Rows:",-1)),s("select",{id:"pivot-row-sort",value:n.config.rowSort||"original","aria-label":"Sort rows by "+(n.config.rowSort||"original")+" order",onChange:u[1]||(u[1]=c=>a("rowSort",c.target.value))},u[7]||(u[7]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,Yu)]),s("div",Qu,[u[9]||(u[9]=s("label",{for:"pivot-column-field"},"Columns (Group by):",-1)),s("select",{id:"pivot-column-field",value:n.config.columnField,"aria-label":"Group columns by "+o(n.config.columnField),onChange:u[2]||(u[2]=c=>a("columnField",c.target.value))},[s("optgroup",td,[(r(!0),f(te,null,ne(n.availableFields.categorical,c=>(r(),f("option",{key:c,value:c},h(o(c)),9,sd))),128))])],40,ed)]),s("div",ad,[u[11]||(u[11]=s("label",{for:"pivot-column-sort"},"Sort Columns:",-1)),s("select",{id:"pivot-column-sort",value:n.config.columnSort||"original","aria-label":"Sort columns by "+(n.config.columnSort||"original")+" order",onChange:u[3]||(u[3]=c=>a("columnSort",c.target.value))},u[10]||(u[10]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,nd)]),s("div",od,[u[12]||(u[12]=s("label",{for:"pivot-value-field"},"Values (Aggregate):",-1)),s("select",{id:"pivot-value-field",value:n.config.valueField,"aria-label":"Aggregate "+n.config.valueField+" values",onChange:u[4]||(u[4]=c=>a("valueField",c.target.value))},[s("optgroup",id,[(r(!0),f(te,null,ne(n.availableFields.extracted,c=>(r(),f("option",{key:c,value:c},h(c),9,rd))),128))]),s("optgroup",ud,[(r(!0),f(te,null,ne(n.availableFields.numeric,c=>(r(),f("option",{key:c,value:c},h(o(c)),9,dd))),128))])],40,ld)]),s("div",cd,[u[14]||(u[14]=s("label",{for:"pivot-aggregation"},"Aggregation:",-1)),s("select",{id:"pivot-aggregation",value:n.config.aggregation,"aria-label":"Aggregation method: "+n.config.aggregation,onChange:u[5]||(u[5]=c=>a("aggregation",c.target.value))},u[13]||(u[13]=[ts('<optgroup label="Statistical" data-v-2f1516e5><option value="mean" data-v-2f1516e5>Mean</option><option value="median" data-v-2f1516e5>Median</option><option value="variance" data-v-2f1516e5>Variance</option><option value="std_dev" data-v-2f1516e5>Std Dev</option><option value="min" data-v-2f1516e5>Min</option><option value="max" data-v-2f1516e5>Max</option><option value="sum" data-v-2f1516e5>Sum</option></optgroup><optgroup label="Frequency" data-v-2f1516e5><option value="count" data-v-2f1516e5>Count</option><option value="mode" data-v-2f1516e5>Mode</option></optgroup><optgroup label="Data Quality" data-v-2f1516e5><option value="percent_non_numeric" data-v-2f1516e5>% Non-Numeric</option></optgroup><optgroup label="Performance" data-v-2f1516e5><option value="success_rate" data-v-2f1516e5>Success Rate</option><option value="refusal_rate" data-v-2f1516e5>Refusal Rate</option><option value="avg_time" data-v-2f1516e5>Avg Time</option></optgroup>',4)]),40,pd)])])]))}}),md=ce(fd,[["__scopeId","data-v-2f1516e5"]]),vd={class:"heatmap-controls-v3"},gd={class:"control-row"},hd=["value","aria-label"],yd={class:"control-row"},bd=["value","aria-label"],_d=de({__name:"PivotHeatmapV3",props:{selectedColorScale:{},gradientMode:{}},emits:["update-color-scale","update-gradient-mode"],setup(l,{emit:e}){const t=e;function a(n){const u=n.target.value;t("update-color-scale",u)}function o(n){const u=n.target.value;t("update-gradient-mode",u)}return(n,u)=>(r(),f("div",vd,[s("div",gd,[u[1]||(u[1]=s("label",{for:"heatmap-color-scale",class:"control-label"},"Color Scale:",-1)),s("select",{id:"heatmap-color-scale",class:"color-scale-select",value:n.selectedColorScale,"aria-label":"Color scale: "+n.selectedColorScale,onChange:a},u[0]||(u[0]=[ts('<option value="blue-subtle" data-v-c3794a0d>Blue (Subtle)</option><option value="green-red" data-v-c3794a0d>Green-Red (Success)</option><option value="blue-yellow" data-v-c3794a0d>Blue-Yellow (Performance)</option><option value="purple-orange" data-v-c3794a0d>Purple-Orange (General)</option><option value="viridis" data-v-c3794a0d>Viridis</option><option value="inferno" data-v-c3794a0d>Inferno</option><option value="magma" data-v-c3794a0d>Magma</option><option value="plasma" data-v-c3794a0d>Plasma</option><option value="grayscale" data-v-c3794a0d>Grayscale</option>',9)]),40,hd)]),s("div",yd,[u[3]||(u[3]=s("label",{for:"gradient-mode",class:"control-label"},"Gradient Mode:",-1)),s("select",{id:"gradient-mode",class:"gradient-mode-select",value:n.gradientMode,"aria-label":"Gradient mode: "+n.gradientMode,onChange:o},u[2]||(u[2]=[s("option",{value:"global"},"Global",-1),s("option",{value:"column"},"Per Column",-1),s("option",{value:"row"},"Per Row",-1)]),40,bd)])]))}}),Td=ce(_d,[["__scopeId","data-v-c3794a0d"]]),Cd={class:"pivot-filters-v3"},$d={class:"filters-row"},kd={key:0,class:"filter-group"},wd=["value"],Sd=["value"],Id=["for"],Ed=["id","value","aria-label","onChange"],Fd={value:""},Rd=["value"],xd={key:1,class:"filter-group"},Pd=["value"],Ad=["value"],Vd=de({__name:"PivotFiltersV3",props:{apiCalls:{},trial:{},activeFilters:{}},emits:["update-filters","clear-filters"],setup(l,{emit:e}){const t=l,a=e,o=H({});let n=0;const u=()=>{if(t.apiCalls.length===0){o.value={};return}const g={};t.apiCalls.forEach(b=>{if(t.trial&&b.configurationIndex<t.trial.configurations.length){const _=t.trial.configurations[b.configurationIndex],U=_.modelId||"Unknown",L=d(_.parameters),V=L?`${U} ${L}`:U;g.model||(g.model=new Set),g.model.add(V)}b.status&&(g.status||(g.status=new Set),g.status.add(b.status)),b.variables&&Object.entries(b.variables).forEach(([_,U])=>{U&&String(U).trim()&&(g[_]||(g[_]=new Set),g[_].add(String(U)))})});const T={};Object.entries(g).forEach(([b,_])=>{T[b]=Array.from(_).sort()}),o.value=T};ue(()=>t.apiCalls.length,g=>{(g===0||n===0||g-n>=5)&&(u(),n=g)},{immediate:!0});const c=M(()=>{const{model:g,status:T,...b}=o.value;return b}),p=M(()=>Object.values(t.activeFilters).some(g=>g!==""));function d(g){if(!g||Object.keys(g).length===0)return"";const T=[];return g.temperature!==void 0&&T.push(`T:${g.temperature}`),g.max_tokens!==void 0?T.push(`${g.max_tokens}t`):g.maxTokens!==void 0?T.push(`${g.maxTokens}t`):g.num_predict!==void 0&&T.push(`${g.num_predict}t`),g.top_p!==void 0&&T.push(`p:${g.top_p}`),g.top_k!==void 0&&T.push(`k:${g.top_k}`),T.length>0?`(${T.join(", ")})`:""}function v(g){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",extracted_value:"Extracted Value"}[g]||g.replace(/_/g," ").replace(/\b\w/g,b=>b.toUpperCase())}function y(g,T){const b={...t.activeFilters};T===""?delete b[g]:b[g]=T,a("update-filters",b)}return(g,T)=>(r(),f("div",Cd,[s("div",$d,[o.value.model&&o.value.model.length>1?(r(),f("div",kd,[T[4]||(T[4]=s("label",{for:"filter-model",class:"filter-label"},"Model:",-1)),s("select",{id:"filter-model",value:g.activeFilters.model||"",class:"filter-select","aria-label":"Filter by model",onChange:T[0]||(T[0]=b=>y("model",b.target.value))},[T[3]||(T[3]=s("option",{value:""},"All Models",-1)),(r(!0),f(te,null,ne(o.value.model,b=>(r(),f("option",{key:b,value:b},h(b),9,Sd))),128))],40,wd)])):E("",!0),(r(!0),f(te,null,ne(c.value,(b,_)=>(r(),f("div",{key:_,class:"filter-group"},[s("label",{for:`filter-${_}`,class:"filter-label"},h(v(String(_)))+": ",9,Id),s("select",{id:`filter-${_}`,value:g.activeFilters[_]||"",class:"filter-select","aria-label":`Filter by ${v(String(_))}`,onChange:U=>y(String(_),U.target.value)},[s("option",Fd,"All "+h(v(String(_))),1),(r(!0),f(te,null,ne(b,U=>(r(),f("option",{key:U,value:U},h(U),9,Rd))),128))],40,Ed)]))),128)),o.value.status&&o.value.status.length>1?(r(),f("div",xd,[T[6]||(T[6]=s("label",{for:"filter-status",class:"filter-label"},"Status:",-1)),s("select",{id:"filter-status",value:g.activeFilters.status||"",class:"filter-select","aria-label":"Filter by status",onChange:T[1]||(T[1]=b=>y("status",b.target.value))},[T[5]||(T[5]=s("option",{value:""},"All Statuses",-1)),(r(!0),f(te,null,ne(o.value.status,b=>(r(),f("option",{key:b,value:b},h(b),9,Ad))),128))],40,Pd)])):E("",!0),p.value?(r(),f("button",{key:2,type:"button",class:"clear-filters-btn",title:"Clear all filters","aria-label":"Clear all filters",onClick:T[2]||(T[2]=b=>g.$emit("clear-filters"))}," Clear Filters ")):E("",!0)])]))}}),Od=ce(Vd,[["__scopeId","data-v-d5848163"]]),Dd={class:"options-header"},Ld={class:"header-left"},Nd={class:"header-buttons"},Md=["disabled"],Ud=["disabled"],zd={class:"header-controls"},Bd={class:"fit-toggles"},Wd=["title"],jd=["title"],Hd={class:"zoom-controls"},qd=["disabled"],Gd={class:"zoom-level"},Jd=["disabled"],Xd=["title","aria-label"],Kd={class:"options-content"},Zd={class:"controls-row"},Yd={key:0,class:"performance-info"},Qd={class:"table-view"},ec={key:0,class:"empty-state","data-testid":"empty-data-message"},tc={key:1,class:"error-state","data-testid":"invalid-aggregation-error"},sc={key:2,class:"loading-state","data-testid":"computing-state"},ac=["onMousedown"],nc={class:"header-resize-row"},oc=["colspan"],lc={class:"row-header",role:"rowheader"},ic=["data-testid","title","aria-label","role","onClick","onKeydown"],rc={key:0,class:"cell-content"},uc=["title"],dc={class:"cell-value"},cc={class:"error-message"},pc={key:1},fc=80,qt=150,mc=32,Gt=.5,Jt=2,Xt=.1,vc=de({__name:"PivotTableV3",props:{apiCalls:{},trial:{default:null},config:{},maxTableRows:{default:1e4},showTotals:{type:Boolean,default:!0},showPerformanceInfo:{type:Boolean,default:!1}},emits:["config-change","cell-click"],setup(l,{emit:e}){const t=l,a=e,o=H(!1),n=H("blue-yellow"),u=H("global"),c=H(!1),p=H("ðŸ“‹ Copy"),d=H({rowField:t.config?.rowField||"",columnField:t.config?.columnField||"",valueField:t.config?.valueField||"",aggregation:t.config?.aggregation||"mean",rowSort:t.config?.rowSort||"original",columnSort:t.config?.columnSort||"original"}),v=H({}),y=H(null),g=H(45),T=H(null),b=H("scroll"),_=H("scroll"),U=H(1),L=M(()=>b.value!=="fit"||!i.value.columns?"auto":`${100/(i.value.columns.length+1+(d.value.columnField&&t.showTotals?1:0))}%`),V=M(()=>{if(b.value!=="fit"||!i.value.columns)return 1;const z=i.value.columns.length;return z>20?.7:z>15?.8:z>10?.9:1}),w=M(()=>`${13*V.value*U.value}px`),$=M(()=>{const Z=g.value-16,se=Math.floor(Z/20);return Math.max(1,se)});ue(()=>t.config,z=>{z&&Object.assign(d.value,z)},{deep:!0}),ue(()=>t.trial?.id,(z,X)=>{z&&z!==X&&(x.info(`PIVOT_FIX: Trial changed from ${X} to ${z}, resetting configuration`),d.value={rowField:"",columnField:"",valueField:"",aggregation:"mean",rowSort:"original",columnSort:"original"},D.value={})});const D=H({}),C=ct(),m=M(()=>C.apiCalls?C.apiCalls.value||[]:t.apiCalls||[]),N=m,I=M(()=>t.trial),{pivotData:i,availableFields:q,isComputing:Q,lastComputeTime:A}=Mu(N,d,I,D,{});ue(i,(z,X)=>{const Z=performance.now(),se=z?.rows?.length||0;z?.columns&&$e();const me=z?.columns?.length||0;x.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData computed: ${se}x${me} matrix`),setTimeout(()=>{const Se=performance.now();x.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData render completed in ${(Se-Z).toFixed(1)}ms`)},0)}),ue(Q,z=>{z?x.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING STARTED with ${m.value.length} API calls`):x.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING FINISHED in ${A.value.toFixed(1)}ms`)}),ue(m,(z,X)=>{const Z=performance.now();x.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls changed from ${X?.length||0} to ${z.length} calls`),setTimeout(()=>{const se=performance.now();x.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls prop update completed in ${(se-Z).toFixed(1)}ms`)},0)});const K=M(()=>i.value.rows.slice(0,t.maxTableRows)),S=M(()=>Object.values(D.value).some(X=>X!=="")?m.value.filter(X=>{if(D.value.model&&D.value.model!==""){if(!t.trial||X.configurationIndex>=t.trial.configurations.length)return!1;const Z=t.trial.configurations[X.configurationIndex],se=Z.modelId||"Unknown",me=ye(Z.parameters);if((me?`${se} ${me}`:se)!==D.value.model)return!1}if(D.value.status&&D.value.status!==""&&X.status!==D.value.status)return!1;for(const[Z,se]of Object.entries(D.value))if(se&&se!==""&&Z!=="model"&&Z!=="status"&&X.variables?.[Z]!==se)return!1;return!0}).length:m.value.length),{getCellStyle:F,getSummaryStyle:P,styleKey:le}=ba(i,n,u);function ye(z){if(!z||Object.keys(z).length===0)return"";const X=[];return z.temperature!==void 0&&X.push(`T:${z.temperature}`),z.max_tokens!==void 0?X.push(`${z.max_tokens}t`):z.maxTokens!==void 0?X.push(`${z.maxTokens}t`):z.num_predict!==void 0&&X.push(`${z.num_predict}t`),z.top_p!==void 0&&X.push(`p:${z.top_p}`),z.top_k!==void 0&&X.push(`k:${z.top_k}`),X.length>0?`(${X.join(", ")})`:""}function ve(z){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[z]||z.replace(/_/g," ").replace(/\b\w/g,Z=>Z.toUpperCase())}function he(z,X,Z){if(!Z)return`${z} Ã— ${X}: No data`;const se=Ce(Z,d.value.aggregation);let me=`${z} Ã— ${X}: ${se} (${Z.count} calls)`;if(Z.excludedCounts){const Se=[];Z.excludedCounts.nonNumeric>0&&Se.push(`${Z.excludedCounts.nonNumeric} non-numeric responses excluded`),Z.excludedCounts.nullUndefined>0&&Se.push(`${Z.excludedCounts.nullUndefined} null/empty responses`),Se.length>0&&(me+=` | ${Se.join(", ")}`)}return Z.error&&(me+=` - ERROR: ${Z.error}`),me}function pe(z,X,Z){if(!Z)return`${z} by ${X}: No data`;const se=Ce(Z,d.value.aggregation);return Z.error?`${z} by ${X}: ${se} with data integrity error: ${Z.error}`:`${z} by ${X}: ${se} from ${Z.count} API calls`}function W(z,X){(z==="rowField"||z==="columnField"||z==="valueField"||z==="aggregation"||z==="rowSort"||z==="columnSort")&&(d.value[z]=X),a("config-change",{...d.value})}function G(z){D.value={...z}}function ie(){D.value={}}function Y(z,X,Z){Z&&a("cell-click",{row:z,column:X,cell:Z})}function ge(){c.value=!c.value}function $e(){const z={};z.corner=200,i.value.columns.forEach(X=>{v.value[X]?z[X]=v.value[X]:z[X]=qt}),d.value.columnField&&t.showTotals&&(z.total=100),v.value=z}function Fe(z,X){X.preventDefault(),X.stopPropagation(),y.value={column:z,startX:X.pageX,startWidth:v.value[z]||qt},document.addEventListener("mousemove",Ze),document.addEventListener("mouseup",Ne),document.body.classList.add("resizing-column")}function Ze(z){if(!y.value)return;const X=z.pageX-y.value.startX,Z=Math.max(fc,y.value.startWidth+X);v.value[y.value.column]=Z}function Ne(){y.value=null,document.removeEventListener("mousemove",Ze),document.removeEventListener("mouseup",Ne),document.body.classList.remove("resizing-column")}function Ye(z){z.preventDefault(),z.stopPropagation(),T.value={startY:z.pageY,startHeight:g.value},document.addEventListener("mousemove",Qe),document.addEventListener("mouseup",B),document.body.classList.add("resizing-header")}function Qe(z){if(!T.value)return;const X=z.pageY-T.value.startY,Z=Math.max(mc,T.value.startHeight+X);g.value=Z}function B(){T.value=null,document.removeEventListener("mousemove",Qe),document.removeEventListener("mouseup",B),document.body.classList.remove("resizing-header")}function J(){U.value=Math.min(Jt,Math.round((U.value+Xt)*10)/10)}function oe(){U.value=Math.max(Gt,Math.round((U.value-Xt)*10)/10)}function xe(){U.value=1}function Re(){o.value=!o.value,o.value?document.body.style.overflow="hidden":document.body.style.overflow=""}async function be(){try{const z=t.trial?.name||"pivot_table";await Wu(i.value,d.value,z,{includeHeaders:!0,includeTotals:t.showTotals,addBOM:!0}),x.info("Pivot table exported successfully")}catch(z){x.error("Failed to export pivot table:",z),alert("Failed to export pivot table: "+z.message)}}async function Oe(){try{await ju(i.value,d.value,{includeHeaders:!0,includeTotals:t.showTotals}),p.value="âœ“ Copied!",x.info("Pivot table copied to clipboard"),setTimeout(()=>{p.value="ðŸ“‹ Copy"},2e3)}catch(z){x.error("Failed to copy pivot table:",z),p.value="âŒ Failed",setTimeout(()=>{p.value="ðŸ“‹ Copy"},2e3)}}return Ie(()=>{const z=performance.now();x.info(`V4_TRIAL_SWITCH: PivotTableV3 MOUNTED for trial ${t.trial?.id||"unknown"} with ${m.value.length} calls`),Me(()=>{const X=performance.now();x.info(`V4_TRIAL_SWITCH: PivotTableV3 DOM ready in ${(X-z).toFixed(1)}ms`)}),setTimeout(()=>{const X=performance.now();x.info(`V4_TRIAL_SWITCH: PivotTableV3 mount completed in ${(X-z).toFixed(1)}ms`)},0)}),Ge(()=>{x.info(`V4_TRIAL_SWITCH: PivotTableV3 ACTIVATED (cache hit) for trial ${t.trial?.id||"unknown"} with ${m.value.length} calls`)}),Je(()=>{x.info(`V4_TRIAL_SWITCH: PivotTableV3 DEACTIVATED (cached) for trial ${t.trial?.id||"unknown"}`)}),Ve(()=>{x.info(`V4_TRIAL_SWITCH: PivotTableV3 UNMOUNTED (evicted) for trial ${t.trial?.id||"unknown"}`),o.value&&(document.body.style.overflow=""),y.value&&Ne(),T.value&&B()}),ue([q,m],([z])=>{const X=!d.value.rowField&&!d.value.columnField&&!d.value.valueField;m.value.length>0&&X&&z.categorical.length>0&&(x.info("PIVOT_FIX: Auto-initializing empty config"),d.value.rowField=z.categorical.find(Z=>Z!=="model"&&Z!=="status"&&Z!=="error_type")||z.categorical[0]||"model",d.value.columnField="model",d.value.valueField="parsed_response",d.value.aggregation="mean",a("config-change",{...d.value}))},{immediate:!0}),(z,X)=>(r(),f("div",{class:ae(["pivot-table-v3",{fullscreen:o.value}])},[s("div",{class:ae(["pivot-options-container",{collapsed:c.value}])},[s("div",Dd,[s("div",Ld,[X[6]||(X[6]=s("span",{class:"options-title"},"Pivot Table Options",-1)),s("button",{type:"button",class:"collapse-btn",onClick:ge},h(c.value?"Expand":"Collapse"),1)]),s("div",Nd,[s("button",{type:"button",class:"copy-btn",disabled:!j(i)||j(i).rows.length===0,title:"Copy table to clipboard (paste into Excel/Sheets)",onClick:Pe(Oe,["stop"])},h(p.value),9,Md),s("button",{type:"button",class:"export-btn",disabled:!j(i)||j(i).rows.length===0,title:"Export pivot table to CSV",onClick:Pe(be,["stop"])}," â¬‡ Export CSV ",8,Ud)]),s("div",zd,[s("div",Bd,[s("button",{type:"button",class:ae(["fit-toggle-btn",{active:b.value==="fit"}]),title:b.value==="fit"?"Allow horizontal scroll":"Fit to width",onClick:X[0]||(X[0]=Pe(Z=>b.value=b.value==="fit"?"scroll":"fit",["stop"]))},h(b.value==="fit"?"â†” Fitted":"â†” Scroll"),11,Wd),s("button",{type:"button",class:ae(["fit-toggle-btn",{active:_.value==="fit"}]),title:_.value==="fit"?"Allow vertical scroll":"Fit to height",onClick:X[1]||(X[1]=Pe(Z=>_.value=_.value==="fit"?"scroll":"fit",["stop"]))},h(_.value==="fit"?"â†• Fitted":"â†• Scroll"),11,jd)]),s("div",Hd,[s("button",{type:"button",class:"zoom-btn",disabled:U.value<=Gt,title:"Zoom out",onClick:Pe(oe,["stop"])}," âˆ’ ",8,qd),s("span",Gd,h(Math.round(U.value*100))+"%",1),s("button",{type:"button",class:"zoom-btn",disabled:U.value>=Jt,title:"Zoom in",onClick:Pe(J,["stop"])}," + ",8,Jd),s("button",{type:"button",class:"zoom-btn reset",title:"Reset zoom",onClick:Pe(xe,["stop"])}," â†º ")]),s("button",{type:"button",class:"fullscreen-btn",title:o.value?"Exit Fullscreen":"Enter Fullscreen","aria-label":o.value?"Exit fullscreen mode":"Enter fullscreen mode",onClick:Pe(Re,["stop"])},h(o.value?"âŠŸ Exit Fullscreen":"âŠž Fullscreen"),9,Xd)])]),Be(s("div",Kd,[As([j(q),d.value],()=>(r(),f("div",null,[k(md,{config:d.value,"available-fields":j(q),onUpdateConfig:W},null,8,["config","available-fields"])])),X,2),s("div",Zd,[m.value.length>0?(r(),ee(Od,{key:0,"api-calls":m.value,trial:z.trial,"active-filters":D.value,onUpdateFilters:G,onClearFilters:ie},null,8,["api-calls","trial","active-filters"])):E("",!0),k(Td,{"selected-color-scale":n.value,"gradient-mode":u.value,onUpdateColorScale:X[3]||(X[3]=Z=>n.value=Z),onUpdateGradientMode:X[4]||(X[4]=Z=>u.value=Z)},null,8,["selected-color-scale","gradient-mode"])])],512),[[ss,!c.value]])],2),z.showPerformanceInfo?(r(),f("div",Yd,[s("span",null,"Computing: "+h(j(Q)?"Yes":"No"),1),s("span",null,"Last Compute: "+h(j(A).toFixed(1))+"ms",1),s("span",null,"API Calls: "+h(m.value.length),1),s("span",null,"Filtered: "+h(S.value),1)])):E("",!0),s("div",Qd,[m.value.length===0?(r(),f("div",ec,X[7]||(X[7]=[s("p",null,"No data available for pivot table analysis.",-1)]))):d.value.aggregation in j(Xe)?j(Q)?(r(),f("div",sc,X[9]||(X[9]=[s("p",null,"Computing pivot table...",-1)]))):(r(),f("div",{key:3,class:ae(["pivot-table-container",{"fit-horizontal":b.value==="fit","fit-vertical":_.value==="fit"}])},[s("table",{class:ae(["pivot-table-grid responsive-table resizable-table",{"fit-width":b.value==="fit"}]),style:fe({fontSize:w.value}),role:"table"},[s("colgroup",null,[s("col",{style:fe(b.value==="scroll"?{width:v.value.corner+"px"}:{width:L.value})},null,4),(r(!0),f(te,null,ne(j(i).columns,Z=>(r(),f("col",{key:"col-"+Z,style:fe(b.value==="scroll"?{width:v.value[Z]+"px"}:{width:L.value})},null,4))),128)),d.value.columnField&&z.showTotals?(r(),f("col",{key:0,style:fe(b.value==="scroll"?{width:v.value.total+"px"}:{width:L.value})},null,4)):E("",!0)]),s("thead",null,[s("tr",{role:"row",style:fe({height:g.value+"px"})},[s("th",{class:"corner-cell",role:"columnheader",style:fe({height:g.value+"px"})},[s("div",{class:"header-content",style:fe({"-webkit-line-clamp":$.value})},h(ve(d.value.rowField)||"Items")+" / "+h(ve(d.value.columnField)||"Aggregated"),5),b.value==="scroll"?(r(),f("div",{key:0,class:"resize-handle",onMousedown:X[5]||(X[5]=Z=>Fe("corner",Z))},null,32)):E("",!0)],4),(r(!0),f(te,null,ne(j(i).columns,Z=>(r(),f("th",{key:Z,class:"column-header",role:"columnheader",style:fe({height:g.value+"px"})},[s("div",{class:"header-content",style:fe({"-webkit-line-clamp":$.value})},h(Z),5),b.value==="scroll"?(r(),f("div",{key:0,class:"resize-handle",onMousedown:se=>Fe(Z,se)},null,40,ac)):E("",!0)],4))),128)),d.value.columnField&&z.showTotals?(r(),f("th",{key:0,class:"total-header",role:"columnheader",style:fe({height:g.value+"px"})},[s("div",{class:"header-content",style:fe({"-webkit-line-clamp":$.value})},"Total",4)],4)):E("",!0)],4),s("tr",nc,[s("td",{colspan:j(i).columns.length+1+(d.value.columnField&&z.showTotals?1:0)},[s("div",{class:"header-resize-handle",onMousedown:Ye},null,32)],8,oc)])]),s("tbody",null,[(r(!0),f(te,null,ne(K.value,Z=>(r(),f("tr",{key:`${Z.label}-${j(le)}`,class:"data-row",role:"row"},[s("td",lc,h(Z.label),1),(r(!0),f(te,null,ne(Z.cells,(se,me)=>(r(),f("td",{key:`${me}-${j(le)}`,class:ae(["data-cell",{"error-cell":se?.error}]),"data-testid":se?.error?"pivot-cell-error":"pivot-cell",style:fe(j(F)(se,Z.label,me)),title:he(Z.label,j(i).columns[me],se),"aria-label":pe(Z.label,j(i).columns[me],se),role:se?.error?"alert":"cell",tabindex:"0",onClick:Se=>Y(Z.label,j(i).columns[me],se),onKeydown:[ht(Se=>Y(Z.label,j(i).columns[me],se),["enter"]),ht(Pe(Se=>Y(Z.label,j(i).columns[me],se),["prevent"]),["space"])]},[se?.error?(r(),f("div",rc,[s("span",{class:"error-indicator",title:se.error},"âš ï¸",8,uc),s("span",dc,h(se?j(Ce)(se,d.value.aggregation):"-"),1),s("div",cc,h(se.error),1)])):(r(),f("span",pc,h(se?j(Ce)(se,d.value.aggregation):"-"),1))],46,ic))),128)),d.value.columnField&&z.showTotals?(r(),f("td",{key:0,class:"total-cell",style:fe(j(P)(Z.total)),role:"cell"},h(j(Ce)(Z.total,d.value.aggregation)),5)):E("",!0)]))),128)),d.value.rowField&&z.showTotals?(r(),f("tr",{key:`totals-${j(le)}`,class:"total-row",role:"row"},[X[10]||(X[10]=s("td",{class:"row-header",role:"rowheader"},"Total",-1)),(r(!0),f(te,null,ne(j(i).totals,(Z,se)=>(r(),f("td",{key:`total-${se}-${j(le)}`,class:"total-cell",style:fe(j(P)(Z)),role:"cell"},h(j(Ce)(Z,d.value.aggregation)),5))),128)),d.value.columnField?(r(),f("td",{key:0,class:"grand-total-cell",style:fe(j(P)(j(i).grandTotal)),role:"cell"},h(j(Ce)(j(i).grandTotal,d.value.aggregation)),5)):E("",!0)])):E("",!0)])],6)],2)):(r(),f("div",tc,[s("p",null,"Invalid aggregation function: "+h(d.value.aggregation),1),X[8]||(X[8]=s("p",null,"Please select a valid aggregation method.",-1))]))])],2))}}),gc=ce(vc,[["__scopeId","data-v-dfebd82a"]]),hc={class:"modal-content"},yc={class:"modal-header"},bc={class:"modal-title"},_c={class:"summary-row"},Tc={key:0},Cc={key:0,class:"filter-row"},$c=["onUpdate:modelValue","aria-label"],kc={value:""},wc=["value"],Sc={class:"table-container"},Ic={class:"api-calls-table"},Ec=["onClick"],Fc=["title"],Rc=["title"],xc=de({__name:"PivotCellDetailV3",props:{visible:{type:Boolean},row:{},column:{},apiCalls:{},trial:{},value:{}},emits:["close"],setup(l){const e=l,t=Vs({}),a=H(null),{formatSingleCost:o}=dt(),n=M(()=>{const m=new Set;return e.apiCalls.forEach(N=>{N.variables&&Object.keys(N.variables).forEach(I=>m.add(I)),N.attributedVariables&&Object.entries(N.attributedVariables).forEach(([I,i])=>{i&&typeof i=="object"&&Object.keys(i).forEach(q=>{m.add(`${I}.${q}`)})})}),Array.from(m).sort()}),u=M(()=>n.value.map(m=>({title:m,dataIndex:`var_${m}`,key:`var_${m}`,width:150}))),c=[{title:"Status",dataIndex:"status",key:"status",width:100},{title:"Model",dataIndex:"model",key:"model",width:150}],p=[{title:"Response",dataIndex:"response",key:"response",width:300},{title:"Parsed Content",dataIndex:"parsedContent",key:"parsedContent",width:150},{title:"Duration",dataIndex:"duration",key:"duration",width:100},{title:"Cost",dataIndex:"cost",key:"cost",width:100}],d=M(()=>[...c,...u.value,...p]),v=M(()=>`${e.row} Ã— ${e.column} - ${e.apiCalls.length} API Calls`),y=M(()=>e.apiCalls.map(m=>{const N={id:m.id,status:m.status,model:m.modelName||"-",response:m.result?.content||m.result?.error||"-",parsedContent:L(m.result?.parsedContent),duration:m.duration!==void 0?`${m.duration}ms`:"-",cost:m.cost!==void 0?m.cost:"-"};return n.value.forEach(I=>{if(I.includes(".")){const[i,q]=I.split("."),Q=m.attributedVariables?.[i]?.[q];N[`var_${I}`]=Q!==void 0?String(Q):"-"}else N[`var_${I}`]=m.variables?.[I]||"-"}),N})),g=M(()=>Object.values(t).some(m=>m!==void 0&&m!=="")),T=M(()=>g.value?y.value.filter(m=>Object.entries(t).every(([N,I])=>I?m[N]===I:!0)):y.value),b=M(()=>{const m=e.apiCalls.filter(N=>N.status==="completed").length;return Math.round(m/e.apiCalls.length*100)}),_=M(()=>{const m=e.apiCalls.filter(N=>N.duration).map(N=>N.duration);return m.length===0?0:Math.round(m.reduce((N,I)=>N+I,0)/m.length)}),U=M(()=>{const m=e.apiCalls.filter(N=>N.cost!==void 0).map(N=>N.cost);if(m.length!==0)return m.reduce((N,I)=>N+I,0)});function L(m){if(m==null)return"-";if(typeof m=="string")return m;if(typeof m=="number"||typeof m=="boolean")return String(m);if(typeof m=="object")try{return JSON.stringify(m,null,2).substring(0,100)}catch{return"[Object]"}return String(m)}function V(m){switch(m){case"completed":return"status-success";case"failed":return"status-error";case"pending":return"status-warning";case"running":return"status-processing";default:return"status-default"}}function w(m,N=200){if(!m)return"";if(m.length<=N)return m;const I=m.slice(0,100),i=m.slice(-100);return`${I} [...TRUNCATED...] ${i}`}function $(m){const N=new Set;return y.value.forEach(I=>{const i=I[m];i&&i!=="-"&&N.add(i)}),Array.from(N).sort()}function D(){Object.keys(t).forEach(m=>{delete t[m]})}function C(m){const N=e.apiCalls.find(I=>I.id===m.id);N&&(a.value=N)}return(m,N)=>(r(),f(te,null,[s("div",{class:ae(["pivot-cell-detail-modal-v3",{visible:m.visible}]),onClick:N[1]||(N[1]=Pe(I=>m.$emit("close"),["self"]))},[s("div",hc,[s("div",yc,[s("h3",bc,h(v.value),1),s("button",{type:"button",class:"close-btn","aria-label":"Close modal",onClick:N[0]||(N[0]=I=>m.$emit("close"))}," Ã— ")]),s("div",_c,[s("span",null,[N[3]||(N[3]=s("b",null,"Total:",-1)),O(" "+h(m.apiCalls.length),1)]),s("span",null,[N[4]||(N[4]=s("b",null,"Success Rate:",-1)),O(" "+h(b.value)+"%",1)]),s("span",null,[N[5]||(N[5]=s("b",null,"Avg Duration:",-1)),O(" "+h(_.value)+"ms",1)]),U.value!==void 0?(r(),f("span",Tc,[N[6]||(N[6]=s("b",null,"Total Cost:",-1)),O(" "+h(j(o)(U.value)),1)])):E("",!0)]),u.value.length>0?(r(),f("div",Cc,[(r(!0),f(te,null,ne(u.value,I=>(r(),f("div",{key:I.key,class:"variable-filter"},[Be(s("select",{"onUpdate:modelValue":i=>t[I.key]=i,"aria-label":`Filter ${I.title}`,class:"filter-select"},[s("option",kc,"All "+h(I.title),1),(r(!0),f(te,null,ne($(I.key),i=>(r(),f("option",{key:i,value:i},h(i),9,wc))),128))],8,$c),[[Os,t[I.key]]])]))),128)),g.value?(r(),f("button",{key:0,type:"button",class:"clear-filters-btn",onClick:D}," Clear Filters ")):E("",!0)])):E("",!0),s("div",Sc,[s("table",Ic,[s("thead",null,[s("tr",null,[(r(!0),f(te,null,ne(d.value,I=>(r(),f("th",{key:I.key,class:"table-header",style:fe({width:I.width?`${I.width}px`:"auto"})},h(I.title),5))),128))])]),s("tbody",null,[(r(!0),f(te,null,ne(T.value,I=>(r(),f("tr",{key:I.id,class:"table-row clickable-row",onClick:i=>C(I)},[(r(!0),f(te,null,ne(d.value,i=>(r(),f("td",{key:i.key,class:ae(["table-cell",{"status-cell":i.key==="status"}])},[i.key==="status"?(r(),f("span",{key:0,class:ae(["status-tag",V(I.status)])},h(I.status),3)):i.key==="response"?(r(),f("span",{key:1,class:"response-cell",title:I.response},h(w(I.response)),9,Fc)):i.key==="cost"?(r(),f(te,{key:2},[O(h(I.cost==="-"?"-":j(o)(I.cost)),1)],64)):i.key.startsWith("var_")?(r(),f("span",{key:3,class:"variable-cell",title:I[i.key]},h(I[i.key]||"-"),9,Rc)):(r(),f(te,{key:4},[O(h(I[i.key]||"-"),1)],64))],2))),128))],8,Ec))),128))])])])])],2),a.value?(r(),ee(Ts,{key:0,visible:!!a.value,"api-call":a.value,trial:m.trial,"onUpdate:visible":N[2]||(N[2]=I=>a.value=null)},null,8,["visible","api-call","trial"])):E("",!0)],64))}}),Pc=ce(xc,[["__scopeId","data-v-ddbda380"]]),Ac={class:"trial-tab-content"},Vc={class:"tab-pane-content"},Oc={class:"tab-pane-content"},Dc={key:0,class:"no-data-message"},Lc={class:"tab-pane-content"},Kt="trial-details-active-tab",Nc=de({__name:"TrialTabContentV3",props:{trial:{},progress:{},isLeader:{type:Boolean},executionState:{}},setup(l){const e=l,t=as(),a=it(),o=ct(),n=M(()=>o.apiCalls?.value||[]),u=M(()=>o.isStreaming?.value||!1);ue(n,(V,w)=>{const $=performance.now();x.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls changed from ${w?.length||0} to ${V.length} calls`),setTimeout(()=>{const D=performance.now();x.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls reactive update completed in ${(D-$).toFixed(1)}ms`)},0)});const c=M(()=>!1),d=H((()=>{const V=t.query.tab;return V==="status"?"details":V&&["details","tasks","pivot"].includes(V)?V:"tasks"})()),v=H(!1);ue(d,V=>{o.setActiveTab(V)},{immediate:!0});const y=H(!1),g=H({row:"",column:"",apiCalls:[],value:null}),T=M(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial.id),b=M(()=>e.trial.progress.completed>0);function _(){localStorage.setItem(Kt,d.value);const V={...t.query};V.tab=d.value,t.query.tab!==d.value&&(a.replace({query:V}),`${d.value}`)}function U(){const V=localStorage.getItem(Kt);V==="status"?d.value="details":V&&["details","tasks","pivot"].includes(V)&&(d.value=V)}function L(V){!V.cell||!V.cell.apiCalls.length||(g.value={row:V.row,column:V.column,apiCalls:V.cell.apiCalls,value:V.cell.value},y.value=!0)}return ue(d,()=>{_()}),ue(()=>t.query.tab,V=>{if(V&&typeof V=="string"){let w=V==="status"?"details":V;["details","tasks","pivot"].includes(w)&&d.value!==w&&(d.value=w)}}),Ie(()=>{const V=performance.now();if(x.info(`V4_TRIAL_SWITCH: TrialTabContentV3 MOUNTED for trial ${e.trial.id}`),!t.query.tab){const w={...t.query};w.tab=d.value,a.replace({query:w}),`${d.value}`}U(),setTimeout(()=>{const w=performance.now();x.info(`V4_TRIAL_SWITCH: TrialTabContentV3 mount completed in ${(w-V).toFixed(1)}ms`)},0)}),Ge(()=>{x.info(`V4_TRIAL_SWITCH: TrialTabContentV3 ACTIVATED (cache hit) for trial ${e.trial.id}`)}),Je(()=>{x.info(`V4_TRIAL_SWITCH: TrialTabContentV3 DEACTIVATED (cached) for trial ${e.trial.id}`)}),Ve(()=>{x.info(`V4_TRIAL_SWITCH: TrialTabContentV3 UNMOUNTED (evicted) for trial ${e.trial.id}`)}),(V,w)=>{const $=ca,D=da;return r(),f("div",Ac,[k(D,{activeKey:d.value,"onUpdate:activeKey":w[1]||(w[1]=C=>d.value=C),type:"card",class:"trial-tabs"},{default:R(()=>[k($,{key:"tasks",tab:"Task View"},{default:R(()=>[s("div",Vc,[(r(),ee(yt,null,[k(Du,{trial:V.trial,progress:V.progress,"is-executing":T.value,"api-calls":n.value,"is-streaming":u.value,"is-loading":c.value},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])],1024))])]),_:1}),k($,{key:"pivot",tab:"Pivot Table"},{default:R(()=>[s("div",Oc,[(r(),ee(yt,null,[b.value&&n.value.length>0?(r(),ee(gc,{key:0,"api-calls":n.value,trial:V.trial,"show-performance-info":!1,onCellClick:L},null,8,["api-calls","trial"])):E("",!0)],1024)),b.value&&n.value.length>0?E("",!0):(r(),f("div",Dc,w[3]||(w[3]=[s("p",null,"No completed API calls available for pivot analysis.",-1),s("p",null,"Run the trial to see pivot table data.",-1)])))])]),_:1}),k($,{key:"details",tab:"Details"},{default:R(()=>[s("div",Lc,[k(bl,{trial:V.trial,"is-collapsed":v.value,onToggleCollapse:w[0]||(w[0]=C=>v.value=!v.value)},null,8,["trial","is-collapsed"])])]),_:1})]),_:1},8,["activeKey"]),y.value?(r(),ee(Pc,{key:0,visible:y.value,row:g.value.row,column:g.value.column,"api-calls":g.value.apiCalls,trial:V.trial,value:g.value.value,onClose:w[2]||(w[2]=C=>y.value=!1)},null,8,["visible","row","column","api-calls","trial","value"])):E("",!0)])}}}),Mc=ce(Nc,[["__scopeId","data-v-743ec3c1"]]);class ke extends Error{constructor(t,a,o){super(a);Ue(this,"code");Ue(this,"details");this.name="ExportError",this.code=t,this.details=o}}function Zt(l){return typeof TextEncoder<"u"?new TextEncoder().encode(l).length:typeof Buffer<"u"?Buffer.byteLength(l,"utf8"):unescape(encodeURIComponent(l)).length}const _e=class _e{async loadTrialForExport(e){try{const t=this.getCachedData(e);if(t)return{ok:!0,value:t};const a=await je.trials.get(e);if(!a)return{ok:!1,error:new ke("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})};const o=await je.apiCalls.where("trialId").equals(e).toArray(),n={trial:a,apiCalls:o,fieldDefinitions:[],parameterFields:[],totalRecords:o.length};return this.setCachedData(e,n),{ok:!0,value:n}}catch(t){return{ok:!1,error:new ke("GENERATION_FAILED",`Failed to load trial data: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateTrialForExport(e){try{return await je.trials.get(e)?await je.apiCalls.where("trialId").equals(e).count()===0?{ok:!1,error:new ke("GENERATION_FAILED","Trial has no API calls to export",{trialId:e,apiCallCount:0})}:{ok:!0,value:!0}:{ok:!1,error:new ke("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})}}catch(t){return{ok:!1,error:new ke("GENERATION_FAILED",`Failed to validate trial: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async getApiCallCount(e){try{return await je.apiCalls.where("trialId").equals(e).count()}catch(t){return x.warn(`Failed to get API call count for trial ${e}:`,t),0}}clearCache(e){_e.cache.delete(e),_e.cacheExpiry.delete(e)}clearAllCache(){_e.cache.clear(),_e.cacheExpiry.clear()}getCachedData(e){const t=_e.cacheExpiry.get(e);return!t||Date.now()>t?(_e.cache.delete(e),_e.cacheExpiry.delete(e),null):_e.cache.get(e)||null}setCachedData(e,t){_e.cache.set(e,t),_e.cacheExpiry.set(e,Date.now()+_e.CACHE_TTL)}};Ue(_e,"cache",new Map),Ue(_e,"cacheExpiry",new Map),Ue(_e,"CACHE_TTL",6e4);let St=_e;const tt=new St;class Uc{discoverAllParameters(e){const t=new Map;return e.configurations.forEach((a,o)=>{!a.parameters||typeof a.parameters!="object"||Object.entries(a.parameters).forEach(([n,u])=>{const c=`param_${n}`;t.has(c)||t.set(c,{parameterName:n,fieldId:c,usedByConfigurations:[],dataType:this.inferDataType(u),sampleValues:[]});const p=t.get(c);p.usedByConfigurations.push(o),p.sampleValues.length<3&&!p.sampleValues.includes(u)&&p.sampleValues.push(u)})}),Array.from(t.values()).map(a=>this.createParameterFieldDefinition(a,e)).sort((a,o)=>a.id.localeCompare(o.id))}getParameterUsageStats(e){const t=this.discoverAllParameters(e),a={},o=[],n=[];e.configurations.forEach((c,p)=>{const d=c.provider;a[d]||(a[d]=[]),t.forEach(v=>{v.usedByConfigurations.includes(p)&&(a[d].includes(v.parameterName)||a[d].push(v.parameterName))})});const u=Object.keys(a);return t.forEach(c=>{u.filter(d=>a[d].includes(c.parameterName)).length>1?o.push(c.parameterName):n.push(c.parameterName)}),{totalUniqueParameters:t.length,parametersByProvider:a,sharedParameters:o.sort(),providerSpecificParameters:n.sort()}}validateParameterFields(e,t){const o=this.discoverAllParameters(e).map(p=>p.id),n=t.filter(p=>p.startsWith("param_")),u=[],c=[];return n.forEach(p=>{o.includes(p)?u.push(p):c.push(p)}),{validFields:u,invalidFields:c,availableFields:o}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}createParameterFieldDefinition(e,t){const a=e.usedByConfigurations.map(n=>t.configurations[n]?.provider||"unknown").filter((n,u,c)=>c.indexOf(n)===u).sort(),o=this.generateParameterDescription(e,a);return{id:e.fieldId,name:e.parameterName,description:o,group:"parameters",dataType:e.dataType,isRequired:!1,parameterName:e.parameterName,usedByConfigurations:e.usedByConfigurations}}generateParameterDescription(e,t){const a=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(n=>JSON.stringify(n)).join(", ")})`:"";return`${t.length===1?`Used by ${t[0]}`:`Used by ${t.join(", ")}`}${a}. Empty for configurations that don't use this parameter.`}}const lt=new Uc;class zc{discoverAllVariables(e,t){e.id,t.length;const a=new Map,o=new Map;t.forEach(v=>{v.variables&&typeof v.variables=="object"&&Object.entries(v.variables).forEach(([y,g])=>{const T=`var_${y}`;a.has(T)||a.set(T,{variableName:y,fieldId:T,usedByCallCount:0,dataType:this.inferDataType(g),sampleValues:[]});const b=a.get(T);b.usedByCallCount++,b.sampleValues.length<3&&!b.sampleValues.includes(g)&&b.sampleValues.push(g)}),v.variableAttributes&&typeof v.variableAttributes=="object"&&Object.entries(v.variableAttributes).forEach(([y,g])=>{!g||typeof g!="object"||Object.entries(g).forEach(([T,b])=>{const _=`attr_${y}_${T}`;o.has(_)||o.set(_,{attributeName:T,fieldId:_,usedByCallCount:0,dataType:this.inferDataType(b),sampleValues:[]});const U=o.get(_);U.usedByCallCount++,U.sampleValues.length<3&&!U.sampleValues.includes(b)&&U.sampleValues.push(b)})})});const n=Array.from(a.values()).map(v=>this.createVariableFieldDefinition(v,t.length)),u=Array.from(o.values()).map(v=>this.createAttributeFieldDefinition(v,t.length)),c=[];t.some(v=>v.variableIndices&&Object.keys(v.variableIndices).length>0)&&Array.from(a.values()).forEach(v=>{const y=v.variableName;c.push({id:`source_${y}_list`,name:`${y} Source List`,description:`Name of the list that provided the value for ${y}`,group:"source",dataType:"string",isRequired:!1}),c.push({id:`source_${y}_index`,name:`${y} Source Index`,description:`Position in the list (0-based) for ${y}`,group:"source",dataType:"number",isRequired:!1})});const d=[...n,...u,...c].sort((v,y)=>v.id.localeCompare(y.id));return n.length,u.length,c.length,d.length,n.map(v=>v.id),u.map(v=>v.id),d}getVariableUsageStats(e,t){const a=this.discoverAllVariables(e,t),o={};a.forEach(c=>{const p=c.name,d=this.getVariableInfo(p,t);o[p]=d.usedByCallCount});const n=Object.entries(o).sort(([,c],[,p])=>p-c).map(([c])=>c),u=t.filter(c=>c.variables&&typeof c.variables=="object"&&Object.keys(c.variables).length>0).length;return{totalUniqueVariables:a.length,variableUsageCounts:o,mostCommonVariables:n.slice(0,10),totalCallsWithVariables:u}}validateVariableFields(e,t,a){const n=this.discoverAllVariables(e,t).map(d=>d.id),u=a.filter(d=>d.startsWith("var_")),c=[],p=[];return u.forEach(d=>{n.includes(d)?c.push(d):p.push(d)}),{validFields:c,invalidFields:p,availableFields:n}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}getVariableInfo(e,t){let a=0;const o=[];return t.forEach(n=>{if(n.variables&&n.variables[e]!==void 0){a++;const u=n.variables[e];o.length<3&&!o.includes(u)&&o.push(u)}}),{attributeName:e,fieldId:`attr_${e}`,usedByCallCount:a,dataType:o.length>0?this.inferDataType(o[0]):"string",sampleValues:o}}createVariableFieldDefinition(e,t){const a=this.generateVariableDescription(e,t);return{id:e.fieldId,name:e.variableName,description:a,group:"content",dataType:e.dataType,isRequired:!1}}createAttributeFieldDefinition(e,t){const a=this.generateAttributeDescription(e,t),o=e.fieldId.replace("attr_","").split("_"),n=o[0],u=o.slice(1).join("_"),c=`${n} attr ${u}`;return{id:e.fieldId,name:c,description:a,group:"content",dataType:e.dataType,isRequired:!1}}generateVariableDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),o=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(n=>JSON.stringify(n)).join(", ")})`:"";return`Template variable used in ${e.usedByCallCount}/${t} calls (${a}%)${o}. Empty for calls that don't use this variable.`}generateAttributeDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),o=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(n=>JSON.stringify(n)).join(", ")})`:"";return`Variable attribute used in ${e.usedByCallCount}/${t} calls (${a}%)${o}. Empty for calls that don't use this attribute.`}}const $s=new zc;class Bc{isAuthField(e){return e==="request"}sanitizeFieldValue(e,t,a,o){return!t||t.length===0?t:(t.length,this.isAuthField(e),a.id,e==="request"?this.sanitizeRequestField(t,a,o):t)}sanitizeRequestField(e,t,a){try{const o=JSON.parse(e),n=this.getProviderIdForCall(t,a);if(!n)return t.id,this.sanitizeGenericRequest(e);t.id;const u=Ms(o,n);return JSON.stringify(u,null,2)}catch(o){return o instanceof Error?o.message:String(o),t.id,"[MALFORMED_REQUEST_JSON_REDACTED_FOR_SAFETY]"}}sanitizeGenericRequest(e){try{const t=JSON.parse(e);if(t.headers){const a={...t.headers},o=["authorization","api-key","x-api-key","bearer","x-auth-token"];for(const[n,u]of Object.entries(a)){const c=n.toLowerCase();o.some(p=>c.includes(p))&&(a[n]=`${String(u).substring(0,8)}...REDACTED`)}t.headers=a}return JSON.stringify(t,null,2)}catch(t){return t instanceof Error?t.message:String(t),"[REQUEST_JSON_PARSE_FAILED_REDACTED]"}}getProviderIdForCall(e,t){try{return t.configurations[e.configurationIndex]?.provider||null}catch(a){return a instanceof Error?a.message:String(a),e.id,null}}getFieldsRequiringSanitization(){return["request"]}createSanitizationSummary(e){const t=e.filter(a=>this.isAuthField(a));return{sanitizationEnabled:t.length>0,sanitizedFields:t}}}const Yt=new Bc;class Wc{extractFieldValue(e,t,a){if(t.startsWith("param_"))return this.extractParameterValue(e,t,a);if(t.startsWith("var_"))return e.id,e.variables,this.extractVariableValue(e,t);if(t.startsWith("attr_")){e.id,e.variableAttributes;const n=this.extractAttributeValue(e,t);return e.id,n}if(t.startsWith("source_"))return this.extractSourceValue(e,t,a);const o=this.extractRawFieldValue(e,t,a);return Yt.isAuthField(t)?(e.id,Yt.sanitizeFieldValue(t,o,e,a)):o}extractRawFieldValue(e,t,a){switch(t){case"id":return e.id;case"order":return String(e.order);case"status":return e.status;case"created":return e.created.toISOString();case"completed":return e.completed?.toISOString()||"";case"configuration":return this.getConfigurationName(e,a);case"provider":return a.configurations[e.configurationIndex]?.provider||"";case"modelId":return a.configurations[e.configurationIndex]?.modelId||"";case"parameters":return this.getParametersJson(e,a);case"prompt":return e.prompt;case"variables":return JSON.stringify(e.variables||{});case"response":return e.result?.content||"";case"parsedResponse":return JSON.stringify(e.result?.parsedContent||{});case"latency":return String(e.response?.latencyMs||e.result?.latency||"");case"promptTokens":return String(e.result?.usage?.prompt_tokens||"");case"completionTokens":return String(e.result?.usage?.completion_tokens||"");case"totalTokens":return String(e.result?.usage?.total_tokens||"");case"request":return JSON.stringify(e.request||{});case"response_raw":return JSON.stringify(e.response||{});case"error":return e.result?.error||"";case"repeatIndex":return String(e.repeatIndex||"");case"cost":return e.cost!==void 0?String(e.cost):this.calculateCost(e,a);case"refused":return String(e.result?.refused||!1);default:return`UNKNOWN_FIELD: ${t}`}}extractMultipleFields(e,t,a){const o={};return t.forEach(n=>{o[n]=this.extractFieldValue(e,n,a)}),o}getFieldDefinitions(e,t){const a=this.getStandardFieldDefinitions(),o=lt.discoverAllParameters(e),n=t?$s.discoverAllVariables(e,t):[];return[...a,...o,...n]}getStandardFieldDefinitions(){return[{id:"id",name:"Call ID",description:"Unique identifier for the API call",group:"basic",dataType:"string",isRequired:!0},{id:"order",name:"Order",description:"Execution order of the API call within the trial",group:"basic",dataType:"number",isRequired:!0},{id:"status",name:"Status",description:"Current status of the API call (pending, running, completed, failed, cancelled)",group:"basic",dataType:"string",isRequired:!0},{id:"created",name:"Created Time",description:"When the API call was created (ISO timestamp)",group:"basic",dataType:"date",isRequired:!0},{id:"completed",name:"Completed Time",description:"When the API call was completed (ISO timestamp, empty if not completed)",group:"basic",dataType:"date",isRequired:!1},{id:"configuration",name:"Configuration",description:"Configuration name or model ID used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"provider",name:"Provider",description:"LLM provider used (e.g., openai-chat, anthropic, ollama)",group:"configuration",dataType:"string",isRequired:!0},{id:"modelId",name:"Model ID",description:"Specific model identifier used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"prompt",name:"Prompt",description:"The input prompt sent to the model",group:"content",dataType:"string",isRequired:!0},{id:"response",name:"Response",description:"The text response from the model",group:"content",dataType:"string",isRequired:!1},{id:"parsedResponse",name:"Parsed Response",description:"Structured/parsed response data (JSON)",group:"content",dataType:"json",isRequired:!1},{id:"latency",name:"Latency (ms)",description:"Response time in milliseconds",group:"performance",dataType:"number",isRequired:!1},{id:"promptTokens",name:"Prompt Tokens",description:"Number of tokens in the input prompt",group:"performance",dataType:"number",isRequired:!1},{id:"completionTokens",name:"Completion Tokens",description:"Number of tokens in the model response",group:"performance",dataType:"number",isRequired:!1},{id:"totalTokens",name:"Total Tokens",description:"Total tokens used (prompt + completion)",group:"performance",dataType:"number",isRequired:!1},{id:"request",name:"Full Request",description:"Complete API request sent to the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"response_raw",name:"Raw Response",description:"Full API response from the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"error",name:"Error Details",description:"Error message if the call failed",group:"technical",dataType:"string",isRequired:!1},{id:"repeatIndex",name:"Repeat Index",description:"Index for repeated calls (empty for single calls)",group:"technical",dataType:"number",isRequired:!1},{id:"cost",name:"Cost (USD)",description:"Calculated cost of the API call based on token usage",group:"performance",dataType:"number",isRequired:!1},{id:"refused",name:"Refused",description:"Whether the model refused to respond (true/false)",group:"content",dataType:"boolean",isRequired:!1}]}validateFields(e,t){const o=this.getFieldDefinitions(e).map(c=>c.id),n=[],u=[];return t.forEach(c=>{o.includes(c)?n.push(c):u.push(c)}),{validFields:n,invalidFields:u,availableFields:o}}extractParameterValue(e,t,a){const o=t.replace("param_",""),n=a.configurations[e.configurationIndex];if(!n||!n.parameters)return"";const u=n.parameters[o];return u==null?"":typeof u=="object"?JSON.stringify(u):String(u)}getConfigurationName(e,t){const a=t.configurations[e.configurationIndex];return a?a.modelId||`Config ${e.configurationIndex+1}`:`Config ${e.configurationIndex+1}`}getParametersJson(e,t){const a=t.configurations[e.configurationIndex];return!a||!a.parameters?"{}":JSON.stringify(a.parameters)}extractVariableValue(e,t){const a=t.replace("var_","");if(!e.variables||typeof e.variables!="object")return"";const o=e.variables[a];return o==null?"":typeof o=="object"?JSON.stringify(o):String(o)}extractAttributeValue(e,t){const a=t.replace("attr_","").split("_");if(a.length<2)return"";const o=a[0],n=a.slice(1).join("_");if(!e.variableAttributes||typeof e.variableAttributes!="object")return"";const u=e.variableAttributes[o];if(!u||typeof u!="object")return"";const c=u[n];return c==null?"":typeof c=="object"?JSON.stringify(c):String(c)}extractSourceValue(e,t,a){const o=t.replace("source_","").split("_");if(o.length<2)return"";const n=o[o.length-1],u=o.slice(0,-1).join("_");if(!e.variableIndices||typeof e.variableIndices!="object")return"";const c=e.variableIndices[u];if(c==null)return"";if(n==="index")return String(c);if(n==="list"){if(a.type==="template"&&a.templateConfig?.variables){const p=a.templateConfig.variables[u];if(p&&"snapshot"in p&&p.snapshot?.source?.listName)return p.snapshot.source.listName;if(p?.listId)return p.listId}return""}return""}calculateCost(e,t){if(!e.result?.usage)return"0";const a=t.configurations[e.configurationIndex];if(!a)return"0";const o=a.modelSnapshot;if(!o)return"0";const n=e.result.usage.prompt_tokens,u=e.result.usage.completion_tokens,c=Dt(n,o.capabilities?.inputCostPerToken),p=Dt(u,o.capabilities?.outputCostPerToken);if(c===null||p===null)return"N/A";const d=c+p;return Us(d).replace("$","")}}const Ae=new Wc;class jc{validateFormat(e){const t=["csv","tsv","excel","json","jsonl","python"];return t.includes(e)?{isValid:!0,errors:[],warnings:[]}:{isValid:!1,errors:[`Invalid format: ${e}. Supported formats: ${t.join(", ")}`],warnings:[]}}validateFields(e,t,a){if(!t||t.length===0)return{isValid:!1,errors:["No fields selected for export"],warnings:[],unknownFields:[],supportedFields:Ae.getFieldDefinitions(e,a).map(d=>d.id)};const o=Ae.validateFields(e,t),n=o.invalidFields.filter(d=>!d.startsWith("var_")&&!d.startsWith("attr_")),u={isValid:n.length===0,errors:[],warnings:[],unknownFields:n,supportedFields:o.availableFields};n.length>0&&u.errors.push(`Unknown fields requested: ${n.join(", ")}`),(t.includes("request")||t.includes("response_raw"))&&u.warnings.push("Technical fields (request, response_raw) contain large JSON objects and may significantly increase file size");const c=t.filter(d=>d.startsWith("param_"));c.length>10&&u.warnings.push(`Large number of parameter fields selected (${c.length}). This may result in a very wide export file with many empty cells.`);const p=t.filter(d=>d.startsWith("var_"));return p.length>10&&u.warnings.push(`Large number of variable fields selected (${p.length}). This may result in a very wide export file with many empty cells.`),u}validateExportSize(e,t,a){const o=Te.estimateFileSize(e,t,a),n=o/(1024*1024),u={isValid:!0,errors:[],warnings:[]};return n>500?(u.isValid=!1,u.errors.push(`Export too large: ${Te.formatFileSize(o)}. Maximum allowed: 500MB. Consider reducing the number of fields or using filters.`)):n>100&&u.warnings.push(`Large export: ${Te.formatFileSize(o)}. This may take several minutes to generate and download.`),e>1e5&&u.warnings.push(`Large number of records: ${e.toLocaleString()}. Export generation may take several minutes.`),t>50&&u.warnings.push(`Large number of fields: ${t}. Resulting file will be very wide and may be difficult to work with in spreadsheet applications.`),u}validateExportOptions(e,t,a){const o=[],n=[],u=this.validateFormat(t.format);if(u.isValid||o.push(...u.errors),t.fields){const c=this.validateFields(e,t.fields,a);c.isValid||o.push(...c.errors),n.push(...c.warnings);const p=this.validateExportSize(e.progress?.total||0,t.fields.length,t.format);p.isValid||o.push(...p.errors),n.push(...p.warnings)}return t.format==="python"&&t.fields&&t.fields.length>0&&n.push("Field selection is ignored for Python exports. Python scripts include all available data."),{isValid:o.length===0,errors:o,warnings:n}}getRecommendedFields(e){const t=["order","status","configuration","prompt","response","latency"],a=Ae.getFieldDefinitions(e).filter(u=>u.group==="parameters").map(u=>u.id),o=["param_temperature","param_max_tokens","param_top_p"],n=a.filter(u=>o.includes(u));return[...t,...n]}}const gt=new jc;class Ke{validateOptions(e){const t=[],a=[];e.fields&&e.fields.length===0&&t.push("At least one field must be selected");const o=this.getFormatInfo();return e.includeHeaders&&!o.supportsHeaders&&a.push(`${o.name} format does not support headers - ignoring includeHeaders option`),e.addBOM&&!o.supportsBOM&&a.push(`${o.name} format does not support BOM - ignoring addBOM option`),{isValid:t.length===0,errors:t,warnings:a}}prepareFieldList(e,t){if(t&&t.length>0){const c=t.filter(y=>y.startsWith("var_")),p=t.filter(y=>y.startsWith("attr_")),d=t.filter(y=>!y.startsWith("var_")&&!y.startsWith("attr_")),v=Ae.validateFields(e,d);return v.invalidFields.length>0&&x.warn("Invalid fields requested:",v.invalidFields),[...v.validFields,...c,...p]}const a=["id","order","status","configuration","provider","modelId","prompt","response","refused","latency"],o=lt.discoverAllParameters(e),n=["param_temperature","param_max_tokens","param_top_p"],u=o.filter(c=>n.includes(c.id)).map(c=>c.id);return[...a,...u]}prepareDataRows(e,t,a){return e.map(o=>t.map(n=>Ae.extractFieldValue(o,n,a)))}prepareHeaderRow(e){return e.map(t=>t.startsWith("param_")?`param_${t.replace("param_","")}`:t.replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase()).trim())}hasParameterFields(e){return e.some(t=>t.startsWith("param_"))}escapeFieldValue(e){return e==null?"":String(e)}}class Hc extends Ke{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=[];if(a.includeHeaders!==!1){const d=this.prepareHeaderRow(o).map(v=>this.escapeCSVValue(v)).join(",");n.push(d)}this.prepareDataRows(e,o,t).forEach(p=>{const d=p.map(v=>this.escapeCSVValue(v)).join(",");n.push(d)});let c=n.join(`
`);return a.addBOM&&(c="\uFEFF"+c),c}getFormatInfo(){return{name:"CSV",description:"Comma-separated values format, compatible with Excel and other spreadsheet applications",mimeType:"text/csv",extension:"csv",supportsHeaders:!0,supportsBOM:!0}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];if(e.fields&&e.fields.length>30&&a.push("Large number of columns may make the CSV difficult to work with in spreadsheet applications"),e.fields){const o=["variables","parsedResponse","request","response_raw"];e.fields.some(u=>o.includes(u))&&a.push("JSON fields (variables, parsedResponse, request, response_raw) may not display well in spreadsheet applications")}return{...t,warnings:a}}escapeCSVValue(e){if(e==null)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes(`
`)||t.includes("\r")?`"${t.replace(/"/g,'""')}"`:t}}class qc extends Ke{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=[];if(a.includeHeaders!==!1){const p=this.prepareHeaderRow(o).map(d=>this.escapeTSVValue(d)).join("	");n.push(p)}return this.prepareDataRows(e,o,t).forEach(c=>{const p=c.map(d=>this.escapeTSVValue(d)).join("	");n.push(p)}),n.join(`
`)}getFormatInfo(){return{name:"TSV",description:"Tab-separated values format, useful for data analysis tools and database imports",mimeType:"text/tab-separated-values",extension:"tsv",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return a.push("TSV format may not be directly supported by all spreadsheet applications"),{...t,warnings:a}}escapeTSVValue(e){return e==null?"":String(e).replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}}class Gc extends Ke{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=mt.book_new(),u=[];if(a.includeHeaders!==!1){const y=this.prepareHeaderRow(o);u.push(y)}const c=this.prepareDataRows(e,o,t);u.push(...c);const p=mt.aoa_to_sheet(u),d=this.calculateColumnWidths(u);return p["!cols"]=d,mt.book_append_sheet(n,p,"Export Data"),_a(n,{type:"base64",bookType:"xlsx",compression:!0})}getFormatInfo(){return{name:"Excel",description:"Microsoft Excel .xlsx format with proper formatting and auto-sized columns",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",extension:"xlsx",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.fields&&e.fields.length>16384&&a.push("Excel has a limit of 16,384 columns - some fields may not display correctly"),e.addBOM&&a.push("Excel .xlsx format is binary - ignoring addBOM option"),a.push("Excel format provides native spreadsheet functionality with auto-sized columns"),{...t,warnings:a}}calculateColumnWidths(e){if(e.length===0)return[];const t=Math.max(...e.map(o=>o.length)),a=[];for(let o=0;o<t;o++){let n=10;for(const u of e)if(u[o]!==void 0){const c=String(u[o]).length;n=Math.max(n,Math.min(c*1.2,50))}a.push({wch:n})}return a}}class Jc extends Ke{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n={metadata:{trialId:t.id,trialName:t.name,trialType:t.type,exportDate:new Date().toISOString(),recordCount:e.length,fieldCount:o.length,hasParameterFields:this.hasParameterFields(o)},trial:{id:t.id,name:t.name,description:t.description,type:t.type,status:t.status,created:t.created.toISOString(),configurations:t.configurations.map((u,c)=>({index:c,provider:u.provider,modelId:u.modelId,parameters:u.parameters||{}}))},fields:o.map(u=>{const c=Ae.getFieldDefinitions(t).find(p=>p.id===u);return{id:u,name:c?.name||u,description:c?.description||"",group:c?.group||"unknown",dataType:c?.dataType||"string"}}),apiCalls:e.map(u=>{const c={};return o.forEach(p=>{const d=Ae.extractFieldValue(u,p,t);c[p]=this.parseJSONValue(d,p)}),c})};return JSON.stringify(n,null,2)}getFormatInfo(){return{name:"JSON",description:"JavaScript Object Notation format with complete trial metadata and structured data",mimeType:"application/json",extension:"json",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSON format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSON format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("Large number of fields in JSON format may result in large file sizes and memory usage"),{...t,warnings:a}}parseJSONValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const n=Number(e);return isNaN(n)?null:n}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const n=Number(e);if(!isNaN(n))return n;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return e}}class Xc extends Ke{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=[];return e.forEach(u=>{const c={};o.forEach(p=>{const d=Ae.extractFieldValue(u,p,t);c[p]=this.parseJSONLValue(d,p)}),n.push(JSON.stringify(c))}),n.join(`
`)}getFormatInfo(){return{name:"JSONL",description:"JSON Lines format with one JSON object per line, ideal for streaming and big data processing",mimeType:"application/x-jsonlines",extension:"jsonl",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSONL format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSONL format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("JSONL format handles large datasets well, but many fields may impact readability"),{...t,warnings:a}}parseJSONLValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const u=Number(e);return isNaN(u)?null:u}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const u=Number(e);if(!isNaN(u))return u;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return["created","completed"].includes(t),e}}function Kc(l){switch(l){case"csv":return new Hc;case"tsv":return new qc;case"excel":return new Gc;case"json":return new Jc;case"jsonl":return new Xc;default:throw new Error(`Unsupported format: ${l}`)}}class Zc{async exportTrialData(e,t){const a=Date.now();t.format;try{const o=await tt.loadTrialForExport(e);if(!o.ok){const b=o.error;return{ok:!1,error:new ke("GENERATION_FAILED",`Failed to load trial data: ${b.message}`,{trialId:e,originalError:b})}}const{trial:n,apiCalls:u}=o.value;t.format;const c=await this.validateExportOptions(e,t,u);if(!c.ok){const b=c.error;return{ok:!1,error:new ke("GENERATION_FAILED",`Validation failed: ${b.message}`,{trialId:e,options:t,originalError:b})}}if(!c.value.isValid)return{ok:!1,error:new ke("INVALID_FIELDS",`Export validation failed: ${c.value.errors.join(", ")}`,{errors:c.value.errors})};t.format;const p=Kc(t.format);t.format,u.length,t.fields?.length,t.fields,t.fields?.filter(b=>b.startsWith("param_")),t.fields?.filter(b=>b.startsWith("var_")),t.fields?.filter(b=>b.startsWith("attr_"));const d=Date.now(),v=await p.generate(u,n,t);Date.now()-d,v.length,Zt(v);const y=t.fields||[],g=Date.now()-a,T={filename:Te.generateFilename(n.name,t.format),mimeType:p.getFormatInfo().mimeType,data:v,metadata:{trialName:n.name,trialId:n.id,exportDate:new Date,callCount:u.length,fieldCount:y.length,format:t.format,estimatedSizeBytes:Zt(v)},format:t.format,recordCount:u.length,fieldCount:y.length,hasParameterFields:y.some(b=>b.startsWith("param_")),generationTimeMs:g};return t.format,T.filename,T.metadata.estimatedSizeBytes,T.generationTimeMs,{ok:!0,value:T}}catch(o){const n=o instanceof Error?o:new Error(String(o));return n.message,n.stack,n.name,n.constructor.name,t.format,Date.now()-a,{ok:!1,error:new ke("GENERATION_FAILED",`Export generation failed: ${n.message}`,{trialId:e,options:t,originalError:o,generationTimeMs:Date.now()-a})}}}async previewExport(e,t){try{const a=await tt.loadTrialForExport(e);if(!a.ok){const g=a.error;return{ok:!1,error:new ke("GENERATION_FAILED",`Failed to load trial data: ${g.message}`,{trialId:e,originalError:g})}}const{trial:o,apiCalls:n}=a.value,u=Ae.getFieldDefinitions(o),c=lt.discoverAllParameters(o),p=t.fields||this.getDefaultFields(o),d=t.format||"csv",v=Te.estimateFileSize(n.length,p.length,d);return{ok:!0,value:{fieldCount:p.length,recordCount:n.length,estimatedSizeBytes:v,availableFields:u,parameterFields:c}}}catch(a){return{ok:!1,error:new ke("GENERATION_FAILED",`Preview generation failed: ${a instanceof Error?a.message:"Unknown error"}`,{trialId:e,options:t,originalError:a})}}}async getAvailableFields(e){try{const t=await tt.loadTrialForExport(e);if(!t.ok){const d=t.error;return{ok:!1,error:new ke("GENERATION_FAILED",`Failed to load trial data: ${d.message}`,{trialId:e,originalError:d})}}const{trial:a,apiCalls:o}=t.value,n=Ae.getStandardFieldDefinitions(),u=lt.discoverAllParameters(a),c=$s.discoverAllVariables(a,o),p=gt.getRecommendedFields(a);return{ok:!0,value:{standardFields:n,parameterFields:u,variableFields:c,recommendedFields:p}}}catch(t){return{ok:!1,error:new ke("GENERATION_FAILED",`Field discovery failed: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateExportOptions(e,t,a){try{const o=await tt.loadTrialForExport(e);if(!o.ok){const c=o.error;return{ok:!1,error:new ke("GENERATION_FAILED",`Failed to load trial data: ${c.message}`,{trialId:e,originalError:c})}}const{trial:n}=o.value;return{ok:!0,value:gt.validateExportOptions(n,t,a)}}catch(o){return{ok:!1,error:new ke("GENERATION_FAILED",`Validation failed: ${o instanceof Error?o.message:"Unknown error"}`,{trialId:e,options:t,originalError:o})}}}getDefaultFields(e){return gt.getRecommendedFields(e)}}const It=new Zc,Yc={class:"export-content"},Qc={class:"section"},ep={key:0,class:"section"},tp={class:"bundle-info"},sp={key:0},ap={key:1,class:"section"},np={class:"field-actions"},op={class:"field-groups"},lp={class:"field-group"},ip={class:"field-list"},rp={class:"field-group"},up={class:"field-list"},dp={class:"field-group"},cp={class:"field-list"},pp={class:"field-group"},fp={class:"field-list"},mp={class:"field-group"},vp={class:"field-list"},gp={key:0,class:"field-group"},hp={class:"field-list"},yp={key:1,class:"field-group"},bp={class:"field-list"},_p={class:"section"},Tp={class:"preview-info"},Cp={class:"info-item"},$p={class:"value"},kp={class:"info-item"},wp={class:"value"},Sp={class:"info-item"},Ip={class:"value"},Ep={class:"export-actions"},Fp=de({__name:"ExportDataModalV3",props:{visible:{type:Boolean},trial:{}},emits:["update:visible"],setup(l,{emit:e}){const t=l,a=e,o=H("csv"),n=H(["order","status","configuration","prompt","response","latency"]),u=H(!1),c=H("draft"),p=H({}),d=H([]),v=H([]),y=H([]),g=["order","status","configuration","prompt","response","latency"],T=H([]),b=["id","order","status","created","completed","configuration","provider","modelId","parameters","prompt","variables","response","parsedResponse","latency","promptTokens","completionTokens","totalTokens","cost","request","response_raw","error","repeatIndex"],_=M(()=>{const I=t.trial.progress?.completed||0,i=t.trial.progress?.failed||0;return I+i}),U=M(()=>{const i=n.value.length*50*_.value;return i<1024?`${i} B`:i<1024*1024?`${(i/1024).toFixed(1)} KB`:`${(i/(1024*1024)).toFixed(1)} MB`});function L(){T.value.length,T.value.forEach(q=>{p.value[q]=!1}),g.forEach(q=>{p.value[q]=!0});const I=v.value.map(q=>q.id),i=y.value.map(q=>q.id);I.forEach(q=>{p.value[q]=!0}),i.forEach(q=>{p.value[q]=!0}),g.length,I.length,i.length,g.length+I.length+i.length,V()}function V(){n.value=T.value.filter(I=>p.value[I])}function w(I,i){p.value[I]=i,V()}function $(){T.value.forEach(I=>{p.value[I]=!0}),V()}function D(){T.value.forEach(q=>{p.value[q]=!1}),g.forEach(q=>{p.value[q]=!0});const I=v.value.map(q=>q.id),i=y.value.map(q=>q.id);I.forEach(q=>{p.value[q]=!0}),i.forEach(q=>{p.value[q]=!0}),V()}function C(){T.value.forEach(I=>{p.value[I]=!1}),V()}function m(){a("update:visible",!1)}async function N(){if(o.value==="bundle"){u.value=!0;try{const{trialBundleExportService:I}=await We(async()=>{const{trialBundleExportService:Q}=await import("./trial-bundle.service-Bc9YrTG8.js");return{trialBundleExportService:Q}},__vite__mapDeps([0,1,2,3,4,5,6])),i=c.value==="completed",q=await I.exportTrialBundle(t.trial.id,{includeResults:i,includeApiCalls:i,format:"json"});q.ok?(re.success(`Trial bundle exported: ${q.value.filename}`),a("update:visible",!1)):re.error(`Bundle export failed: ${q.error.message}`)}catch(I){re.error(`Bundle export failed: ${I instanceof Error?I.message:"Unknown error"}`)}finally{u.value=!1}return}if(n.value.length===0){re.warning("Please select at least one field to export");return}u.value=!0;try{const I={format:o.value,fields:n.value,includeHeaders:!0,addBOM:o.value==="excel"||o.value==="csv"},i=await It.exportTrialData(t.trial.id,I);i.ok?(I.format==="excel"&&typeof i.value.data=="string"?await qe.downloadExcelFile(i.value.data,i.value.metadata.trialName):await qe.downloadFile(i.value.data,I.format,i.value.metadata.trialName,I.addBOM),re.success("Export completed successfully"),a("update:visible",!1)):re.error(`Export failed: ${i.error.message}`)}catch(I){re.error("Export failed: "+I.message)}finally{u.value=!1}}return Ie(async()=>{t.trial.id;const I=await It.getAvailableFields(t.trial.id);if(I.ok){d.value=I.value.standardFields,v.value=I.value.parameterFields,y.value=(I.value.variableFields||[]).filter(A=>!A.id.startsWith("source_"));const i=I.value.standardFields.map(A=>A.id).filter(A=>A!=="parameters"&&A!=="variables"),q=I.value.parameterFields.map(A=>A.id),Q=y.value.map(A=>A.id);T.value=[...i,...q,...Q],I.value.standardFields.length,I.value.parameterFields.length,(I.value.variableFields||[]).length,T.value.length,I.value.parameterFields.map(A=>A.id),(I.value.variableFields||[]).map(A=>A.id),T.value}else I.error,T.value=[...b];L()}),(I,i)=>{const q=pa,Q=Pt,A=At,K=Ee,S=ps,F=Le;return r(),ee(F,{visible:I.visible,"onUpdate:visible":i[46]||(i[46]=P=>I.$emit("update:visible",P)),title:"Export Trial Data",width:800,footer:null,"destroy-on-close":!0,class:"export-data-modal"},{default:R(()=>[s("div",Yc,[s("div",Qc,[i[53]||(i[53]=s("h4",null,"Export Format",-1)),k(Q,{value:o.value,"onUpdate:value":i[0]||(i[0]=P=>o.value=P),class:"format-options"},{default:R(()=>[k(q,{value:"csv"},{default:R(()=>i[47]||(i[47]=[O("CSV")])),_:1,__:[47]}),k(q,{value:"tsv"},{default:R(()=>i[48]||(i[48]=[O("TSV")])),_:1,__:[48]}),k(q,{value:"excel"},{default:R(()=>i[49]||(i[49]=[O("Excel")])),_:1,__:[49]}),k(q,{value:"json"},{default:R(()=>i[50]||(i[50]=[O("JSON")])),_:1,__:[50]}),k(q,{value:"jsonl"},{default:R(()=>i[51]||(i[51]=[O("JSONL")])),_:1,__:[51]}),k(q,{value:"bundle"},{default:R(()=>i[52]||(i[52]=[O("Auditomatic Trial Format")])),_:1,__:[52]})]),_:1},8,["value"])]),o.value==="bundle"?(r(),f("div",ep,[i[64]||(i[64]=s("h4",null,"Auditomatic Trial Format",-1)),s("div",tp,[i[61]||(i[61]=s("p",{style:{"margin-bottom":"16px",color:"var(--color-text-secondary)"}}," Export your trial in Auditomatic's native format to recreate the exact trial on another browser or computer. Perfect for sharing experiments with collaborators or backing up your work. ",-1)),k(Q,{value:c.value,"onUpdate:value":i[1]||(i[1]=P=>c.value=P),style:{"margin-bottom":"16px"}},{default:R(()=>[k(A,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:R(()=>i[54]||(i[54]=[s("strong",null,"Export as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Trial configuration only - recreate the trial setup and run a fresh experiment ",-1)])),_:1,__:[54]}),k(A,{value:"completed",style:{display:"block"}},{default:R(()=>i[55]||(i[55]=[s("strong",null,"Export with Results",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Complete trial with all execution results - review past experiments or continue where you left off ",-1)])),_:1,__:[55]})]),_:1},8,["value"]),i[62]||(i[62]=s("p",null,"The exported file contains:",-1)),s("ul",null,[i[56]||(i[56]=s("li",null,"âœ… Complete trial configuration",-1)),i[57]||(i[57]=s("li",null,"âœ… Template with metadata",-1)),i[58]||(i[58]=s("li",null,"âœ… All variable lists",-1)),i[59]||(i[59]=s("li",null,"âœ… Model configurations",-1)),c.value==="completed"?(r(),f("li",sp,"âœ… Execution results and API calls")):E("",!0),i[60]||(i[60]=s("li",null,"âœ… Variable index tracking for lineage",-1))]),i[63]||(i[63]=s("p",{style:{"margin-top":"12px"}},[s("strong",null,"To import:"),O(' Use the "Import Trial" button on the Trials page to load this file on any Auditomatic instance. ')],-1))])])):(r(),f("div",ap,[i[97]||(i[97]=s("h4",null,"Fields to Export",-1)),s("div",np,[k(K,{size:"small",onClick:$},{default:R(()=>i[65]||(i[65]=[O("Select All")])),_:1,__:[65]}),k(K,{size:"small",onClick:D},{default:R(()=>i[66]||(i[66]=[O("Select Defaults")])),_:1,__:[66]}),k(K,{size:"small",onClick:C},{default:R(()=>i[67]||(i[67]=[O("Clear All")])),_:1,__:[67]})]),s("div",op,[s("div",lp,[i[73]||(i[73]=s("h5",null,"Basic Information",-1)),s("div",ip,[k(S,{checked:p.value.id,"onUpdate:checked":i[2]||(i[2]=P=>p.value.id=P),onChange:i[3]||(i[3]=P=>w("id",P.target.checked))},{default:R(()=>i[68]||(i[68]=[O("Call ID")])),_:1,__:[68]},8,["checked"]),k(S,{checked:p.value.order,"onUpdate:checked":i[4]||(i[4]=P=>p.value.order=P),onChange:i[5]||(i[5]=P=>w("order",P.target.checked))},{default:R(()=>i[69]||(i[69]=[O("Order")])),_:1,__:[69]},8,["checked"]),k(S,{checked:p.value.status,"onUpdate:checked":i[6]||(i[6]=P=>p.value.status=P),onChange:i[7]||(i[7]=P=>w("status",P.target.checked))},{default:R(()=>i[70]||(i[70]=[O("Status")])),_:1,__:[70]},8,["checked"]),k(S,{checked:p.value.created,"onUpdate:checked":i[8]||(i[8]=P=>p.value.created=P),onChange:i[9]||(i[9]=P=>w("created",P.target.checked))},{default:R(()=>i[71]||(i[71]=[O("Created Time")])),_:1,__:[71]},8,["checked"]),k(S,{checked:p.value.completed,"onUpdate:checked":i[10]||(i[10]=P=>p.value.completed=P),onChange:i[11]||(i[11]=P=>w("completed",P.target.checked))},{default:R(()=>i[72]||(i[72]=[O("Completed Time")])),_:1,__:[72]},8,["checked"])])]),s("div",rp,[i[78]||(i[78]=s("h5",null,"Configuration",-1)),s("div",up,[k(S,{checked:p.value.configuration,"onUpdate:checked":i[12]||(i[12]=P=>p.value.configuration=P),onChange:i[13]||(i[13]=P=>w("configuration",P.target.checked))},{default:R(()=>i[74]||(i[74]=[O("Configuration Name")])),_:1,__:[74]},8,["checked"]),k(S,{checked:p.value.provider,"onUpdate:checked":i[14]||(i[14]=P=>p.value.provider=P),onChange:i[15]||(i[15]=P=>w("provider",P.target.checked))},{default:R(()=>i[75]||(i[75]=[O("Provider")])),_:1,__:[75]},8,["checked"]),k(S,{checked:p.value.modelId,"onUpdate:checked":i[16]||(i[16]=P=>p.value.modelId=P),onChange:i[17]||(i[17]=P=>w("modelId",P.target.checked))},{default:R(()=>i[76]||(i[76]=[O("Model ID")])),_:1,__:[76]},8,["checked"]),k(S,{checked:p.value.parameters,"onUpdate:checked":i[18]||(i[18]=P=>p.value.parameters=P),onChange:i[19]||(i[19]=P=>w("parameters",P.target.checked))},{default:R(()=>i[77]||(i[77]=[O("Parameters")])),_:1,__:[77]},8,["checked"])])]),s("div",dp,[i[83]||(i[83]=s("h5",null,"Content",-1)),s("div",cp,[k(S,{checked:p.value.prompt,"onUpdate:checked":i[20]||(i[20]=P=>p.value.prompt=P),onChange:i[21]||(i[21]=P=>w("prompt",P.target.checked))},{default:R(()=>i[79]||(i[79]=[O("Prompt")])),_:1,__:[79]},8,["checked"]),k(S,{checked:p.value.variables,"onUpdate:checked":i[22]||(i[22]=P=>p.value.variables=P),onChange:i[23]||(i[23]=P=>w("variables",P.target.checked))},{default:R(()=>i[80]||(i[80]=[O("Variables")])),_:1,__:[80]},8,["checked"]),k(S,{checked:p.value.response,"onUpdate:checked":i[24]||(i[24]=P=>p.value.response=P),onChange:i[25]||(i[25]=P=>w("response",P.target.checked))},{default:R(()=>i[81]||(i[81]=[O("Response")])),_:1,__:[81]},8,["checked"]),k(S,{checked:p.value.parsedResponse,"onUpdate:checked":i[26]||(i[26]=P=>p.value.parsedResponse=P),onChange:i[27]||(i[27]=P=>w("parsedResponse",P.target.checked))},{default:R(()=>i[82]||(i[82]=[O("Parsed Response")])),_:1,__:[82]},8,["checked"])])]),s("div",pp,[i[89]||(i[89]=s("h5",null,"Performance",-1)),s("div",fp,[k(S,{checked:p.value.latency,"onUpdate:checked":i[28]||(i[28]=P=>p.value.latency=P),onChange:i[29]||(i[29]=P=>w("latency",P.target.checked))},{default:R(()=>i[84]||(i[84]=[O("Latency (ms)")])),_:1,__:[84]},8,["checked"]),k(S,{checked:p.value.promptTokens,"onUpdate:checked":i[30]||(i[30]=P=>p.value.promptTokens=P),onChange:i[31]||(i[31]=P=>w("promptTokens",P.target.checked))},{default:R(()=>i[85]||(i[85]=[O("Prompt Tokens")])),_:1,__:[85]},8,["checked"]),k(S,{checked:p.value.completionTokens,"onUpdate:checked":i[32]||(i[32]=P=>p.value.completionTokens=P),onChange:i[33]||(i[33]=P=>w("completionTokens",P.target.checked))},{default:R(()=>i[86]||(i[86]=[O("Completion Tokens")])),_:1,__:[86]},8,["checked"]),k(S,{checked:p.value.totalTokens,"onUpdate:checked":i[34]||(i[34]=P=>p.value.totalTokens=P),onChange:i[35]||(i[35]=P=>w("totalTokens",P.target.checked))},{default:R(()=>i[87]||(i[87]=[O("Total Tokens")])),_:1,__:[87]},8,["checked"]),k(S,{checked:p.value.cost,"onUpdate:checked":i[36]||(i[36]=P=>p.value.cost=P),onChange:i[37]||(i[37]=P=>w("cost",P.target.checked))},{default:R(()=>i[88]||(i[88]=[O("Cost (USD)")])),_:1,__:[88]},8,["checked"])])]),s("div",mp,[i[94]||(i[94]=s("h5",null,"Technical Details",-1)),s("div",vp,[k(S,{checked:p.value.request,"onUpdate:checked":i[38]||(i[38]=P=>p.value.request=P),onChange:i[39]||(i[39]=P=>w("request",P.target.checked))},{default:R(()=>i[90]||(i[90]=[O("Full Request")])),_:1,__:[90]},8,["checked"]),k(S,{checked:p.value.response_raw,"onUpdate:checked":i[40]||(i[40]=P=>p.value.response_raw=P),onChange:i[41]||(i[41]=P=>w("response_raw",P.target.checked))},{default:R(()=>i[91]||(i[91]=[O("Raw Response")])),_:1,__:[91]},8,["checked"]),k(S,{checked:p.value.error,"onUpdate:checked":i[42]||(i[42]=P=>p.value.error=P),onChange:i[43]||(i[43]=P=>w("error",P.target.checked))},{default:R(()=>i[92]||(i[92]=[O("Error Details")])),_:1,__:[92]},8,["checked"]),k(S,{checked:p.value.repeatIndex,"onUpdate:checked":i[44]||(i[44]=P=>p.value.repeatIndex=P),onChange:i[45]||(i[45]=P=>w("repeatIndex",P.target.checked))},{default:R(()=>i[93]||(i[93]=[O("Repeat Index")])),_:1,__:[93]},8,["checked"])])]),v.value.length>0?(r(),f("div",gp,[i[95]||(i[95]=s("h5",null,"Parameters (Individual Columns)",-1)),s("div",hp,[(r(!0),f(te,null,ne(v.value,P=>(r(),ee(S,{key:P.id,checked:p.value[P.id],"onUpdate:checked":le=>p.value[P.id]=le,onChange:le=>w(P.id,le.target.checked)},{default:R(()=>[O(h(P.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):E("",!0),y.value.length>0?(r(),f("div",yp,[i[96]||(i[96]=s("h5",null,"Attributes (Individual Columns)",-1)),s("div",bp,[(r(!0),f(te,null,ne(y.value,P=>(r(),ee(S,{key:P.id,checked:p.value[P.id],"onUpdate:checked":le=>p.value[P.id]=le,onChange:le=>w(P.id,le.target.checked)},{default:R(()=>[O(h(P.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):E("",!0)])])),s("div",_p,[i[101]||(i[101]=s("h4",null,"Export Preview",-1)),s("div",Tp,[s("div",Cp,[i[98]||(i[98]=s("span",{class:"label"},"Records:",-1)),s("span",$p,h(_.value),1)]),s("div",kp,[i[99]||(i[99]=s("span",{class:"label"},"Fields:",-1)),s("span",wp,h(n.value.length),1)]),s("div",Sp,[i[100]||(i[100]=s("span",{class:"label"},"Estimated Size:",-1)),s("span",Ip,h(U.value),1)])])]),s("div",Ep,[k(K,{onClick:m},{default:R(()=>i[102]||(i[102]=[O("Cancel")])),_:1,__:[102]}),k(K,{type:"primary",onClick:N,loading:u.value,disabled:n.value.length===0},{default:R(()=>[k(j(ms)),i[103]||(i[103]=O(" Export "))]),_:1,__:[103]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),Rp=ce(Fp,[["__scopeId","data-v-8229d46c"]]),xp={class:"trial-details-panel"},Pp={key:0,class:"loading-state"},Ap={key:1,class:"error-state"},Vp={class:"error-actions"},Op=de({__name:"TrialDetailsPanelV3",props:{trial:{},isLeader:{type:Boolean},executionState:{},progress:{}},emits:["start-trial","pause-trial","resume-trial","cancel-trial","duplicate-trial","edit-trial","delete-trial","export-data","export-python"],setup(l){const e=l,t=it(),a=H(!1),o=H(null),n=H(!1),u=gs(),c=M(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial?.id);function p(){o.value=null}function d(){t.push("/trials")}function v(){n.value=!0}async function y(){if(e.trial){`${e.trial.id}`;try{u.isActive&&u.currentTrialId===e.trial.id&&u.stopStreaming(),await u.loadHistoricalData(e.trial.id),`${e.trial.id}`,(e.trial.status==="running"||e.trial.status==="paused")&&await u.startStreaming(e.trial.id)}catch(g){x.error("REFRESH: Failed to refresh trial data:",g)}}}return ue(()=>e.trial,(g,T)=>{g&&g.id!==T?.id&&(o.value=null,x.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 switching from ${T?.id} to ${g.id}`))}),Ie(()=>{const g=e.trial?.id;x.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 MOUNTED for trial ${g}`)}),Ge(()=>{const g=e.trial?.id;x.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 ACTIVATED (cache hit) for trial ${g}`)}),Je(()=>{const g=e.trial?.id;x.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 DEACTIVATED (cached) for trial ${g}`)}),Ve(()=>{const g=e.trial?.id;x.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 UNMOUNTED (evicted) for trial ${g}`)}),(g,T)=>{const b=Ee;return r(),f("div",xp,[a.value?(r(),f("div",Pp,[k(j(rs),{class:"loading-spinner",spin:""}),T[9]||(T[9]=s("span",null,"Loading trial details...",-1))])):o.value?(r(),f("div",Ap,[k(j(He),{class:"error-icon"}),T[12]||(T[12]=s("h3",null,"Failed to load trial",-1)),s("p",null,h(o.value),1),s("div",Vp,[k(b,{onClick:p},{default:R(()=>T[10]||(T[10]=[O("Retry")])),_:1,__:[10]}),k(b,{type:"link",onClick:d},{default:R(()=>T[11]||(T[11]=[O("Go Back")])),_:1,__:[11]})])])):g.trial?(r(),f(te,{key:2},[k(Qn,{trial:g.trial,progress:g.progress,"is-executing":c.value},null,8,["trial","progress","is-executing"]),k(oo,{trial:g.trial,"is-leader":g.isLeader,"execution-state":g.executionState,onStart:T[0]||(T[0]=_=>g.$emit("start-trial")),onPause:T[1]||(T[1]=_=>g.$emit("pause-trial")),onResume:T[2]||(T[2]=_=>g.$emit("resume-trial")),onCancel:T[3]||(T[3]=_=>g.$emit("cancel-trial")),onDuplicate:T[4]||(T[4]=_=>g.$emit("duplicate-trial",g.trial.id)),onEdit:T[5]||(T[5]=_=>g.$emit("edit-trial",g.trial.id)),onDelete:T[6]||(T[6]=_=>g.$emit("delete-trial",g.trial.id)),onExportData:v,onExportPython:T[7]||(T[7]=_=>g.$emit("export-python",g.trial.id)),onRefresh:y},null,8,["trial","is-leader","execution-state"]),g.trial&&n.value?(r(),ee(Rp,{key:0,visible:n.value,trial:g.trial,"onUpdate:visible":T[8]||(T[8]=_=>n.value=!1)},null,8,["visible","trial"])):E("",!0),k(Mc,{trial:g.trial,progress:g.progress,"is-leader":g.isLeader,"execution-state":g.executionState},null,8,["trial","progress","is-leader","execution-state"])],64)):E("",!0)])}}}),Dp=ce(Op,[["__scopeId","data-v-081db72e"]]),Lp={class:"import-content"},Np={class:"upload-section"},Mp={class:"ant-upload-drag-icon"},Up={key:0,class:"preview-section"},zp={class:"bundle-details"},Bp={class:"detail-row"},Wp={class:"value"},jp={class:"detail-row"},Hp={class:"value"},qp={class:"detail-row"},Gp={class:"value"},Jp={class:"detail-row"},Xp={class:"value"},Kp={key:0,style:{color:"green","margin-left":"8px"}},Zp={key:1,style:{color:"orange","margin-left":"8px"}},Yp={key:0,class:"detail-row"},Qp={class:"value"},ef={class:"detail-row"},tf={class:"value"},sf={class:"import-options"},af={key:0,style:{"margin-bottom":"12px"}},nf={key:1,style:{"margin-bottom":"12px",padding:"8px",background:"#f0f0f0","border-radius":"4px"}},of={key:0,class:"warnings"},lf={class:"modal-actions"},rf=de({__name:"ImportTrialDialog",props:{visible:{type:Boolean}},emits:["update:visible","trial-imported"],setup(l,{emit:e}){const t=l,a=e,o=it(),n=H([]),u=H(null),c=H(!1),p=H([]),d=H({mode:"draft",namePrefix:"Imported: "}),v=M({get:()=>t.visible,set:w=>a("update:visible",w)}),y=M(()=>u.value?.execution?.apiCalls&&u.value.execution.apiCalls.length>0);function g(w){return!1}async function T(w){const $=w.file.originFileObj||w.file;if($)try{const D=await b($),C=JSON.parse(D);p.value=_(C),u.value=C,C.execution?.apiCalls&&C.execution.apiCalls.length>0,d.value.mode="draft"}catch{re.error("Failed to read bundle file: Invalid JSON format"),u.value=null}}function b(w){return new Promise(($,D)=>{const C=new FileReader;C.onload=m=>$(m.target?.result),C.onerror=D,C.readAsText(w)})}function _(w){const $=[];return w.version||$.push("Bundle version is missing"),w.configuration?.trial||$.push("Trial configuration is missing"),(!w.configuration?.variableLists||w.configuration.variableLists.length===0)&&$.push("No variable lists found in bundle"),w.version!=="1.0"&&$.push(`Bundle version ${w.version} may not be fully compatible`),$}function U(w){return new Date(w).toLocaleString()}function L(){n.value=[],u.value=null,p.value=[],v.value=!1}async function V(){if(!u.value){re.error("No bundle to import");return}c.value=!0;try{const{trialBundleImportService:w}=await We(async()=>{const{trialBundleImportService:C}=await import("./trial-bundle.service-Bc9YrTG8.js");return{trialBundleImportService:C}},__vite__mapDeps([0,1,2,3,4,5,6])),$=y.value&&d.value.mode==="completed",D=await w.importTrialBundle(JSON.stringify(u.value),{importResults:$,importAsCompleted:$,namePrefix:d.value.namePrefix||void 0});D.ok?(re.success("Trial imported successfully!"),o.push(`/trials?trialId=${D.value.trialId}`),a("trial-imported",D.value.trialId),L()):re.error(`Import failed: ${D.error.message}`)}catch(w){re.error(`Import failed: ${w instanceof Error?w.message:"Unknown error"}`)}finally{c.value=!1}}return(w,$)=>{const D=fa,C=At,m=Pt,N=cs,I=ut,i=Ee,q=Le;return r(),ee(q,{visible:v.value,"onUpdate:visible":$[3]||($[3]=Q=>v.value=Q),title:"Import Trial Bundle",width:600,footer:null,"destroy-on-close":!0,class:"import-trial-modal"},{default:R(()=>[s("div",Lp,[s("div",Np,[k(D,{fileList:n.value,"onUpdate:fileList":$[0]||($[0]=Q=>n.value=Q),"before-upload":g,"max-count":1,accept:".json",onChange:T},{default:R(()=>[s("p",Mp,[k(j(is))]),$[4]||($[4]=s("p",{class:"ant-upload-text"},"Click or drag trial bundle file here",-1)),$[5]||($[5]=s("p",{class:"ant-upload-hint"}," Supports .json files exported from trials ",-1))]),_:1,__:[4,5]},8,["fileList"])]),u.value?(r(),f("div",Up,[$[17]||($[17]=s("h3",null,"Bundle Contents",-1)),s("div",zp,[s("div",Bp,[$[6]||($[6]=s("span",{class:"label"},"Trial Name:",-1)),s("span",Wp,h(u.value.metadata.trialName),1)]),s("div",jp,[$[7]||($[7]=s("span",{class:"label"},"Export Date:",-1)),s("span",Hp,h(U(u.value.metadata.exportDate)),1)]),s("div",qp,[$[8]||($[8]=s("span",{class:"label"},"Status:",-1)),s("span",Gp,h(u.value.metadata.trialStatus),1)]),s("div",Jp,[$[9]||($[9]=s("span",{class:"label"},"API Calls:",-1)),s("span",Xp,[O(h(u.value.metadata.apiCallCount)+" ",1),y.value?(r(),f("span",Kp," (with results) ")):(r(),f("span",Zp," (configuration only) "))])]),u.value.configuration.template?(r(),f("div",Yp,[$[10]||($[10]=s("span",{class:"label"},"Template:",-1)),s("span",Qp,h(u.value.configuration.template.name),1)])):E("",!0),s("div",ef,[$[11]||($[11]=s("span",{class:"label"},"Variable Lists:",-1)),s("span",tf,h(u.value.configuration.variableLists?.length||0),1)])]),s("div",sf,[$[16]||($[16]=s("h4",null,"Import Options",-1)),y.value?(r(),f("div",af,[k(m,{value:d.value.mode,"onUpdate:value":$[1]||($[1]=Q=>d.value.mode=Q),style:{display:"block"}},{default:R(()=>[k(C,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:R(()=>$[12]||($[12]=[s("strong",null,"Import as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Create fresh trial ready to run new experiment ",-1)])),_:1,__:[12]}),k(C,{value:"completed",style:{display:"block"}},{default:R(()=>$[13]||($[13]=[s("strong",null,"Import as Completed",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Preserve historical results for review/analysis ",-1)])),_:1,__:[13]})]),_:1},8,["value"])])):(r(),f("div",nf,$[14]||($[14]=[s("strong",null,"Draft Trial",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px"}}," This bundle contains configuration only - will import as draft ready to run ",-1)]))),k(N,{value:d.value.namePrefix,"onUpdate:value":$[2]||($[2]=Q=>d.value.namePrefix=Q),placeholder:"Name prefix (optional)",style:{"margin-top":"8px"}},{prefix:R(()=>$[15]||($[15]=[O("Name:")])),_:1},8,["value"])]),p.value.length>0?(r(),f("div",of,[k(I,{message:"Import Warnings",type:"warning","show-icon":""},{description:R(()=>[s("ul",null,[(r(!0),f(te,null,ne(p.value,Q=>(r(),f("li",{key:Q},h(Q),1))),128))])]),_:1})])):E("",!0)])):E("",!0),s("div",lf,[k(i,{onClick:L},{default:R(()=>$[18]||($[18]=[O("Cancel")])),_:1,__:[18]}),k(i,{type:"primary",onClick:V,loading:c.value,disabled:!u.value},{default:R(()=>[k(j(ls)),$[19]||($[19]=O(" Import Trial "))]),_:1,__:[19]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),uf=ce(rf,[["__scopeId","data-v-1d9366d6"]]),df={class:"option-content"},cf={class:"option-header"},pf={class:"modal-footer"},ff=de({__name:"PythonExportModal",props:{visible:{type:Boolean},trialId:{}},emits:["update:visible"],setup(l,{emit:e}){const t=l,a=e,o=M({get:()=>t.visible,set:p=>a("update:visible",p)}),n=H("script-config-data"),u=H(!1);ue(o,p=>{p&&(n.value="script-config-data",u.value=!1)});async function c(){if(n.value){u.value=!0;try{const{reproducibilityBundleService:p}=await We(async()=>{const{reproducibilityBundleService:v}=await import("./index-7lsd8V0A.js");return{reproducibilityBundleService:v}},__vite__mapDeps([7,1,2,3,4,5,0,6,8,9,10,11,12,13,14,15,16,17,18])),d=await p.exportBundle(t.trialId,{bundleType:n.value,includeComments:!0});if(d.ok){const{tauriDownloadUtilities:v}=await We(async()=>{const{tauriDownloadUtilities:y}=await Promise.resolve().then(()=>Bu);return{tauriDownloadUtilities:y}},void 0);if(n.value==="script-only"){const y=await d.value.zipBlob.text();await v.downloadFile(y,"python",d.value.filename.replace(".zip",""),!1),re.success("Python script downloaded successfully")}else{const y=await d.value.zipBlob.arrayBuffer(),g=new Uint8Array(y);await v.downloadFile(g,"zip",d.value.filename.replace(".zip",""),!1);const T=n.value==="script-config-data"?"Complete archive bundle":"Reproducibility bundle";re.success(`${T} downloaded successfully`)}o.value=!1}else throw new Error(d.error?.message||"Export failed")}catch(p){x.error("Export failed:",p),re.error(`Failed to export: ${p instanceof Error?p.message:"Unknown error"}`)}finally{u.value=!1}}}return(p,d)=>{const v=At,y=rt,g=Pt,T=Ee,b=Le;return r(),ee(b,{visible:o.value,"onUpdate:visible":d[1]||(d[1]=_=>o.value=_),title:"Export for Reproducibility",width:600,footer:null,"destroy-on-close":!0},{default:R(()=>[d[10]||(d[10]=s("p",{class:"export-description"}," Choose your export format: ",-1)),k(g,{value:n.value,"onUpdate:value":d[0]||(d[0]=_=>n.value=_),class:"export-options"},{default:R(()=>[k(v,{value:"script-only",class:"export-option"},{default:R(()=>d[2]||(d[2]=[s("div",{class:"option-content"},[s("div",{class:"option-header"},[s("span",{class:"option-icon"},"ðŸ“„"),s("strong",{class:"option-title"},"Python Script Only")]),s("div",{class:"option-description"}," Minimal Python script (~200-400 lines) with clear experimental design. "),s("div",{class:"option-files"},"â€¢ experiment.py")],-1)])),_:1,__:[2]}),k(v,{value:"script-config",class:"export-option"},{default:R(()=>d[3]||(d[3]=[s("div",{class:"option-content"},[s("div",{class:"option-header"},[s("span",{class:"option-icon"},"ðŸ“¦"),s("strong",{class:"option-title"},"Reproducibility Bundle")]),s("div",{class:"option-description"}," Python script + complete trial configuration. "),s("div",{class:"option-files"}," â€¢ experiment.py â€¢ trial_config.json â€¢ README.md ")],-1)])),_:1,__:[3]}),k(v,{value:"script-config-data",class:"export-option recommended"},{default:R(()=>[s("div",df,[s("div",cf,[d[5]||(d[5]=s("span",{class:"option-icon"},"ðŸ—‚ï¸",-1)),d[6]||(d[6]=s("strong",{class:"option-title"},"Complete Archive Bundle",-1)),k(y,{color:"green",style:{"margin-left":"8px"}},{default:R(()=>d[4]||(d[4]=[O("Recommended")])),_:1,__:[4]})]),d[7]||(d[7]=s("div",{class:"option-description"}," Everything: Python script + configuration + all experimental results. ",-1)),d[8]||(d[8]=s("div",{class:"option-files"}," â€¢ experiment.py â€¢ trial_config.json â€¢ data/results.{csv,xlsx,jsonl} â€¢ README.md ",-1))])]),_:1})]),_:1},8,["value"]),s("div",pf,[k(T,{type:"primary",size:"large",disabled:!n.value,loading:u.value,onClick:c},{default:R(()=>[k(j(ms)),d[9]||(d[9]=O(" Download "))]),_:1,__:[9]},8,["disabled","loading"])])]),_:1,__:[10]},8,["visible"])}}}),mf=ce(ff,[["__scopeId","data-v-6cec199d"]]),vf={class:"trials-view-v3"},gf={key:0,class:"provider-warning-banner"},hf={class:"banner-content"},yf={key:1,class:"observer-mode-banner"},bf={class:"banner-content"},_f={key:1,class:"loading-left-pane"},Tf={key:0,class:"no-selection"},Cf={key:0,class:"observer-note"},$f=de({__name:"TrialsViewV3",setup(l){const e=Ta(),{trials:t}=ga(),{enabledModels:a}=Ca(),{duplicateTrial:o,deleteTrial:n}=ha(),u=gs(),c=as(),p=it(),d=H(),v=H(!0),y=H(null),g=H(""),T=H("all"),b=H(-1),_=H(!1),U=H(!1),L=H(!1),V=M(()=>a.value.length>0),w=M(()=>!V.value&&!L.value),$=e.isLeader,D=e.execution,{trial:C}=ya(y),m=M(()=>{const B=C.value?.progress;return B?{trialId:y.value||"",...B,lastUpdated:new Date}:null}),N=M(()=>{let B=t.value;if(g.value){const J=g.value.toLowerCase();B=B.filter(oe=>{const xe=oe.name.toLowerCase().includes(J),Re=oe.templateConfig?.template?.toLowerCase().includes(J),be=oe.configurations.some(Oe=>Oe.modelId.toLowerCase().includes(J)||Oe.provider.toLowerCase().includes(J));return xe||Re||be})}return T.value!=="all"&&(B=B.filter(J=>J.status===T.value)),B});async function I(){const B=c.query;if(B.duplicate){const J=B.duplicate,oe=await o(J);oe.ok?await p.push({path:"/trials/create",query:{duplicate:oe.value,edit:B.edit==="true"?"true":void 0}}):we.error(`Failed to duplicate trial: ${oe.error?.message||"Unknown error"}`),await p.replace({query:{}});return}if(B.designId||B.promptSource){await p.push({path:"/trials/create",query:B});return}if(c.query.trialId){const J=c.query.trialId;q(J)}}function i(){if(y.value||t.value.length===0)return;const B=t.value.find(J=>J.status==="running");if(B){q(B.id);return}q(t.value[0].id)}async function q(B){const J=performance.now();x.info(`V4_TRIAL_SWITCH: Starting trial selection: ${B}`),y.value=B;const oe=performance.now();if(x.info(`V4_TRIAL_SWITCH: UI updated in ${(oe-J).toFixed(1)}ms`),t.value.length>0){const be=N.value.findIndex(Oe=>Oe.id===B);be>=0&&(b.value=be)}const xe=performance.now();if(x.info(`V4_TRIAL_SWITCH: Starting stream manager for trial ${B} at ${(xe-J).toFixed(1)}ms`),u.startStreaming(B).catch(be=>{x.error(`V4_TRIAL_SWITCH: Failed to start streaming for trial ${B}`,be)}),c.query.trialId!==B){const be={...c.query};be.trialId=B,be.tab||(be.tab="status"),p.push({path:"/trials",query:be}),x.info(`V4_TRIAL_SWITCH: URL updated to preserve tab '${be.tab}' at ${(performance.now()-J).toFixed(1)}ms`)}d.value&&d.value.closeMobileOverlay();const Re=performance.now();x.info(`V4_TRIAL_SWITCH: selectTrial() completed in ${(Re-J).toFixed(1)}ms`)}function Q(B){g.value=B,b.value=-1}function A(B){T.value=B,b.value=-1}async function K(){we.info("Refreshing trial list...")}function S(B){const J=N.value;if(J.length!==0){if((B.metaKey||B.ctrlKey)&&B.key==="k"){B.preventDefault(),window.dispatchEvent(new CustomEvent("focus-trial-search"));return}(B.key==="j"||B.key==="ArrowDown")&&(B.preventDefault(),b.value=Math.min(b.value+1,J.length-1),b.value>=0&&(q(J[b.value].id),F(J[b.value].id))),(B.key==="k"||B.key==="ArrowUp")&&(B.preventDefault(),b.value=Math.max(b.value-1,0),q(J[b.value].id),F(J[b.value].id)),B.key==="Enter"&&y.value,B.key==="Escape"&&(g.value="",y.value=null,b.value=-1)}}function F(B){Me(()=>{const J=document.querySelector(`[data-trial-id="${B}"]`);J&&J.scrollIntoView({behavior:"smooth",block:"nearest"})})}function P(B){x.debug("Trial list panel resized",{width:B})}function le(B){x.debug("Mobile overlay changed",{visible:B})}function ye(){L.value=!0}async function ve(){await p.push("/trials/create")}function he(){U.value=!0}function pe(B){K(),q(B)}async function W(){if(y.value&&!_.value){_.value=!0,e.execution?.value,e.execution?.value?.status;try{y.value;const B=await e.startTrialWithStreaming(y.value);if(!B.ok){we.error(B.error?.message||"Unknown error");return}await u.startStreaming(y.value);const J={...c.query};J.tab="tasks",p.replace({query:J})}finally{_.value=!1}}}async function G(){`${y.value}`,`${y.value}`,`${e.execution.value.status}`,`${e.isLeader.value}`;const B=await e.pauseExecution();B?.ok,B.ok?`${e.execution.value.status}`:(B.error.message,we.error(B.error?.message||"Unknown error"))}async function ie(){if(!y.value)return;`${y.value}`,`${y.value}`,`${e.execution.value.status}`,`${e.isLeader.value}`;const B=e.execution.value?.status||"idle",J=e.execution.value?.currentTrialId;if(B==="paused"&&J===y.value){`${y.value}`;const oe=await e.resumeExecution(y.value);oe.ok||(oe.error.message,we.error(oe.error.message))}else{const oe=await e.startTrialWithStreaming(y.value);oe.ok?await u.startStreaming(y.value):(oe.error.message,we.error(oe.error?.message||"Unknown error"))}}async function Y(){const B=await e.cancelExecution();B.ok||we.error(B.error?.message||"Unknown error")}async function ge(B){const J=await o(B);J.ok?(we.success("Trial duplicated"),J.value&&q(J.value)):we.error(J.error?.message||"Unknown error")}async function $e(B){await p.push({path:"/trials/create",query:{duplicate:B,edit:"true"}})}async function Fe(B){const J=await n(B);J.ok?(we.success("Trial deleted"),y.value===B&&(y.value=null)):we.error(J.error?.message||"Unknown error")}async function Ze(B,J){const oe=await It.exportTrialData(B,{format:J,fields:void 0,includeHeaders:!0,addBOM:J==="excel"||J==="csv"});oe.ok?(await qe.downloadFile(oe.value.data,J,oe.value.metadata.trialName,J==="excel"||J==="csv"),we.success(`Exported ${oe.value.recordCount} API calls to ${oe.value.filename}`)):we.error(oe.error?.message||"Unknown error")}const Ne=H(!1),Ye=H("");function Qe(B){Ye.value=B,Ne.value=!0}return ue(()=>c.query.trialId,B=>{B&&B!==y.value&&q(B)}),ue(v,(B,J)=>{const oe=performance.now();x.info(`V4_TRIAL_SWITCH: isLoadingInitial changed from ${J} to ${B} at ${oe}`),B||x.info("V4_TRIAL_SWITCH: Both panes should now be VISIBLE (no longer loading initial)")},{immediate:!0}),ue(t,(B,J)=>{const oe=performance.now();x.info(`V4_TRIAL_SWITCH: trials array changed from ${J?.length||0} to ${B.length} trials at ${oe}`)},{immediate:!0}),Ie(async()=>{const B=performance.now();x.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() ENTRY at ${B}`);const J=performance.now();x.info(`V4_TRIAL_SWITCH: Starting V4 execution system initialization at ${(J-B).toFixed(1)}ms`);try{await e.initialize();const me=performance.now();x.info(`V4_TRIAL_SWITCH: V4 execution system initialized in ${(me-J).toFixed(1)}ms`)}catch(me){const Se=performance.now();x.error(`V4_TRIAL_SWITCH: V4 initialization failed in ${(Se-J).toFixed(1)}ms:`,me)}const oe=performance.now();window.addEventListener("keydown",S),x.info(`V4_TRIAL_SWITCH: Keyboard listener added in ${(oe-B).toFixed(1)}ms`);const xe=performance.now();x.info(`V4_TRIAL_SWITCH: Starting nextTick wait at ${(xe-B).toFixed(1)}ms`),await Me();const Re=performance.now();x.info(`V4_TRIAL_SWITCH: nextTick completed in ${(Re-xe).toFixed(1)}ms`);const be=performance.now();v.value=!1,x.info(`V4_TRIAL_SWITCH: isLoadingInitial set to false at ${(be-B).toFixed(1)}ms`);const Oe=performance.now();x.info(`V4_TRIAL_SWITCH: Starting URL parameter processing at ${(Oe-B).toFixed(1)}ms`),await I();const z=performance.now();x.info(`V4_TRIAL_SWITCH: URL parameter processing completed in ${(z-Oe).toFixed(1)}ms`);const X=performance.now();x.info(`V4_TRIAL_SWITCH: Starting auto-selection at ${(X-B).toFixed(1)}ms`),i();const Z=performance.now();x.info(`V4_TRIAL_SWITCH: Auto-selection completed in ${(Z-X).toFixed(1)}ms`);const se=performance.now();x.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() TOTAL: ${(se-B).toFixed(1)}ms`)}),Ve(()=>{window.removeEventListener("keydown",S),u.destroy()}),(B,J)=>{const oe=Qt("router-link"),xe=Ee;return r(),f("div",vf,[w.value?(r(),f("div",gf,[s("div",hf,[k(j(He),{class:"warning-icon"}),J[3]||(J[3]=s("span",null,"No LLM providers configured. Please add API keys in Settings to run trials.",-1)),k(oe,{to:"/settings",class:"settings-link"},{default:R(()=>J[2]||(J[2]=[O("Go to Settings")])),_:1,__:[2]}),k(j(os),{class:"close-icon",onClick:ye})]),J[4]||(J[4]=s("div",{class:"banner-note"},"Note: Ollama doesn't require API keys",-1))])):E("",!0),j($)?E("",!0):(r(),f("div",yf,[s("div",bf,[k(j(ds),{class:"observer-icon"}),J[5]||(J[5]=s("span",null,[s("strong",null,"Observer Mode: Multiple Tabs Detected")],-1)),J[6]||(J[6]=s("div",{class:"leader-hint"}," You can only open one Auditomatic tab at a time. Close other tabs, or refresh if this is your only tab. Your templates and trials are safely saved. ",-1))])])),k(wa,{ref_key:"splitPanel",ref:d,"storage-key":"trial-list-width","default-width":250,"min-width":200,"max-width":600,onResize:P,onMobileOverlayChange:le},{left:R(()=>[v.value?(r(),f("div",_f," Loading trials... ")):(r(),ee(Ln,{key:0,trials:j(t),"selected-trial-id":y.value,"search-query":g.value,"filter-status":T.value,onSelectTrial:q,onCreateTrial:ve,onImportTrial:he,onUpdateSearch:Q,onUpdateFilter:A,onRefresh:K},null,8,["trials","selected-trial-id","search-query","filter-status"]))]),right:R(()=>[(r(),ee(yt,{max:5},[y.value?(r(),ee(Dp,{key:y.value,trial:j(C),"is-leader":j($),"execution-state":j(D),progress:m.value,onStartTrial:W,onPauseTrial:G,onResumeTrial:ie,onCancelTrial:Y,onDuplicateTrial:ge,onEditTrial:$e,onDeleteTrial:Fe,onExportData:Ze,onExportPython:Qe},null,8,["trial","is-leader","execution-state","progress"])):E("",!0)],1024)),!y.value||!j(C)?Be((r(),f("div",Tf,[k(j(fs),{class:"empty-icon"}),J[8]||(J[8]=s("h3",null,"Select a trial to view details",-1)),J[9]||(J[9]=s("p",null,"Choose from the list or create a new one",-1)),k(xe,{type:"primary",size:"large",disabled:!j($),onClick:ve},{default:R(()=>J[7]||(J[7]=[O(" Create New Trial ")])),_:1,__:[7]},8,["disabled"]),j($)?E("",!0):(r(),f("div",Cf," Close other tabs to enable trial creation "))],512)),[[ss,!v.value]]):E("",!0)]),_:1},512),k(uf,{visible:U.value,"onUpdate:visible":J[0]||(J[0]=Re=>U.value=Re),onTrialImported:pe},null,8,["visible"]),k(mf,{visible:Ne.value,"onUpdate:visible":J[1]||(J[1]=Re=>Ne.value=Re),"trial-id":Ye.value},null,8,["visible","trial-id"])])}}}),kf=ce($f,[["__scopeId","data-v-84d2df98"]]),Uf=Object.freeze(Object.defineProperty({__proto__:null,default:kf},Symbol.toStringTag,{value:"Module"}));export{ke as E,Uf as T,It as d,Zt as g,tt as t};
