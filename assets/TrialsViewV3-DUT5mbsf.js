const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/trial-bundle.service-Cs_CcyLH.js","assets/index-CAGf8Ut2.js","assets/vue-vendor-DPw1dQYc.js","assets/ui-vendor-IRGmExUJ.js","assets/utils-vendor-B76-F3_P.js","assets/index-DaHEOU6Y.css","assets/data-vendor-BIyl9aCN.js","assets/index-Cmt64CuX.js","assets/toast-CdlfWUDp.js","assets/useCostEstimation-Do8WjDhe.js","assets/ParserSelector-DHu_JGFm.js","assets/parser.store-ChYV5z7-.js","assets/ParserSelector-DMLEdzpb.css","assets/trial-stream-manager-v4-bzt5umlL.js","assets/execution-control-v4-B75oIVAl.js","assets/useV4TrialCommands-DWRwBxhk.js","assets/useHeatmapStylingV3-CCIdVOn4.js","assets/useV4Models-D-JrBD7P.js","assets/useV4LiveQuery-Do0jdBW3.js"])))=>i.map(i=>d[i]);
var ys=Object.defineProperty;var bs=(r,e,t)=>e in r?ys(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Se=(r,e,t)=>bs(r,typeof e!="symbol"?e+"":e,t);import{d as le,f as q,c as M,o as me,b as ye,w as oe,R as p,a0 as te,S as s,_ as P,a9 as Ie,a3 as _e,Y as i,y as we,aa as _s,ab as Ts,ac as $s,$ as Q,ad as Cs,ae as ks,af as Nt,q as Lt,n as Ee,k as I,Z as A,F as Z,W as ee,a5 as $t,ag as ws,ah as Ss,u as H,a4 as nt,V as b,G as D,M as xe,ai as Ae,U as Mt,A as Ut,aj as Is,B as zt,r as Es,a7 as Rs,a1 as Bt,X as He,a6 as ot}from"./vue-vendor-DPw1dQYc.js";import{t as fe}from"./toast-CdlfWUDp.js";import{j as re,a as V,u as Fs,b as Ct,y as Ne,z as Ps,x as xs,d as Fe,B as As,e as kt,C as Vs,_ as Re}from"./index-CAGf8Ut2.js";import{aH as jt,z as Wt,aS as Os,n as ve,P as Ds,aT as Ht,aU as Ns,s as mt,az as Ls,M as vt,t as gt,v as Ms,a1 as qt,I as wt,aV as Us,aa as zs,av as Bs,aM as Gt,V as js,aI as Ws,X as Hs,C as ht,r as qs,w as Gs,x as Ce,ax as Jt,aN as Pe,T as qe,J as Ge,D as Js,N as ne,aJ as Xs,am as Xt,a5 as Ks,a6 as Qs,a4 as Kt,aW as Ys,ai as Qt,E as Yt,ak as Zs,al as ea,G as ta,o as sa,aA as aa,aX as St,R as na,Y as oa,au as yt,aw as la,aY as bt,m as Zt,a0 as ra}from"./ui-vendor-IRGmExUJ.js";import{b as es}from"./utils-vendor-B76-F3_P.js";import{u as Je}from"./useCostEstimation-Do8WjDhe.js";import{P as ia}from"./ParserSelector-DHu_JGFm.js";import{u as Xe,a as ts}from"./trial-stream-manager-v4-bzt5umlL.js";import{u as ua}from"./parser.store-ChYV5z7-.js";import{v as It,u as da,a as ca,b as pa}from"./useV4TrialCommands-DWRwBxhk.js";import{u as fa}from"./useHeatmapStylingV3-CCIdVOn4.js";import{u as tt,w as ma}from"./data-vendor-BIyl9aCN.js";import{u as va}from"./execution-control-v4-B75oIVAl.js";import{u as ga}from"./useV4Models-D-JrBD7P.js";const ha={class:"right-panel"},ya=le({__name:"ResizablePanelContainer",props:{storageKey:{default:"trial-list-width"},defaultWidth:{default:250},minWidth:{default:200},maxWidth:{default:600},mobileBreakpoint:{default:768}},emits:["resize","mobile-overlay-change"],setup(r,{expose:e,emit:t}){const a=r,o=t,n=q(a.defaultWidth),u=q(!1),c=q(0),d=q(0),f=q(window.innerWidth),g=q(!1),h=M(()=>f.value<a.mobileBreakpoint),_=M(()=>h.value?{width:`${Math.min(f.value*.85,400)}px`}:{width:`${n.value}px`});function R(){const $=localStorage.getItem(a.storageKey);if($){const m=parseInt($,10);!isNaN(m)&&m>=a.minWidth&&m<=a.maxWidth&&(n.value=m)}}function w($){localStorage.setItem(a.storageKey,$.toString()),o("resize",$)}function k($){u.value=!0,c.value=$.clientX,d.value=n.value,document.addEventListener("mousemove",z),document.addEventListener("mouseup",N),document.body.style.userSelect="none",document.body.style.cursor="col-resize"}function z($){if(!u.value)return;const m=$.clientX-c.value,L=Math.max(a.minWidth,Math.min(a.maxWidth,d.value+m));n.value=L}function N(){u.value&&(u.value=!1,w(n.value),document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",N),document.body.style.userSelect="",document.body.style.cursor="")}function O(){n.value=a.defaultWidth,w(a.defaultWidth)}function E(){f.value=window.innerWidth,!h.value&&g.value&&(g.value=!1,o("mobile-overlay-change",!1))}function S(){h.value&&(g.value=!g.value,o("mobile-overlay-change",g.value))}function U(){g.value=!1,o("mobile-overlay-change",!1)}return e({toggleMobileOverlay:S,closeMobileOverlay:U}),me(()=>{R(),window.addEventListener("resize",E)}),ye(()=>{window.removeEventListener("resize",E),N()}),oe(()=>a.defaultWidth,$=>{n.value===a.defaultWidth&&(n.value=$)}),($,m)=>(i(),p("div",{class:te(["resizable-panel-container",{"mobile-overlay":h.value}])},[s("div",{class:te(["left-panel",{"overlay-visible":h.value&&g.value}]),style:_e(_.value)},[Ie($.$slots,"left",{},void 0,!0)],6),h.value?P("",!0):(i(),p("div",{key:0,class:te(["resize-handle",{dragging:u.value}]),onMousedown:k,onDblclick:O},m[0]||(m[0]=[s("div",{class:"handle-bar"},null,-1)]),34)),s("div",ha,[Ie($.$slots,"right",{},void 0,!0)]),h.value&&g.value?(i(),p("div",{key:1,class:"mobile-overlay-bg",onClick:U})):P("",!0)],2))}}),ba=re(ya,[["__scopeId","data-v-949e1df1"]]);function _a(){var r=window.navigator.userAgent,e=r.indexOf("MSIE ");if(e>0)return parseInt(r.substring(e+5,r.indexOf(".",e)),10);var t=r.indexOf("Trident/");if(t>0){var a=r.indexOf("rv:");return parseInt(r.substring(a+3,r.indexOf(".",a)),10)}var o=r.indexOf("Edge/");return o>0?parseInt(r.substring(o+5,r.indexOf(".",o)),10):-1}let Me;function lt(){lt.init||(lt.init=!0,Me=_a()!==-1)}var Ke={name:"ResizeObserver",props:{emitOnMount:{type:Boolean,default:!1},ignoreWidth:{type:Boolean,default:!1},ignoreHeight:{type:Boolean,default:!1}},emits:["notify"],mounted(){lt(),we(()=>{this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitOnMount&&this.emitSize()});const r=document.createElement("object");this._resizeObject=r,r.setAttribute("aria-hidden","true"),r.setAttribute("tabindex",-1),r.onload=this.addResizeHandlers,r.type="text/html",Me&&this.$el.appendChild(r),r.data="about:blank",Me||this.$el.appendChild(r)},beforeUnmount(){this.removeResizeHandlers()},methods:{compareAndNotify(){(!this.ignoreWidth&&this._w!==this.$el.offsetWidth||!this.ignoreHeight&&this._h!==this.$el.offsetHeight)&&(this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitSize())},emitSize(){this.$emit("notify",{width:this._w,height:this._h})},addResizeHandlers(){this._resizeObject.contentDocument.defaultView.addEventListener("resize",this.compareAndNotify),this.compareAndNotify()},removeResizeHandlers(){this._resizeObject&&this._resizeObject.onload&&(!Me&&this._resizeObject.contentDocument&&this._resizeObject.contentDocument.defaultView.removeEventListener("resize",this.compareAndNotify),this.$el.removeChild(this._resizeObject),this._resizeObject.onload=null,this._resizeObject=null)}}};const Ta=$s();_s("data-v-b329ee4c");const $a={class:"resize-observer",tabindex:"-1"};Ts();const Ca=Ta((r,e,t,a,o,n)=>(i(),Q("div",$a)));Ke.render=Ca;Ke.__scopeId="data-v-b329ee4c";Ke.__file="src/components/ResizeObserver.vue";function Ue(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ue=function(e){return typeof e}:Ue=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ue(r)}function ka(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function wa(r,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(r,a.key,a)}}function Sa(r,e,t){return e&&wa(r.prototype,e),r}function Et(r){return Ia(r)||Ea(r)||Ra(r)||Fa()}function Ia(r){if(Array.isArray(r))return rt(r)}function Ea(r){if(typeof Symbol<"u"&&Symbol.iterator in Object(r))return Array.from(r)}function Ra(r,e){if(r){if(typeof r=="string")return rt(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return rt(r,e)}}function rt(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,a=new Array(e);t<e;t++)a[t]=r[t];return a}function Fa(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pa(r){var e;return typeof r=="function"?e={callback:r}:e=r,e}function xa(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a,o,n,u=function(d){for(var f=arguments.length,g=new Array(f>1?f-1:0),h=1;h<f;h++)g[h-1]=arguments[h];if(n=g,!(a&&d===o)){var _=t.leading;typeof _=="function"&&(_=_(d,o)),(!a||d!==o)&&_&&r.apply(void 0,[d].concat(Et(n))),o=d,clearTimeout(a),a=setTimeout(function(){r.apply(void 0,[d].concat(Et(n))),a=0},e)}};return u._clear=function(){clearTimeout(a),a=null},u}function ss(r,e){if(r===e)return!0;if(Ue(r)==="object"){for(var t in r)if(!ss(r[t],e[t]))return!1;return!0}return!1}var Aa=(function(){function r(e,t,a){ka(this,r),this.el=e,this.observer=null,this.frozen=!1,this.createObserver(t,a)}return Sa(r,[{key:"createObserver",value:function(t,a){var o=this;if(this.observer&&this.destroyObserver(),!this.frozen){if(this.options=Pa(t),this.callback=function(c,d){o.options.callback(c,d),c&&o.options.once&&(o.frozen=!0,o.destroyObserver())},this.callback&&this.options.throttle){var n=this.options.throttleOptions||{},u=n.leading;this.callback=xa(this.callback,this.options.throttle,{leading:function(d){return u==="both"||u==="visible"&&d||u==="hidden"&&!d}})}this.oldResult=void 0,this.observer=new IntersectionObserver(function(c){var d=c[0];if(c.length>1){var f=c.find(function(h){return h.isIntersecting});f&&(d=f)}if(o.callback){var g=d.isIntersecting&&d.intersectionRatio>=o.threshold;if(g===o.oldResult)return;o.oldResult=g,o.callback(g,d)}},this.options.intersection),we(function(){o.observer&&o.observer.observe(o.el)})}}},{key:"destroyObserver",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null),this.callback&&this.callback._clear&&(this.callback._clear(),this.callback=null)}},{key:"threshold",get:function(){return this.options.intersection&&typeof this.options.intersection.threshold=="number"?this.options.intersection.threshold:0}}]),r})();function as(r,e,t){var a=e.value;if(a)if(typeof IntersectionObserver>"u")console.warn("[vue-observe-visibility] IntersectionObserver API is not available in your browser. Please install this polyfill: https://github.com/w3c/IntersectionObserver/tree/master/polyfill");else{var o=new Aa(r,a,t);r._vue_visibilityState=o}}function Va(r,e,t){var a=e.value,o=e.oldValue;if(!ss(a,o)){var n=r._vue_visibilityState;if(!a){ns(r);return}n?n.createObserver(a,t):as(r,{value:a},t)}}function ns(r){var e=r._vue_visibilityState;e&&(e.destroyObserver(),delete r._vue_visibilityState)}var Oa={beforeMount:as,updated:Va,unmounted:ns},Da={itemsLimit:1e3},Na=/(auto|scroll)/;function os(r,e){return r.parentNode===null?e:os(r.parentNode,e.concat([r]))}var st=function(e,t){return getComputedStyle(e,null).getPropertyValue(t)},La=function(e){return st(e,"overflow")+st(e,"overflow-y")+st(e,"overflow-x")},Ma=function(e){return Na.test(La(e))};function Rt(r){if(r instanceof HTMLElement||r instanceof SVGElement){for(var e=os(r.parentNode,[]),t=0;t<e.length;t+=1)if(Ma(e[t]))return e[t];return document.scrollingElement||document.documentElement}}function it(r){"@babel/helpers - typeof";return it=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},it(r)}var Ua={items:{type:Array,required:!0},keyField:{type:String,default:"id"},direction:{type:String,default:"vertical",validator:function(e){return["vertical","horizontal"].includes(e)}},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"}};function za(){return this.items.length&&it(this.items[0])!=="object"}var ut=!1;if(typeof window<"u"){ut=!1;try{var Ba=Object.defineProperty({},"passive",{get:function(){ut=!0}});window.addEventListener("test",null,Ba)}catch{}}let ja=0;var Qe={name:"RecycleScroller",components:{ResizeObserver:Ke},directives:{ObserveVisibility:Oa},props:{...Ua,itemSize:{type:Number,default:null},gridItems:{type:Number,default:void 0},itemSecondarySize:{type:Number,default:void 0},minItemSize:{type:[Number,String],default:null},sizeField:{type:String,default:"size"},typeField:{type:String,default:"type"},buffer:{type:Number,default:200},pageMode:{type:Boolean,default:!1},prerender:{type:Number,default:0},emitUpdate:{type:Boolean,default:!1},updateInterval:{type:Number,default:0},skipHover:{type:Boolean,default:!1},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},listClass:{type:[String,Object,Array],default:""},itemClass:{type:[String,Object,Array],default:""}},emits:["resize","visible","hidden","update","scroll-start","scroll-end"],data(){return{pool:[],totalSize:0,ready:!1,hoverKey:null}},computed:{sizes(){if(this.itemSize===null){const r={"-1":{accumulator:0}},e=this.items,t=this.sizeField,a=this.minItemSize;let o=1e4,n=0,u;for(let c=0,d=e.length;c<d;c++)u=e[c][t]||a,u<o&&(o=u),n+=u,r[c]={accumulator:n,size:u};return this.$_computedMinItemSize=o,r}return[]},simpleArray:za,itemIndexByKey(){const{keyField:r,items:e}=this,t={};for(let a=0,o=e.length;a<o;a++)t[e[a][r]]=a;return t}},watch:{items(){this.updateVisibleItems(!0)},pageMode(){this.applyPageMode(),this.updateVisibleItems(!1)},sizes:{handler(){this.updateVisibleItems(!1)},deep:!0},gridItems(){this.updateVisibleItems(!0)},itemSecondarySize(){this.updateVisibleItems(!0)}},created(){this.$_startIndex=0,this.$_endIndex=0,this.$_views=new Map,this.$_unusedViews=new Map,this.$_scrollDirty=!1,this.$_lastUpdateScrollPosition=0,this.prerender&&(this.$_prerender=!0,this.updateVisibleItems(!1)),this.gridItems&&!this.itemSize&&console.error("[vue-recycle-scroller] You must provide an itemSize when using gridItems")},mounted(){this.applyPageMode(),this.$nextTick(()=>{this.$_prerender=!1,this.updateVisibleItems(!0),this.ready=!0})},activated(){const r=this.$_lastUpdateScrollPosition;typeof r=="number"&&this.$nextTick(()=>{this.scrollToPosition(r)})},beforeUnmount(){this.removeListeners()},methods:{addView(r,e,t,a,o){const n=Cs({id:ja++,index:e,used:!0,key:a,type:o}),u=ks({item:t,position:0,nr:n});return r.push(u),u},unuseView(r,e=!1){const t=this.$_unusedViews,a=r.nr.type;let o=t.get(a);o||(o=[],t.set(a,o)),o.push(r),e||(r.nr.used=!1,r.position=-9999)},handleResize(){this.$emit("resize"),this.ready&&this.updateVisibleItems(!1)},handleScroll(r){if(!this.$_scrollDirty){if(this.$_scrollDirty=!0,this.$_updateTimeout)return;const e=()=>requestAnimationFrame(()=>{this.$_scrollDirty=!1;const{continuous:t}=this.updateVisibleItems(!1,!0);t||(clearTimeout(this.$_refreshTimout),this.$_refreshTimout=setTimeout(this.handleScroll,this.updateInterval+100))});e(),this.updateInterval&&(this.$_updateTimeout=setTimeout(()=>{this.$_updateTimeout=0,this.$_scrollDirty&&e()},this.updateInterval))}},handleVisibilityChange(r,e){this.ready&&(r||e.boundingClientRect.width!==0||e.boundingClientRect.height!==0?(this.$emit("visible"),requestAnimationFrame(()=>{this.updateVisibleItems(!1)})):this.$emit("hidden"))},updateVisibleItems(r,e=!1){const t=this.itemSize,a=this.gridItems||1,o=this.itemSecondarySize||t,n=this.$_computedMinItemSize,u=this.typeField,c=this.simpleArray?null:this.keyField,d=this.items,f=d.length,g=this.sizes,h=this.$_views,_=this.$_unusedViews,R=this.pool,w=this.itemIndexByKey;let k,z,N,O,E;if(!f)k=z=O=E=N=0;else if(this.$_prerender)k=O=0,z=E=Math.min(this.prerender,d.length),N=null;else{const l=this.getScroll();if(e){let T=l.start-this.$_lastUpdateScrollPosition;if(T<0&&(T=-T),t===null&&T<n||T<t)return{continuous:!0}}this.$_lastUpdateScrollPosition=l.start;const W=this.buffer;l.start-=W,l.end+=W;let X=0;if(this.$refs.before&&(X=this.$refs.before.scrollHeight,l.start-=X),this.$refs.after){const T=this.$refs.after.scrollHeight;l.end+=T}if(t===null){let T,x=0,C=f-1,y=~~(f/2),v;do v=y,T=g[y].accumulator,T<l.start?x=y:y<f-1&&g[y+1].accumulator>l.start&&(C=y),y=~~((x+C)/2);while(y!==v);for(y<0&&(y=0),k=y,N=g[f-1].accumulator,z=y;z<f&&g[z].accumulator<l.end;z++);for(z===-1?z=d.length-1:(z++,z>f&&(z=f)),O=k;O<f&&X+g[O].accumulator<l.start;O++);for(E=O;E<f&&X+g[E].accumulator<l.end;E++);}else{k=~~(l.start/t*a);const T=k%a;k-=T,z=Math.ceil(l.end/t*a),O=Math.max(0,Math.floor((l.start-X)/t*a)),E=Math.floor((l.end-X)/t*a),k<0&&(k=0),z>f&&(z=f),O<0&&(O=0),E>f&&(E=f),N=Math.ceil(f/a)*t}}z-k>Da.itemsLimit&&this.itemsLimitError(),this.totalSize=N;let S;const U=k<=this.$_endIndex&&z>=this.$_startIndex;if(U)for(let l=0,W=R.length;l<W;l++)S=R[l],S.nr.used&&(r&&(S.nr.index=w[S.item[c]]),(S.nr.index==null||S.nr.index<k||S.nr.index>=z)&&this.unuseView(S));const $=U?null:new Map;let m,L,F;for(let l=k;l<z;l++){m=d[l];const W=c?m[c]:m;if(W==null)throw new Error(`Key is ${W} on item (keyField is '${c}')`);if(S=h.get(W),!t&&!g[l].size){S&&this.unuseView(S);continue}L=m[u];let X=_.get(L),T=!1;if(!S)U?X&&X.length?S=X.pop():S=this.addView(R,l,m,W,L):(F=$.get(L)||0,(!X||F>=X.length)&&(S=this.addView(R,l,m,W,L),this.unuseView(S,!0),X=_.get(L)),S=X[F],$.set(L,F+1)),h.delete(S.nr.key),S.nr.used=!0,S.nr.index=l,S.nr.key=W,S.nr.type=L,h.set(W,S),T=!0;else if(!S.nr.used&&(S.nr.used=!0,T=!0,X)){const x=X.indexOf(S);x!==-1&&X.splice(x,1)}S.item=m,T&&(l===d.length-1&&this.$emit("scroll-end"),l===0&&this.$emit("scroll-start")),t===null?(S.position=g[l-1].accumulator,S.offset=0):(S.position=Math.floor(l/a)*t,S.offset=l%a*o)}return this.$_startIndex=k,this.$_endIndex=z,this.emitUpdate&&this.$emit("update",k,z,O,E),clearTimeout(this.$_sortTimer),this.$_sortTimer=setTimeout(this.sortViews,this.updateInterval+300),{continuous:U}},getListenerTarget(){let r=Rt(this.$el);return window.document&&(r===window.document.documentElement||r===window.document.body)&&(r=window),r},getScroll(){const{$el:r,direction:e}=this,t=e==="vertical";let a;if(this.pageMode){const o=r.getBoundingClientRect(),n=t?o.height:o.width;let u=-(t?o.top:o.left),c=t?window.innerHeight:window.innerWidth;u<0&&(c+=u,u=0),u+c>n&&(c=n-u),a={start:u,end:u+c}}else t?a={start:r.scrollTop,end:r.scrollTop+r.clientHeight}:a={start:r.scrollLeft,end:r.scrollLeft+r.clientWidth};return a},applyPageMode(){this.pageMode?this.addListeners():this.removeListeners()},addListeners(){this.listenerTarget=this.getListenerTarget(),this.listenerTarget.addEventListener("scroll",this.handleScroll,ut?{passive:!0}:!1),this.listenerTarget.addEventListener("resize",this.handleResize)},removeListeners(){this.listenerTarget&&(this.listenerTarget.removeEventListener("scroll",this.handleScroll),this.listenerTarget.removeEventListener("resize",this.handleResize),this.listenerTarget=null)},scrollToItem(r){let e;const t=this.gridItems||1;this.itemSize===null?e=r>0?this.sizes[r-1].accumulator:0:e=Math.floor(r/t)*this.itemSize,this.scrollToPosition(e)},scrollToPosition(r){const e=this.direction==="vertical"?{scroll:"scrollTop",start:"top"}:{scroll:"scrollLeft",start:"left"};let t,a,o;if(this.pageMode){const n=Rt(this.$el),u=n.tagName==="HTML"?0:n[e.scroll],c=n.getBoundingClientRect(),f=this.$el.getBoundingClientRect()[e.start]-c[e.start];t=n,a=e.scroll,o=r+u+f}else t=this.$el,a=e.scroll,o=r;t[a]=o},itemsLimitError(){throw setTimeout(()=>{this.$el}),new Error("Rendered items limit reached")},sortViews(){this.pool.sort((r,e)=>r.nr.index-e.nr.index)}}};const Wa={key:0,ref:"before",class:"vue-recycle-scroller__slot"},Ha={key:1,ref:"after",class:"vue-recycle-scroller__slot"};function qa(r,e,t,a,o,n){const u=Nt("ResizeObserver"),c=Lt("observe-visibility");return Ee((i(),p("div",{class:te(["vue-recycle-scroller",{ready:o.ready,"page-mode":t.pageMode,[`direction-${r.direction}`]:!0}]),onScrollPassive:e[0]||(e[0]=(...d)=>n.handleScroll&&n.handleScroll(...d))},[r.$slots.before?(i(),p("div",Wa,[Ie(r.$slots,"before")],512)):P("v-if",!0),(i(),Q($t(t.listTag),{ref:"wrapper",style:_e({[r.direction==="vertical"?"minHeight":"minWidth"]:o.totalSize+"px"}),class:te(["vue-recycle-scroller__item-wrapper",t.listClass])},{default:A(()=>[(i(!0),p(Z,null,ee(o.pool,d=>(i(),Q($t(t.itemTag),ws({key:d.nr.id,style:o.ready?{transform:`translate${r.direction==="vertical"?"Y":"X"}(${d.position}px) translate${r.direction==="vertical"?"X":"Y"}(${d.offset}px)`,width:t.gridItems?`${r.direction==="vertical"&&t.itemSecondarySize||t.itemSize}px`:void 0,height:t.gridItems?`${r.direction==="horizontal"&&t.itemSecondarySize||t.itemSize}px`:void 0}:null,class:["vue-recycle-scroller__item-view",[t.itemClass,{hover:!t.skipHover&&o.hoverKey===d.nr.key}]]},Ss(t.skipHover?{}:{mouseenter:()=>{o.hoverKey=d.nr.key},mouseleave:()=>{o.hoverKey=null}})),{default:A(()=>[Ie(r.$slots,"default",{item:d.item,index:d.nr.index,active:d.nr.used})]),_:2},1040,["style","class"]))),128)),Ie(r.$slots,"empty")]),_:3},8,["style","class"])),r.$slots.after?(i(),p("div",Ha,[Ie(r.$slots,"after")],512)):P("v-if",!0),I(u,{onNotify:n.handleResize},null,8,["onNotify"])],34)),[[c,n.handleVisibilityChange]])}Qe.render=qa;Qe.__file="src/components/RecycleScroller.vue";const Ga={class:"trial-list-search"},Ja=["value"],Xa=le({__name:"TrialListSearch",props:{modelValue:{}},emits:["update:modelValue"],setup(r,{emit:e}){const t=e,a=q(),o=es(f=>{t("update:modelValue",f)},300);function n(f){const g=f.target.value;o(g)}function u(){t("update:modelValue",""),a.value?.focus()}function c(){a.value?.focus(),a.value?.select()}function d(f){f.type==="focus-trial-search"&&c()}return me(()=>{window.addEventListener("focus-trial-search",d)}),ye(()=>{window.removeEventListener("focus-trial-search",d)}),(f,g)=>(i(),p("div",Ga,[I(H(jt),{class:"search-icon"}),s("input",{ref_key:"searchInput",ref:a,type:"text",class:"search-input",placeholder:"Filter trials...",value:f.modelValue,onInput:n,onKeydown:nt(u,["escape"])},null,40,Ja),f.modelValue?(i(),Q(H(Wt),{key:0,class:"clear-icon",onClick:u})):P("",!0)]))}}),Ka=re(Xa,[["__scopeId","data-v-3a032c2b"]]),Qa={class:"item-content"},Ya={class:"item-header"},Za=["title"],en={key:0,class:"progress-bar"},tn={class:"item-metadata"},sn={class:"meta-item"},an={class:"meta-item"},nn={key:0,class:"meta-separator"},on={key:1,class:"meta-item cost"},ln=le({__name:"TrialListItem",props:{trial:{},selected:{type:Boolean}},emits:["click"],setup(r){const e=r,{calculateTemplateTokens:t,calculatePromptTokens:a,estimateTotalCost:o,sumEstimates:n,formatCost:u}=Je(),c=M(()=>{if(e.trial.progress.total===0)return 0;const h=e.trial.progress.completed+e.trial.progress.failed;return Math.round(h/e.trial.progress.total*100)}),d=M(()=>{const{completed:h,failed:_,total:R}=e.trial.progress;return e.trial.status==="draft"?`${R} tasks`:`${h+_}/${R} tasks`}),f=M(()=>{const h=e.trial.started||e.trial.created;if(!h)return"";const R=new Date().getTime()-h.getTime(),w=Math.floor(R/1e3),k=Math.floor(w/60),z=Math.floor(k/60),N=Math.floor(z/24);return w<60?"now":k<60?`${k}m`:z<24?`${z}h`:`${N}d`}),g=M(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let h=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)h=t(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const w=a(e.trial.spreadsheetConfig.promptPattern),k=e.trial.progress.total/e.trial.configurations.length;h={totalTokens:w*k,combinationCount:k,perCallAverage:w}}else if(e.trial.type==="playground")return null;if(!h||h.totalTokens===0)return null;const _=e.trial.configurations.map(w=>{const k=w.modelSnapshot;return k?o(h.totalTokens,h.combinationCount,k,w.parameters):null}).filter(Boolean);if(_.length===0)return null;const R=n(_);return`${u(R,"compact")} total`});return(h,_)=>(i(),p("div",{class:te(["trial-list-item",{selected:h.selected,"has-progress":h.trial.status==="running"}]),onClick:_[0]||(_[0]=R=>h.$emit("click"))},[s("div",{class:te(["status-indicator",`status-${h.trial.status}`])},null,2),s("div",Qa,[s("div",Ya,[s("span",{class:"trial-name",title:h.trial.name},b(h.trial.name),9,Za),s("span",{class:te(["status-tag",`status-${h.trial.status}`])},b(h.trial.status.toUpperCase()),3)]),h.trial.status==="running"?(i(),p("div",en,[s("div",{class:"progress-fill",style:_e({width:`${c.value}%`})},null,4)])):P("",!0),s("div",tn,[s("span",sn,b(d.value),1),_[1]||(_[1]=s("span",{class:"meta-separator"},"•",-1)),s("span",an,b(f.value),1),g.value?(i(),p("span",nn,"•")):P("",!0),g.value?(i(),p("span",on,b(g.value),1)):P("",!0)])])],2))}}),Ft=re(ln,[["__scopeId","data-v-037b1757"]]),rn={class:"section-title"},un=le({__name:"TrialListSection",props:{title:{},background:{type:Boolean}},setup(r){return(e,t)=>(i(),p("div",{class:te(["trial-list-section",{"with-background":e.background}])},[s("span",rn,b(e.title),1)],2))}}),Pt=re(un,[["__scopeId","data-v-07a26c58"]]),dn={class:"panel-header"},cn={class:"header-title"},pn={key:0,class:"title-text"},fn={class:"trial-count"},mn={key:0,class:"header-actions"},vn={class:"filter-count"},gn={class:"filter-count"},hn={class:"filter-count"},yn={class:"filter-count"},bn={class:"filter-count"},_n={key:1,class:"status-tabs"},Tn={class:"tab-count"},$n={class:"tab-count"},Cn={class:"tab-count"},kn={class:"trial-list-container"},wn={key:1,class:"trial-list"},Sn={key:2,class:"collapsed-list"},In=["onClick"],En={class:"collapsed-count"},Rn={key:3,class:"empty-state"},Fn=le({__name:"TrialListPanelV3",props:{trials:{},selectedTrialId:{},searchQuery:{},filterStatus:{}},emits:["select-trial","create-trial","import-trial","update-search","update-filter","refresh"],setup(r,{emit:e}){const t=r,a=e,o=q(!1),n=q("all"),u=q(250),c=M(()=>u.value<50),d=M(()=>t.trials.filter($=>$.status==="running"||$.status==="paused").length),f=M(()=>t.trials.filter($=>$.status==="completed"||$.status==="failed").length),g=M(()=>{let $=t.trials;if(t.searchQuery){const l=t.searchQuery.toLowerCase();$=$.filter(W=>{const X=W.name.toLowerCase().includes(l),T=W.templateConfig?.template?.toLowerCase().includes(l),x=W.configurations.some(C=>C.modelId.toLowerCase().includes(l)||C.provider.toLowerCase().includes(l));return X||T||x})}t.filterStatus!=="all"&&($=$.filter(l=>l.status===t.filterStatus)),n.value==="active"?$=$.filter(l=>l.status==="running"||l.status==="paused"):n.value==="done"&&($=$.filter(l=>l.status==="completed"||l.status==="failed"));const m=$.filter(l=>l.status==="running"),L=$.filter(l=>l.status!=="running"),F=[];return m.length>0&&(F.push({type:"section",title:"RUNNING",background:!0,id:"section-running"}),F.push(...m.sort((l,W)=>(W.started?.getTime()||0)-(l.started?.getTime()||0)))),L.length>0&&(m.length>0&&F.push({type:"section",title:"RECENT",background:!1,id:"section-recent"}),F.push(...L.sort((l,W)=>(W.created?.getTime()||0)-(l.created?.getTime()||0)))),F}),h=M(()=>g.value.map($=>({...$,height:N($)}))),_=M(()=>t.trials.filter($=>n.value==="active"?$.status==="running"||$.status==="paused":n.value==="done"?$.status==="completed"||$.status==="failed":!0)),R=M(()=>t.searchQuery?"No trials found":t.filterStatus==="running"?"No trials are currently running":"No trials found"),w=M(()=>t.searchQuery?"No trials match your search":t.filterStatus!=="all"?`No ${t.filterStatus} trials`:"Create your first trial to get started"),k=M(()=>t.filterStatus==="all"&&!t.searchQuery);function z($){return t.trials.filter(m=>m.status===$).length}function N($){if($.type==="section")return 32;const m=$.status==="running",L=$.configurations?.some(F=>F.repeatCount>1);return m||L?96:80}function O($){const m=$.progress.completed+$.progress.failed;return $.status==="running"?`${Math.round(m/$.progress.total*100)}%`:m.toString()}async function E(){o.value=!0;try{await new Promise($=>setTimeout($,500)),a("refresh")}finally{o.value=!1}}function S({key:$}){a("update-filter",$)}function U(){const $=document.querySelector(".trial-list-panel");$&&(u.value=$.clientWidth)}return me(()=>{U(),window.addEventListener("resize",U);const $=document.querySelector(".trial-list-panel");$&&new ResizeObserver(()=>U()).observe($)}),ye(()=>{window.removeEventListener("resize",U)}),($,m)=>{const L=ve,F=gt,l=Ms,W=vt,X=mt;return i(),p("div",{class:te(["trial-list-panel",{collapsed:c.value}])},[s("div",dn,[s("div",cn,[I(H(Os),{class:"title-icon"}),c.value?P("",!0):(i(),p("span",pn,"Trials")),s("span",fn,b($.trials.length),1)]),c.value?P("",!0):(i(),p("div",mn,[I(L,{type:"primary",size:"small",onClick:m[0]||(m[0]=T=>$.$emit("create-trial"))},{default:A(()=>[I(H(Ds)),m[7]||(m[7]=D(" New Trial "))]),_:1,__:[7]}),I(L,{size:"small",onClick:m[1]||(m[1]=T=>$.$emit("import-trial"))},{default:A(()=>[I(H(Ht)),m[8]||(m[8]=D(" Import "))]),_:1,__:[8]}),I(L,{size:"small",onClick:E,loading:o.value},{default:A(()=>[I(H(Ns),{spin:o.value},null,8,["spin"])]),_:1},8,["loading"]),I(X,null,{overlay:A(()=>[I(W,{onClick:S},{default:A(()=>[I(F,{key:"all"},{default:A(()=>m[9]||(m[9]=[s("span",null,"All Trials",-1)])),_:1,__:[9]}),I(l),I(F,{key:"running"},{default:A(()=>[m[10]||(m[10]=s("span",null,"Running Only",-1)),s("span",vn,b(z("running")),1)]),_:1,__:[10]}),I(F,{key:"completed"},{default:A(()=>[m[11]||(m[11]=s("span",null,"Completed Only",-1)),s("span",gn,b(z("completed")),1)]),_:1,__:[11]}),I(F,{key:"failed"},{default:A(()=>[m[12]||(m[12]=s("span",null,"Failed Only",-1)),s("span",hn,b(z("failed")),1)]),_:1,__:[12]}),I(F,{key:"paused"},{default:A(()=>[m[13]||(m[13]=s("span",null,"Paused Only",-1)),s("span",yn,b(z("paused")),1)]),_:1,__:[13]}),I(F,{key:"draft"},{default:A(()=>[m[14]||(m[14]=s("span",null,"Draft Only",-1)),s("span",bn,b(z("draft")),1)]),_:1,__:[14]})]),_:1})]),default:A(()=>[I(L,{size:"small"},{default:A(()=>[I(H(Ls))]),_:1})]),_:1})]))]),c.value?P("",!0):(i(),Q(Ka,{key:0,"model-value":$.searchQuery,"onUpdate:modelValue":m[2]||(m[2]=T=>$.$emit("update-search",T))},null,8,["model-value"])),c.value?P("",!0):(i(),p("div",_n,[s("div",{class:te(["status-tab",{active:n.value==="all"}]),onClick:m[3]||(m[3]=T=>n.value="all")},[m[15]||(m[15]=s("span",{class:"tab-icon"},"📊",-1)),m[16]||(m[16]=s("span",{class:"tab-label"},"ALL",-1)),s("span",Tn,b($.trials.length),1)],2),s("div",{class:te(["status-tab",{active:n.value==="active"}]),onClick:m[4]||(m[4]=T=>n.value="active")},[m[17]||(m[17]=s("span",{class:"tab-icon"},"🟢",-1)),m[18]||(m[18]=s("span",{class:"tab-label"},"Active",-1)),s("span",$n,b(d.value),1)],2),s("div",{class:te(["status-tab",{active:n.value==="done"}]),onClick:m[5]||(m[5]=T=>n.value="done")},[m[19]||(m[19]=s("span",{class:"tab-icon"},"✅",-1)),m[20]||(m[20]=s("span",{class:"tab-label"},"Done",-1)),s("span",Cn,b(f.value),1)],2)])),s("div",kn,[!c.value&&g.value.length>100?(i(),Q(H(Qe),{key:0,class:"trial-list virtual-list",items:h.value,"size-field":"height","key-field":"id",buffer:10},{default:A(({item:T})=>[T.type==="section"?(i(),Q(Pt,{key:0,title:T.title,background:T.background},null,8,["title","background"])):(i(),Q(Ft,{key:1,trial:T,selected:T.id===$.selectedTrialId,"data-trial-id":T.id,onClick:x=>$.$emit("select-trial",T.id)},null,8,["trial","selected","data-trial-id","onClick"]))]),_:1},8,["items"])):c.value?(i(),p("div",Sn,[(i(!0),p(Z,null,ee(_.value,T=>(i(),p("div",{key:T.id,class:te(["collapsed-item",{selected:T.id===$.selectedTrialId}]),onClick:x=>$.$emit("select-trial",T.id)},[s("div",{class:te(["status-dot",`status-${T.status}`])},null,2),s("span",En,b(O(T)),1)],10,In))),128))])):(i(),p("div",wn,[(i(!0),p(Z,null,ee(g.value,(T,x)=>(i(),p(Z,{key:T.id||`section-${x}`},[T.type==="section"?(i(),Q(Pt,{key:0,title:T.title,background:T.background},null,8,["title","background"])):(i(),Q(Ft,{key:1,trial:T,selected:T.id===$.selectedTrialId,"data-trial-id":T.id,onClick:C=>$.$emit("select-trial",T.id)},null,8,["trial","selected","data-trial-id","onClick"]))],64))),128))])),g.value.length===0&&!c.value?(i(),p("div",Rn,[I(H(qt),{class:"empty-icon"}),s("h3",null,b(R.value),1),s("p",null,b(w.value),1),k.value?(i(),Q(L,{key:0,type:"primary",size:"large",onClick:m[6]||(m[6]=T=>$.$emit("create-trial"))},{default:A(()=>m[21]||(m[21]=[D(" Create New Trial ")])),_:1,__:[21]})):P("",!0)])):P("",!0)])],2)}}}),Pn=re(Fn,[["__scopeId","data-v-ad2a17cf"]]),xn={class:"trial-header"},An={class:"header-main"},Vn={class:"header-title"},On={class:"trial-name"},Dn={key:0,class:"progress-container"},Nn={class:"progress-bar"},Ln={class:"progress-stats-inline"},Mn={class:"progress-text"},Un={key:0,class:"progress-stat"},zn={class:"stat-number"},Bn={key:1,class:"progress-stat"},jn={class:"stat-number"},Wn={key:2,class:"progress-stat"},Hn={class:"stat-number"},qn=le({__name:"TrialHeaderV3",props:{trial:{},progress:{},isExecuting:{type:Boolean}},setup(r){const e=r,t=M(()=>{let w=e.trial.name;return w=w.replace(/\s*-\s*\d{1,2}\/\d{1,2}\/\d{4}$/,""),w=w.replace(/\s*\(Copy\)(\s*\(Copy\))*/g,""),w.trim()}),a=M(()=>!0),o=M(()=>e.progress?e.progress.completed+e.progress.failed:0),n=M(()=>{if(!e.progress||e.progress.total===0)return 0;const w=e.progress.completed+e.progress.failed;return Math.round(w/e.progress.total*100)}),u=M(()=>{const w=e.trial.started||e.trial.created;if(!w)return"0m";let k;if(e.trial.status==="draft")return"0m";e.trial.completed?k=e.trial.completed:k=new Date;const z=k.getTime()-w.getTime(),N=Math.floor(z/(1e3*60*60)),O=Math.floor(z%(1e3*60*60)/(1e3*60));return N>0?`${N}h ${O}m`:`${O}m`}),c=M(()=>{if(!e.progress?.avgLatencyMs)return null;const w=e.progress.avgLatencyMs;return w<1e3?`${Math.round(w)}ms`:`${(w/1e3).toFixed(1)}s`}),{calculateTemplateTokens:d,calculatePromptTokens:f,estimateTotalCost:g,sumEstimates:h,formatCost:_}=Je();M(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let w=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)w=d(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const N=f(e.trial.spreadsheetConfig.promptPattern),E=(e.progress?.total||e.trial.progress.total)/e.trial.configurations.length;w={totalTokens:N*E,combinationCount:E,perCallAverage:N}}else if(e.trial.type==="playground")return null;if(!w||w.totalTokens===0)return null;const k=e.trial.configurations.map(N=>{const O=N.modelSnapshot;return O?g(w.totalTokens,w.combinationCount,O,N.parameters):null}).filter(Boolean);if(k.length===0)return null;const z=h(k);return`${_(z,"compact")} total`});const R=M(()=>{if(e.trial.status!=="running"||!e.progress||e.progress.completed===0)return null;const k=(Date.now()-(e.trial.started?.getTime()||0))/e.progress.completed,z=e.progress.pending*k,N=Math.floor(z/(1e3*60)),O=Math.floor(z%(1e3*60)/1e3);if(N>60){const E=Math.floor(N/60),S=N%60;return`${E}h ${S}m`}return`${N}m ${O}s`});return(w,k)=>(i(),p("div",xn,[s("div",An,[s("div",Vn,[s("h2",On,b(t.value),1),s("span",{class:te(["status-tag",`status-${w.trial.status}`])},b(w.trial.status.toUpperCase()),3)]),a.value?(i(),p("div",Dn,[s("div",Nn,[s("div",{class:"progress-fill",style:_e({width:`${n.value}%`})},null,4)]),s("div",Ln,[s("span",Mn,b(o.value)+"/"+b(w.progress?.total||0)+" ("+b(n.value)+"%) ",1),u.value?(i(),p("span",Un,[k[0]||(k[0]=s("span",{class:"stat-label"},"Duration:",-1)),k[1]||(k[1]=D()),s("span",zn,b(u.value),1)])):P("",!0),c.value?(i(),p("span",Bn,[k[2]||(k[2]=s("span",{class:"stat-label"},"Avg:",-1)),k[3]||(k[3]=D()),s("span",jn,b(c.value),1)])):P("",!0),R.value?(i(),p("span",Wn,[k[4]||(k[4]=s("span",{class:"stat-label"},"Remaining:",-1)),k[5]||(k[5]=D()),s("span",Hn,"~"+b(R.value),1)])):P("",!0)])])):P("",!0)]),P("",!0)]))}}),Gn=re(qn,[["__scopeId","data-v-248be564"]]),Jn={class:"trial-actions"},Xn={class:"action-group execution-controls"},Kn={class:"action-group data-actions"},Qn={class:"action-group management-actions"},Yn=le({__name:"TrialActionsV3",props:{trial:{},isLeader:{type:Boolean},executionState:{}},emits:["start","pause","resume","cancel","duplicate","edit","delete","export-data","export-python","refresh"],setup(r,{emit:e}){const t=r,a=e,o=q(!1),n=q(!1),u=q(!1);M(()=>t.executionState?.currentTrialId===t.trial.id);const c=M(()=>["draft","failed","cancelled"].includes(t.trial.status)),d=M(()=>t.trial.status==="running"),f=M(()=>t.trial.status==="paused"),g=M(()=>["running","paused"].includes(t.trial.status));function h(){a("start")}async function _(){o.value=!0,n.value=!1,a("pause"),setTimeout(()=>{o.value=!1},1e3)}async function R(){n.value=!0,o.value=!1,a("resume"),setTimeout(()=>{n.value=!1},3e3)}function w(){Ce.confirm({title:"Cancel trial?",content:"This will stop all pending API calls.",okText:"Cancel Trial",okType:"danger",onOk:()=>a("cancel")})}async function k(){u.value=!0,a("refresh"),setTimeout(()=>{u.value=!1},500)}function z({key:S}){S==="data"?a("export-data"):S==="python"&&a("export-python")}function N(){a("duplicate")}function O(){a("edit")}function E(){const S=t.trial.progress.total;Ce.confirm({title:"Delete trial?",content:`Delete trial and all ${S} API calls?`,okText:"Delete",okType:"danger",cancelText:"Cancel",onOk:()=>{a("delete")}})}return(S,U)=>{const $=ve,m=gt,L=vt,F=mt;return i(),p("div",Jn,[s("div",Xn,[c.value?(i(),Q($,{key:0,type:"primary",size:"large",disabled:!S.isLeader,onClick:h},{default:A(()=>[I(H(wt)),U[0]||(U[0]=D(" Start Trial "))]),_:1,__:[0]},8,["disabled"])):P("",!0),d.value?(i(),Q($,{key:1,size:"large",disabled:!S.isLeader,loading:o.value,onClick:_},{default:A(()=>[o.value?P("",!0):(i(),Q(H(Us),{key:0})),D(" "+b(o.value?"Pausing...":"Pause"),1)]),_:1},8,["disabled","loading"])):P("",!0),f.value?(i(),Q($,{key:2,type:"primary",size:"large",disabled:!S.isLeader||n.value,loading:n.value,onClick:R},{default:A(()=>[n.value?P("",!0):(i(),Q(H(wt),{key:0})),D(" "+b(n.value?"Resuming...":"Resume"),1)]),_:1},8,["disabled","loading"])):P("",!0),g.value?(i(),Q($,{key:3,danger:"",size:"large",disabled:!S.isLeader,onClick:w},{default:A(()=>[I(H(zs)),U[1]||(U[1]=D(" Cancel "))]),_:1,__:[1]},8,["disabled"])):P("",!0)]),s("div",Kn,[I($,{size:"large",loading:u.value,onClick:k,title:"Refresh trial data from database"},{default:A(()=>[u.value?(i(),Q(H(Gt),{key:1,spin:""})):(i(),Q(H(Bs),{key:0})),D(" "+b(u.value?"Refreshing...":"Refresh"),1)]),_:1},8,["loading"]),I(F,null,{overlay:A(()=>[I(L,{onClick:z},{default:A(()=>[I(m,{key:"data"},{default:A(()=>[I(H(Ws)),U[3]||(U[3]=D(" Export Data "))]),_:1,__:[3]}),I(m,{key:"python"},{default:A(()=>[I(H(Hs)),U[4]||(U[4]=D(" Export Python Script "))]),_:1,__:[4]})]),_:1})]),default:A(()=>[I($,{size:"large"},{default:A(()=>[U[2]||(U[2]=D(" Export ")),I(H(js))]),_:1,__:[2]})]),_:1})]),s("div",Qn,[I($,{size:"large",disabled:!S.isLeader,onClick:N},{default:A(()=>[I(H(ht)),U[5]||(U[5]=D(" Duplicate "))]),_:1,__:[5]},8,["disabled"]),S.trial.status==="draft"?(i(),Q($,{key:0,size:"large",disabled:!S.isLeader,onClick:O},{default:A(()=>[I(H(qs)),U[6]||(U[6]=D(" Edit "))]),_:1,__:[6]},8,["disabled"])):P("",!0),I($,{danger:"",size:"large",disabled:!S.isLeader,onClick:E},{default:A(()=>[I(H(Gs)),U[7]||(U[7]=D(" Delete "))]),_:1,__:[7]},8,["disabled"])])])}}}),Zn=re(Yn,[["__scopeId","data-v-e642c431"]]),eo={class:"snapshot-debug"},to={class:"debug-header"},so={class:"status-row"},ao={key:0,class:"badge success"},no={key:1,class:"badge warning"},oo={key:0,class:"status-row"},lo={key:0,class:"variables-section"},ro={class:"variable-header"},io={class:"var-name"},uo={class:"var-type"},co={key:0,class:"snapshot-content"},po={class:"snapshot-meta"},fo={key:0},mo={class:"snapshot-items"},vo={class:"items-preview"},go={class:"item-index"},ho={class:"item-value"},yo={key:0,class:"item-attrs"},bo={key:0,class:"more-indicator"},_o={key:1,class:"no-snapshot"},To={key:0},$o={key:1,class:"legacy-warning"},Co={class:"debug-footer"},ko=le({__name:"SnapshotDebugModal",props:{visible:{type:Boolean},trial:{},migrating:{type:Boolean}},emits:["close","migrate"],setup(r){const e=r,t=M(()=>e.trial.templateConfig?.hasSnapshots===!0),a=M(()=>e.trial.templateConfig?.variables||{});function o(f){return"snapshot"in f&&f.snapshot!=null}function n(f){return f.snapshot}function u(f){return o(f)?`${n(f).source.type} (snapshot)`:f.type==="value"?"Direct values":f.type==="list"?"List reference":"Unknown"}function c(){for(const f of Object.values(a.value))if(o(f)){const g=n(f);if(g.source?.snapshotDate)return new Date(g.source.snapshotDate).toLocaleString()}return"Unknown"}function d(){const f={trialId:e.trial.id,trialName:e.trial.name,hasSnapshots:t.value,variables:a.value};navigator.clipboard.writeText(JSON.stringify(f,null,2)),ne.success("Debug info copied to clipboard")}return(f,g)=>{const h=qe,_=Ge,R=ve,w=Ce;return i(),Q(w,{visible:f.visible,title:"Variable Snapshot Debug View",width:"80%",footer:null,onCancel:g[2]||(g[2]=k=>f.$emit("close"))},{default:A(()=>[s("div",eo,[s("div",to,[s("div",so,[g[5]||(g[5]=s("span",{class:"label"},"Snapshot Status:",-1)),t.value?(i(),p("span",ao,[I(H(Jt)),g[3]||(g[3]=D(" Snapshots Enabled "))])):(i(),p("span",no,[I(H(Pe)),g[4]||(g[4]=D(" Legacy Mode (No Snapshots) "))]))]),t.value?(i(),p("div",oo,[g[6]||(g[6]=s("span",{class:"label"},"Snapshot Date:",-1)),s("span",null,b(c()),1)])):P("",!0)]),t.value?(i(),p("div",lo,[g[8]||(g[8]=s("h3",null,"Variable Snapshots",-1)),(i(!0),p(Z,null,ee(a.value,(k,z)=>(i(),p("div",{key:z,class:"variable-card"},[s("div",ro,[s("span",io,b(z),1),s("span",uo,b(u(k)),1)]),o(k)?(i(),p("div",co,[s("div",po,[s("span",null,"Source: "+b(n(k).source.type),1),n(k).source.listName?(i(),p("span",fo," List: "+b(n(k).source.listName),1)):P("",!0),s("span",null,"Items: "+b(n(k).items.length),1)]),s("div",mo,[s("div",vo,[(i(!0),p(Z,null,ee(n(k).items.slice(0,5),(N,O)=>(i(),p("div",{key:O,class:"item-row"},[s("span",go,b(O+1)+".",1),s("span",ho,b(N.value),1),N.attributes&&Object.keys(N.attributes).length>0?(i(),p("span",yo,[(i(!0),p(Z,null,ee(N.attributes,(E,S)=>(i(),Q(h,{key:S,size:"small"},{default:A(()=>[D(b(S)+": "+b(E),1)]),_:2},1024))),128))])):P("",!0)]))),128)),n(k).items.length>5?(i(),p("div",bo," ... and "+b(n(k).items.length-5)+" more items ",1)):P("",!0)])])])):(i(),p("div",_o,[I(H(Pe)),g[7]||(g[7]=D(" No snapshot - using live reference ")),k.listId?(i(),p("span",To,"List ID: "+b(k.listId),1)):P("",!0)]))]))),128))])):(i(),p("div",$o,[I(_,{message:"Legacy Trial",description:"This trial was created before snapshots were implemented. Variable lists are loaded dynamically from the database, which means changes to lists will affect trial duplication.",type:"warning","show-icon":""}),I(R,{type:"primary",onClick:g[0]||(g[0]=k=>f.$emit("migrate")),loading:f.migrating,style:{"margin-top":"16px"}},{default:A(()=>[I(H(Js)),g[9]||(g[9]=D(" Migrate to Snapshots "))]),_:1,__:[9]},8,["loading"])])),s("div",Co,[I(R,{onClick:d},{default:A(()=>[I(H(ht)),g[10]||(g[10]=D(" Copy Debug Info "))]),_:1,__:[10]}),I(R,{onClick:g[1]||(g[1]=k=>f.$emit("close"))},{default:A(()=>g[11]||(g[11]=[D("Close")])),_:1,__:[11]})])])]),_:1},8,["visible"])}}}),wo=re(ko,[["__scopeId","data-v-726379cc"]]),So={class:"trial-detail-view"},Io={key:0,class:"detail-content"},Eo={class:"detail-section"},Ro={class:"detail-grid"},Fo={class:"detail-item"},Po={key:0,class:"detail-item"},xo={key:1,class:"detail-item"},Ao={class:"detail-item"},Vo={class:"detail-item"},Oo={class:"detail-section"},Do={class:"detail-grid"},No={key:0,class:"detail-item full-width"},Lo={key:1,class:"detail-item full-width"},Mo={class:"detail-item"},Uo={class:"detail-item"},zo={style:{display:"flex","align-items":"center",gap:"8px"}},Bo={key:0,class:"snapshot-badge success"},jo={key:1,class:"snapshot-badge warning"},Wo={class:"detail-item"},Ho={key:2,class:"detail-item"},qo={key:0,class:"detail-section"},Go={class:"detail-grid"},Jo={class:"detail-item"},Xo={class:"detail-item"},Ko={class:"detail-item"},Qo={class:"detail-section"},Yo={class:"model-configs"},Zo={class:"config-header"},el=["src","alt"],tl={class:"provider-name"},sl={class:"config-details"},al={class:"config-item"},nl={class:"config-params"},ol={class:"param-list"},ll={key:0,class:"config-item"},rl={class:"cost"},il={key:1,class:"config-item"},ul={class:"cost"},dl={class:"config-item"},cl={class:"snapshot-debug"},pl=le({__name:"TrialDetailView",props:{trial:{},isCollapsed:{type:Boolean}},emits:["toggle-collapse"],setup(r){const e=r,t=q(!1),{calculateTemplateTokens:a,estimateTotalCost:o,formatCost:n}=Je(),u=M(()=>{const $=e.trial.started||e.trial.created,L=(e.trial.completed||new Date).getTime()-$.getTime(),F=Math.floor(L/(1e3*60*60)),l=Math.floor(L%(1e3*60*60)/(1e3*60));return F>0?`${F}h ${l}m`:`${l}m`}),c=M(()=>({draft:"Not started",pending:"Waiting to start",running:"Executing API calls",paused:"Execution paused",completed:"All calls completed",failed:"Execution failed",cancelled:"Execution cancelled"})[e.trial.status]||e.trial.status),d=M(()=>e.trial.type==="template"&&e.trial.templateConfig?.variables?Object.keys(e.trial.templateConfig.variables).length:0),f=M(()=>Math.round(e.trial.progress.total*750)),g=M(()=>e.trial.type==="template"&&e.trial.templateConfig?e.trial.templateConfig.hasSnapshots===!0:!1),h=M(()=>"text"),_=M(()=>1),R=M(()=>e.trial.progress.total/_.value);function w($){return $?new Date($).toLocaleString():"N/A"}function k(){if(e.trial.templateConfig?.templateName)return e.trial.templateConfig.templateName;const $=e.trial.templateConfig?.template||"Unknown Template";return $.length>50?$.substring(0,50)+"...":$}function z(){return e.trial.spreadsheetConfig?.datasetId||"Unknown Dataset"}function N($){return{"openai-chat":"OpenAI","anthropic-messages":"Anthropic",openrouter:"OpenRouter","ollama-chat":"Ollama","ollama-generate":"Ollama"}[$]||$}function O($){}async function E(){try{ne.info("Migration feature coming soon"),t.value=!1}catch($){ne.error("Failed to migrate trial"),V.error("Migration error:",$)}}function S($){const m=$.modelSnapshot;return m?.capabilities?.inputCostPerToken?`$${((m.capabilities.inputCostPerToken+m.capabilities.outputCostPerToken)*1e3).toFixed(8)}/1k tokens`:null}function U($){if(!e.trial.configurations||!$.modelSnapshot)return null;let m=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)m=a(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else return null;if(!m||m.totalTokens===0)return null;const L=o(m.totalTokens,m.combinationCount,$.modelSnapshot,$.parameters);if(!L.meta.hasValidCost||L.cost.total.expected===-1)return null;const F=(e.trial.repeatCount||1)*L.cost.total.expected;return n({...L,cost:{...L.cost,total:{...L.cost.total,expected:F}}},"compact")}return($,m)=>{const L=ve;return i(),p("div",So,[s("div",{class:"detail-header",onClick:m[0]||(m[0]=F=>$.$emit("toggle-collapse"))},[m[3]||(m[3]=s("h3",null,"Trial Details",-1)),I(H(Xs),{class:te(["collapse-icon",{rotated:$.isCollapsed}])},null,8,["class"])]),$.isCollapsed?P("",!0):(i(),p("div",Io,[s("div",Eo,[m[9]||(m[9]=s("h4",null,"Basic Information",-1)),s("div",Ro,[s("div",Fo,[m[4]||(m[4]=s("label",null,"Created:",-1)),s("span",null,b(w($.trial.created)),1)]),$.trial.started?(i(),p("div",Po,[m[5]||(m[5]=s("label",null,"Started:",-1)),s("span",null,b(w($.trial.started)),1)])):P("",!0),$.trial.completed?(i(),p("div",xo,[m[6]||(m[6]=s("label",null,"Completed:",-1)),s("span",null,b(w($.trial.completed)),1)])):P("",!0),s("div",Ao,[m[7]||(m[7]=s("label",null,"Duration:",-1)),s("span",null,b(u.value),1)]),s("div",Vo,[m[8]||(m[8]=s("label",null,"Status:",-1)),s("span",null,b($.trial.status)+" - "+b(c.value),1)])])]),s("div",Oo,[m[19]||(m[19]=s("h4",null,"Configuration",-1)),s("div",Do,[$.trial.type==="template"?(i(),p("div",No,[m[10]||(m[10]=s("label",null,"Template:",-1)),s("span",null,b(k()),1)])):P("",!0),$.trial.type==="spreadsheet"?(i(),p("div",Lo,[m[11]||(m[11]=s("label",null,"Dataset:",-1)),s("span",null,b(z()),1)])):P("",!0),s("div",Mo,[m[12]||(m[12]=s("label",null,"Variable Lists:",-1)),s("span",null,b(d.value)+" lists",1)]),s("div",Uo,[m[16]||(m[16]=s("label",null,"Data Snapshot:",-1)),s("div",zo,[g.value?(i(),p("span",Bo,[I(H(Jt)),m[13]||(m[13]=D(" Captured "))])):(i(),p("span",jo,[I(H(Pe)),m[14]||(m[14]=D(" Live Reference "))])),$.trial.type==="template"?(i(),Q(L,{key:2,size:"small",type:"link",onClick:m[1]||(m[1]=F=>t.value=!0)},{default:A(()=>[I(H(Xt)),m[15]||(m[15]=D(" Debug "))]),_:1,__:[15]})):P("",!0)])]),s("div",Wo,[m[17]||(m[17]=s("label",null,"Token Estimate:",-1)),s("span",null,"~"+b(f.value)+" tokens",1)]),h.value?(i(),p("div",Ho,[m[18]||(m[18]=s("label",null,"Output Type:",-1)),s("span",{class:te(["output-type",`type-${h.value}`])},b(h.value),3)])):P("",!0)])]),_.value>1?(i(),p("div",qo,[m[23]||(m[23]=s("h4",null,"Repeat Configuration",-1)),s("div",Go,[s("div",Jo,[m[20]||(m[20]=s("label",null,"Times per prompt:",-1)),s("span",null,b(_.value),1)]),s("div",Xo,[m[21]||(m[21]=s("label",null,"Total combinations:",-1)),s("span",null,b(R.value),1)]),s("div",Ko,[m[22]||(m[22]=s("label",null,"Total API calls:",-1)),s("span",null,b($.trial.progress.total),1)])])])):P("",!0),s("div",Qo,[m[29]||(m[29]=s("h4",null,"Model Configurations",-1)),s("div",Yo,[(i(!0),p(Z,null,ee($.trial.configurations,(F,l)=>(i(),p("div",{key:l,class:"model-config-card"},[s("div",Zo,[(F.provider,void 0)?(i(),p("img",{key:0,src:(F.provider,void 0),alt:F.provider,class:"provider-logo"},null,8,el)):P("",!0),s("span",tl,b(N(F.provider)),1)]),s("div",sl,[s("div",al,[m[24]||(m[24]=s("label",null,"Model:",-1)),s("span",null,b(F.modelId),1)]),s("div",nl,[m[25]||(m[25]=s("label",null,"Parameters:",-1)),s("div",ol,[(i(!0),p(Z,null,ee(F.parameters,(W,X)=>(i(),p("span",{key:X,class:"param-tag"},b(X)+": "+b(W),1))),128))])]),S(F)?(i(),p("div",ll,[m[26]||(m[26]=s("label",null,"Cost Rate:",-1)),s("span",rl,b(S(F)),1)])):P("",!0),U(F)?(i(),p("div",il,[m[27]||(m[27]=s("label",null,"Total Trial Cost:",-1)),s("span",ul,b(U(F)),1)])):P("",!0),s("div",dl,[m[28]||(m[28]=s("label",null,"Model Snapshot:",-1)),s("pre",cl,b(JSON.stringify(F.modelSnapshot,null,2)),1)])])]))),128))])])])),t.value?(i(),Q(wo,{key:1,visible:t.value,trial:$.trial,onClose:m[2]||(m[2]=F=>t.value=!1),onMigrate:E},null,8,["visible","trial"])):P("",!0)])}}}),fl=re(pl,[["__scopeId","data-v-e677baaf"]]),ml={class:"filter-bar"},vl={class:"search-container"},gl=le({__name:"TrialResultsFilterBar",props:{statusFilter:{},configFilter:{},searchQuery:{},visibleColumns:{},configurations:{},apiCalls:{},showRepeatColumn:{type:Boolean}},emits:["update:statusFilter","update:configFilter","update:searchQuery","update:visibleColumns","openPostProcessing"],setup(r,{emit:e}){const t=r,a=e,o=M(()=>{const f=[{key:"status",label:"Status"},{key:"configuration",label:"Configuration"},{key:"variables",label:"Variables"},{key:"response",label:"Response"},{key:"parsedResponse",label:"Parsed Response"},{key:"postProcessedResponse",label:"Post-Processed"},{key:"length",label:"Length"},{key:"latency",label:"Latency"}];return t.showRepeatColumn&&f.splice(2,0,{key:"repeat",label:"Repeat Index"}),f}),n=M(()=>{const f={total:t.apiCalls.length,completed:0,failed:0,running:0,pending:0};return t.apiCalls.forEach(g=>{g.status==="completed"?f.completed++:g.status==="failed"?f.failed++:g.status==="running"?f.running++:g.status==="pending"&&f.pending++}),f});function u(f){return f.modelSnapshot?.displayName||`${f.provider} - ${f.modelId}`}const c=es(f=>{const g=f.target.value;a("update:searchQuery",g)},300);function d(f){const g=[...t.visibleColumns],h=g.indexOf(f);if(h>-1)g.splice(h,1);else{const _=o.value.map(k=>k.key),R=_.indexOf(f);let w=0;for(let k=0;k<R;k++)g.includes(_[k])&&w++;g.splice(w,0,f)}a("update:visibleColumns",g)}return(f,g)=>{const h=Qs,_=Ks,R=Kt,w=ve,k=Qt,z=gt,N=vt,O=mt;return i(),p("div",ml,[I(_,{value:f.statusFilter,onChange:g[0]||(g[0]=E=>f.$emit("update:statusFilter",E)),placeholder:"Filter by status",style:{width:"150px"}},{default:A(()=>[I(h,{value:"all"},{default:A(()=>[D(" All ("+b(n.value.total)+") ",1)]),_:1}),I(h,{value:"completed"},{default:A(()=>[D(" Completed ("+b(n.value.completed)+") ",1)]),_:1}),I(h,{value:"failed"},{default:A(()=>[D(" Failed ("+b(n.value.failed)+") ",1)]),_:1}),I(h,{value:"running"},{default:A(()=>[D(" Running ("+b(n.value.running)+") ",1)]),_:1}),I(h,{value:"pending"},{default:A(()=>[D(" Pending ("+b(n.value.pending)+") ",1)]),_:1})]),_:1},8,["value"]),I(_,{value:f.configFilter,onChange:g[1]||(g[1]=E=>f.$emit("update:configFilter",E)),mode:"multiple",placeholder:"Filter by configuration",style:{width:"250px"},"max-tag-count":2},{default:A(()=>[I(h,{value:""},{default:A(()=>g[3]||(g[3]=[D("All Configurations")])),_:1,__:[3]}),(i(!0),p(Z,null,ee(f.configurations,(E,S)=>(i(),Q(h,{key:S,value:S.toString()},{default:A(()=>[D(b(u(E)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s("div",vl,[I(R,{value:f.searchQuery,onInput:H(c),placeholder:"Search in variables and responses...",style:{width:"400px"},"allow-clear":""},{prefix:A(()=>[I(H(jt))]),_:1},8,["value","onInput"])]),I(O,null,{overlay:A(()=>[I(N,null,{default:A(()=>[(i(!0),p(Z,null,ee(o.value,E=>(i(),Q(z,{key:E.key},{default:A(()=>[I(k,{checked:f.visibleColumns.includes(E.key),disabled:E.key==="status",onChange:S=>d(E.key)},{default:A(()=>[D(b(E.label),1)]),_:2},1032,["checked","disabled","onChange"])]),_:2},1024))),128))]),_:1})]),default:A(()=>[I(w,null,{default:A(()=>[I(H(Ys)),g[4]||(g[4]=D(" Columns "))]),_:1,__:[4]})]),_:1}),I(w,{type:"primary",onClick:g[2]||(g[2]=E=>f.$emit("openPostProcessing"))},{default:A(()=>[I(H(Yt)),g[5]||(g[5]=D(" Post-Process "))]),_:1,__:[5]})])}}}),hl=re(gl,[["__scopeId","data-v-e6112af3"]]),yl={class:"modal-content"},bl={class:"section"},_l={class:"info-grid"},Tl={class:"info-item"},$l={class:"monospace"},Cl={class:"info-item"},kl={class:"info-item"},wl={key:0,class:"info-item"},Sl={class:"info-item"},Il={key:1,class:"info-item"},El={key:2,class:"info-item"},Rl={key:3,class:"info-item"},Fl={key:0,class:"info-row"},Pl={class:"monospace"},xl={key:0,class:"section"},Al={class:"variables-list"},Vl={class:"variable-main"},Ol={class:"variable-label"},Dl={class:"variable-value"},Nl={key:0,class:"variable-attributes"},Ll={class:"attribute-label"},Ml={class:"attribute-value"},Ul={class:"section"},zl={class:"content-box prompt-display"},Bl={key:1,class:"section"},jl={key:0,class:"error-result"},Wl={key:1,class:"success-result"},Hl={class:"content-box response-content"},ql={key:0,class:"parsed-content-section"},Gl={class:"content-box parsed-content"},Jl={key:1,class:"post-processed-section"},Xl={class:"content-box post-processed-content"},Kl={key:2,class:"refusal-warning"},Ql={key:3,class:"refusal-warning"},Yl={class:"extraction-config-section"},Zl={class:"config-grid"},er={key:0,class:"config-item"},tr={class:"config-value"},sr={key:1,class:"config-item"},ar={class:"config-value"},nr={key:2,class:"config-item"},or={class:"config-value pattern"},lr={key:3,class:"config-item"},rr={class:"config-value"},ir={key:4,class:"config-item"},ur={class:"config-value"},dr={key:5,class:"config-item no-extraction"},cr={key:4,class:"post-processing-config-section"},pr={class:"config-grid"},fr={class:"config-item post-processing-item"},mr={class:"config-value"},vr={key:0,class:"config-item post-processing-item"},gr={class:"config-value"},hr={key:1,class:"config-item post-processing-item"},yr={class:"config-value pattern"},br={key:2,class:"config-item post-processing-item"},_r={class:"config-value"},Tr={key:3,class:"config-item post-processing-item"},$r={class:"config-value"},Cr={key:4,class:"config-item post-processing-item"},kr={class:"config-value"},wr={key:5,class:"usage-info"},Sr={class:"info-grid"},Ir={class:"info-item"},Er={class:"info-item"},Rr={class:"info-item"},Fr={key:0,class:"info-item"},Pr={class:"raw-data-section"},xr={class:"raw-data"},Ar={key:0},Vr={key:1,class:"raw-data"},Or={key:2},Dr={key:3,class:"raw-data"},Nr={class:"modal-footer"},Lr={key:0,class:"footer-left"},Mr={class:"position-indicator"},Ur={class:"footer-right"},zr=le({__name:"APICallDetailModalV3",props:{visible:{type:Boolean},apiCall:{},trial:{},allApiCalls:{}},emits:["update:visible","navigate"],setup(r,{emit:e}){const t=r,a=e,o=Fs(),n=M(()=>t.allApiCalls?t.allApiCalls.findIndex(C=>C.id===t.apiCall.id):-1),u=M(()=>t.allApiCalls?.length||0),c=M(()=>n.value>0),d=M(()=>n.value>=0&&n.value<u.value-1),f=M(()=>!c.value||!t.allApiCalls?null:t.allApiCalls[n.value-1]),g=M(()=>!d.value||!t.allApiCalls?null:t.allApiCalls[n.value+1]),h=M(()=>{if(t.apiCall.duration!==void 0)return t.apiCall.duration;if(!t.apiCall.completed||!t.apiCall.created)return null;const C=new Date(t.apiCall.created).getTime();return new Date(t.apiCall.completed).getTime()-C}),_=M(()=>{if(t.apiCall.modelName){const y=t.trial.configurations[t.apiCall.configurationIndex];return y?`${y.provider} / ${t.apiCall.modelName}`:t.apiCall.modelName}const C=t.trial.configurations[t.apiCall.configurationIndex];return C?`${C.provider} / ${C.modelId}`:null}),R=M(()=>{if(t.apiCall.cost!==void 0)return t.apiCall.cost;if(!t.apiCall.result?.usage)return null;const C=t.trial.configurations[t.apiCall.configurationIndex];if(!C)return null;const y=o.models.value.find(G=>G.provider===C.provider&&G.modelId===C.modelId);if(!y?.capabilities?.inputCostPerToken&&!y?.capabilities?.outputCostPerToken)return null;const v=(t.apiCall.result.usage.prompt_tokens||0)*(y.capabilities.inputCostPerToken||0),j=(t.apiCall.result.usage.completion_tokens||0)*(y.capabilities.outputCostPerToken||0);return v+j}),w=M(()=>{if(!t.apiCall.request)return"No request data";const C=JSON.parse(JSON.stringify(t.apiCall.request));return C.headers&&Object.keys(C.headers).forEach(y=>{(y.toLowerCase().includes("authorization")||y.toLowerCase().includes("api-key")||y.toLowerCase().includes("x-api-key"))&&(C.headers[y]="[REDACTED]")}),C.body&&typeof C.body=="object"&&(C.body.api_key&&(C.body.api_key="[REDACTED]"),C.body.apiKey&&(C.body.apiKey="[REDACTED]")),JSON.stringify(C,null,2)}),k=M(()=>t.apiCall.parserId?{parserId:t.apiCall.parserId,outputType:t.trial.type==="template"?t.trial.templateConfig?.outputType:void 0,extractPattern:t.trial.type==="template"?t.trial.templateConfig?.extractPattern:void 0,refusalWords:t.trial.type==="template"?t.trial.templateConfig?.refusalWords:void 0,rejectRefusalWords:t.trial.type==="template"?t.trial.templateConfig?.rejectRefusalWords:void 0}:t.trial.type!=="template"||!t.trial.templateConfig?{}:{parserId:t.trial.templateConfig.parserId,outputType:t.trial.templateConfig.outputType,extractPattern:t.trial.templateConfig.extractPattern,refusalWords:t.trial.templateConfig.refusalWords,rejectRefusalWords:t.trial.templateConfig.rejectRefusalWords}),z=M(()=>{const C=k.value;return!!(C.parserId||C.outputType||C.extractPattern||C.refusalWords&&C.refusalWords.length>0)}),N=M(()=>t.trial.postProcessingConfig||null),O=M(()=>t.apiCall.response?JSON.stringify({status:t.apiCall.response.status,headers:t.apiCall.response.headers,body:t.apiCall.response.body,latencyMs:t.apiCall.response.latencyMs},null,2):"No response data available"),E=M(()=>t.apiCall.result?JSON.stringify(t.apiCall.result,null,2):"No processed result available");function S(C){return{completed:"success",failed:"error",running:"processing",pending:"warning"}[C]||"default"}function U(){const C=t.trial.configurations[t.apiCall.configurationIndex];return C?.modelSnapshot?.displayName||C?.modelId||`Configuration ${t.apiCall.configurationIndex+1}`}function $(C){return(typeof C=="string"?new Date(C):C).toLocaleString()}function m(C){return C<1e3?`${C}ms`:C<6e4?`${(C/1e3).toFixed(1)}s`:`${Math.floor(C/6e4)}m ${(C%6e4/1e3).toFixed(0)}s`}function L(C){return C==null?"null":typeof C=="string"?C:typeof C=="number"||typeof C=="boolean"?String(C):JSON.stringify(C,null,2)}function F(C){return{network_error_no_response:"Network Error (No Response)",api_error_received:"API Error Response",parsing_error:"Response Parsing Error",timeout:"Request Timeout",rate_limit:"Rate Limit Exceeded"}[C]||C}function l(){a("update:visible",!1)}function W(){f.value&&a("navigate",f.value)}function X(){g.value&&a("navigate",g.value)}function T(C){if(t.visible)switch(C.key){case"ArrowLeft":C.preventDefault(),W();break;case"ArrowRight":C.preventDefault(),X();break;case"Escape":C.preventDefault(),l();break}}me(()=>{document.addEventListener("keydown",T)}),ye(()=>{document.removeEventListener("keydown",T)});async function x(){const C={id:t.apiCall.id,status:t.apiCall.status,configuration:U(),provider:_.value,variables:t.apiCall.variables,variableAttributes:t.apiCall.variableAttributes,prompt:t.apiCall.prompt,fullApiResponse:t.apiCall.response,processedResult:t.apiCall.result,extractionConfig:k.value,postProcessingConfig:N.value,created:t.apiCall.created,completed:t.apiCall.completed,duration:h.value?`${h.value}ms`:null,cost:R.value?`$${R.value.toFixed(4)}`:null},y=JSON.stringify(C,null,2);try{await navigator.clipboard.writeText(y),ne.success("Details copied to clipboard!")}catch(v){V.error("Failed to copy to clipboard",v),ne.error("Failed to copy to clipboard")}}return(C,y)=>{const v=qe,j=Ge,G=ea,K=Zs,Y=ve,ae=Ce;return i(),Q(ae,{open:C.visible,onCancel:y[0]||(y[0]=ce=>a("update:visible",!1)),title:"API Call Details",width:1400,footer:null,"body-style":{padding:0,height:"85vh",display:"flex",flexDirection:"column"},centered:!0,"destroy-on-close":!0,class:"api-call-detail-modal"},{default:A(()=>[s("div",yl,[s("div",bl,[y[10]||(y[10]=s("h3",null,"Overview",-1)),s("div",_l,[s("div",Tl,[y[1]||(y[1]=s("label",null,"Call ID:",-1)),s("span",$l,b(C.apiCall.id),1)]),s("div",Cl,[y[2]||(y[2]=s("label",null,"Status:",-1)),I(v,{color:S(C.apiCall.status)},{default:A(()=>[D(b(C.apiCall.status.toUpperCase()),1)]),_:1},8,["color"])]),s("div",kl,[y[3]||(y[3]=s("label",null,"Configuration:",-1)),s("span",null,b(U()),1)]),C.apiCall.repeatIndex!==void 0?(i(),p("div",wl,[y[4]||(y[4]=s("label",null,"Repeat:",-1)),s("span",null,"#"+b(C.apiCall.repeatIndex+1),1)])):P("",!0),s("div",Sl,[y[5]||(y[5]=s("label",null,"Created:",-1)),s("span",null,b($(C.apiCall.created)),1)]),C.apiCall.completed?(i(),p("div",Il,[y[6]||(y[6]=s("label",null,"Completed:",-1)),s("span",null,b($(C.apiCall.completed)),1)])):P("",!0),h.value?(i(),p("div",El,[y[7]||(y[7]=s("label",null,"Duration:",-1)),s("span",null,b(m(h.value)),1)])):P("",!0),C.apiCall.result?.latency?(i(),p("div",Rl,[y[8]||(y[8]=s("label",null,"API Latency:",-1)),s("span",null,b(C.apiCall.result.latency)+"ms",1)])):P("",!0)]),_.value?(i(),p("div",Fl,[y[9]||(y[9]=s("label",null,"Provider/Model:",-1)),s("span",Pl,b(_.value),1)])):P("",!0)]),C.apiCall.variables&&Object.keys(C.apiCall.variables).length>0?(i(),p("div",xl,[y[11]||(y[11]=s("h3",null,"Variables",-1)),s("div",Al,[(i(!0),p(Z,null,ee(C.apiCall.variables,(ce,ge)=>(i(),p("div",{key:ge,class:"variable-group"},[s("div",Vl,[s("label",Ol,b(ge)+":",1),s("span",Dl,b(ce),1)]),C.apiCall.variableAttributes&&C.apiCall.variableAttributes[ge]?(i(),p("div",Nl,[(i(!0),p(Z,null,ee(C.apiCall.variableAttributes[ge],(Ye,De)=>(i(),p("div",{key:De,class:"attribute-item"},[s("label",Ll,b(De)+":",1),s("span",Ml,b(Ye),1)]))),128))])):P("",!0)]))),128))])])):P("",!0),s("div",Ul,[y[12]||(y[12]=s("h3",null,"Resolved Prompt",-1)),s("div",zl,b(C.apiCall.prompt),1)]),C.apiCall.result?(i(),p("div",Bl,[y[35]||(y[35]=s("h3",null,"Response",-1)),C.apiCall.status==="failed"&&C.apiCall.result.error?(i(),p("div",jl,[I(j,{type:"error",message:C.apiCall.result.error,description:C.apiCall.result.errorType?`Error Type: ${F(C.apiCall.result.errorType)}`:void 0,"show-icon":""},null,8,["message","description"])])):C.apiCall.result.content?(i(),p("div",Wl,[s("div",Hl,b(C.apiCall.result.content),1),C.apiCall.result.parsedContent!==void 0?(i(),p("div",ql,[y[13]||(y[13]=s("h4",null,"Extracted Value (Original)",-1)),s("div",Gl,b(L(C.apiCall.result.parsedContent)),1)])):P("",!0),C.apiCall.result.postParsedContent!==void 0?(i(),p("div",Jl,[y[14]||(y[14]=s("h4",null,"Post-Processed Value",-1)),s("div",Xl,b(L(C.apiCall.result.postParsedContent)),1)])):P("",!0),C.apiCall.result.refused?(i(),p("div",Kl,[I(j,{type:"warning",message:"Response flagged as refusal (Original Extraction)",description:"This response matched configured refusal patterns","show-icon":""})])):P("",!0),C.apiCall.result.postRefused?(i(),p("div",Ql,[I(j,{type:"warning",message:"Response flagged as refusal (Post-Processing)",description:"This response matched post-processing refusal patterns","show-icon":""})])):P("",!0),s("div",Yl,[y[21]||(y[21]=s("h4",null,"Original Extraction Configuration",-1)),s("div",Zl,[k.value.parserId?(i(),p("div",er,[y[15]||(y[15]=s("label",null,"Parser ID:",-1)),s("span",tr,b(k.value.parserId),1)])):P("",!0),k.value.outputType?(i(),p("div",sr,[y[16]||(y[16]=s("label",null,"Output Type:",-1)),s("span",ar,b(k.value.outputType),1)])):P("",!0),k.value.extractPattern?(i(),p("div",nr,[y[17]||(y[17]=s("label",null,"Extract Pattern:",-1)),s("span",or,b(k.value.extractPattern),1)])):P("",!0),k.value.refusalWords&&k.value.refusalWords.length>0?(i(),p("div",lr,[y[18]||(y[18]=s("label",null,"Refusal Words:",-1)),s("span",rr,b(k.value.refusalWords.join(", ")),1)])):P("",!0),k.value.rejectRefusalWords!==void 0?(i(),p("div",ir,[y[19]||(y[19]=s("label",null,"Reject on Refusal:",-1)),s("span",ur,b(k.value.rejectRefusalWords?"Yes":"No"),1)])):P("",!0),z.value?P("",!0):(i(),p("div",dr,y[20]||(y[20]=[s("span",{class:"no-config-message"},"No extraction configuration set for this trial",-1)])))])]),N.value&&N.value.enabled?(i(),p("div",cr,[y[29]||(y[29]=s("h4",null,"Post-Processing Configuration",-1)),s("div",pr,[s("div",fr,[y[23]||(y[23]=s("label",null,"Status:",-1)),s("span",mr,[I(v,{color:"processing"},{default:A(()=>y[22]||(y[22]=[D("Enabled")])),_:1,__:[22]})])]),N.value.outputType?(i(),p("div",vr,[y[24]||(y[24]=s("label",null,"Output Type:",-1)),s("span",gr,b(N.value.outputType),1)])):P("",!0),N.value.extractPattern?(i(),p("div",hr,[y[25]||(y[25]=s("label",null,"Extract Pattern:",-1)),s("span",yr,b(N.value.extractPattern),1)])):P("",!0),N.value.refusalWords&&N.value.refusalWords.length>0?(i(),p("div",br,[y[26]||(y[26]=s("label",null,"Refusal Words:",-1)),s("span",_r,b(N.value.refusalWords.join(", ")),1)])):P("",!0),N.value.rejectRefusalWords!==void 0?(i(),p("div",Tr,[y[27]||(y[27]=s("label",null,"Reject on Refusal:",-1)),s("span",$r,b(N.value.rejectRefusalWords?"Yes":"No"),1)])):P("",!0),N.value.updatedAt?(i(),p("div",Cr,[y[28]||(y[28]=s("label",null,"Last Updated:",-1)),s("span",kr,b($(N.value.updatedAt)),1)])):P("",!0)])])):P("",!0),C.apiCall.result.usage?(i(),p("div",wr,[y[34]||(y[34]=s("h4",null,"Token Usage",-1)),s("div",Sr,[s("div",Ir,[y[30]||(y[30]=s("label",null,"Prompt Tokens:",-1)),s("span",null,b(C.apiCall.result.usage.prompt_tokens||0),1)]),s("div",Er,[y[31]||(y[31]=s("label",null,"Completion Tokens:",-1)),s("span",null,b(C.apiCall.result.usage.completion_tokens||0),1)]),s("div",Rr,[y[32]||(y[32]=s("label",null,"Total Tokens:",-1)),s("span",null,b(C.apiCall.result.usage.total_tokens||0),1)]),R.value?(i(),p("div",Fr,[y[33]||(y[33]=s("label",null,"Cost:",-1)),s("span",null,"$"+b(R.value.toFixed(4)),1)])):P("",!0)])])):P("",!0)])):P("",!0)])):P("",!0),I(K,{ghost:""},{default:A(()=>[I(G,{key:"raw",header:"Raw Data"},{default:A(()=>[s("div",Pr,[y[36]||(y[36]=s("h4",null,"HTTP Request",-1)),s("pre",xr,b(w.value),1),C.apiCall.response?(i(),p("h4",Ar,"Full API Response")):P("",!0),C.apiCall.response?(i(),p("pre",Vr,b(O.value),1)):P("",!0),C.apiCall.result?(i(),p("h4",Or,"Processed Result")):P("",!0),C.apiCall.result?(i(),p("pre",Dr,b(E.value),1)):P("",!0)])]),_:1})]),_:1})]),s("div",Nr,[C.allApiCalls&&u.value>1?(i(),p("div",Lr,[I(Y,{onClick:W,disabled:!c.value,size:"large",class:"nav-button"},{default:A(()=>y[37]||(y[37]=[D(" ← Previous ")])),_:1,__:[37]},8,["disabled"]),s("span",Mr,b(n.value+1)+" of "+b(u.value),1),I(Y,{onClick:X,disabled:!d.value,size:"large",class:"nav-button"},{default:A(()=>y[38]||(y[38]=[D(" Next → ")])),_:1,__:[38]},8,["disabled"])])):P("",!0),s("div",Ur,[I(Y,{onClick:l,size:"large"},{default:A(()=>y[39]||(y[39]=[D(" Close ")])),_:1,__:[39]}),I(Y,{type:"primary",onClick:x,size:"large"},{default:A(()=>[I(H(ht)),y[40]||(y[40]=D(" Copy Details "))]),_:1,__:[40]})])])]),_:1},8,["open"])}}}),ls=re(zr,[["__scopeId","data-v-0af69783"]]),Br={class:"post-processing-modal"},jr={key:2,class:"current-extraction"},Wr={class:"parser-info"},Hr={class:"parser-name"},qr={key:3,class:"current-post-processing"},Gr={class:"parser-info"},Jr={class:"parser-name"},Xr={key:4,class:"test-results"},Kr={class:"footer-container"},Qr={key:0,class:"footer-statistics"},Yr={class:"stat-inline"},Zr={class:"stat-inline"},ei={class:"stat-inline"},ti={class:"stat-inline"},si={key:0,class:"stat-sample-note"},ai={key:1,class:"footer-progress"},ni={class:"processing-message"},oi={class:"footer-buttons"},li=le({__name:"PostProcessingModalV2",props:{visible:{type:Boolean},trial:{}},emits:["close"],setup(r,{emit:e}){const t=r,a=e,o=Xe(),n=ua(),u=q(t.visible),c=q(!1),d=q(!1),f=q(!1),g=q(null),h=q({postParserId:null}),_=q(""),R=q(0),w=q([]),k=q(null),z=[{title:"Variables",dataIndex:"variables",key:"variables",width:200,customRender:({text:T})=>Object.entries(T).map(([x,C])=>`${x}: ${C}`).join(", ")},{title:"Original",dataIndex:"original",key:"original",slots:{customRender:"original"}},{title:"Post-Processed",dataIndex:"postProcessed",key:"postProcessed",slots:{customRender:"postProcessed"}},{title:"Changed",dataIndex:"changed",key:"changed",width:100,slots:{customRender:"changed"}}],N=M(()=>t.trial.parserId?n.parsers.find(T=>T.id===t.trial.parserId):null),O=M(()=>t.trial.postParserId?n.parsers.find(T=>T.id===t.trial.postParserId):null);function E(T){switch(T){case"regex":return"blue";case"javascript":return"orange";case"python":return"green";default:return"default"}}function S(T){return T===void 0?"(no match)":T===null?"null":typeof T=="string"&&T.length>50?T.substring(0,50)+"...":String(T)}function U(){d.value=!0}function $(T){g.value=T,f.value=!0}async function m(T,x){if(!T||!x){w.value=[],k.value=null;return}await L(x),await F(x)}async function L(T){const x=o.apiCalls.value.filter(y=>y.result?.content).slice(0,10),C=[];for(const y of x){const v=await Ct.executeParser(y.result.content,T);C.push({id:y.id,variables:y.variables,original:y.result.parsedContent,postProcessed:v.success?v.value:null,changed:v.success&&v.value!==y.result.parsedContent})}w.value=C}async function F(T){if(!o.apiCalls.value.length){k.value=null;return}const x=o.apiCalls.value,C=x.length,y=x.filter(ce=>ce.result?.content),v=y.length,j=Math.min(50,v),G=y.slice(0,j);let K=0,Y=0;for(const ce of G){const ge=await Ct.executeParser(ce.result.content,T);ge.success&&ge.value!==void 0&&(K++,ge.value!==ce.result.parsedContent&&Y++)}const ae=j<v;if(ae&&j>0){const ce=v/j;K=Math.round(K*ce),Y=Math.round(Y*ce)}k.value={total:C,withContent:v,matches:K,changed:Y,sampled:ae,sampleSize:j}}async function l(){c.value=!0,_.value="Clearing post-processing...";try{const T=await It.updatePostParserId(t.trial.id,null,!1);if(T.ok)h.value.postParserId=null,w.value=[],k.value=null,ne.success("Post-processing cleared"),await o.refreshFromDatabase(t.trial.id);else throw T.error}catch(T){V.error("Failed to clear post-processing:",T),ne.error("Failed to clear post-processing")}finally{c.value=!1,_.value=""}}async function W(){if(!h.value.postParserId){ne.warning("Please select a parser");return}c.value=!0,R.value=0;try{const T=o.apiCalls.value.filter(v=>v.status==="completed"&&v.result?.content),x=T.length>0;let C=!1;if(x){const G=(n.parsers.find(K=>K.id===h.value.postParserId)?.type||"parser")==="python"?`Apply post-processing to ${T.length} existing calls?

Note: Python parsers may take several minutes for large trials.`:`Apply post-processing to ${T.length} existing calls?`;C=confirm(G)}C?(_.value=`Applying to ${T.length} calls...`,R.value=10):(_.value="Saving configuration...",R.value=50);const y=await It.updatePostParserId(t.trial.id,h.value.postParserId,C);if(y.ok)R.value=90,_.value="Refreshing data...",await o.refreshFromDatabase(t.trial.id),R.value=100,_.value="Complete!",ne.success(C?`Post-processing applied to ${T.length} calls`:"Post-processing configured for future calls"),c.value=!1,setTimeout(()=>{X()},1e3);else throw y.error}catch(T){V.error("Failed to apply post-processing:",T),ne.error("Failed to apply post-processing"),c.value=!1,_.value="",R.value=0}}function X(){c.value||a("close")}return me(async()=>{if(await n.initialize(),t.trial.postParserId){h.value.postParserId=t.trial.postParserId;const T=n.parsers.find(x=>x.id===t.trial.postParserId);T&&(await L(T),await F(T))}else t.trial.postProcessingConfig?.enabled&&ne.info("Legacy post-processing config detected. Please select a parser to continue.")}),oe(()=>t.visible,T=>{u.value=T}),oe(u,T=>{!T&&!c.value&&a("close")}),(T,x)=>{const C=Ge,y=qe,v=ta,j=sa,G=aa,K=ve,Y=Ce;return i(),Q(Y,{visible:u.value,"onUpdate:visible":x[1]||(x[1]=ae=>u.value=ae),title:"Post-Process Extraction",width:"80%","mask-closable":!c.value,closable:!c.value,onCancel:X},{footer:A(()=>[s("div",Kr,[k.value&&h.value.postParserId&&!c.value?(i(),p("div",Qr,[s("span",Yr,[x[5]||(x[5]=s("span",{class:"stat-label"},"Total:",-1)),x[6]||(x[6]=D()),s("strong",null,b(k.value.total),1)]),x[13]||(x[13]=s("span",{class:"stat-divider"},"|",-1)),s("span",Zr,[x[7]||(x[7]=s("span",{class:"stat-label"},"With Content:",-1)),x[8]||(x[8]=D()),s("strong",null,b(k.value.withContent),1)]),x[14]||(x[14]=s("span",{class:"stat-divider"},"|",-1)),s("span",ei,[x[9]||(x[9]=s("span",{class:"stat-label"},"Est. Matches:",-1)),x[10]||(x[10]=D()),s("strong",null,b(k.value.matches),1)]),x[15]||(x[15]=s("span",{class:"stat-divider"},"|",-1)),s("span",ti,[x[11]||(x[11]=s("span",{class:"stat-label"},"Est. Changed:",-1)),x[12]||(x[12]=D()),s("strong",null,b(k.value.changed),1)]),k.value.sampled?(i(),p("span",si," ("+b(k.value.sampleSize)+" samples) ",1)):P("",!0)])):P("",!0),c.value?(i(),p("div",ai,[s("div",ni,b(_.value),1),I(G,{percent:R.value,status:R.value===100?"success":"active","stroke-width":4,style:{width:"100%"}},null,8,["percent","status"])])):P("",!0),s("div",oi,[O.value?(i(),Q(K,{key:0,onClick:l,disabled:c.value,danger:""},{default:A(()=>x[16]||(x[16]=[D(" Clear Post-Processing ")])),_:1,__:[16]},8,["disabled"])):P("",!0),I(K,{onClick:X,disabled:c.value},{default:A(()=>[D(b(c.value?"Processing...":"Close"),1)]),_:1},8,["disabled"]),I(K,{type:"primary",onClick:W,loading:c.value,disabled:!h.value.postParserId||h.value.postParserId===T.trial.postParserId},{default:A(()=>[D(b(c.value?_.value:"Apply Post-Processing"),1)]),_:1},8,["loading","disabled"])])])]),default:A(()=>[s("div",Br,[T.trial.status==="running"?(i(),Q(C,{key:0,message:"Trial is currently running",description:"Post-processing will apply to all completed calls and future results as they arrive.",type:"info","show-icon":"",style:{"margin-bottom":"20px"}})):T.trial.status==="draft"?(i(),Q(C,{key:1,message:"Trial not started",description:"Configure post-processing now. It will apply when the trial runs.",type:"warning","show-icon":"",style:{"margin-bottom":"20px"}})):P("",!0),N.value?(i(),p("div",jr,[x[2]||(x[2]=s("h4",null,"Current Primary Parser",-1)),s("div",Wr,[s("span",Hr,b(N.value.name),1),I(y,{color:E(N.value.type)},{default:A(()=>[D(b(N.value.type),1)]),_:1},8,["color"]),I(y,null,{default:A(()=>[D(b(N.value.outputType),1)]),_:1})])])):P("",!0),O.value?(i(),p("div",qr,[x[3]||(x[3]=s("h4",null,"Active Post-Processing Parser",-1)),s("div",Gr,[s("span",Jr,b(O.value.name),1),I(y,{color:E(O.value.type)},{default:A(()=>[D(b(O.value.type),1)]),_:1},8,["color"]),I(y,null,{default:A(()=>[D(b(O.value.outputType),1)]),_:1})])])):P("",!0),I(v,{label:O.value?"Change Post-Processing Parser":"Select Post-Processing Parser"},{default:A(()=>[I(ia,{modelValue:h.value.postParserId,"onUpdate:modelValue":x[0]||(x[0]=ae=>h.value.postParserId=ae),"allow-create":!0,"show-preview":!0,placeholder:"Select or create a parser for post-processing",onCreate:U,onTest:$,onChange:m},null,8,["modelValue"])]),_:1},8,["label"]),w.value.length>0&&h.value.postParserId?(i(),p("div",Xr,[x[4]||(x[4]=s("h4",null,"Preview Results (First 10 calls)",-1)),I(j,{columns:z,"data-source":w.value,pagination:!1,size:"small",scroll:{x:800}},{original:A(({text:ae})=>[s("code",null,b(S(ae)),1)]),postProcessed:A(({text:ae,record:ce})=>[s("code",{class:te({"value-changed":ce.changed})},b(S(ae)),3)]),changed:A(({text:ae})=>[I(y,{color:ae?"green":"default"},{default:A(()=>[D(b(ae?"Changed":"Same"),1)]),_:2},1032,["color"])]),_:1},8,["data-source"])])):P("",!0)])]),_:1},8,["visible","mask-closable","closable"])}}}),ri=re(li,[["__scopeId","data-v-17edda1c"]]),ii={class:"trial-results-table"},ui={class:"table-container"},di={class:"results-table"},ci={key:0,class:"col-status"},pi={key:1,class:"col-configuration"},fi={key:2,class:"col-repeat"},mi={key:3,class:"col-variables"},vi={key:4,class:"col-response"},gi={key:5,class:"col-parsed"},hi={key:6,class:"col-post-processed"},yi={key:0,class:"post-process-indicator"},bi={key:7,class:"col-length"},_i={key:8,class:"col-latency"},Ti={class:"results-table"},$i=["onClick"],Ci={key:0,class:"col-status"},ki={class:"status-cell"},wi={class:"status-time"},Si={key:1,class:"col-configuration"},Ii={key:2,class:"col-repeat"},Ei={key:3,class:"col-variables"},Ri={class:"variable-tags"},Fi={key:0,class:"var-item"},Pi={key:1,class:"var-item"},xi={key:2},Ai={key:3},Vi={key:4,class:"col-response"},Oi={class:"response-content"},Di={key:5,class:"col-parsed"},Ni={key:6,class:"col-post-processed"},Li={key:7,class:"col-length"},Mi={key:8,class:"col-latency"},Ui={key:1,class:"results-table"},zi={key:0,class:"col-status"},Bi={key:1,class:"col-configuration"},ji={key:2,class:"col-repeat"},Wi={key:3,class:"col-variables"},Hi={key:4,class:"col-response"},qi={key:5,class:"col-parsed"},Gi={key:6,class:"col-post-processed"},Ji={key:0,class:"post-process-indicator"},Xi={key:7,class:"col-length"},Ki={key:8,class:"col-latency"},Qi=["onClick"],Yi={key:0,class:"col-status"},Zi={class:"status-cell"},eu={class:"status-time"},tu={key:1,class:"col-configuration"},su={key:2,class:"col-repeat"},au={key:3,class:"col-variables"},nu={class:"variable-tags"},ou={key:0,class:"var-item"},lu={key:1,class:"var-item"},ru={key:2},iu={key:3},uu={key:4,class:"col-response"},du={class:"response-content"},cu={key:5,class:"col-parsed"},pu={key:6,class:"col-post-processed"},fu={key:7,class:"col-length"},mu={key:8,class:"col-latency"},vu={key:0},gu=["colspan"],hu={key:0},yu={key:1},xt="trial-results-visible-columns",bu=le({__name:"TrialResultsTableV3",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(r){const e=r,t=q("all"),a=q([]),o=q(""),n=q(["status","configuration","variables","response","parsedResponse","postProcessedResponse","length","latency"]),u=q(null),c=q(!1),d=Xe(),f=M(()=>d.apiCalls?.value||[]),g=M(()=>e.apiCalls||f.value);oe(g,(T,x)=>{const C=performance.now();V.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 calls data changed from ${x?.length||0} to ${T.length} calls`),setTimeout(()=>{const y=performance.now();V.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 reactive update completed in ${(y-C).toFixed(1)}ms`)},0)});const h=T=>{if(!o.value)return T;const x=o.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),C=new RegExp(`(${x})`,"gi");return T.replace(C,"<mark>$1</mark>")},_=M(()=>{const T=performance.now();if(!(t.value!=="all"||a.value.length>0||o.value))return performance.now()-T>5&&V.info(`V4_OPTIMIZE: No filtering needed, returning ${g.value.length} calls directly`),g.value;let C=g.value.filter(v=>{if(t.value!=="all"&&v.status!==t.value||a.value.length>0&&!a.value.includes(String(v.configurationIndex)))return!1;if(o.value){const j=o.value.toLowerCase();if(!(v.prompt?.toLowerCase().includes(j)||v.result?.content?.toLowerCase().includes(j)||v.result?.error?.toLowerCase().includes(j)))return!1}return!0});const y=performance.now();return y-T>10&&V.info(`V4_OPTIMIZE: Filtered ${g.value.length} → ${C.length} calls in ${(y-T).toFixed(1)}ms`),C});oe(_,(T,x)=>{const C=performance.now();V.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls changed from ${x?.length||0} to ${T.length} items`),setTimeout(()=>{const y=performance.now();V.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls render completed in ${(y-C).toFixed(1)}ms`)},0)});const R=M(()=>g.value),w=M(()=>g.value.length),k=M(()=>e.trial.configurations.some(T=>T.repeatCount>1)),z=M(()=>60);function N(T){}function O(T){const x=e.trial.configurations[T];return x?x.modelSnapshot?.displayName||`${x.modelId}`:`Config ${T+1}`}function E(T){return T.status==="pending"?"Waiting...":T.status==="running"?"Processing...":T.status==="failed"?T.result?.errorType==="refusal_detected"||T.result?.error==="REFUSED"?T.result?.content||"REFUSED":T.result?.error||"Error occurred":T.result?.content||""}function S(T){if(!T.result)return"";if(T.result.parsedContent!==void 0){const x=T.result.parsedContent;return x===null?"null":typeof x=="string"?x:typeof x=="number"||typeof x=="boolean"?String(x):JSON.stringify(x)}return""}function U(T){if(!T.result||T.result.postParsedContent===void 0)return"";const x=T.result.postParsedContent;return x===null?"null":x==="REFUSED"||T.result.postRefused?"REFUSED":typeof x=="string"?x:typeof x=="number"||typeof x=="boolean"?String(x):JSON.stringify(x)}function $(T){const x=T.result?.content||"";if(!x)return"";const C=x.length;return C>1e3?`${(C/1e3).toFixed(1)}k chars`:`${C} chars`}function m(T){return T?T<1e3?`${T}ms`:`${(T/1e3).toFixed(1)}s`:""}function L(T){let x;switch(T.status){case"completed":case"failed":x=T.completed;break;case"running":x=T.started;break;case"pending":case"cancelled":x=T.created;break}if(!x)return"";const C=new Date(x),y=C.getHours().toString().padStart(2,"0"),v=C.getMinutes().toString().padStart(2,"0"),j=C.getSeconds().toString().padStart(2,"0");return`  ${y}:${v}:${j}`}function F(T){return T?T<1e3?"latency-fast":T<5e3?"latency-medium":"latency-slow":""}function l(T){return h(T)}function W(T){u.value=T}function X(T){u.value=T}return oe(n,T=>{localStorage.setItem(xt,JSON.stringify(T))},{deep:!0}),me(()=>{const T=performance.now();V.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 MOUNTED with ${g.value.length} calls`);const x=localStorage.getItem(xt);if(x)try{n.value=JSON.parse(x)}catch{}we(()=>{const C=performance.now();V.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 DOM ready in ${(C-T).toFixed(1)}ms`),setTimeout(()=>{const y=performance.now();V.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 virtual scrolling ready in ${(y-T).toFixed(1)}ms`)},100)}),setTimeout(()=>{const C=performance.now();V.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 mount completed in ${(C-T).toFixed(1)}ms`)},0)}),xe(()=>{V.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 ACTIVATED (cache hit) with ${g.value.length} calls`)}),Ae(()=>{V.info("V4_TRIAL_SWITCH: TrialResultsTableV3 DEACTIVATED (cached)")}),ye(()=>{V.info("V4_TRIAL_SWITCH: TrialResultsTableV3 UNMOUNTED (evicted)")}),(T,x)=>{const C=Lt("dompurify-html");return i(),p("div",ii,[I(hl,{"status-filter":t.value,"onUpdate:statusFilter":x[0]||(x[0]=y=>t.value=y),"config-filter":a.value,"onUpdate:configFilter":x[1]||(x[1]=y=>a.value=y),"search-query":o.value,"onUpdate:searchQuery":x[2]||(x[2]=y=>o.value=y),"visible-columns":n.value,"onUpdate:visibleColumns":x[3]||(x[3]=y=>n.value=y),configurations:T.trial.configurations,"api-calls":R.value,"show-repeat-column":k.value,onOpenPostProcessing:x[4]||(x[4]=y=>c.value=!0)},null,8,["status-filter","config-filter","search-query","visible-columns","configurations","api-calls","show-repeat-column"]),s("div",ui,[w.value>100?(i(),Q(H(Qe),{key:0,class:"results-scroller",items:Array.from(_.value),"item-size":z.value,"key-field":"id",buffer:10,onVisibleRange:N},{before:A(()=>[s("table",di,[s("thead",null,[s("tr",null,[n.value.includes("status")?(i(),p("th",ci,"Status")):P("",!0),n.value.includes("configuration")?(i(),p("th",pi,"Configuration")):P("",!0),n.value.includes("repeat")&&k.value?(i(),p("th",fi,"Repeat")):P("",!0),n.value.includes("variables")?(i(),p("th",mi,"Variables")):P("",!0),n.value.includes("response")?(i(),p("th",vi,"Response")):P("",!0),n.value.includes("parsedResponse")?(i(),p("th",gi,"Parsed Response")):P("",!0),n.value.includes("postProcessedResponse")?(i(),p("th",hi,[x[7]||(x[7]=D(" Post-Processed ")),T.trial.postProcessingConfig?.enabled?(i(),p("span",yi,"✨")):P("",!0)])):P("",!0),n.value.includes("length")?(i(),p("th",bi,"Length")):P("",!0),n.value.includes("latency")?(i(),p("th",_i,"Latency")):P("",!0)])])])]),default:A(({item:y})=>[s("table",Ti,[s("tbody",null,[s("tr",{class:te(["result-row",`status-${y.status}`]),onClick:v=>W(y)},[n.value.includes("status")?(i(),p("td",Ci,[s("div",ki,[s("span",{class:te(["status-tag",`status-${y.status}`])},b(y.status.toUpperCase()),3),s("span",wi,b(L(y)),1)])])):P("",!0),n.value.includes("configuration")?(i(),p("td",Si,b(O(y.configurationIndex)),1)):P("",!0),n.value.includes("repeat")&&k.value?(i(),p("td",Ii," #"+b((y.repeatIndex||0)+1),1)):P("",!0),n.value.includes("variables")?(i(),p("td",Ei,[s("div",Ri,[(i(!0),p(Z,null,ee(Object.entries(y.variables),([v,j],G)=>(i(),p(Z,{key:v},[x[9]||(x[9]=s("span",{class:"var-bullet"},"• ",-1)),Object.keys(y.variables).length<=2?(i(),p("span",Fi,b(v)+": "+b(j),1)):(i(),p("span",Pi,b(j),1)),Object.keys(y.variables).length===2&&G===0?(i(),p("span",xi,x[8]||(x[8]=[s("br",null,null,-1)]))):G<Object.keys(y.variables).length-1?(i(),p("span",Ai,b("  "))):P("",!0)],64))),128))])])):P("",!0),n.value.includes("response")?(i(),p("td",Vi,[Ee(s("div",Oi,null,512),[[C,l(E(y)),"apiResponse"]])])):P("",!0),n.value.includes("parsedResponse")?(i(),p("td",Di,b(S(y)),1)):P("",!0),n.value.includes("postProcessedResponse")?(i(),p("td",Ni,b(U(y)),1)):P("",!0),n.value.includes("length")?(i(),p("td",Li,b($(y)),1)):P("",!0),n.value.includes("latency")?(i(),p("td",Mi,[s("span",{class:te(F(y.response?.latencyMs))},b(m(y.response?.latencyMs)),3)])):P("",!0)],10,$i)])])]),_:1},8,["items","item-size"])):(i(),p("table",Ui,[s("thead",null,[s("tr",null,[n.value.includes("status")?(i(),p("th",zi,"Status")):P("",!0),n.value.includes("configuration")?(i(),p("th",Bi,"Configuration")):P("",!0),n.value.includes("repeat")&&k.value?(i(),p("th",ji,"Repeat")):P("",!0),n.value.includes("variables")?(i(),p("th",Wi,"Variables")):P("",!0),n.value.includes("response")?(i(),p("th",Hi,"Response")):P("",!0),n.value.includes("parsedResponse")?(i(),p("th",qi,"Parsed Response")):P("",!0),n.value.includes("postProcessedResponse")?(i(),p("th",Gi,[x[10]||(x[10]=D(" Post-Processed ")),T.trial.postProcessingConfig?.enabled?(i(),p("span",Ji,"✨")):P("",!0)])):P("",!0),n.value.includes("length")?(i(),p("th",Xi,"Length")):P("",!0),n.value.includes("latency")?(i(),p("th",Ki,"Latency")):P("",!0)])]),s("tbody",null,[(i(!0),p(Z,null,ee(_.value,y=>(i(),p("tr",{key:y.id,class:te(["result-row",`status-${y.status}`]),onClick:v=>W(y)},[n.value.includes("status")?(i(),p("td",Yi,[s("div",Zi,[s("span",{class:te(["status-tag",`status-${y.status}`])},b(y.status.toUpperCase()),3),s("span",eu,b(L(y)),1)])])):P("",!0),n.value.includes("configuration")?(i(),p("td",tu,b(O(y.configurationIndex)),1)):P("",!0),n.value.includes("repeat")&&k.value?(i(),p("td",su," #"+b((y.repeatIndex||0)+1),1)):P("",!0),n.value.includes("variables")?(i(),p("td",au,[s("div",nu,[(i(!0),p(Z,null,ee(y.variables,(v,j,G)=>(i(),p(Z,{key:j},[x[12]||(x[12]=s("span",{class:"var-bullet"},"• ",-1)),Object.keys(y.variables).length<=2?(i(),p("span",ou,b(j)+": "+b(v),1)):(i(),p("span",lu,b(v),1)),Object.keys(y.variables).length===2&&G===0?(i(),p("span",ru,x[11]||(x[11]=[s("br",null,null,-1)]))):G<Object.keys(y.variables).length-1?(i(),p("span",iu,b("  "))):P("",!0)],64))),128))])])):P("",!0),n.value.includes("response")?(i(),p("td",uu,[Ee(s("div",du,null,512),[[C,l(E(y)),"apiResponse"]])])):P("",!0),n.value.includes("parsedResponse")?(i(),p("td",cu,b(S(y)),1)):P("",!0),n.value.includes("postProcessedResponse")?(i(),p("td",pu,b(U(y)),1)):P("",!0),n.value.includes("length")?(i(),p("td",fu,b($(y)),1)):P("",!0),n.value.includes("latency")?(i(),p("td",mu,[s("span",{class:te(F(y.response?.latencyMs))},b(m(y.response?.latencyMs)),3)])):P("",!0)],10,Qi))),128)),_.value.length===0?(i(),p("tr",vu,[s("td",{colspan:n.value.length,class:"empty-state"},[f.value.length===0?(i(),p("div",hu," No API calls yet. Start the trial to begin execution. ")):(i(),p("div",yu," No results match your filters. "))],8,gu)])):P("",!0)])]))]),u.value?(i(),Q(ls,{key:0,visible:!!u.value,"api-call":u.value,trial:T.trial,"all-api-calls":R.value,"onUpdate:visible":x[5]||(x[5]=y=>u.value=null),onNavigate:X},null,8,["visible","api-call","trial","all-api-calls"])):P("",!0),c.value?(i(),Q(ri,{key:1,visible:c.value,trial:T.trial,onClose:x[6]||(x[6]=y=>c.value=!1)},null,8,["visible","trial"])):P("",!0)])}}}),_u=re(bu,[["__scopeId","data-v-92b39afd"]]),Tu={class:"trial-analysis-view"},$u=le({__name:"TrialAnalysisView",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(r){const e=r;return me(()=>{const t=performance.now();V.info(`V4_TRIAL_SWITCH: TrialAnalysisView MOUNTED for trial ${e.trial.id}`),we(()=>{const a=performance.now();V.info(`V4_TRIAL_SWITCH: TrialAnalysisView DOM ready in ${(a-t).toFixed(1)}ms`)}),setTimeout(()=>{const a=performance.now();V.info(`V4_TRIAL_SWITCH: TrialAnalysisView mount completed in ${(a-t).toFixed(1)}ms`)},0)}),xe(()=>{V.info(`V4_TRIAL_SWITCH: TrialAnalysisView ACTIVATED (cache hit) for trial ${e.trial.id}`)}),Ae(()=>{V.info(`V4_TRIAL_SWITCH: TrialAnalysisView DEACTIVATED (cached) for trial ${e.trial.id}`)}),ye(()=>{V.info(`V4_TRIAL_SWITCH: TrialAnalysisView UNMOUNTED (evicted) for trial ${e.trial.id}`)}),(t,a)=>(i(),p("div",Tu,[I(_u,{trial:t.trial,progress:t.progress,"is-executing":t.isExecuting,"api-calls":t.apiCalls,"is-streaming":t.isStreaming,"is-loading":t.isLoading},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])]))}}),Cu=re($u,[["__scopeId","data-v-602f5d5a"]]);function At(r,e){const t=new Set,a=new Set,o=new Set;r.forEach(g=>{g.variables&&Object.keys(g.variables).forEach(h=>t.add(h)),g.variableAttributes&&Object.values(g.variableAttributes).forEach(h=>{h&&Object.keys(h).forEach(_=>a.add(_))})});const n=Array.from(t).sort(),u=Array.from(a).sort(),c=Array.from(o).sort(),d=[],f=["success","refused","parsed_response",...d,...c];return{categorical:[...n,...u,"model","status","error_type"],numeric:["response_time","total_tokens","prompt_tokens","completion_tokens",...d].sort(),extracted:f}}function ze(r,e,t){switch(e){case"model":return t&&r.configurationIndex<t.configurations.length&&t.configurations[r.configurationIndex].modelId||"Unknown";case"status":return r.status;case"response_time":return xs(r.response?.latencyMs);case"total_tokens":if(r.response?.body?.usage){const a=r.response.body.usage;return a.total_tokens||Ps(a.prompt_tokens,a.completion_tokens)||Ne(null)}return Ne(null);case"prompt_tokens":return Ne(r.response?.body?.usage?.prompt_tokens||r.response?.body?.usage?.input_tokens);case"completion_tokens":return Ne(r.response?.body?.usage?.completion_tokens||r.response?.body?.usage?.output_tokens);case"error_type":return r.result?.errorType||(r.result?.success===!1?"api_error":"success");case"success":return r.result?.success?1:0;case"refused":return r.result?.refused?1:0;case"parsed_response":if(r.result?.parsedContent!==void 0){const a=r.result.parsedContent;return typeof a=="object"?JSON.stringify(a):a}return null}if(r.variables?.[e]!==void 0)return r.variables[e];if(r.variableAttributes)for(const a of Object.keys(r.variableAttributes)){const o=r.variableAttributes[a];if(o&&o[e]!==void 0)return o[e]}return null}const Ve={count:{label:"Count",calculate:r=>r.length,format:r=>r.toString(),needsNumeric:!1},sum:{label:"Sum",calculate:r=>{const e=r.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0):null},format:r=>r?.toFixed(2)||"-",needsNumeric:!0},mean:{label:"Mean",calculate:r=>{const e=r.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0)/e.length:null},format:r=>r?.toFixed(2)||"-",needsNumeric:!0},median:{label:"Median",calculate:r=>{const e=r.map(o=>typeof o=="number"?o:null).filter(o=>o!==null);if(e.length===0)return null;const t=[...e].sort((o,n)=>o-n),a=Math.floor(t.length/2);return t.length%2===0?(t[a-1]+t[a])/2:t[a]},format:r=>r?.toFixed(2)||"-",needsNumeric:!0},mode:{label:"Mode",calculate:r=>{if(r.length===0)return null;const e=new Map;r.forEach(o=>e.set(o,(e.get(o)||0)+1));let t=0,a=null;return e.forEach((o,n)=>{o>t&&(t=o,a=n)}),{value:a,count:t,total:r.length}},format:r=>r?`${r.value} (${r.count}/${r.total})`:"-",needsNumeric:!1},variance:{label:"Variance",calculate:r=>{const e=r.map(o=>typeof o=="number"?o:null).filter(o=>o!==null);if(e.length<=1)return null;const t=e.reduce((o,n)=>o+n,0)/e.length;return e.reduce((o,n)=>o+Math.pow(n-t,2),0)/(e.length-1)},format:r=>r?.toFixed(3)||"-",needsNumeric:!0},std_dev:{label:"Std Dev",calculate:r=>{const e=Ve.variance.calculate(r);return e!==null?Math.sqrt(e):null},format:r=>r?.toFixed(3)||"-",needsNumeric:!0},min:{label:"Min",calculate:r=>{const e=r.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.min(...e):null},format:r=>r?.toFixed(2)||"-",needsNumeric:!0},max:{label:"Max",calculate:r=>{const e=r.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.max(...e):null},format:r=>r?.toFixed(2)||"-",needsNumeric:!0},success_rate:{label:"Success Rate",calculate:(r,e)=>{const t=e.filter(a=>a.result?.success).length;return e.length>0?t/e.length:0},format:r=>`${Math.round(r*100)}%`,needsNumeric:!1,usesApiCalls:!0},refusal_rate:{label:"Refusal Rate",calculate:(r,e)=>{const t=e.filter(a=>a.result?.refused).length;return e.length>0?t/e.length:0},format:r=>`${Math.round(r*100)}%`,needsNumeric:!1,usesApiCalls:!0},avg_time:{label:"Avg Time (ms)",calculate:(r,e)=>{const t=e.filter(a=>a.response?.latencyMs).map(a=>a.response.latencyMs);return t.length>0?t.reduce((a,o)=>a+o,0)/t.length:null},format:r=>r?`${Math.round(r)}ms`:"-",needsNumeric:!1,usesApiCalls:!0}};function ku(r,e,t){const a=performance.now(),o=new Map,n=new Set,u=new Set,c=new Map,d=(E,S)=>{c.has(S)||c.set(S,new Map);const U=c.get(S);return U.has(E)||U.set(E,ze(E,S,t)),U.get(E)};for(const E of r){const S=String(d(E,e.rowField)||"Unknown"),U=String(d(E,e.columnField)||"Unknown");n.add(S),u.add(U),o.has(S)||o.set(S,new Map);const $=o.get(S);$.has(U)||$.set(U,[]),$.get(U).push(E)}const f=performance.now()-a;f>50&&`${r.length}${f.toFixed(1)}`;const g=E=>E.every(U=>!isNaN(Number(U))&&U.trim()!=="")?E.sort((U,$)=>Number(U)-Number($)):E.sort(),h=(E,S)=>(t&&(t.type,t.type),g(E)),_=e.rowSort==="original"?h(Array.from(n),e.rowField):g(Array.from(n)),R=e.columnSort==="original"?h(Array.from(u),e.columnField):g(Array.from(u)),w=Ve[e.aggregation];function k(E,S=!1){const U=S?E.map(F=>d(F,e.valueField)):E.map(F=>ze(F,e.valueField,t));if(!w||typeof w.calculate!="function")return V.error("Invalid aggregation function:",e.aggregation,w),{value:null,count:E.length,apiCalls:E,rawValues:U,error:"Invalid aggregation function"};const $={nonNumeric:0,nullUndefined:0};return w.needsNumeric&&($.nonNumeric=U.filter(F=>typeof F!="number").length),$.nullUndefined=U.filter(F=>F==null).length,{value:w.usesApiCalls?w.calculate(U,E):w.calculate(U),count:E.length,apiCalls:E,rawValues:U,excludedCounts:$}}const z=_.map(E=>{const S=[],U=[];return R.forEach($=>{const m=o.get(E)?.get($)||[];S.push(m.length>0?k(m,!0):null),U.push(...m)}),{label:E,cells:S,total:k(U,!0)}}),N=R.map(E=>{const S=[];return _.forEach(U=>{const $=o.get(U)?.get(E)||[];S.push(...$)}),k(S,!0)}),O=performance.now()-a;return O>100&&`${O.toFixed(1)}${r.length}`,{rows:z,columns:R,totals:N,grandTotal:k(r,!0)}}function $e(r,e){return!r||r.value===null?"-":Ve[e].format(r.value)}function wu(r){if(!r||Object.keys(r).length===0)return"";const e=[];return r.temperature!==void 0&&e.push(`T:${r.temperature}`),r.max_tokens!==void 0?e.push(`${r.max_tokens}t`):r.maxTokens!==void 0?e.push(`${r.maxTokens}t`):r.num_predict!==void 0&&e.push(`${r.num_predict}t`),r.top_p!==void 0&&e.push(`p:${r.top_p}`),r.top_k!==void 0&&e.push(`k:${r.top_k}`),e.length>0?`(${e.join(", ")})`:""}function Su(r,e,t,a=q({}),o={}){const n=q({rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}}),u=q({categorical:[],numeric:[],extracted:[]}),c=q(!1),d=q(0),f=q(!1),g=q(0),h=M(()=>{const N=a.value;return Object.values(N).some(E=>E!=="")?r.value.filter(E=>{if(N.model&&N.model!==""){if(!t.value||E.configurationIndex>=t.value.configurations.length)return!1;const S=t.value.configurations[E.configurationIndex],U=S.modelId||"Unknown",$=wu(S.parameters);if(($?`${U} ${$}`:U)!==N.model)return!1}if(N.status&&N.status!==""&&E.status!==N.status)return!1;for(const[S,U]of Object.entries(N))if(U&&U!==""&&S!=="model"&&S!=="status"&&E.variables?.[S]!==U)return!1;return!0}):r.value});let _=null;const R=N=>{_&&_.cancel();let O;switch(N){case"trial":O=0;break;case"tab":O=0;break;case"stream":O=100;break;case"config":O=300;break;default:O=100}_=St(()=>{if(h.value.length===0){n.value={rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}};return}c.value=!0;const E=performance.now();try{n.value=ku(h.value,e.value,t.value);const S=performance.now()-E;d.value=S,V.debug(`Pivot computed from ${N}`,{apiCallCount:h.value.length,computeTimeMs:S,rowCount:n.value.rows.length,columnCount:n.value.columns.length,source:N})}catch(S){V.error("Error computing pivot data",S)}finally{c.value=!1,(N==="tab"||N==="stream")&&(f.value=!1)}},O),_()},w=St(()=>{u.value=At(r.value,t.value)},200),k=typeof window<"u"?window.__trialDataStoreV4?.():null;oe([e],()=>{R("config")},{deep:!0}),oe(h,(N,O)=>{if(k&&k.activeTab?.value!=="pivot"){f.value=!0,g.value=N.length,`${N.length}`;return}const E=O?.length||0,S=N.length;f.value&&(f.value=!1),(E!==S||S>0)&&R("stream")},{immediate:!0}),k&&oe(()=>k.activeTab?.value,(N,O)=>{N==="pivot"&&O!=="pivot"&&f.value&&(`${g.value}`,R("tab"))});let z=null;return oe([r,t],([N,O])=>{const E=O?.id!==z;z=O?.id||null,E?(`${O?.id}`,u.value=At(N),R("trial")):(`${N.length}`,w())},{immediate:!0}),w(),{pivotData:M(()=>n.value),availableFields:M(()=>u.value),isComputing:M(()=>c.value),lastComputeTime:M(()=>d.value),formatCellValue:$e,extractFieldValue:ze,aggregationFunctions:Ve}}const Iu={class:"pivot-config-v3"},Eu={class:"config-row"},Ru={class:"config-group"},Fu=["value","aria-label"],Pu={label:"Categorical"},xu=["value"],Au={class:"config-group sort-group"},Vu=["value","aria-label"],Ou={class:"config-group"},Du=["value","aria-label"],Nu={label:"Categorical"},Lu=["value"],Mu={class:"config-group sort-group"},Uu=["value","aria-label"],zu={class:"config-group"},Bu=["value","aria-label"],ju={label:"Extracted Values"},Wu=["value"],Hu={label:"Numeric Fields"},qu=["value"],Gu={class:"config-group"},Ju=["value","aria-label"],Xu=le({__name:"PivotConfigurationV3",props:{config:{},availableFields:{}},emits:["update-config"],setup(r,{emit:e}){const t=e;function a(n,u){t("update-config",n,u)}function o(n){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[n]||n.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase())}return(n,u)=>(i(),p("div",Iu,[s("div",Eu,[s("div",Ru,[u[6]||(u[6]=s("label",{for:"pivot-row-field"},"Rows (Group by):",-1)),s("select",{id:"pivot-row-field",value:n.config.rowField,"aria-label":"Group rows by "+o(n.config.rowField),onChange:u[0]||(u[0]=c=>a("rowField",c.target.value))},[s("optgroup",Pu,[(i(!0),p(Z,null,ee(n.availableFields.categorical,c=>(i(),p("option",{key:c,value:c},b(o(c)),9,xu))),128))])],40,Fu)]),s("div",Au,[u[8]||(u[8]=s("label",{for:"pivot-row-sort"},"Sort Rows:",-1)),s("select",{id:"pivot-row-sort",value:n.config.rowSort||"original","aria-label":"Sort rows by "+(n.config.rowSort||"original")+" order",onChange:u[1]||(u[1]=c=>a("rowSort",c.target.value))},u[7]||(u[7]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,Vu)]),s("div",Ou,[u[9]||(u[9]=s("label",{for:"pivot-column-field"},"Columns (Group by):",-1)),s("select",{id:"pivot-column-field",value:n.config.columnField,"aria-label":"Group columns by "+o(n.config.columnField),onChange:u[2]||(u[2]=c=>a("columnField",c.target.value))},[s("optgroup",Nu,[(i(!0),p(Z,null,ee(n.availableFields.categorical,c=>(i(),p("option",{key:c,value:c},b(o(c)),9,Lu))),128))])],40,Du)]),s("div",Mu,[u[11]||(u[11]=s("label",{for:"pivot-column-sort"},"Sort Columns:",-1)),s("select",{id:"pivot-column-sort",value:n.config.columnSort||"original","aria-label":"Sort columns by "+(n.config.columnSort||"original")+" order",onChange:u[3]||(u[3]=c=>a("columnSort",c.target.value))},u[10]||(u[10]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,Uu)]),s("div",zu,[u[12]||(u[12]=s("label",{for:"pivot-value-field"},"Values (Aggregate):",-1)),s("select",{id:"pivot-value-field",value:n.config.valueField,"aria-label":"Aggregate "+n.config.valueField+" values",onChange:u[4]||(u[4]=c=>a("valueField",c.target.value))},[s("optgroup",ju,[(i(!0),p(Z,null,ee(n.availableFields.extracted,c=>(i(),p("option",{key:c,value:c},b(c),9,Wu))),128))]),s("optgroup",Hu,[(i(!0),p(Z,null,ee(n.availableFields.numeric,c=>(i(),p("option",{key:c,value:c},b(o(c)),9,qu))),128))])],40,Bu)]),s("div",Gu,[u[14]||(u[14]=s("label",{for:"pivot-aggregation"},"Aggregation:",-1)),s("select",{id:"pivot-aggregation",value:n.config.aggregation,"aria-label":"Aggregation method: "+n.config.aggregation,onChange:u[5]||(u[5]=c=>a("aggregation",c.target.value))},u[13]||(u[13]=[Mt('<optgroup label="Statistical" data-v-0d3a0d50><option value="mean" data-v-0d3a0d50>Mean</option><option value="median" data-v-0d3a0d50>Median</option><option value="variance" data-v-0d3a0d50>Variance</option><option value="std_dev" data-v-0d3a0d50>Std Dev</option><option value="min" data-v-0d3a0d50>Min</option><option value="max" data-v-0d3a0d50>Max</option><option value="sum" data-v-0d3a0d50>Sum</option></optgroup><optgroup label="Frequency" data-v-0d3a0d50><option value="count" data-v-0d3a0d50>Count</option><option value="mode" data-v-0d3a0d50>Mode</option></optgroup><optgroup label="Performance" data-v-0d3a0d50><option value="success_rate" data-v-0d3a0d50>Success Rate</option><option value="refusal_rate" data-v-0d3a0d50>Refusal Rate</option><option value="avg_time" data-v-0d3a0d50>Avg Time</option></optgroup>',3)]),40,Ju)])])]))}}),Ku=re(Xu,[["__scopeId","data-v-0d3a0d50"]]),Qu={class:"heatmap-controls-v3"},Yu={class:"color-scale-selector"},Zu=["value","aria-label"],ed={class:"gradient-mode-selector"},td={class:"gradient-toggle",role:"group","aria-label":"Gradient mode selector"},sd=["aria-pressed"],ad=["aria-pressed"],nd=["aria-pressed"],od=["title","aria-label"],ld=le({__name:"PivotHeatmapV3",props:{selectedColorScale:{},gradientMode:{},isFullscreen:{type:Boolean}},emits:["update-color-scale","update-gradient-mode","toggle-fullscreen"],setup(r,{emit:e}){const t=e;function a(n){const u=n.target.value;t("update-color-scale",u)}function o(n){t("update-gradient-mode",n)}return(n,u)=>(i(),p("div",Qu,[s("div",Yu,[u[5]||(u[5]=s("label",{for:"heatmap-color-scale"},"Color Scale:",-1)),s("select",{id:"heatmap-color-scale",value:n.selectedColorScale,"aria-label":"Color scale: "+n.selectedColorScale,onChange:a},u[4]||(u[4]=[Mt('<option value="blue-subtle" data-v-dcb6369b>Blue (Subtle)</option><option value="green-red" data-v-dcb6369b>Green-Red (Success)</option><option value="blue-yellow" data-v-dcb6369b>Blue-Yellow (Performance)</option><option value="purple-orange" data-v-dcb6369b>Purple-Orange (General)</option><option value="viridis" data-v-dcb6369b>Viridis</option><option value="inferno" data-v-dcb6369b>Inferno</option><option value="magma" data-v-dcb6369b>Magma</option><option value="plasma" data-v-dcb6369b>Plasma</option><option value="grayscale" data-v-dcb6369b>Grayscale</option>',9)]),40,Zu)]),s("div",ed,[u[6]||(u[6]=s("label",null,"Gradient Mode:",-1)),s("div",td,[s("button",{type:"button",class:te(["toggle-btn",{active:n.gradientMode==="global"}]),"aria-pressed":n.gradientMode==="global",onClick:u[0]||(u[0]=c=>o("global"))}," Global ",10,sd),s("button",{type:"button",class:te(["toggle-btn",{active:n.gradientMode==="column"}]),"aria-pressed":n.gradientMode==="column",onClick:u[1]||(u[1]=c=>o("column"))}," Per Column ",10,ad),s("button",{type:"button",class:te(["toggle-btn",{active:n.gradientMode==="row"}]),"aria-pressed":n.gradientMode==="row",onClick:u[2]||(u[2]=c=>o("row"))}," Per Row ",10,nd)])]),s("button",{type:"button",class:"fullscreen-btn",title:n.isFullscreen?"Exit Fullscreen":"Enter Fullscreen","aria-label":n.isFullscreen?"Exit fullscreen mode":"Enter fullscreen mode",onClick:u[3]||(u[3]=c=>n.$emit("toggle-fullscreen"))},b(n.isFullscreen?"⊟":"⊞"),9,od)]))}}),rd=re(ld,[["__scopeId","data-v-dcb6369b"]]),id={class:"pivot-filters-v3"},ud={class:"filters-row"},dd={key:0,class:"filter-group"},cd=["value"],pd=["value"],fd=["for"],md=["id","value","aria-label","onChange"],vd={value:""},gd=["value"],hd={key:1,class:"filter-group"},yd=["value"],bd=["value"],_d=le({__name:"PivotFiltersV3",props:{apiCalls:{},trial:{},activeFilters:{}},emits:["update-filters","clear-filters"],setup(r,{emit:e}){const t=r,a=e,o=q({});let n=0;const u=()=>{if(t.apiCalls.length===0){o.value={};return}const _={};t.apiCalls.forEach(w=>{if(t.trial&&w.configurationIndex<t.trial.configurations.length){const k=t.trial.configurations[w.configurationIndex],z=k.modelId||"Unknown",N=f(k.parameters),O=N?`${z} ${N}`:z;_.model||(_.model=new Set),_.model.add(O)}w.status&&(_.status||(_.status=new Set),_.status.add(w.status)),w.variables&&Object.entries(w.variables).forEach(([k,z])=>{z&&String(z).trim()&&(_[k]||(_[k]=new Set),_[k].add(String(z)))})});const R={};Object.entries(_).forEach(([w,k])=>{R[w]=Array.from(k).sort()}),o.value=R};oe(()=>t.apiCalls.length,_=>{(_===0||n===0||_-n>=5)&&(u(),n=_)},{immediate:!0});const c=M(()=>{const{model:_,status:R,...w}=o.value;return w}),d=M(()=>Object.values(t.activeFilters).some(_=>_!==""));function f(_){if(!_||Object.keys(_).length===0)return"";const R=[];return _.temperature!==void 0&&R.push(`T:${_.temperature}`),_.max_tokens!==void 0?R.push(`${_.max_tokens}t`):_.maxTokens!==void 0?R.push(`${_.maxTokens}t`):_.num_predict!==void 0&&R.push(`${_.num_predict}t`),_.top_p!==void 0&&R.push(`p:${_.top_p}`),_.top_k!==void 0&&R.push(`k:${_.top_k}`),R.length>0?`(${R.join(", ")})`:""}function g(_){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",extracted_value:"Extracted Value"}[_]||_.replace(/_/g," ").replace(/\b\w/g,w=>w.toUpperCase())}function h(_,R){const w={...t.activeFilters};R===""?delete w[_]:w[_]=R,a("update-filters",w)}return(_,R)=>(i(),p("div",id,[s("div",ud,[o.value.model&&o.value.model.length>1?(i(),p("div",dd,[R[4]||(R[4]=s("label",{for:"filter-model",class:"filter-label"},"Model:",-1)),s("select",{id:"filter-model",value:_.activeFilters.model||"",class:"filter-select","aria-label":"Filter by model",onChange:R[0]||(R[0]=w=>h("model",w.target.value))},[R[3]||(R[3]=s("option",{value:""},"All Models",-1)),(i(!0),p(Z,null,ee(o.value.model,w=>(i(),p("option",{key:w,value:w},b(w),9,pd))),128))],40,cd)])):P("",!0),(i(!0),p(Z,null,ee(c.value,(w,k)=>(i(),p("div",{key:k,class:"filter-group"},[s("label",{for:`filter-${k}`,class:"filter-label"},b(g(String(k)))+": ",9,fd),s("select",{id:`filter-${k}`,value:_.activeFilters[k]||"",class:"filter-select","aria-label":`Filter by ${g(String(k))}`,onChange:z=>h(String(k),z.target.value)},[s("option",vd,"All "+b(g(String(k))),1),(i(!0),p(Z,null,ee(w,z=>(i(),p("option",{key:z,value:z},b(z),9,gd))),128))],40,md)]))),128)),o.value.status&&o.value.status.length>1?(i(),p("div",hd,[R[6]||(R[6]=s("label",{for:"filter-status",class:"filter-label"},"Status:",-1)),s("select",{id:"filter-status",value:_.activeFilters.status||"",class:"filter-select","aria-label":"Filter by status",onChange:R[1]||(R[1]=w=>h("status",w.target.value))},[R[5]||(R[5]=s("option",{value:""},"All Statuses",-1)),(i(!0),p(Z,null,ee(o.value.status,w=>(i(),p("option",{key:w,value:w},b(w),9,bd))),128))],40,yd)])):P("",!0),d.value?(i(),p("button",{key:2,type:"button",class:"clear-filters-btn",title:"Clear all filters","aria-label":"Clear all filters",onClick:R[2]||(R[2]=w=>_.$emit("clear-filters"))}," Clear Filters ")):P("",!0)])]))}}),Td=re(_d,[["__scopeId","data-v-d5848163"]]),$d={class:"collapse-icon"},Cd={class:"options-content"},kd={class:"controls-row"},wd={key:0,class:"performance-info"},Sd={class:"table-view"},Id={key:0,class:"empty-state","data-testid":"empty-data-message"},Ed={key:1,class:"error-state","data-testid":"invalid-aggregation-error"},Rd={key:2,class:"loading-state","data-testid":"computing-state"},Fd={key:3,class:"pivot-table-container"},Pd={class:"pivot-table-grid responsive-table",role:"table"},xd={role:"row"},Ad={class:"corner-cell",role:"columnheader"},Vd={key:0,class:"total-header",role:"columnheader"},Od={class:"row-header",role:"rowheader"},Dd=["data-testid","title","aria-label","role","onClick","onKeydown"],Nd={key:0,class:"cell-content"},Ld=["title"],Md={class:"cell-value"},Ud={class:"error-message"},zd={key:1},Bd=le({__name:"PivotTableV3",props:{apiCalls:{},trial:{default:null},config:{},maxTableRows:{default:1e4},showTotals:{type:Boolean,default:!0},showPerformanceInfo:{type:Boolean,default:!1}},emits:["config-change","cell-click"],setup(r,{emit:e}){const t=r,a=e,o=q(!1),n=q("blue-yellow"),u=q("global"),c=q(!1),d=q({rowField:t.config?.rowField||"",columnField:t.config?.columnField||"",valueField:t.config?.valueField||"",aggregation:t.config?.aggregation||"mean",rowSort:t.config?.rowSort||"original",columnSort:t.config?.columnSort||"original"});oe(()=>t.config,v=>{v&&Object.assign(d.value,v)},{deep:!0}),oe(()=>t.trial?.id,(v,j)=>{v&&v!==j&&(V.info(`PIVOT_FIX: Trial changed from ${j} to ${v}, resetting configuration`),d.value={rowField:"",columnField:"",valueField:"",aggregation:"mean",rowSort:"original",columnSort:"original"},f.value={})});const f=q({}),g=Xe(),h=M(()=>g.apiCalls?g.apiCalls.value||[]:t.apiCalls||[]),_=h,R=M(()=>t.trial),{pivotData:w,availableFields:k,isComputing:z,lastComputeTime:N}=Su(_,d,R,f,{});oe(w,(v,j)=>{const G=performance.now(),K=v?.rows?.length||0,Y=v?.columns?.length||0;V.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData computed: ${K}x${Y} matrix`),setTimeout(()=>{const ae=performance.now();V.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData render completed in ${(ae-G).toFixed(1)}ms`)},0)}),oe(z,v=>{v?V.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING STARTED with ${h.value.length} API calls`):V.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING FINISHED in ${N.value.toFixed(1)}ms`)}),oe(h,(v,j)=>{const G=performance.now();V.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls changed from ${j?.length||0} to ${v.length} calls`),setTimeout(()=>{const K=performance.now();V.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls prop update completed in ${(K-G).toFixed(1)}ms`)},0)});const O=M(()=>w.value.rows.slice(0,t.maxTableRows)),E=M(()=>Object.values(f.value).some(j=>j!=="")?h.value.filter(j=>{if(f.value.model&&f.value.model!==""){if(!t.trial||j.configurationIndex>=t.trial.configurations.length)return!1;const G=t.trial.configurations[j.configurationIndex],K=G.modelId||"Unknown",Y=m(G.parameters);if((Y?`${K} ${Y}`:K)!==f.value.model)return!1}if(f.value.status&&f.value.status!==""&&j.status!==f.value.status)return!1;for(const[G,K]of Object.entries(f.value))if(K&&K!==""&&G!=="model"&&G!=="status"&&j.variables?.[G]!==K)return!1;return!0}).length:h.value.length),{getCellStyle:S,getSummaryStyle:U,styleKey:$}=fa(w,n,u);function m(v){if(!v||Object.keys(v).length===0)return"";const j=[];return v.temperature!==void 0&&j.push(`T:${v.temperature}`),v.max_tokens!==void 0?j.push(`${v.max_tokens}t`):v.maxTokens!==void 0?j.push(`${v.maxTokens}t`):v.num_predict!==void 0&&j.push(`${v.num_predict}t`),v.top_p!==void 0&&j.push(`p:${v.top_p}`),v.top_k!==void 0&&j.push(`k:${v.top_k}`),j.length>0?`(${j.join(", ")})`:""}function L(v){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[v]||v.replace(/_/g," ").replace(/\b\w/g,G=>G.toUpperCase())}function F(v,j,G){if(!G)return`${v} × ${j}: No data`;const K=$e(G,d.value.aggregation);let Y=`${v} × ${j}: ${K} (${G.count} calls)`;if(G.excludedCounts){const ae=[];G.excludedCounts.nonNumeric>0&&ae.push(`${G.excludedCounts.nonNumeric} non-numeric responses excluded`),G.excludedCounts.nullUndefined>0&&ae.push(`${G.excludedCounts.nullUndefined} null/empty responses`),ae.length>0&&(Y+=` | ${ae.join(", ")}`)}return G.error&&(Y+=` - ERROR: ${G.error}`),Y}function l(v,j,G){if(!G)return`${v} by ${j}: No data`;const K=$e(G,d.value.aggregation);return G.error?`${v} by ${j}: ${K} with data integrity error: ${G.error}`:`${v} by ${j}: ${K} from ${G.count} API calls`}function W(v,j){(v==="rowField"||v==="columnField"||v==="valueField"||v==="aggregation"||v==="rowSort"||v==="columnSort")&&(d.value[v]=j),a("config-change",{...d.value})}function X(v){f.value={...v}}function T(){f.value={}}function x(v,j,G){G&&a("cell-click",{row:v,column:j,cell:G})}function C(){c.value=!c.value}function y(){o.value=!o.value,o.value?document.body.style.overflow="hidden":document.body.style.overflow=""}return me(()=>{const v=performance.now();V.info(`V4_TRIAL_SWITCH: PivotTableV3 MOUNTED for trial ${t.trial?.id||"unknown"} with ${h.value.length} calls`),we(()=>{const j=performance.now();V.info(`V4_TRIAL_SWITCH: PivotTableV3 DOM ready in ${(j-v).toFixed(1)}ms`)}),setTimeout(()=>{const j=performance.now();V.info(`V4_TRIAL_SWITCH: PivotTableV3 mount completed in ${(j-v).toFixed(1)}ms`)},0)}),xe(()=>{V.info(`V4_TRIAL_SWITCH: PivotTableV3 ACTIVATED (cache hit) for trial ${t.trial?.id||"unknown"} with ${h.value.length} calls`)}),Ae(()=>{V.info(`V4_TRIAL_SWITCH: PivotTableV3 DEACTIVATED (cached) for trial ${t.trial?.id||"unknown"}`)}),ye(()=>{V.info(`V4_TRIAL_SWITCH: PivotTableV3 UNMOUNTED (evicted) for trial ${t.trial?.id||"unknown"}`),o.value&&(document.body.style.overflow="")}),oe([k,h],([v])=>{const j=!d.value.rowField&&!d.value.columnField&&!d.value.valueField;if(h.value.length>0&&j&&v.categorical.length>0){V.info("PIVOT_FIX: Auto-initializing empty config"),d.value.rowField=v.categorical.find(Y=>Y!=="model"&&Y!=="status"&&Y!=="error_type")||v.categorical[0]||"model",d.value.columnField="model",d.value.valueField="parsed_response";const G=h.value.slice(0,3).map(Y=>ze(Y,d.value.valueField,t.trial)).filter(Y=>Y!=null),K=G.length>0&&G.every(Y=>typeof Y=="number");d.value.aggregation=K?"mean":"mode",a("config-change",{...d.value})}},{immediate:!0}),(v,j)=>(i(),p("div",{class:te(["pivot-table-v3",{fullscreen:o.value}])},[s("div",{class:te(["pivot-options-container",{collapsed:c.value}])},[s("div",{class:"options-header",onClick:C},[j[3]||(j[3]=s("span",{class:"options-title"},"Pivot Table Options",-1)),s("span",$d,b(c.value?"▶":"▼"),1)]),Ee(s("div",Cd,[Is([H(k),d.value],()=>(i(),p("div",null,[I(Ku,{config:d.value,"available-fields":H(k),onUpdateConfig:W},null,8,["config","available-fields"])])),j,0),s("div",kd,[h.value.length>0?(i(),Q(Td,{key:0,"api-calls":h.value,trial:v.trial,"active-filters":f.value,onUpdateFilters:X,onClearFilters:T},null,8,["api-calls","trial","active-filters"])):P("",!0),I(rd,{"selected-color-scale":n.value,"gradient-mode":u.value,"is-fullscreen":o.value,onUpdateColorScale:j[1]||(j[1]=G=>n.value=G),onUpdateGradientMode:j[2]||(j[2]=G=>u.value=G),onToggleFullscreen:y},null,8,["selected-color-scale","gradient-mode","is-fullscreen"])])],512),[[Ut,!c.value]])],2),v.showPerformanceInfo?(i(),p("div",wd,[s("span",null,"Computing: "+b(H(z)?"Yes":"No"),1),s("span",null,"Last Compute: "+b(H(N).toFixed(1))+"ms",1),s("span",null,"API Calls: "+b(h.value.length),1),s("span",null,"Filtered: "+b(E.value),1)])):P("",!0),s("div",Sd,[h.value.length===0?(i(),p("div",Id,j[4]||(j[4]=[s("p",null,"No data available for pivot table analysis.",-1)]))):d.value.aggregation in H(Ve)?H(z)?(i(),p("div",Rd,j[6]||(j[6]=[s("p",null,"Computing pivot table...",-1)]))):(i(),p("div",Fd,[s("table",Pd,[s("thead",null,[s("tr",xd,[s("th",Ad,b(L(d.value.rowField)||"Items")+" / "+b(L(d.value.columnField)||"Aggregated"),1),(i(!0),p(Z,null,ee(H(w).columns,G=>(i(),p("th",{key:G,class:"column-header",role:"columnheader"},b(G),1))),128)),d.value.columnField&&v.showTotals?(i(),p("th",Vd," Total ")):P("",!0)])]),s("tbody",null,[(i(!0),p(Z,null,ee(O.value,G=>(i(),p("tr",{key:`${G.label}-${H($)}`,class:"data-row",role:"row"},[s("td",Od,b(G.label),1),(i(!0),p(Z,null,ee(G.cells,(K,Y)=>(i(),p("td",{key:`${Y}-${H($)}`,class:te(["data-cell",{"error-cell":K?.error}]),"data-testid":K?.error?"pivot-cell-error":"pivot-cell",style:_e(H(S)(K,G.label,Y)),title:F(G.label,H(w).columns[Y],K),"aria-label":l(G.label,H(w).columns[Y],K),role:K?.error?"alert":"cell",tabindex:"0",onClick:ae=>x(G.label,H(w).columns[Y],K),onKeydown:[nt(ae=>x(G.label,H(w).columns[Y],K),["enter"]),nt(zt(ae=>x(G.label,H(w).columns[Y],K),["prevent"]),["space"])]},[K?.error?(i(),p("div",Nd,[s("span",{class:"error-indicator",title:K.error},"⚠️",8,Ld),s("span",Md,b(K?H($e)(K,d.value.aggregation):"-"),1),s("div",Ud,b(K.error),1)])):(i(),p("span",zd,b(K?H($e)(K,d.value.aggregation):"-"),1))],46,Dd))),128)),d.value.columnField&&v.showTotals?(i(),p("td",{key:0,class:"total-cell",style:_e(H(U)(G.total)),role:"cell"},b(H($e)(G.total,d.value.aggregation)),5)):P("",!0)]))),128)),d.value.rowField&&v.showTotals?(i(),p("tr",{key:`totals-${H($)}`,class:"total-row",role:"row"},[j[7]||(j[7]=s("td",{class:"row-header",role:"rowheader"},"Total",-1)),(i(!0),p(Z,null,ee(H(w).totals,(G,K)=>(i(),p("td",{key:`total-${K}-${H($)}`,class:"total-cell",style:_e(H(U)(G)),role:"cell"},b(H($e)(G,d.value.aggregation)),5))),128)),d.value.columnField?(i(),p("td",{key:0,class:"grand-total-cell",style:_e(H(U)(H(w).grandTotal)),role:"cell"},b(H($e)(H(w).grandTotal,d.value.aggregation)),5)):P("",!0)])):P("",!0)])])])):(i(),p("div",Ed,[s("p",null,"Invalid aggregation function: "+b(d.value.aggregation),1),j[5]||(j[5]=s("p",null,"Please select a valid aggregation method.",-1))]))])],2))}}),jd=re(Bd,[["__scopeId","data-v-1e95914b"]]),Wd={class:"modal-content"},Hd={class:"modal-header"},qd={class:"modal-title"},Gd={class:"summary-row"},Jd={key:0},Xd={key:0,class:"filter-row"},Kd=["onUpdate:modelValue","aria-label"],Qd={value:""},Yd=["value"],Zd={class:"table-container"},ec={class:"api-calls-table"},tc=["onClick"],sc=["title"],ac=["title"],nc=le({__name:"PivotCellDetailV3",props:{visible:{type:Boolean},row:{},column:{},apiCalls:{},trial:{},value:{}},emits:["close"],setup(r){const e=r,t=Es({}),a=q(null),{formatSingleCost:o}=Je(),n=M(()=>{const m=new Set;return e.apiCalls.forEach(L=>{L.variables&&Object.keys(L.variables).forEach(F=>m.add(F)),L.attributedVariables&&Object.entries(L.attributedVariables).forEach(([F,l])=>{l&&typeof l=="object"&&Object.keys(l).forEach(W=>{m.add(`${F}.${W}`)})})}),Array.from(m).sort()}),u=M(()=>n.value.map(m=>({title:m,dataIndex:`var_${m}`,key:`var_${m}`,width:150}))),c=[{title:"Status",dataIndex:"status",key:"status",width:100},{title:"Model",dataIndex:"model",key:"model",width:150}],d=[{title:"Response",dataIndex:"response",key:"response",width:300},{title:"Parsed Content",dataIndex:"parsedContent",key:"parsedContent",width:150},{title:"Duration",dataIndex:"duration",key:"duration",width:100},{title:"Cost",dataIndex:"cost",key:"cost",width:100}],f=M(()=>[...c,...u.value,...d]),g=M(()=>`${e.row} × ${e.column} - ${e.apiCalls.length} API Calls`),h=M(()=>e.apiCalls.map(m=>{const L={id:m.id,status:m.status,model:m.modelName||"-",response:m.result?.content||m.result?.error||"-",parsedContent:N(m.result?.parsedContent),duration:m.duration!==void 0?`${m.duration}ms`:"-",cost:m.cost!==void 0?m.cost:"-"};return n.value.forEach(F=>{if(F.includes(".")){const[l,W]=F.split("."),X=m.attributedVariables?.[l]?.[W];L[`var_${F}`]=X!==void 0?String(X):"-"}else L[`var_${F}`]=m.variables?.[F]||"-"}),L})),_=M(()=>Object.values(t).some(m=>m!==void 0&&m!=="")),R=M(()=>_.value?h.value.filter(m=>Object.entries(t).every(([L,F])=>F?m[L]===F:!0)):h.value),w=M(()=>{const m=e.apiCalls.filter(L=>L.status==="completed").length;return Math.round(m/e.apiCalls.length*100)}),k=M(()=>{const m=e.apiCalls.filter(L=>L.duration).map(L=>L.duration);return m.length===0?0:Math.round(m.reduce((L,F)=>L+F,0)/m.length)}),z=M(()=>{const m=e.apiCalls.filter(L=>L.cost!==void 0).map(L=>L.cost);if(m.length!==0)return m.reduce((L,F)=>L+F,0)});function N(m){if(m==null)return"-";if(typeof m=="string")return m;if(typeof m=="number"||typeof m=="boolean")return String(m);if(typeof m=="object")try{return JSON.stringify(m,null,2).substring(0,100)}catch{return"[Object]"}return String(m)}function O(m){switch(m){case"completed":return"status-success";case"failed":return"status-error";case"pending":return"status-warning";case"running":return"status-processing";default:return"status-default"}}function E(m,L=200){if(!m)return"";if(m.length<=L)return m;const F=m.slice(0,100),l=m.slice(-100);return`${F} [...TRUNCATED...] ${l}`}function S(m){const L=new Set;return h.value.forEach(F=>{const l=F[m];l&&l!=="-"&&L.add(l)}),Array.from(L).sort()}function U(){Object.keys(t).forEach(m=>{delete t[m]})}function $(m){const L=e.apiCalls.find(F=>F.id===m.id);L&&(a.value=L)}return(m,L)=>(i(),p(Z,null,[s("div",{class:te(["pivot-cell-detail-modal-v3",{visible:m.visible}]),onClick:L[1]||(L[1]=zt(F=>m.$emit("close"),["self"]))},[s("div",Wd,[s("div",Hd,[s("h3",qd,b(g.value),1),s("button",{type:"button",class:"close-btn","aria-label":"Close modal",onClick:L[0]||(L[0]=F=>m.$emit("close"))}," × ")]),s("div",Gd,[s("span",null,[L[3]||(L[3]=s("b",null,"Total:",-1)),D(" "+b(m.apiCalls.length),1)]),s("span",null,[L[4]||(L[4]=s("b",null,"Success Rate:",-1)),D(" "+b(w.value)+"%",1)]),s("span",null,[L[5]||(L[5]=s("b",null,"Avg Duration:",-1)),D(" "+b(k.value)+"ms",1)]),z.value!==void 0?(i(),p("span",Jd,[L[6]||(L[6]=s("b",null,"Total Cost:",-1)),D(" "+b(H(o)(z.value)),1)])):P("",!0)]),u.value.length>0?(i(),p("div",Xd,[(i(!0),p(Z,null,ee(u.value,F=>(i(),p("div",{key:F.key,class:"variable-filter"},[Ee(s("select",{"onUpdate:modelValue":l=>t[F.key]=l,"aria-label":`Filter ${F.title}`,class:"filter-select"},[s("option",Qd,"All "+b(F.title),1),(i(!0),p(Z,null,ee(S(F.key),l=>(i(),p("option",{key:l,value:l},b(l),9,Yd))),128))],8,Kd),[[Rs,t[F.key]]])]))),128)),_.value?(i(),p("button",{key:0,type:"button",class:"clear-filters-btn",onClick:U}," Clear Filters ")):P("",!0)])):P("",!0),s("div",Zd,[s("table",ec,[s("thead",null,[s("tr",null,[(i(!0),p(Z,null,ee(f.value,F=>(i(),p("th",{key:F.key,class:"table-header",style:_e({width:F.width?`${F.width}px`:"auto"})},b(F.title),5))),128))])]),s("tbody",null,[(i(!0),p(Z,null,ee(R.value,F=>(i(),p("tr",{key:F.id,class:"table-row clickable-row",onClick:l=>$(F)},[(i(!0),p(Z,null,ee(f.value,l=>(i(),p("td",{key:l.key,class:te(["table-cell",{"status-cell":l.key==="status"}])},[l.key==="status"?(i(),p("span",{key:0,class:te(["status-tag",O(F.status)])},b(F.status),3)):l.key==="response"?(i(),p("span",{key:1,class:"response-cell",title:F.response},b(E(F.response)),9,sc)):l.key==="cost"?(i(),p(Z,{key:2},[D(b(F.cost==="-"?"-":H(o)(F.cost)),1)],64)):l.key.startsWith("var_")?(i(),p("span",{key:3,class:"variable-cell",title:F[l.key]},b(F[l.key]||"-"),9,ac)):(i(),p(Z,{key:4},[D(b(F[l.key]||"-"),1)],64))],2))),128))],8,tc))),128))])])])])],2),a.value?(i(),Q(ls,{key:0,visible:!!a.value,"api-call":a.value,trial:m.trial,"onUpdate:visible":L[2]||(L[2]=F=>a.value=null)},null,8,["visible","api-call","trial"])):P("",!0)],64))}}),oc=re(nc,[["__scopeId","data-v-ddbda380"]]),lc={class:"trial-tab-content"},rc={class:"tab-pane-content"},ic={class:"tab-pane-content"},uc={key:0,class:"no-data-message"},dc={class:"tab-pane-content"},Vt="trial-details-active-tab",cc=le({__name:"TrialTabContentV3",props:{trial:{},progress:{},isLeader:{type:Boolean},executionState:{}},setup(r){const e=r,t=Bt(),a=He(),o=Xe(),n=M(()=>o.apiCalls?.value||[]),u=M(()=>o.isStreaming?.value||!1);oe(n,(O,E)=>{const S=performance.now();V.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls changed from ${E?.length||0} to ${O.length} calls`),setTimeout(()=>{const U=performance.now();V.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls reactive update completed in ${(U-S).toFixed(1)}ms`)},0)});const c=M(()=>!1),f=q((()=>{const O=t.query.tab;return O==="status"?"details":O&&["details","tasks","pivot"].includes(O)?O:"tasks"})()),g=q(!1);oe(f,O=>{o.setActiveTab(O)},{immediate:!0});const h=q(!1),_=q({row:"",column:"",apiCalls:[],value:null}),R=M(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial.id),w=M(()=>e.trial.progress.completed>0);function k(){localStorage.setItem(Vt,f.value);const O={...t.query};O.tab=f.value,t.query.tab!==f.value&&(a.replace({query:O}),`${f.value}`)}function z(){const O=localStorage.getItem(Vt);O==="status"?f.value="details":O&&["details","tasks","pivot"].includes(O)&&(f.value=O)}function N(O){!O.cell||!O.cell.apiCalls.length||(_.value={row:O.row,column:O.column,apiCalls:O.cell.apiCalls,value:O.cell.value},h.value=!0)}return oe(f,()=>{k()}),oe(()=>t.query.tab,O=>{if(O&&typeof O=="string"){let E=O==="status"?"details":O;["details","tasks","pivot"].includes(E)&&f.value!==E&&(f.value=E)}}),me(()=>{const O=performance.now();if(V.info(`V4_TRIAL_SWITCH: TrialTabContentV3 MOUNTED for trial ${e.trial.id}`),!t.query.tab){const E={...t.query};E.tab=f.value,a.replace({query:E}),`${f.value}`}z(),setTimeout(()=>{const E=performance.now();V.info(`V4_TRIAL_SWITCH: TrialTabContentV3 mount completed in ${(E-O).toFixed(1)}ms`)},0)}),xe(()=>{V.info(`V4_TRIAL_SWITCH: TrialTabContentV3 ACTIVATED (cache hit) for trial ${e.trial.id}`)}),Ae(()=>{V.info(`V4_TRIAL_SWITCH: TrialTabContentV3 DEACTIVATED (cached) for trial ${e.trial.id}`)}),ye(()=>{V.info(`V4_TRIAL_SWITCH: TrialTabContentV3 UNMOUNTED (evicted) for trial ${e.trial.id}`)}),(O,E)=>{const S=oa,U=na;return i(),p("div",lc,[I(U,{activeKey:f.value,"onUpdate:activeKey":E[1]||(E[1]=$=>f.value=$),type:"card",class:"trial-tabs"},{default:A(()=>[I(S,{key:"tasks",tab:"Task View"},{default:A(()=>[s("div",rc,[(i(),Q(ot,null,[I(Cu,{trial:O.trial,progress:O.progress,"is-executing":R.value,"api-calls":n.value,"is-streaming":u.value,"is-loading":c.value},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])],1024))])]),_:1}),I(S,{key:"pivot",tab:"Pivot Table"},{default:A(()=>[s("div",ic,[(i(),Q(ot,null,[w.value&&n.value.length>0?(i(),Q(jd,{key:0,"api-calls":n.value,trial:O.trial,"show-performance-info":!1,onCellClick:N},null,8,["api-calls","trial"])):P("",!0)],1024)),w.value&&n.value.length>0?P("",!0):(i(),p("div",uc,E[3]||(E[3]=[s("p",null,"No completed API calls available for pivot analysis.",-1),s("p",null,"Run the trial to see pivot table data.",-1)])))])]),_:1}),I(S,{key:"details",tab:"Details"},{default:A(()=>[s("div",dc,[I(fl,{trial:O.trial,"is-collapsed":g.value,onToggleCollapse:E[0]||(E[0]=$=>g.value=!g.value)},null,8,["trial","is-collapsed"])])]),_:1})]),_:1},8,["activeKey"]),h.value?(i(),Q(oc,{key:0,visible:h.value,row:_.value.row,column:_.value.column,"api-calls":_.value.apiCalls,trial:O.trial,value:_.value.value,onClose:E[2]||(E[2]=$=>h.value=!1)},null,8,["visible","row","column","api-calls","trial","value"])):P("",!0)])}}}),pc=re(cc,[["__scopeId","data-v-743ec3c1"]]);class de extends Error{constructor(t,a,o){super(a);Se(this,"code");Se(this,"details");this.name="ExportError",this.code=t,this.details=o}}function Ot(r){return typeof TextEncoder<"u"?new TextEncoder().encode(r).length:typeof Buffer<"u"?Buffer.byteLength(r,"utf8"):unescape(encodeURIComponent(r)).length}const ie=class ie{async loadTrialForExport(e){try{const t=this.getCachedData(e);if(t)return{ok:!0,value:t};const a=await Fe.trials.get(e);if(!a)return{ok:!1,error:new de("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})};const o=await Fe.apiCalls.where("trialId").equals(e).toArray(),n={trial:a,apiCalls:o,fieldDefinitions:[],parameterFields:[],totalRecords:o.length};return this.setCachedData(e,n),{ok:!0,value:n}}catch(t){return{ok:!1,error:new de("GENERATION_FAILED",`Failed to load trial data: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateTrialForExport(e){try{return await Fe.trials.get(e)?await Fe.apiCalls.where("trialId").equals(e).count()===0?{ok:!1,error:new de("GENERATION_FAILED","Trial has no API calls to export",{trialId:e,apiCallCount:0})}:{ok:!0,value:!0}:{ok:!1,error:new de("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})}}catch(t){return{ok:!1,error:new de("GENERATION_FAILED",`Failed to validate trial: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async getApiCallCount(e){try{return await Fe.apiCalls.where("trialId").equals(e).count()}catch(t){return V.warn(`Failed to get API call count for trial ${e}:`,t),0}}clearCache(e){ie.cache.delete(e),ie.cacheExpiry.delete(e)}clearAllCache(){ie.cache.clear(),ie.cacheExpiry.clear()}getCachedData(e){const t=ie.cacheExpiry.get(e);return!t||Date.now()>t?(ie.cache.delete(e),ie.cacheExpiry.delete(e),null):ie.cache.get(e)||null}setCachedData(e,t){ie.cache.set(e,t),ie.cacheExpiry.set(e,Date.now()+ie.CACHE_TTL)}};Se(ie,"cache",new Map),Se(ie,"cacheExpiry",new Map),Se(ie,"CACHE_TTL",6e4);let dt=ie;const Le=new dt;class fc{discoverAllParameters(e){const t=new Map;return e.configurations.forEach((a,o)=>{!a.parameters||typeof a.parameters!="object"||Object.entries(a.parameters).forEach(([n,u])=>{const c=`param_${n}`;t.has(c)||t.set(c,{parameterName:n,fieldId:c,usedByConfigurations:[],dataType:this.inferDataType(u),sampleValues:[]});const d=t.get(c);d.usedByConfigurations.push(o),d.sampleValues.length<3&&!d.sampleValues.includes(u)&&d.sampleValues.push(u)})}),Array.from(t.values()).map(a=>this.createParameterFieldDefinition(a,e)).sort((a,o)=>a.id.localeCompare(o.id))}getParameterUsageStats(e){const t=this.discoverAllParameters(e),a={},o=[],n=[];e.configurations.forEach((c,d)=>{const f=c.provider;a[f]||(a[f]=[]),t.forEach(g=>{g.usedByConfigurations.includes(d)&&(a[f].includes(g.parameterName)||a[f].push(g.parameterName))})});const u=Object.keys(a);return t.forEach(c=>{u.filter(f=>a[f].includes(c.parameterName)).length>1?o.push(c.parameterName):n.push(c.parameterName)}),{totalUniqueParameters:t.length,parametersByProvider:a,sharedParameters:o.sort(),providerSpecificParameters:n.sort()}}validateParameterFields(e,t){const o=this.discoverAllParameters(e).map(d=>d.id),n=t.filter(d=>d.startsWith("param_")),u=[],c=[];return n.forEach(d=>{o.includes(d)?u.push(d):c.push(d)}),{validFields:u,invalidFields:c,availableFields:o}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}createParameterFieldDefinition(e,t){const a=e.usedByConfigurations.map(n=>t.configurations[n]?.provider||"unknown").filter((n,u,c)=>c.indexOf(n)===u).sort(),o=this.generateParameterDescription(e,a);return{id:e.fieldId,name:e.parameterName,description:o,group:"parameters",dataType:e.dataType,isRequired:!1,parameterName:e.parameterName,usedByConfigurations:e.usedByConfigurations}}generateParameterDescription(e,t){const a=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(n=>JSON.stringify(n)).join(", ")})`:"";return`${t.length===1?`Used by ${t[0]}`:`Used by ${t.join(", ")}`}${a}. Empty for configurations that don't use this parameter.`}}const Be=new fc;class mc{discoverAllVariables(e,t){e.id,t.length;const a=new Map,o=new Map;t.forEach(g=>{g.variables&&typeof g.variables=="object"&&Object.entries(g.variables).forEach(([h,_])=>{const R=`var_${h}`;a.has(R)||a.set(R,{variableName:h,fieldId:R,usedByCallCount:0,dataType:this.inferDataType(_),sampleValues:[]});const w=a.get(R);w.usedByCallCount++,w.sampleValues.length<3&&!w.sampleValues.includes(_)&&w.sampleValues.push(_)}),g.variableAttributes&&typeof g.variableAttributes=="object"&&Object.entries(g.variableAttributes).forEach(([h,_])=>{!_||typeof _!="object"||Object.entries(_).forEach(([R,w])=>{const k=`attr_${h}_${R}`;o.has(k)||o.set(k,{attributeName:R,fieldId:k,usedByCallCount:0,dataType:this.inferDataType(w),sampleValues:[]});const z=o.get(k);z.usedByCallCount++,z.sampleValues.length<3&&!z.sampleValues.includes(w)&&z.sampleValues.push(w)})})});const n=Array.from(a.values()).map(g=>this.createVariableFieldDefinition(g,t.length)),u=Array.from(o.values()).map(g=>this.createAttributeFieldDefinition(g,t.length)),c=[];t.some(g=>g.variableIndices&&Object.keys(g.variableIndices).length>0)&&Array.from(a.values()).forEach(g=>{const h=g.variableName;c.push({id:`source_${h}_list`,name:`${h} Source List`,description:`Name of the list that provided the value for ${h}`,group:"source",dataType:"string",isRequired:!1}),c.push({id:`source_${h}_index`,name:`${h} Source Index`,description:`Position in the list (0-based) for ${h}`,group:"source",dataType:"number",isRequired:!1})});const f=[...n,...u,...c].sort((g,h)=>g.id.localeCompare(h.id));return n.length,u.length,c.length,f.length,n.map(g=>g.id),u.map(g=>g.id),f}getVariableUsageStats(e,t){const a=this.discoverAllVariables(e,t),o={};a.forEach(c=>{const d=c.name,f=this.getVariableInfo(d,t);o[d]=f.usedByCallCount});const n=Object.entries(o).sort(([,c],[,d])=>d-c).map(([c])=>c),u=t.filter(c=>c.variables&&typeof c.variables=="object"&&Object.keys(c.variables).length>0).length;return{totalUniqueVariables:a.length,variableUsageCounts:o,mostCommonVariables:n.slice(0,10),totalCallsWithVariables:u}}validateVariableFields(e,t,a){const n=this.discoverAllVariables(e,t).map(f=>f.id),u=a.filter(f=>f.startsWith("var_")),c=[],d=[];return u.forEach(f=>{n.includes(f)?c.push(f):d.push(f)}),{validFields:c,invalidFields:d,availableFields:n}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}getVariableInfo(e,t){let a=0;const o=[];return t.forEach(n=>{if(n.variables&&n.variables[e]!==void 0){a++;const u=n.variables[e];o.length<3&&!o.includes(u)&&o.push(u)}}),{attributeName:e,fieldId:`attr_${e}`,usedByCallCount:a,dataType:o.length>0?this.inferDataType(o[0]):"string",sampleValues:o}}createVariableFieldDefinition(e,t){const a=this.generateVariableDescription(e,t);return{id:e.fieldId,name:e.variableName,description:a,group:"content",dataType:e.dataType,isRequired:!1}}createAttributeFieldDefinition(e,t){const a=this.generateAttributeDescription(e,t),o=e.fieldId.replace("attr_","").split("_"),n=o[0],u=o.slice(1).join("_"),c=`${n} attr ${u}`;return{id:e.fieldId,name:c,description:a,group:"content",dataType:e.dataType,isRequired:!1}}generateVariableDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),o=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(n=>JSON.stringify(n)).join(", ")})`:"";return`Template variable used in ${e.usedByCallCount}/${t} calls (${a}%)${o}. Empty for calls that don't use this variable.`}generateAttributeDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),o=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(n=>JSON.stringify(n)).join(", ")})`:"";return`Variable attribute used in ${e.usedByCallCount}/${t} calls (${a}%)${o}. Empty for calls that don't use this attribute.`}}const rs=new mc;class vc{isAuthField(e){return e==="request"}sanitizeFieldValue(e,t,a,o){return!t||t.length===0?t:(t.length,this.isAuthField(e),a.id,e==="request"?this.sanitizeRequestField(t,a,o):t)}sanitizeRequestField(e,t,a){try{const o=JSON.parse(e),n=this.getProviderIdForCall(t,a);if(!n)return t.id,this.sanitizeGenericRequest(e);t.id;const u=As(o,n);return JSON.stringify(u,null,2)}catch(o){return o instanceof Error?o.message:String(o),t.id,"[MALFORMED_REQUEST_JSON_REDACTED_FOR_SAFETY]"}}sanitizeGenericRequest(e){try{const t=JSON.parse(e);if(t.headers){const a={...t.headers},o=["authorization","api-key","x-api-key","bearer","x-auth-token"];for(const[n,u]of Object.entries(a)){const c=n.toLowerCase();o.some(d=>c.includes(d))&&(a[n]=`${String(u).substring(0,8)}...REDACTED`)}t.headers=a}return JSON.stringify(t,null,2)}catch(t){return t instanceof Error?t.message:String(t),"[REQUEST_JSON_PARSE_FAILED_REDACTED]"}}getProviderIdForCall(e,t){try{return t.configurations[e.configurationIndex]?.provider||null}catch(a){return a instanceof Error?a.message:String(a),e.id,null}}getFieldsRequiringSanitization(){return["request"]}createSanitizationSummary(e){const t=e.filter(a=>this.isAuthField(a));return{sanitizationEnabled:t.length>0,sanitizedFields:t}}}const Dt=new vc;class gc{extractFieldValue(e,t,a){if(t.startsWith("param_"))return this.extractParameterValue(e,t,a);if(t.startsWith("var_"))return e.id,e.variables,this.extractVariableValue(e,t);if(t.startsWith("attr_")){e.id,e.variableAttributes;const n=this.extractAttributeValue(e,t);return e.id,n}if(t.startsWith("source_"))return this.extractSourceValue(e,t,a);const o=this.extractRawFieldValue(e,t,a);return Dt.isAuthField(t)?(e.id,Dt.sanitizeFieldValue(t,o,e,a)):o}extractRawFieldValue(e,t,a){switch(t){case"id":return e.id;case"order":return String(e.order);case"status":return e.status;case"created":return e.created.toISOString();case"completed":return e.completed?.toISOString()||"";case"configuration":return this.getConfigurationName(e,a);case"provider":return a.configurations[e.configurationIndex]?.provider||"";case"modelId":return a.configurations[e.configurationIndex]?.modelId||"";case"parameters":return this.getParametersJson(e,a);case"prompt":return e.prompt;case"variables":return JSON.stringify(e.variables||{});case"response":return e.result?.content||"";case"parsedResponse":return JSON.stringify(e.result?.parsedContent||{});case"latency":return String(e.response?.latencyMs||e.result?.latency||"");case"promptTokens":return String(e.result?.usage?.prompt_tokens||"");case"completionTokens":return String(e.result?.usage?.completion_tokens||"");case"totalTokens":return String(e.result?.usage?.total_tokens||"");case"request":return JSON.stringify(e.request||{});case"response_raw":return JSON.stringify(e.response||{});case"error":return e.result?.error||"";case"repeatIndex":return String(e.repeatIndex||"");case"cost":return e.cost!==void 0?String(e.cost):this.calculateCost(e,a);default:return`UNKNOWN_FIELD: ${t}`}}extractMultipleFields(e,t,a){const o={};return t.forEach(n=>{o[n]=this.extractFieldValue(e,n,a)}),o}getFieldDefinitions(e,t){const a=this.getStandardFieldDefinitions(),o=Be.discoverAllParameters(e),n=t?rs.discoverAllVariables(e,t):[];return[...a,...o,...n]}getStandardFieldDefinitions(){return[{id:"id",name:"Call ID",description:"Unique identifier for the API call",group:"basic",dataType:"string",isRequired:!0},{id:"order",name:"Order",description:"Execution order of the API call within the trial",group:"basic",dataType:"number",isRequired:!0},{id:"status",name:"Status",description:"Current status of the API call (pending, running, completed, failed, cancelled)",group:"basic",dataType:"string",isRequired:!0},{id:"created",name:"Created Time",description:"When the API call was created (ISO timestamp)",group:"basic",dataType:"date",isRequired:!0},{id:"completed",name:"Completed Time",description:"When the API call was completed (ISO timestamp, empty if not completed)",group:"basic",dataType:"date",isRequired:!1},{id:"configuration",name:"Configuration",description:"Configuration name or model ID used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"provider",name:"Provider",description:"LLM provider used (e.g., openai-chat, anthropic, ollama)",group:"configuration",dataType:"string",isRequired:!0},{id:"modelId",name:"Model ID",description:"Specific model identifier used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"prompt",name:"Prompt",description:"The input prompt sent to the model",group:"content",dataType:"string",isRequired:!0},{id:"response",name:"Response",description:"The text response from the model",group:"content",dataType:"string",isRequired:!1},{id:"parsedResponse",name:"Parsed Response",description:"Structured/parsed response data (JSON)",group:"content",dataType:"json",isRequired:!1},{id:"latency",name:"Latency (ms)",description:"Response time in milliseconds",group:"performance",dataType:"number",isRequired:!1},{id:"promptTokens",name:"Prompt Tokens",description:"Number of tokens in the input prompt",group:"performance",dataType:"number",isRequired:!1},{id:"completionTokens",name:"Completion Tokens",description:"Number of tokens in the model response",group:"performance",dataType:"number",isRequired:!1},{id:"totalTokens",name:"Total Tokens",description:"Total tokens used (prompt + completion)",group:"performance",dataType:"number",isRequired:!1},{id:"request",name:"Full Request",description:"Complete API request sent to the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"response_raw",name:"Raw Response",description:"Full API response from the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"error",name:"Error Details",description:"Error message if the call failed",group:"technical",dataType:"string",isRequired:!1},{id:"repeatIndex",name:"Repeat Index",description:"Index for repeated calls (empty for single calls)",group:"technical",dataType:"number",isRequired:!1},{id:"cost",name:"Cost (USD)",description:"Calculated cost of the API call based on token usage",group:"performance",dataType:"number",isRequired:!1}]}validateFields(e,t){const o=this.getFieldDefinitions(e).map(c=>c.id),n=[],u=[];return t.forEach(c=>{o.includes(c)?n.push(c):u.push(c)}),{validFields:n,invalidFields:u,availableFields:o}}extractParameterValue(e,t,a){const o=t.replace("param_",""),n=a.configurations[e.configurationIndex];if(!n||!n.parameters)return"";const u=n.parameters[o];return u==null?"":typeof u=="object"?JSON.stringify(u):String(u)}getConfigurationName(e,t){const a=t.configurations[e.configurationIndex];return a?a.modelId||`Config ${e.configurationIndex+1}`:`Config ${e.configurationIndex+1}`}getParametersJson(e,t){const a=t.configurations[e.configurationIndex];return!a||!a.parameters?"{}":JSON.stringify(a.parameters)}extractVariableValue(e,t){const a=t.replace("var_","");if(!e.variables||typeof e.variables!="object")return"";const o=e.variables[a];return o==null?"":typeof o=="object"?JSON.stringify(o):String(o)}extractAttributeValue(e,t){const a=t.replace("attr_","").split("_");if(a.length<2)return"";const o=a[0],n=a.slice(1).join("_");if(!e.variableAttributes||typeof e.variableAttributes!="object")return"";const u=e.variableAttributes[o];if(!u||typeof u!="object")return"";const c=u[n];return c==null?"":typeof c=="object"?JSON.stringify(c):String(c)}extractSourceValue(e,t,a){const o=t.replace("source_","").split("_");if(o.length<2)return"";const n=o[o.length-1],u=o.slice(0,-1).join("_");if(!e.variableIndices||typeof e.variableIndices!="object")return"";const c=e.variableIndices[u];if(c==null)return"";if(n==="index")return String(c);if(n==="list"){if(a.type==="template"&&a.templateConfig?.variables){const d=a.templateConfig.variables[u];if(d&&"snapshot"in d&&d.snapshot?.source?.listName)return d.snapshot.source.listName;if(d?.listId)return d.listId}return""}return""}calculateCost(e,t){if(!e.result?.usage)return"0";const a=t.configurations[e.configurationIndex];if(!a)return"0";const o=a.modelSnapshot;if(!o)return"0";const n=e.result.usage.prompt_tokens,u=e.result.usage.completion_tokens,c=kt(n,o.capabilities?.inputCostPerToken),d=kt(u,o.capabilities?.outputCostPerToken);if(c===null||d===null)return"N/A";const f=c+d;return Vs(f).replace("$","")}}const he=new gc;class hc{getMimeType(e){switch(e){case"csv":return"text/csv";case"excel":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"tsv":return"text/tab-separated-values";case"json":return"application/json";case"jsonl":return"application/x-jsonlines";case"python":return"text/x-python";case"zip":return"application/zip";default:return"application/octet-stream"}}getFileExtension(e){switch(e){case"csv":return"csv";case"excel":return"xlsx";case"tsv":return"tsv";case"json":return"json";case"jsonl":return"jsonl";case"python":return"py";case"zip":return"zip";default:return"bin"}}generateFilename(e,t,a){const o=this.sanitizeFilename(e),u=(a||new Date).toISOString().split("T")[0],c=this.getFileExtension(t);return`${o}_${t}_${u}.${c}`}estimateFileSize(e,t,a,o=50){let n=e*t*o;switch(a){case"json":n*=2.5;break;case"jsonl":n*=2.2;break;case"csv":n*=1.3;break;case"excel":n*=.8;break;case"tsv":n*=1.1;break;case"python":n=Math.max(n*1.5,5e3);break}return Math.round(n)}formatFileSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:`${(e/(1024*1024*1024)).toFixed(1)} GB`}createDownloadBlob(e,t,a=!1){let o=e;return a&&(o="\uFEFF"+o),new Blob([o],{type:t})}createDownloadBlobFromBase64(e,t){const a=atob(e),o=new Uint8Array(a.length);for(let n=0;n<a.length;n++)o[n]=a.charCodeAt(n);return new Blob([o],{type:t})}triggerDownload(e,t){const a=URL.createObjectURL(e),o=document.createElement("a");o.href=a,o.download=t,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(a),100)}downloadFile(e,t,a,o=!1){const n=this.getMimeType(t),u=this.generateFilename(a,t);let c;t==="excel"?c=this.createDownloadBlobFromBase64(e,n):c=this.createDownloadBlob(e,n,o),this.triggerDownload(c,u)}sanitizeFilename(e){return e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_+/g,"_").substring(0,50).replace(/^_+|_+$/g,"")||"trial"}}const ue=new hc;class yc{validateFormat(e){const t=["csv","tsv","excel","json","jsonl","python"];return t.includes(e)?{isValid:!0,errors:[],warnings:[]}:{isValid:!1,errors:[`Invalid format: ${e}. Supported formats: ${t.join(", ")}`],warnings:[]}}validateFields(e,t,a){if(!t||t.length===0)return{isValid:!1,errors:["No fields selected for export"],warnings:[],unknownFields:[],supportedFields:he.getFieldDefinitions(e,a).map(f=>f.id)};const o=he.validateFields(e,t),n=o.invalidFields.filter(f=>!f.startsWith("var_")&&!f.startsWith("attr_")),u={isValid:n.length===0,errors:[],warnings:[],unknownFields:n,supportedFields:o.availableFields};n.length>0&&u.errors.push(`Unknown fields requested: ${n.join(", ")}`),(t.includes("request")||t.includes("response_raw"))&&u.warnings.push("Technical fields (request, response_raw) contain large JSON objects and may significantly increase file size");const c=t.filter(f=>f.startsWith("param_"));c.length>10&&u.warnings.push(`Large number of parameter fields selected (${c.length}). This may result in a very wide export file with many empty cells.`);const d=t.filter(f=>f.startsWith("var_"));return d.length>10&&u.warnings.push(`Large number of variable fields selected (${d.length}). This may result in a very wide export file with many empty cells.`),u}validateExportSize(e,t,a){const o=ue.estimateFileSize(e,t,a),n=o/(1024*1024),u={isValid:!0,errors:[],warnings:[]};return n>500?(u.isValid=!1,u.errors.push(`Export too large: ${ue.formatFileSize(o)}. Maximum allowed: 500MB. Consider reducing the number of fields or using filters.`)):n>100&&u.warnings.push(`Large export: ${ue.formatFileSize(o)}. This may take several minutes to generate and download.`),e>1e5&&u.warnings.push(`Large number of records: ${e.toLocaleString()}. Export generation may take several minutes.`),t>50&&u.warnings.push(`Large number of fields: ${t}. Resulting file will be very wide and may be difficult to work with in spreadsheet applications.`),u}validateExportOptions(e,t,a){const o=[],n=[],u=this.validateFormat(t.format);if(u.isValid||o.push(...u.errors),t.fields){const c=this.validateFields(e,t.fields,a);c.isValid||o.push(...c.errors),n.push(...c.warnings);const d=this.validateExportSize(e.progress?.total||0,t.fields.length,t.format);d.isValid||o.push(...d.errors),n.push(...d.warnings)}return t.format==="python"&&t.fields&&t.fields.length>0&&n.push("Field selection is ignored for Python exports. Python scripts include all available data."),{isValid:o.length===0,errors:o,warnings:n}}getRecommendedFields(e){const t=["order","status","configuration","prompt","response","latency"],a=he.getFieldDefinitions(e).filter(u=>u.group==="parameters").map(u=>u.id),o=["param_temperature","param_max_tokens","param_top_p"],n=a.filter(u=>o.includes(u));return[...t,...n]}}const at=new yc;class Oe{validateOptions(e){const t=[],a=[];e.fields&&e.fields.length===0&&t.push("At least one field must be selected");const o=this.getFormatInfo();return e.includeHeaders&&!o.supportsHeaders&&a.push(`${o.name} format does not support headers - ignoring includeHeaders option`),e.addBOM&&!o.supportsBOM&&a.push(`${o.name} format does not support BOM - ignoring addBOM option`),{isValid:t.length===0,errors:t,warnings:a}}prepareFieldList(e,t){if(t&&t.length>0){const c=t.filter(h=>h.startsWith("var_")),d=t.filter(h=>h.startsWith("attr_")),f=t.filter(h=>!h.startsWith("var_")&&!h.startsWith("attr_")),g=he.validateFields(e,f);return g.invalidFields.length>0&&V.warn("Invalid fields requested:",g.invalidFields),[...g.validFields,...c,...d]}const a=["id","order","status","configuration","provider","modelId","prompt","response","latency"],o=Be.discoverAllParameters(e),n=["param_temperature","param_max_tokens","param_top_p"],u=o.filter(c=>n.includes(c.id)).map(c=>c.id);return[...a,...u]}prepareDataRows(e,t,a){return e.map(o=>t.map(n=>he.extractFieldValue(o,n,a)))}prepareHeaderRow(e){return e.map(t=>t.startsWith("param_")?`param_${t.replace("param_","")}`:t.replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase()).trim())}hasParameterFields(e){return e.some(t=>t.startsWith("param_"))}escapeFieldValue(e){return e==null?"":String(e)}}class bc extends Oe{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=[];if(a.includeHeaders!==!1){const f=this.prepareHeaderRow(o).map(g=>this.escapeCSVValue(g)).join(",");n.push(f)}this.prepareDataRows(e,o,t).forEach(d=>{const f=d.map(g=>this.escapeCSVValue(g)).join(",");n.push(f)});let c=n.join(`
`);return a.addBOM&&(c="\uFEFF"+c),c}getFormatInfo(){return{name:"CSV",description:"Comma-separated values format, compatible with Excel and other spreadsheet applications",mimeType:"text/csv",extension:"csv",supportsHeaders:!0,supportsBOM:!0}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];if(e.fields&&e.fields.length>30&&a.push("Large number of columns may make the CSV difficult to work with in spreadsheet applications"),e.fields){const o=["variables","parsedResponse","request","response_raw"];e.fields.some(u=>o.includes(u))&&a.push("JSON fields (variables, parsedResponse, request, response_raw) may not display well in spreadsheet applications")}return{...t,warnings:a}}escapeCSVValue(e){if(e==null)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes(`
`)||t.includes("\r")?`"${t.replace(/"/g,'""')}"`:t}}class _c extends Oe{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=[];if(a.includeHeaders!==!1){const d=this.prepareHeaderRow(o).map(f=>this.escapeTSVValue(f)).join("	");n.push(d)}return this.prepareDataRows(e,o,t).forEach(c=>{const d=c.map(f=>this.escapeTSVValue(f)).join("	");n.push(d)}),n.join(`
`)}getFormatInfo(){return{name:"TSV",description:"Tab-separated values format, useful for data analysis tools and database imports",mimeType:"text/tab-separated-values",extension:"tsv",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return a.push("TSV format may not be directly supported by all spreadsheet applications"),{...t,warnings:a}}escapeTSVValue(e){return e==null?"":String(e).replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}}class Tc extends Oe{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=tt.book_new(),u=[];if(a.includeHeaders!==!1){const h=this.prepareHeaderRow(o);u.push(h)}const c=this.prepareDataRows(e,o,t);u.push(...c);const d=tt.aoa_to_sheet(u),f=this.calculateColumnWidths(u);return d["!cols"]=f,tt.book_append_sheet(n,d,"Export Data"),ma(n,{type:"base64",bookType:"xlsx",compression:!0})}getFormatInfo(){return{name:"Excel",description:"Microsoft Excel .xlsx format with proper formatting and auto-sized columns",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",extension:"xlsx",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.fields&&e.fields.length>16384&&a.push("Excel has a limit of 16,384 columns - some fields may not display correctly"),e.addBOM&&a.push("Excel .xlsx format is binary - ignoring addBOM option"),a.push("Excel format provides native spreadsheet functionality with auto-sized columns"),{...t,warnings:a}}calculateColumnWidths(e){if(e.length===0)return[];const t=Math.max(...e.map(o=>o.length)),a=[];for(let o=0;o<t;o++){let n=10;for(const u of e)if(u[o]!==void 0){const c=String(u[o]).length;n=Math.max(n,Math.min(c*1.2,50))}a.push({wch:n})}return a}}class $c extends Oe{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n={metadata:{trialId:t.id,trialName:t.name,trialType:t.type,exportDate:new Date().toISOString(),recordCount:e.length,fieldCount:o.length,hasParameterFields:this.hasParameterFields(o)},trial:{id:t.id,name:t.name,description:t.description,type:t.type,status:t.status,created:t.created.toISOString(),configurations:t.configurations.map((u,c)=>({index:c,provider:u.provider,modelId:u.modelId,parameters:u.parameters||{}}))},fields:o.map(u=>{const c=he.getFieldDefinitions(t).find(d=>d.id===u);return{id:u,name:c?.name||u,description:c?.description||"",group:c?.group||"unknown",dataType:c?.dataType||"string"}}),apiCalls:e.map(u=>{const c={};return o.forEach(d=>{const f=he.extractFieldValue(u,d,t);c[d]=this.parseJSONValue(f,d)}),c})};return JSON.stringify(n,null,2)}getFormatInfo(){return{name:"JSON",description:"JavaScript Object Notation format with complete trial metadata and structured data",mimeType:"application/json",extension:"json",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSON format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSON format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("Large number of fields in JSON format may result in large file sizes and memory usage"),{...t,warnings:a}}parseJSONValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const n=Number(e);return isNaN(n)?null:n}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const n=Number(e);if(!isNaN(n))return n;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return e}}class Cc extends Oe{async generate(e,t,a){const o=this.prepareFieldList(t,a.fields),n=[];return e.forEach(u=>{const c={};o.forEach(d=>{const f=he.extractFieldValue(u,d,t);c[d]=this.parseJSONLValue(f,d)}),n.push(JSON.stringify(c))}),n.join(`
`)}getFormatInfo(){return{name:"JSONL",description:"JSON Lines format with one JSON object per line, ideal for streaming and big data processing",mimeType:"application/x-jsonlines",extension:"jsonl",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSONL format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSONL format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("JSONL format handles large datasets well, but many fields may impact readability"),{...t,warnings:a}}parseJSONLValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const u=Number(e);return isNaN(u)?null:u}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const u=Number(e);if(!isNaN(u))return u;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return["created","completed"].includes(t),e}}function kc(r){switch(r){case"csv":return new bc;case"tsv":return new _c;case"excel":return new Tc;case"json":return new $c;case"jsonl":return new Cc;default:throw new Error(`Unsupported format: ${r}`)}}class wc{async exportTrialData(e,t){const a=Date.now();t.format;try{const o=await Le.loadTrialForExport(e);if(!o.ok){const w=o.error;return{ok:!1,error:new de("GENERATION_FAILED",`Failed to load trial data: ${w.message}`,{trialId:e,originalError:w})}}const{trial:n,apiCalls:u}=o.value;t.format;const c=await this.validateExportOptions(e,t,u);if(!c.ok){const w=c.error;return{ok:!1,error:new de("GENERATION_FAILED",`Validation failed: ${w.message}`,{trialId:e,options:t,originalError:w})}}if(!c.value.isValid)return{ok:!1,error:new de("INVALID_FIELDS",`Export validation failed: ${c.value.errors.join(", ")}`,{errors:c.value.errors})};t.format;const d=kc(t.format);t.format,u.length,t.fields?.length,t.fields,t.fields?.filter(w=>w.startsWith("param_")),t.fields?.filter(w=>w.startsWith("var_")),t.fields?.filter(w=>w.startsWith("attr_"));const f=Date.now(),g=await d.generate(u,n,t);Date.now()-f,g.length,Ot(g);const h=t.fields||[],_=Date.now()-a,R={filename:ue.generateFilename(n.name,t.format),mimeType:d.getFormatInfo().mimeType,data:g,metadata:{trialName:n.name,trialId:n.id,exportDate:new Date,callCount:u.length,fieldCount:h.length,format:t.format,estimatedSizeBytes:Ot(g)},format:t.format,recordCount:u.length,fieldCount:h.length,hasParameterFields:h.some(w=>w.startsWith("param_")),generationTimeMs:_};return t.format,R.filename,R.metadata.estimatedSizeBytes,R.generationTimeMs,{ok:!0,value:R}}catch(o){const n=o instanceof Error?o:new Error(String(o));return n.message,n.stack,n.name,n.constructor.name,t.format,Date.now()-a,{ok:!1,error:new de("GENERATION_FAILED",`Export generation failed: ${n.message}`,{trialId:e,options:t,originalError:o,generationTimeMs:Date.now()-a})}}}async previewExport(e,t){try{const a=await Le.loadTrialForExport(e);if(!a.ok){const _=a.error;return{ok:!1,error:new de("GENERATION_FAILED",`Failed to load trial data: ${_.message}`,{trialId:e,originalError:_})}}const{trial:o,apiCalls:n}=a.value,u=he.getFieldDefinitions(o),c=Be.discoverAllParameters(o),d=t.fields||this.getDefaultFields(o),f=t.format||"csv",g=ue.estimateFileSize(n.length,d.length,f);return{ok:!0,value:{fieldCount:d.length,recordCount:n.length,estimatedSizeBytes:g,availableFields:u,parameterFields:c}}}catch(a){return{ok:!1,error:new de("GENERATION_FAILED",`Preview generation failed: ${a instanceof Error?a.message:"Unknown error"}`,{trialId:e,options:t,originalError:a})}}}async getAvailableFields(e){try{const t=await Le.loadTrialForExport(e);if(!t.ok){const f=t.error;return{ok:!1,error:new de("GENERATION_FAILED",`Failed to load trial data: ${f.message}`,{trialId:e,originalError:f})}}const{trial:a,apiCalls:o}=t.value,n=he.getStandardFieldDefinitions(),u=Be.discoverAllParameters(a),c=rs.discoverAllVariables(a,o),d=at.getRecommendedFields(a);return{ok:!0,value:{standardFields:n,parameterFields:u,variableFields:c,recommendedFields:d}}}catch(t){return{ok:!1,error:new de("GENERATION_FAILED",`Field discovery failed: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateExportOptions(e,t,a){try{const o=await Le.loadTrialForExport(e);if(!o.ok){const c=o.error;return{ok:!1,error:new de("GENERATION_FAILED",`Failed to load trial data: ${c.message}`,{trialId:e,originalError:c})}}const{trial:n}=o.value;return{ok:!0,value:at.validateExportOptions(n,t,a)}}catch(o){return{ok:!1,error:new de("GENERATION_FAILED",`Validation failed: ${o instanceof Error?o.message:"Unknown error"}`,{trialId:e,options:t,originalError:o})}}}getDefaultFields(e){return at.getRecommendedFields(e)}}const ct=new wc;let pt=null,ft=null,je=!1;try{typeof window<"u"&&("__TAURI__"in window||"__TAURI_INTERNALS__"in window)&&(je=!0)}catch{}async function Sc(){if(!je)return!1;try{return pt||(pt=await Re(()=>import("./tauri-vendor-DvKxkFnM.js").then(r=>r.b),[])),ft||(ft=await Re(()=>import("./tauri-vendor-DvKxkFnM.js").then(r=>r.c),[])),!0}catch(r){return V.warn("Failed to load Tauri modules:",r),je=!1,!1}}class is{async downloadFile(e,t,a,o=!1){await this.useTauriSaveDialog(e,t,a,o)||this.useBrowserDownload(e,t,a,o)}async useTauriSaveDialog(e,t,a,o){if(!await Sc())return!1;try{const n=ue.generateFilename(a,t),u=ue.getFileExtension(t),c=await pt.save({defaultPath:n,filters:[{name:this.getFilterName(t),extensions:[u]}],title:`Save ${this.getFilterName(t)} File`});if(!c)return!0;let d;if(typeof e=="string"){const f=o?"\uFEFF"+e:e;d=new TextEncoder().encode(f)}else d=e;return await ft.writeFile(c,d),`${c}`,!0}catch(n){return V.error("Tauri save dialog error:",n),!1}}useBrowserDownload(e,t,a,o){if(e instanceof Uint8Array&&(t==="zip"||t==="excel")){const h=ue.getMimeType(t),_=ue.generateFilename(a,t),R=new Blob([e],{type:h}),w=window.URL.createObjectURL(R),k=document.createElement("a");k.href=w,k.download=_,document.body.appendChild(k),k.click(),document.body.removeChild(k),window.URL.revokeObjectURL(w);return}e instanceof Uint8Array&&(e=new TextDecoder().decode(e));const n=ue.getMimeType(t),u=ue.generateFilename(a,t),c=o?"\uFEFF"+e:e,d=new Blob([c],{type:n}),f=window.URL.createObjectURL(d),g=document.createElement("a");g.href=f,g.download=u,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(f)}async downloadExcelFile(e,t){const a=atob(e),o=new Uint8Array(a.length);for(let n=0;n<a.length;n++)o[n]=a.charCodeAt(n);await this.downloadFile(o,"excel",t,!1)}getFilterName(e){switch(e){case"csv":return"CSV";case"excel":return"Excel";case"tsv":return"TSV";case"json":return"JSON";case"jsonl":return"JSON Lines";case"python":return"Python Script";case"zip":return"ZIP Archive";default:return"Binary"}}isInTauri(){return je}generateFilename(e,t,a){return ue.generateFilename(e,t,a)}getMimeType(e){return ue.getMimeType(e)}getFileExtension(e){return ue.getFileExtension(e)}estimateFileSize(e,t,a,o=50){return ue.estimateFileSize(e,t,a,o)}formatFileSize(e){return ue.formatFileSize(e)}}const We=new is,Ic=Object.freeze(Object.defineProperty({__proto__:null,TauriDownloadUtilities:is,tauriDownloadUtilities:We},Symbol.toStringTag,{value:"Module"})),Ec={class:"export-content"},Rc={class:"section"},Fc={key:0,class:"section"},Pc={class:"bundle-info"},xc={key:0},Ac={key:1,class:"section"},Vc={class:"field-actions"},Oc={class:"field-groups"},Dc={class:"field-group"},Nc={class:"field-list"},Lc={class:"field-group"},Mc={class:"field-list"},Uc={class:"field-group"},zc={class:"field-list"},Bc={class:"field-group"},jc={class:"field-list"},Wc={class:"field-group"},Hc={class:"field-list"},qc={key:0,class:"field-group"},Gc={class:"field-list"},Jc={key:1,class:"field-group"},Xc={class:"field-list"},Kc={class:"section"},Qc={class:"preview-info"},Yc={class:"info-item"},Zc={class:"value"},ep={class:"info-item"},tp={class:"value"},sp={class:"info-item"},ap={class:"value"},np={class:"export-actions"},op=le({__name:"ExportDataModalV3",props:{visible:{type:Boolean},trial:{}},emits:["update:visible"],setup(r,{emit:e}){const t=r,a=e,o=q("csv"),n=q(["order","status","configuration","prompt","response","latency"]),u=q(!1),c=q("draft"),d=q({}),f=q([]),g=q([]),h=q([]),_=["order","status","configuration","prompt","response","latency"],R=q([]),w=["id","order","status","created","completed","configuration","provider","modelId","parameters","prompt","variables","response","parsedResponse","latency","promptTokens","completionTokens","totalTokens","cost","request","response_raw","error","repeatIndex"],k=M(()=>{const F=t.trial.progress?.completed||0,l=t.trial.progress?.failed||0;return F+l}),z=M(()=>{const l=n.value.length*50*k.value;return l<1024?`${l} B`:l<1024*1024?`${(l/1024).toFixed(1)} KB`:`${(l/(1024*1024)).toFixed(1)} MB`});function N(){R.value.length,R.value.forEach(W=>{d.value[W]=!1}),_.forEach(W=>{d.value[W]=!0});const F=g.value.map(W=>W.id),l=h.value.map(W=>W.id);F.forEach(W=>{d.value[W]=!0}),l.forEach(W=>{d.value[W]=!0}),_.length,F.length,l.length,_.length+F.length+l.length,O()}function O(){n.value=R.value.filter(F=>d.value[F])}function E(F,l){d.value[F]=l,O()}function S(){R.value.forEach(F=>{d.value[F]=!0}),O()}function U(){R.value.forEach(W=>{d.value[W]=!1}),_.forEach(W=>{d.value[W]=!0});const F=g.value.map(W=>W.id),l=h.value.map(W=>W.id);F.forEach(W=>{d.value[W]=!0}),l.forEach(W=>{d.value[W]=!0}),O()}function $(){R.value.forEach(F=>{d.value[F]=!1}),O()}function m(){a("update:visible",!1)}async function L(){if(o.value==="bundle"){u.value=!0;try{const{trialBundleExportService:F}=await Re(async()=>{const{trialBundleExportService:X}=await import("./trial-bundle.service-Cs_CcyLH.js");return{trialBundleExportService:X}},__vite__mapDeps([0,1,2,3,4,5,6])),l=c.value==="completed",W=await F.exportTrialBundle(t.trial.id,{includeResults:l,includeApiCalls:l,format:"json"});W.ok?(ne.success(`Trial bundle exported: ${W.value.filename}`),a("update:visible",!1)):ne.error(`Bundle export failed: ${W.error.message}`)}catch(F){ne.error(`Bundle export failed: ${F instanceof Error?F.message:"Unknown error"}`)}finally{u.value=!1}return}if(n.value.length===0){ne.warning("Please select at least one field to export");return}u.value=!0;try{const F={format:o.value,fields:n.value,includeHeaders:!0,addBOM:o.value==="excel"||o.value==="csv"},l=await ct.exportTrialData(t.trial.id,F);l.ok?(F.format==="excel"&&typeof l.value.data=="string"?await We.downloadExcelFile(l.value.data,l.value.metadata.trialName):await We.downloadFile(l.value.data,F.format,l.value.metadata.trialName,F.addBOM),ne.success("Export completed successfully"),a("update:visible",!1)):ne.error(`Export failed: ${l.error.message}`)}catch(F){ne.error("Export failed: "+F.message)}finally{u.value=!1}}return me(async()=>{t.trial.id;const F=await ct.getAvailableFields(t.trial.id);if(F.ok){f.value=F.value.standardFields,g.value=F.value.parameterFields,h.value=(F.value.variableFields||[]).filter(T=>!T.id.startsWith("source_"));const l=F.value.standardFields.map(T=>T.id).filter(T=>T!=="parameters"&&T!=="variables"),W=F.value.parameterFields.map(T=>T.id),X=h.value.map(T=>T.id);R.value=[...l,...W,...X],F.value.standardFields.length,F.value.parameterFields.length,(F.value.variableFields||[]).length,R.value.length,F.value.parameterFields.map(T=>T.id),(F.value.variableFields||[]).map(T=>T.id),R.value}else F.error,R.value=[...w];N()}),(F,l)=>{const W=la,X=yt,T=bt,x=ve,C=Qt,y=Ce;return i(),Q(y,{visible:F.visible,"onUpdate:visible":l[46]||(l[46]=v=>F.$emit("update:visible",v)),title:"Export Trial Data",width:800,footer:null,"destroy-on-close":!0,class:"export-data-modal"},{default:A(()=>[s("div",Ec,[s("div",Rc,[l[53]||(l[53]=s("h4",null,"Export Format",-1)),I(X,{value:o.value,"onUpdate:value":l[0]||(l[0]=v=>o.value=v),class:"format-options"},{default:A(()=>[I(W,{value:"csv"},{default:A(()=>l[47]||(l[47]=[D("CSV")])),_:1,__:[47]}),I(W,{value:"tsv"},{default:A(()=>l[48]||(l[48]=[D("TSV")])),_:1,__:[48]}),I(W,{value:"excel"},{default:A(()=>l[49]||(l[49]=[D("Excel")])),_:1,__:[49]}),I(W,{value:"json"},{default:A(()=>l[50]||(l[50]=[D("JSON")])),_:1,__:[50]}),I(W,{value:"jsonl"},{default:A(()=>l[51]||(l[51]=[D("JSONL")])),_:1,__:[51]}),I(W,{value:"bundle"},{default:A(()=>l[52]||(l[52]=[D("Auditomatic Trial Format")])),_:1,__:[52]})]),_:1},8,["value"])]),o.value==="bundle"?(i(),p("div",Fc,[l[64]||(l[64]=s("h4",null,"Auditomatic Trial Format",-1)),s("div",Pc,[l[61]||(l[61]=s("p",{style:{"margin-bottom":"16px",color:"var(--color-text-secondary)"}}," Export your trial in Auditomatic's native format to recreate the exact trial on another browser or computer. Perfect for sharing experiments with collaborators or backing up your work. ",-1)),I(X,{value:c.value,"onUpdate:value":l[1]||(l[1]=v=>c.value=v),style:{"margin-bottom":"16px"}},{default:A(()=>[I(T,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:A(()=>l[54]||(l[54]=[s("strong",null,"Export as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Trial configuration only - recreate the trial setup and run a fresh experiment ",-1)])),_:1,__:[54]}),I(T,{value:"completed",style:{display:"block"}},{default:A(()=>l[55]||(l[55]=[s("strong",null,"Export with Results",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Complete trial with all execution results - review past experiments or continue where you left off ",-1)])),_:1,__:[55]})]),_:1},8,["value"]),l[62]||(l[62]=s("p",null,"The exported file contains:",-1)),s("ul",null,[l[56]||(l[56]=s("li",null,"✅ Complete trial configuration",-1)),l[57]||(l[57]=s("li",null,"✅ Template with metadata",-1)),l[58]||(l[58]=s("li",null,"✅ All variable lists",-1)),l[59]||(l[59]=s("li",null,"✅ Model configurations",-1)),c.value==="completed"?(i(),p("li",xc,"✅ Execution results and API calls")):P("",!0),l[60]||(l[60]=s("li",null,"✅ Variable index tracking for lineage",-1))]),l[63]||(l[63]=s("p",{style:{"margin-top":"12px"}},[s("strong",null,"To import:"),D(' Use the "Import Trial" button on the Trials page to load this file on any Auditomatic instance. ')],-1))])])):(i(),p("div",Ac,[l[97]||(l[97]=s("h4",null,"Fields to Export",-1)),s("div",Vc,[I(x,{size:"small",onClick:S},{default:A(()=>l[65]||(l[65]=[D("Select All")])),_:1,__:[65]}),I(x,{size:"small",onClick:U},{default:A(()=>l[66]||(l[66]=[D("Select Defaults")])),_:1,__:[66]}),I(x,{size:"small",onClick:$},{default:A(()=>l[67]||(l[67]=[D("Clear All")])),_:1,__:[67]})]),s("div",Oc,[s("div",Dc,[l[73]||(l[73]=s("h5",null,"Basic Information",-1)),s("div",Nc,[I(C,{checked:d.value.id,"onUpdate:checked":l[2]||(l[2]=v=>d.value.id=v),onChange:l[3]||(l[3]=v=>E("id",v.target.checked))},{default:A(()=>l[68]||(l[68]=[D("Call ID")])),_:1,__:[68]},8,["checked"]),I(C,{checked:d.value.order,"onUpdate:checked":l[4]||(l[4]=v=>d.value.order=v),onChange:l[5]||(l[5]=v=>E("order",v.target.checked))},{default:A(()=>l[69]||(l[69]=[D("Order")])),_:1,__:[69]},8,["checked"]),I(C,{checked:d.value.status,"onUpdate:checked":l[6]||(l[6]=v=>d.value.status=v),onChange:l[7]||(l[7]=v=>E("status",v.target.checked))},{default:A(()=>l[70]||(l[70]=[D("Status")])),_:1,__:[70]},8,["checked"]),I(C,{checked:d.value.created,"onUpdate:checked":l[8]||(l[8]=v=>d.value.created=v),onChange:l[9]||(l[9]=v=>E("created",v.target.checked))},{default:A(()=>l[71]||(l[71]=[D("Created Time")])),_:1,__:[71]},8,["checked"]),I(C,{checked:d.value.completed,"onUpdate:checked":l[10]||(l[10]=v=>d.value.completed=v),onChange:l[11]||(l[11]=v=>E("completed",v.target.checked))},{default:A(()=>l[72]||(l[72]=[D("Completed Time")])),_:1,__:[72]},8,["checked"])])]),s("div",Lc,[l[78]||(l[78]=s("h5",null,"Configuration",-1)),s("div",Mc,[I(C,{checked:d.value.configuration,"onUpdate:checked":l[12]||(l[12]=v=>d.value.configuration=v),onChange:l[13]||(l[13]=v=>E("configuration",v.target.checked))},{default:A(()=>l[74]||(l[74]=[D("Configuration Name")])),_:1,__:[74]},8,["checked"]),I(C,{checked:d.value.provider,"onUpdate:checked":l[14]||(l[14]=v=>d.value.provider=v),onChange:l[15]||(l[15]=v=>E("provider",v.target.checked))},{default:A(()=>l[75]||(l[75]=[D("Provider")])),_:1,__:[75]},8,["checked"]),I(C,{checked:d.value.modelId,"onUpdate:checked":l[16]||(l[16]=v=>d.value.modelId=v),onChange:l[17]||(l[17]=v=>E("modelId",v.target.checked))},{default:A(()=>l[76]||(l[76]=[D("Model ID")])),_:1,__:[76]},8,["checked"]),I(C,{checked:d.value.parameters,"onUpdate:checked":l[18]||(l[18]=v=>d.value.parameters=v),onChange:l[19]||(l[19]=v=>E("parameters",v.target.checked))},{default:A(()=>l[77]||(l[77]=[D("Parameters")])),_:1,__:[77]},8,["checked"])])]),s("div",Uc,[l[83]||(l[83]=s("h5",null,"Content",-1)),s("div",zc,[I(C,{checked:d.value.prompt,"onUpdate:checked":l[20]||(l[20]=v=>d.value.prompt=v),onChange:l[21]||(l[21]=v=>E("prompt",v.target.checked))},{default:A(()=>l[79]||(l[79]=[D("Prompt")])),_:1,__:[79]},8,["checked"]),I(C,{checked:d.value.variables,"onUpdate:checked":l[22]||(l[22]=v=>d.value.variables=v),onChange:l[23]||(l[23]=v=>E("variables",v.target.checked))},{default:A(()=>l[80]||(l[80]=[D("Variables")])),_:1,__:[80]},8,["checked"]),I(C,{checked:d.value.response,"onUpdate:checked":l[24]||(l[24]=v=>d.value.response=v),onChange:l[25]||(l[25]=v=>E("response",v.target.checked))},{default:A(()=>l[81]||(l[81]=[D("Response")])),_:1,__:[81]},8,["checked"]),I(C,{checked:d.value.parsedResponse,"onUpdate:checked":l[26]||(l[26]=v=>d.value.parsedResponse=v),onChange:l[27]||(l[27]=v=>E("parsedResponse",v.target.checked))},{default:A(()=>l[82]||(l[82]=[D("Parsed Response")])),_:1,__:[82]},8,["checked"])])]),s("div",Bc,[l[89]||(l[89]=s("h5",null,"Performance",-1)),s("div",jc,[I(C,{checked:d.value.latency,"onUpdate:checked":l[28]||(l[28]=v=>d.value.latency=v),onChange:l[29]||(l[29]=v=>E("latency",v.target.checked))},{default:A(()=>l[84]||(l[84]=[D("Latency (ms)")])),_:1,__:[84]},8,["checked"]),I(C,{checked:d.value.promptTokens,"onUpdate:checked":l[30]||(l[30]=v=>d.value.promptTokens=v),onChange:l[31]||(l[31]=v=>E("promptTokens",v.target.checked))},{default:A(()=>l[85]||(l[85]=[D("Prompt Tokens")])),_:1,__:[85]},8,["checked"]),I(C,{checked:d.value.completionTokens,"onUpdate:checked":l[32]||(l[32]=v=>d.value.completionTokens=v),onChange:l[33]||(l[33]=v=>E("completionTokens",v.target.checked))},{default:A(()=>l[86]||(l[86]=[D("Completion Tokens")])),_:1,__:[86]},8,["checked"]),I(C,{checked:d.value.totalTokens,"onUpdate:checked":l[34]||(l[34]=v=>d.value.totalTokens=v),onChange:l[35]||(l[35]=v=>E("totalTokens",v.target.checked))},{default:A(()=>l[87]||(l[87]=[D("Total Tokens")])),_:1,__:[87]},8,["checked"]),I(C,{checked:d.value.cost,"onUpdate:checked":l[36]||(l[36]=v=>d.value.cost=v),onChange:l[37]||(l[37]=v=>E("cost",v.target.checked))},{default:A(()=>l[88]||(l[88]=[D("Cost (USD)")])),_:1,__:[88]},8,["checked"])])]),s("div",Wc,[l[94]||(l[94]=s("h5",null,"Technical Details",-1)),s("div",Hc,[I(C,{checked:d.value.request,"onUpdate:checked":l[38]||(l[38]=v=>d.value.request=v),onChange:l[39]||(l[39]=v=>E("request",v.target.checked))},{default:A(()=>l[90]||(l[90]=[D("Full Request")])),_:1,__:[90]},8,["checked"]),I(C,{checked:d.value.response_raw,"onUpdate:checked":l[40]||(l[40]=v=>d.value.response_raw=v),onChange:l[41]||(l[41]=v=>E("response_raw",v.target.checked))},{default:A(()=>l[91]||(l[91]=[D("Raw Response")])),_:1,__:[91]},8,["checked"]),I(C,{checked:d.value.error,"onUpdate:checked":l[42]||(l[42]=v=>d.value.error=v),onChange:l[43]||(l[43]=v=>E("error",v.target.checked))},{default:A(()=>l[92]||(l[92]=[D("Error Details")])),_:1,__:[92]},8,["checked"]),I(C,{checked:d.value.repeatIndex,"onUpdate:checked":l[44]||(l[44]=v=>d.value.repeatIndex=v),onChange:l[45]||(l[45]=v=>E("repeatIndex",v.target.checked))},{default:A(()=>l[93]||(l[93]=[D("Repeat Index")])),_:1,__:[93]},8,["checked"])])]),g.value.length>0?(i(),p("div",qc,[l[95]||(l[95]=s("h5",null,"Parameters (Individual Columns)",-1)),s("div",Gc,[(i(!0),p(Z,null,ee(g.value,v=>(i(),Q(C,{key:v.id,checked:d.value[v.id],"onUpdate:checked":j=>d.value[v.id]=j,onChange:j=>E(v.id,j.target.checked)},{default:A(()=>[D(b(v.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):P("",!0),h.value.length>0?(i(),p("div",Jc,[l[96]||(l[96]=s("h5",null,"Attributes (Individual Columns)",-1)),s("div",Xc,[(i(!0),p(Z,null,ee(h.value,v=>(i(),Q(C,{key:v.id,checked:d.value[v.id],"onUpdate:checked":j=>d.value[v.id]=j,onChange:j=>E(v.id,j.target.checked)},{default:A(()=>[D(b(v.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):P("",!0)])])),s("div",Kc,[l[101]||(l[101]=s("h4",null,"Export Preview",-1)),s("div",Qc,[s("div",Yc,[l[98]||(l[98]=s("span",{class:"label"},"Records:",-1)),s("span",Zc,b(k.value),1)]),s("div",ep,[l[99]||(l[99]=s("span",{class:"label"},"Fields:",-1)),s("span",tp,b(n.value.length),1)]),s("div",sp,[l[100]||(l[100]=s("span",{class:"label"},"Estimated Size:",-1)),s("span",ap,b(z.value),1)])])]),s("div",np,[I(x,{onClick:m},{default:A(()=>l[102]||(l[102]=[D("Cancel")])),_:1,__:[102]}),I(x,{type:"primary",onClick:L,loading:u.value,disabled:n.value.length===0},{default:A(()=>[I(H(Zt)),l[103]||(l[103]=D(" Export "))]),_:1,__:[103]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),lp=re(op,[["__scopeId","data-v-8229d46c"]]),rp={class:"trial-details-panel"},ip={key:0,class:"loading-state"},up={key:1,class:"error-state"},dp={class:"error-actions"},cp=le({__name:"TrialDetailsPanelV3",props:{trial:{},isLeader:{type:Boolean},executionState:{},progress:{}},emits:["start-trial","pause-trial","resume-trial","cancel-trial","duplicate-trial","edit-trial","delete-trial","export-data","export-python"],setup(r){const e=r,t=He(),a=q(!1),o=q(null),n=q(!1),u=ts(),c=M(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial?.id);function d(){o.value=null}function f(){t.push("/trials")}function g(){n.value=!0}async function h(){if(e.trial){`${e.trial.id}`;try{u.isActive&&u.currentTrialId===e.trial.id&&u.stopStreaming(),await u.loadHistoricalData(e.trial.id),`${e.trial.id}`,(e.trial.status==="running"||e.trial.status==="paused")&&await u.startStreaming(e.trial.id)}catch(_){V.error("REFRESH: Failed to refresh trial data:",_)}}}return oe(()=>e.trial,(_,R)=>{_&&_.id!==R?.id&&(o.value=null,V.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 switching from ${R?.id} to ${_.id}`))}),me(()=>{const _=e.trial?.id;V.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 MOUNTED for trial ${_}`)}),xe(()=>{const _=e.trial?.id;V.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 ACTIVATED (cache hit) for trial ${_}`)}),Ae(()=>{const _=e.trial?.id;V.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 DEACTIVATED (cached) for trial ${_}`)}),ye(()=>{const _=e.trial?.id;V.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 UNMOUNTED (evicted) for trial ${_}`)}),(_,R)=>{const w=ve;return i(),p("div",rp,[a.value?(i(),p("div",ip,[I(H(Gt),{class:"loading-spinner",spin:""}),R[9]||(R[9]=s("span",null,"Loading trial details...",-1))])):o.value?(i(),p("div",up,[I(H(Pe),{class:"error-icon"}),R[12]||(R[12]=s("h3",null,"Failed to load trial",-1)),s("p",null,b(o.value),1),s("div",dp,[I(w,{onClick:d},{default:A(()=>R[10]||(R[10]=[D("Retry")])),_:1,__:[10]}),I(w,{type:"link",onClick:f},{default:A(()=>R[11]||(R[11]=[D("Go Back")])),_:1,__:[11]})])])):_.trial?(i(),p(Z,{key:2},[I(Gn,{trial:_.trial,progress:_.progress,"is-executing":c.value},null,8,["trial","progress","is-executing"]),I(Zn,{trial:_.trial,"is-leader":_.isLeader,"execution-state":_.executionState,onStart:R[0]||(R[0]=k=>_.$emit("start-trial")),onPause:R[1]||(R[1]=k=>_.$emit("pause-trial")),onResume:R[2]||(R[2]=k=>_.$emit("resume-trial")),onCancel:R[3]||(R[3]=k=>_.$emit("cancel-trial")),onDuplicate:R[4]||(R[4]=k=>_.$emit("duplicate-trial",_.trial.id)),onEdit:R[5]||(R[5]=k=>_.$emit("edit-trial",_.trial.id)),onDelete:R[6]||(R[6]=k=>_.$emit("delete-trial",_.trial.id)),onExportData:g,onExportPython:R[7]||(R[7]=k=>_.$emit("export-python",_.trial.id)),onRefresh:h},null,8,["trial","is-leader","execution-state"]),_.trial&&n.value?(i(),Q(lp,{key:0,visible:n.value,trial:_.trial,"onUpdate:visible":R[8]||(R[8]=k=>n.value=!1)},null,8,["visible","trial"])):P("",!0),I(pc,{trial:_.trial,progress:_.progress,"is-leader":_.isLeader,"execution-state":_.executionState},null,8,["trial","progress","is-leader","execution-state"])],64)):P("",!0)])}}}),pp=re(cp,[["__scopeId","data-v-081db72e"]]),fp={class:"import-content"},mp={class:"upload-section"},vp={class:"ant-upload-drag-icon"},gp={key:0,class:"preview-section"},hp={class:"bundle-details"},yp={class:"detail-row"},bp={class:"value"},_p={class:"detail-row"},Tp={class:"value"},$p={class:"detail-row"},Cp={class:"value"},kp={class:"detail-row"},wp={class:"value"},Sp={key:0,style:{color:"green","margin-left":"8px"}},Ip={key:1,style:{color:"orange","margin-left":"8px"}},Ep={key:0,class:"detail-row"},Rp={class:"value"},Fp={class:"detail-row"},Pp={class:"value"},xp={class:"import-options"},Ap={key:0,style:{"margin-bottom":"12px"}},Vp={key:1,style:{"margin-bottom":"12px",padding:"8px",background:"#f0f0f0","border-radius":"4px"}},Op={key:0,class:"warnings"},Dp={class:"modal-actions"},Np=le({__name:"ImportTrialDialog",props:{visible:{type:Boolean}},emits:["update:visible","trial-imported"],setup(r,{emit:e}){const t=r,a=e,o=He(),n=q([]),u=q(null),c=q(!1),d=q([]),f=q({mode:"draft",namePrefix:"Imported: "}),g=M({get:()=>t.visible,set:E=>a("update:visible",E)}),h=M(()=>u.value?.execution?.apiCalls&&u.value.execution.apiCalls.length>0);function _(E){return!1}async function R(E){const S=E.file.originFileObj||E.file;if(S)try{const U=await w(S),$=JSON.parse(U);d.value=k($),u.value=$,$.execution?.apiCalls&&$.execution.apiCalls.length>0,f.value.mode="draft"}catch{ne.error("Failed to read bundle file: Invalid JSON format"),u.value=null}}function w(E){return new Promise((S,U)=>{const $=new FileReader;$.onload=m=>S(m.target?.result),$.onerror=U,$.readAsText(E)})}function k(E){const S=[];return E.version||S.push("Bundle version is missing"),E.configuration?.trial||S.push("Trial configuration is missing"),(!E.configuration?.variableLists||E.configuration.variableLists.length===0)&&S.push("No variable lists found in bundle"),E.version!=="1.0"&&S.push(`Bundle version ${E.version} may not be fully compatible`),S}function z(E){return new Date(E).toLocaleString()}function N(){n.value=[],u.value=null,d.value=[],g.value=!1}async function O(){if(!u.value){ne.error("No bundle to import");return}c.value=!0;try{const{trialBundleImportService:E}=await Re(async()=>{const{trialBundleImportService:$}=await import("./trial-bundle.service-Cs_CcyLH.js");return{trialBundleImportService:$}},__vite__mapDeps([0,1,2,3,4,5,6])),S=h.value&&f.value.mode==="completed",U=await E.importTrialBundle(JSON.stringify(u.value),{importResults:S,importAsCompleted:S,namePrefix:f.value.namePrefix||void 0});U.ok?(ne.success("Trial imported successfully!"),o.push(`/trials?trialId=${U.value.trialId}`),a("trial-imported",U.value.trialId),N()):ne.error(`Import failed: ${U.error.message}`)}catch(E){ne.error(`Import failed: ${E instanceof Error?E.message:"Unknown error"}`)}finally{c.value=!1}}return(E,S)=>{const U=ra,$=bt,m=yt,L=Kt,F=Ge,l=ve,W=Ce;return i(),Q(W,{visible:g.value,"onUpdate:visible":S[3]||(S[3]=X=>g.value=X),title:"Import Trial Bundle",width:600,footer:null,"destroy-on-close":!0,class:"import-trial-modal"},{default:A(()=>[s("div",fp,[s("div",mp,[I(U,{fileList:n.value,"onUpdate:fileList":S[0]||(S[0]=X=>n.value=X),"before-upload":_,"max-count":1,accept:".json",onChange:R},{default:A(()=>[s("p",vp,[I(H(qt))]),S[4]||(S[4]=s("p",{class:"ant-upload-text"},"Click or drag trial bundle file here",-1)),S[5]||(S[5]=s("p",{class:"ant-upload-hint"}," Supports .json files exported from trials ",-1))]),_:1,__:[4,5]},8,["fileList"])]),u.value?(i(),p("div",gp,[S[17]||(S[17]=s("h3",null,"Bundle Contents",-1)),s("div",hp,[s("div",yp,[S[6]||(S[6]=s("span",{class:"label"},"Trial Name:",-1)),s("span",bp,b(u.value.metadata.trialName),1)]),s("div",_p,[S[7]||(S[7]=s("span",{class:"label"},"Export Date:",-1)),s("span",Tp,b(z(u.value.metadata.exportDate)),1)]),s("div",$p,[S[8]||(S[8]=s("span",{class:"label"},"Status:",-1)),s("span",Cp,b(u.value.metadata.trialStatus),1)]),s("div",kp,[S[9]||(S[9]=s("span",{class:"label"},"API Calls:",-1)),s("span",wp,[D(b(u.value.metadata.apiCallCount)+" ",1),h.value?(i(),p("span",Sp," (with results) ")):(i(),p("span",Ip," (configuration only) "))])]),u.value.configuration.template?(i(),p("div",Ep,[S[10]||(S[10]=s("span",{class:"label"},"Template:",-1)),s("span",Rp,b(u.value.configuration.template.name),1)])):P("",!0),s("div",Fp,[S[11]||(S[11]=s("span",{class:"label"},"Variable Lists:",-1)),s("span",Pp,b(u.value.configuration.variableLists?.length||0),1)])]),s("div",xp,[S[16]||(S[16]=s("h4",null,"Import Options",-1)),h.value?(i(),p("div",Ap,[I(m,{value:f.value.mode,"onUpdate:value":S[1]||(S[1]=X=>f.value.mode=X),style:{display:"block"}},{default:A(()=>[I($,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:A(()=>S[12]||(S[12]=[s("strong",null,"Import as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Create fresh trial ready to run new experiment ",-1)])),_:1,__:[12]}),I($,{value:"completed",style:{display:"block"}},{default:A(()=>S[13]||(S[13]=[s("strong",null,"Import as Completed",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Preserve historical results for review/analysis ",-1)])),_:1,__:[13]})]),_:1},8,["value"])])):(i(),p("div",Vp,S[14]||(S[14]=[s("strong",null,"Draft Trial",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px"}}," This bundle contains configuration only - will import as draft ready to run ",-1)]))),I(L,{value:f.value.namePrefix,"onUpdate:value":S[2]||(S[2]=X=>f.value.namePrefix=X),placeholder:"Name prefix (optional)",style:{"margin-top":"8px"}},{prefix:A(()=>S[15]||(S[15]=[D("Name:")])),_:1},8,["value"])]),d.value.length>0?(i(),p("div",Op,[I(F,{message:"Import Warnings",type:"warning","show-icon":""},{description:A(()=>[s("ul",null,[(i(!0),p(Z,null,ee(d.value,X=>(i(),p("li",{key:X},b(X),1))),128))])]),_:1})])):P("",!0)])):P("",!0),s("div",Dp,[I(l,{onClick:N},{default:A(()=>S[18]||(S[18]=[D("Cancel")])),_:1,__:[18]}),I(l,{type:"primary",onClick:O,loading:c.value,disabled:!u.value},{default:A(()=>[I(H(Ht)),S[19]||(S[19]=D(" Import Trial "))]),_:1,__:[19]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),Lp=re(Np,[["__scopeId","data-v-1d9366d6"]]),Mp={class:"option-content"},Up={class:"option-header"},zp={class:"modal-footer"},Bp=le({__name:"PythonExportModal",props:{visible:{type:Boolean},trialId:{}},emits:["update:visible"],setup(r,{emit:e}){const t=r,a=e,o=M({get:()=>t.visible,set:d=>a("update:visible",d)}),n=q("script-config-data"),u=q(!1);oe(o,d=>{d&&(n.value="script-config-data",u.value=!1)});async function c(){if(n.value){u.value=!0;try{const{reproducibilityBundleService:d}=await Re(async()=>{const{reproducibilityBundleService:g}=await import("./index-Cmt64CuX.js");return{reproducibilityBundleService:g}},__vite__mapDeps([7,1,2,3,4,5,0,6,8,9,10,11,12,13,14,15,16,17,18])),f=await d.exportBundle(t.trialId,{bundleType:n.value,includeComments:!0});if(f.ok){const{tauriDownloadUtilities:g}=await Re(async()=>{const{tauriDownloadUtilities:h}=await Promise.resolve().then(()=>Ic);return{tauriDownloadUtilities:h}},void 0);if(n.value==="script-only"){const h=await f.value.zipBlob.text();await g.downloadFile(h,"python",f.value.filename.replace(".zip",""),!1),ne.success("Python script downloaded successfully")}else{const h=await f.value.zipBlob.arrayBuffer(),_=new Uint8Array(h);await g.downloadFile(_,"zip",f.value.filename.replace(".zip",""),!1);const R=n.value==="script-config-data"?"Complete archive bundle":"Reproducibility bundle";ne.success(`${R} downloaded successfully`)}o.value=!1}else throw new Error(f.error?.message||"Export failed")}catch(d){V.error("Export failed:",d),ne.error(`Failed to export: ${d instanceof Error?d.message:"Unknown error"}`)}finally{u.value=!1}}}return(d,f)=>{const g=bt,h=qe,_=yt,R=ve,w=Ce;return i(),Q(w,{visible:o.value,"onUpdate:visible":f[1]||(f[1]=k=>o.value=k),title:"Export for Reproducibility",width:600,footer:null,"destroy-on-close":!0},{default:A(()=>[f[10]||(f[10]=s("p",{class:"export-description"}," Choose your export format: ",-1)),I(_,{value:n.value,"onUpdate:value":f[0]||(f[0]=k=>n.value=k),class:"export-options"},{default:A(()=>[I(g,{value:"script-only",class:"export-option"},{default:A(()=>f[2]||(f[2]=[s("div",{class:"option-content"},[s("div",{class:"option-header"},[s("span",{class:"option-icon"},"📄"),s("strong",{class:"option-title"},"Python Script Only")]),s("div",{class:"option-description"}," Minimal Python script (~200-400 lines) with clear experimental design. "),s("div",{class:"option-files"},"• experiment.py")],-1)])),_:1,__:[2]}),I(g,{value:"script-config",class:"export-option"},{default:A(()=>f[3]||(f[3]=[s("div",{class:"option-content"},[s("div",{class:"option-header"},[s("span",{class:"option-icon"},"📦"),s("strong",{class:"option-title"},"Reproducibility Bundle")]),s("div",{class:"option-description"}," Python script + complete trial configuration. "),s("div",{class:"option-files"}," • experiment.py • trial_config.json • README.md ")],-1)])),_:1,__:[3]}),I(g,{value:"script-config-data",class:"export-option recommended"},{default:A(()=>[s("div",Mp,[s("div",Up,[f[5]||(f[5]=s("span",{class:"option-icon"},"🗂️",-1)),f[6]||(f[6]=s("strong",{class:"option-title"},"Complete Archive Bundle",-1)),I(h,{color:"green",style:{"margin-left":"8px"}},{default:A(()=>f[4]||(f[4]=[D("Recommended")])),_:1,__:[4]})]),f[7]||(f[7]=s("div",{class:"option-description"}," Everything: Python script + configuration + all experimental results. ",-1)),f[8]||(f[8]=s("div",{class:"option-files"}," • experiment.py • trial_config.json • data/results.{csv,xlsx,jsonl} • README.md ",-1))])]),_:1})]),_:1},8,["value"]),s("div",zp,[I(R,{type:"primary",size:"large",disabled:!n.value,loading:u.value,onClick:c},{default:A(()=>[I(H(Zt)),f[9]||(f[9]=D(" Download "))]),_:1,__:[9]},8,["disabled","loading"])])]),_:1,__:[10]},8,["visible"])}}}),jp=re(Bp,[["__scopeId","data-v-6cec199d"]]),Wp={class:"trials-view-v3"},Hp={key:0,class:"provider-warning-banner"},qp={class:"banner-content"},Gp={key:1,class:"observer-mode-banner"},Jp={class:"banner-content"},Xp={key:1,class:"loading-left-pane"},Kp={key:0,class:"no-selection"},Qp={key:0,class:"observer-note"},Yp=le({__name:"TrialsViewV3",setup(r){const e=va(),{trials:t}=da(),{enabledModels:a}=ga(),{duplicateTrial:o,deleteTrial:n}=ca(),u=ts(),c=Bt(),d=He(),f=q(),g=q(!0),h=q(null),_=q(""),R=q("all"),w=q(-1),k=q(!1),z=q(!1),N=q(!1),O=M(()=>a.value.length>0),E=M(()=>!O.value&&!N.value),S=e.isLeader,U=e.execution,{trial:$}=pa(h),m=M(()=>{const B=$.value?.progress;return B?{trialId:h.value||"",...B,lastUpdated:new Date}:null}),L=M(()=>{let B=t.value;if(_.value){const J=_.value.toLowerCase();B=B.filter(se=>{const Te=se.name.toLowerCase().includes(J),be=se.templateConfig?.template?.toLowerCase().includes(J),pe=se.configurations.some(ke=>ke.modelId.toLowerCase().includes(J)||ke.provider.toLowerCase().includes(J));return Te||be||pe})}return R.value!=="all"&&(B=B.filter(J=>J.status===R.value)),B});async function F(){const B=c.query;if(B.duplicate){const J=B.duplicate,se=await o(J);se.ok?await d.push({path:"/trials/create",query:{duplicate:se.value,edit:B.edit==="true"?"true":void 0}}):fe.error(`Failed to duplicate trial: ${se.error?.message||"Unknown error"}`),await d.replace({query:{}});return}if(B.designId||B.promptSource){await d.push({path:"/trials/create",query:B});return}if(c.query.trialId){const J=c.query.trialId;W(J)}}function l(){if(h.value||t.value.length===0)return;const B=t.value.find(J=>J.status==="running");if(B){W(B.id);return}W(t.value[0].id)}async function W(B){const J=performance.now();V.info(`V4_TRIAL_SWITCH: Starting trial selection: ${B}`),h.value=B;const se=performance.now();if(V.info(`V4_TRIAL_SWITCH: UI updated in ${(se-J).toFixed(1)}ms`),t.value.length>0){const pe=L.value.findIndex(ke=>ke.id===B);pe>=0&&(w.value=pe)}const Te=performance.now();if(V.info(`V4_TRIAL_SWITCH: Starting stream manager for trial ${B} at ${(Te-J).toFixed(1)}ms`),u.startStreaming(B).catch(pe=>{V.error(`V4_TRIAL_SWITCH: Failed to start streaming for trial ${B}`,pe)}),c.query.trialId!==B){const pe={...c.query};pe.trialId=B,pe.tab||(pe.tab="status"),d.push({path:"/trials",query:pe}),V.info(`V4_TRIAL_SWITCH: URL updated to preserve tab '${pe.tab}' at ${(performance.now()-J).toFixed(1)}ms`)}f.value&&f.value.closeMobileOverlay();const be=performance.now();V.info(`V4_TRIAL_SWITCH: selectTrial() completed in ${(be-J).toFixed(1)}ms`)}function X(B){_.value=B,w.value=-1}function T(B){R.value=B,w.value=-1}async function x(){fe.info("Refreshing trial list...")}function C(B){const J=L.value;if(J.length!==0){if((B.metaKey||B.ctrlKey)&&B.key==="k"){B.preventDefault(),window.dispatchEvent(new CustomEvent("focus-trial-search"));return}(B.key==="j"||B.key==="ArrowDown")&&(B.preventDefault(),w.value=Math.min(w.value+1,J.length-1),w.value>=0&&(W(J[w.value].id),y(J[w.value].id))),(B.key==="k"||B.key==="ArrowUp")&&(B.preventDefault(),w.value=Math.max(w.value-1,0),W(J[w.value].id),y(J[w.value].id)),B.key==="Enter"&&h.value,B.key==="Escape"&&(_.value="",h.value=null,w.value=-1)}}function y(B){we(()=>{const J=document.querySelector(`[data-trial-id="${B}"]`);J&&J.scrollIntoView({behavior:"smooth",block:"nearest"})})}function v(B){V.debug("Trial list panel resized",{width:B})}function j(B){V.debug("Mobile overlay changed",{visible:B})}function G(){N.value=!0}async function K(){await d.push("/trials/create")}function Y(){z.value=!0}function ae(B){x(),W(B)}async function ce(){if(h.value&&!k.value){k.value=!0,e.execution?.value,e.execution?.value?.status;try{h.value;const B=await e.startTrialWithStreaming(h.value);if(!B.ok){fe.error(B.error?.message||"Unknown error");return}await u.startStreaming(h.value);const J={...c.query};J.tab="tasks",d.replace({query:J})}finally{k.value=!1}}}async function ge(){`${h.value}`,`${h.value}`,`${e.execution.value.status}`,`${e.isLeader.value}`;const B=await e.pauseExecution();B?.ok,B.ok?`${e.execution.value.status}`:(B.error.message,fe.error(B.error?.message||"Unknown error"))}async function Ye(){if(!h.value)return;`${h.value}`,`${h.value}`,`${e.execution.value.status}`,`${e.isLeader.value}`;const B=e.execution.value?.status||"idle",J=e.execution.value?.currentTrialId;if(B==="paused"&&J===h.value){`${h.value}`;const se=await e.resumeExecution(h.value);se.ok||(se.error.message,fe.error(se.error.message))}else{const se=await e.startTrialWithStreaming(h.value);se.ok?await u.startStreaming(h.value):(se.error.message,fe.error(se.error?.message||"Unknown error"))}}async function De(){const B=await e.cancelExecution();B.ok||fe.error(B.error?.message||"Unknown error")}async function us(B){const J=await o(B);J.ok?(fe.success("Trial duplicated"),J.value&&W(J.value)):fe.error(J.error?.message||"Unknown error")}async function ds(B){await d.push({path:"/trials/create",query:{duplicate:B,edit:"true"}})}async function cs(B){const J=await n(B);J.ok?(fe.success("Trial deleted"),h.value===B&&(h.value=null)):fe.error(J.error?.message||"Unknown error")}async function ps(B,J){const se=await ct.exportTrialData(B,{format:J,fields:void 0,includeHeaders:!0,addBOM:J==="excel"||J==="csv"});se.ok?(await We.downloadFile(se.value.data,J,se.value.metadata.trialName,J==="excel"||J==="csv"),fe.success(`Exported ${se.value.recordCount} API calls to ${se.value.filename}`)):fe.error(se.error?.message||"Unknown error")}const Ze=q(!1),_t=q("");function fs(B){_t.value=B,Ze.value=!0}return oe(()=>c.query.trialId,B=>{B&&B!==h.value&&W(B)}),oe(g,(B,J)=>{const se=performance.now();V.info(`V4_TRIAL_SWITCH: isLoadingInitial changed from ${J} to ${B} at ${se}`),B||V.info("V4_TRIAL_SWITCH: Both panes should now be VISIBLE (no longer loading initial)")},{immediate:!0}),oe(t,(B,J)=>{const se=performance.now();V.info(`V4_TRIAL_SWITCH: trials array changed from ${J?.length||0} to ${B.length} trials at ${se}`)},{immediate:!0}),me(async()=>{const B=performance.now();V.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() ENTRY at ${B}`);const J=performance.now();V.info(`V4_TRIAL_SWITCH: Starting V4 execution system initialization at ${(J-B).toFixed(1)}ms`);try{await e.initialize();const et=performance.now();V.info(`V4_TRIAL_SWITCH: V4 execution system initialized in ${(et-J).toFixed(1)}ms`)}catch(et){const hs=performance.now();V.error(`V4_TRIAL_SWITCH: V4 initialization failed in ${(hs-J).toFixed(1)}ms:`,et)}const se=performance.now();window.addEventListener("keydown",C),V.info(`V4_TRIAL_SWITCH: Keyboard listener added in ${(se-B).toFixed(1)}ms`);const Te=performance.now();V.info(`V4_TRIAL_SWITCH: Starting nextTick wait at ${(Te-B).toFixed(1)}ms`),await we();const be=performance.now();V.info(`V4_TRIAL_SWITCH: nextTick completed in ${(be-Te).toFixed(1)}ms`);const pe=performance.now();g.value=!1,V.info(`V4_TRIAL_SWITCH: isLoadingInitial set to false at ${(pe-B).toFixed(1)}ms`);const ke=performance.now();V.info(`V4_TRIAL_SWITCH: Starting URL parameter processing at ${(ke-B).toFixed(1)}ms`),await F();const ms=performance.now();V.info(`V4_TRIAL_SWITCH: URL parameter processing completed in ${(ms-ke).toFixed(1)}ms`);const Tt=performance.now();V.info(`V4_TRIAL_SWITCH: Starting auto-selection at ${(Tt-B).toFixed(1)}ms`),l();const vs=performance.now();V.info(`V4_TRIAL_SWITCH: Auto-selection completed in ${(vs-Tt).toFixed(1)}ms`);const gs=performance.now();V.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() TOTAL: ${(gs-B).toFixed(1)}ms`)}),ye(()=>{window.removeEventListener("keydown",C),u.destroy()}),(B,J)=>{const se=Nt("router-link"),Te=ve;return i(),p("div",Wp,[E.value?(i(),p("div",Hp,[s("div",qp,[I(H(Pe),{class:"warning-icon"}),J[3]||(J[3]=s("span",null,"No LLM providers configured. Please add API keys in Settings to run trials.",-1)),I(se,{to:"/settings",class:"settings-link"},{default:A(()=>J[2]||(J[2]=[D("Go to Settings")])),_:1,__:[2]}),I(H(Wt),{class:"close-icon",onClick:G})]),J[4]||(J[4]=s("div",{class:"banner-note"},"Note: Ollama doesn't require API keys",-1))])):P("",!0),H(S)?P("",!0):(i(),p("div",Gp,[s("div",Jp,[I(H(Xt),{class:"observer-icon"}),J[5]||(J[5]=s("span",null,[s("strong",null,"Observer Mode: Multiple Tabs Detected")],-1)),J[6]||(J[6]=s("div",{class:"leader-hint"}," You can only open one Auditomatic tab at a time. Close other tabs, or refresh if this is your only tab. Your templates and trials are safely saved. ",-1))])])),I(ba,{ref_key:"splitPanel",ref:f,"storage-key":"trial-list-width","default-width":250,"min-width":200,"max-width":600,onResize:v,onMobileOverlayChange:j},{left:A(()=>[g.value?(i(),p("div",Xp," Loading trials... ")):(i(),Q(Pn,{key:0,trials:H(t),"selected-trial-id":h.value,"search-query":_.value,"filter-status":R.value,onSelectTrial:W,onCreateTrial:K,onImportTrial:Y,onUpdateSearch:X,onUpdateFilter:T,onRefresh:x},null,8,["trials","selected-trial-id","search-query","filter-status"]))]),right:A(()=>[(i(),Q(ot,{max:5},[h.value?(i(),Q(pp,{key:h.value,trial:H($),"is-leader":H(S),"execution-state":H(U),progress:m.value,onStartTrial:ce,onPauseTrial:ge,onResumeTrial:Ye,onCancelTrial:De,onDuplicateTrial:us,onEditTrial:ds,onDeleteTrial:cs,onExportData:ps,onExportPython:fs},null,8,["trial","is-leader","execution-state","progress"])):P("",!0)],1024)),!h.value||!H($)?Ee((i(),p("div",Kp,[I(H(Yt),{class:"empty-icon"}),J[8]||(J[8]=s("h3",null,"Select a trial to view details",-1)),J[9]||(J[9]=s("p",null,"Choose from the list or create a new one",-1)),I(Te,{type:"primary",size:"large",disabled:!H(S),onClick:K},{default:A(()=>J[7]||(J[7]=[D(" Create New Trial ")])),_:1,__:[7]},8,["disabled"]),H(S)?P("",!0):(i(),p("div",Qp," Close other tabs to enable trial creation "))],512)),[[Ut,!g.value]]):P("",!0)]),_:1},512),I(Lp,{visible:z.value,"onUpdate:visible":J[0]||(J[0]=be=>z.value=be),onTrialImported:ae},null,8,["visible"]),I(jp,{visible:Ze.value,"onUpdate:visible":J[1]||(J[1]=be=>Ze.value=be),"trial-id":_t.value},null,8,["visible","trial-id"])])}}}),Zp=re(Yp,[["__scopeId","data-v-84d2df98"]]),gf=Object.freeze(Object.defineProperty({__proto__:null,default:Zp},Symbol.toStringTag,{value:"Module"}));export{de as E,gf as T,ct as d,Ot as g,Le as t};
