import{K as me,H as j,o as de,L as ce,k as ne,N as pe,U as ge,m as fe,R as ve,q as ye}from"./ui-vendor-DgwC-sRC.js";import{d as K,c as L,V as r,_ as s,W as y,k as _,a1 as B,a0 as v,G as C,a2 as $,F as q,Y as W,X as m,u as z,$ as O,a5 as Z,B as ie,f as Q,w as _e,l as ue,o as ze}from"./vue-vendor-BZxY9vkr.js";import{e as J,a as ke}from"./index-B80ctPmO.js";import{ollamaFetch as re,checkOllamaConnection as he,deleteOllamaModel as we,fetchOllamaModels as $e}from"./ollama-fetch-BXia8ZoL.js";const be={class:"search-section"},Ce={class:"search-controls"},Me={class:"size-filter"},Te={class:"size-controls"},Be={class:"size-presets"},Se={key:0,class:"size-filter-indicator"},xe={class:"quantized-filter"},Oe={class:"filter-description"},Ge={class:"category-filters"},Ie=K({__name:"OllamaSearchFilters",props:{searchQuery:{},sortBy:{},selectedCategories:{},maxSizeGB:{},showQuantized:{type:Boolean},categories:{}},emits:["update:searchQuery","update:sortBy","update:maxSizeGB","update:showQuantized","toggle-category"],setup(V,{emit:l}){const S=V,x=l,h=L({get:()=>S.searchQuery,set:d=>x("update:searchQuery",d)}),M=L({get:()=>S.sortBy,set:d=>x("update:sortBy",d)}),T=L({get:()=>S.maxSizeGB,set:d=>x("update:maxSizeGB",d)}),P=L({get:()=>S.showQuantized,set:d=>x("update:showQuantized",d)}),p=[{label:"1GB",value:1},{label:"2GB",value:2},{label:"4GB",value:4},{label:"8GB",value:8},{label:"16GB",value:16},{label:"None",value:999}];return(d,f)=>{const D=B("a-input-search"),U=B("a-select-option"),i=B("a-select"),n=B("a-input-number"),a=B("a-button"),G=B("a-tag");return s(),r("div",be,[y("div",Ce,[_(D,{value:h.value,"onUpdate:value":f[0]||(f[0]=t=>h.value=t),placeholder:"Search models by name or description...","allow-clear":"",size:"large",class:"search-input"},null,8,["value"]),_(i,{value:M.value,"onUpdate:value":f[1]||(f[1]=t=>M.value=t),placeholder:"Sort by",style:{width:"180px"},size:"large"},{default:v(()=>[_(U,{value:"popularity"},{default:v(()=>f[4]||(f[4]=[C("Popularity")])),_:1,__:[4]}),_(U,{value:"lastUpdated"},{default:v(()=>f[5]||(f[5]=[C("Last Updated")])),_:1,__:[5]}),_(U,{value:"name"},{default:v(()=>f[6]||(f[6]=[C("Name")])),_:1,__:[6]}),_(U,{value:"tagCount"},{default:v(()=>f[7]||(f[7]=[C("Tag Count")])),_:1,__:[7]})]),_:1},8,["value"])]),y("div",Me,[y("div",Te,[f[8]||(f[8]=y("span",{class:"filter-label"},"Filter to models smaller than:",-1)),_(n,{value:T.value,"onUpdate:value":f[2]||(f[2]=t=>T.value=t),min:1,max:999,step:1,size:"small",class:"size-input","addon-after":"GB"},null,8,["value"]),y("div",Be,[(s(),r(q,null,W(p,t=>_(a,{key:t.value,size:"small",type:T.value===t.value?"primary":"default",onClick:e=>T.value=t.value,class:"preset-button"},{default:v(()=>[C(m(t.label),1)]),_:2},1032,["type","onClick"])),64))])]),T.value<999?(s(),r("span",Se," â‰¤"+m(T.value)+"GB filter active ",1)):$("",!0)]),y("div",xe,[_(a,{type:P.value?"default":"primary",size:"small",onClick:f[3]||(f[3]=t=>P.value=!P.value)},{icon:v(()=>[_(z(me))]),default:v(()=>[C(" "+m(P.value?"Hide":"Show")+" Quantized Versions ",1)]),_:1},8,["type"]),y("span",Oe,m(P.value?"Showing all versions":"Hiding q2_K, q3_K, q4_0, q5_1, q6_K, q8_0, fp16..."),1)]),y("div",Ge,[(s(!0),r(q,null,W(d.categories,t=>(s(),O(G,{key:t,color:d.selectedCategories.includes(t)?"blue":"default",checkable:!0,checked:d.selectedCategories.includes(t),onClick:e=>d.$emit("toggle-category",t),class:"category-tag"},{default:v(()=>[C(m(t),1)]),_:2},1032,["color","checked","onClick"]))),128))])])}}}),Pe=J(Ie,[["__scopeId","data-v-a03d8794"]]),Fe={key:0,class:"downloads-section"},Le={class:"download-items"},Qe={class:"download-info"},qe={class:"download-tag"},De={class:"download-status"},Ue=K({__name:"OllamaDownloadProgress",props:{pullProgress:{}},setup(V){return(l,S)=>{const x=B("a-progress");return Object.keys(l.pullProgress).length>0?(s(),r("div",Fe,[S[0]||(S[0]=y("h4",null,"Active Downloads",-1)),y("div",Le,[(s(!0),r(q,null,W(l.pullProgress,(h,M)=>(s(),r("div",{key:M,class:"download-item"},[y("div",Qe,[y("code",qe,m(M),1),y("span",De,m(h.message),1)]),_(x,{percent:h.percent,status:h.status==="success"?"success":"active",size:"small",class:"download-progress"},null,8,["percent","status"])]))),128))])])):$("",!0)}}}),Ve=J(Ue,[["__scopeId","data-v-88ba3f68"]]),Ee={class:"model-info"},He={class:"model-name"},Re={key:0},je={class:"model-description"},Ne={class:"model-actions"},Ae={key:0,class:"button-size-info"},We={key:0,class:"tags-preview"},Ke={class:"preview-tags"},Je=["onClick","title"],Xe={key:1,class:"tag-actual"},Ye={class:"tag-size"},Ze={key:0,class:"more-tags"},et={key:1,class:"tags-expanded"},tt={key:0,class:"tag-name"},st={key:2},at={key:1,class:"text-secondary"},lt=K({__name:"OllamaModelCard",props:{model:{},expanded:{type:Boolean},pullingModels:{},pullProgress:{},installedModels:{},maxSizeGB:{},showQuantized:{type:Boolean},isQuantizedTag:{type:Function},parseSizeToGB:{type:Function},getSizeClass:{type:Function},getLatestTagInfo:{type:Function}},emits:["toggle-expand","pull-model"],setup(V){const l=V,S=[{title:"Tag",key:"name",width:200},{title:"Size",key:"size",width:100,align:"right"},{title:"Context",key:"context",width:100,align:"center"},{title:"Status",key:"status",width:80,align:"center"},{title:"Action",key:"actions",width:80,align:"center"}],x=L(()=>l.installedModels.some(t=>t.startsWith(l.model.name))),h=L(()=>l.installedModels.filter(t=>t.startsWith(l.model.name+":")).length),M=L(()=>i(`${l.model.name}:latest`)||i(l.model.name)),T=L(()=>l.pullingModels.has(`${l.model.name}:latest`)),P=L(()=>l.pullProgress[`${l.model.name}:latest`]),p=L(()=>l.getLatestTagInfo(l.model)),d=L(()=>l.maxSizeGB<999||!l.showQuantized),f=L(()=>l.model.tags?Object.entries(l.model.tags).map(([t,e])=>({...e,name:t})).filter(t=>!(l.maxSizeGB<999&&l.parseSizeToGB(t.size||"0GB")>l.maxSizeGB||!l.showQuantized&&l.isQuantizedTag(t.name))).sort((t,e)=>t.name.localeCompare(e.name)):[]),D=L(()=>f.value.length),U=L(()=>f.value.sort((e,u)=>{const w=["latest","instruct","8b","7b","3b","1b"],k=w.indexOf(e.name),o=w.indexOf(u.name);return k!==-1&&o!==-1?k-o:k!==-1?-1:o!==-1?1:e.name.localeCompare(u.name)}).slice(0,5));function i(t){return l.installedModels.includes(t)}function n(t){return l.pullingModels.has(t)}function a(t){return l.pullProgress[t]}const G=L(()=>{const t=p.value;return t?{actualTag:t.actualTag||"",size:t.size||""}:null});return(t,e)=>{const u=B("a-tag"),w=B("a-button"),k=B("a-table");return s(),r("div",{class:Z(["model-item",{expanded:t.expanded}])},[y("div",{class:"model-header",onClick:e[2]||(e[2]=o=>t.$emit("toggle-expand"))},[y("div",Ee,[y("div",He,[y("h4",null,m(t.model.name),1),_(u,{size:"small",color:"blue"},{default:v(()=>[C(m(t.model.pullCount||"0")+" pulls",1)]),_:1}),_(u,{size:"small",color:"green"},{default:v(()=>[C(m(D.value)+" ",1),d.value?(s(),r("span",Re,"/"+m(t.model.tagCount||0),1)):$("",!0),e[3]||(e[3]=C(" versions "))]),_:1,__:[3]}),x.value?(s(),O(u,{key:0,size:"small",color:"success",class:"installed-tag"},{icon:v(()=>[_(z(j))]),default:v(()=>[C(" "+m(h.value)+" installed ",1)]),_:1})):$("",!0)]),y("p",je,m(t.model.description||"No description available"),1)]),y("div",Ne,[_(w,{type:M.value?"default":"primary",size:"small",onClick:e[0]||(e[0]=ie(o=>t.$emit("pull-model",t.model.name,"latest"),["stop"])),loading:T.value,disabled:M.value},{default:v(()=>[P.value?(s(),r(q,{key:0},[C(m(Math.round(P.value.percent))+"% ",1)],64)):M.value?(s(),r(q,{key:1},[_(z(j)),e[4]||(e[4]=C(" Installed "))],64)):(s(),r(q,{key:2},[e[5]||(e[5]=C(" Pull Latest ")),G.value?(s(),r("span",Ae," ("+m(G.value.actualTag?G.value.actualTag+", ":"")+m(G.value.size)+") ",1)):$("",!0)],64))]),_:1},8,["type","loading","disabled"]),_(w,{type:"text",size:"small",onClick:e[1]||(e[1]=ie(o=>t.$emit("toggle-expand"),["stop"]))},{icon:v(()=>[t.expanded?(s(),O(z(ce),{key:1})):(s(),O(z(de),{key:0}))]),default:v(()=>[C(" "+m(t.expanded?"Hide versions":"See all versions"),1)]),_:1})])]),t.expanded?$("",!0):(s(),r("div",We,[y("div",Ke,[(s(!0),r(q,null,W(U.value,o=>(s(),r("span",{key:o.name,class:Z(["tag-chip",[t.getSizeClass(o.size),{installed:i(o.fullTag)}]]),onClick:b=>i(o.fullTag)?null:t.$emit("pull-model",t.model.name,o.name),title:`${o.fullTag} - ${o.size}${i(o.fullTag)?" (Installed)":""}`},[i(o.fullTag)?(s(),O(z(j),{key:0,class:"installed-icon"})):$("",!0),C(" "+m(o.name)+" ",1),o.name==="latest"&&G.value?(s(),r("span",Xe," ("+m(G.value.actualTag)+") ",1)):$("",!0),y("span",Ye,m(o.size),1)],10,Je))),128)),D.value>5?(s(),r("span",Ze," +"+m(D.value-5)+" more versions ",1)):$("",!0)])])),t.expanded?(s(),r("div",et,[_(k,{columns:S,"data-source":f.value,pagination:!1,size:"small",scroll:{y:300},class:"tags-table"},{bodyCell:v(({column:o,record:b})=>[o.key==="name"?(s(),r("code",tt,m(b.name),1)):$("",!0),o.key==="size"?(s(),r("span",{key:1,class:Z(["tag-size",t.getSizeClass(b.size)])},m(b.size),3)):$("",!0),o.key==="context"?(s(),r("span",st,m(b.contextWindow),1)):$("",!0),o.key==="status"?(s(),r(q,{key:3},[i(b.fullTag)?(s(),O(u,{key:0,size:"small",color:"success"},{default:v(()=>[_(z(j)),e[6]||(e[6]=C(" Installed "))]),_:1,__:[6]})):(s(),r("span",at,"-"))],64)):$("",!0),o.key==="actions"?(s(),O(w,{key:4,type:i(b.fullTag)?"default":"primary",size:"small",onClick:E=>t.$emit("pull-model",t.model.name,b.name),loading:n(b.fullTag),disabled:i(b.fullTag)},{default:v(()=>[a(b.fullTag)?(s(),r(q,{key:0},[C(m(Math.round(a(b.fullTag).percent))+"% ",1)],64)):i(b.fullTag)?(s(),r(q,{key:1},[_(z(j)),e[7]||(e[7]=C(" Installed "))],64)):(s(),r(q,{key:2},[C(" Pull ")],64))]),_:2},1032,["type","onClick","loading","disabled"])):$("",!0)]),_:1},8,["data-source"])])):$("",!0)],2)}}}),nt=J(lt,[["__scopeId","data-v-83727817"]]),ot={class:"list-view"},it={class:"expanded-tags-container"},ut={class:"expanded-tags-grid"},rt={class:"tag-name"},dt={key:0,class:"tag-actual"},ct={class:"tag-size"},mt={class:"tag-context"},pt={key:0,class:"model-name-cell"},gt={key:1,class:"description-cell"},ft={key:2,class:"stats-cell"},vt={class:"stat-item"},yt={class:"stat-item"},_t={key:0},zt={key:3,class:"size-range"},kt=K({__name:"OllamaModelList",props:{models:{},expandedModels:{},pullingModels:{},pullProgress:{},installedModels:{},maxSizeGB:{},showQuantized:{type:Boolean},isQuantizedTag:{type:Function},parseSizeToGB:{type:Function},getSizeClass:{type:Function},getLatestTagInfo:{type:Function},getModelSizeRange:{type:Function}},emits:["toggle-model","pull-model","expand"],setup(V){const l=V,S=[{title:"Model",key:"name",width:200,fixed:"left"},{title:"Description",key:"description",ellipsis:!0},{title:"Stats",key:"stats",width:200},{title:"Size Range",key:"sizeRange",width:120,align:"center"},{title:"Actions",key:"actions",width:220,align:"center",fixed:"right"}];function x(p){return p.tags?Object.entries(p.tags).map(([d,f])=>({...f,name:d})).filter(d=>!(l.maxSizeGB<999&&l.parseSizeToGB(d.size||"0GB")>l.maxSizeGB||!l.showQuantized&&l.isQuantizedTag(d.name))).sort((d,f)=>d.name.localeCompare(f.name)):[]}function h(p){return p.tags?Object.entries(p.tags).filter(([d,f])=>!(l.maxSizeGB<999&&l.parseSizeToGB(f.size||"0GB")>l.maxSizeGB||!l.showQuantized&&l.isQuantizedTag(d))).length:0}function M(p){return l.installedModels.some(d=>d.startsWith(p))}function T(p){return l.installedModels.includes(p)}function P(p){return l.installedModels.filter(d=>d.startsWith(p+":"))}return(p,d)=>{const f=B("a-tag"),D=B("a-button"),U=B("a-space"),i=B("a-table");return s(),r("div",ot,[_(i,{"data-source":p.models,columns:S,pagination:!1,"row-key":n=>n.name,size:"small",scroll:{y:"calc(100% - 48px)"},"expanded-row-keys":p.expandedModels,"expand-row-by-click":!1,onExpand:d[0]||(d[0]=(n,a)=>p.$emit("expand",n,a)),class:"models-list-table"},{expandedRowRender:v(({record:n})=>[y("div",it,[y("div",ut,[(s(!0),r(q,null,W(x(n),a=>{var G;return s(),r("div",{key:a.fullTag,class:Z(["expanded-tag-item",p.getSizeClass(a.size)])},[y("span",rt,m(a.name),1),a.name==="latest"&&p.getLatestTagInfo(n)?(s(),r("span",dt," ("+m((G=p.getLatestTagInfo(n))==null?void 0:G.actualTag)+") ",1)):$("",!0),y("span",ct,m(a.size),1),y("span",mt,m(a.contextWindow||"-"),1),T(a.fullTag)?(s(),O(f,{key:1,size:"small",color:"success"},{default:v(()=>[_(z(j)),d[1]||(d[1]=C(" Installed "))]),_:1,__:[1]})):(s(),O(D,{key:2,type:"primary",size:"small",loading:p.pullingModels.has(a.fullTag),onClick:t=>p.$emit("pull-model",n.name,a.name)},{default:v(()=>[p.pullProgress[a.fullTag]?(s(),r(q,{key:0},[C(m(Math.round(p.pullProgress[a.fullTag].percent))+"% ",1)],64)):(s(),r(q,{key:1},[C(" Pull ")],64))]),_:2},1032,["loading","onClick"]))],2)}),128))])])]),bodyCell:v(({column:n,record:a})=>[n.key==="name"?(s(),r("div",pt,[y("code",null,m(a.name),1),M(a.name)?(s(),O(f,{key:0,size:"small",color:"success"},{default:v(()=>[_(z(j)),C(" "+m(P(a.name).length)+" installed ",1)]),_:2},1024)):$("",!0)])):$("",!0),n.key==="description"?(s(),r("span",gt,m(a.description||"No description"),1)):$("",!0),n.key==="stats"?(s(),r("div",ft,[y("span",vt,m(a.pullCount||"0")+" pulls",1),d[3]||(d[3]=y("span",{class:"stat-divider"},"â€¢",-1)),y("span",yt,[C(m(h(a))+" ",1),p.maxSizeGB<999||!p.showQuantized?(s(),r("span",_t,"/"+m(a.tagCount||0),1)):$("",!0),d[2]||(d[2]=C(" versions "))])])):$("",!0),n.key==="sizeRange"?(s(),r("span",zt,m(p.getModelSizeRange(a)),1)):$("",!0),n.key==="actions"?(s(),O(U,{key:4,size:"small"},{default:v(()=>[_(D,{type:"text",size:"small",onClick:G=>p.$emit("toggle-model",a.name)},{icon:v(()=>[p.expandedModels.includes(a.name)?(s(),O(z(ce),{key:1})):(s(),O(z(de),{key:0}))]),default:v(()=>[C(" "+m(p.expandedModels.includes(a.name)?"Hide":"See")+" Versions ",1)]),_:2},1032,["onClick"]),_(D,{type:T(`${a.name}:latest`)||T(a.name)?"default":"primary",size:"small",onClick:G=>p.$emit("pull-model",a.name,"latest"),loading:p.pullingModels.has(`${a.name}:latest`),disabled:T(`${a.name}:latest`)||T(a.name)},{default:v(()=>[p.pullProgress[`${a.name}:latest`]?(s(),r(q,{key:0},[C(m(Math.round(p.pullProgress[`${a.name}:latest`].percent))+"% ",1)],64)):T(`${a.name}:latest`)||T(a.name)?(s(),O(z(j),{key:1})):(s(),r(q,{key:2},[C(" Pull Latest ")],64))]),_:2},1032,["type","onClick","loading","disabled"])]),_:2},1024)):$("",!0)]),_:1},8,["data-source","row-key","expanded-row-keys"])])}}}),ht=J(kt,[["__scopeId","data-v-7d1c26f3"]]);function wt(){const V=Q(null),l=Q(!1),S=Q(""),x=Q(new Set),h=Q({}),M=Q([]);async function T(){l.value=!0,S.value="";try{const e=await fetch("https://ollama.models.auditomatic.org/models.json");if(!e.ok)throw new Error(`Failed to fetch models: ${e.statusText}`);V.value=await e.json(),await P()}catch(e){S.value=`Failed to load model library: ${e instanceof Error?e.message:"Unknown error"}`}finally{l.value=!1}}async function P(){try{const e=await re("/api/tags");if(e.ok){const u=await e.json();M.value=(u.models||[]).map(w=>w.name)}}catch(e){const u=e;u.type==="cors"&&u.isHttps&&ke.debug("Cannot access Ollama from HTTPS site"),M.value=[]}}async function p(e,u,w){var o;const k=u==="latest"?e:`${e}:${u}`;if(!x.value.has(k)){x.value.add(k),h.value[k]={percent:0,status:"active",message:"Starting download..."};try{const b=await re("/api/pull",{method:"POST",body:JSON.stringify({name:k,stream:!0})});if(!b.ok)throw new Error(`Failed to pull model: ${b.statusText}`);const E=(o=b.body)==null?void 0:o.getReader();if(!E)throw new Error("Unable to read response stream");let H=0,Y=0;for(;;){const{done:X,value:ee}=await E.read();if(X)break;const se=new TextDecoder().decode(ee).split(`
`).filter(N=>N.trim());for(const N of se)try{const g=JSON.parse(N);g.total&&(H=g.total),g.completed&&(Y=g.completed);const c=H>0?Math.round(Y/H*100):0;if(h.value[k]={status:g.status==="success"?"success":"active",percent:c,message:g.status||"Downloading..."},g.status==="success"){ne.success(`Successfully pulled ${k}`),await P(),w==null||w(),setTimeout(()=>{delete h.value[k]},3e3);return}}catch{}}}catch(b){const E=b;let H=b instanceof Error?b.message:"Unknown error";E.type==="cors"&&E.isHttps&&(H="Cannot access Ollama from HTTPS site. Please use the desktop app or run locally."),ne.error(`Failed to pull ${k}: ${H}`),h.value[k]={status:"exception",percent:0,message:"Download failed"},setTimeout(()=>{delete h.value[k]},5e3)}finally{x.value.delete(k)}}}function d(e){const u=parseFloat(e.replace(/[^\d.]/g,""))||0,w=e.replace(/[\d.]/g,"").trim().toUpperCase();return w.includes("MB")?u/1e3:w.includes("TB")?u*1e3:(w.includes("GB"),u)}function f(e){return/-q\d{1,2}_|-fp\d+/.test(e)}function D(e){return M.value.some(u=>u.startsWith(e))}function U(e){return M.value.includes(e)}function i(e){return M.value.filter(u=>u.startsWith(e+":"))}function n(e){return e<1?`${Math.round(e*1e3)}MB`:`${e.toFixed(1)}GB`}function a(e){const u=d(e);return u<5?"size-small":u<20?"size-medium":"size-large"}function G(e){if(!e.tags)return"N/A";const u=Object.values(e.tags).map(o=>d(o.size||"0GB")).filter(o=>o>0);if(u.length===0)return"N/A";const w=Math.min(...u),k=Math.max(...u);return w===k?n(w):`${n(w)} - ${n(k)}`}function t(e){if(!e.tags||!e.tags.latest)return null;const u=e.tags.latest,w=Object.entries(e.tags).find(([k,o])=>k!=="latest"&&o.modelHash===u.modelHash);return w?{actualTag:w[0],size:w[1].size||u.size}:{actualTag:"",size:u.size}}return{modelsData:V,loading:l,error:S,pullingModels:x,pullProgress:h,installedModels:M,fetchModels:T,fetchInstalledModels:P,pullModel:p,parseSizeToGB:d,isQuantizedTag:f,isModelInstalled:D,isTagInstalled:U,getInstalledTagsForModel:i,formatSizeGB:n,getSizeClass:a,getModelSizeRange:G,getLatestTagInfo:t}}const $t={class:"modal-content"},bt={class:"stats-bar"},Ct={class:"view-controls"},Mt={key:0,class:"loading-text"},Tt={class:"models-container"},Bt=K({__name:"OllamaModelLibraryModalV3",props:{modelValue:{type:Boolean}},emits:["update:modelValue","models-updated"],setup(V,{emit:l}){const S=V,x=l,{modelsData:h,loading:M,error:T,pullingModels:P,pullProgress:p,installedModels:d,fetchModels:f,pullModel:D,parseSizeToGB:U,isQuantizedTag:i,getSizeClass:n,getModelSizeRange:a,getLatestTagInfo:G}=wt(),t=Q(""),e=Q("popularity"),u=Q([]),w=Q(8),k=Q(!1),o=Q("card"),b=Q(new Set),E=L({get:()=>S.modelValue,set:g=>x("update:modelValue",g)}),H=L(()=>{var g;return((g=h.value)==null?void 0:g.totalModels)||0}),Y=L(()=>{var g;return((g=h.value)==null?void 0:g.categories)||[]}),X=L(()=>{if(!h.value)return[];let g=Object.entries(h.value.models).map(([c,I])=>({...I,name:c}));if(t.value){const c=t.value.toLowerCase();g=g.filter(I=>I.name.toLowerCase().includes(c)||I.description.toLowerCase().includes(c))}switch(u.value.length>0&&(g=g.filter(c=>u.value.some(I=>(c.categories||[]).includes(I)))),w.value<999&&(g=g.filter(c=>c.tags?Object.values(c.tags).some(I=>U(I.size||"0GB")<=w.value):!0)),e.value){case"popularity":g.sort((c,I)=>{const R=c.pullCount||"0",A=I.pullCount||"0",ae=parseFloat(R.replace(/[^\d.]/g,""))||0,le=parseFloat(A.replace(/[^\d.]/g,""))||0,F=R.includes("M")?1e6:R.includes("K")?1e3:1,oe=A.includes("M")?1e6:A.includes("K")?1e3:1;return le*oe-ae*F});break;case"lastUpdated":g.sort((c,I)=>{const R=c.lastUpdated?new Date(c.lastUpdated).getTime():0;return(I.lastUpdated?new Date(I.lastUpdated).getTime():0)-R});break;case"name":g.sort((c,I)=>c.name.localeCompare(I.name));break;case"tagCount":g.sort((c,I)=>(I.tagCount||0)-(c.tagCount||0));break}return g});function ee(g){const c=u.value.indexOf(g);c===-1?u.value.push(g):u.value.splice(c,1)}function te(g){b.value.has(g)?b.value.delete(g):b.value.add(g)}function se(g,c){g?b.value.add(c.name):b.value.delete(c.name)}async function N(g,c){await D(g,c,()=>x("models-updated"))}return _e(E,g=>{g&&!h.value&&f(),g||(b.value.clear(),t.value="",u.value=[],w.value=8,k.value=!1,T.value="")}),(g,c)=>{const I=B("a-button"),R=B("a-button-group"),A=B("a-spin"),ae=B("a-alert"),le=B("a-modal");return s(),O(le,{open:E.value,"onUpdate:open":c[7]||(c[7]=F=>E.value=F),title:"Ollama Model Library",width:"95vw",footer:null,destroyOnClose:!0,"wrap-class-name":"ollama-library-modal-full",class:"ollama-library-modal"},{default:v(()=>[y("div",$t,[_(Pe,{"search-query":t.value,"onUpdate:searchQuery":c[0]||(c[0]=F=>t.value=F),"sort-by":e.value,"onUpdate:sortBy":c[1]||(c[1]=F=>e.value=F),"max-size-g-b":w.value,"onUpdate:maxSizeGB":c[2]||(c[2]=F=>w.value=F),"show-quantized":k.value,"onUpdate:showQuantized":c[3]||(c[3]=F=>k.value=F),"selected-categories":u.value,categories:Y.value,onToggleCategory:ee},null,8,["search-query","sort-by","max-size-g-b","show-quantized","selected-categories","categories"]),y("div",bt,[y("span",null,"Showing "+m(X.value.length)+" of "+m(H.value)+" models",1),y("div",Ct,[_(R,{size:"small"},{default:v(()=>[_(I,{type:o.value==="card"?"primary":"default",onClick:c[4]||(c[4]=F=>o.value="card"),icon:ue(z(pe)),title:"Card View"},null,8,["type","icon"]),_(I,{type:o.value==="list"?"primary":"default",onClick:c[5]||(c[5]=F=>o.value="list"),icon:ue(z(ge)),title:"List View"},null,8,["type","icon"])]),_:1}),z(M)?(s(),r("span",Mt,"Loading...")):$("",!0)])]),_(Ve,{"pull-progress":z(p)},null,8,["pull-progress"]),y("div",Tt,[_(A,{spinning:z(M),size:"large"},{default:v(()=>[o.value==="card"?(s(!0),r(q,{key:0},W(X.value,F=>(s(),O(nt,{key:F.name,model:F,expanded:b.value.has(F.name),"pulling-models":z(P),"pull-progress":z(p),"installed-models":z(d),"max-size-g-b":w.value,"show-quantized":k.value,"is-quantized-tag":z(i),"parse-size-to-g-b":z(U),"get-size-class":z(n),"get-latest-tag-info":z(G),onToggleExpand:oe=>te(F.name),onPullModel:N},null,8,["model","expanded","pulling-models","pull-progress","installed-models","max-size-g-b","show-quantized","is-quantized-tag","parse-size-to-g-b","get-size-class","get-latest-tag-info","onToggleExpand"]))),128)):$("",!0),o.value==="list"?(s(),O(ht,{key:1,models:X.value,"expanded-models":Array.from(b.value),"pulling-models":z(P),"pull-progress":z(p),"installed-models":z(d),"max-size-g-b":w.value,"show-quantized":k.value,"is-quantized-tag":z(i),"parse-size-to-g-b":z(U),"get-size-class":z(n),"get-latest-tag-info":z(G),"get-model-size-range":z(a),onToggleModel:te,onPullModel:N,onExpand:se},null,8,["models","expanded-models","pulling-models","pull-progress","installed-models","max-size-g-b","show-quantized","is-quantized-tag","parse-size-to-g-b","get-size-class","get-latest-tag-info","get-model-size-range"])):$("",!0)]),_:1},8,["spinning"])]),z(T)?(s(),O(ae,{key:0,type:"error",message:z(T),closable:"",onClose:c[6]||(c[6]=F=>T.value=""),class:"error-alert"},null,8,["message"])):$("",!0)])]),_:1},8,["open"])}}}),St=J(Bt,[["__scopeId","data-v-96287dbe"]]),xt={class:"ollama-model-manager"},Ot={class:"action-bar"},Gt={class:"models-section"},It={key:0,class:"model-name"},Pt={key:1,class:"model-size"},Ft={key:2,class:"model-date"},Lt=K({__name:"OllamaModelManagerV3",setup(V){const l=Q([]),S=Q(!1),x=Q(new Set),h=Q(""),M=Q(!1),T=[{title:"Model Name",key:"name",width:"40%"},{title:"Size",key:"size",width:"20%",align:"right"},{title:"Modified",key:"modified",width:"25%"},{title:"Actions",key:"actions",width:"15%",align:"center"}];async function P(){const i=await he();return!i.available&&i.error&&(i.error.type==="cors"&&i.error.isHttps?h.value=i.error.details||"Cannot connect to Ollama from HTTPS site":h.value=i.error.message),i.available}async function p(){try{const i=await $e();l.value=i.models||[]}catch(i){const n=i;n.type==="cors"&&n.isHttps?h.value=n.details||"Cannot access Ollama from HTTPS site":h.value=`Failed to fetch models: ${i instanceof Error?i.message:"Unknown error"}`,l.value=[]}}async function d(i){x.value.add(i),h.value="";try{await we(i),ne.success(`Successfully removed ${i}`),await f()}catch(n){const a=n;a.type==="cors"&&a.isHttps?h.value=a.details||"Cannot access Ollama from HTTPS site":h.value=`Failed to remove model: ${n instanceof Error?n.message:"Unknown error"}`}finally{x.value.delete(i)}}async function f(){S.value=!0,await p(),S.value=!1}function D(i){if(!i)return"0 B";const n=["B","KB","MB","GB","TB"],a=Math.floor(Math.log(i)/Math.log(1024));return`${(i/Math.pow(1024,a)).toFixed(1)} ${n[a]}`}function U(i){try{return new Date(i).toLocaleDateString()}catch{return"Unknown"}}return ze(async()=>{await P()?await f():h.value="Cannot connect to Ollama. Make sure Ollama is running on localhost:11434"}),(i,n)=>{const a=B("a-button"),G=B("a-tag"),t=B("a-popconfirm"),e=B("a-table"),u=B("a-empty"),w=B("a-alert");return s(),r("div",xt,[y("div",Ot,[_(a,{type:"primary",onClick:n[0]||(n[0]=k=>M.value=!0)},{icon:v(()=>[_(z(fe))]),default:v(()=>[n[3]||(n[3]=C(" Download Ollama Models "))]),_:1,__:[3]}),_(a,{onClick:f,loading:S.value},{icon:v(()=>[_(z(ve))]),default:v(()=>[n[4]||(n[4]=C(" Refresh "))]),_:1,__:[4]},8,["loading"])]),y("div",Gt,[n[7]||(n[7]=y("h4",{class:"section-title"},"Installed Models",-1)),_(e,{columns:T,"data-source":l.value,pagination:!1,size:"small",loading:S.value,"row-key":"name",class:"models-table"},{bodyCell:v(({column:k,record:o})=>{var b;return[k.key==="name"?(s(),r("div",It,[y("code",null,m(o.name),1),(b=o.details)!=null&&b.family?(s(),O(G,{key:0,size:"small",color:"blue"},{default:v(()=>[C(m(o.details.family),1)]),_:2},1024)):$("",!0)])):$("",!0),k.key==="size"?(s(),r("span",Pt,m(D(o.size)),1)):$("",!0),k.key==="modified"?(s(),r("span",Ft,m(U(o.modified_at)),1)):$("",!0),k.key==="actions"?(s(),O(t,{key:3,title:"Are you sure you want to delete this model?",description:`This will permanently remove ${o.name} from your system.`,"ok-text":"Delete","cancel-text":"Cancel",onConfirm:E=>d(o.name)},{default:v(()=>[_(a,{type:"text",danger:"",size:"small",loading:x.value.has(o.name)},{icon:v(()=>[_(z(ye))]),default:v(()=>[n[5]||(n[5]=C(" Remove "))]),_:2,__:[5]},1032,["loading"])]),_:2},1032,["description","onConfirm"])):$("",!0)]}),_:1},8,["data-source","loading"]),!S.value&&l.value.length===0?(s(),O(u,{key:0,description:"No Ollama models installed",class:"empty-state"},{image:v(()=>n[6]||(n[6]=[y("div",{class:"empty-icon"},"ðŸ“¦",-1)])),_:1})):$("",!0)]),h.value?(s(),O(w,{key:0,type:"error",message:h.value,closable:"",onClose:n[1]||(n[1]=k=>h.value=""),class:"error-alert"},null,8,["message"])):$("",!0),_(St,{modelValue:M.value,"onUpdate:modelValue":n[2]||(n[2]=k=>M.value=k),onModelsUpdated:f},null,8,["modelValue"])])}}}),Vt=J(Lt,[["__scopeId","data-v-9a88ecb1"]]);export{Vt as O};
