import{d as ce,c as O,a1 as fe,f as g,o as me,R as p,k as s,Z as l,X as _e,Y as i,S as o,G as r,u as P,V as c,_ as f,$ as G,F as ge,W as ye}from"./vue-vendor-Cg89ltm_.js";import{u as xe}from"./parser.store-z9tRIkeb.js";import{b as M,h as he}from"./index-DWqlQ4IC.js";import{o as Ce,k as m,L as be,m as Te,p as ke,q as Pe,r as je,s as we,t as Fe,I as Ne,u as Se,v as Ee,w as ze,x as Re,y as We,z as Ue,G as Ie,P as Oe,H as K,T as Ge,J as Me,K as Ve}from"./ui-vendor-COTxn_WH.js";import"./utils-vendor-BXgHPvEJ.js";import"./data-vendor-lJS7wsn4.js";const Be={class:"parser-editor-page"},De={class:"header-content"},$e={class:"page-title"},Ae={class:"editor-container"},Je={key:0,class:"loading-container"},Le={key:1,class:"editor-form"},qe={class:"form-section"},He={class:"form-row"},Ye={class:"form-row"},Ke={class:"form-section"},Xe={key:0},Ze={class:"form-row"},Qe={key:1},et={key:2},tt={class:"form-row"},at={class:"form-section"},st={class:"section-header"},lt={class:"test-actions"},ot={class:"test-input-section"},nt={key:0,class:"test-result"},rt={key:0},ut={key:1},it={key:2},dt={key:3},pt={key:1,class:"test-cases-section"},vt={class:"test-cases-list"},ct={class:"test-case-header"},ft={class:"test-case-name"},mt={class:"test-case-content"},_t={class:"test-case-field"},gt={class:"field-value"},yt={class:"test-case-field"},xt={class:"field-value"},ht={key:0,class:"test-case-field"},Ct={class:"field-value"},bt={class:"test-case-actions"},Tt={class:"form-section"},kt={class:"footer-content"},Pt={class:"footer-stats"},jt={key:0},wt={key:1},Ft={key:2},Nt={class:"footer-actions"},St=ce({__name:"ParserEditorView",setup(Et){const X=fe(),N=_e(),k=xe(),y=O(()=>X.params.id),S=g(!1),E=g(!1),z=g(!1),h=g(null),C=g(""),u=g(null),b=g(!1),_=g(""),t=g({name:"",description:"",type:"regex",outputType:"text",tags:[],regexPattern:"",regexFlags:"",regexCaptureGroup:1,javascriptCode:"",javascriptTimeout:1e4,pythonCode:"",pythonFunctionName:"extract_data",pythonTimeout:1e4,refusalWords:[],rejectRefusalWords:!1,testCases:[]}),V=O({get:()=>t.value.regexFlags.split("").filter(a=>a),set:a=>{t.value.regexFlags=a.join("")}});async function Z(){if(!y.value){B(t.value.type);return}S.value=!0;try{k.parsers.length===0&&await k.loadParsers();const a=k.parsers.find(e=>e.id===y.value);if(!a){m.error("Parser not found"),N.push("/parsers");return}if(t.value.name=a.name,t.value.description=a.description||"",t.value.type=a.type,t.value.outputType=a.outputType,t.value.tags=a.tags||[],t.value.refusalWords=a.refusalWords||[],t.value.rejectRefusalWords=a.rejectRefusalWords||!1,t.value.testCases=a.testCases||[],a.type==="regex"){const e=a.config;t.value.regexPattern=e.pattern||"",t.value.regexFlags=e.flags||"",t.value.regexCaptureGroup=e.captureGroup||1}else if(a.type==="javascript"){const e=a.config;t.value.javascriptCode=e.code||"",t.value.javascriptTimeout=e.timeout||1e4}else if(a.type==="python"){const e=a.config;t.value.pythonCode=e.code||"",t.value.pythonFunctionName=e.functionName||"extract_data",t.value.pythonTimeout=e.timeout||1e4}}finally{S.value=!1}}function B(a){a==="regex"&&!t.value.regexPattern?(t.value.regexPattern=t.value.regexPattern||"",t.value.regexFlags=t.value.regexFlags||"",t.value.regexCaptureGroup=t.value.regexCaptureGroup||1):a==="javascript"&&!t.value.javascriptCode?(t.value.javascriptCode=t.value.javascriptCode||`// Return extracted value
return content`,t.value.javascriptTimeout=t.value.javascriptTimeout||1e4):a==="python"&&!t.value.pythonCode&&(t.value.pythonCode=t.value.pythonCode||`def extract_data(content):
    """Extract data from content."""
    return content`,t.value.pythonFunctionName=t.value.pythonFunctionName||"extract_data",t.value.pythonTimeout=t.value.pythonTimeout||1e4)}function Q(a){B(a)}function ee(){if(!t.value.regexPattern){h.value=null;return}try{new RegExp(t.value.regexPattern,t.value.regexFlags),h.value=null}catch(a){h.value=a instanceof Error?a.message:"Invalid pattern"}}function D(){let a;return t.value.type==="regex"?a={pattern:t.value.regexPattern,flags:t.value.regexFlags,captureGroup:t.value.regexCaptureGroup}:t.value.type==="javascript"?a={code:t.value.javascriptCode,timeout:t.value.javascriptTimeout}:a={code:t.value.pythonCode,functionName:t.value.pythonFunctionName,timeout:t.value.pythonTimeout},{name:t.value.name.trim(),description:t.value.description?.trim()||void 0,type:t.value.type,config:a,outputType:t.value.outputType,refusalWords:t.value.refusalWords&&t.value.refusalWords.length>0?t.value.refusalWords.filter(e=>e&&typeof e=="string"&&e.trim()).map(e=>e.trim()):void 0,rejectRefusalWords:t.value.rejectRefusalWords,testCases:t.value.testCases||[],isBuiltIn:!1,isPublic:!1,tags:t.value.tags&&Array.isArray(t.value.tags)?t.value.tags.filter(e=>e&&typeof e=="string"&&e.trim()).map(e=>e.trim()):[]}}function te(a,e){return a.length<=e?a:a.substring(0,e)+"..."}function $(a,e){let d=e;if(t.value.outputType==="number")d=parseFloat(e);else if(t.value.outputType==="boolean")d=e==="true";else if(t.value.outputType==="json")try{d=JSON.parse(e)}catch{}return typeof a=="number"&&typeof d=="number"?Math.abs(a-d)<1e-4:typeof a=="object"&&typeof d=="object"?JSON.stringify(a)===JSON.stringify(d):a===d}async function ae(){if(!u.value||!u.value.success){m.warning("Please run a successful test first");return}const a={name:`Test Case ${t.value.testCases.length+1}`,input:C.value,output:u.value.value,expected:b.value&&_.value?_.value:void 0,createdAt:new Date};t.value.testCases.push(a),m.success("Test case saved")}function A(a){C.value=a.input,a.expected!==void 0?(_.value=String(a.expected),b.value=!0):(_.value="",b.value=!1),u.value=null}async function se(a){A(a),await J()}function le(a){t.value.testCases.splice(a,1),m.success("Test case removed")}async function J(){if(!C.value){m.warning("Please enter test input");return}z.value=!0,u.value=null;try{const a=D(),e=await M.validate(a);if(!e.valid){u.value={success:!1,error:e.errors?.join(", ")||"Invalid parser configuration"};return}const d={...a,id:"temp-test",created:new Date,updated:new Date},W=await M.executeParser(C.value,d);u.value=W}catch(a){u.value={success:!1,error:a instanceof Error?a.message:"Test failed"}}finally{z.value=!1}}function R(a){if(a===void 0)return"undefined";if(a===null)return"null";if(typeof a=="string")return`"${a}"`;if(typeof a=="object")try{return JSON.stringify(a,null,2)}catch{return String(a)}return String(a)}const L=O(()=>t.value.name.trim()?t.value.type==="regex"?!!t.value.regexPattern&&!h.value:t.value.type==="javascript"?!!t.value.javascriptCode:t.value.type==="python"?!!t.value.pythonCode&&!!t.value.pythonFunctionName:!1:!1);async function oe(){if(!L.value){m.error("Please fill in all required fields");return}E.value=!0;try{const a=D(),e=await M.validate(a);if(!e.valid){m.error(e.errors?.join(", ")||"Invalid parser configuration");return}y.value?(await k.updateParser(y.value,a),m.success("Parser updated successfully")):(await k.createParser(a),m.success("Parser created successfully")),N.push("/parsers")}catch(a){m.error(a instanceof Error?a.message:"Failed to save parser")}finally{E.value=!1}}function q(){N.push("/parsers")}return me(()=>{Z()}),(a,e)=>{const d=Te,W=be,ne=je,j=Ne,v=Fe,x=Ee,w=Se,F=ze,T=We,re=Re,U=Ue,H=Ie,ue=Ge,ie=we,de=Pe,pe=Ve,ve=Ce;return i(),p("div",Be,[s(ve,null,{default:l(()=>[s(W,{class:"editor-header"},{default:l(()=>[o("div",De,[s(d,{type:"text",onClick:q,class:"back-button"},{icon:l(()=>[s(P(ke))]),default:l(()=>[e[18]||(e[18]=r(" Back to Parsers "))]),_:1,__:[18]}),o("h1",$e,c(y.value?"Edit Parser":"Create Parser"),1)])]),_:1}),s(de,{class:"editor-content"},{default:l(()=>[o("div",Ae,[S.value?(i(),p("div",Je,[s(ne,{size:"large",tip:"Loading parser..."})])):(i(),p("div",Le,[s(ie,{model:t.value,layout:"vertical"},{default:l(()=>[o("div",qe,[e[26]||(e[26]=o("div",{class:"section-header"},[o("h3",null,"Basic Information")],-1)),o("div",He,[s(v,{label:"Name",rules:[{required:!0,message:"Name is required"}],class:"form-item"},{default:l(()=>[s(j,{value:t.value.name,"onUpdate:value":e[0]||(e[0]=n=>t.value.name=n),placeholder:"Enter parser name",size:"large"},null,8,["value"])]),_:1}),s(v,{label:"Type",class:"form-item"},{default:l(()=>[s(w,{value:t.value.type,"onUpdate:value":e[1]||(e[1]=n=>t.value.type=n),size:"large",disabled:!!y.value,onChange:Q},{default:l(()=>[s(x,{value:"regex"},{default:l(()=>e[19]||(e[19]=[r("Regular Expression")])),_:1,__:[19]}),s(x,{value:"javascript"},{default:l(()=>e[20]||(e[20]=[r("JavaScript")])),_:1,__:[20]}),s(x,{value:"python"},{default:l(()=>e[21]||(e[21]=[r("Python")])),_:1,__:[21]})]),_:1},8,["value","disabled"])]),_:1})]),o("div",Ye,[s(v,{label:"Output Type",class:"form-item"},{default:l(()=>[s(w,{value:t.value.outputType,"onUpdate:value":e[2]||(e[2]=n=>t.value.outputType=n),size:"large"},{default:l(()=>[s(x,{value:"text"},{default:l(()=>e[22]||(e[22]=[r("Text")])),_:1,__:[22]}),s(x,{value:"number"},{default:l(()=>e[23]||(e[23]=[r("Number")])),_:1,__:[23]}),s(x,{value:"boolean"},{default:l(()=>e[24]||(e[24]=[r("Boolean")])),_:1,__:[24]}),s(x,{value:"json"},{default:l(()=>e[25]||(e[25]=[r("JSON")])),_:1,__:[25]})]),_:1},8,["value"])]),_:1}),s(v,{label:"Tags",class:"form-item"},{default:l(()=>[s(w,{value:t.value.tags,"onUpdate:value":e[3]||(e[3]=n=>t.value.tags=n),mode:"tags",placeholder:"Add tags for search",size:"large"},null,8,["value"])]),_:1})]),s(v,{label:"Description",class:"form-item full-width"},{default:l(()=>[s(F,{value:t.value.description,"onUpdate:value":e[4]||(e[4]=n=>t.value.description=n),placeholder:"Optional description of what this parser does",rows:2,size:"large"},null,8,["value"])]),_:1})]),o("div",Ke,[e[32]||(e[32]=o("div",{class:"section-header"},[o("h3",null,"Parser Configuration")],-1)),t.value.type==="regex"?(i(),p("div",Xe,[s(v,{label:"Pattern",validateStatus:h.value?"error":"",help:h.value},{default:l(()=>[s(j,{value:t.value.regexPattern,"onUpdate:value":e[5]||(e[5]=n=>t.value.regexPattern=n),placeholder:"Enter regex pattern (e.g., (\\d+) to match numbers)",size:"large",onBlur:ee},null,8,["value"])]),_:1},8,["validateStatus","help"]),o("div",Ze,[s(v,{label:"Flags",class:"form-item"},{default:l(()=>[s(re,{value:V.value,"onUpdate:value":e[6]||(e[6]=n=>V.value=n)},{default:l(()=>[s(T,{value:"g"},{default:l(()=>e[27]||(e[27]=[r("Global (g)")])),_:1,__:[27]}),s(T,{value:"i"},{default:l(()=>e[28]||(e[28]=[r("Case Insensitive (i)")])),_:1,__:[28]}),s(T,{value:"m"},{default:l(()=>e[29]||(e[29]=[r("Multiline (m)")])),_:1,__:[29]}),s(T,{value:"s"},{default:l(()=>e[30]||(e[30]=[r("Dot All (s)")])),_:1,__:[30]})]),_:1},8,["value"])]),_:1}),s(v,{label:"Capture Group",class:"form-item"},{default:l(()=>[s(U,{value:t.value.regexCaptureGroup,"onUpdate:value":e[7]||(e[7]=n=>t.value.regexCaptureGroup=n),min:0,max:99,placeholder:"Which capture group to return (default: 1)",size:"large",style:{width:"100%"}},null,8,["value"])]),_:1})])])):t.value.type==="javascript"?(i(),p("div",Qe,[s(v,{label:"Code"},{default:l(()=>[s(F,{value:t.value.javascriptCode,"onUpdate:value":e[8]||(e[8]=n=>t.value.javascriptCode=n),placeholder:`// JavaScript function body
// The 'content' variable contains the input text
// Return the extracted value

const match = content.match(/\\d+/)
return match ? parseInt(match[0]) : null`,rows:12,size:"large",style:{"font-family":"'Monaco', 'Menlo', monospace","font-size":"13px"}},null,8,["value"])]),_:1}),s(v,{label:"Timeout (ms)"},{default:l(()=>[s(U,{value:t.value.javascriptTimeout,"onUpdate:value":e[9]||(e[9]=n=>t.value.javascriptTimeout=n),min:100,max:1e4,step:100,placeholder:"Execution timeout in milliseconds",size:"large",style:{width:"200px"}},null,8,["value"])]),_:1})])):t.value.type==="python"?(i(),p("div",et,[s(v,{label:"Code"},{default:l(()=>[s(F,{value:t.value.pythonCode,"onUpdate:value":e[10]||(e[10]=n=>t.value.pythonCode=n),placeholder:`import re

def extract_data(content):
    '''Extract data from content.'''
    # Your Python code here
    match = re.search(r'\\d+', content)
    if match:
        return int(match.group())
    return None`,rows:15,size:"large",style:{"font-family":"'Monaco', 'Menlo', monospace","font-size":"13px"}},null,8,["value"])]),_:1}),o("div",tt,[s(v,{label:"Function Name",class:"form-item"},{default:l(()=>[s(j,{value:t.value.pythonFunctionName,"onUpdate:value":e[11]||(e[11]=n=>t.value.pythonFunctionName=n),placeholder:"Name of function to call (e.g., extract_data)",size:"large"},null,8,["value"])]),_:1}),s(v,{label:"Timeout (ms)",class:"form-item"},{default:l(()=>[s(U,{value:t.value.pythonTimeout,"onUpdate:value":e[12]||(e[12]=n=>t.value.pythonTimeout=n),min:100,max:3e4,step:100,placeholder:"Execution timeout",size:"large",style:{width:"100%"}},null,8,["value"])]),_:1})]),s(H,{message:"Python Support",type:"success","show-icon":"",style:{"margin-top":"16px"}},{description:l(()=>e[31]||(e[31]=[o("div",null,[r(" Python code runs in the browser using Pyodide with full NumPy, pandas, and scipy support. "),o("br"),o("br"),o("strong",null,"Standard library and built-in packages:"),r(" If importing from the Python standard library (re, json, statistics) or "),o("a",{href:"https://pyodide.org/en/stable/usage/packages-in-pyodide.html",target:"_blank"},"packages built for Pyodide"),r(" (numpy, scipy, nltk), just import as normal - no pip install required. "),o("br"),o("br"),o("strong",null,"For other PyPI packages:"),r(" Add this before your imports: "),o("pre",{style:{"margin-top":"8px",background:"#f5f5f5",padding:"8px","border-radius":"4px"}},`import micropip
await micropip.install('textcounts')
import textcounts`)],-1)])),_:1})])):f("",!0)]),o("div",at,[o("div",st,[e[35]||(e[35]=o("h3",null,"Test Parser",-1)),o("div",lt,[s(d,{onClick:J,loading:z.value,type:"primary"},{icon:l(()=>[s(P(Oe))]),default:l(()=>[e[33]||(e[33]=r(" Run Test "))]),_:1,__:[33]},8,["loading"]),u.value&&u.value.success?(i(),G(d,{key:0,onClick:ae,type:"default"},{icon:l(()=>[s(P(K))]),default:l(()=>[e[34]||(e[34]=r(" Save as Test Case "))]),_:1,__:[34]})):f("",!0)])]),o("div",ot,[s(v,{label:"Test Input"},{default:l(()=>[s(F,{value:C.value,"onUpdate:value":e[13]||(e[13]=n=>C.value=n),placeholder:"Enter sample text to test the parser...",rows:4,size:"large"},null,8,["value"])]),_:1}),b.value?(i(),G(v,{key:0,label:"Expected Result (Optional)"},{default:l(()=>[s(j,{value:_.value,"onUpdate:value":e[14]||(e[14]=n=>_.value=n),placeholder:"Enter expected result for comparison",size:"large"},null,8,["value"])]),_:1})):f("",!0),s(T,{checked:b.value,"onUpdate:checked":e[15]||(e[15]=n=>b.value=n)},{default:l(()=>e[36]||(e[36]=[r(" Add expected value for comparison ")])),_:1,__:[36]},8,["checked"])]),u.value?(i(),p("div",nt,[s(H,{type:u.value.success?"success":"error",message:u.value.success?"Parser executed successfully":"Parser failed","show-icon":""},{description:l(()=>[u.value.success?(i(),p("div",rt,[e[37]||(e[37]=o("strong",null,"Result:",-1)),o("code",null,c(R(u.value.value)),1)])):(i(),p("div",ut,[e[38]||(e[38]=o("strong",null,"Error:",-1)),r(" "+c(u.value.error),1)])),u.value.executionTimeMs?(i(),p("div",it,[e[39]||(e[39]=o("strong",null,"Execution time:",-1)),r(" "+c(u.value.executionTimeMs)+"ms ",1)])):f("",!0),_.value&&u.value.success?(i(),p("div",dt,[e[40]||(e[40]=o("strong",null,"Match Expected:",-1)),s(ue,{color:$(u.value.value,_.value)?"success":"error"},{default:l(()=>[r(c($(u.value.value,_.value)?"Match":"No Match"),1)]),_:1},8,["color"])])):f("",!0)]),_:1},8,["type","message"])])):f("",!0),t.value.testCases&&t.value.testCases.length>0?(i(),p("div",pt,[o("h4",null,"Saved Test Cases ("+c(t.value.testCases.length)+")",1),o("div",vt,[(i(!0),p(ge,null,ye(t.value.testCases,(n,I)=>(i(),p("div",{key:I,class:"test-case-item"},[o("div",ct,[o("span",ft,c(n.name||`Test Case ${I+1}`),1),s(d,{size:"small",type:"text",danger:"",onClick:Y=>le(I)},{icon:l(()=>[s(P(Me))]),_:2},1032,["onClick"])]),o("div",mt,[o("div",_t,[e[41]||(e[41]=o("span",{class:"field-label"},"Input:",-1)),o("code",gt,c(te(n.input,100)),1)]),o("div",yt,[e[42]||(e[42]=o("span",{class:"field-label"},"Output:",-1)),o("code",xt,c(R(n.output)),1)]),n.expected!==void 0?(i(),p("div",ht,[e[43]||(e[43]=o("span",{class:"field-label"},"Expected:",-1)),o("code",Ct,c(R(n.expected)),1)])):f("",!0)]),o("div",bt,[s(d,{size:"small",onClick:Y=>A(n)},{default:l(()=>e[44]||(e[44]=[r(" Load ")])),_:2,__:[44]},1032,["onClick"]),s(d,{size:"small",onClick:Y=>se(n)},{default:l(()=>e[45]||(e[45]=[r(" Run ")])),_:2,__:[45]},1032,["onClick"])])]))),128))])])):f("",!0)]),o("div",Tt,[e[47]||(e[47]=o("div",{class:"section-header"},[o("h3",null,"Refusal Detection (Optional)")],-1)),s(v,null,{default:l(()=>[s(T,{checked:t.value.rejectRefusalWords,"onUpdate:checked":e[16]||(e[16]=n=>t.value.rejectRefusalWords=n)},{default:l(()=>e[46]||(e[46]=[r(" Reject responses containing refusal words ")])),_:1,__:[46]},8,["checked"])]),_:1}),t.value.rejectRefusalWords?(i(),G(v,{key:0,label:"Refusal Words"},{default:l(()=>[s(w,{value:t.value.refusalWords,"onUpdate:value":e[17]||(e[17]=n=>t.value.refusalWords=n),mode:"tags",placeholder:"Enter refusal words (e.g., cannot, unable, sorry)",size:"large"},null,8,["value"])]),_:1})):f("",!0)])]),_:1},8,["model"])]))])]),_:1}),s(pe,{class:"editor-footer"},{default:l(()=>[o("div",kt,[o("div",Pt,[t.value.type==="regex"&&t.value.regexPattern?(i(),p("span",jt," Pattern: "+c(t.value.regexPattern.length)+" chars ",1)):t.value.type==="javascript"&&t.value.javascriptCode?(i(),p("span",wt," Code: "+c(t.value.javascriptCode.split(`
`).length)+" lines ",1)):t.value.type==="python"&&t.value.pythonCode?(i(),p("span",Ft," Code: "+c(t.value.pythonCode.split(`
`).length)+" lines ",1)):f("",!0)]),o("div",Nt,[s(d,{size:"large",onClick:q},{default:l(()=>e[48]||(e[48]=[r(" Cancel ")])),_:1,__:[48]}),s(d,{size:"large",type:"primary",onClick:oe,loading:E.value,disabled:!L.value},{icon:l(()=>[s(P(K))]),default:l(()=>[r(" "+c(y.value?"Save Changes":"Create Parser"),1)]),_:1},8,["loading","disabled"])])])]),_:1})]),_:1})])}}}),Gt=he(St,[["__scopeId","data-v-ef2a7ab2"]]);export{Gt as default};
