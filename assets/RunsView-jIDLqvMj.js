const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./PythonExportService-CIo8_tsV.js","./index-BFa6Iu16.js","./vendor-CcR2-GEf.js","./db-ftwlfnxb.js","./index-zWy5gnVS.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,a,n)=>((t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n)(t,"symbol"!=typeof a?a+"":a,n);import{X as a,r as n,B as o,i as s,d as l,b as i,e as r,F as u,D as c,f as d,g as p,t as m,w as v,n as g,o as b,m as h,U as y,k as f,V as _,Y as C,v as k,q as x,I as w,u as S,Z as E,_ as O,p as M}from"./vendor-CcR2-GEf.js";import{u as R}from"./runs-DdjmTKJM.js";import{D as P,d as T,_ as I,a as D,u as V,b as $}from"./index-BFa6Iu16.js";import{u as F}from"./variableLists-05iWdhAz.js";import"./db-ftwlfnxb.js";const L=class e{constructor(){t(this,"dbService"),this.dbService=P.getInstance()}static getInstance(){return e.instance||(e.instance=new e),e.instance}async calculateExperimentMetrics(e,t=[]){let a=1,n=0,o=0;const s=e.variables||{};for(const[i,r]of Object.entries(s))Array.isArray(r)&&r.length>0&&(a*=r.length,n++);const l=e.variable_list_refs||{};for(const[i,r]of Object.entries(l)){let e=t.find(e=>e.id===r);if(!e){const t=await this.dbService.read("variable_lists",r);t.success&&t.data&&(e=t.data)}e&&e.values&&e.values.length>0&&(a*=e.values.length,o++)}return{totalCombinations:a,variableCount:n+o,simpleVariables:n,compoundVariables:o,estimatedTasks:a}}async estimateExperimentCost(e,t,a=[],n={}){const o=await this.calculateExperimentMetrics(e,a),s=o.totalCombinations*t.length,{estimatedInputTokens:l=100,estimatedOutputTokens:i=50}=n;let r=0;const u={};for(const c of t){const e="openrouter"===c.provider?c.input_cost||0:(c.input_cost||0)/1e6,t="openrouter"===c.provider?c.output_cost||0:(c.output_cost||0)/1e6;console.log(`DEBUG: Model ${c.id}, provider: ${c.provider}`),console.log(`DEBUG: Raw costs - input: ${c.input_cost}, output: ${c.output_cost}`),console.log(`DEBUG: Per-token costs - input: ${e}, output: ${t}`);const a=e*l*o.totalCombinations,n=t*i*o.totalCombinations,s=a+n;console.log(`DEBUG: Final costs - input: ${a}, output: ${n}, total: ${s}`),u[c.id]=s,r+=s}return{totalCost:r,costPerModel:u,costPerTask:s>0?r/s:0,breakdown:{inputTokens:l*s,outputTokens:i*s,requests:s}}}validateExperimentSize(e,t){const a=e.totalCombinations*t,n=[],o=[];return a>1e3&&n.push(`Large experiment: ${a} tasks may take significant time`),a>1e4&&n.push("Very large experiment: Consider running in batches"),a>5e4&&o.push(`Experiment too large: ${a} tasks exceeds maximum of 50,000`),e.totalCombinations>1e5&&o.push(`Too many variable combinations: ${e.totalCombinations} exceeds maximum of 100,000`),{valid:0===o.length,warnings:n,errors:o}}};t(L,"instance");let B=L;function U(e,t){let a=e;for(const[n,o]of Object.entries(t)){const e=new RegExp(`{{\\s*${n}\\s*}}`,"g"),t=Array.isArray(o)?o.join(", "):String(o);a=a.replace(e,t)}return function(e){const t=e.split(/\s+/);let a=0;for(const o of t)0!==o.length&&(o.length<=4?a+=1:o.length<=8?a+=Math.ceil(o.length/4):a+=Math.ceil(o.length/3.5));const n=e.match(/[.,!?;:'"()\[\]{}<>@#$%^&*+=|\\\/~`-]/g);return n&&(a+=.5*n.length),Math.ceil(a)}(a)}const j=class e{constructor(){t(this,"experimentService"),this.experimentService=B.getInstance()}static getInstance(){return e.instance||(e.instance=new e),e.instance}async estimateRunCost(e,t,a,n={}){if(0===t.length)return this.createEmptyResult();const o=await this.experimentService.calculateExperimentMetrics(e,a),s=await this.calculateInputTokens(e,n),l=n.estimatedOutputTokens||25,i=n.repetitionsPerPrompt||1,r=[];let u=0;for(const d of t){const e=this.calculateModelCost(d,s,l,o.totalCombinations,i);r.push(e),u+=e.totalCost}const c=o.totalCombinations*t.length*i;return{totalCost:u,averageCostPerTask:c>0?u/c:0,totalTasks:c,totalCombinations:o.totalCombinations,breakdown:r}}estimateQuickCost(e,t,a,n,o=1){let s=0;for(const l of e){s+=this.calculateModelCost(l,a,n,t,o).totalCost}return s}calculateModelCost(e,t,a,n,o){const s=this.getInputCostPerToken(e)*t+this.getOutputCostPerToken(e)*a,l=s*n*o;return{model:e.name,modelId:e.id,inputTokens:t,outputTokens:a,costPerTask:s,totalCost:l}}getInputCostPerToken(e){return e.input_cost?"openrouter"===e.provider?e.input_cost:e.input_cost/1e6:0}getOutputCostPerToken(e){return e.output_cost?"openrouter"===e.provider?e.output_cost:e.output_cost/1e6:0}async calculateInputTokens(e,t){if(t.estimatedInputTokens)return t.estimatedInputTokens;if(!e.prompt_template)return 100;const a=t.sampleVariables||this.createSampleVariables(e);return U(e.prompt_template,a)}createSampleVariables(e){const t={},a=e.variables||{};for(const[n,o]of Object.entries(a))Array.isArray(o)&&o.length>0?t[n]=o[0]:t[n]="string"==typeof o?o:"sample";return t}createEmptyResult(){return{totalCost:0,averageCostPerTask:0,totalTasks:0,totalCombinations:0,breakdown:[]}}formatCost(e){return e<.001?e.toFixed(6):e<.01?e.toFixed(4):e<1?e.toFixed(3):e.toFixed(2)}formatModelCost(e,t){const a="input"===t?e.input_cost:e.output_cost;if(void 0===a)return"?";const n="openrouter"===e.provider?1e6*a:a;return n<.01?n.toFixed(4):n<1?n.toFixed(3):n<10?n.toFixed(2):n.toFixed(1)}};t(j,"instance");let A=j;const N=class e{constructor(){t(this,"calculationState",n({isCalculating:!1,lastCalculationTime:0,requestId:null})),t(this,"cachedResults",n(new Map)),t(this,"experimentService",B.getInstance()),t(this,"costService",A.getInstance()),t(this,"debounceTimer",null),t(this,"DEBOUNCE_MS",150)}static getInstance(){return e.instance||(e.instance=new e),e.instance}async calculateRunMetrics(e,t,a,n={}){const o=this.generateCacheKey(e,t,n),s=this.cachedResults.value.get(o);if(s&&Date.now()-this.calculationState.value.lastCalculationTime<5e3)return s;if(this.calculationState.value.isCalculating)return console.log("ðŸš« Calculation already in progress, returning cached or default"),s||this.getDefaultResult();const l=Math.random().toString(36).substr(2,9);this.calculationState.value={isCalculating:!0,lastCalculationTime:Date.now(),requestId:l};try{if(!e)return this.getDefaultResult();const s=await this.experimentService.calculateExperimentMetrics(e,a),l=s.totalCombinations*t.length*(n.repetitions_per_prompt||1);let i=0;if(t.length>0){i=(await this.costService.estimateRunCost(e,t,a,{estimatedOutputTokens:n.max_tokens||25,repetitionsPerPrompt:n.repetitions_per_prompt||1})).totalCost}const r={taskCount:l,estimatedCost:i,totalCombinations:s.totalCombinations,error:null};return this.cachedResults.value.set(o,r),r}catch(i){console.error("RunCoordinator calculation failed:",i);return{taskCount:0,estimatedCost:0,totalCombinations:0,error:i instanceof Error?i.message:"Calculation failed"}}finally{this.calculationState.value={isCalculating:!1,lastCalculationTime:Date.now(),requestId:null}}}calculateRunMetricsDebounced(e,t,a,n={}){return new Promise(o=>{this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(async()=>{const s=await this.calculateRunMetrics(e,t,a,n);o(s)},this.DEBOUNCE_MS)})}async updateActiveRun(e,t){try{await T.runs.update(e,{...t,updated_at:(new Date).toISOString()})}catch(a){throw console.error("RunCoordinator: Failed to update active run:",a),a}}async getActiveRunStatus(e){try{return await T.runs.get(e)||null}catch(t){return console.error("RunCoordinator: Failed to get run status:",t),null}}clearCache(){this.cachedResults.value.clear(),console.log("RunCoordinator: Cache cleared")}getCalculationState(){return this.calculationState.value}generateCacheKey(e,t,a){return`${e?.id||"null"}:${t.map(e=>e.id).sort().join(",")}:${JSON.stringify(a)}`}getDefaultResult(){return{taskCount:0,estimatedCost:0,totalCombinations:0,error:null}}};t(N,"instance");const q=N.getInstance();q.calculateRunMetrics.bind(q),q.calculateRunMetricsDebounced.bind(q),q.updateActiveRun.bind(q),q.getActiveRunStatus.bind(q);const J=class e{static getInstance(){return e.instance||(e.instance=new e),e.instance}getQuickFilters(){return[{id:"all",label:"All Models",filterFn:()=>!0},{id:"openai",label:"OpenAI",filterFn:e=>e.provider.toLowerCase().includes("openai")},{id:"anthropic",label:"Anthropic",filterFn:e=>e.provider.toLowerCase().includes("anthropic")},{id:"budget",label:"Budget",filterFn:e=>(e.input_cost||0)<.001},{id:"premium",label:"Premium",filterFn:e=>(e.input_cost||0)>=.001},{id:"ollama",label:"Ollama",filterFn:e=>e.provider.toLowerCase().includes("ollama")},{id:"openrouter",label:"OpenRouter",filterFn:e=>e.provider.toLowerCase().includes("openrouter")}]}filterModels(e,t={}){const{searchQuery:a="",activeFilterId:n="",sortByProvider:o=!0}=t;let s=[...e];if(a.trim()){const e=a.toLowerCase();s=s.filter(t=>t.name.toLowerCase().includes(e)||t.provider.toLowerCase().includes(e))}if(n&&"all"!==n){const e=this.getQuickFilters().find(e=>e.id===n);e&&(s=s.filter(e.filterFn))}return{models:s,modelsByProvider:this.groupModelsByProvider(s,o),totalCount:e.length,filteredCount:s.length}}groupModelsByProvider(e,t=!0){const a={};if(e.forEach(e=>{a[e.provider]||(a[e.provider]=[]),a[e.provider].push(e)}),Object.keys(a).forEach(e=>{a[e].sort((e,t)=>e.name.localeCompare(t.name))}),t){const e={};return Object.keys(a).sort().forEach(t=>{e[t]=a[t]}),e}return a}smartSort(e){return e.every(e=>!isNaN(Number(e))&&""!==e.trim())?e.sort((e,t)=>Number(e)-Number(t)):e.sort()}getProviderStats(e){const t={},a={};return e.forEach(e=>{t[e.provider]||(t[e.provider]={count:0,avgCost:0},a[e.provider]=[]),t[e.provider].count++,void 0!==e.input_cost&&a[e.provider].push(e.input_cost)}),Object.keys(t).forEach(e=>{const n=a[e];n.length>0&&(t[e].avgCost=n.reduce((e,t)=>e+t,0)/n.length)}),t}filterByCapabilities(e,t){return e.filter(e=>(void 0===t.supportsFunctionCalling||e.supports_function_calling===t.supportsFunctionCalling)&&((void 0===t.supportsJsonMode||e.supports_json_mode===t.supportsJsonMode)&&(!(void 0!==t.minContextWindow&&(e.context_window||0)<t.minContextWindow)&&!(void 0!==t.maxContextWindow&&(e.context_window||0)>t.maxContextWindow))))}getSuggestedModels(e,t){let a=[...e];return"function_tool_calling"===t?.output_format?a=a.filter(e=>e.supports_function_calling):"response_format_json_mode"===t?.output_format&&(a=a.filter(e=>e.supports_json_mode)),t?.estimated_cost_budget&&(a=a.filter(e=>(e.input_cost||0)<=t.estimated_cost_budget)),a.sort((e,t)=>{const a={OpenAI:1,Anthropic:2,OpenRouter:3,Ollama:4},n=a[e.provider]||999,o=a[t.provider]||999;return n!==o?n-o:e.name.localeCompare(t.name)}),a.slice(0,10)}};t(J,"instance");let Q=J;const z={class:"model-provider-grid"},G=["onClick"],W={class:"provider-controls"},K={class:"model-count"},Y={key:0,class:"selection-indicator"},Z={class:"selected-count"},H=["onClick"],X={key:0,class:"models-list"},ee=["onClick"],te={class:"model-info"},ae={class:"model-name"},ne={key:0,class:"cost-info"},oe={key:1,class:"context-info"},se={key:2,class:"capabilities"},le={key:0,class:"capability"},ie={key:1,class:"capability"},re={class:"selection-indicator"},ue={key:0},ce=I(l({__name:"ModelProviderGrid",props:{modelsByProvider:{},selectedModels:{},expandedProviders:{},getProviderSelectionStats:{type:Function}},emits:["toggle-model","toggle-provider","select-all-provider"],setup(e){const t=e,a=A.getInstance(),n=s(()=>{const e={};return Object.entries(t.modelsByProvider).forEach(([a,n])=>{const o=t.getProviderSelectionStats(n);e[a]={selected:o.selected,total:o.total}}),e});function o(e){const t=n.value[e];return t?0===t.selected?"Select All":t.selected===t.total?"Deselect All":"Select All":"Select All"}function l(e,t){return a.formatModelCost(e,t)}return(e,t)=>(r(),i("div",z,[(r(!0),i(u,null,c(e.modelsByProvider,(t,a)=>(r(),i("div",{key:a,class:"provider-section"},[d("div",{class:"provider-header",onClick:t=>e.$emit("toggle-provider",a)},[d("h4",null,m(a),1),d("div",W,[d("span",K,m(t.length)+" models",1),n.value[a]?(r(),i("div",Y,[d("span",Z,m(n.value[a].selected)+"/"+m(n.value[a].total),1)])):p("",!0),d("button",{class:"select-all-btn",onClick:v(n=>e.$emit("select-all-provider",a,t),["stop"])},m(o(a)),9,H),d("span",{class:g(["expand-icon",{expanded:e.expandedProviders.has(a)}])}," â–¼ ",2)])],8,G),e.expandedProviders.has(a)?(r(),i("div",X,[(r(!0),i(u,null,c(t,t=>{return r(),i("div",{key:t.id,class:g(["model-card",{selected:e.selectedModels.includes(t.id),"cost-available":void 0!==t.input_cost}]),onClick:a=>e.$emit("toggle-model",t.id)},[d("div",te,[d("span",ae,m(t.name),1),void 0!==t.input_cost?(r(),i("span",ne," $"+m(l(t,"input"))+"/$"+m(l(t,"output")),1)):p("",!0),t.context_window?(r(),i("span",oe,m((a=t.context_window,a>=1e6?`${(a/1e6).toFixed(1)}M`:a>=1e3?`${(a/1e3).toFixed(0)}K`:a.toString()))+" context ",1)):p("",!0),t.supports_function_calling||t.supports_json_mode?(r(),i("div",se,[t.supports_function_calling?(r(),i("span",le,"Functions")):p("",!0),t.supports_json_mode?(r(),i("span",ie,"JSON")):p("",!0)])):p("",!0)]),d("div",re,[d("div",{class:g(["checkbox",{checked:e.selectedModels.includes(t.id)}])},[e.selectedModels.includes(t.id)?(r(),i("span",ue,"âœ“")):p("",!0)],2)])],10,ee);var a}),128))])):p("",!0)]))),128))]))}}),[["__scopeId","data-v-16c7a4c2"]]),de={class:"run-modal-proper"},pe={class:"modal-header"},me={class:"modal-main"},ve={class:"left-panel"},ge={class:"option-group"},be={class:"field"},he={class:"field"},ye=["value"],fe={class:"option-group"},_e={class:"params-grid"},Ce={class:"param-field"},ke={class:"param-field"},xe={class:"param-field"},we={class:"param-field"},Se={class:"option-group"},Ee={class:"radio-group"},Oe={class:"radio-option"},Me={class:"radio-option"},Re={key:0,class:"option-group python-options"},Pe={class:"checkbox-grid"},Te={class:"checkbox-option"},Ie={class:"checkbox-option"},De={class:"checkbox-option"},Ve={class:"checkbox-option"},$e={class:"checkbox-option"},Fe={class:"params-grid"},Le={class:"param-field"},Be={class:"param-field"},Ue={class:"param-field"},je={class:"param-field"},Ae={class:"right-panel"},Ne={class:"search-section"},qe={class:"summary-split"},Je={class:"table-section"},Qe={key:0,class:"models-table-container"},ze={class:"models-table"},Ge={class:"model-name"},We={class:"provider"},Ke={class:"cost"},Ye={class:"cost"},Ze={class:"tasks"},He={class:"model-cost"},Xe={key:1,class:"no-models-message"},et={class:"summary-section"},tt={class:"totals-card"},at={class:"total-item"},nt={class:"total-value"},ot={class:"total-item"},st={class:"total-value"},lt={class:"total-item"},it={class:"total-value"},rt={class:"total-item highlight"},ut={class:"total-value"},ct={class:"total-item highlight cost"},dt={class:"total-value"},pt={class:"modal-footer"},mt={class:"footer-left"},vt={key:0,class:"validation-error"},gt={class:"footer-actions"},bt=["disabled"],ht=I(l({__name:"RunModalProper",props:{run:{},preselectedModelIds:{},preselectedDesignId:{}},emits:["close","saved"],setup(e,{emit:t}){const l=e,w=t,S=D(),E=V(),O=R(),M=F(),P=Q.getInstance(),T=A.getInstance(),{formData:I,initializeState:L,updateModelSelection:B}=function(e,t,n){const o=a({name:"",design_id:null,models:[],parameters:{temperature:.7,max_tokens:25,concurrency:3,repetitions_per_prompt:1},executionType:"browser",pythonExportOptions:{outputFormat:"both",enableProgressBar:!0,verboseLogging:!1,enableCheckpointing:!0,maxRetries:3,retryBackoffMultiplier:2,continueOnError:!0,pythonVersion:"3.9+",includeApiLogs:!1}});return{formData:o,initializeState:async a=>{e?(o.name=e.name,o.design_id=e.design_id,o.models=e.models||[],o.parameters={...o.parameters,...e.parameters,repetitions_per_prompt:e.parameters.repetitions_per_prompt??1}):(n&&(o.design_id=n,a&&(o.name=await a(n))),t&&(o.models=[...t]))},updateBasicConfig:e=>{Object.assign(o,e)},updateModelSelection:e=>{o.models=[...e]},updateParameters:e=>{Object.assign(o.parameters,e)},updatePythonOptions:e=>{Object.assign(o.pythonExportOptions,e)},resetState:()=>{o.name="",o.design_id=null,o.models=[],o.parameters={temperature:.7,max_tokens:25,concurrency:3,repetitions_per_prompt:1},o.executionType="browser"}}}(l.run,l.preselectedModelIds,l.preselectedDesignId),U=function(e){const t=s(()=>e.name.trim().length>0),a=s(()=>null!==e.design_id),n=s(()=>e.models.length>0),o=s(()=>{const{temperature:t,max_tokens:a,concurrency:n,repetitions_per_prompt:o}=e.parameters;return t>=0&&t<=2&&a>0&&a<=4e3&&n>0&&n<=256&&o>0&&o<=256}),l=s(()=>t.value&&a.value&&n.value&&o.value),i=s(()=>{const s=[];if(t.value||s.push("Run name is required"),a.value||s.push("Please select a design"),n.value||s.push("Please select at least one model"),!o.value){const{temperature:t,max_tokens:a,concurrency:n,repetitions_per_prompt:o}=e.parameters;(t<0||t>2)&&s.push("Temperature must be between 0 and 2"),(a<=0||a>4e3)&&s.push("Max tokens must be between 1 and 4000"),(n<=0||n>256)&&s.push("Concurrency must be between 1 and 256"),(o<=0||o>256)&&s.push("Repetitions must be between 1 and 256")}return s});return{isNameValid:t,isDesignValid:a,isModelsValid:n,isParametersValid:o,isValid:l,validationMessages:i}}(I),j=n(""),N=n(new Set),J=n(null),z=n(null),G=n(!1),W=s(()=>S.designs),K=s(()=>E.enabledModels),Y=s(()=>I.design_id&&W.value.find(e=>e.id===I.design_id)||null),Z=s(()=>K.value.filter(e=>I.models.includes(e.id))),H=s(()=>P.filterModels(K.value,{searchQuery:j.value,activeFilterId:"",sortByProvider:!0}).modelsByProvider),X=function(e,t,a){const s=F(),l=n(0),i=n(0),r=n(0),u=n(!1),c=n(null),d=async()=>{if(!t.value||0===a.value.length)return l.value=0,i.value=0,void(c.value=null);try{u.value=!0,c.value=null;const n=await q.calculateRunMetrics(t.value,a.value,s.variableLists,{max_tokens:e.parameters.max_tokens,repetitions_per_prompt:e.parameters.repetitions_per_prompt});l.value=n.taskCount,i.value=n.estimatedCost,r.value=n.totalCombinations}catch(n){console.error("Async calculation error:",n),c.value=n instanceof Error?n.message:"Calculation failed",l.value=0,i.value=0,r.value=0}finally{u.value=!1}};return o([t,a,()=>e.parameters],()=>{d()},{deep:!0,immediate:!0}),{taskCount:l,estimatedCost:i,variableCombinations:r,isCalculating:u,calculationError:c,triggerCalculation:d}}(I,Y,Z);function ee(e){G.value=!0;const t=e.clientY,a=z.value?.offsetHeight||300;function n(e){if(!G.value||!z.value)return;const n=e.clientY-t,o=Math.max(200,Math.min(600,a-n));z.value.style.height=`${o}px`}document.addEventListener("mousemove",n),document.addEventListener("mouseup",function e(){G.value=!1,document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",e),document.body.style.cursor="",document.body.style.userSelect=""}),document.body.style.cursor="ns-resize",document.body.style.userSelect="none",e.preventDefault()}function te(e){const t=[...I.models],a=t.indexOf(e);-1===a?t.push(e):t.splice(a,1),B(t)}function ae(e){N.value.has(e)?N.value.delete(e):N.value.add(e)}function ne(e,t){const a=t.map(e=>e.id),n=[...I.models];if(a.every(e=>n.includes(e))){const e=n.filter(e=>!a.includes(e));B(e)}else{const e=[...new Set([...n,...a])];B(e)}}function oe(e){const t=e.filter(e=>I.models.includes(e.id)).length,a=e.length;return{total:a,selected:t,percentage:a>0?t/a*100:0,isFullySelected:t===a&&a>0,isPartiallySelected:t>0&&t<a}}function se(e){if(!e.input_cost||0===X.variableCombinations.value)return"0.0000";return T.estimateQuickCost([e],X.variableCombinations.value,50,I.parameters.max_tokens,I.parameters.repetitions_per_prompt).toFixed(4)}function le(e,t){if(!e)return"0.00";const a="openrouter"===t?1e6*e:e;return a<.01?a.toFixed(4):a<1?a.toFixed(3):a<10?a.toFixed(2):a.toFixed(1)}const ie=async e=>{const t=W.value.find(t=>t.id===e);if(!t)return"New Run";const a=O.runs.filter(t=>t.design_id===e).length+1,n=(new Date).toISOString().split("T")[0];return`${t.name} - ${n} #${a}`},re=async()=>{try{if(!I.design_id)return void console.error("Design ID is required");if("python_export"===I.executionType){const{PythonExportService:e}=await $(async()=>{const{PythonExportService:e}=await import("./PythonExportService-CIo8_tsV.js");return{PythonExportService:e}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),{downloadBlob:t}=await $(async()=>{const{downloadBlob:e}=await import("./fileDownload-C1JQo-y2.js");return{downloadBlob:e}},[],import.meta.url),a=e.getInstance(),n=await a.exportRunConfiguration(I,I.pythonExportOptions);n.success&&n.blob?(t(n.blob,n.filename),w("close")):console.error("Export failed:",n.error)}else{const e={name:I.name,design_id:I.design_id,models:I.models,parameters:I.parameters,status:"draft"};let t;t=l.run?await O.updateRun(l.run.id,e):await O.createRun(e),w("saved",t),w("close")}}catch(e){console.error("Error saving/exporting run:",e)}};return b(async()=>{if(await Promise.all([S.loadDesigns(),E.loadModels(),M.loadVariableLists()]),await L(ie),I.models.length>0){const e=new Set;Z.value.forEach(t=>{e.add(t.provider)}),Array.from(e).forEach(e=>N.value.add(e))}}),(e,t)=>(r(),i("div",{class:"modal-overlay",onClick:t[20]||(t[20]=v(t=>e.$emit("close"),["self"]))},[d("div",de,[d("div",pe,[d("h2",null,m(e.run?"Edit":"Create")+" Run",1),d("button",{class:"close-btn",onClick:t[0]||(t[0]=t=>e.$emit("close"))}," Ã— ")]),d("div",me,[d("div",ve,[d("div",ge,[d("div",be,[t[21]||(t[21]=d("label",null,"Run Name",-1)),h(d("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>f(I).name=e),type:"text",placeholder:"e.g., Product Analysis - 2025-06-26",class:g({error:!f(U).isNameValid.value&&f(I).name})},null,2),[[y,f(I).name]])]),d("div",he,[t[23]||(t[23]=d("label",null,"Design",-1)),h(d("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>f(I).design_id=e),class:g({error:!f(U).isDesignValid.value&&null!==f(I).design_id})},[t[22]||(t[22]=d("option",{value:null}," Select a design... ",-1)),(r(!0),i(u,null,c(W.value,e=>(r(),i("option",{key:e.id,value:e.id},m(e.name),9,ye))),128))],2),[[_,f(I).design_id,void 0,{number:!0}]])])]),d("div",fe,[t[28]||(t[28]=d("h4",null,"Parameters",-1)),d("div",_e,[d("div",Ce,[t[24]||(t[24]=d("label",null,"Temperature",-1)),h(d("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>f(I).parameters.temperature=e),type:"number",min:"0",max:"2",step:"0.1"},null,512),[[y,f(I).parameters.temperature,void 0,{number:!0}]])]),d("div",ke,[t[25]||(t[25]=d("label",null,"Max Tokens",-1)),h(d("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>f(I).parameters.max_tokens=e),type:"number",min:"1",max:"4000"},null,512),[[y,f(I).parameters.max_tokens,void 0,{number:!0}]])]),d("div",xe,[t[26]||(t[26]=d("label",null,"Concurrency",-1)),h(d("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>f(I).parameters.concurrency=e),type:"number",min:"1",max:"256"},null,512),[[y,f(I).parameters.concurrency,void 0,{number:!0}]])]),d("div",we,[t[27]||(t[27]=d("label",null,"Repetitions",-1)),h(d("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>f(I).parameters.repetitions_per_prompt=e),type:"number",min:"1",max:"256"},null,512),[[y,f(I).parameters.repetitions_per_prompt,void 0,{number:!0}]])])])]),d("div",Se,[t[31]||(t[31]=d("h4",null,"Execution Type",-1)),d("div",Ee,[d("label",Oe,[h(d("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>f(I).executionType=e),type:"radio",value:"browser",name:"execution-type"},null,512),[[C,f(I).executionType]]),t[29]||(t[29]=d("span",null,"Run in Browser",-1))]),d("label",Me,[h(d("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>f(I).executionType=e),type:"radio",value:"python_export",name:"execution-type"},null,512),[[C,f(I).executionType]]),t[30]||(t[30]=d("span",null,"Export Python Package",-1))])])]),"python_export"===f(I).executionType?(r(),i("div",Re,[t[43]||(t[43]=d("h4",null,"Export Options",-1)),d("div",Pe,[d("label",Te,[h(d("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>f(I).pythonExportOptions.enableProgressBar=e),type:"checkbox"},null,512),[[k,f(I).pythonExportOptions.enableProgressBar]]),t[32]||(t[32]=d("span",null,"Progress Bar",-1))]),d("label",Ie,[h(d("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>f(I).pythonExportOptions.verboseLogging=e),type:"checkbox"},null,512),[[k,f(I).pythonExportOptions.verboseLogging]]),t[33]||(t[33]=d("span",null,"Verbose Logging",-1))]),d("label",De,[h(d("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>f(I).pythonExportOptions.enableCheckpointing=e),type:"checkbox"},null,512),[[k,f(I).pythonExportOptions.enableCheckpointing]]),t[34]||(t[34]=d("span",null,"Checkpointing",-1))]),d("label",Ve,[h(d("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>f(I).pythonExportOptions.continueOnError=e),type:"checkbox"},null,512),[[k,f(I).pythonExportOptions.continueOnError]]),t[35]||(t[35]=d("span",null,"Continue on Error",-1))]),d("label",$e,[h(d("input",{"onUpdate:modelValue":t[13]||(t[13]=e=>f(I).pythonExportOptions.includeApiLogs=e),type:"checkbox"},null,512),[[k,f(I).pythonExportOptions.includeApiLogs]]),t[36]||(t[36]=d("span",null,"Include API Logs",-1))])]),d("div",Fe,[d("div",Le,[t[38]||(t[38]=d("label",null,"Output Format",-1)),h(d("select",{"onUpdate:modelValue":t[14]||(t[14]=e=>f(I).pythonExportOptions.outputFormat=e)},t[37]||(t[37]=[d("option",{value:"json"}," JSON ",-1),d("option",{value:"csv"}," CSV ",-1),d("option",{value:"both"}," Both ",-1)]),512),[[_,f(I).pythonExportOptions.outputFormat]])]),d("div",Be,[t[39]||(t[39]=d("label",null,"Max Retries",-1)),h(d("input",{"onUpdate:modelValue":t[15]||(t[15]=e=>f(I).pythonExportOptions.maxRetries=e),type:"number",min:"0",max:"10"},null,512),[[y,f(I).pythonExportOptions.maxRetries,void 0,{number:!0}]])]),d("div",Ue,[t[40]||(t[40]=d("label",null,"Backoff Multiplier",-1)),h(d("input",{"onUpdate:modelValue":t[16]||(t[16]=e=>f(I).pythonExportOptions.retryBackoffMultiplier=e),type:"number",min:"1",max:"5",step:"0.1"},null,512),[[y,f(I).pythonExportOptions.retryBackoffMultiplier,void 0,{number:!0}]])]),d("div",je,[t[42]||(t[42]=d("label",null,"Python Version",-1)),h(d("select",{"onUpdate:modelValue":t[17]||(t[17]=e=>f(I).pythonExportOptions.pythonVersion=e)},t[41]||(t[41]=[d("option",{value:"3.8+"}," 3.8+ ",-1),d("option",{value:"3.9+"}," 3.9+ ",-1),d("option",{value:"3.10+"}," 3.10+ ",-1)]),512),[[_,f(I).pythonExportOptions.pythonVersion]])])])])):p("",!0)]),d("div",Ae,[d("div",Ne,[h(d("input",{"onUpdate:modelValue":t[18]||(t[18]=e=>j.value=e),type:"text",placeholder:"Search models",class:"search-input"},null,512),[[y,j.value]])]),x(ce,{"models-by-provider":H.value,"selected-models":f(I).models,"expanded-providers":N.value,"get-provider-selection-stats":oe,onToggleModel:te,onToggleProvider:ae,onSelectAllProvider:ne},null,8,["models-by-provider","selected-models","expanded-providers"])])]),d("div",{ref_key:"separator",ref:J,class:"panel-separator",onMousedown:ee},t[44]||(t[44]=[d("div",{class:"separator-handle"},null,-1)]),544),d("div",{ref_key:"bottomSummary",ref:z,class:"bottom-summary"},[d("div",qe,[d("div",Je,[Z.value.length>0?(r(),i("div",Qe,[d("table",ze,[t[45]||(t[45]=d("thead",null,[d("tr",null,[d("th",null,"Model"),d("th",null,"Provider"),d("th",null,"Input Cost/1M"),d("th",null,"Output Cost/1M"),d("th",null,"Tasks"),d("th",null,"Est. Cost")])],-1)),d("tbody",null,[(r(!0),i(u,null,c(Z.value,e=>(r(),i("tr",{key:e.id},[d("td",Ge,m(e.name),1),d("td",We,m(e.provider),1),d("td",Ke," $"+m(le(e.input_cost,e.provider)),1),d("td",Ye," $"+m(le(e.output_cost,e.provider)),1),d("td",Ze,m((X.variableCombinations.value?X.variableCombinations.value*I.parameters.repetitions_per_prompt:0).toLocaleString()),1),d("td",He," $"+m(se(e)),1)]))),128))])])])):(r(),i("div",Xe,t[46]||(t[46]=[d("span",null,"No models selected",-1)])))]),d("div",et,[d("div",tt,[d("div",at,[t[47]||(t[47]=d("span",{class:"total-label"},"Variable Combinations:",-1)),d("span",nt,m(f(X).variableCombinations.value?.toLocaleString()||"0"),1)]),d("div",ot,[t[48]||(t[48]=d("span",{class:"total-label"},"Models:",-1)),d("span",st,m(f(I).models.length),1)]),d("div",lt,[t[49]||(t[49]=d("span",{class:"total-label"},"Repetitions:",-1)),d("span",it,m(f(I).parameters.repetitions_per_prompt),1)]),t[52]||(t[52]=d("div",{class:"divider"},null,-1)),d("div",rt,[t[50]||(t[50]=d("span",{class:"total-label"},"Total Tasks:",-1)),d("span",ut,m(f(X).taskCount.value?.toLocaleString()||"0"),1)]),d("div",ct,[t[51]||(t[51]=d("span",{class:"total-label"},"Total Cost:",-1)),d("span",dt,"$"+m(f(X).estimatedCost.value?.toFixed(4)||"0.0000"),1)])])])])],512),d("div",pt,[d("div",mt,[f(U).validationMessages.value.length>0?(r(),i("div",vt,m(f(U).validationMessages.value[0]),1)):p("",!0)]),d("div",gt,[d("button",{class:"btn btn-secondary",onClick:t[19]||(t[19]=t=>e.$emit("close"))}," Cancel "),d("button",{class:"btn btn-primary",disabled:!f(U).isValid.value||f(X).isCalculating.value,onClick:re},m(l.run?"Update Run":"python_export"===I.executionType?"Export Python Package":"Create Run"),9,bt)])])])]))}}),[["__scopeId","data-v-b88c1d33"]]),yt=l({__name:"RunEditorModal",props:{run:{},preselectedModelIds:{},preselectedDesignId:{}},emits:["close","saved"],setup:e=>(e,t)=>(r(),w(ht,{run:e.run,"preselected-model-ids":e.preselectedModelIds,"preselected-design-id":e.preselectedDesignId,onClose:t[0]||(t[0]=t=>e.$emit("close")),onSaved:t[1]||(t[1]=t=>e.$emit("saved",t))},null,8,["run","preselected-model-ids","preselected-design-id"]))}),ft={class:"runs-view"},_t={class:"header"},Ct={key:0,class:"loading"},kt={key:1,class:"empty-state"},xt={key:2,class:"runs-container"},wt={class:"sort-controls"},St={class:"runs-table"},Et={class:"run-main"},Ot={class:"run-info"},Mt={class:"run-header"},Rt={class:"run-name"},Pt={class:"run-meta"},Tt={key:0},It={key:1},Dt={class:"run-actions"},Vt=["onClick"],$t=["onClick"],Ft=["onClick"],Lt=["onClick"],Bt=["onClick"],Ut=["onClick"],jt=I(l({__name:"RunsView",setup(e){const t=S(),a=E(),o=R(),{runs:l,loading:v}=O(o),y=n(!1),C=n(null),k=n("updated_at"),x=n("desc"),P=s(()=>[...l.value].sort((e,t)=>{let a,n;switch(k.value){case"name":a=e.name.toLowerCase(),n=t.name.toLowerCase();break;case"created_at":a=new Date(e.created_at||0).getTime(),n=new Date(t.created_at||0).getTime();break;case"updated_at":a=new Date(e.updated_at||e.created_at||0).getTime(),n=new Date(t.updated_at||t.created_at||0).getTime();break;case"status":const o={pending:0,running:1,completed:2,failed:3};a=o[e.status]??999,n=o[t.status]??999;break;default:return 0}return a<n?"asc"===x.value?-1:1:a>n?"asc"===x.value?1:-1:0})),T=s(()=>{const e=a.query.create;return e?parseInt(e):null});async function I(e){if(C.value)await o.updateRun(C.value.id,e);else{const a=await o.createRun(e);await o.startRun(a.id),t.push("/active")}D()}function D(){y.value=!1,C.value=null,a.query.create&&("designs"===a.query.from?t.push({name:"designs"}):t.replace({name:"runs"}))}function V(){}function $(){x.value="asc"===x.value?"desc":"asc"}function F(e){return e?new Date(e).toLocaleDateString():"N/A"}return b(()=>{o.loadRuns(),T.value&&(y.value=!0)}),(e,a)=>(r(),i("div",ft,[d("div",_t,[a[3]||(a[3]=d("h2",null,"Runs",-1)),d("button",{class:"btn btn-primary",onClick:a[0]||(a[0]=e=>y.value=!0)}," Create Run ")]),f(v)?(r(),i("div",Ct," Loading runs... ")):0===f(l).length?(r(),i("div",kt,[a[4]||(a[4]=d("p",null,"No runs created yet",-1)),d("button",{class:"btn btn-primary",onClick:a[1]||(a[1]=e=>y.value=!0)}," Create your first run ")])):(r(),i("div",xt,[d("div",wt,[a[6]||(a[6]=d("label",null,"Sort by:",-1)),h(d("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>k.value=e),onChange:V},a[5]||(a[5]=[d("option",{value:"updated_at"}," Last Updated ",-1),d("option",{value:"name"}," Name ",-1),d("option",{value:"created_at"}," Created Date ",-1),d("option",{value:"status"}," Status ",-1)]),544),[[_,k.value]]),d("button",{class:"sort-toggle",onClick:$},m("desc"===x.value?"â†“":"â†‘"),1)]),d("div",St,[(r(!0),i(u,null,c(P.value,e=>(r(),i("div",{key:e.id,class:"run-row"},[d("div",Et,[d("div",Ot,[d("div",Mt,[d("h3",Rt,m(e.name),1),d("span",{class:g(["run-status",`status-${e.status}`])},m(e.status),3)]),d("p",Pt,[M(m(e.total_tasks||0)+" tasks ("+m(e.completed_tasks||0)+" processed",1),e.error_count?(r(),i("span",Tt,", "+m(e.error_count)+" errors",1)):p("",!0),M(") â€¢ Created "+m(F(e.created_at))+" ",1),e.updated_at&&e.updated_at!==e.created_at?(r(),i("span",It," â€¢ Updated "+m(F(e.updated_at)),1)):p("",!0)])]),d("div",Dt,["pending"===e.status?(r(),i("button",{key:0,class:"btn btn-primary btn-small",onClick:a=>async function(e){await o.startRun(e.id),t.push("/active")}(e)}," Start ",8,Vt)):p("",!0),"running"===e.status?(r(),i("button",{key:1,class:"btn btn-danger btn-small",onClick:t=>async function(e){await o.stopRun(e.id)}(e)}," Stop ",8,$t)):p("",!0),d("button",{class:"btn btn-secondary btn-small",onClick:a=>function(e){t.push(`/results/${e.id}`)}(e)}," Results ",8,Ft),d("button",{class:"btn btn-secondary btn-small",onClick:t=>async function(e){const{id:t,created_at:a,updated_at:n,total_tasks:o,completed_tasks:s,error_count:l,started_at:i,completed_at:r,...u}=e,c={...u,status:"pending",name:`${e.name} (Copy)`,total_tasks:0,completed_tasks:0,error_count:0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};C.value=c}(e)}," New Run ",8,Lt),d("button",{class:"btn btn-secondary btn-small",onClick:t=>function(e){const t={version:"1.0",exportDate:(new Date).toISOString(),run:e},a=JSON.stringify(t,null,2),n=new Blob([a],{type:"application/json"}),o=URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.download=`run_${e.name.replace(/[^a-zA-Z0-9]/g,"_")}_${(new Date).toISOString().split("T")[0]}.json`,s.click(),URL.revokeObjectURL(o)}(e)}," Export ",8,Bt),d("button",{class:"btn btn-danger btn-small",onClick:t=>async function(e){confirm(`Delete run "${e.name}"? This action cannot be undone.`)&&await o.deleteRun(e.id)}(e)}," Delete ",8,Ut)])])]))),128))])])),y.value||C.value?(r(),w(yt,{key:3,run:C.value||void 0,"preselected-design-id":T.value||void 0,onSaved:I,onClose:D},null,8,["run","preselected-design-id"])):p("",!0)]))}}),[["__scopeId","data-v-e2789d13"]]);export{jt as default};
