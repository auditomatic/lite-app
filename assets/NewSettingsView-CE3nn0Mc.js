import{d as e,r as a,i as t,o as s,b as l,e as o,p as n,f as r,F as i,Q as c,S as d,V as u,A as v,t as p,w as m,m as g,a1 as h,g as f,n as b,L as y,j as k,_ as w,a2 as _,k as C}from"./vendor-w2iEWTO6.js";import{u as A,f as O,d as S,_ as L}from"./index-Be1jm3CD.js";import"./db-BfRGDvSu.js";function E(e){return{id:e.id,name:e.name,provider:"openrouter",enabled:!1,max_input_tokens:e.context_length,max_output_tokens:e.top_provider.max_completion_tokens,context_window:e.context_length,input_cost:parseFloat(e.pricing.prompt)||0,output_cost:parseFloat(e.pricing.completion)||0,supports_function_calling:!1,supports_json_mode:!1,supports_streaming:!0,supported_modalities:[e.architecture.modality]}}const x={class:"models-table-container"},R={key:0,class:"loading"},U={key:1,class:"empty-state"},I={class:"controls-section"},T={class:"search-controls"},D={class:"form-group"},$={class:"form-group"},j={class:"form-group"},M=["value"],P={class:"models-list"},F=["onClick"],N={class:"provider-info"},B={class:"collapse-toggle"},G={class:"model-count"},q=["value","onInput","onBlur"],J={class:"models-table-wrapper"},V={class:"models-table"},H=["checked","onChange"],K=L(e({__name:"ModelsTable",setup(e){const f=A();O();const b=a(""),y=a("name"),k=a(""),w=a({}),_=a(new Set),C=t(()=>f.isLoading),L=t(()=>{let e=Object.values(f.modelsByProvider).flat();if(b.value.trim()){const a=b.value.toLowerCase();e=e.filter(e=>e.id.toLowerCase().includes(a)||e.name.toLowerCase().includes(a))}k.value&&(e=e.filter(e=>e.provider===k.value)),e.sort((e,a)=>{switch(y.value){case"cost":return(e.input_cost||0)+(e.output_cost||0)-((a.input_cost||0)+(a.output_cost||0));case"context":return(a.max_input_tokens||0)-(e.max_input_tokens||0);default:return e.name.localeCompare(a.name)}});const a={};return e.forEach(e=>{a[e.provider]||(a[e.provider]=[]),a[e.provider].push(e)}),a}),E=t(()=>Object.keys(f.modelsByProvider));function K(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Q(e){return w.value[e]||6e4}async function z(e,a){const t=a.target,s=parseInt(t.value);if(isNaN(s)||s<5e3||s>3e5)t.value=Q(e).toString();else try{await S.providers.update(e,{timeout_ms:s}),w.value[e]=s,console.log(`Updated ${e} timeout to ${s}ms`)}catch(l){console.error("Failed to update provider timeout:",l),t.value=Q(e).toString()}}function W(e,a){const t="input"===a?e.input_cost:e.output_cost;if(!t)return"0";const s="openrouter"===e.provider?1e6*t:t;return s<.01?s.toFixed(4):s<1?s.toFixed(3):s<10?s.toFixed(2):s.toFixed(1)}function Y(e){const a=[];return e.supports_function_calling&&a.push("📞"),e.supports_json_mode&&a.push("📄"),e.supports_streaming&&a.push("🌊"),e.supported_modalities?.includes("image")&&a.push("👁️"),a.join(" ")||"-"}async function Z(){const e=Object.values(L.value).flat();for(const a of e)a.enabled||await f.toggleModel(a.id,!0)}async function X(){const e=Object.values(L.value).flat();for(const a of e)a.enabled&&await f.toggleModel(a.id,!1)}function ee(e){return _.value.has(e)}return s(async()=>{await f.loadModels(),await async function(){try{const e=await S.providers.toArray(),a={};e.forEach(e=>{a[e.id]=e.timeout_ms||6e4}),w.value=a}catch(e){console.warn("Failed to load provider timeouts:",e)}}(),(()=>{const e=Object.keys(f.modelsByProvider);_.value=new Set(e)})()}),(e,a)=>(o(),l("div",x,[C.value?(o(),l("div",R," Loading models... ")):0===Object.keys(n(f).modelsByProvider).length?(o(),l("div",U,a[4]||(a[4]=[r("p",null,"No models loaded yet. Import a model registry file or fetch OpenRouter models to get started.",-1)]))):(o(),l(i,{key:2},[r("div",I,[r("div",T,[r("div",D,[c(r("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>b.value=e),type:"text",placeholder:"Search models...",class:"search-input"},null,512),[[d,b.value]])]),r("div",$,[c(r("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>y.value=e),class:"sort-select"},a[5]||(a[5]=[r("option",{value:"name"}," Sort by Name ",-1),r("option",{value:"cost"}," Sort by Cost ",-1),r("option",{value:"context"}," Sort by Context Length ",-1)]),512),[[u,y.value]])]),r("div",j,[c(r("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>k.value=e),class:"filter-select"},[a[6]||(a[6]=r("option",{value:""}," All Providers ",-1)),(o(!0),l(i,null,v(E.value,e=>(o(),l("option",{key:e,value:e},p(K(e)),9,M))),128))],512),[[u,k.value]])])]),r("div",{class:"bulk-actions"},[r("button",{class:"btn btn-sm btn-secondary",onClick:Z}," Enable All Filtered "),r("button",{class:"btn btn-sm btn-secondary",onClick:X}," Disable All Filtered ")])]),r("div",P,[(o(!0),l(i,null,v(L.value,(e,t)=>(o(),l("div",{key:t,class:"provider-section"},[r("div",{class:"provider-header",onClick:e=>function(e){_.value.has(e)?_.value.delete(e):_.value.add(e),_.value=new Set(_.value)}(t)},[r("div",N,[r("button",B,p(ee(t)?"▶":"▼"),1),r("h3",null,p(K(t)),1),r("span",G,"("+p(e.length)+" models)",1)]),r("div",{class:"provider-config",onClick:a[3]||(a[3]=m(()=>{},["stop"]))},[r("label",null,[a[7]||(a[7]=g(" API Timeout: ")),r("input",{type:"number",value:Q(t),min:"5000",max:"300000",step:"1000",class:"timeout-input",onInput:e=>z(t,e),onBlur:e=>z(t,e)},null,40,q),a[8]||(a[8]=r("span",{class:"timeout-unit"},"ms",-1))])])],8,F),c(r("div",J,[r("table",V,[a[9]||(a[9]=r("thead",null,[r("tr",null,[r("th",null,"Enabled"),r("th",null,"Model"),r("th",null,"Context"),r("th",null,"Input Cost"),r("th",null,"Output Cost"),r("th",null,"Features")])],-1)),r("tbody",null,[(o(!0),l(i,null,v(e,e=>{return o(),l("tr",{key:e.id},[r("td",null,[r("input",{type:"checkbox",checked:e.enabled,onChange:a=>async function(e,a){const t=a.target.checked;await f.toggleModel(e,t)}(e.id,a)},null,40,H)]),r("td",null,p(e.name||e.id),1),r("td",null,p((a=e.max_input_tokens,a?a.toLocaleString():"-")),1),r("td",null,"$"+p(W(e,"input")),1),r("td",null,"$"+p(W(e,"output")),1),r("td",null,p(Y(e)),1)]);var a}),128))])])],512),[[h,!ee(t)]])]))),128))])],64))]))}}),[["__scopeId","data-v-f5329b4e"]]),Q={class:"database-management"},z={class:"management-grid"},W={class:"management-card"},Y={key:0,class:"integrity-status-card"},Z={key:0,class:"issues-list"},X=["disabled"],ee={class:"management-card"},ae={class:"cleanup-stats"},te={key:0,class:"stats-grid"},se={class:"stat-item"},le={class:"stat-value"},oe={class:"stat-item"},ne={class:"stat-value"},re={class:"cleanup-actions"},ie=["disabled"],ce=["disabled"],de={class:"management-card"},ue={class:"export-actions"},ve=["disabled"],pe=["disabled"],me={class:"management-card danger"},ge={class:"danger-actions"},he=["disabled"],fe=L(e({__name:"DatabaseManagement",setup(e){const n=a(null),c=a(null),d=a(!1),u=a(!1),m=a(!1),h=a(!1),y=a(!1),k=t(()=>c.value&&(c.value.orphanedTasks>0||c.value.orphanedRuns>0));async function w(){d.value=!0;try{const[e,a,t,s]=await Promise.all([S.designs.toArray(),S.runs.toArray(),S.tasks.toArray(),S.variable_lists.toArray()]),l=[],o=a.filter(a=>!e.some(e=>e.id===a.design_id));o.length>0&&l.push({type:"orphaned_runs",count:o.length});const r=t.filter(e=>!a.some(a=>a.id===e.run_id));r.length>0&&l.push({type:"orphaned_tasks",count:r.length}),n.value={valid:0===l.length,issues:l.length>0?l:void 0}}catch(e){console.error("Integrity validation failed:",e),n.value={valid:!1}}finally{d.value=!1}}async function _(){u.value=!0;try{const[e,a,t]=await Promise.all([S.designs.toArray(),S.runs.toArray(),S.tasks.toArray()]),s=a.filter(a=>!e.some(e=>e.id===a.design_id)).length,l=t.filter(e=>!a.some(a=>a.id===e.run_id)).length;c.value={orphanedRuns:s,orphanedTasks:l}}catch(e){console.error("Orphan scan failed:",e)}finally{u.value=!1}}async function C(){m.value=!0;try{const[e,a]=await Promise.all([S.designs.toArray(),S.runs.toArray()]),t=a.filter(a=>!e.some(e=>e.id===a.design_id)).map(e=>e.id).filter(e=>void 0!==e);t.length>0&&await S.runs.bulkDelete(t);const s=a.filter(a=>e.some(e=>e.id===a.design_id)).map(e=>e.id).filter(e=>void 0!==e),l=(await S.tasks.filter(e=>!s.includes(e.run_id)).toArray()).map(e=>e.id).filter(e=>void 0!==e);l.length>0&&await S.tasks.bulkDelete(l),console.log(`Cleaned up ${t.length} orphaned runs and ${l.length} orphaned tasks`),await _()}catch(e){console.error("Cleanup failed:",e)}finally{m.value=!1}}async function A(){h.value=!0;try{const[e,a,t,s,l]=await Promise.all([S.designs.toArray(),S.runs.toArray(),S.tasks.toArray(),S.variable_lists.toArray(),S.models.toArray()]),o={metadata:{exported_at:(new Date).toISOString(),version:"2.0.0",type:"full_database_backup"},data:{designs:e,runs:a,tasks:t,variableLists:s,models:l}},n=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),r=URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download=`auditomatic-backup-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}catch(e){console.error("Export failed:",e)}finally{h.value=!1}}async function O(){h.value=!0;try{const[e,a]=await Promise.all([S.designs.toArray(),S.variable_lists.toArray()]),t={metadata:{exported_at:(new Date).toISOString(),version:"2.0.0",type:"designs_export"},data:{designs:e,variableLists:a}},s=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),l=URL.createObjectURL(s),o=document.createElement("a");o.href=l,o.download=`auditomatic-designs-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)}catch(e){console.error("Export failed:",e)}finally{h.value=!1}}async function L(){if(!confirm("This will permanently delete ALL data including designs, runs, tasks, variable lists, models, API keys, and settings. This will reset the app to a fresh state. This cannot be undone. Are you sure?"))return;if(confirm("Are you absolutely sure? This will delete everything including API keys and models, and cannot be recovered.")){y.value=!0;try{await Promise.all([S.tasks.clear(),S.runs.clear(),S.designs.clear(),S.variable_lists.clear(),S.models.clear(),S.providers.clear(),S.api_keys.clear(),S.settings.clear(),S.research_logs.clear()]),console.log("All data cleared - app reset to fresh state"),c.value={orphanedTasks:0,orphanedRuns:0},n.value={valid:!0},window.location.reload()}catch(e){console.error("Clear data failed:",e)}finally{y.value=!1}}}return s(()=>{_()}),(e,a)=>(o(),l("div",Q,[r("div",z,[r("div",W,[a[0]||(a[0]=r("h3",null,"Database Health",-1)),n.value?(o(),l("div",Y,[r("div",{class:b(["status-indicator",n.value.valid?"valid":"invalid"])},p(n.value.valid?"✅ Healthy":"⚠️ Issues Found"),3),!n.value.valid&&n.value.issues?(o(),l("div",Z,[(o(!0),l(i,null,v(n.value.issues,e=>(o(),l("div",{key:e.type,class:"issue-item"},[r("strong",null,p(e.count),1),g(" "+p(e.type.replace("_"," ")),1)]))),128))])):f("",!0)])):f("",!0),r("button",{class:"btn btn-secondary",disabled:d.value,onClick:w},p(d.value?"Checking...":"🔍 Check Integrity"),9,X)]),r("div",ee,[a[3]||(a[3]=r("h3",null,"Data Cleanup",-1)),a[4]||(a[4]=r("p",{class:"card-description"}," Remove orphaned tasks and runs that remain after deleting parent records. ",-1)),r("div",ae,[c.value?(o(),l("div",te,[r("div",se,[r("span",le,p(c.value.orphanedTasks),1),a[1]||(a[1]=r("span",{class:"stat-label"},"Orphaned Tasks",-1))]),r("div",oe,[r("span",ne,p(c.value.orphanedRuns),1),a[2]||(a[2]=r("span",{class:"stat-label"},"Orphaned Runs",-1))])])):f("",!0)]),r("div",re,[r("button",{class:"btn btn-secondary",disabled:u.value,onClick:_},p(u.value?"Scanning...":"🔍 Scan for Orphans"),9,ie),r("button",{class:"btn btn-warning",disabled:m.value||!k.value,onClick:C},p(m.value?"Cleaning...":"🧹 Clean Up Orphans"),9,ce)])]),r("div",de,[a[5]||(a[5]=r("h3",null,"Data Export",-1)),a[6]||(a[6]=r("p",{class:"card-description"}," Export your entire database for backup or migration purposes. ",-1)),r("div",ue,[r("button",{class:"btn btn-primary",disabled:h.value,onClick:A},p(h.value?"Exporting...":"📤 Export Full Database (all runs and results)"),9,ve),r("button",{class:"btn btn-secondary",disabled:h.value,onClick:O},p(h.value?"Exporting...":"📋 Export Designs and Variable Lists"),9,pe)])]),r("div",me,[a[7]||(a[7]=r("h3",null,"⚠️ Danger Zone",-1)),a[8]||(a[8]=r("p",{class:"card-description"}," Irreversible operations that will permanently delete data. ",-1)),r("div",ge,[r("button",{class:"btn btn-danger",disabled:y.value,onClick:L},p(y.value?"Clearing...":"🗑️ Clear All Data"),9,he)])])])]))}}),[["__scopeId","data-v-d8ecf284"]]),be={class:"database-browser"},ye={class:"browser-controls"},ke={class:"table-selector"},we=["value"],_e={class:"actions"},Ce=["disabled"],Ae=["disabled"],Oe=["disabled"],Se={key:0,class:"table-info"},Le={key:1,class:"loading"},Ee={key:2,class:"error"},xe={key:3,class:"data-table"},Re={class:"table-wrapper"},Ue={class:"actions-cell"},Ie=["onClick"],Te=["onClick"],De=["title"],$e={key:0,class:"pagination"},je=["disabled"],Me={class:"pagination-info"},Pe=["disabled"],Fe={class:"modal-content"},Ne={class:"modal-header"},Be={class:"modal-body"},Ge=L(e({__name:"DatabaseBrowser",setup(e){const n=a(""),d=a([]),g=a({}),h=a(!1),b=a(""),y=a(null),k=a(1),w=["designs","runs","tasks","variable_lists","models","providers","api_keys"],_=t(()=>{if(0===d.value.length)return[];const e=d.value[0];return Object.keys(e)}),C=t(()=>Math.ceil(d.value.length/50)),A=t(()=>{const e=50*(k.value-1),a=e+50;return d.value.slice(e,a)});async function O(){for(const a of w)try{const e=await S[a].count();g.value[a]=e}catch(e){console.warn(`Failed to count ${a}:`,e),g.value[a]=0}}async function L(){if(n.value){h.value=!0,b.value="",k.value=1;try{const e=await S[n.value].toArray();d.value=e}catch(e){console.error(`Failed to load ${n.value}:`,e),b.value=`Failed to load table data: ${e instanceof Error?e.message:"Unknown error"}`,d.value=[]}finally{h.value=!1}}else d.value=[]}async function E(){await L(),await O()}function x(){if(!n.value||0===d.value.length)return;const e={table:n.value,exported_at:(new Date).toISOString(),count:d.value.length,data:d.value},a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download=`${n.value}-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}async function R(){if(!n.value)return;if(confirm(`Are you sure you want to clear all data from the ${n.value} table? This cannot be undone.`))try{await S[n.value].clear(),await E()}catch(e){console.error(`Failed to clear ${n.value}:`,e),b.value=`Failed to clear table: ${e instanceof Error?e.message:"Unknown error"}`}}function U(e){if(null==e)return"";if("object"==typeof e)return JSON.stringify(e);const a=String(e);return a.length>100?a.substring(0,100)+"...":a}return s(async()=>{await O()}),(e,a)=>(o(),l("div",be,[r("div",ye,[r("div",ke,[a[6]||(a[6]=r("label",null,"Select Table:",-1)),c(r("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),onChange:L},[a[5]||(a[5]=r("option",{value:""}," -- Choose a table -- ",-1)),(o(),l(i,null,v(w,e=>r("option",{key:e,value:e},p(e)+" ("+p(g.value[e]||0)+" records) ",9,we)),64))],544),[[u,n.value]])]),r("div",_e,[r("button",{disabled:!n.value,class:"btn btn-secondary",onClick:E}," Refresh ",8,Ce),r("button",{disabled:!n.value||!d.value.length,class:"btn btn-secondary",onClick:x}," Export JSON ",8,Ae),r("button",{disabled:!n.value,class:"btn btn-danger",onClick:R}," Clear Table ",8,Oe)])]),n.value?(o(),l("div",Se,[r("h3",null,p(n.value)+" Table",1),r("p",null,p(d.value.length)+" records found",1)])):f("",!0),h.value?(o(),l("div",Le," Loading table data... ")):f("",!0),b.value?(o(),l("div",Ee,p(b.value),1)):f("",!0),d.value.length>0?(o(),l("div",xe,[r("div",Re,[r("table",null,[r("thead",null,[r("tr",null,[a[7]||(a[7]=r("th",null,"Actions",-1)),(o(!0),l(i,null,v(_.value,e=>(o(),l("th",{key:e},p(e),1))),128))])]),r("tbody",null,[(o(!0),l(i,null,v(A.value,(e,a)=>(o(),l("tr",{key:a},[r("td",Ue,[r("button",{class:"btn btn-sm btn-secondary",onClick:a=>{return t=e,void(y.value=t);var t}}," View ",8,Ie),r("button",{class:"btn btn-sm btn-danger",onClick:a=>async function(e){if(!n.value)return;if(confirm("Are you sure you want to delete this record? This cannot be undone."))try{const a=e.id;void 0!==a?(await S[n.value].delete(a),await E()):b.value="Cannot delete record: no ID found"}catch(a){console.error("Failed to delete record:",a),b.value=`Failed to delete record: ${a instanceof Error?a.message:"Unknown error"}`}}(e)}," Delete ",8,Te)]),(o(!0),l(i,null,v(_.value,a=>(o(),l("td",{key:a,class:"data-cell"},[r("div",{class:"cell-content",title:U(e[a])},p(U(e[a])),9,De)]))),128))]))),128))])])]),C.value>1?(o(),l("div",$e,[r("button",{disabled:1===k.value,class:"btn btn-sm btn-secondary",onClick:a[1]||(a[1]=e=>k.value=Math.max(1,k.value-1))}," Previous ",8,je),r("span",Me," Page "+p(k.value)+" of "+p(C.value)+" ("+p(d.value.length)+" total records) ",1),r("button",{disabled:k.value===C.value,class:"btn btn-sm btn-secondary",onClick:a[2]||(a[2]=e=>k.value=Math.min(C.value,k.value+1))}," Next ",8,Pe)])):f("",!0)])):f("",!0),y.value?(o(),l("div",{key:4,class:"modal-overlay",onClick:a[4]||(a[4]=m(e=>y.value=null,["self"]))},[r("div",Fe,[r("div",Ne,[a[8]||(a[8]=r("h3",null,"Record Details",-1)),r("button",{class:"close-btn",onClick:a[3]||(a[3]=e=>y.value=null)}," × ")]),r("div",Be,[r("pre",null,p(JSON.stringify(y.value,null,2)),1)])])])):f("",!0)]))}}),[["__scopeId","data-v-331f3d07"]]),qe={class:"research-quality-dashboard"},Je={class:"dashboard-header"},Ve=["disabled"],He={class:"metrics-grid"},Ke={class:"metric-content"},Qe={class:"metric-value"},ze={class:"metric-details"},We={class:"metric-content"},Ye={class:"metric-value"},Ze={class:"metric-details"},Xe={class:"metric-content"},ea={class:"metric-value"},aa={class:"metric-details"},ta={class:"metric-content"},sa={class:"metric-value"},la={class:"metric-details"},oa={class:"metric-content"},na={class:"metric-value"},ra={class:"metric-details"},ia={class:"metric-content"},ca={class:"metric-value"},da={class:"metric-details"},ua={class:"quality-summary"},va={class:"summary-header"},pa={class:"summary-content"},ma={class:"quality-bar"},ga={class:"quality-recommendations"},ha={key:0,class:"recent-issues"},fa={class:"issues-list"},ba={class:"issue-type"},ya={class:"issue-message"},ka={class:"issue-time"},wa=L(e({__name:"ResearchQualityDashboard",setup(e){const n=a(!1),c=a([]),d=a([]),u=a({completed:0,total:0,percentage:0,score:0}),m=a({logged:0,total:0,percentage:0,score:0}),g=a({successful:0,total:0,percentage:0,score:0}),h=a({totalCost:"0.00",avgCost:"0.00",score:100}),k=a({avg:0,min:0,max:0,score:100}),w=a({percentage:0,details:"",score:0}),_=a([]),C=t(()=>{const e=[u.value.score,m.value.score,g.value.score,h.value.score,k.value.score,w.value.score],a=e.reduce((e,a)=>e+a,0)/e.length;let t="Poor";return a>=90?t="Excellent":a>=75?t="Good":a>=60&&(t="Fair"),{score:Math.round(a),label:t}}),A=t(()=>{const e=[];return u.value.percentage<80&&e.push("Complete more tasks to improve data completeness"),m.value.percentage<100&&e.push("Ensure all tasks have API logging enabled for full transparency"),g.value.percentage<90&&e.push("Investigate failed tasks to improve success rate"),parseFloat(h.value.avgCost)>.1&&e.push("Consider using more cost-effective models"),k.value.avg>5e3&&e.push("Response times are high - consider optimizing prompts or using faster models"),0===e.length&&e.push("Great job! Your research quality metrics look excellent"),e});async function O(){n.value=!0;try{c.value=await S.runs.toArray(),d.value=await S.tasks.toArray();const e=d.value.filter(e=>"completed"===e.status).length;u.value={completed:e,total:d.value.length,percentage:d.value.length>0?Math.round(e/d.value.length*100):0,score:d.value.length>0?Math.round(e/d.value.length*100):0};const a=d.value.filter(e=>e.api_call_log).length;m.value={logged:a,total:d.value.length,percentage:d.value.length>0?Math.round(a/d.value.length*100):0,score:d.value.length>0?Math.round(a/d.value.length*100):0};const t=d.value.filter(e=>"completed"===e.status&&!e.error).length;g.value={successful:t,total:e,percentage:e>0?Math.round(t/e*100):0,score:e>0?Math.round(t/e*100):0};const s=d.value.filter(e=>e.api_call_log?.cost_estimate).reduce((e,a)=>e+(a.api_call_log?.cost_estimate.estimated_cost_usd||0),0),l=e>0?s/e:0;h.value={totalCost:s.toFixed(2),avgCost:l.toFixed(4),score:l<=.01?100:l<=.05?80:l<=.1?60:40};const o=d.value.filter(e=>e.response_time);if(o.length>0){const e=o.map(e=>e.response_time);k.value={avg:Math.round(e.reduce((e,a)=>e+a,0)/e.length),min:Math.min(...e),max:Math.max(...e),score:e.reduce((e,a)=>e+a,0)/e.length<=3e3?100:e.reduce((e,a)=>e+a,0)/e.length<=5e3?80:60}}const n=d.value.filter(e=>e.prompt&&e.variables&&e.model&&e.api_call_log).length;w.value={percentage:d.value.length>0?Math.round(n/d.value.length*100):0,score:d.value.length>0?Math.round(n/d.value.length*100):0,details:`${n}/${d.value.length} tasks fully reproducible`};const r=[];d.value.filter(e=>e.error&&e.created_at).sort((e,a)=>new Date(a.created_at).getTime()-new Date(e.created_at).getTime()).slice(0,3).forEach(e=>{r.push({id:`error-${e.id}`,type:"Error",message:e.error?.substring(0,100)+"..."||"Unknown error",timestamp:e.created_at})});d.value.filter(e=>"completed"===e.status&&!e.api_call_log&&e.created_at).slice(0,2).forEach(e=>{r.push({id:`missing-log-${e.id}`,type:"Missing Log",message:`Task ${e.id} completed without API logging`,timestamp:e.created_at})}),_.value=r}catch(e){console.error("Failed to refresh metrics:",e)}finally{n.value=!1}}function L(e){return e>=90?"metric-excellent":e>=75?"metric-good":e>=60?"metric-fair":"metric-poor"}function E(){const e=C.value.score;return e>=90?"quality-excellent":e>=75?"quality-good":e>=60?"quality-fair":"quality-poor"}function x(e){const a=new Date(e),t=(new Date).getTime()-a.getTime();return t<6e4?"just now":t<36e5?`${Math.floor(t/6e4)}m ago`:t<864e5?`${Math.floor(t/36e5)}h ago`:a.toLocaleDateString()}return s(()=>{O()}),(e,a)=>(o(),l("div",qe,[r("div",Je,[a[0]||(a[0]=r("h3",null,"🔬 Research Quality Metrics",-1)),r("button",{class:"refresh-btn",disabled:n.value,onClick:O},p(n.value?"Updating...":"🔄 Refresh"),9,Ve)]),r("div",He,[r("div",{class:b(["metric-card",L(u.value.score)])},[a[2]||(a[2]=r("div",{class:"metric-icon"}," 📊 ",-1)),r("div",Ke,[r("div",Qe,p(u.value.percentage)+"% ",1),a[1]||(a[1]=r("div",{class:"metric-label"}," Data Completeness ",-1)),r("div",ze,[r("span",null,p(u.value.completed)+"/"+p(u.value.total)+" tasks completed",1)])])],2),r("div",{class:b(["metric-card",L(m.value.score)])},[a[4]||(a[4]=r("div",{class:"metric-icon"}," 🔍 ",-1)),r("div",We,[r("div",Ye,p(m.value.percentage)+"% ",1),a[3]||(a[3]=r("div",{class:"metric-label"}," API Transparency ",-1)),r("div",Ze,[r("span",null,p(m.value.logged)+"/"+p(m.value.total)+" with logs",1)])])],2),r("div",{class:b(["metric-card",L(g.value.score)])},[a[6]||(a[6]=r("div",{class:"metric-icon"}," ✅ ",-1)),r("div",Xe,[r("div",ea,p(g.value.percentage)+"% ",1),a[5]||(a[5]=r("div",{class:"metric-label"}," Success Rate ",-1)),r("div",aa,[r("span",null,p(g.value.successful)+"/"+p(g.value.total)+" successful",1)])])],2),r("div",{class:b(["metric-card",L(h.value.score)])},[a[8]||(a[8]=r("div",{class:"metric-icon"}," 💰 ",-1)),r("div",ta,[r("div",sa," $"+p(h.value.avgCost),1),a[7]||(a[7]=r("div",{class:"metric-label"}," Avg Cost/Task ",-1)),r("div",la,[r("span",null,"Total: $"+p(h.value.totalCost),1)])])],2),r("div",{class:b(["metric-card",L(k.value.score)])},[a[10]||(a[10]=r("div",{class:"metric-icon"}," ⚡ ",-1)),r("div",oa,[r("div",na,p(k.value.avg)+"ms ",1),a[9]||(a[9]=r("div",{class:"metric-label"}," Avg Response Time ",-1)),r("div",ra,[r("span",null,p(k.value.min)+"ms - "+p(k.value.max)+"ms",1)])])],2),r("div",{class:b(["metric-card",L(w.value.score)])},[a[12]||(a[12]=r("div",{class:"metric-icon"}," 🔄 ",-1)),r("div",ia,[r("div",ca,p(w.value.percentage)+"% ",1),a[11]||(a[11]=r("div",{class:"metric-label"}," Reproducibility ",-1)),r("div",da,[r("span",null,p(w.value.details),1)])])],2)]),r("div",ua,[r("div",va,[a[13]||(a[13]=r("h4",null,"Overall Research Quality",-1)),r("div",{class:b(["quality-score",E()])},p(C.value.label),3)]),r("div",pa,[r("div",ma,[r("div",{class:b(["quality-fill",E()]),style:y({width:`${C.value.score}%`})},null,6)]),r("div",ga,[a[14]||(a[14]=r("h5",null,"Recommendations:",-1)),r("ul",null,[(o(!0),l(i,null,v(A.value,(e,a)=>(o(),l("li",{key:a},p(e),1))),128))])])])]),_.value.length>0?(o(),l("div",ha,[a[15]||(a[15]=r("h4",null,"⚠️ Recent Issues",-1)),r("div",fa,[(o(!0),l(i,null,v(_.value,e=>(o(),l("div",{key:e.id,class:"issue-item"},[r("span",ba,p(e.type),1),r("span",ya,p(e.message),1),r("span",ka,p(x(e.timestamp)),1)]))),128))])])):f("",!0)]))}}),[["__scopeId","data-v-cdbe9ea4"]]),_a={class:"debug-tools"},Ca={class:"tools-grid"},Aa={class:"tool-card"},Oa={class:"system-info"},Sa={class:"info-item"},La={class:"value"},Ea={class:"info-item"},xa=["title"],Ra={class:"info-item"},Ua={class:"value"},Ia={class:"info-item"},Ta={class:"value"},Da={class:"info-item"},$a={class:"value"},ja={class:"tool-card"},Ma={class:"performance-info"},Pa={class:"info-item"},Fa={class:"value"},Na={class:"info-item"},Ba={class:"value"},Ga={class:"info-item"},qa={class:"value"},Ja={class:"info-item"},Va={class:"value"},Ha={class:"tool-card"},Ka={class:"console-section"},Qa={class:"console-controls"},za={class:"log-level-filter"},Wa={class:"log-level-filter"},Ya={class:"log-level-filter"},Za={ref:"consoleOutput",class:"console-output"},Xa={class:"log-timestamp"},et={class:"log-level"},at={class:"log-message"},tt={class:"tool-card"},st={class:"network-tools"},lt={class:"test-section"},ot={class:"test-results"},nt={class:"test-name"},rt=["onClick"],it=L(e({__name:"DebugTools",setup(e){const n=O(),d=A(),u=a([]),m=a(!0),h=a(!0),f=a(!1),y=a({browser:"",userAgent:"",screen:"",localStorage:"",indexedDB:""}),_=a({memory:"",connection:"",online:!1,loadTime:""}),C=a([{name:"OpenAI API",url:"https://api.openai.com/v1/models",status:"pending",message:"Not tested"},{name:"Anthropic API",url:"https://api.anthropic.com/v1/models",status:"pending",message:"Not tested"},{name:"OpenRouter API",url:"https://openrouter.ai/api/v1/models",status:"pending",message:"Not tested"},{name:"Ollama Local",url:"http://localhost:11434/api/tags",status:"pending",message:"Not tested"}]),L=t(()=>u.value.filter(e=>!("error"===e.level&&!m.value)&&(!("warn"===e.level&&!h.value)&&!("info"===e.level&&!f.value))).slice(-100));let E={};function x(e,a){u.value.push({timestamp:new Date,level:e,message:a}),u.value.length>1e3&&(u.value=u.value.slice(-1e3))}function R(){u.value=[]}function U(){const e={exported_at:(new Date).toISOString(),logs:u.value},a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download=`auditomatic-logs-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}async function I(){const e={settings:await n.loadSettings(),models:d.models,timestamp:(new Date).toISOString()};console.log("Store State Dump:",e);const a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download=`store-state-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}async function T(){try{console.log("Testing database connectivity...");const e=[{name:"designs",table:S.designs},{name:"runs",table:S.runs},{name:"tasks",table:S.tasks},{name:"variable_lists",table:S.variable_lists},{name:"models",table:S.models}];for(const{name:a,table:t}of e){const e=await t.count();console.log(`${a} table: ${e} records`)}console.log("✅ Database test completed successfully")}catch(e){console.error("❌ Database test failed:",e)}}async function D(){console.log("Generating test data...");try{console.log("Test data generation not implemented yet")}catch(e){console.error("Failed to generate test data:",e)}}function $(){throw console.error("This is a simulated error for testing purposes"),new Error("Simulated error for debugging")}return s(()=>{y.value={browser:navigator.userAgent.includes("Chrome")?"Chrome":navigator.userAgent.includes("Firefox")?"Firefox":navigator.userAgent.includes("Safari")?"Safari":"Unknown",userAgent:navigator.userAgent,screen:`${screen.width}x${screen.height}`,localStorage:"undefined"!=typeof Storage?"✅ Supported":"❌ Not supported",indexedDB:"undefined"!=typeof indexedDB?"✅ Supported":"❌ Not supported"},function(){const e=performance.timing;_.value={memory:performance.memory?`${Math.round(performance.memory.usedJSHeapSize/1024/1024)}MB used`:"Not available",connection:navigator.connection?`${navigator.connection.effectiveType} (${navigator.connection.downlink}Mbps)`:"Not available",online:navigator.onLine,loadTime:e.loadEventEnd>0?e.loadEventEnd-e.navigationStart+"ms":"Not available"}}(),E={log:console.log,warn:console.warn,error:console.error},console.log=(...e)=>{x("info",e.join(" ")),E.log(...e)},console.warn=(...e)=>{x("warn",e.join(" ")),E.warn(...e)},console.error=(...e)=>{x("error",e.join(" ")),E.error(...e)}}),k(()=>{E.log&&(console.log=E.log,console.warn=E.warn,console.error=E.error)}),(e,a)=>{return o(),l("div",_a,[r("div",Ca,[r("div",Aa,[a[8]||(a[8]=r("h3",null,"System Information",-1)),r("div",Oa,[r("div",Sa,[a[3]||(a[3]=r("span",{class:"label"},"Browser:",-1)),r("span",La,p(y.value.browser),1)]),r("div",Ea,[a[4]||(a[4]=r("span",{class:"label"},"User Agent:",-1)),r("span",{class:"value",title:y.value.userAgent},p((t=y.value.userAgent,s=50,t.length>s?t.substring(0,s)+"...":t)),9,xa)]),r("div",Ra,[a[5]||(a[5]=r("span",{class:"label"},"Screen Resolution:",-1)),r("span",Ua,p(y.value.screen),1)]),r("div",Ia,[a[6]||(a[6]=r("span",{class:"label"},"Local Storage:",-1)),r("span",Ta,p(y.value.localStorage),1)]),r("div",Da,[a[7]||(a[7]=r("span",{class:"label"},"IndexedDB:",-1)),r("span",$a,p(y.value.indexedDB),1)])])]),r("div",ja,[a[13]||(a[13]=r("h3",null,"Performance Metrics",-1)),r("div",Ma,[r("div",Pa,[a[9]||(a[9]=r("span",{class:"label"},"Memory Usage:",-1)),r("span",Fa,p(_.value.memory),1)]),r("div",Na,[a[10]||(a[10]=r("span",{class:"label"},"Connection:",-1)),r("span",Ba,p(_.value.connection),1)]),r("div",Ga,[a[11]||(a[11]=r("span",{class:"label"},"Online Status:",-1)),r("span",qa,p(_.value.online?"🟢 Online":"🔴 Offline"),1)]),r("div",Ja,[a[12]||(a[12]=r("span",{class:"label"},"Page Load Time:",-1)),r("span",Va,p(_.value.loadTime),1)])])]),r("div",Ha,[a[17]||(a[17]=r("h3",null,"Console Log",-1)),r("div",Ka,[r("div",Qa,[r("button",{class:"btn btn-sm btn-secondary",onClick:R}," Clear Logs "),r("button",{class:"btn btn-sm btn-secondary",onClick:U}," Export Logs "),r("label",za,[c(r("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),type:"checkbox"},null,512),[[w,m.value]]),a[14]||(a[14]=g(" Errors "))]),r("label",Wa,[c(r("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>h.value=e),type:"checkbox"},null,512),[[w,h.value]]),a[15]||(a[15]=g(" Warnings "))]),r("label",Ya,[c(r("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>f.value=e),type:"checkbox"},null,512),[[w,f.value]]),a[16]||(a[16]=g(" Info "))])]),r("div",Za,[(o(!0),l(i,null,v(L.value,(e,a)=>{return o(),l("div",{key:a,class:b(["log-entry",`log-${e.level}`])},[r("span",Xa,p((t=e.timestamp,t.toLocaleTimeString())),1),r("span",et,p(e.level.toUpperCase()),1),r("span",at,p(e.message),1)],2);var t}),128))],512)])]),r("div",tt,[a[19]||(a[19]=r("h3",null,"Network Testing",-1)),r("div",st,[r("div",lt,[a[18]||(a[18]=r("h4",null,"API Connectivity",-1)),r("div",ot,[(o(!0),l(i,null,v(C.value,e=>(o(),l("div",{key:e.name,class:"test-result"},[r("span",nt,p(e.name)+":",1),r("span",{class:b(["test-status",e.status])},p(e.message),3),r("button",{class:"btn btn-xs btn-secondary",onClick:a=>async function(e,a){const t=C.value.find(e=>e.name===a);if(t){t.status="pending",t.message="Testing...";try{const a=new AbortController,s=setTimeout(()=>a.abort(),5e3),l=await fetch(e,{method:"HEAD",signal:a.signal,referrerPolicy:"no-referrer"});clearTimeout(s),l.ok?(t.status="success",t.message=`✅ Connected (${l.status})`):(t.status="error",t.message=`❌ Error ${l.status}`)}catch(s){t.status="error",s instanceof Error?"AbortError"===s.name?t.message="❌ Timeout":t.message=`❌ ${s.message}`:t.message="❌ Unknown error"}}}(e.url,e.name)}," Test ",8,rt)]))),128))])])])]),r("div",{class:"tool-card"},[a[20]||(a[20]=r("h3",null,"Developer Tools",-1)),r("div",{class:"dev-tools"},[r("button",{class:"btn btn-secondary",onClick:I}," Dump Store State "),r("button",{class:"btn btn-secondary",onClick:T}," Test Database "),r("button",{class:"btn btn-secondary",onClick:D}," Generate Test Data "),r("button",{class:"btn btn-warning",onClick:$}," Simulate Error ")])])])]);var t,s}}}),[["__scopeId","data-v-a8eb6d52"]]),ct={class:"settings-view"},dt={class:"settings-nav"},ut={class:"settings-content"},vt={key:0,class:"settings-tab-content"},pt={class:"tab-section"},mt={class:"api-keys"},gt={class:"api-key-group"},ht={class:"key-header"},ft={class:"key-status"},bt={key:0,class:"status-indicator saved",title:"URL configured"},yt={key:1,class:"status-indicator missing",title:"Using default"},kt={class:"api-key-input"},wt={class:"key-header"},_t=["for"],Ct={class:"key-status"},At={key:0,class:"status-indicator saved",title:"API key is saved"},Ot={key:1,class:"status-indicator missing",title:"No API key configured"},St={class:"api-key-input"},Lt=["id","onUpdate:modelValue","type","placeholder","onChange"],Et=["title","onClick"],xt={key:0,class:"provider-description"},Rt={class:"tab-section"},Ut={class:"models-actions"},It=["disabled"],Tt={class:"models-container"},Dt={key:1,class:"settings-tab-content"},$t={class:"tab-section"},jt={class:"tab-section"},Mt={key:2,class:"settings-tab-content"},Pt={class:"tab-section"},Ft={class:"tab-section"},Nt={class:"modal-content"},Bt={class:"modal-header"},Gt={class:"modal-body"},qt={class:"import-options"},Jt={class:"form-group"},Vt={class:"form-group"},Ht={class:"modal-actions"},Kt=L(e({__name:"NewSettingsView",setup(e){const t=O(),n=A(),u=a("api-models"),g=a({}),h=a({}),y=a(""),k=a(!1),w=a(!1),L=a(!1),x=a(!1),R=a(""),U=[{id:"openai",name:"OpenAI",description:"Required for GPT models (gpt-4, gpt-3.5-turbo, etc.)"},{id:"anthropic",name:"Anthropic",description:"Required for Claude models (claude-3-sonnet, claude-3-haiku, etc.)"},{id:"openrouter",name:"OpenRouter",description:"Access to 100+ models through a single API"}];async function I(){const e=y.value.trim()||"http://localhost:11434";await t.saveOllamaUrl(e),console.log("Saved Ollama URL:",e)}async function T(e){try{if(!(await S.providers.get(e))){const t={id:e,name:(a=e,a.charAt(0).toUpperCase()+a.slice(1)),baseUrl:D(e),authType:"bearer",authHeader:"Authorization",authPrefix:"Bearer",endpoints:{},timeout_ms:6e4};await S.providers.add(t),console.log(`Created provider ${e} with default timeout`)}}catch(t){console.warn(`Failed to ensure provider ${e} exists:`,t)}var a}function D(e){switch(e){case"openai":return"https://api.openai.com/v1";case"anthropic":return"https://api.anthropic.com/v1";case"openrouter":return"https://openrouter.ai/api/v1";case"ollama":return"http://localhost:11434";default:return""}}async function $(){k.value=!0;try{console.log("Fetching Ollama models...")}finally{k.value=!1}}async function j(){if(console.log("[DEBUG] fetchOpenRouterModels FUNCTION STARTED"),w.value)console.log("[DEBUG] Already fetching, returning early");else{console.log("[DEBUG] Setting fetchingOpenRouter to true"),w.value=!0;try{console.log("[DEBUG] About to load settings");const e=await t.loadSettings();console.log("[DEBUG] Settings loaded:",e),console.log("[DEBUG] About to call fetchOR with API key:",e.openrouter_api_key?"HAS_KEY":"NO_KEY");const a=await async function(e){console.log("[OpenRouter] FUNCTION STARTED");const a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);console.log(`[OpenRouter] Browser: ${a?"Safari":"Other"} - ${navigator.userAgent}`);try{const t={"Content-Type":"application/json"};e&&(t.Authorization=`Bearer ${e}`),console.log("[OpenRouter] Starting fetch with headers:",t);const s={method:"GET",headers:t,mode:"cors",credentials:"omit"};a?(console.log("[OpenRouter] Applying Safari cache bypass"),s.cache="reload"):s.referrerPolicy="no-referrer";const l=await fetch("https://openrouter.ai/api/v1/models",s);if(console.log("[OpenRouter] Response:",{ok:l.ok,status:l.status,statusText:l.statusText,headers:Object.fromEntries(l.headers.entries())}),!l.ok)throw new Error(`OpenRouter API error: ${l.status} ${l.statusText}`);const o=await l.json();return console.log("[OpenRouter] Success: got",o.data?.length||0,"models"),o.data||[]}catch(t){if(console.error("[OpenRouter] DETAILED ERROR:",{error:t,name:t instanceof Error?t.name:"Unknown",message:t instanceof Error?t.message:"Unknown",stack:t instanceof Error?t.stack:void 0,safari:a,userAgent:navigator.userAgent,online:navigator.onLine,cookieEnabled:navigator.cookieEnabled,language:navigator.language,platform:navigator.platform,hardwareConcurrency:navigator.hardwareConcurrency,connection:navigator.connection?{effectiveType:navigator.connection.effectiveType,downlink:navigator.connection.downlink,rtt:navigator.connection.rtt}:"not available"}),a&&t instanceof TypeError&&t.message.includes("fetch"))throw new Error(`Safari fetch failed: Likely due to content blockers, privacy settings, or network issues. Original: ${t.message}`);throw t}}(e.openrouter_api_key);console.log("[DEBUG] fetchOR returned:",a.length,"models");const s=[];for(const t of a){await S.models.where("id").equals(t.id).first()||s.push(E(t))}if(s.length>0){const e=[...new Set(s.map(e=>e.provider))];for(const a of e)await T(a);await S.models.bulkAdd(s),alert(`Imported ${s.length} new OpenRouter models`),await n.loadModels()}else alert("No new OpenRouter models to import")}catch(e){console.error("[DEBUG] ERROR in fetchOpenRouterModels:",e),console.error("[DEBUG] Error name:",e instanceof Error?e.name:"Unknown"),console.error("[DEBUG] Error message:",e instanceof Error?e.message:"Unknown"),console.error("[DEBUG] Error stack:",e instanceof Error?e.stack:"No stack"),alert("Failed to fetch OpenRouter models: "+e.message)}finally{console.log("[DEBUG] Setting fetchingOpenRouter to false"),w.value=!1}}}async function M(){try{const e=n.models,a={};e.forEach(e=>{a[e.id]=e.enabled});const t={metadata:{exported_at:(new Date).toISOString(),total_models:e.length,enabled_count:e.filter(e=>e.enabled).length},model_config:a},s=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),l=URL.createObjectURL(s),o=document.createElement("a");o.href=l,o.download=`model-config-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)}catch(e){console.error("Failed to export model config:",e),alert("Failed to export model configuration")}}function P(e){const a=e.target.files?.[0];if(!a)return;const t=new FileReader;t.onload=e=>{R.value=e.target?.result},t.readAsText(a)}async function F(){if(R.value.trim())try{const e=JSON.parse(R.value),a=e.model_config||e;let t=0;for(const[s,l]of Object.entries(a))"boolean"==typeof l&&(await n.toggleModel(s,l),t++);alert(`Updated ${t} model configurations`),x.value=!1,R.value=""}catch(e){console.error("Import failed:",e),alert("Failed to parse JSON: "+(e instanceof Error?e.message:"Unknown error"))}else alert("Please provide JSON data")}return s(async()=>{await async function(){const e=await t.loadSettings();g.value={openai:e.openai_api_key||"",anthropic:e.anthropic_api_key||"",openrouter:e.openrouter_api_key||""},y.value=e.ollama_base_url||""}(),U.forEach(e=>{h.value[e.id]=!1})}),(e,a)=>(o(),l("div",ct,[a[28]||(a[28]=r("div",{class:"settings-header"},[r("h1",null,"Settings"),r("p",{class:"settings-description"}," Configure API keys, manage models, and maintain your database ")],-1)),r("nav",dt,[r("button",{class:b(["settings-tab",{active:"api-models"===u.value}]),onClick:a[0]||(a[0]=e=>u.value="api-models")}," 🔑 API & Models ",2),r("button",{class:b(["settings-tab",{active:"database"===u.value}]),onClick:a[1]||(a[1]=e=>u.value="database")}," 🗄️ Database ",2),r("button",{class:b(["settings-tab",{active:"advanced"===u.value}]),onClick:a[2]||(a[2]=e=>u.value="advanced")}," ⚙️ Advanced ",2)]),r("div",ut,["api-models"===u.value?(o(),l("div",vt,[r("div",pt,[a[12]||(a[12]=r("h2",null,"API Keys",-1)),a[13]||(a[13]=r("p",{class:"section-description"}," Configure API keys for different providers. Keys are stored locally in your browser. ",-1)),r("div",mt,[r("div",gt,[r("div",ht,[a[10]||(a[10]=r("label",{for:"ollama-url"},"Ollama Server URL",-1)),r("div",ft,[y.value?(o(),l("span",bt," ✓ Configured ")):(o(),l("span",yt," Default "))])]),r("div",kt,[c(r("input",{id:"ollama-url","onUpdate:modelValue":a[3]||(a[3]=e=>y.value=e),type:"text",placeholder:"http://localhost:11434",class:"secure-input",onChange:I},null,544),[[d,y.value]])]),a[11]||(a[11]=r("div",{class:"provider-description"}," Default: http://localhost:11434. Make sure to set OLLAMA_ORIGINS=* for browser access. ",-1))]),(o(),l(i,null,v(U,e=>r("div",{key:e.id,class:"api-key-group"},[r("div",wt,[r("label",{for:`api-key-${e.id}`},p(e.name)+" API Key ",9,_t),r("div",Ct,[g.value[e.id]?(o(),l("span",At," ✓ Saved ")):(o(),l("span",Ot," ⚠ Not configured "))])]),r("div",St,[c(r("input",{id:`api-key-${e.id}`,"onUpdate:modelValue":a=>g.value[e.id]=a,type:h.value[e.id]?"text":"password",placeholder:`Enter ${e.name} API key`,class:"secure-input",autocomplete:"off",spellcheck:"false",onChange:a=>async function(e){const a=g.value[e];a&&a.trim()?(await t.saveApiKey(e,a.trim()),console.log(`Saved ${e} API key`)):(await t.removeApiKey(e),console.log(`Removed ${e} API key`))}(e.id)},null,40,Lt),[[_,g.value[e.id]]]),r("button",{type:"button",class:"toggle-visibility",title:h.value[e.id]?"Hide key":"Show key",onClick:a=>{return t=e.id,void(h.value[t]=!h.value[t]);var t}},p(h.value[e.id]?"👁️":"🔒"),9,Et)]),e.description?(o(),l("div",xt,p(e.description),1)):f("",!0)])),64))])]),r("div",Rt,[a[14]||(a[14]=r("h2",null,"Model Registry",-1)),a[15]||(a[15]=r("p",{class:"section-description"}," Manage available models, configure providers, and control which models are enabled for experiments. ",-1)),r("div",Ut,[r("button",{class:"btn btn-secondary",disabled:k.value,onClick:$},p(k.value?"Fetching...":"Fetch Ollama Models"),9,It),r("button",{class:"btn btn-secondary",onClick:j},p(w.value?"Fetching...":"Fetch OpenRouter Models"),1),r("button",{class:"btn btn-secondary",onClick:a[4]||(a[4]=e=>async function(e=!1){if(L.value)return;L.value=!0;const a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);console.log(`[LiteLLM] Browser: ${a?"Safari":"Other"} - ${navigator.userAgent}`);try{e&&await S.models.clear(),console.log("[LiteLLM] Starting fetch...");const t={method:"GET",mode:"cors",credentials:"omit",headers:{Accept:"application/json"}};a?(console.log("[LiteLLM] Applying Safari cache bypass"),t.cache="reload"):t.referrerPolicy="no-referrer";const s=await fetch("https://raw.githubusercontent.com/BerriAI/litellm/refs/heads/main/model_prices_and_context_window.json",t);console.log("[LiteLLM] Response:",{ok:s.ok,status:s.status,statusText:s.statusText,headers:Object.fromEntries(s.headers.entries())});const l=await s.json();console.log("[LiteLLM] JSON parsed, entries:",Object.keys(l).length);const o={};for(const[e,a]of Object.entries(l)){if("sample_spec"===e||!a.litellm_provider)continue;const t=a;["openai","anthropic"].includes(t.litellm_provider)&&(e.startsWith("ft:")||"chat"===t.mode&&("openai"!==t.litellm_provider||e.startsWith("gpt-")||e.startsWith("o"))&&(o[e]=t))}const r={};for(const e of Object.keys(o)){const a=e.replace(/-\d{4}-\d{2}-\d{2}$/,"");r[a]||(r[a]=[]),r[a].push(e)}const i=[];for(const[e,a]of Object.entries(r)){const e=a.filter(e=>/-\d{4}-\d{2}-\d{2}$/.test(e)),t=a.filter(e=>!/-\d{4}-\d{2}-\d{2}$/.test(e));if(e.length>0){const a=e.sort().reverse();i.push(a[0])}else i.push(...t)}const c=[];for(const a of i){if(!e&&await S.models.where("id").equals(a).first())continue;const t=o[a];c.push({id:a,name:a,provider:t.litellm_provider,enabled:!0,max_input_tokens:t.max_input_tokens||t.max_tokens||void 0,max_output_tokens:t.max_output_tokens||void 0,context_window:t.max_input_tokens||t.max_tokens||void 0,input_cost:1e6*(t.input_cost_per_token||0),output_cost:1e6*(t.output_cost_per_token||0),supports_function_calling:t.supports_function_calling||!1,supports_json_mode:t.supports_json_mode||!1,supports_streaming:!1!==t.supports_streaming,supported_modalities:t.supports_vision?["text","image"]:["text"]})}if(c.length>0){const a=[...new Set(c.map(e=>e.provider))];for(const e of a)await T(e);await S.models.bulkAdd(c),alert(`${e?"Replaced all models with":"Imported"} ${c.length} OpenAI and Anthropic chat models from LiteLLM`),await n.loadModels()}else e?alert("No OpenAI or Anthropic chat models found in LiteLLM"):alert("No new OpenAI or Anthropic chat models to import from LiteLLM")}catch(t){console.error("[LiteLLM] DETAILED ERROR:",{error:t,name:t instanceof Error?t.name:"Unknown",message:t instanceof Error?t.message:"Unknown",stack:t instanceof Error?t.stack:void 0,safari:a,userAgent:navigator.userAgent,online:navigator.onLine,cookieEnabled:navigator.cookieEnabled,language:navigator.language,platform:navigator.platform,hardwareConcurrency:navigator.hardwareConcurrency,connection:navigator.connection?{effectiveType:navigator.connection.effectiveType,downlink:navigator.connection.downlink,rtt:navigator.connection.rtt}:"not available"});let e=t.message;a&&t instanceof TypeError&&t.message.includes("fetch")&&(e=`Safari fetch failed: Likely due to content blockers, privacy settings, or network issues. Original: ${t.message}`),alert("Failed to fetch LiteLLM models: "+e)}finally{L.value=!1}}(!1))},p(L.value?"Fetching...":"Fetch OpenAI & Anthropic Pricing (from LiteLLM GitHub repo)"),1),r("button",{class:"btn btn-primary",onClick:M}," 📤 Export Config "),r("button",{class:"btn btn-primary",onClick:a[5]||(a[5]=e=>x.value=!0)}," 📥 Import Config ")]),r("div",Tt,[C(K)])])])):f("",!0),"database"===u.value?(o(),l("div",Dt,[r("div",$t,[a[16]||(a[16]=r("h2",null,"Database Management",-1)),a[17]||(a[17]=r("p",{class:"section-description"}," Monitor database health, clean up orphaned records, and manage data integrity. ",-1)),C(fe)]),r("div",jt,[a[18]||(a[18]=r("h2",null,"Database Browser",-1)),a[19]||(a[19]=r("p",{class:"section-description"}," Browse raw database tables, export data, and inspect records directly. ",-1)),C(Ge)])])):f("",!0),"advanced"===u.value?(o(),l("div",Mt,[r("div",Pt,[a[20]||(a[20]=r("h2",null,"Research Quality Metrics",-1)),a[21]||(a[21]=r("p",{class:"section-description"}," Monitor system performance and research data quality metrics. ",-1)),C(wa)]),r("div",Ft,[a[22]||(a[22]=r("h2",null,"System Debug",-1)),a[23]||(a[23]=r("p",{class:"section-description"}," Advanced debugging tools and system information. ",-1)),C(it)])])):f("",!0)]),x.value?(o(),l("div",{key:0,class:"modal-overlay",onClick:a[9]||(a[9]=m(e=>x.value=!1,["self"]))},[r("div",Nt,[r("div",Bt,[a[24]||(a[24]=r("h3",null,"Import Model Configuration",-1)),r("button",{class:"close-btn",onClick:a[6]||(a[6]=e=>x.value=!1)}," × ")]),r("div",Gt,[a[27]||(a[27]=r("p",null,"Upload a JSON file containing your model enable/disable configuration:",-1)),r("div",qt,[r("div",Jt,[a[25]||(a[25]=r("label",{for:"config-file"},"Upload File:",-1)),r("input",{id:"config-file",type:"file",accept:".json",onChange:P},null,32)]),r("div",Vt,[a[26]||(a[26]=r("label",{for:"config-json"},"Or Paste JSON:",-1)),c(r("textarea",{id:"config-json","onUpdate:modelValue":a[7]||(a[7]=e=>R.value=e),rows:"10",placeholder:'{"openai:gpt-4": true, "anthropic:claude-3-sonnet": false, ...}'},null,512),[[d,R.value]])])]),r("div",Ht,[r("button",{class:"btn btn-secondary",onClick:a[8]||(a[8]=e=>x.value=!1)}," Cancel "),r("button",{class:"btn btn-primary",onClick:F}," Import ")])])])])):f("",!0)]))}}),[["__scopeId","data-v-581d630c"]]);export{Kt as default};
