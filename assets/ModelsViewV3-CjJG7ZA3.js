const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-mQWFZhQt.js","assets/vue-vendor-BZxY9vkr.js","assets/ui-vendor-DgwC-sRC.js","assets/utils-vendor-X1Ah6TN4.js","assets/data-vendor-CllpzWXw.js","assets/index-DLndv8Bi.css"])))=>i.map(i=>d[i]);
import{d as P,m as Fe,p as yt,u as Ve,a as E,e as ce,_ as Ue,n as _t}from"./index-mQWFZhQt.js";import{f as b,c as W,d as ve,V as h,_ as c,W as e,a2 as j,a5 as ae,X as f,u as y,F as X,Y as oe,B as re,k as r,a1 as M,$ as I,a0 as n,G as O,o as ze,s as xe,h as bt,b as ht,a9 as kt,aa as wt,Z as Ct}from"./vue-vendor-BZxY9vkr.js";import{u as Be}from"./useV4Models-oYSRS58H.js";import{u as Te}from"./useV4ProviderParameters-BgwoeZ7t.js";import{O as Mt}from"./OllamaModelManagerV3-DbZ81uh4.js";import{m as $t,y as Ot,t as Pt,S as Ne,z as Dt,G as At,R as Et,q as St,H as Le,J as Re,o as xt,U as Lt,w as Rt}from"./ui-vendor-DgwC-sRC.js";import{detectOllamaIssue as Ft}from"./ollama-fetch-C_RQn-6R.js";import"./utils-vendor-X1Ah6TN4.js";import"./data-vendor-CllpzWXw.js";import"./useV4LiveQuery-CfOiSnL_.js";class Vt{async bulkWrite(i,o,l="put"){o.length!==0&&await P.transaction("rw",P[i],async()=>{switch(l){case"put":await P[i].bulkPut(o);break;case"add":await P[i].bulkAdd(o);break;case"update":const m=o.map(_=>P[i].update(_.id,_));await Promise.all(m);break}})}async bulkDelete(i,o){o.length!==0&&await P.transaction("rw",P[i],async()=>{await P[i].bulkDelete(o)})}async conditionalBulkUpdate(i,o,l){let m=0;return await P.transaction("rw",P[i],async()=>{await P[i].toCollection().modify(_=>{o(_)&&(Object.assign(_,l),m++)})}),m}freezeDeep(i){const o=i.map(l=>Object.freeze(l));return Object.freeze(o)}async getAndFreeze(i,o){const l=await P[i].get(o);return l?Object.freeze(l):null}async getAllAndFreeze(i){const o=await P[i].toArray();return this.freezeDeep(o)}}const ue=new Vt;class Ut{async bulkUpsertModels(i){i.length!==0&&await P.transaction("rw",P.models,async()=>{const o=i.map(l=>Object.freeze({...l,enabled:l.enabled??!1,available:l.available??!0}));await P.models.bulkPut(o)})}async clearProviderModels(i){return await P.transaction("rw",P.models,async()=>{const m=(await P.models.where("provider").equals(i).toArray()).map(_=>_.id);return m.length>0&&await P.models.bulkDelete(m),m.length})}async toggleModelEnabled(i,o){return await P.models.update(i,{enabled:o})===1}async toggleProviderModels(i,o){return await ue.conditionalBulkUpdate("models",l=>l.provider===i,{enabled:o})}async toggleAllModels(i){return await ue.conditionalBulkUpdate("models",()=>!0,{enabled:i})}async getModelStatistics(){const i=await P.models.toArray(),o={total:i.length,enabled:0,byProvider:{}};for(const l of i)l.enabled&&o.enabled++,o.byProvider[l.provider]||(o.byProvider[l.provider]={total:0,enabled:0}),o.byProvider[l.provider].total++,l.enabled&&o.byProvider[l.provider].enabled++;return Object.freeze(o)}async updateModelAvailability(i,o){return await ue.conditionalBulkUpdate("models",l=>l.provider===i,{available:o})}async searchModels(i){let o=P.models.toCollection();if(i.provider&&(o=P.models.where("provider").equals(i.provider)),i.enabled!==void 0&&(o=o.and(m=>m.enabled===i.enabled)),i.available!==void 0&&(o=o.and(m=>m.available===i.available)),i.search){const m=i.search.toLowerCase();o=o.and(_=>_.displayName.toLowerCase().includes(m)||_.modelId.toLowerCase().includes(m))}const l=await o.toArray();return ue.freezeDeep(l)}async clearAllModels(){await P.models.clear()}}const zt=new Ut;function Bt(){const z=Fe(),i=b(!1),o=b(null),l=b(!1),m=b(!1);async function _(g,v){i.value=!0,v&&(v.value=!0),o.value=null;try{return{ok:!0,value:await g()}}catch(s){const S=s instanceof Error?s:new Error(String(s));return o.value=S,{ok:!1,error:S}}finally{i.value=!1,v&&(v.value=!1)}}async function B(g){return _(()=>z.discoverModels(g),l)}async function F(g){return _(()=>z.refreshModelSource(g),l)}async function A(g,v){return _(async()=>{await z.toggleModel(g,v)},m)}async function C(g){return _(async()=>{await z.toggleAllModels(g)},m)}async function d(g,v){return _(async()=>{await z.toggleProviderModels(g,v)},m)}async function V(){return _(async()=>{await z.enableOpenRouterFavorites()},m)}async function $(){return _(async()=>{await z.clearAllModels()})}async function u(g,v){return _(async()=>{await zt.updateModelAvailability(g,v)})}return{discoverModels:B,refreshDiscoverySource:F,toggleModel:A,toggleAllModels:C,toggleProviderModels:d,enableOpenRouterFavorites:V,clearAllModels:$,updateModelAvailability:u,isExecuting:i,lastError:o,isDiscovering:l,isTogglingModels:m}}function Ge(){const z=Fe(),i=b([]),o=b(!1),l=b([]);function m(){const F=z.getDiscoveryStatus();i.value=F.map(A=>({id:A.id,status:A.status==="loading"?"loading":A.status==="idle"?"success":A.status,modelCount:A.modelCount,error:A.error})),o.value=z.isDiscovering(),l.value=z.getDiscoveryErrors()}function _(F){return{litellm:"LiteLLM",openrouter:"OpenRouter",ollama:"Ollama",deterministic:"Deterministic"}[F]||F}function B(F){const A=yt.getProvider(F);return(A==null?void 0:A.name)||F}return m(),{discoveryStatus:W(()=>i.value),isDiscovering:W(()=>o.value),discoveryErrors:W(()=>l.value),getSourceDisplayName:_,getProviderDisplayName:B,refreshStatus:m}}const Tt={class:"model-list"},Nt={class:"model-header"},Gt={class:"model-table"},jt=["onClick"],It={class:"model-name"},Kt={class:"model-source"},Wt={class:"model-context"},Jt={key:0},qt={key:1,class:"text-secondary"},Ht={key:0,class:"model-cost-in"},Qt={key:0,class:"cost-value"},Xt={key:1,class:"text-secondary"},Yt={key:1,class:"model-cost-out"},Zt={key:0,class:"cost-value"},es={key:1,class:"text-secondary"},ts={class:"model-enviro-carbon"},ss={class:"enviro-value"},as={class:"model-enviro-water"},os={class:"enviro-value"},ls={class:"model-enviro-energy"},ns={class:"enviro-value"},rs=ve({__name:"ModelListV3",props:{models:{},providerId:{}},emits:["toggle-model"],setup(z){const i=z,o=Ve(),l=b("name"),m=b("asc"),_=W(()=>{if(!i.models||i.models.length===0)return[];const C=i.models.filter($=>{var u,g;return((u=$.capabilities)==null?void 0:u.inputCostPerToken)||((g=$.capabilities)==null?void 0:g.outputCostPerToken)});return C.length>0?E.info("MODEL_LIST_DEBUG: Models with pricing:",C.map($=>{var u,g;return{id:$.id,provider:$.provider,modelId:$.modelId,inputCost:(u=$.capabilities)==null?void 0:u.inputCostPerToken,outputCost:(g=$.capabilities)==null?void 0:g.outputCostPerToken}})):E.info("MODEL_LIST_DEBUG: No models have pricing data. Sample model:",i.models[0]),[...i.models].sort(($,u)=>{var v,s,S,x,J,q;let g=0;switch(l.value){case"enabled":g=($.enabled?1:0)-(u.enabled?1:0);break;case"name":g=$.displayName.localeCompare(u.displayName);break;case"source":g=($.source||"").localeCompare(u.source||"");break;case"context":const K=((v=$.capabilities)==null?void 0:v.contextWindow)||0,Y=((s=u.capabilities)==null?void 0:s.contextWindow)||0;g=K-Y;break;case"inputCost":const R=((S=$.capabilities)==null?void 0:S.inputCostPerToken)||0,T=((x=u.capabilities)==null?void 0:x.inputCostPerToken)||0;g=R-T;break;case"outputCost":const N=((J=$.capabilities)==null?void 0:J.outputCostPerToken)||0,Z=((q=u.capabilities)==null?void 0:q.outputCostPerToken)||0;g=N-Z;break}return m.value==="asc"?g:-g})});function B(C){l.value===C?m.value=m.value==="asc"?"desc":"asc":(l.value=C,m.value="asc")}function F(C){return C>=1e6?(C/1e6).toFixed(1)+"M":C>=1e3?(C/1e3).toFixed(0)+"K":C.toString()}function A(C){if(!C||C===0)return"0.00";const d=C*1e6;return d<.01?d.toFixed(4):d<1?d.toFixed(3):d<10?d.toFixed(2):d<100?d.toFixed(1):d.toFixed(0)}return(C,d)=>{const V=M("a-switch"),$=M("a-tag");return c(),h("div",Tt,[e("div",Nt,[e("div",{class:"header-switch sortable",onClick:d[0]||(d[0]=u=>B("enabled"))},[d[7]||(d[7]=e("span",null,"Enabled",-1)),e("span",{class:ae(["sort-indicator",{active:l.value==="enabled"}])},f(l.value==="enabled"&&m.value==="asc"?"â–²":"â–¼"),3)]),e("div",{class:"header-name sortable",onClick:d[1]||(d[1]=u=>B("name"))},[d[8]||(d[8]=e("span",null,"Model",-1)),e("span",{class:ae(["sort-indicator",{active:l.value==="name"}])},f(l.value==="name"&&m.value==="asc"?"â–²":"â–¼"),3)]),e("div",{class:"header-source sortable",onClick:d[2]||(d[2]=u=>B("source"))},[d[9]||(d[9]=e("span",null,"Source",-1)),e("span",{class:ae(["sort-indicator",{active:l.value==="source"}])},f(l.value==="source"&&m.value==="asc"?"â–²":"â–¼"),3)]),e("div",{class:"header-context sortable",onClick:d[3]||(d[3]=u=>B("context"))},[d[10]||(d[10]=e("span",null,"Context",-1)),e("span",{class:ae(["sort-indicator",{active:l.value==="context"}])},f(l.value==="context"&&m.value==="asc"?"â–²":"â–¼"),3)]),y(o).showFinancialCosts.value?(c(),h("div",{key:0,class:"header-cost-in sortable",onClick:d[4]||(d[4]=u=>B("inputCost"))},[d[11]||(d[11]=e("span",null,"Input $/1M",-1)),e("span",{class:ae(["sort-indicator",{active:l.value==="inputCost"}])},f(l.value==="inputCost"&&m.value==="asc"?"â–²":"â–¼"),3)])):j("",!0),y(o).showFinancialCosts.value?(c(),h("div",{key:1,class:"header-cost-out sortable",onClick:d[5]||(d[5]=u=>B("outputCost"))},[d[12]||(d[12]=e("span",null,"Output $/1M",-1)),e("span",{class:ae(["sort-indicator",{active:l.value==="outputCost"}])},f(l.value==="outputCost"&&m.value==="asc"?"â–²":"â–¼"),3)])):j("",!0),d[13]||(d[13]=e("div",{class:"header-enviro-carbon"},[e("span",null,"COâ‚‚")],-1)),d[14]||(d[14]=e("div",{class:"header-enviro-water"},[e("span",null,"ðŸ’§")],-1)),d[15]||(d[15]=e("div",{class:"header-enviro-energy"},[e("span",null,"âš¡")],-1))]),e("div",Gt,[(c(!0),h(X,null,oe(_.value,u=>{var g,v,s;return c(),h("div",{key:u.id,class:"model-row",onClick:S=>C.$emit("toggle-model",u.id,!u.enabled)},[e("div",{class:"model-switch",onClick:d[6]||(d[6]=re(()=>{},["stop"]))},[r(V,{checked:u.enabled,size:"small",onChange:S=>C.$emit("toggle-model",u.id,S),"data-testid":"model-toggle","data-provider":u.provider,"data-model":u.modelId,"aria-label":`${u.enabled?"Disable":"Enable"} model ${u.modelId}`},null,8,["checked","onChange","data-provider","data-model","aria-label"])]),e("div",It,[e("code",null,f(u.modelId),1)]),e("div",Kt,[u.source?(c(),I($,{key:0,size:"small",color:"cyan"},{default:n(()=>[O(f(u.source),1)]),_:2},1024)):j("",!0)]),e("div",Wt,[(g=u.capabilities)!=null&&g.contextWindow?(c(),h("span",Jt,f(F(u.capabilities.contextWindow)),1)):(c(),h("span",qt,"-"))]),y(o).showFinancialCosts.value?(c(),h("div",Ht,[(v=u.capabilities)!=null&&v.inputCostPerToken?(c(),h("span",Qt," $"+f(A(u.capabilities.inputCostPerToken)),1)):(c(),h("span",Xt,"-"))])):j("",!0),y(o).showFinancialCosts.value?(c(),h("div",Yt,[(s=u.capabilities)!=null&&s.outputCostPerToken?(c(),h("span",Zt," $"+f(A(u.capabilities.outputCostPerToken)),1)):(c(),h("span",es,"-"))])):j("",!0),e("div",ts,[e("span",ss,f(y(o).getEnvironmentalCost(u,"carbon")),1)]),e("div",as,[e("span",os,f(y(o).getEnvironmentalCost(u,"water")),1)]),e("div",ls,[e("span",ns,f(y(o).getEnvironmentalCost(u,"energy")),1)])],8,jt)}),128))])])}}}),is=ce(rs,[["__scopeId","data-v-2b840b1b"]]),ds={class:"model-preference-manager"},us={class:"preferences-section"},cs={class:"action-group"},vs={class:"action-group"},ps={class:"status-grid"},ms={class:"status-item"},fs={class:"status-value"},gs={class:"status-item"},ys={class:"status-value"},_s={class:"status-item"},bs={class:"status-value"},hs={class:"status-item"},ks={class:"status-value"},ws={class:"status-item"},Cs={class:"status-value"},Ms={class:"status-item"},$s={class:"status-value"},Os={class:"action-group"},Ps={class:"provider-grid"},Ds={class:"provider-name"},As={class:"provider-stats"},Es={class:"provider-total"},Ss={class:"provider-enabled"},xs=ve({__name:"ModelPreferenceManagerV3",setup(z){const{models:i,enabledModels:o,modelsByProvider:l}=Be(),{discoveryStatus:m}=Ge(),_=Ve(),{showFinancialCosts:B,showEnvironmentalCosts:F}=_,A=b([]),C=b(!1),d=b(!1),V=b(""),$=b("");async function u(){C.value=!0,V.value="";try{const v=await _.exportModelPreferences();if(v.ok){const s=new Blob([JSON.stringify(v.value,null,2)],{type:"application/json"}),S=URL.createObjectURL(s),x=document.createElement("a");x.href=S,x.download=`model-preferences-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(S),$.value="Model preferences exported successfully!"}else V.value=v.error.message}catch(v){V.value=`Failed to export preferences: ${v instanceof Error?v.message:"Unknown error"}`}finally{C.value=!1}}async function g(v){d.value=!0,V.value="";try{const s=await v.text(),S=JSON.parse(s),x=await _.importModelPreferences(S);x.ok?$.value="Model preferences imported successfully!":V.value=x.error.message}catch(s){s instanceof SyntaxError?V.value="Invalid JSON file format":V.value=`Failed to import preferences: ${s instanceof Error?s.message:"Unknown error"}`}finally{d.value=!1}return!1}return(v,s)=>{const S=M("a-button"),x=M("a-upload"),J=M("a-space"),q=M("a-divider"),K=M("a-alert"),Y=M("a-collapse-panel"),R=M("a-collapse");return c(),h("div",ds,[r(R,{activeKey:A.value,"onUpdate:activeKey":s[2]||(s[2]=T=>A.value=T),bordered:!1,class:"preferences-collapse"},{default:n(()=>[r(Y,{key:"preferences"},{header:n(()=>s[3]||(s[3]=[e("div",{class:"preferences-header"},[e("strong",null,"ðŸ”§ V3 Enhanced Features"),e("span",{class:"preferences-description"},"Advanced model preference management")],-1)])),default:n(()=>{var T,N,Z;return[e("div",us,[e("div",cs,[s[6]||(s[6]=e("h5",{class:"action-title"},"Model Preferences",-1)),s[7]||(s[7]=e("p",{class:"action-description"}," Export and import your model enabled/disabled preferences for backup or sharing. ",-1)),r(J,null,{default:n(()=>[r(S,{onClick:u,loading:C.value,type:"primary"},{icon:n(()=>[r(y($t))]),default:n(()=>[s[4]||(s[4]=O(" Export Preferences "))]),_:1,__:[4]},8,["loading"]),r(x,{"before-upload":g,"show-upload-list":!1,accept:".json"},{default:n(()=>[r(S,{loading:d.value},{icon:n(()=>[r(y(Ot))]),default:n(()=>[s[5]||(s[5]=O(" Import Preferences "))]),_:1,__:[5]},8,["loading"])]),_:1})]),_:1})]),r(q),e("div",vs,[s[14]||(s[14]=e("h5",{class:"action-title"},"V3 System Information",-1)),s[15]||(s[15]=e("p",{class:"action-description"}," Enhanced V3 backend capabilities and status. ",-1)),e("div",ps,[e("div",ms,[s[8]||(s[8]=e("span",{class:"status-label"},"Total Models:",-1)),e("span",fs,f(((T=y(i))==null?void 0:T.length)||0),1)]),e("div",gs,[s[9]||(s[9]=e("span",{class:"status-label"},"Enabled Models:",-1)),e("span",ys,f(((N=y(o))==null?void 0:N.length)||0),1)]),e("div",_s,[s[10]||(s[10]=e("span",{class:"status-label"},"Active Providers:",-1)),e("span",bs,f(Object.keys(y(l)||{}).length),1)]),e("div",hs,[s[11]||(s[11]=e("span",{class:"status-label"},"Discovery Sources:",-1)),e("span",ks,f(((Z=y(m))==null?void 0:Z.length)||0),1)]),e("div",ws,[s[12]||(s[12]=e("span",{class:"status-label"},"Cost Display:",-1)),e("span",Cs,f(y(B)?"Enabled":"Disabled"),1)]),e("div",Ms,[s[13]||(s[13]=e("span",{class:"status-label"},"Environmental Display:",-1)),e("span",$s,f(y(F)?"Enabled":"Disabled"),1)])])]),r(q),e("div",Os,[s[16]||(s[16]=e("h5",{class:"action-title"},"Provider Status",-1)),s[17]||(s[17]=e("p",{class:"action-description"}," Real-time provider status and model counts. ",-1)),e("div",Ps,[(c(!0),h(X,null,oe(y(l),(te,D)=>(c(),h("div",{key:D,class:"provider-item"},[e("div",Ds,f(y(_).getProviderDisplayName(D)),1),e("div",As,[e("span",Es,f(te.length)+" total",1),e("span",Ss,f(te.filter(Q=>Q.enabled).length)+" enabled",1)])]))),128))])])]),V.value?(c(),I(K,{key:0,type:"error",message:V.value,closable:"",onClose:s[0]||(s[0]=te=>V.value=""),class:"error-alert"},null,8,["message"])):j("",!0),$.value?(c(),I(K,{key:1,type:"success",message:$.value,closable:"",onClose:s[1]||(s[1]=te=>$.value=""),class:"success-alert"},null,8,["message"])):j("",!0)]}),_:1})]),_:1},8,["activeKey"])])}}}),Ls=ce(xs,[["__scopeId","data-v-f4de1453"]]),Rs={key:0,class:"loading-state"},Fs={key:1,class:"error-state"},Vs={class:"error-message"},Us=["onClick"],zs={class:"list-header"},Bs={class:"list-info"},Ts={class:"list-name"},Ns={class:"list-meta"},Gs={class:"list-actions"},js={class:"list-description"},Is={class:"list-preview"},Ks={key:0,class:"more-models"},Ws=ve({__name:"ModelListsDropdownV3",props:{currentModels:{},isLoading:{type:Boolean,default:!1}},emits:["apply-list","close"],setup(z,{emit:i}){const o=z,l=i,{getProviderGroup:m}=Te(),_=b([]),B=b(!0),F=b(""),A=b(!1),C=b("");ze(async()=>{try{B.value=!0,F.value="";const{getModelListManager:v}=await Ue(async()=>{const{getModelListManager:x}=await import("./index-mQWFZhQt.js").then(J=>J.r);return{getModelListManager:x}},__vite__mapDeps([0,1,2,3,4,5])),S=await v().getLists();_.value=S.filter(x=>["openrouter-favorites","cost-efficient","high-performance"].includes(x.id)),E.info("Model lists loaded:",{lists:_.value.length})}catch(v){E.error("Failed to load model lists:",v),F.value="Failed to load model lists"}finally{B.value=!1}});function d(v){return o.currentModels.some(s=>s.modelId!==v.modelId?!1:v.provider?s.provider===v.provider&&s.enabled:v.providerGroup?m(s.provider)===v.providerGroup&&s.enabled:!1)}function V(v){return v.models.slice(0,3)}function $(v){return v.modelId.replace(/^.*\//,"").replace(/-instruct$/,"").replace(/-preview$/,"")}async function u(v){if(!(A.value||o.isLoading))try{A.value=!0,C.value=v,await new Promise(s=>{l("apply-list",v),setTimeout(()=>{s()},2e3)})}catch(s){E.error("Failed to apply list:",s)}finally{A.value=!1,C.value=""}}function g(v){var s;(s=v.domEvent)==null||s.stopPropagation()}return(v,s)=>{const S=M("a-spin"),x=M("a-button"),J=M("a-menu-item"),q=M("a-menu-divider"),K=M("a-tag"),Y=M("a-menu");return c(),I(Y,{class:"model-lists-menu",onClick:g},{default:n(()=>[B.value?(c(),h("div",Rs,[r(S,{size:"small"}),s[0]||(s[0]=e("span",null,"Loading model lists...",-1))])):F.value?(c(),h("div",Fs,[e("span",Vs,f(F.value),1)])):(c(),h(X,{key:2},[s[6]||(s[6]=e("div",{class:"menu-header"},[e("span",null,"Built-in Lists")],-1)),(c(!0),h(X,null,oe(_.value,R=>(c(),I(J,{key:R.id,class:"list-menu-item"},{default:n(()=>[e("div",{class:"list-item",onClick:T=>u(R.id)},[e("div",zs,[e("div",Bs,[e("span",Ts,f(R.name),1),e("span",Ns,f(R.models.length)+" models",1)]),e("div",Gs,[r(x,{type:"primary",size:"small",loading:A.value&&C.value===R.id,onClick:re(T=>u(R.id),["stop"])},{default:n(()=>s[1]||(s[1]=[O(" Apply ")])),_:2,__:[1]},1032,["loading","onClick"])])]),e("div",js,f(R.description),1),e("div",Is,[(c(!0),h(X,null,oe(V(R),(T,N)=>(c(),h("span",{key:`${T.provider||T.providerGroup}-${T.modelId}`,class:ae(["preview-model",{enabled:d(T)}])},f($(T))+f(N<V(R).length-1?", ":""),3))),128)),R.models.length>3?(c(),h("span",Ks," +"+f(R.models.length-3)+" more ",1)):j("",!0)])],8,Us)]),_:2},1024))),128)),r(q),r(J,{disabled:"",class:"future-feature"},{default:n(()=>[r(y(Pt)),s[3]||(s[3]=e("span",null,"Save Current Selection...",-1)),r(K,{color:"blue",size:"small"},{default:n(()=>s[2]||(s[2]=[O("Soon")])),_:1,__:[2]})]),_:1,__:[3]}),r(J,{disabled:"",class:"future-feature"},{default:n(()=>[r(y(Ne)),s[5]||(s[5]=e("span",null,"Manage Lists...",-1)),r(K,{color:"blue",size:"small"},{default:n(()=>s[4]||(s[4]=[O("Soon")])),_:1,__:[4]})]),_:1,__:[5]})],64))]),_:1})}}}),Js=ce(Ws,[["__scopeId","data-v-5706641b"]]),qs={class:"models-view","data-testid":"page-models"},Hs={class:"page-header"},Qs={key:3,class:"discovery-status-bar"},Xs={class:"source-name"},Ys=["onClick","data-testid","aria-label"],Zs={class:"search-filter-bar"},ea={class:"control-bar"},ta={class:"left-controls"},sa={class:"dropdown-item"},aa={class:"dropdown-item"},oa={class:"stats"},la={class:"provider-header"},na={class:"provider-info"},ra={key:1,class:"provider-summary"},ia=ve({__name:"ModelsViewV3",setup(z){const i=Ct(),{models:o,modelsByProvider:l,stats:m}=Be(),{getProviderGroup:_,requiresApiKey:B}=Te(),F=_t(),{hasApiKey:A}=F.secureSettings,{discoverModels:C,refreshDiscoverySource:d,toggleModel:V,toggleAllModels:$,toggleProviderModels:u,clearAllModels:g,isDiscovering:v,isTogglingModels:s}=Bt(),{discoveryStatus:S,getSourceDisplayName:x,getProviderDisplayName:J,refreshStatus:q}=Ge(),K=b(""),Y=b(""),R=b("all"),T=b(!1),N=b({hideOpenRouterFree:!1,hideOpenRouterAuto:!1}),Z=W(()=>{const a={};return Object.keys(l.value||{}).forEach(t=>{const p=_(t),L=B(t),U=A(p);a[t]={hasKey:U,providerGroup:p,requiresKey:L}}),a}),te=b(!1),D=b(""),Q=b([]),be=b(null),he=b([]),je=b(!1),ie=b(null),pe=b(!1);let me=null;const Ie=a=>{me&&clearTimeout(me),me=setTimeout(()=>{Y.value=a},300)},fe=W(()=>{const a={};for(const[t,p]of Object.entries(l.value))a[t]=p.filter(L=>L.enabled).length;return a}),se=b([]),de=W(()=>{const a=Y.value.toLowerCase(),t={},p=Object.keys(l.value);if(se.value.length===0||p.some(L=>!se.value.includes(L))){const L=se.value.filter(k=>p.includes(k)),U=p.filter(k=>!se.value.includes(k)).sort();se.value=[...L,...U]}for(const L of se.value){const U=l.value[L];if(!U)continue;let k=[...U];a&&(k=k.filter(ee=>ee.displayName.toLowerCase().includes(a)||ee.modelId.toLowerCase().includes(a)||L.toLowerCase().includes(a))),R.value==="enabled"?k=k.filter(ee=>ee.enabled):R.value==="disabled"&&(k=k.filter(ee=>!ee.enabled)),k.length>0&&(t[L]=k)}return t}),Ke=W(()=>{const a=m.value.total;return E.info("ModelsViewV3 V4 totalCount:",a),a}),We=W(()=>m.value.enabled),Je=W(()=>{var a;return((a=l.value.openrouter)==null?void 0:a.length)>0}),qe=W(()=>K.value?`No models found matching "${K.value}"`:R.value!=="all"?`No ${R.value} models found`:'No models available. Click "Refresh Models" to discover models.'),ge=W(()=>{if(!D.value)return!1;const a=D.value.toLowerCase();return a.includes("ollama")&&(a.includes("failed to fetch")||a.includes("networkerror when attempting to fetch"))&&!a.includes("litellm")&&!a.includes("openrouter")}),He=W(()=>{var p,L;const a=((p=l.value["ollama-chat"])==null?void 0:p.length)>0||((L=l.value["ollama-generate"])==null?void 0:L.length)>0,t=S.value.some(U=>U.id==="ollama");return a||t||ge.value}),ye=W(()=>{const a=se.value.length;return Q.value.length===a&&a>0}),Qe=xe(Dt),Xe=xe(At);function Ye(a){return{idle:"default",loading:"processing",success:"success",error:"error"}[a]||"default"}function Ze(a){return fe.value[a]||0}function et(a){const t=Ze(a),p=(l.value[a]||[]).length;return t===0?"default":t===p?"success":"warning"}function tt(a){const t=de.value[a]||[];return t.length>0&&t.every(p=>p.enabled)}function st(a){const t=de.value[a]||[];return t.length>0&&t.every(p=>!p.enabled)}function at(a){i.push({path:"/settings",query:a?{provider:a}:void 0})}function ot(){ye.value?Q.value=[]:Q.value=[...se.value]}async function lt(a,t){const p=await V(a,t);p.ok||(D.value=p.error.message)}async function ke(a,t){const p=await u(a,t);p.ok||(D.value=p.error.message)}async function nt(){const a=await $(!0);a.ok||(D.value=a.error.message)}async function rt(){const a=await $(!1);a.ok||(D.value=a.error.message)}async function _e(){T.value=!0,D.value="";try{E.info("V4 DEBUG: Starting discovery...");const a=await C({forceRefresh:!0});if(E.info("V4 DEBUG: Discovery result:",a),a.ok){E.info("V4 DEBUG: Discovery successful, models found:",a.value.totalModels),E.info("V4 DEBUG: After discovery, models.value.length =",o.value.length);const t=a.value.errors.filter(p=>!(p.includes("ollama")&&p.includes("not detected")));t.length>0&&(D.value=`Some sources failed: ${t.join("; ")}`)}else E.info("V4 DEBUG: Discovery failed:",a.error),D.value=`Discovery failed: ${a.error.message}`;q()}catch(a){E.error("Failed to refresh models",a),D.value="Failed to refresh models. Please check your connection and try again."}finally{T.value=!1}}async function it(a){var t,p,L,U;be.value=a,D.value="";try{const k=await d(a);a==="ollama"&&(k.ok&&((p=(t=k.value)==null?void 0:t.errors)==null?void 0:p.some(le=>le.includes("not detected")))||!k.ok&&((U=(L=k.error)==null?void 0:L.message)==null?void 0:U.includes("not detected")))||(k.ok&&k.value.errors.length>0?D.value=`Failed to refresh ${x(a)}: ${k.value.errors.join("; ")}`:k.ok||(D.value=`Failed to refresh ${x(a)}: ${k.error.message}`)),q()}catch(k){E.error("Failed to retry source",k,{sourceId:a}),D.value=`Failed to refresh ${x(a)}: ${k instanceof Error?k.message:"Unknown error"}`}finally{be.value=null}}async function dt(){try{await d("ollama"),q(),Ce()}catch(a){E.error("Failed to refresh Ollama models after update",a)}}async function we(){E.info("[ModelsView] Saving OpenRouter settings:",N.value),await P.settings.get("main")?(E.info("[ModelsView] Updating existing settings"),await P.settings.update("main",{hideOpenRouterFree:N.value.hideOpenRouterFree,hideOpenRouterAuto:N.value.hideOpenRouterAuto})):(E.info("[ModelsView] Creating new settings"),await P.settings.add({id:"main",version:1,initialized:!0,hideOpenRouterFree:N.value.hideOpenRouterFree,hideOpenRouterAuto:N.value.hideOpenRouterAuto}));const t=await P.settings.get("main");E.info("[ModelsView] Settings after save:",t)}async function Ce(){try{(await Ft()).hasIssue?ie.value="not-detected":ie.value=null}catch{}}async function ut(){if(confirm("This will remove all models and re-discover them from scratch. Any custom model configurations will be lost. Continue?")){te.value=!0,D.value="";try{const t=await g();if(!t.ok){D.value=t.error.message;return}const p=await C({forceRefresh:!0});if(p.ok&&p.value.errors.length>0){const L=p.value.errors.filter(U=>!(U.includes("ollama")&&U.includes("not detected")));L.length>0&&(D.value=`Some sources failed: ${L.join("; ")}`)}else p.ok||(D.value=`Discovery failed: ${p.error.message}`);q()}catch(t){E.error("Failed to clear and refresh models",t),D.value="Failed to clear and refresh models. Please check your connection and try again."}finally{te.value=!1}}}async function ct(a){try{E.info("Applying model list:",a);const{getModelListManager:t}=await Ue(async()=>{const{getModelListManager:U}=await import("./index-mQWFZhQt.js").then(k=>k.r);return{getModelListManager:U}},__vite__mapDeps([0,1,2,3,4,5])),L=await t().applyList(a);E.info("Model list applied:",L),await _e()}catch(t){E.error("Failed to apply model list:",t),D.value=`Failed to apply model list: ${t instanceof Error?t.message:"Unknown error"}`}}bt(()=>{Ie(K.value)});const H=W(()=>s.value);return ze(async()=>{E.info("V4 DEBUG: models.value.length =",o.value.length),E.info("V4 DEBUG: models.value =",o.value),E.info("V4 DEBUG: modelsByProvider.value =",l.value);const a=await P.settings.get("main");a&&(N.value={hideOpenRouterFree:a.hideOpenRouterFree??!1,hideOpenRouterAuto:a.hideOpenRouterAuto??!1}),o.value.length===0&&(E.info("V4 DEBUG: No models found, refreshing..."),_e()),Q.value=[],Ce()}),ht(()=>{K.value="",Q.value=[],D.value=""}),(a,t)=>{const p=M("a-button"),L=M("a-space"),U=M("a-alert"),k=M("a-tag"),ee=M("a-input-search"),le=M("a-radio-button"),vt=M("a-radio-group"),pt=M("a-divider"),Me=M("a-dropdown"),$e=M("a-checkbox"),Oe=M("a-menu-item"),mt=M("a-menu"),ft=M("a-tooltip"),Pe=M("a-collapse-panel"),De=M("a-collapse"),gt=M("a-empty");return c(),h("div",qs,[e("div",Hs,[t[13]||(t[13]=e("div",{class:"header-content"},[e("h1",null,"Model Management"),e("p",{class:"description"},"Configure and enable LLM models for testing")],-1)),r(L,null,{default:n(()=>[r(p,{type:"primary",onClick:_e,loading:T.value||y(v),"data-testid":"btn-refresh-models","aria-label":"Refresh available models"},{icon:n(()=>[r(y(Et))]),default:n(()=>[t[11]||(t[11]=O(" Refresh Models "))]),_:1,__:[11]},8,["loading"]),r(p,{danger:"",onClick:ut,loading:te.value,"data-testid":"btn-clear-refresh-models","aria-label":"Clear all models and refresh"},{icon:n(()=>[r(y(St))]),default:n(()=>[t[12]||(t[12]=O(" Clear and Refresh Models "))]),_:1,__:[12]},8,["loading"])]),_:1})]),D.value&&!ge.value?(c(),I(U,{key:0,type:"error",message:D.value,closable:"",onClose:t[0]||(t[0]=w=>D.value=""),class:"error-alert"},null,8,["message"])):j("",!0),ge.value?(c(),I(U,{key:1,type:"info",closable:"",onClose:t[1]||(t[1]=w=>D.value=""),class:"ollama-info-alert"},{message:n(()=>t[14]||(t[14]=[e("div",{class:"ollama-message"},[O(" Ollama is not running on this computer. To audit local LLMs, install "),e("a",{href:"https://ollama.com",target:"_blank",rel:"noopener noreferrer"},"Ollama"),O(". ")],-1)])),_:1})):j("",!0),ie.value?(c(),I(U,{key:2,type:"info",closable:"",onClose:t[2]||(t[2]=w=>ie.value=null),class:"ollama-cors-alert"},{message:n(()=>t[15]||(t[15]=[e("div",{class:"ollama-cors-message"},[e("strong",null,"Ollama not detected: "),e("a",{href:"https://ollama.com",target:"_blank",rel:"noopener noreferrer"},"Ollama"),O(" is an external program for running LLMs on your computer. If Ollama is installed, you must "),e("a",{href:"https://objectgraph.com/blog/ollama-cors/",target:"_blank",rel:"noopener noreferrer"},"configure CORS"),O(' by setting OLLAMA_ORIGINS to "*" or "auditomatic.org". If you do not wish to use Ollama, close and ignore this message. ')],-1)])),_:1})):j("",!0),y(S).length>0?(c(),h("div",Qs,[t[16]||(t[16]=e("span",{class:"status-label"},"Sources:",-1)),(c(!0),h(X,null,oe(y(S),w=>(c(),h("div",{key:w.id,class:"source-status-compact"},[e("span",Xs,f(y(x)(w.id)),1),r(k,{color:Ye(w.status),size:"small"},{default:n(()=>[w.status==="success"&&w.modelCount?(c(),h(X,{key:0},[O(f(w.modelCount),1)],64)):w.status==="error"?(c(),h("span",{key:1,onClick:G=>it(w.id),style:{cursor:"pointer"},"data-testid":`retry-source-${w.id}`,"aria-label":`Retry loading models from ${y(x)(w.id)}`},"âŸ³ retry",8,Ys)):(c(),h(X,{key:2},[O(f(w.status),1)],64))]),_:2},1032,["color"])]))),128))])):j("",!0),e("div",Zs,[r(ee,{value:K.value,"onUpdate:value":t[3]||(t[3]=w=>K.value=w),placeholder:"Search models by name, provider, or ID...","allow-clear":"",size:"large",class:"search-input","data-testid":"input-model-search","aria-label":"Search models",loading:K.value!==Y.value},null,8,["value","loading"]),r(vt,{value:R.value,"onUpdate:value":t[4]||(t[4]=w=>R.value=w),"button-style":"solid",size:"large"},{default:n(()=>[r(le,{value:"all"},{default:n(()=>t[17]||(t[17]=[O("All")])),_:1,__:[17]}),r(le,{value:"enabled"},{default:n(()=>t[18]||(t[18]=[O("Enabled")])),_:1,__:[18]}),r(le,{value:"disabled"},{default:n(()=>t[19]||(t[19]=[O("Disabled")])),_:1,__:[19]})]),_:1},8,["value"])]),e("div",ea,[e("div",ta,[r(p,{type:"text",size:"small",onClick:ot},{icon:n(()=>[(c(),I(kt(ye.value?Xe.value:Qe.value)))]),default:n(()=>[O(" "+f(ye.value?"Collapse All":"Expand All"),1)]),_:1}),r(pt,{type:"vertical"}),r(p,{type:"text",size:"small",onClick:nt,loading:H.value,disabled:H.value},{icon:n(()=>[r(y(Le))]),default:n(()=>[t[20]||(t[20]=O(" Enable All "))]),_:1,__:[20]},8,["loading","disabled"]),r(p,{type:"text",size:"small",onClick:rt,loading:H.value,disabled:H.value},{icon:n(()=>[r(y(Re))]),default:n(()=>[t[21]||(t[21]=O(" Disable All "))]),_:1,__:[21]},8,["loading","disabled"]),r(Me,{open:pe.value,"onUpdate:open":t[6]||(t[6]=w=>pe.value=w),placement:"bottomLeft",disabled:H.value},{overlay:n(()=>[r(Js,{"current-models":Array.from(y(o)),"is-loading":H.value,onApplyList:ct,onClose:t[5]||(t[5]=w=>pe.value=!1)},null,8,["current-models","is-loading"])]),default:n(()=>[r(p,{type:"text",size:"small",loading:H.value,disabled:H.value},{icon:n(()=>[r(y(Lt))]),default:n(()=>[t[22]||(t[22]=O(" Model Lists ")),r(y(xt))]),_:1,__:[22]},8,["loading","disabled"])]),_:1},8,["open","disabled"]),Je.value?(c(),I(Me,{key:0},{overlay:n(()=>[r(mt,null,{default:n(()=>[r(Oe,{key:"privacy"},{default:n(()=>[e("div",sa,[r($e,{checked:N.value.hideOpenRouterFree,"onUpdate:checked":t[7]||(t[7]=w=>N.value.hideOpenRouterFree=w),onChange:we},{default:n(()=>t[23]||(t[23]=[O(" Hide free models (privacy concerns) ")])),_:1,__:[23]},8,["checked"])])]),_:1}),r(Oe,{key:"auto"},{default:n(()=>[e("div",aa,[r($e,{checked:N.value.hideOpenRouterAuto,"onUpdate:checked":t[8]||(t[8]=w=>N.value.hideOpenRouterAuto=w),onChange:we},{default:n(()=>t[24]||(t[24]=[O(" Hide Auto Router (unpredictable costs) ")])),_:1,__:[24]},8,["checked"])])]),_:1})]),_:1})]),default:n(()=>[r(p,{type:"text",size:"small"},{icon:n(()=>[r(y(Ne))]),default:n(()=>[t[25]||(t[25]=O(" OpenRouter Settings "))]),_:1,__:[25]})]),_:1})):j("",!0)]),e("div",oa,[e("span",null,f(We.value)+" of "+f(Ke.value)+" models enabled",1)])]),r(De,{activeKey:Q.value,"onUpdate:activeKey":t[9]||(t[9]=w=>Q.value=w),bordered:!1,class:"provider-collapse",destroyInactivePanel:!1},{default:n(()=>[(c(!0),h(X,null,oe(de.value,(w,G)=>(c(),I(Pe,{key:`provider-${G}`},{header:n(()=>{var Ae,Ee;return[e("div",la,[e("div",na,[e("strong",null,f(y(J)(G)),1),(Ae=Z.value[G])!=null&&Ae.requiresKey&&!((Ee=Z.value[G])!=null&&Ee.hasKey)?(c(),I(ft,{key:0,placement:"top"},{title:n(()=>{var ne;return[O(" API key not set for "+f((ne=Z.value[G])==null?void 0:ne.providerGroup)+". Click to add in settings. ",1)]}),default:n(()=>[r(p,{type:"link",danger:"",size:"small",onClick:re(ne=>{var Se;return at((Se=Z.value[G])==null?void 0:Se.providerGroup)},["stop"])},{icon:n(()=>[r(y(Rt))]),default:n(()=>[t[26]||(t[26]=O(" API Key Missing "))]),_:2,__:[26]},1032,["onClick"])]),_:2},1024)):j("",!0),Q.value.includes(G)?(c(),h(X,{key:2},[r(k,{size:"small",color:"blue"},{default:n(()=>[O(f(w.length)+" models",1)]),_:2},1024),r(k,{size:"small",color:et(G)},{default:n(()=>[O(f(fe.value[G]||0)+" enabled ",1)]),_:2},1032,["color"])],64)):(c(),h("span",ra,f(fe.value[G]||0)+" / "+f((y(l)[G]||[]).length)+" enabled ",1))]),r(L,{size:"small"},{default:n(()=>[r(p,{type:"text",size:"small",onClick:re(ne=>ke(G,!0),["stop"]),disabled:tt(G)||H.value,loading:H.value},{icon:n(()=>[r(y(Le))]),default:n(()=>[t[27]||(t[27]=O(" Enable All "))]),_:2,__:[27]},1032,["onClick","disabled","loading"]),r(p,{type:"text",size:"small",onClick:re(ne=>ke(G,!1),["stop"]),disabled:st(G)||H.value,loading:H.value},{icon:n(()=>[r(y(Re))]),default:n(()=>[t[28]||(t[28]=O(" Disable All "))]),_:2,__:[28]},1032,["onClick","disabled","loading"])]),_:2},1024)])]}),default:n(()=>[(c(),I(wt,null,[r(is,{models:w,"provider-id":G,onToggleModel:lt},null,8,["models","provider-id"])],1024))]),_:2},1024))),128))]),_:1},8,["activeKey"]),Object.keys(de.value).length===0?(c(),I(gt,{key:4,description:qe.value,class:"empty-state"},null,8,["description"])):j("",!0),He.value?(c(),I(De,{key:5,activeKey:he.value,"onUpdate:activeKey":t[10]||(t[10]=w=>he.value=w),bordered:!1,class:"ollama-manager-collapse"},{default:n(()=>[r(Pe,{key:"ollama"},{header:n(()=>t[29]||(t[29]=[e("div",{class:"ollama-header"},[e("strong",null,"Ollama Model Management"),e("span",{class:"ollama-description"},"Download and manage local Ollama models")],-1)])),default:n(()=>[r(Mt,{onModelsUpdated:dt})]),_:1})]),_:1},8,["activeKey"])):j("",!0),je.value?(c(),I(Ls,{key:6,class:"enhanced-features"})):j("",!0)])}}}),ba=ce(ia,[["__scopeId","data-v-5fbbcd2a"]]);export{ba as default};
