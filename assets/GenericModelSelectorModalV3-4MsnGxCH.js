import{d as te,c as V,R as v,Y as a,S as f,k as D,a0 as de,F as G,_,G as E,U as M,f as X,$ as b,Z as k,W as Y,B as he,u as Q,r as ue,w as ne,o as re,X as ke}from"./vue-vendor-C9mtdEbx.js";import{u as Ce}from"./useV4Models-8nYyZjwR.js";import{u as ce}from"./useV4ProviderParameters-B-zjDfSb.js";import{k as oe,q as $e,a as T,r as be}from"./index-D335VTKO.js";import{u as Me}from"./useCostEstimation-CWNhpoK8.js";import{_ as ye,ak as pe,al as me,n as se,ao as Te,z as xe,G as Pe,a4 as Oe,a2 as De,a3 as we,aj as Ie,ap as Ue,a5 as Ae,a6 as Fe,H as Ee,T as Se,a7 as Re,J as Ve,x as je,O as qe,a1 as Be,S as Ge}from"./ui-vendor-CYb6WBrN.js";const ze={class:"model-search-filters"},Ne={class:"panel-header"},Ke={class:"search-container"},Le=te({__name:"ModelSearchFiltersV3",props:{modelValue:{}},emits:["update:modelValue"],setup(J,{emit:s}){const e=J,I=s,h=V({get:()=>e.modelValue,set:P=>I("update:modelValue",P)});return(P,O)=>{const c=ye;return a(),v("div",ze,[f("div",Ne,[O[2]||(O[2]=f("h3",null,"Available Models",-1)),f("div",Ke,[O[1]||(O[1]=f("span",{class:"search-label"},"Search:",-1)),D(c,{value:h.value,"onUpdate:value":O[0]||(O[0]=C=>h.value=C),placeholder:"Search models...",size:"large","allow-clear":"",class:"search-input"},null,8,["value"])])])])}}}),Je=oe(Le,[["__scopeId","data-v-56bdd915"]]),We=["title"],He={key:0,class:"cost-group"},Qe={class:"cost-item"},Xe={class:"cost-value"},Ye={class:"cost-value"},Ze={key:1,class:"cost-group"},et={class:"enviro-group"},tt={key:0,class:"enviro-item"},ot={key:1,class:"cost-tab"},nt={key:2,class:"enviro-item"},st={key:3,class:"cost-tab"},lt={key:4,class:"enviro-item"},at={key:0,class:"cost-group"},it={class:"cost-item"},ut={class:"cost-value"},dt={class:"cost-value"},rt={class:"enviro-group"},ct={key:0,class:"enviro-item"},pt={key:1,class:"cost-tab"},mt={key:2,class:"enviro-item"},ft={key:3,class:"cost-tab"},vt={key:4,class:"enviro-item"},gt={key:0,class:"cost-item financial"},_t={key:0,class:"cost-value"},ht={key:1,class:"cost-value"},kt={key:1,class:"cost-item environmental"},Ct={key:0,class:"enviro-item"},$t={class:"enviro-value"},bt={key:1,class:"enviro-item"},Mt={class:"enviro-value"},yt={key:2,class:"enviro-item"},Tt={class:"enviro-value"},xt={key:3,class:"cost-unit"},Pt=te({__name:"ModelCostDisplayV3",props:{model:{},mode:{default:"per-thousand"},inputTokens:{default:1e3},outputTokens:{default:1e3},minOutputTokens:{default:10},maxOutputTokens:{},layout:{default:"inline"},size:{default:"medium"}},setup(J){const s=J,e=$e(),I=V(()=>!0),h=V(()=>e.preferences.showCO2),P=V(()=>e.preferences.showWater),O=V(()=>e.preferences.showElectricity);function c(){if(!s.model.capabilities)return"â€”";const t=s.model.capabilities.inputCostPerToken||0,p=s.model.capabilities.outputCostPerToken||0;if(s.mode==="per-thousand"){const g=(t+p)*1e3;return C(g)}else if(s.mode==="total")if(s.inputTokens!=null&&s.outputTokens!=null){const g=t*s.inputTokens+p*s.outputTokens;return C(g)}else return"??";return"â€”"}function C(t){if(t===0)return"0.00";if(t<.01){let p=2,g=t;for(;g<.1;)g*=10,p++;return t.toFixed(p)}return t<1?t.toFixed(3):t<10?t.toFixed(2):t<100?t.toFixed(1):Math.round(t).toLocaleString()}function U(t){if(t===0)return"0.00";if(t<.01){let p=2,g=t;for(;g<.1;)g*=10,p++;return t.toFixed(p)}return t<1?t.toFixed(3):t<10?t.toFixed(2):t<100?t.toFixed(1):Math.round(t).toLocaleString()}function j(){if(!s.model.capabilities)return"0";const t=(s.model.capabilities.inputCostPerToken||0)*1e3;return U(t)}function S(){if(!s.model.capabilities)return"0";const t=(s.model.capabilities.outputCostPerToken||0)*1e3;return U(t)}function H(){if(!s.model.capabilities||s.inputTokens==null||s.minOutputTokens==null)return"??";const t=s.model.capabilities.inputCostPerToken||0,p=s.model.capabilities.outputCostPerToken||0,g=t*s.inputTokens+p*s.minOutputTokens;return U(g)}function K(){if(!s.model.capabilities||s.inputTokens==null||s.maxOutputTokens==null)return"??";const t=s.model.capabilities.inputCostPerToken||0,p=s.model.capabilities.outputCostPerToken||0,g=t*s.inputTokens+p*s.maxOutputTokens;return U(g)}function z(t){return"??"}function B(t){return"??"}const w=V(()=>{const t=[];t.push("=== ModelCostDisplayV3 Debug ==="),t.push(`Mode: ${s.mode}`),t.push(`Model: ${s.model.provider}:${s.model.modelId}`),t.push(`Layout: ${s.layout}, Size: ${s.size}`),t.push(""),t.push("=== Token Input Data ==="),s.inputTokens&&t.push(`Input Tokens: ${s.inputTokens}`),s.outputTokens&&t.push(`Output Tokens: ${s.outputTokens}`),s.minOutputTokens&&t.push(`Min Output Tokens: ${s.minOutputTokens}`),s.maxOutputTokens&&t.push(`Max Output Tokens: ${s.maxOutputTokens}`),t.push(""),t.push("=== Model Pricing Rates ===");const p=s.model.capabilities?.inputCostPerToken||0,g=s.model.capabilities?.outputCostPerToken||0;if(t.push(`Input Rate: $${p} per token ($${(p*1e3).toFixed(4)}/1K)`),t.push(`Output Rate: $${g} per token ($${(g*1e3).toFixed(4)}/1K)`),t.push(""),t.push(`=== Calculations (Mode: ${s.mode}) ===`),s.mode==="per-thousand"){const F=(p+g)*1e3;t.push(`Combined rate per 1K: ($${p} + $${g}) Ã— 1000 = $${F.toFixed(6)}`),t.push(`Display: ${c()}`)}else if(s.mode==="total"&&s.inputTokens!=null&&s.outputTokens!=null){const F=p*s.inputTokens,q=g*s.outputTokens,L=F+q;t.push(`Input cost: $${p} Ã— ${s.inputTokens} = $${F.toFixed(6)}`),t.push(`Output cost: $${g} Ã— ${s.outputTokens} = $${q.toFixed(6)}`),t.push(`Total cost: $${F.toFixed(6)} + $${q.toFixed(6)} = $${L.toFixed(6)}`),t.push(`Display: ${c()}`)}else if(s.mode==="range"&&s.inputTokens!=null&&s.minOutputTokens!=null&&s.maxOutputTokens!=null){const F=p*s.inputTokens,q=g*s.minOutputTokens,L=g*s.maxOutputTokens,Z=F+q,ee=F+L;t.push(`Input cost: $${p} Ã— ${s.inputTokens} = $${F.toFixed(6)}`),t.push(`Min output cost: $${g} Ã— ${s.minOutputTokens} = $${q.toFixed(6)}`),t.push(`Max output cost: $${g} Ã— ${s.maxOutputTokens} = $${L.toFixed(6)}`),t.push(`Min total: $${F.toFixed(6)} + $${q.toFixed(6)} = $${Z.toFixed(6)}`),t.push(`Max total: $${F.toFixed(6)} + $${L.toFixed(6)} = $${ee.toFixed(6)}`),t.push(`Display: ${H()} - ${K()}`)}else if(s.mode==="input-output"){const F=p*1e3,q=g*1e3;t.push(`Input per 1K: $${p} Ã— 1000 = $${F.toFixed(6)}`),t.push(`Output per 1K: $${g} Ã— 1000 = $${q.toFixed(6)}`),t.push(`Display: $${j()}/1K input + $${S()}/1K output`)}else t.push("No calculations available for this mode/input combination");return t.join(`
`)});function A(){const t=w.value;T.info("ðŸ” ModelCostDisplayV3 Debug Info:",{mode:s.mode,model:`${s.model.provider}:${s.model.modelId}`,inputTokens:s.inputTokens,outputTokens:s.outputTokens,minOutputTokens:s.minOutputTokens,maxOutputTokens:s.maxOutputTokens,layout:s.layout,size:s.size,inputRate:s.model.capabilities?.inputCostPerToken,outputRate:s.model.capabilities?.outputCostPerToken,calculations:t.split(`
`).filter(p=>p.includes("=")).join(" | ")}),T.info(`ðŸ“Š ModelCostDisplayV3 Full Debug:
`+t)}return(t,p)=>(a(),v("div",{class:de(["model-cost-display",[`layout-${t.layout}`,`size-${t.size}`]]),title:w.value,onMouseenter:A},[t.mode==="range"?(a(),v(G,{key:0},[I.value&&t.maxOutputTokens?(a(),v("span",He,[f("span",Qe,[p[0]||(p[0]=f("span",{class:"debug-mode"},"range:",-1)),f("span",Xe,"$"+M(H()),1),p[1]||(p[1]=E(" - ")),f("span",Ye,"$"+M(K()),1)])])):I.value?(a(),v("span",Ze,p[2]||(p[2]=[f("span",{class:"cost-item"},[f("span",{class:"debug-mode"},"range:"),f("span",{class:"cost-value"},"Cost: ??")],-1)]))):_("",!0),p[3]||(p[3]=f("span",{class:"cost-tab"},null,-1)),f("span",et,[h.value?(a(),v("span",tt,"COâ‚‚ "+M(B()),1)):_("",!0),h.value&&P.value?(a(),v("span",ot)):_("",!0),P.value?(a(),v("span",nt,"ðŸ’§"+M(B()),1)):_("",!0),(h.value||P.value)&&O.value?(a(),v("span",st)):_("",!0),O.value?(a(),v("span",lt,"âš¡"+M(B()),1)):_("",!0)])],64)):t.mode==="input-output"?(a(),v(G,{key:1},[I.value?(a(),v("span",at,[f("span",it,[p[4]||(p[4]=f("span",{class:"debug-mode"},"input-output:",-1)),f("span",ut,"$"+M(j()),1),p[5]||(p[5]=E("/1K input + ")),f("span",dt,"$"+M(S()),1),p[6]||(p[6]=E("/1K output "))])])):_("",!0),p[7]||(p[7]=f("span",{class:"cost-tab"},null,-1)),f("span",rt,[h.value?(a(),v("span",ct,"COâ‚‚ "+M(z()),1)):_("",!0),h.value&&P.value?(a(),v("span",pt)):_("",!0),P.value?(a(),v("span",mt,"ðŸ’§"+M(z()),1)):_("",!0),(h.value||P.value)&&O.value?(a(),v("span",ft)):_("",!0),O.value?(a(),v("span",vt,"âš¡"+M(z()),1)):_("",!0)])],64)):(a(),v(G,{key:2},[I.value?(a(),v("div",gt,[t.mode==="per-thousand"?(a(),v("span",_t,[p[8]||(p[8]=f("span",{class:"debug-mode"},"per-thousand:",-1)),E(" "+M(c())+" ",1),p[9]||(p[9]=f("span",{class:"cost-unit"},"/ 1,000 tokens",-1))])):t.mode==="total"?(a(),v("span",ht,[p[10]||(p[10]=f("span",{class:"debug-mode"},"total:",-1)),E(" "+M(c()),1)])):_("",!0)])):_("",!0),h.value||P.value||O.value?(a(),v("div",kt,[h.value?(a(),v("span",Ct,[p[11]||(p[11]=f("span",{class:"enviro-icon"},"COâ‚‚",-1)),f("span",$t,M(z()),1)])):_("",!0),P.value?(a(),v("span",bt,[p[12]||(p[12]=f("span",{class:"enviro-icon"},"ðŸ’§",-1)),f("span",Mt,M(z()),1)])):_("",!0),O.value?(a(),v("span",yt,[p[13]||(p[13]=f("span",{class:"enviro-icon"},"âš¡",-1)),f("span",Tt,M(z()),1)])):_("",!0),t.mode==="per-thousand"?(a(),v("span",xt,"/ 1,000")):_("",!0)])):_("",!0)],64))],42,We))}}),fe=oe(Pt,[["__scopeId","data-v-9626c100"]]),Ot={class:"provider-header"},Dt={class:"provider-name"},wt={class:"provider-model-count"},It={key:0,class:"api-key-warning"},Ut={class:"provider-models"},At=["onClick"],Ft={class:"model-name"},Et={key:0,class:"model-specs"},St=te({__name:"ModelProviderGroupV3",props:{groupedModels:{},selectedModelId:{},mode:{},getInputTokensForModel:{type:Function},getOutputTokensForModel:{type:Function},hasConfigPanel:{type:Boolean},requiresApiKey:{type:Function},getProviderGroup:{type:Function},hasApiKey:{type:Function}},emits:["select-model"],setup(J){const s=X(void 0);function e(h){return h}function I(h){s.value===h?s.value=void 0:s.value=h}return(h,P)=>{const O=se,c=me,C=pe;return a(),b(C,{activeKey:s.value,"onUpdate:activeKey":P[0]||(P[0]=U=>s.value=U),bordered:!1,accordion:""},{default:k(()=>[(a(!0),v(G,null,Y(h.groupedModels,(U,j)=>(a(),b(c,{key:j,class:"provider-panel","data-provider":j},{header:k(()=>[f("div",Ot,[f("span",Dt,M(j),1),f("span",wt,M(U.length)+" models",1),h.requiresApiKey(j)&&!h.hasApiKey(h.getProviderGroup(j))?(a(),v("div",It,[D(Q(Te)),P[1]||(P[1]=f("span",null,"API Key Missing",-1))])):_("",!0)])]),extra:k(()=>[D(O,{size:"small",type:"text",onClick:he(S=>I(j),["stop"])},{default:k(()=>[E(M(s.value===j?"Collapse":"Expand"),1)]),_:2},1032,["onClick"])]),default:k(()=>[f("div",Ut,[(a(!0),v(G,null,Y(U,S=>(a(),v("div",{key:S.id,class:de(["model-row",{selected:h.selectedModelId===S.id}]),onClick:H=>h.$emit("select-model",S)},[f("div",Ft,M(S.displayName),1),h.hasConfigPanel?_("",!0):(a(),v("div",Et,[D(fe,{model:S,mode:h.mode==="trial"?"range":"input-output","input-tokens":h.getInputTokensForModel(S),"min-output-tokens":10,"max-output-tokens":h.getOutputTokensForModel(S),layout:"inline",size:"medium"},null,8,["model","mode","input-tokens","max-output-tokens"])]))],10,At))),128))])]),_:2},1032,["data-provider"]))),128))]),_:1},8,["activeKey"])}}}),Rt=oe(St,[["__scopeId","data-v-7ff59b1f"]]),Vt={class:"config-panel"},jt={class:"config-header"},qt={class:"config-header-title"},Bt={key:0,class:"total-cost"},Gt={key:0,class:"cost-info"},zt={class:"config-content"},Nt={key:0,class:"json-error"},Kt={class:"param-description"},Lt={key:0,class:"json-error"},Jt={class:"param-description"},Wt={key:0,class:"config-footer"},Ht={key:0,class:"duplicate-error"},Qt=te({__name:"ModelConfigurationPanelV3",props:{selectedModel:{},mode:{},totalCalls:{default:1},costEstimate:{},tokenData:{},getInputTokensForModel:{},getOutputTokensForModel:{},existingConfigurations:{},showCloseButton:{type:Boolean,default:!0},initialParameters:{}},emits:["close","add-configuration","confirm-selection","parameters-changed"],setup(J,{emit:s}){const e=J,I=s,{getBasicParameters:h,getAdvancedParameters:P}=ce(),O=X(""),c=ue({}),C=ue({}),U=X(""),j=V(()=>e.selectedModel?h(e.selectedModel.provider,e.selectedModel.modelId):{}),S=V(()=>e.selectedModel?P(e.selectedModel.provider,e.selectedModel.modelId):{}),H=V(()=>{if(e.tokenData)return e.tokenData.totalTokens;const l=e.costEstimate?.inputTokens?.avgTokens??e.getInputTokensForModel?.(e.selectedModel);return l==null?null:l*(e.totalCalls??1)}),K=V(()=>{const l=e.getOutputTokensForModel?.(e.selectedModel);return e.costEstimate?.outputTokens&&e.tokenData?e.costEstimate.outputTokens*e.tokenData.combinationCount:l??null}),z=V(()=>{if(e.tokenData)return 10*e.tokenData.combinationCount;const l=e.totalCalls;return l==null?null:10*l}),B=V(()=>e.getOutputTokensForModel?.(e.selectedModel)??null);function w(l){if(!l)return;T.info("PARAMDEBUG: setModelDefaults called for",l.provider,l.modelId,"mode:",e.mode),e.mode==="trial"&&(O.value=`${l.provider}:${l.displayName}`),Object.keys(c).forEach(o=>delete c[o]),Object.keys(C).forEach(o=>delete C[o]);const i=h(l.provider,l.modelId),$=P(l.provider,l.modelId),u={...i,...$};if(e.initialParameters&&Object.keys(e.initialParameters).length>0){T.info("PARAMDEBUG: using initial parameters:",e.initialParameters),Object.assign(c,e.initialParameters);for(const[o,d]of Object.entries(e.initialParameters)){const y=u[o];d===y?.default?C[o]={mode:"default"}:C[o]={mode:"custom",value:d}}}else{T.info("PARAMDEBUG: allParams found:",Object.keys(u));for(const[o,d]of Object.entries(u))d.fixed?d.default!==void 0?(C[o]={mode:"default"},c[o]=d.default,T.info("PARAMDEBUG: setting FIXED param",o,"to default =",d.default)):(T.warn("PARAMDEBUG: Fixed parameter",o,"has no default value!"),C[o]={mode:"unset"},c[o]=d.type==="array"?[]:null):d.required?d.default!==void 0?(C[o]={mode:"default"},c[o]=d.default,T.info("PARAMDEBUG: setting required param",o,"to default =",d.default)):(C[o]={mode:"custom",value:null},c[o]=d.type==="array"?[]:null,T.info("PARAMDEBUG: required param",o,"needs user input")):d.default!==void 0?(C[o]={mode:"default"},c[o]=d.default,T.info("PARAMDEBUG: setting optional param",o,"to default =",d.default)):(C[o]={mode:"unset"},c[o]=d.type==="array"?[]:null,T.info("PARAMDEBUG: optional param",o,"starts unset"));for(const[o,d]of Object.entries(u))d.type==="object"&&c[o]&&(c[o+"_json"]=JSON.stringify(c[o],null,2));T.info("PARAMDEBUG: final parameters:",{...c}),T.info("PARAMDEBUG: parameter states:",{...C})}}ne(()=>e.selectedModel,l=>{w(l),U.value=""},{immediate:!0}),ne(c,()=>{U.value=""},{deep:!0}),re(()=>{e.selectedModel&&w(e.selectedModel)});function A(l,i){const $=C[l],u=c[l];return T.info("PLACEHOLDER DEBUG:",l,"state:",$?.mode,"value:",u,"param.default:",i.default),!i.required&&(u==null||u==="")||$?.mode==="unset"?"Not set (parameter will be omitted)":i.default!==void 0?$?.mode==="default"?`Using default: ${i.default}`:`Default: ${i.default} (enter to override)`:i.required?"Required - enter value":"Enter value (optional)"}function t(l){const i=C[l],$=e.selectedModel?h(e.selectedModel.provider,e.selectedModel.modelId):{},u=e.selectedModel?P(e.selectedModel.provider,e.selectedModel.modelId):{},o=$[l]||u[l];if(o?.required&&i?.mode==="unset"||o?.required&&i?.mode==="custom"&&!i.value)return"error";if(i?.mode==="default")return"warning"}function p(l){return l.replace(/\./g," â€º ").replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())}function g(l,i,$){if(!$&&e.selectedModel){const o=h(e.selectedModel.provider,e.selectedModel.modelId),d=P(e.selectedModel.provider,e.selectedModel.modelId);$=o[l]||d[l]}T.info("PARAMDEBUG: handleParameterChange",l,"new value:",i,"param.required:",$?.required),i==null||i===""||Array.isArray(i)&&i.length===0?$?.required?$.default!==void 0&&(c[l]=$.default,C[l]={mode:"default"},T.info("PARAMDEBUG: Required param",l,"cleared, reverting to default:",$.default)):(c[l]=$?.type==="array"?[]:null,C[l]={mode:"unset"},T.info("PARAMDEBUG: Optional param",l,"cleared, setting to unset")):(c[l]=i,i===$?.default?C[l]={mode:"default"}:C[l]={mode:"custom",value:i});const u=q({...c});I("parameters-changed",u)}function F(l,i,$){try{if(!i.trim()){g(l,null,$);return}const u=JSON.parse(i);g(l,u,$),delete c[l+"_json_error"]}catch{c[l+"_json_error"]="Invalid JSON format"}}function q(l){const i={...l};return Object.keys(i).filter(u=>u.includes(".")).forEach(u=>{const o=u.split(".")[0];o in i&&(i[o]===null||i[o]===void 0)&&(delete i[o],T.info(`PARAMDEBUG: Removed conflicting parent key "${o}" for nested param "${u}"`))}),i}function L(){const l=[],i=e.selectedModel?h(e.selectedModel.provider,e.selectedModel.modelId):{},$=e.selectedModel?P(e.selectedModel.provider,e.selectedModel.modelId):{},u={...i,...$};for(const[o,d]of Object.entries(C)){const y=u[o];y?.required&&(d.mode==="unset"?l.push(`${p(o)} is required`):d.mode==="custom"&&(d.value===null||d.value===void 0||d.value==="")&&l.push(`${p(o)} needs a value`)),d.mode==="custom"&&d.value!==void 0&&d.value!==null&&(y?.min!==void 0&&d.value<y.min&&l.push(`${p(o)} must be >= ${y.min}`),y?.max!==void 0&&d.value>y.max&&l.push(`${p(o)} must be <= ${y.max}`))}return{valid:l.length===0,errors:l}}function Z(){if(!e.selectedModel||e.mode==="trial"&&!O.value)return null;const l={},i=h(e.selectedModel.provider,e.selectedModel.modelId),$=P(e.selectedModel.provider,e.selectedModel.modelId),u={...i,...$},o=(d,y,R)=>{const x=y.split(".");let N=d;for(let W=0;W<x.length-1;W++)N[x[W]]||(N[x[W]]={}),N=N[x[W]];N[x[x.length-1]]=R};for(const[d,y]of Object.entries(C)){const R=u[d];let x;switch(y.mode){case"default":x=R?.default,T.info("PARAMDEBUG: Using default for",d,"=",x);break;case"custom":x=y.value,T.info("PARAMDEBUG: Using custom value for",d,"=",x);break;case"unset":T.info("PARAMDEBUG: Skipping unset param",d);continue}x!=null&&x!==""?o(l,d,x):x===!1?o(l,d,!1):R?.required&&T.error(`Required parameter ${d} has no valid value`)}return{name:e.mode==="trial"?O.value:`${e.selectedModel.provider}:${e.selectedModel.displayName}`,provider:e.selectedModel.provider,modelId:e.selectedModel.modelId,parameters:l}}function ee(){U.value="";const l=L();if(!l.valid){U.value=`Invalid configuration: ${l.errors.join(", ")}`;return}const i=Z();if(i){if(e.existingConfigurations&&e.existingConfigurations.some(u=>u.provider===i.provider&&u.modelId===i.modelId&&JSON.stringify(u.parameters)===JSON.stringify(i.parameters))){U.value=`${i.provider}:${i.modelId} with these parameters is already added. Please modify the parameters or select a different model.`;return}I("add-configuration",i)}}return(l,i)=>{const $=se,u=Oe,o=Pe,d=Se,y=Ie,R=Ue,x=Fe,N=Ae,W=Ee,le=we,ae=De,ie=me,ve=pe,ge=Re,_e=Ve;return a(),v("div",Vt,[f("div",jt,[f("div",qt,[f("h3",null,M(l.mode==="trial"?"Configure":"Model Parameters")+": "+M(l.selectedModel.displayName),1),l.showCloseButton?(a(),b($,{key:0,type:"text",onClick:i[0]||(i[0]=n=>l.$emit("close")),class:"config-close-btn","aria-label":"Close configuration panel"},{default:k(()=>[D(Q(xe))]),_:1})):_("",!0)]),l.mode==="trial"?(a(),v("div",Bt,[D(fe,{model:l.selectedModel,mode:"range","input-tokens":H.value,"output-tokens":K.value,"min-output-tokens":z.value,"max-output-tokens":B.value,layout:"inline",size:"large"},null,8,["model","input-tokens","output-tokens","min-output-tokens","max-output-tokens"]),l.totalCalls>1?(a(),v("span",Gt,"("+M(l.totalCalls)+" calls total)",1)):_("",!0)])):_("",!0)]),f("div",zt,[D(ge,{layout:"vertical"},{default:k(()=>[l.mode==="trial"?(a(),b(o,{key:0,label:"Configuration Name",required:""},{default:k(()=>[D(u,{value:O.value,"onUpdate:value":i[1]||(i[1]=n=>O.value=n),placeholder:"e.g., openai:GPT-4 Creative, anthropic:Claude-3 Analytical",size:"large"},null,8,["value"])]),_:1})):_("",!0),D(ve,{"default-active-key":["basic"],ghost:""},{default:k(()=>[D(ie,{key:"basic",header:"Basic Parameters"},{default:k(()=>[D(ae,{gutter:16},{default:k(()=>[(a(!0),v(G,null,Y(j.value,(n,r)=>(a(),b(le,{key:r,span:l.mode==="playground"?24:12},{default:k(()=>[D(o,null,{label:k(()=>[f("span",null,M(p(r)),1),n.required?(a(),b(d,{key:0,color:"red",size:"small",style:{"margin-left":"8px"}},{default:k(()=>i[2]||(i[2]=[E("Required")])),_:1,__:[2]})):C[r]?.mode==="default"?(a(),b(d,{key:1,color:"blue",size:"small",style:{"margin-left":"8px"}},{default:k(()=>i[3]||(i[3]=[E("Default")])),_:1,__:[3]})):C[r]?.mode==="unset"?(a(),b(d,{key:2,color:"gray",size:"small",style:{"margin-left":"8px"}},{default:k(()=>i[4]||(i[4]=[E("Not Set")])),_:1,__:[4]})):_("",!0)]),default:k(()=>[n.type==="number"?(a(),b(y,{key:0,value:c[r],"onUpdate:value":m=>c[r]=m,min:n.min,max:n.max,step:.1,placeholder:A(r,n),"allow-clear":!n.required,status:t(r),disabled:n.fixed,style:{width:"100%"},size:"large",onChange:m=>g(r,m,n)},null,8,["value","onUpdate:value","min","max","placeholder","allow-clear","status","disabled","onChange"])):n.type==="integer"?(a(),b(y,{key:1,value:c[r],"onUpdate:value":m=>c[r]=m,min:n.min,max:n.max,placeholder:A(r,n),"allow-clear":!n.required,status:t(r),disabled:n.fixed,style:{width:"100%"},size:"large",onChange:m=>g(r,m,n)},null,8,["value","onUpdate:value","min","max","placeholder","allow-clear","status","disabled","onChange"])):n.type==="boolean"?(a(),b(R,{key:2,checked:c[r],"onUpdate:checked":m=>c[r]=m,"checked-children":"true","un-checked-children":"false",disabled:n.fixed,onChange:m=>g(r,m,n)},null,8,["checked","onUpdate:checked","disabled","onChange"])):n.type==="string"&&n.enum?(a(),b(N,{key:3,value:c[r],"onUpdate:value":m=>c[r]=m,placeholder:n.default?`Default: ${n.default}`:"Select value",size:"large",style:{width:"100%"},"allow-clear":!n.required,status:t(r),disabled:n.fixed,onChange:m=>g(r,m,n)},{default:k(()=>[n.default?(a(),b(x,{key:0,value:n.default},{default:k(()=>[E(M(n.default)+" (default) ",1)]),_:2},1032,["value"])):_("",!0),n.required?_("",!0):(a(),b(x,{key:1,value:void 0},{default:k(()=>i[5]||(i[5]=[f("span",{style:{color:"#999"}},"<not set>",-1)])),_:1,__:[5]})),(a(!0),v(G,null,Y(n.enum.filter(m=>m!==n.default),m=>(a(),b(x,{key:m,value:m},{default:k(()=>[E(M(m),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder","allow-clear","status","disabled","onChange"])):n.type==="array"?(a(),b(N,{key:4,value:c[r],"onUpdate:value":m=>c[r]=m,mode:"tags",placeholder:A(r,n),disabled:n.fixed,size:"large",style:{width:"100%"},onChange:m=>g(r,m,n)},null,8,["value","onUpdate:value","placeholder","disabled","onChange"])):n.type==="object"?(a(),v(G,{key:5},[D(W,{value:c[r+"_json"],"onUpdate:value":m=>c[r+"_json"]=m,placeholder:JSON.stringify(n.default||{},null,2),disabled:n.fixed,rows:3,status:c[r+"_json_error"]?"error":"",onInput:m=>F(r,m.target.value,n)},null,8,["value","onUpdate:value","placeholder","disabled","status","onInput"]),c[r+"_json_error"]?(a(),v("div",Nt,M(c[r+"_json_error"]),1)):_("",!0)],64)):n.type==="string"?(a(),b(u,{key:6,value:c[r],"onUpdate:value":m=>c[r]=m,placeholder:A(r,n),"allow-clear":!n.required,status:t(r),disabled:n.fixed,size:"large"},null,8,["value","onUpdate:value","placeholder","allow-clear","status","disabled"])):_("",!0),f("div",Kt,M(n.description),1)]),_:2},1024)]),_:2},1032,["span"]))),128))]),_:1})]),_:1}),Object.keys(S.value).length>0?(a(),b(ie,{key:"advanced",header:"Advanced Parameters"},{default:k(()=>[D(ae,{gutter:16},{default:k(()=>[(a(!0),v(G,null,Y(S.value,(n,r)=>(a(),b(le,{key:r,span:l.mode==="playground"?24:12},{default:k(()=>[D(o,null,{label:k(()=>[f("span",null,M(p(r)),1),n.required?(a(),b(d,{key:0,color:"red",size:"small",style:{"margin-left":"8px"}},{default:k(()=>i[6]||(i[6]=[E("Required")])),_:1,__:[6]})):C[r]?.mode==="default"?(a(),b(d,{key:1,color:"blue",size:"small",style:{"margin-left":"8px"}},{default:k(()=>i[7]||(i[7]=[E("Default")])),_:1,__:[7]})):C[r]?.mode==="unset"?(a(),b(d,{key:2,color:"gray",size:"small",style:{"margin-left":"8px"}},{default:k(()=>i[8]||(i[8]=[E("Not Set")])),_:1,__:[8]})):_("",!0)]),default:k(()=>[n.type==="number"||n.type==="integer"?(a(),b(y,{key:0,value:c[r],"onUpdate:value":m=>c[r]=m,min:n.min,max:n.max,step:n.type==="number"?.1:1,placeholder:A(r,n),"allow-clear":!n.required,status:t(r),disabled:n.fixed,style:{width:"100%"},size:"large",onChange:m=>g(r,m,n)},null,8,["value","onUpdate:value","min","max","step","placeholder","allow-clear","status","disabled","onChange"])):n.type==="boolean"?(a(),b(R,{key:1,checked:c[r],"onUpdate:checked":m=>c[r]=m,"checked-children":"true","un-checked-children":"false",disabled:n.fixed,onChange:m=>g(r,m,n)},null,8,["checked","onUpdate:checked","disabled","onChange"])):n.type==="string"&&n.enum?(a(),b(N,{key:2,value:c[r],"onUpdate:value":m=>c[r]=m,placeholder:n.default?`Default: ${n.default}`:"Select value",size:"large",style:{width:"100%"},"allow-clear":!n.required,status:t(r),disabled:n.fixed,onChange:m=>g(r,m,n)},{default:k(()=>[n.default?(a(),b(x,{key:0,value:n.default},{default:k(()=>[E(M(n.default)+" (default) ",1)]),_:2},1032,["value"])):_("",!0),n.required?_("",!0):(a(),b(x,{key:1,value:void 0},{default:k(()=>i[9]||(i[9]=[f("span",{style:{color:"#999"}},"<not set>",-1)])),_:1,__:[9]})),(a(!0),v(G,null,Y(n.enum.filter(m=>m!==n.default),m=>(a(),b(x,{key:m,value:m},{default:k(()=>[E(M(m),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder","allow-clear","status","disabled","onChange"])):n.type==="array"?(a(),b(N,{key:3,value:c[r],"onUpdate:value":m=>c[r]=m,mode:"tags",placeholder:A(r,n),disabled:n.fixed,size:"large",style:{width:"100%"},onChange:m=>g(r,m,n)},null,8,["value","onUpdate:value","placeholder","disabled","onChange"])):n.type==="object"?(a(),v(G,{key:4},[D(W,{value:c[r+"_json"],"onUpdate:value":m=>c[r+"_json"]=m,placeholder:JSON.stringify(n.default||{},null,2),disabled:n.fixed,rows:3,status:c[r+"_json_error"]?"error":"",onInput:m=>F(r,m.target.value,n)},null,8,["value","onUpdate:value","placeholder","disabled","status","onInput"]),c[r+"_json_error"]?(a(),v("div",Lt,M(c[r+"_json_error"]),1)):_("",!0)],64)):n.type==="string"?(a(),b(u,{key:5,value:c[r],"onUpdate:value":m=>c[r]=m,placeholder:A(r,n),"allow-clear":!n.required,status:t(r),disabled:n.fixed,size:"large"},null,8,["value","onUpdate:value","placeholder","allow-clear","status","disabled"])):_("",!0),f("div",Jt,M(n.description),1)]),_:2},1024)]),_:2},1032,["span"]))),128))]),_:1})]),_:1})):_("",!0)]),_:1})]),_:1})]),l.mode==="trial"?(a(),v("div",Wt,[U.value?(a(),v("div",Ht,[D(_e,{message:U.value,type:"error",showIcon:"",style:{marginBottom:"10px"}},null,8,["message"])])):_("",!0),D($,{type:"primary",size:"large",onClick:ee,disabled:!O.value||!l.selectedModel},{default:k(()=>i[10]||(i[10]=[E(" Add Model Configuration to Trial ")])),_:1,__:[10]},8,["disabled"])])):_("",!0)])}}}),Xt=oe(Qt,[["__scopeId","data-v-a3c059c4"]]),Yt={class:"modal-content-wrapper"},Zt={key:0,class:"loading-container"},eo={key:1,class:"no-models-container"},to={class:"no-models-content"},oo={key:2,class:"modal-content"},no={class:"models-panel"},so={class:"models-list"},lo=te({__name:"GenericModelSelectorModalV3",props:{visible:{type:Boolean},mode:{default:"single"},trialContext:{},design:{},title:{},existingConfigurations:{},showConfigPanel:{type:Boolean,default:!0}},emits:["update:visible","add-configuration","select-model","confirm"],setup(J,{emit:s}){const e=J,I=s,h=ke(),{enabledModels:P,loading:O}=Ce(),{requiresApiKey:c,getProviderGroup:C,getUIDefaults:U}=ce(),{hasApiKey:j}=be(),{estimateCost:S,estimateTotalCost:H}=Me(),K=V(()=>P.value||[]),z=V(()=>{const u=K.value.length>0;return O.value&&!u}),B=X(""),w=X(null),A=X(null),t=X({}),p=V(()=>{if(!K.value)return{};let u=K.value;if(B.value){const d=B.value.toLowerCase();u=u.filter(y=>y.displayName.toLowerCase().includes(d)||y.modelId.toLowerCase().includes(d))}const o={};for(const d of u)o[d.provider]||(o[d.provider]=[]),o[d.provider].push(d);for(const d in o)o[d].sort((y,R)=>y.displayName.localeCompare(R.displayName));return o}),g=V(()=>{if(e.mode!=="trial")return 1;if(e.trialContext)return e.trialContext.totalCombinations;if(e.design){let u=1;for(const o of Object.values(e.design.variableBindings))o.type==="direct"&&(u*=o.values?.length||1);return u}return 1});ne([w,t],async()=>{if(!w.value||e.mode!=="trial"){A.value=null;return}if(!e.trialContext&&!e.design){A.value=null;return}try{const u=Object.keys(t.value).length>0?t.value:U(w.value.provider,w.value.modelId);if(e.mode==="trial"&&e.trialContext?.tokenData){const o=H(e.trialContext.tokenData.totalTokens,e.trialContext.tokenData.combinationCount,w.value,u);o.meta.hasValidCost&&o.cost.total.expected>0?A.value={inputTokens:{avgTokens:e.trialContext.tokenData.perCallAverage},outputTokens:o.tokens.output.expected,totalCost:o.cost.total.expected,inputCost:o.cost.input,outputCost:o.cost.output.expected,costRange:{min:o.cost.total.min,max:o.cost.total.max,expected:o.cost.total.expected}}:A.value=null}else{const o=i(w.value);if(o===null){A.value=null;return}const d=S(o,w.value,u);d.meta.hasValidCost&&d.cost.total.expected>0?A.value={inputTokens:{avgTokens:o},outputTokens:d.tokens.output.expected,totalCost:d.cost.total.expected,inputCost:d.cost.input,outputCost:d.cost.output.expected,costRange:{min:d.cost.total.min,max:d.cost.total.max,expected:d.cost.total.expected}}:A.value=null}}catch(u){T.error("Failed to calculate cost estimate:",u),A.value=null}},{deep:!0});function F(){I("update:visible",!1),h.push("/models")}function q(u){if(w.value=u,e.mode==="trial"&&(t.value={}),e.mode==="playground"){I("select-model",u),I("update:visible",!1);return}}function L(u){T.debug("GenericModelSelectorModalV3: Parameters changed",u),t.value={...u}}function Z(u){T.info("ðŸŽ¯ GenericModelSelectorModalV3: Emitting add-configuration",{config:u,mode:e.mode}),e.mode==="single"?(I("confirm",{model:w.value,configuration:u}),I("update:visible",!1)):I("add-configuration",u)}function ee(u){I("select-model",u),I("update:visible",!1)}function l(){w.value=null}function i(u){return e.mode==="trial"?e.trialContext&&e.trialContext.tokenData?e.trialContext.tokenData.totalTokens:e.design?.tokenEstimate?.avgTokens?e.design.tokenEstimate.avgTokens*g.value:null:1e3}function $(u){if(e.mode==="trial"){const o=Object.keys(t.value).length>0?t.value:U(u.provider,u.modelId),d=["max_tokens","max_completion_tokens","max_output_tokens","num_predict","maxTokens"];let y=null;for(const R of d)if(o[R]!==void 0&&o[R]!==null&&o[R]>0){y=o[R];break}return y===null?null:e.trialContext?.tokenData?y*e.trialContext.tokenData.combinationCount:y*g.value}return 1e3}return ne(()=>e.visible,u=>{u&&(w.value=null,B.value="",t.value={},T.debug("GenericModelSelectorModalV3 opened - reset selection"))}),re(()=>{T.debug("GenericModelSelectorModalV3 mounted",{mode:e.mode,visible:e.visible})}),(u,o)=>{const d=qe,y=se,R=je;return a(),b(R,{open:u.visible,onCancel:o[1]||(o[1]=x=>u.$emit("update:visible",!1)),title:u.title||"Select Model",width:"97.5%",footer:null,bodyStyle:{padding:0,height:"80vh",display:"flex",flexDirection:"column"},maskClosable:!1,centered:!0,class:"full-width-modal"},{default:k(()=>[f("div",Yt,[z.value?(a(),v("div",Zt,[D(d,{size:"large",tip:"Loading models..."})])):K.value.length===0?(a(),v("div",eo,[f("div",to,[D(Q(Be),{class:"no-models-icon"}),o[3]||(o[3]=f("h3",null,"No Models Available",-1)),o[4]||(o[4]=f("p",null,"No LLM models are currently enabled. You need to enable at least one model to proceed.",-1)),D(y,{type:"primary",size:"large",onClick:F},{default:k(()=>[D(Q(Ge)),o[2]||(o[2]=E(" Go to Models View "))]),_:1,__:[2]})])])):(a(),v("div",oo,[f("div",no,[D(Je,{modelValue:B.value,"onUpdate:modelValue":o[0]||(o[0]=x=>B.value=x)},null,8,["modelValue"]),f("div",so,[D(Rt,{"grouped-models":p.value,"selected-model-id":w.value?.id,mode:u.mode,"get-input-tokens-for-model":i,"get-output-tokens-for-model":$,"has-config-panel":!!w.value,"requires-api-key":Q(c),"get-provider-group":Q(C),"has-api-key":Q(j),onSelectModel:q},null,8,["grouped-models","selected-model-id","mode","has-config-panel","requires-api-key","get-provider-group","has-api-key"])])]),w.value&&u.mode==="trial"?(a(),b(Xt,{key:0,"selected-model":w.value,mode:u.mode,"total-calls":g.value,"cost-estimate":A.value,"token-data":u.trialContext?.tokenData,"get-input-tokens-for-model":i,"get-output-tokens-for-model":$,"existing-configurations":u.existingConfigurations,onClose:l,onAddConfiguration:Z,onConfirmSelection:ee,onParametersChanged:L},null,8,["selected-model","mode","total-calls","cost-estimate","token-data","existing-configurations"])):_("",!0)]))])]),_:1},8,["open","title"])}}}),mo=oe(lo,[["__scopeId","data-v-11663c6f"]]);export{mo as G,fe as M};
