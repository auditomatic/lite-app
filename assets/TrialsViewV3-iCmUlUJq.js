const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/trial-bundle.service-CFPPZYp4.js","assets/index-COaxREvt.js","assets/vue-vendor-DPw1dQYc.js","assets/ui-vendor-BMnJXXRj.js","assets/utils-vendor-Cq8ftA55.js","assets/index-cTUJCLSS.css","assets/data-vendor-byFmqONf.js","assets/python-bundle-management-BCaDt2ES.js"])))=>i.map(i=>d[i]);
var vs=Object.defineProperty;var gs=(i,e,t)=>e in i?vs(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var $e=(i,e,t)=>gs(i,typeof e!="symbol"?e+"":e,t);import{h as ae,a as F,u as hs,b as gt,d as Ie,v as ys,_ as Re}from"./index-COaxREvt.js";import{d as ne,f as q,c as U,o as fe,b as be,w as re,R as m,a0 as se,S as s,_ as P,a9 as we,a3 as ye,Y as d,y as ke,aa as bs,ab as _s,ac as Ts,$ as K,ad as ks,ae as Cs,af as Pt,q as Ft,n as Se,k as C,Z as x,F as ee,W as te,a5 as ht,ag as $s,ah as ws,u as z,a4 as et,V as _,G as L,M as Fe,ai as xe,U as xt,A as At,aj as Ss,B as Ot,r as Is,a7 as Es,a1 as Vt,X as Be,a6 as tt}from"./vue-vendor-DPw1dQYc.js";import{aH as Dt,C as Nt,aS as Rs,m as me,G as Ps,aT as Lt,aU as Fs,J as dt,az as xs,N as ct,O as pt,V as As,a2 as Mt,P as yt,aV as Os,ab as Vs,av as Ds,aM as Ut,K as Ns,aI as Ls,Z as Ms,Q as ft,I as Us,u as js,M as Ce,ax as jt,aN as Pe,T as mt,q as ze,D as Bs,k as Z,aJ as zs,am as Bt,a6 as Ws,a7 as Hs,a5 as zt,aW as Gs,w as Wt,E as Ht,ak as qs,al as Js,a8 as Xs,o as Ks,ap as Ys,s as Qs,a3 as Zs,a4 as ea,aX as Ke,y as ta,v as sa,au as Gt,aw as aa,aY as qt,z as na,a1 as ra}from"./ui-vendor-BMnJXXRj.js";import{b as Jt}from"./utils-vendor-Cq8ftA55.js";import{u as We}from"./useCostEstimation-DR_TI3jm.js";import{P as oa}from"./ParserSelector-BKeFbvQO.js";import{u as He,a as Xt}from"./trial-stream-manager-v4-DWVz80cX.js";import{u as ia}from"./parser.store-Ax7rYsA0.js";import{v as bt,u as la,a as ua,b as da}from"./useV4TrialCommands-BotbrLsr.js";import{u as ca}from"./useHeatmapStylingV3-CCIdVOn4.js";import{u as Ye,w as pa}from"./data-vendor-byFmqONf.js";import{u as fa}from"./execution-control-v4-DLu8Cja6.js";import{u as ma}from"./useV4Models-DAvBQgSK.js";import"./useV4LiveQuery-tQxuLTQz.js";const va={class:"right-panel"},ga=ne({__name:"ResizablePanelContainer",props:{storageKey:{default:"trial-list-width"},defaultWidth:{default:250},minWidth:{default:200},maxWidth:{default:600},mobileBreakpoint:{default:768}},emits:["resize","mobile-overlay-change"],setup(i,{expose:e,emit:t}){const a=i,n=t,r=q(a.defaultWidth),u=q(!1),p=q(0),c=q(0),v=q(window.innerWidth),h=q(!1),g=U(()=>v.value<a.mobileBreakpoint),b=U(()=>g.value?{width:`${Math.min(v.value*.85,400)}px`}:{width:`${r.value}px`});function w(){const f=localStorage.getItem(a.storageKey);if(f){const l=parseInt(f,10);!isNaN(l)&&l>=a.minWidth&&l<=a.maxWidth&&(r.value=l)}}function T(f){localStorage.setItem(a.storageKey,f.toString()),n("resize",f)}function k(f){u.value=!0,p.value=f.clientX,c.value=r.value,document.addEventListener("mousemove",V),document.addEventListener("mouseup",H),document.body.style.userSelect="none",document.body.style.cursor="col-resize"}function V(f){if(!u.value)return;const l=f.clientX-p.value,D=Math.max(a.minWidth,Math.min(a.maxWidth,c.value+l));r.value=D}function H(){u.value&&(u.value=!1,T(r.value),document.removeEventListener("mousemove",V),document.removeEventListener("mouseup",H),document.body.style.userSelect="",document.body.style.cursor="")}function N(){r.value=a.defaultWidth,T(a.defaultWidth)}function R(){v.value=window.innerWidth,!g.value&&h.value&&(h.value=!1,n("mobile-overlay-change",!1))}function S(){g.value&&(h.value=!h.value,n("mobile-overlay-change",h.value))}function j(){h.value=!1,n("mobile-overlay-change",!1)}return e({toggleMobileOverlay:S,closeMobileOverlay:j}),fe(()=>{w(),window.addEventListener("resize",R)}),be(()=>{window.removeEventListener("resize",R),H()}),re(()=>a.defaultWidth,f=>{r.value===a.defaultWidth&&(r.value=f)}),(f,l)=>(d(),m("div",{class:se(["resizable-panel-container",{"mobile-overlay":g.value}])},[s("div",{class:se(["left-panel",{"overlay-visible":g.value&&h.value}]),style:ye(b.value)},[we(f.$slots,"left",{},void 0,!0)],6),g.value?P("",!0):(d(),m("div",{key:0,class:se(["resize-handle",{dragging:u.value}]),onMousedown:k,onDblclick:N},l[0]||(l[0]=[s("div",{class:"handle-bar"},null,-1)]),34)),s("div",va,[we(f.$slots,"right",{},void 0,!0)]),g.value&&h.value?(d(),m("div",{key:1,class:"mobile-overlay-bg",onClick:j})):P("",!0)],2))}}),ha=ae(ga,[["__scopeId","data-v-949e1df1"]]);function ya(){var i=window.navigator.userAgent,e=i.indexOf("MSIE ");if(e>0)return parseInt(i.substring(e+5,i.indexOf(".",e)),10);var t=i.indexOf("Trident/");if(t>0){var a=i.indexOf("rv:");return parseInt(i.substring(a+3,i.indexOf(".",a)),10)}var n=i.indexOf("Edge/");return n>0?parseInt(i.substring(n+5,i.indexOf(".",n)),10):-1}let Ve;function st(){st.init||(st.init=!0,Ve=ya()!==-1)}var Ge={name:"ResizeObserver",props:{emitOnMount:{type:Boolean,default:!1},ignoreWidth:{type:Boolean,default:!1},ignoreHeight:{type:Boolean,default:!1}},emits:["notify"],mounted(){st(),ke(()=>{this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitOnMount&&this.emitSize()});const i=document.createElement("object");this._resizeObject=i,i.setAttribute("aria-hidden","true"),i.setAttribute("tabindex",-1),i.onload=this.addResizeHandlers,i.type="text/html",Ve&&this.$el.appendChild(i),i.data="about:blank",Ve||this.$el.appendChild(i)},beforeUnmount(){this.removeResizeHandlers()},methods:{compareAndNotify(){(!this.ignoreWidth&&this._w!==this.$el.offsetWidth||!this.ignoreHeight&&this._h!==this.$el.offsetHeight)&&(this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitSize())},emitSize(){this.$emit("notify",{width:this._w,height:this._h})},addResizeHandlers(){this._resizeObject.contentDocument.defaultView.addEventListener("resize",this.compareAndNotify),this.compareAndNotify()},removeResizeHandlers(){this._resizeObject&&this._resizeObject.onload&&(!Ve&&this._resizeObject.contentDocument&&this._resizeObject.contentDocument.defaultView.removeEventListener("resize",this.compareAndNotify),this.$el.removeChild(this._resizeObject),this._resizeObject.onload=null,this._resizeObject=null)}}};const ba=Ts();bs("data-v-b329ee4c");const _a={class:"resize-observer",tabindex:"-1"};_s();const Ta=ba((i,e,t,a,n,r)=>(d(),K("div",_a)));Ge.render=Ta;Ge.__scopeId="data-v-b329ee4c";Ge.__file="src/components/ResizeObserver.vue";function De(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?De=function(e){return typeof e}:De=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},De(i)}function ka(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Ca(i,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,a.key,a)}}function $a(i,e,t){return e&&Ca(i.prototype,e),i}function _t(i){return wa(i)||Sa(i)||Ia(i)||Ea()}function wa(i){if(Array.isArray(i))return at(i)}function Sa(i){if(typeof Symbol<"u"&&Symbol.iterator in Object(i))return Array.from(i)}function Ia(i,e){if(i){if(typeof i=="string")return at(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return at(i,e)}}function at(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,a=new Array(e);t<e;t++)a[t]=i[t];return a}function Ea(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ra(i){var e;return typeof i=="function"?e={callback:i}:e=i,e}function Pa(i,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a,n,r,u=function(c){for(var v=arguments.length,h=new Array(v>1?v-1:0),g=1;g<v;g++)h[g-1]=arguments[g];if(r=h,!(a&&c===n)){var b=t.leading;typeof b=="function"&&(b=b(c,n)),(!a||c!==n)&&b&&i.apply(void 0,[c].concat(_t(r))),n=c,clearTimeout(a),a=setTimeout(function(){i.apply(void 0,[c].concat(_t(r))),a=0},e)}};return u._clear=function(){clearTimeout(a),a=null},u}function Kt(i,e){if(i===e)return!0;if(De(i)==="object"){for(var t in i)if(!Kt(i[t],e[t]))return!1;return!0}return!1}var Fa=(function(){function i(e,t,a){ka(this,i),this.el=e,this.observer=null,this.frozen=!1,this.createObserver(t,a)}return $a(i,[{key:"createObserver",value:function(t,a){var n=this;if(this.observer&&this.destroyObserver(),!this.frozen){if(this.options=Ra(t),this.callback=function(p,c){n.options.callback(p,c),p&&n.options.once&&(n.frozen=!0,n.destroyObserver())},this.callback&&this.options.throttle){var r=this.options.throttleOptions||{},u=r.leading;this.callback=Pa(this.callback,this.options.throttle,{leading:function(c){return u==="both"||u==="visible"&&c||u==="hidden"&&!c}})}this.oldResult=void 0,this.observer=new IntersectionObserver(function(p){var c=p[0];if(p.length>1){var v=p.find(function(g){return g.isIntersecting});v&&(c=v)}if(n.callback){var h=c.isIntersecting&&c.intersectionRatio>=n.threshold;if(h===n.oldResult)return;n.oldResult=h,n.callback(h,c)}},this.options.intersection),ke(function(){n.observer&&n.observer.observe(n.el)})}}},{key:"destroyObserver",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null),this.callback&&this.callback._clear&&(this.callback._clear(),this.callback=null)}},{key:"threshold",get:function(){return this.options.intersection&&typeof this.options.intersection.threshold=="number"?this.options.intersection.threshold:0}}]),i})();function Yt(i,e,t){var a=e.value;if(a)if(typeof IntersectionObserver>"u")console.warn("[vue-observe-visibility] IntersectionObserver API is not available in your browser. Please install this polyfill: https://github.com/w3c/IntersectionObserver/tree/master/polyfill");else{var n=new Fa(i,a,t);i._vue_visibilityState=n}}function xa(i,e,t){var a=e.value,n=e.oldValue;if(!Kt(a,n)){var r=i._vue_visibilityState;if(!a){Qt(i);return}r?r.createObserver(a,t):Yt(i,{value:a},t)}}function Qt(i){var e=i._vue_visibilityState;e&&(e.destroyObserver(),delete i._vue_visibilityState)}var Aa={beforeMount:Yt,updated:xa,unmounted:Qt},Oa={itemsLimit:1e3},Va=/(auto|scroll)/;function Zt(i,e){return i.parentNode===null?e:Zt(i.parentNode,e.concat([i]))}var Qe=function(e,t){return getComputedStyle(e,null).getPropertyValue(t)},Da=function(e){return Qe(e,"overflow")+Qe(e,"overflow-y")+Qe(e,"overflow-x")},Na=function(e){return Va.test(Da(e))};function Tt(i){if(i instanceof HTMLElement||i instanceof SVGElement){for(var e=Zt(i.parentNode,[]),t=0;t<e.length;t+=1)if(Na(e[t]))return e[t];return document.scrollingElement||document.documentElement}}function nt(i){"@babel/helpers - typeof";return nt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nt(i)}var La={items:{type:Array,required:!0},keyField:{type:String,default:"id"},direction:{type:String,default:"vertical",validator:function(e){return["vertical","horizontal"].includes(e)}},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"}};function Ma(){return this.items.length&&nt(this.items[0])!=="object"}var rt=!1;if(typeof window<"u"){rt=!1;try{var Ua=Object.defineProperty({},"passive",{get:function(){rt=!0}});window.addEventListener("test",null,Ua)}catch{}}let ja=0;var qe={name:"RecycleScroller",components:{ResizeObserver:Ge},directives:{ObserveVisibility:Aa},props:{...La,itemSize:{type:Number,default:null},gridItems:{type:Number,default:void 0},itemSecondarySize:{type:Number,default:void 0},minItemSize:{type:[Number,String],default:null},sizeField:{type:String,default:"size"},typeField:{type:String,default:"type"},buffer:{type:Number,default:200},pageMode:{type:Boolean,default:!1},prerender:{type:Number,default:0},emitUpdate:{type:Boolean,default:!1},updateInterval:{type:Number,default:0},skipHover:{type:Boolean,default:!1},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},listClass:{type:[String,Object,Array],default:""},itemClass:{type:[String,Object,Array],default:""}},emits:["resize","visible","hidden","update","scroll-start","scroll-end"],data(){return{pool:[],totalSize:0,ready:!1,hoverKey:null}},computed:{sizes(){if(this.itemSize===null){const i={"-1":{accumulator:0}},e=this.items,t=this.sizeField,a=this.minItemSize;let n=1e4,r=0,u;for(let p=0,c=e.length;p<c;p++)u=e[p][t]||a,u<n&&(n=u),r+=u,i[p]={accumulator:r,size:u};return this.$_computedMinItemSize=n,i}return[]},simpleArray:Ma,itemIndexByKey(){const{keyField:i,items:e}=this,t={};for(let a=0,n=e.length;a<n;a++)t[e[a][i]]=a;return t}},watch:{items(){this.updateVisibleItems(!0)},pageMode(){this.applyPageMode(),this.updateVisibleItems(!1)},sizes:{handler(){this.updateVisibleItems(!1)},deep:!0},gridItems(){this.updateVisibleItems(!0)},itemSecondarySize(){this.updateVisibleItems(!0)}},created(){this.$_startIndex=0,this.$_endIndex=0,this.$_views=new Map,this.$_unusedViews=new Map,this.$_scrollDirty=!1,this.$_lastUpdateScrollPosition=0,this.prerender&&(this.$_prerender=!0,this.updateVisibleItems(!1)),this.gridItems&&!this.itemSize&&console.error("[vue-recycle-scroller] You must provide an itemSize when using gridItems")},mounted(){this.applyPageMode(),this.$nextTick(()=>{this.$_prerender=!1,this.updateVisibleItems(!0),this.ready=!0})},activated(){const i=this.$_lastUpdateScrollPosition;typeof i=="number"&&this.$nextTick(()=>{this.scrollToPosition(i)})},beforeUnmount(){this.removeListeners()},methods:{addView(i,e,t,a,n){const r=ks({id:ja++,index:e,used:!0,key:a,type:n}),u=Cs({item:t,position:0,nr:r});return i.push(u),u},unuseView(i,e=!1){const t=this.$_unusedViews,a=i.nr.type;let n=t.get(a);n||(n=[],t.set(a,n)),n.push(i),e||(i.nr.used=!1,i.position=-9999)},handleResize(){this.$emit("resize"),this.ready&&this.updateVisibleItems(!1)},handleScroll(i){if(!this.$_scrollDirty){if(this.$_scrollDirty=!0,this.$_updateTimeout)return;const e=()=>requestAnimationFrame(()=>{this.$_scrollDirty=!1;const{continuous:t}=this.updateVisibleItems(!1,!0);t||(clearTimeout(this.$_refreshTimout),this.$_refreshTimout=setTimeout(this.handleScroll,this.updateInterval+100))});e(),this.updateInterval&&(this.$_updateTimeout=setTimeout(()=>{this.$_updateTimeout=0,this.$_scrollDirty&&e()},this.updateInterval))}},handleVisibilityChange(i,e){this.ready&&(i||e.boundingClientRect.width!==0||e.boundingClientRect.height!==0?(this.$emit("visible"),requestAnimationFrame(()=>{this.updateVisibleItems(!1)})):this.$emit("hidden"))},updateVisibleItems(i,e=!1){const t=this.itemSize,a=this.gridItems||1,n=this.itemSecondarySize||t,r=this.$_computedMinItemSize,u=this.typeField,p=this.simpleArray?null:this.keyField,c=this.items,v=c.length,h=this.sizes,g=this.$_views,b=this.$_unusedViews,w=this.pool,T=this.itemIndexByKey;let k,V,H,N,R;if(!v)k=V=N=R=H=0;else if(this.$_prerender)k=N=0,V=R=Math.min(this.prerender,c.length),H=null;else{const o=this.getScroll();if(e){let E=o.start-this.$_lastUpdateScrollPosition;if(E<0&&(E=-E),t===null&&E<r||E<t)return{continuous:!0}}this.$_lastUpdateScrollPosition=o.start;const A=this.buffer;o.start-=A,o.end+=A;let $=0;if(this.$refs.before&&($=this.$refs.before.scrollHeight,o.start-=$),this.$refs.after){const E=this.$refs.after.scrollHeight;o.end+=E}if(t===null){let E,G=0,O=v-1,Y=~~(v/2),y;do y=Y,E=h[Y].accumulator,E<o.start?G=Y:Y<v-1&&h[Y+1].accumulator>o.start&&(O=Y),Y=~~((G+O)/2);while(Y!==y);for(Y<0&&(Y=0),k=Y,H=h[v-1].accumulator,V=Y;V<v&&h[V].accumulator<o.end;V++);for(V===-1?V=c.length-1:(V++,V>v&&(V=v)),N=k;N<v&&$+h[N].accumulator<o.start;N++);for(R=N;R<v&&$+h[R].accumulator<o.end;R++);}else{k=~~(o.start/t*a);const E=k%a;k-=E,V=Math.ceil(o.end/t*a),N=Math.max(0,Math.floor((o.start-$)/t*a)),R=Math.floor((o.end-$)/t*a),k<0&&(k=0),V>v&&(V=v),N<0&&(N=0),R>v&&(R=v),H=Math.ceil(v/a)*t}}V-k>Oa.itemsLimit&&this.itemsLimitError(),this.totalSize=H;let S;const j=k<=this.$_endIndex&&V>=this.$_startIndex;if(j)for(let o=0,A=w.length;o<A;o++)S=w[o],S.nr.used&&(i&&(S.nr.index=T[S.item[p]]),(S.nr.index==null||S.nr.index<k||S.nr.index>=V)&&this.unuseView(S));const f=j?null:new Map;let l,D,I;for(let o=k;o<V;o++){l=c[o];const A=p?l[p]:l;if(A==null)throw new Error(`Key is ${A} on item (keyField is '${p}')`);if(S=g.get(A),!t&&!h[o].size){S&&this.unuseView(S);continue}D=l[u];let $=b.get(D),E=!1;if(!S)j?$&&$.length?S=$.pop():S=this.addView(w,o,l,A,D):(I=f.get(D)||0,(!$||I>=$.length)&&(S=this.addView(w,o,l,A,D),this.unuseView(S,!0),$=b.get(D)),S=$[I],f.set(D,I+1)),g.delete(S.nr.key),S.nr.used=!0,S.nr.index=o,S.nr.key=A,S.nr.type=D,g.set(A,S),E=!0;else if(!S.nr.used&&(S.nr.used=!0,E=!0,$)){const G=$.indexOf(S);G!==-1&&$.splice(G,1)}S.item=l,E&&(o===c.length-1&&this.$emit("scroll-end"),o===0&&this.$emit("scroll-start")),t===null?(S.position=h[o-1].accumulator,S.offset=0):(S.position=Math.floor(o/a)*t,S.offset=o%a*n)}return this.$_startIndex=k,this.$_endIndex=V,this.emitUpdate&&this.$emit("update",k,V,N,R),clearTimeout(this.$_sortTimer),this.$_sortTimer=setTimeout(this.sortViews,this.updateInterval+300),{continuous:j}},getListenerTarget(){let i=Tt(this.$el);return window.document&&(i===window.document.documentElement||i===window.document.body)&&(i=window),i},getScroll(){const{$el:i,direction:e}=this,t=e==="vertical";let a;if(this.pageMode){const n=i.getBoundingClientRect(),r=t?n.height:n.width;let u=-(t?n.top:n.left),p=t?window.innerHeight:window.innerWidth;u<0&&(p+=u,u=0),u+p>r&&(p=r-u),a={start:u,end:u+p}}else t?a={start:i.scrollTop,end:i.scrollTop+i.clientHeight}:a={start:i.scrollLeft,end:i.scrollLeft+i.clientWidth};return a},applyPageMode(){this.pageMode?this.addListeners():this.removeListeners()},addListeners(){this.listenerTarget=this.getListenerTarget(),this.listenerTarget.addEventListener("scroll",this.handleScroll,rt?{passive:!0}:!1),this.listenerTarget.addEventListener("resize",this.handleResize)},removeListeners(){this.listenerTarget&&(this.listenerTarget.removeEventListener("scroll",this.handleScroll),this.listenerTarget.removeEventListener("resize",this.handleResize),this.listenerTarget=null)},scrollToItem(i){let e;const t=this.gridItems||1;this.itemSize===null?e=i>0?this.sizes[i-1].accumulator:0:e=Math.floor(i/t)*this.itemSize,this.scrollToPosition(e)},scrollToPosition(i){const e=this.direction==="vertical"?{scroll:"scrollTop",start:"top"}:{scroll:"scrollLeft",start:"left"};let t,a,n;if(this.pageMode){const r=Tt(this.$el),u=r.tagName==="HTML"?0:r[e.scroll],p=r.getBoundingClientRect(),v=this.$el.getBoundingClientRect()[e.start]-p[e.start];t=r,a=e.scroll,n=i+u+v}else t=this.$el,a=e.scroll,n=i;t[a]=n},itemsLimitError(){throw setTimeout(()=>{this.$el}),new Error("Rendered items limit reached")},sortViews(){this.pool.sort((i,e)=>i.nr.index-e.nr.index)}}};const Ba={key:0,ref:"before",class:"vue-recycle-scroller__slot"},za={key:1,ref:"after",class:"vue-recycle-scroller__slot"};function Wa(i,e,t,a,n,r){const u=Pt("ResizeObserver"),p=Ft("observe-visibility");return Se((d(),m("div",{class:se(["vue-recycle-scroller",{ready:n.ready,"page-mode":t.pageMode,[`direction-${i.direction}`]:!0}]),onScrollPassive:e[0]||(e[0]=(...c)=>r.handleScroll&&r.handleScroll(...c))},[i.$slots.before?(d(),m("div",Ba,[we(i.$slots,"before")],512)):P("v-if",!0),(d(),K(ht(t.listTag),{ref:"wrapper",style:ye({[i.direction==="vertical"?"minHeight":"minWidth"]:n.totalSize+"px"}),class:se(["vue-recycle-scroller__item-wrapper",t.listClass])},{default:x(()=>[(d(!0),m(ee,null,te(n.pool,c=>(d(),K(ht(t.itemTag),$s({key:c.nr.id,style:n.ready?{transform:`translate${i.direction==="vertical"?"Y":"X"}(${c.position}px) translate${i.direction==="vertical"?"X":"Y"}(${c.offset}px)`,width:t.gridItems?`${i.direction==="vertical"&&t.itemSecondarySize||t.itemSize}px`:void 0,height:t.gridItems?`${i.direction==="horizontal"&&t.itemSecondarySize||t.itemSize}px`:void 0}:null,class:["vue-recycle-scroller__item-view",[t.itemClass,{hover:!t.skipHover&&n.hoverKey===c.nr.key}]]},ws(t.skipHover?{}:{mouseenter:()=>{n.hoverKey=c.nr.key},mouseleave:()=>{n.hoverKey=null}})),{default:x(()=>[we(i.$slots,"default",{item:c.item,index:c.nr.index,active:c.nr.used})]),_:2},1040,["style","class"]))),128)),we(i.$slots,"empty")]),_:3},8,["style","class"])),i.$slots.after?(d(),m("div",za,[we(i.$slots,"after")],512)):P("v-if",!0),C(u,{onNotify:r.handleResize},null,8,["onNotify"])],34)),[[p,r.handleVisibilityChange]])}qe.render=Wa;qe.__file="src/components/RecycleScroller.vue";const Ha={class:"trial-list-search"},Ga=["value"],qa=ne({__name:"TrialListSearch",props:{modelValue:{}},emits:["update:modelValue"],setup(i,{emit:e}){const t=e,a=q(),n=Jt(v=>{t("update:modelValue",v)},300);function r(v){const h=v.target.value;n(h)}function u(){t("update:modelValue",""),a.value?.focus()}function p(){a.value?.focus(),a.value?.select()}function c(v){v.type==="focus-trial-search"&&p()}return fe(()=>{window.addEventListener("focus-trial-search",c)}),be(()=>{window.removeEventListener("focus-trial-search",c)}),(v,h)=>(d(),m("div",Ha,[C(z(Dt),{class:"search-icon"}),s("input",{ref_key:"searchInput",ref:a,type:"text",class:"search-input",placeholder:"Filter trials...",value:v.modelValue,onInput:r,onKeydown:et(u,["escape"])},null,40,Ga),v.modelValue?(d(),K(z(Nt),{key:0,class:"clear-icon",onClick:u})):P("",!0)]))}}),Ja=ae(qa,[["__scopeId","data-v-3a032c2b"]]),Xa={class:"item-content"},Ka={class:"item-header"},Ya=["title"],Qa={key:0,class:"progress-bar"},Za={class:"item-metadata"},en={class:"meta-item"},tn={class:"meta-item"},sn={key:0,class:"meta-separator"},an={key:1,class:"meta-item cost"},nn=ne({__name:"TrialListItem",props:{trial:{},selected:{type:Boolean}},emits:["click"],setup(i){const e=i,{calculateTemplateTokens:t,calculatePromptTokens:a,estimateTotalCost:n,sumEstimates:r,formatCost:u}=We(),p=U(()=>{if(e.trial.progress.total===0)return 0;const g=e.trial.progress.completed+e.trial.progress.failed;return Math.round(g/e.trial.progress.total*100)}),c=U(()=>{const{completed:g,failed:b,total:w}=e.trial.progress;return e.trial.status==="draft"?`${w} tasks`:`${g+b}/${w} tasks`}),v=U(()=>{const g=e.trial.started||e.trial.created;if(!g)return"";const w=new Date().getTime()-g.getTime(),T=Math.floor(w/1e3),k=Math.floor(T/60),V=Math.floor(k/60),H=Math.floor(V/24);return T<60?"now":k<60?`${k}m`:V<24?`${V}h`:`${H}d`}),h=U(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let g=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)g=t(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const T=a(e.trial.spreadsheetConfig.promptPattern),k=e.trial.progress.total/e.trial.configurations.length;g={totalTokens:T*k,combinationCount:k,perCallAverage:T}}else if(e.trial.type==="playground")return null;if(!g||g.totalTokens===0)return null;const b=e.trial.configurations.map(T=>{const k=T.modelSnapshot;return k?n(g.totalTokens,g.combinationCount,k,T.parameters):null}).filter(Boolean);if(b.length===0)return null;const w=r(b);return`${u(w,"compact")} total`});return(g,b)=>(d(),m("div",{class:se(["trial-list-item",{selected:g.selected,"has-progress":g.trial.status==="running"}]),onClick:b[0]||(b[0]=w=>g.$emit("click"))},[s("div",{class:se(["status-indicator",`status-${g.trial.status}`])},null,2),s("div",Xa,[s("div",Ka,[s("span",{class:"trial-name",title:g.trial.name},_(g.trial.name),9,Ya),s("span",{class:se(["status-tag",`status-${g.trial.status}`])},_(g.trial.status.toUpperCase()),3)]),g.trial.status==="running"?(d(),m("div",Qa,[s("div",{class:"progress-fill",style:ye({width:`${p.value}%`})},null,4)])):P("",!0),s("div",Za,[s("span",en,_(c.value),1),b[1]||(b[1]=s("span",{class:"meta-separator"},"•",-1)),s("span",tn,_(v.value),1),h.value?(d(),m("span",sn,"•")):P("",!0),h.value?(d(),m("span",an,_(h.value),1)):P("",!0)])])],2))}}),kt=ae(nn,[["__scopeId","data-v-037b1757"]]),rn={class:"section-title"},on=ne({__name:"TrialListSection",props:{title:{},background:{type:Boolean}},setup(i){return(e,t)=>(d(),m("div",{class:se(["trial-list-section",{"with-background":e.background}])},[s("span",rn,_(e.title),1)],2))}}),Ct=ae(on,[["__scopeId","data-v-07a26c58"]]),ln={class:"panel-header"},un={class:"header-title"},dn={key:0,class:"title-text"},cn={class:"trial-count"},pn={key:0,class:"header-actions"},fn={class:"filter-count"},mn={class:"filter-count"},vn={class:"filter-count"},gn={class:"filter-count"},hn={class:"filter-count"},yn={key:1,class:"status-tabs"},bn={class:"tab-count"},_n={class:"tab-count"},Tn={class:"tab-count"},kn={class:"trial-list-container"},Cn={key:1,class:"trial-list"},$n={key:2,class:"collapsed-list"},wn=["onClick"],Sn={class:"collapsed-count"},In={key:3,class:"empty-state"},En=ne({__name:"TrialListPanelV3",props:{trials:{},selectedTrialId:{},searchQuery:{},filterStatus:{}},emits:["select-trial","create-trial","import-trial","update-search","update-filter","refresh"],setup(i,{emit:e}){const t=i,a=e,n=q(!1),r=q("all"),u=q(250),p=U(()=>u.value<50),c=U(()=>t.trials.filter(f=>f.status==="running"||f.status==="paused").length),v=U(()=>t.trials.filter(f=>f.status==="completed"||f.status==="failed").length),h=U(()=>{let f=t.trials;if(t.searchQuery){const o=t.searchQuery.toLowerCase();f=f.filter(A=>{const $=A.name.toLowerCase().includes(o),E=A.templateConfig?.template?.toLowerCase().includes(o),G=A.configurations.some(O=>O.modelId.toLowerCase().includes(o)||O.provider.toLowerCase().includes(o));return $||E||G})}t.filterStatus!=="all"&&(f=f.filter(o=>o.status===t.filterStatus)),r.value==="active"?f=f.filter(o=>o.status==="running"||o.status==="paused"):r.value==="done"&&(f=f.filter(o=>o.status==="completed"||o.status==="failed"));const l=f.filter(o=>o.status==="running"),D=f.filter(o=>o.status!=="running"),I=[];return l.length>0&&(I.push({type:"section",title:"RUNNING",background:!0,id:"section-running"}),I.push(...l.sort((o,A)=>(A.started?.getTime()||0)-(o.started?.getTime()||0)))),D.length>0&&(l.length>0&&I.push({type:"section",title:"RECENT",background:!1,id:"section-recent"}),I.push(...D.sort((o,A)=>(A.created?.getTime()||0)-(o.created?.getTime()||0)))),I}),g=U(()=>h.value.map(f=>({...f,height:H(f)}))),b=U(()=>t.trials.filter(f=>r.value==="active"?f.status==="running"||f.status==="paused":r.value==="done"?f.status==="completed"||f.status==="failed":!0)),w=U(()=>t.searchQuery?"No trials found":t.filterStatus==="running"?"No trials are currently running":"No trials found"),T=U(()=>t.searchQuery?"No trials match your search":t.filterStatus!=="all"?`No ${t.filterStatus} trials`:"Create your first trial to get started"),k=U(()=>t.filterStatus==="all"&&!t.searchQuery);function V(f){return t.trials.filter(l=>l.status===f).length}function H(f){if(f.type==="section")return 32;const l=f.status==="running",D=f.configurations?.some(I=>I.repeatCount>1);return l||D?96:80}function N(f){const l=f.progress.completed+f.progress.failed;return f.status==="running"?`${Math.round(l/f.progress.total*100)}%`:l.toString()}async function R(){n.value=!0;try{await new Promise(f=>setTimeout(f,500)),a("refresh")}finally{n.value=!1}}function S({key:f}){a("update-filter",f)}function j(){const f=document.querySelector(".trial-list-panel");f&&(u.value=f.clientWidth)}return fe(()=>{j(),window.addEventListener("resize",j);const f=document.querySelector(".trial-list-panel");f&&new ResizeObserver(()=>j()).observe(f)}),be(()=>{window.removeEventListener("resize",j)}),(f,l)=>{const D=me,I=pt,o=As,A=ct,$=dt;return d(),m("div",{class:se(["trial-list-panel",{collapsed:p.value}])},[s("div",ln,[s("div",un,[C(z(Rs),{class:"title-icon"}),p.value?P("",!0):(d(),m("span",dn,"Trials")),s("span",cn,_(f.trials.length),1)]),p.value?P("",!0):(d(),m("div",pn,[C(D,{type:"primary",size:"small",onClick:l[0]||(l[0]=E=>f.$emit("create-trial"))},{default:x(()=>[C(z(Ps)),l[7]||(l[7]=L(" New Trial "))]),_:1,__:[7]}),C(D,{size:"small",onClick:l[1]||(l[1]=E=>f.$emit("import-trial"))},{default:x(()=>[C(z(Lt)),l[8]||(l[8]=L(" Import "))]),_:1,__:[8]}),C(D,{size:"small",onClick:R,loading:n.value},{default:x(()=>[C(z(Fs),{spin:n.value},null,8,["spin"])]),_:1},8,["loading"]),C($,null,{overlay:x(()=>[C(A,{onClick:S},{default:x(()=>[C(I,{key:"all"},{default:x(()=>l[9]||(l[9]=[s("span",null,"All Trials",-1)])),_:1,__:[9]}),C(o),C(I,{key:"running"},{default:x(()=>[l[10]||(l[10]=s("span",null,"Running Only",-1)),s("span",fn,_(V("running")),1)]),_:1,__:[10]}),C(I,{key:"completed"},{default:x(()=>[l[11]||(l[11]=s("span",null,"Completed Only",-1)),s("span",mn,_(V("completed")),1)]),_:1,__:[11]}),C(I,{key:"failed"},{default:x(()=>[l[12]||(l[12]=s("span",null,"Failed Only",-1)),s("span",vn,_(V("failed")),1)]),_:1,__:[12]}),C(I,{key:"paused"},{default:x(()=>[l[13]||(l[13]=s("span",null,"Paused Only",-1)),s("span",gn,_(V("paused")),1)]),_:1,__:[13]}),C(I,{key:"draft"},{default:x(()=>[l[14]||(l[14]=s("span",null,"Draft Only",-1)),s("span",hn,_(V("draft")),1)]),_:1,__:[14]})]),_:1})]),default:x(()=>[C(D,{size:"small"},{default:x(()=>[C(z(xs))]),_:1})]),_:1})]))]),p.value?P("",!0):(d(),K(Ja,{key:0,"model-value":f.searchQuery,"onUpdate:modelValue":l[2]||(l[2]=E=>f.$emit("update-search",E))},null,8,["model-value"])),p.value?P("",!0):(d(),m("div",yn,[s("div",{class:se(["status-tab",{active:r.value==="all"}]),onClick:l[3]||(l[3]=E=>r.value="all")},[l[15]||(l[15]=s("span",{class:"tab-icon"},"📊",-1)),l[16]||(l[16]=s("span",{class:"tab-label"},"ALL",-1)),s("span",bn,_(f.trials.length),1)],2),s("div",{class:se(["status-tab",{active:r.value==="active"}]),onClick:l[4]||(l[4]=E=>r.value="active")},[l[17]||(l[17]=s("span",{class:"tab-icon"},"🟢",-1)),l[18]||(l[18]=s("span",{class:"tab-label"},"Active",-1)),s("span",_n,_(c.value),1)],2),s("div",{class:se(["status-tab",{active:r.value==="done"}]),onClick:l[5]||(l[5]=E=>r.value="done")},[l[19]||(l[19]=s("span",{class:"tab-icon"},"✅",-1)),l[20]||(l[20]=s("span",{class:"tab-label"},"Done",-1)),s("span",Tn,_(v.value),1)],2)])),s("div",kn,[!p.value&&h.value.length>100?(d(),K(z(qe),{key:0,class:"trial-list virtual-list",items:g.value,"size-field":"height","key-field":"id",buffer:10},{default:x(({item:E})=>[E.type==="section"?(d(),K(Ct,{key:0,title:E.title,background:E.background},null,8,["title","background"])):(d(),K(kt,{key:1,trial:E,selected:E.id===f.selectedTrialId,"data-trial-id":E.id,onClick:G=>f.$emit("select-trial",E.id)},null,8,["trial","selected","data-trial-id","onClick"]))]),_:1},8,["items"])):p.value?(d(),m("div",$n,[(d(!0),m(ee,null,te(b.value,E=>(d(),m("div",{key:E.id,class:se(["collapsed-item",{selected:E.id===f.selectedTrialId}]),onClick:G=>f.$emit("select-trial",E.id)},[s("div",{class:se(["status-dot",`status-${E.status}`])},null,2),s("span",Sn,_(N(E)),1)],10,wn))),128))])):(d(),m("div",Cn,[(d(!0),m(ee,null,te(h.value,(E,G)=>(d(),m(ee,{key:E.id||`section-${G}`},[E.type==="section"?(d(),K(Ct,{key:0,title:E.title,background:E.background},null,8,["title","background"])):(d(),K(kt,{key:1,trial:E,selected:E.id===f.selectedTrialId,"data-trial-id":E.id,onClick:O=>f.$emit("select-trial",E.id)},null,8,["trial","selected","data-trial-id","onClick"]))],64))),128))])),h.value.length===0&&!p.value?(d(),m("div",In,[C(z(Mt),{class:"empty-icon"}),s("h3",null,_(w.value),1),s("p",null,_(T.value),1),k.value?(d(),K(D,{key:0,type:"primary",size:"large",onClick:l[6]||(l[6]=E=>f.$emit("create-trial"))},{default:x(()=>l[21]||(l[21]=[L(" Create New Trial ")])),_:1,__:[21]})):P("",!0)])):P("",!0)])],2)}}}),Rn=ae(En,[["__scopeId","data-v-ad2a17cf"]]),Pn={class:"trial-header"},Fn={class:"header-main"},xn={class:"header-title"},An={class:"trial-name"},On={key:0,class:"progress-container"},Vn={class:"progress-bar"},Dn={class:"progress-stats-inline"},Nn={class:"progress-text"},Ln={key:0,class:"progress-stat"},Mn={class:"stat-number"},Un={key:1,class:"progress-stat"},jn={class:"stat-number"},Bn={key:2,class:"progress-stat"},zn={class:"stat-number"},Wn=ne({__name:"TrialHeaderV3",props:{trial:{},progress:{},isExecuting:{type:Boolean}},setup(i){const e=i,t=U(()=>{let T=e.trial.name;return T=T.replace(/\s*-\s*\d{1,2}\/\d{1,2}\/\d{4}$/,""),T=T.replace(/\s*\(Copy\)(\s*\(Copy\))*/g,""),T.trim()}),a=U(()=>!0),n=U(()=>e.progress?e.progress.completed+e.progress.failed:0),r=U(()=>{if(!e.progress||e.progress.total===0)return 0;const T=e.progress.completed+e.progress.failed;return Math.round(T/e.progress.total*100)}),u=U(()=>{const T=e.trial.started||e.trial.created;if(!T)return"0m";let k;if(e.trial.status==="draft")return"0m";e.trial.completed?k=e.trial.completed:k=new Date;const V=k.getTime()-T.getTime(),H=Math.floor(V/(1e3*60*60)),N=Math.floor(V%(1e3*60*60)/(1e3*60));return H>0?`${H}h ${N}m`:`${N}m`}),p=U(()=>{if(!e.progress?.avgLatencyMs)return null;const T=e.progress.avgLatencyMs;return T<1e3?`${Math.round(T)}ms`:`${(T/1e3).toFixed(1)}s`}),{calculateTemplateTokens:c,calculatePromptTokens:v,estimateTotalCost:h,sumEstimates:g,formatCost:b}=We();U(()=>{if(!e.trial.configurations||e.trial.configurations.length===0)return null;let T=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)T=c(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else if(e.trial.type==="spreadsheet"&&e.trial.spreadsheetConfig?.promptPattern){const H=v(e.trial.spreadsheetConfig.promptPattern),R=(e.progress?.total||e.trial.progress.total)/e.trial.configurations.length;T={totalTokens:H*R,combinationCount:R,perCallAverage:H}}else if(e.trial.type==="playground")return null;if(!T||T.totalTokens===0)return null;const k=e.trial.configurations.map(H=>{const N=H.modelSnapshot;return N?h(T.totalTokens,T.combinationCount,N,H.parameters):null}).filter(Boolean);if(k.length===0)return null;const V=g(k);return`${b(V,"compact")} total`});const w=U(()=>{if(e.trial.status!=="running"||!e.progress||e.progress.completed===0)return null;const k=(Date.now()-(e.trial.started?.getTime()||0))/e.progress.completed,V=e.progress.pending*k,H=Math.floor(V/(1e3*60)),N=Math.floor(V%(1e3*60)/1e3);if(H>60){const R=Math.floor(H/60),S=H%60;return`${R}h ${S}m`}return`${H}m ${N}s`});return(T,k)=>(d(),m("div",Pn,[s("div",Fn,[s("div",xn,[s("h2",An,_(t.value),1),s("span",{class:se(["status-tag",`status-${T.trial.status}`])},_(T.trial.status.toUpperCase()),3)]),a.value?(d(),m("div",On,[s("div",Vn,[s("div",{class:"progress-fill",style:ye({width:`${r.value}%`})},null,4)]),s("div",Dn,[s("span",Nn,_(n.value)+"/"+_(T.progress?.total||0)+" ("+_(r.value)+"%) ",1),u.value?(d(),m("span",Ln,[k[0]||(k[0]=s("span",{class:"stat-label"},"Duration:",-1)),k[1]||(k[1]=L()),s("span",Mn,_(u.value),1)])):P("",!0),p.value?(d(),m("span",Un,[k[2]||(k[2]=s("span",{class:"stat-label"},"Avg:",-1)),k[3]||(k[3]=L()),s("span",jn,_(p.value),1)])):P("",!0),w.value?(d(),m("span",Bn,[k[4]||(k[4]=s("span",{class:"stat-label"},"Remaining:",-1)),k[5]||(k[5]=L()),s("span",zn,"~"+_(w.value),1)])):P("",!0)])])):P("",!0)]),P("",!0)]))}}),Hn=ae(Wn,[["__scopeId","data-v-248be564"]]),Gn={class:"trial-actions"},qn={class:"action-group execution-controls"},Jn={class:"action-group data-actions"},Xn={class:"action-group management-actions"},Kn=ne({__name:"TrialActionsV3",props:{trial:{},isLeader:{type:Boolean},executionState:{}},emits:["start","pause","resume","cancel","duplicate","edit","delete","export-data","export-python","refresh"],setup(i,{emit:e}){const t=i,a=e,n=q(!1),r=q(!1),u=q(!1);U(()=>t.executionState?.currentTrialId===t.trial.id);const p=U(()=>["draft","failed","cancelled"].includes(t.trial.status)),c=U(()=>t.trial.status==="running"),v=U(()=>t.trial.status==="paused"),h=U(()=>["running","paused"].includes(t.trial.status));function g(){a("start")}async function b(){n.value=!0,r.value=!1,a("pause"),setTimeout(()=>{n.value=!1},1e3)}async function w(){r.value=!0,n.value=!1,a("resume"),setTimeout(()=>{r.value=!1},3e3)}function T(){Ce.confirm({title:"Cancel trial?",content:"This will stop all pending API calls.",okText:"Cancel Trial",okType:"danger",onOk:()=>a("cancel")})}async function k(){u.value=!0,a("refresh"),setTimeout(()=>{u.value=!1},500)}function V({key:S}){S==="data"?a("export-data"):S==="python"&&a("export-python")}function H(){a("duplicate")}function N(){a("edit")}function R(){const S=t.trial.progress.total;Ce.confirm({title:"Delete trial?",content:`Delete trial and all ${S} API calls?`,okText:"Delete",okType:"danger",cancelText:"Cancel",onOk:()=>{a("delete")}})}return(S,j)=>{const f=me,l=pt,D=ct,I=dt;return d(),m("div",Gn,[s("div",qn,[p.value?(d(),K(f,{key:0,type:"primary",size:"large",disabled:!S.isLeader,onClick:g},{default:x(()=>[C(z(yt)),j[0]||(j[0]=L(" Start Trial "))]),_:1,__:[0]},8,["disabled"])):P("",!0),c.value?(d(),K(f,{key:1,size:"large",disabled:!S.isLeader,loading:n.value,onClick:b},{default:x(()=>[n.value?P("",!0):(d(),K(z(Os),{key:0})),L(" "+_(n.value?"Pausing...":"Pause"),1)]),_:1},8,["disabled","loading"])):P("",!0),v.value?(d(),K(f,{key:2,type:"primary",size:"large",disabled:!S.isLeader||r.value,loading:r.value,onClick:w},{default:x(()=>[r.value?P("",!0):(d(),K(z(yt),{key:0})),L(" "+_(r.value?"Resuming...":"Resume"),1)]),_:1},8,["disabled","loading"])):P("",!0),h.value?(d(),K(f,{key:3,danger:"",size:"large",disabled:!S.isLeader,onClick:T},{default:x(()=>[C(z(Vs)),j[1]||(j[1]=L(" Cancel "))]),_:1,__:[1]},8,["disabled"])):P("",!0)]),s("div",Jn,[C(f,{size:"large",loading:u.value,onClick:k,title:"Refresh trial data from database"},{default:x(()=>[u.value?(d(),K(z(Ut),{key:1,spin:""})):(d(),K(z(Ds),{key:0})),L(" "+_(u.value?"Refreshing...":"Refresh"),1)]),_:1},8,["loading"]),C(I,null,{overlay:x(()=>[C(D,{onClick:V},{default:x(()=>[C(l,{key:"data"},{default:x(()=>[C(z(Ls)),j[3]||(j[3]=L(" Export Data "))]),_:1,__:[3]}),C(l,{key:"python"},{default:x(()=>[C(z(Ms)),j[4]||(j[4]=L(" Export Python Script "))]),_:1,__:[4]})]),_:1})]),default:x(()=>[C(f,{size:"large"},{default:x(()=>[j[2]||(j[2]=L(" Export ")),C(z(Ns))]),_:1,__:[2]})]),_:1})]),s("div",Xn,[C(f,{size:"large",disabled:!S.isLeader,onClick:H},{default:x(()=>[C(z(ft)),j[5]||(j[5]=L(" Duplicate "))]),_:1,__:[5]},8,["disabled"]),S.trial.status==="draft"?(d(),K(f,{key:0,size:"large",disabled:!S.isLeader,onClick:N},{default:x(()=>[C(z(Us)),j[6]||(j[6]=L(" Edit "))]),_:1,__:[6]},8,["disabled"])):P("",!0),C(f,{danger:"",size:"large",disabled:!S.isLeader,onClick:R},{default:x(()=>[C(z(js)),j[7]||(j[7]=L(" Delete "))]),_:1,__:[7]},8,["disabled"])])])}}}),Yn=ae(Kn,[["__scopeId","data-v-e642c431"]]),Qn={class:"snapshot-debug"},Zn={class:"debug-header"},er={class:"status-row"},tr={key:0,class:"badge success"},sr={key:1,class:"badge warning"},ar={key:0,class:"status-row"},nr={key:0,class:"variables-section"},rr={class:"variable-header"},or={class:"var-name"},ir={class:"var-type"},lr={key:0,class:"snapshot-content"},ur={class:"snapshot-meta"},dr={key:0},cr={class:"snapshot-items"},pr={class:"items-preview"},fr={class:"item-index"},mr={class:"item-value"},vr={key:0,class:"item-attrs"},gr={key:0,class:"more-indicator"},hr={key:1,class:"no-snapshot"},yr={key:0},br={key:1,class:"legacy-warning"},_r={class:"debug-footer"},Tr=ne({__name:"SnapshotDebugModal",props:{visible:{type:Boolean},trial:{},migrating:{type:Boolean}},emits:["close","migrate"],setup(i){const e=i,t=U(()=>e.trial.templateConfig?.hasSnapshots===!0),a=U(()=>e.trial.templateConfig?.variables||{});function n(v){return"snapshot"in v&&v.snapshot!=null}function r(v){return v.snapshot}function u(v){return n(v)?`${r(v).source.type} (snapshot)`:v.type==="value"?"Direct values":v.type==="list"?"List reference":"Unknown"}function p(){for(const v of Object.values(a.value))if(n(v)){const h=r(v);if(h.source?.snapshotDate)return new Date(h.source.snapshotDate).toLocaleString()}return"Unknown"}function c(){const v={trialId:e.trial.id,trialName:e.trial.name,hasSnapshots:t.value,variables:a.value};navigator.clipboard.writeText(JSON.stringify(v,null,2)),Z.success("Debug info copied to clipboard")}return(v,h)=>{const g=mt,b=ze,w=me,T=Ce;return d(),K(T,{visible:v.visible,title:"Variable Snapshot Debug View",width:"80%",footer:null,onCancel:h[2]||(h[2]=k=>v.$emit("close"))},{default:x(()=>[s("div",Qn,[s("div",Zn,[s("div",er,[h[5]||(h[5]=s("span",{class:"label"},"Snapshot Status:",-1)),t.value?(d(),m("span",tr,[C(z(jt)),h[3]||(h[3]=L(" Snapshots Enabled "))])):(d(),m("span",sr,[C(z(Pe)),h[4]||(h[4]=L(" Legacy Mode (No Snapshots) "))]))]),t.value?(d(),m("div",ar,[h[6]||(h[6]=s("span",{class:"label"},"Snapshot Date:",-1)),s("span",null,_(p()),1)])):P("",!0)]),t.value?(d(),m("div",nr,[h[8]||(h[8]=s("h3",null,"Variable Snapshots",-1)),(d(!0),m(ee,null,te(a.value,(k,V)=>(d(),m("div",{key:V,class:"variable-card"},[s("div",rr,[s("span",or,_(V),1),s("span",ir,_(u(k)),1)]),n(k)?(d(),m("div",lr,[s("div",ur,[s("span",null,"Source: "+_(r(k).source.type),1),r(k).source.listName?(d(),m("span",dr," List: "+_(r(k).source.listName),1)):P("",!0),s("span",null,"Items: "+_(r(k).items.length),1)]),s("div",cr,[s("div",pr,[(d(!0),m(ee,null,te(r(k).items.slice(0,5),(H,N)=>(d(),m("div",{key:N,class:"item-row"},[s("span",fr,_(N+1)+".",1),s("span",mr,_(H.value),1),H.attributes&&Object.keys(H.attributes).length>0?(d(),m("span",vr,[(d(!0),m(ee,null,te(H.attributes,(R,S)=>(d(),K(g,{key:S,size:"small"},{default:x(()=>[L(_(S)+": "+_(R),1)]),_:2},1024))),128))])):P("",!0)]))),128)),r(k).items.length>5?(d(),m("div",gr," ... and "+_(r(k).items.length-5)+" more items ",1)):P("",!0)])])])):(d(),m("div",hr,[C(z(Pe)),h[7]||(h[7]=L(" No snapshot - using live reference ")),k.listId?(d(),m("span",yr,"List ID: "+_(k.listId),1)):P("",!0)]))]))),128))])):(d(),m("div",br,[C(b,{message:"Legacy Trial",description:"This trial was created before snapshots were implemented. Variable lists are loaded dynamically from the database, which means changes to lists will affect trial duplication.",type:"warning","show-icon":""}),C(w,{type:"primary",onClick:h[0]||(h[0]=k=>v.$emit("migrate")),loading:v.migrating,style:{"margin-top":"16px"}},{default:x(()=>[C(z(Bs)),h[9]||(h[9]=L(" Migrate to Snapshots "))]),_:1,__:[9]},8,["loading"])])),s("div",_r,[C(w,{onClick:c},{default:x(()=>[C(z(ft)),h[10]||(h[10]=L(" Copy Debug Info "))]),_:1,__:[10]}),C(w,{onClick:h[1]||(h[1]=k=>v.$emit("close"))},{default:x(()=>h[11]||(h[11]=[L("Close")])),_:1,__:[11]})])])]),_:1},8,["visible"])}}}),kr=ae(Tr,[["__scopeId","data-v-726379cc"]]),Cr={class:"trial-detail-view"},$r={key:0,class:"detail-content"},wr={class:"detail-section"},Sr={class:"detail-grid"},Ir={class:"detail-item"},Er={key:0,class:"detail-item"},Rr={key:1,class:"detail-item"},Pr={class:"detail-item"},Fr={class:"detail-item"},xr={class:"detail-section"},Ar={class:"detail-grid"},Or={key:0,class:"detail-item full-width"},Vr={key:1,class:"detail-item full-width"},Dr={class:"detail-item"},Nr={class:"detail-item"},Lr={style:{display:"flex","align-items":"center",gap:"8px"}},Mr={key:0,class:"snapshot-badge success"},Ur={key:1,class:"snapshot-badge warning"},jr={class:"detail-item"},Br={key:2,class:"detail-item"},zr={key:0,class:"detail-section"},Wr={class:"detail-grid"},Hr={class:"detail-item"},Gr={class:"detail-item"},qr={class:"detail-item"},Jr={class:"detail-section"},Xr={class:"model-configs"},Kr={class:"config-header"},Yr=["src","alt"],Qr={class:"provider-name"},Zr={class:"config-details"},eo={class:"config-item"},to={class:"config-params"},so={class:"param-list"},ao={key:0,class:"config-item"},no={class:"cost"},ro={key:1,class:"config-item"},oo={class:"cost"},io={class:"config-item"},lo={class:"snapshot-debug"},uo=ne({__name:"TrialDetailView",props:{trial:{},isCollapsed:{type:Boolean}},emits:["toggle-collapse"],setup(i){const e=i,t=q(!1),{calculateTemplateTokens:a,estimateTotalCost:n,formatCost:r}=We(),u=U(()=>{const f=e.trial.started||e.trial.created,D=(e.trial.completed||new Date).getTime()-f.getTime(),I=Math.floor(D/(1e3*60*60)),o=Math.floor(D%(1e3*60*60)/(1e3*60));return I>0?`${I}h ${o}m`:`${o}m`}),p=U(()=>({draft:"Not started",pending:"Waiting to start",running:"Executing API calls",paused:"Execution paused",completed:"All calls completed",failed:"Execution failed",cancelled:"Execution cancelled"})[e.trial.status]||e.trial.status),c=U(()=>e.trial.type==="template"&&e.trial.templateConfig?.variables?Object.keys(e.trial.templateConfig.variables).length:0),v=U(()=>Math.round(e.trial.progress.total*750)),h=U(()=>e.trial.type==="template"&&e.trial.templateConfig?e.trial.templateConfig.hasSnapshots===!0:!1),g=U(()=>"text"),b=U(()=>1),w=U(()=>e.trial.progress.total/b.value);function T(f){return f?new Date(f).toLocaleString():"N/A"}function k(){if(e.trial.templateConfig?.templateName)return e.trial.templateConfig.templateName;const f=e.trial.templateConfig?.template||"Unknown Template";return f.length>50?f.substring(0,50)+"...":f}function V(){return e.trial.spreadsheetConfig?.datasetId||"Unknown Dataset"}function H(f){return{"openai-chat":"OpenAI","anthropic-messages":"Anthropic",openrouter:"OpenRouter","ollama-chat":"Ollama","ollama-generate":"Ollama"}[f]||f}function N(f){}async function R(){try{Z.info("Migration feature coming soon"),t.value=!1}catch(f){Z.error("Failed to migrate trial"),F.error("Migration error:",f)}}function S(f){const l=f.modelSnapshot;return l?.capabilities?.inputCostPerToken?`$${((l.capabilities.inputCostPerToken+l.capabilities.outputCostPerToken)*1e3).toFixed(8)}/1k tokens`:null}function j(f){if(!e.trial.configurations||!f.modelSnapshot)return null;let l=null;if(e.trial.type==="template"&&e.trial.templateConfig?.template)l=a(e.trial.templateConfig.template,e.trial.templateConfig.variables||{});else return null;if(!l||l.totalTokens===0)return null;const D=n(l.totalTokens,l.combinationCount,f.modelSnapshot,f.parameters);if(!D.meta.hasValidCost||D.cost.total.expected===-1)return null;const I=(e.trial.repeatCount||1)*D.cost.total.expected;return r({...D,cost:{...D.cost,total:{...D.cost.total,expected:I}}},"compact")}return(f,l)=>{const D=me;return d(),m("div",Cr,[s("div",{class:"detail-header",onClick:l[0]||(l[0]=I=>f.$emit("toggle-collapse"))},[l[3]||(l[3]=s("h3",null,"Trial Details",-1)),C(z(zs),{class:se(["collapse-icon",{rotated:f.isCollapsed}])},null,8,["class"])]),f.isCollapsed?P("",!0):(d(),m("div",$r,[s("div",wr,[l[9]||(l[9]=s("h4",null,"Basic Information",-1)),s("div",Sr,[s("div",Ir,[l[4]||(l[4]=s("label",null,"Created:",-1)),s("span",null,_(T(f.trial.created)),1)]),f.trial.started?(d(),m("div",Er,[l[5]||(l[5]=s("label",null,"Started:",-1)),s("span",null,_(T(f.trial.started)),1)])):P("",!0),f.trial.completed?(d(),m("div",Rr,[l[6]||(l[6]=s("label",null,"Completed:",-1)),s("span",null,_(T(f.trial.completed)),1)])):P("",!0),s("div",Pr,[l[7]||(l[7]=s("label",null,"Duration:",-1)),s("span",null,_(u.value),1)]),s("div",Fr,[l[8]||(l[8]=s("label",null,"Status:",-1)),s("span",null,_(f.trial.status)+" - "+_(p.value),1)])])]),s("div",xr,[l[19]||(l[19]=s("h4",null,"Configuration",-1)),s("div",Ar,[f.trial.type==="template"?(d(),m("div",Or,[l[10]||(l[10]=s("label",null,"Template:",-1)),s("span",null,_(k()),1)])):P("",!0),f.trial.type==="spreadsheet"?(d(),m("div",Vr,[l[11]||(l[11]=s("label",null,"Dataset:",-1)),s("span",null,_(V()),1)])):P("",!0),s("div",Dr,[l[12]||(l[12]=s("label",null,"Variable Lists:",-1)),s("span",null,_(c.value)+" lists",1)]),s("div",Nr,[l[16]||(l[16]=s("label",null,"Data Snapshot:",-1)),s("div",Lr,[h.value?(d(),m("span",Mr,[C(z(jt)),l[13]||(l[13]=L(" Captured "))])):(d(),m("span",Ur,[C(z(Pe)),l[14]||(l[14]=L(" Live Reference "))])),f.trial.type==="template"?(d(),K(D,{key:2,size:"small",type:"link",onClick:l[1]||(l[1]=I=>t.value=!0)},{default:x(()=>[C(z(Bt)),l[15]||(l[15]=L(" Debug "))]),_:1,__:[15]})):P("",!0)])]),s("div",jr,[l[17]||(l[17]=s("label",null,"Token Estimate:",-1)),s("span",null,"~"+_(v.value)+" tokens",1)]),g.value?(d(),m("div",Br,[l[18]||(l[18]=s("label",null,"Output Type:",-1)),s("span",{class:se(["output-type",`type-${g.value}`])},_(g.value),3)])):P("",!0)])]),b.value>1?(d(),m("div",zr,[l[23]||(l[23]=s("h4",null,"Repeat Configuration",-1)),s("div",Wr,[s("div",Hr,[l[20]||(l[20]=s("label",null,"Times per prompt:",-1)),s("span",null,_(b.value),1)]),s("div",Gr,[l[21]||(l[21]=s("label",null,"Total combinations:",-1)),s("span",null,_(w.value),1)]),s("div",qr,[l[22]||(l[22]=s("label",null,"Total API calls:",-1)),s("span",null,_(f.trial.progress.total),1)])])])):P("",!0),s("div",Jr,[l[29]||(l[29]=s("h4",null,"Model Configurations",-1)),s("div",Xr,[(d(!0),m(ee,null,te(f.trial.configurations,(I,o)=>(d(),m("div",{key:o,class:"model-config-card"},[s("div",Kr,[(I.provider,void 0)?(d(),m("img",{key:0,src:(I.provider,void 0),alt:I.provider,class:"provider-logo"},null,8,Yr)):P("",!0),s("span",Qr,_(H(I.provider)),1)]),s("div",Zr,[s("div",eo,[l[24]||(l[24]=s("label",null,"Model:",-1)),s("span",null,_(I.modelId),1)]),s("div",to,[l[25]||(l[25]=s("label",null,"Parameters:",-1)),s("div",so,[(d(!0),m(ee,null,te(I.parameters,(A,$)=>(d(),m("span",{key:$,class:"param-tag"},_($)+": "+_(A),1))),128))])]),S(I)?(d(),m("div",ao,[l[26]||(l[26]=s("label",null,"Cost Rate:",-1)),s("span",no,_(S(I)),1)])):P("",!0),j(I)?(d(),m("div",ro,[l[27]||(l[27]=s("label",null,"Total Trial Cost:",-1)),s("span",oo,_(j(I)),1)])):P("",!0),s("div",io,[l[28]||(l[28]=s("label",null,"Model Snapshot:",-1)),s("pre",lo,_(JSON.stringify(I.modelSnapshot,null,2)),1)])])]))),128))])])])),t.value?(d(),K(kr,{key:1,visible:t.value,trial:f.trial,onClose:l[2]||(l[2]=I=>t.value=!1),onMigrate:R},null,8,["visible","trial"])):P("",!0)])}}}),co=ae(uo,[["__scopeId","data-v-e677baaf"]]),po={class:"filter-bar"},fo={class:"search-container"},mo=ne({__name:"TrialResultsFilterBar",props:{statusFilter:{},configFilter:{},searchQuery:{},visibleColumns:{},configurations:{},apiCalls:{},showRepeatColumn:{type:Boolean}},emits:["update:statusFilter","update:configFilter","update:searchQuery","update:visibleColumns","openPostProcessing"],setup(i,{emit:e}){const t=i,a=e,n=U(()=>{const v=[{key:"status",label:"Status"},{key:"configuration",label:"Configuration"},{key:"variables",label:"Variables"},{key:"response",label:"Response"},{key:"parsedResponse",label:"Parsed Response"},{key:"postProcessedResponse",label:"Post-Processed"},{key:"length",label:"Length"},{key:"latency",label:"Latency"}];return t.showRepeatColumn&&v.splice(2,0,{key:"repeat",label:"Repeat Index"}),v}),r=U(()=>{const v={total:t.apiCalls.length,completed:0,failed:0,running:0,pending:0};return t.apiCalls.forEach(h=>{h.status==="completed"?v.completed++:h.status==="failed"?v.failed++:h.status==="running"?v.running++:h.status==="pending"&&v.pending++}),v});function u(v){return v.modelSnapshot?.displayName||`${v.provider} - ${v.modelId}`}const p=Jt(v=>{const h=v.target.value;a("update:searchQuery",h)},300);function c(v){const h=[...t.visibleColumns],g=h.indexOf(v);if(g>-1)h.splice(g,1);else{const b=n.value.map(k=>k.key),w=b.indexOf(v);let T=0;for(let k=0;k<w;k++)h.includes(b[k])&&T++;h.splice(T,0,v)}a("update:visibleColumns",h)}return(v,h)=>{const g=Hs,b=Ws,w=zt,T=me,k=Wt,V=pt,H=ct,N=dt;return d(),m("div",po,[C(b,{value:v.statusFilter,onChange:h[0]||(h[0]=R=>v.$emit("update:statusFilter",R)),placeholder:"Filter by status",style:{width:"150px"}},{default:x(()=>[C(g,{value:"all"},{default:x(()=>[L(" All ("+_(r.value.total)+") ",1)]),_:1}),C(g,{value:"completed"},{default:x(()=>[L(" Completed ("+_(r.value.completed)+") ",1)]),_:1}),C(g,{value:"failed"},{default:x(()=>[L(" Failed ("+_(r.value.failed)+") ",1)]),_:1}),C(g,{value:"running"},{default:x(()=>[L(" Running ("+_(r.value.running)+") ",1)]),_:1}),C(g,{value:"pending"},{default:x(()=>[L(" Pending ("+_(r.value.pending)+") ",1)]),_:1})]),_:1},8,["value"]),C(b,{value:v.configFilter,onChange:h[1]||(h[1]=R=>v.$emit("update:configFilter",R)),mode:"multiple",placeholder:"Filter by configuration",style:{width:"250px"},"max-tag-count":2},{default:x(()=>[C(g,{value:""},{default:x(()=>h[3]||(h[3]=[L("All Configurations")])),_:1,__:[3]}),(d(!0),m(ee,null,te(v.configurations,(R,S)=>(d(),K(g,{key:S,value:S.toString()},{default:x(()=>[L(_(u(R)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s("div",fo,[C(w,{value:v.searchQuery,onInput:z(p),placeholder:"Search in variables and responses...",style:{width:"400px"},"allow-clear":""},{prefix:x(()=>[C(z(Dt))]),_:1},8,["value","onInput"])]),C(N,null,{overlay:x(()=>[C(H,null,{default:x(()=>[(d(!0),m(ee,null,te(n.value,R=>(d(),K(V,{key:R.key},{default:x(()=>[C(k,{checked:v.visibleColumns.includes(R.key),disabled:R.key==="status",onChange:S=>c(R.key)},{default:x(()=>[L(_(R.label),1)]),_:2},1032,["checked","disabled","onChange"])]),_:2},1024))),128))]),_:1})]),default:x(()=>[C(T,null,{default:x(()=>[C(z(Gs)),h[4]||(h[4]=L(" Columns "))]),_:1,__:[4]})]),_:1}),C(T,{type:"primary",onClick:h[2]||(h[2]=R=>v.$emit("openPostProcessing"))},{default:x(()=>[C(z(Ht)),h[5]||(h[5]=L(" Post-Process "))]),_:1,__:[5]})])}}}),vo=ae(mo,[["__scopeId","data-v-e6112af3"]]),go={class:"modal-content"},ho={class:"section"},yo={class:"info-grid"},bo={class:"info-item"},_o={class:"monospace"},To={class:"info-item"},ko={class:"info-item"},Co={key:0,class:"info-item"},$o={class:"info-item"},wo={key:1,class:"info-item"},So={key:2,class:"info-item"},Io={key:3,class:"info-item"},Eo={key:0,class:"info-row"},Ro={class:"monospace"},Po={key:0,class:"section"},Fo={class:"variables-list"},xo={class:"variable-main"},Ao={class:"variable-label"},Oo={class:"variable-value"},Vo={key:0,class:"variable-attributes"},Do={class:"attribute-label"},No={class:"attribute-value"},Lo={class:"section"},Mo={class:"content-box prompt-display"},Uo={key:1,class:"section"},jo={key:0,class:"error-result"},Bo={key:1,class:"success-result"},zo={class:"content-box response-content"},Wo={key:0,class:"parsed-content-section"},Ho={class:"content-box parsed-content"},Go={key:1,class:"post-processed-section"},qo={class:"content-box post-processed-content"},Jo={key:2,class:"refusal-warning"},Xo={key:3,class:"refusal-warning"},Ko={class:"extraction-config-section"},Yo={class:"config-grid"},Qo={key:0,class:"config-item"},Zo={class:"config-value"},ei={key:1,class:"config-item"},ti={class:"config-value"},si={key:2,class:"config-item"},ai={class:"config-value pattern"},ni={key:3,class:"config-item"},ri={class:"config-value"},oi={key:4,class:"config-item"},ii={class:"config-value"},li={key:5,class:"config-item no-extraction"},ui={key:4,class:"post-processing-config-section"},di={class:"config-grid"},ci={class:"config-item post-processing-item"},pi={class:"config-value"},fi={key:0,class:"config-item post-processing-item"},mi={class:"config-value"},vi={key:1,class:"config-item post-processing-item"},gi={class:"config-value pattern"},hi={key:2,class:"config-item post-processing-item"},yi={class:"config-value"},bi={key:3,class:"config-item post-processing-item"},_i={class:"config-value"},Ti={key:4,class:"config-item post-processing-item"},ki={class:"config-value"},Ci={key:5,class:"usage-info"},$i={class:"info-grid"},wi={class:"info-item"},Si={class:"info-item"},Ii={class:"info-item"},Ei={key:0,class:"info-item"},Ri={class:"raw-data-section"},Pi={class:"raw-data"},Fi={key:0},xi={key:1,class:"raw-data"},Ai={key:2},Oi={key:3,class:"raw-data"},Vi={class:"modal-footer"},Di=ne({__name:"APICallDetailModalV3",props:{visible:{type:Boolean},apiCall:{},trial:{}},emits:["update:visible"],setup(i,{emit:e}){const t=i,a=e,n=hs(),r=U(()=>{if(t.apiCall.duration!==void 0)return t.apiCall.duration;if(!t.apiCall.completed||!t.apiCall.created)return null;const f=new Date(t.apiCall.created).getTime();return new Date(t.apiCall.completed).getTime()-f}),u=U(()=>{if(t.apiCall.modelName){const l=t.trial.configurations[t.apiCall.configurationIndex];return l?`${l.provider} / ${t.apiCall.modelName}`:t.apiCall.modelName}const f=t.trial.configurations[t.apiCall.configurationIndex];return f?`${f.provider} / ${f.modelId}`:null}),p=U(()=>{if(t.apiCall.cost!==void 0)return t.apiCall.cost;if(!t.apiCall.result?.usage)return null;const f=t.trial.configurations[t.apiCall.configurationIndex];if(!f)return null;const l=n.models.value.find(o=>o.provider===f.provider&&o.modelId===f.modelId);if(!l?.capabilities?.inputCostPerToken&&!l?.capabilities?.outputCostPerToken)return null;const D=(t.apiCall.result.usage.prompt_tokens||0)*(l.capabilities.inputCostPerToken||0),I=(t.apiCall.result.usage.completion_tokens||0)*(l.capabilities.outputCostPerToken||0);return D+I}),c=U(()=>{if(!t.apiCall.request)return"No request data";const f=JSON.parse(JSON.stringify(t.apiCall.request));return f.headers&&Object.keys(f.headers).forEach(l=>{(l.toLowerCase().includes("authorization")||l.toLowerCase().includes("api-key")||l.toLowerCase().includes("x-api-key"))&&(f.headers[l]="[REDACTED]")}),f.body&&typeof f.body=="object"&&(f.body.api_key&&(f.body.api_key="[REDACTED]"),f.body.apiKey&&(f.body.apiKey="[REDACTED]")),JSON.stringify(f,null,2)}),v=U(()=>t.apiCall.parserId?{parserId:t.apiCall.parserId,outputType:t.trial.type==="template"?t.trial.templateConfig?.outputType:void 0,extractPattern:t.trial.type==="template"?t.trial.templateConfig?.extractPattern:void 0,refusalWords:t.trial.type==="template"?t.trial.templateConfig?.refusalWords:void 0,rejectRefusalWords:t.trial.type==="template"?t.trial.templateConfig?.rejectRefusalWords:void 0}:t.trial.type!=="template"||!t.trial.templateConfig?{}:{parserId:t.trial.templateConfig.parserId,outputType:t.trial.templateConfig.outputType,extractPattern:t.trial.templateConfig.extractPattern,refusalWords:t.trial.templateConfig.refusalWords,rejectRefusalWords:t.trial.templateConfig.rejectRefusalWords}),h=U(()=>{const f=v.value;return!!(f.parserId||f.outputType||f.extractPattern||f.refusalWords&&f.refusalWords.length>0)}),g=U(()=>t.trial.postProcessingConfig||null),b=U(()=>t.apiCall.response?JSON.stringify({status:t.apiCall.response.status,headers:t.apiCall.response.headers,body:t.apiCall.response.body,latencyMs:t.apiCall.response.latencyMs},null,2):"No response data available"),w=U(()=>t.apiCall.result?JSON.stringify(t.apiCall.result,null,2):"No processed result available");function T(f){return{completed:"success",failed:"error",running:"processing",pending:"warning"}[f]||"default"}function k(){const f=t.trial.configurations[t.apiCall.configurationIndex];return f?.modelSnapshot?.displayName||f?.modelId||`Configuration ${t.apiCall.configurationIndex+1}`}function V(f){return(typeof f=="string"?new Date(f):f).toLocaleString()}function H(f){return f<1e3?`${f}ms`:f<6e4?`${(f/1e3).toFixed(1)}s`:`${Math.floor(f/6e4)}m ${(f%6e4/1e3).toFixed(0)}s`}function N(f){return f==null?"null":typeof f=="string"?f:typeof f=="number"||typeof f=="boolean"?String(f):JSON.stringify(f,null,2)}function R(f){return{network_error_no_response:"Network Error (No Response)",api_error_received:"API Error Response",parsing_error:"Response Parsing Error",timeout:"Request Timeout",rate_limit:"Rate Limit Exceeded"}[f]||f}function S(){a("update:visible",!1)}async function j(){const f={id:t.apiCall.id,status:t.apiCall.status,configuration:k(),provider:u.value,variables:t.apiCall.variables,variableAttributes:t.apiCall.variableAttributes,prompt:t.apiCall.prompt,fullApiResponse:t.apiCall.response,processedResult:t.apiCall.result,extractionConfig:v.value,postProcessingConfig:g.value,created:t.apiCall.created,completed:t.apiCall.completed,duration:r.value?`${r.value}ms`:null,cost:p.value?`$${p.value.toFixed(4)}`:null},l=JSON.stringify(f,null,2);try{await navigator.clipboard.writeText(l),Z.success("Details copied to clipboard!")}catch(D){F.error("Failed to copy to clipboard",D),Z.error("Failed to copy to clipboard")}}return(f,l)=>{const D=mt,I=ze,o=Js,A=qs,$=me,E=Ce;return d(),K(E,{open:f.visible,onCancel:l[0]||(l[0]=G=>a("update:visible",!1)),title:"API Call Details",width:1400,footer:null,"body-style":{padding:0,height:"85vh",display:"flex",flexDirection:"column"},centered:!0,"destroy-on-close":!0,class:"api-call-detail-modal"},{default:x(()=>[s("div",go,[s("div",ho,[l[10]||(l[10]=s("h3",null,"Overview",-1)),s("div",yo,[s("div",bo,[l[1]||(l[1]=s("label",null,"Call ID:",-1)),s("span",_o,_(f.apiCall.id),1)]),s("div",To,[l[2]||(l[2]=s("label",null,"Status:",-1)),C(D,{color:T(f.apiCall.status)},{default:x(()=>[L(_(f.apiCall.status.toUpperCase()),1)]),_:1},8,["color"])]),s("div",ko,[l[3]||(l[3]=s("label",null,"Configuration:",-1)),s("span",null,_(k()),1)]),f.apiCall.repeatIndex!==void 0?(d(),m("div",Co,[l[4]||(l[4]=s("label",null,"Repeat:",-1)),s("span",null,"#"+_(f.apiCall.repeatIndex+1),1)])):P("",!0),s("div",$o,[l[5]||(l[5]=s("label",null,"Created:",-1)),s("span",null,_(V(f.apiCall.created)),1)]),f.apiCall.completed?(d(),m("div",wo,[l[6]||(l[6]=s("label",null,"Completed:",-1)),s("span",null,_(V(f.apiCall.completed)),1)])):P("",!0),r.value?(d(),m("div",So,[l[7]||(l[7]=s("label",null,"Duration:",-1)),s("span",null,_(H(r.value)),1)])):P("",!0),f.apiCall.result?.latency?(d(),m("div",Io,[l[8]||(l[8]=s("label",null,"API Latency:",-1)),s("span",null,_(f.apiCall.result.latency)+"ms",1)])):P("",!0)]),u.value?(d(),m("div",Eo,[l[9]||(l[9]=s("label",null,"Provider/Model:",-1)),s("span",Ro,_(u.value),1)])):P("",!0)]),f.apiCall.variables&&Object.keys(f.apiCall.variables).length>0?(d(),m("div",Po,[l[11]||(l[11]=s("h3",null,"Variables",-1)),s("div",Fo,[(d(!0),m(ee,null,te(f.apiCall.variables,(G,O)=>(d(),m("div",{key:O,class:"variable-group"},[s("div",xo,[s("label",Ao,_(O)+":",1),s("span",Oo,_(G),1)]),f.apiCall.variableAttributes&&f.apiCall.variableAttributes[O]?(d(),m("div",Vo,[(d(!0),m(ee,null,te(f.apiCall.variableAttributes[O],(Y,y)=>(d(),m("div",{key:y,class:"attribute-item"},[s("label",Do,_(y)+":",1),s("span",No,_(Y),1)]))),128))])):P("",!0)]))),128))])])):P("",!0),s("div",Lo,[l[12]||(l[12]=s("h3",null,"Resolved Prompt",-1)),s("div",Mo,_(f.apiCall.prompt),1)]),f.apiCall.result?(d(),m("div",Uo,[l[35]||(l[35]=s("h3",null,"Response",-1)),f.apiCall.status==="failed"&&f.apiCall.result.error?(d(),m("div",jo,[C(I,{type:"error",message:f.apiCall.result.error,description:f.apiCall.result.errorType?`Error Type: ${R(f.apiCall.result.errorType)}`:void 0,"show-icon":""},null,8,["message","description"])])):f.apiCall.result.content?(d(),m("div",Bo,[s("div",zo,_(f.apiCall.result.content),1),f.apiCall.result.parsedContent!==void 0?(d(),m("div",Wo,[l[13]||(l[13]=s("h4",null,"Extracted Value (Original)",-1)),s("div",Ho,_(N(f.apiCall.result.parsedContent)),1)])):P("",!0),f.apiCall.result.postParsedContent!==void 0?(d(),m("div",Go,[l[14]||(l[14]=s("h4",null,"Post-Processed Value",-1)),s("div",qo,_(N(f.apiCall.result.postParsedContent)),1)])):P("",!0),f.apiCall.result.refused?(d(),m("div",Jo,[C(I,{type:"warning",message:"Response flagged as refusal (Original Extraction)",description:"This response matched configured refusal patterns","show-icon":""})])):P("",!0),f.apiCall.result.postRefused?(d(),m("div",Xo,[C(I,{type:"warning",message:"Response flagged as refusal (Post-Processing)",description:"This response matched post-processing refusal patterns","show-icon":""})])):P("",!0),s("div",Ko,[l[21]||(l[21]=s("h4",null,"Original Extraction Configuration",-1)),s("div",Yo,[v.value.parserId?(d(),m("div",Qo,[l[15]||(l[15]=s("label",null,"Parser ID:",-1)),s("span",Zo,_(v.value.parserId),1)])):P("",!0),v.value.outputType?(d(),m("div",ei,[l[16]||(l[16]=s("label",null,"Output Type:",-1)),s("span",ti,_(v.value.outputType),1)])):P("",!0),v.value.extractPattern?(d(),m("div",si,[l[17]||(l[17]=s("label",null,"Extract Pattern:",-1)),s("span",ai,_(v.value.extractPattern),1)])):P("",!0),v.value.refusalWords&&v.value.refusalWords.length>0?(d(),m("div",ni,[l[18]||(l[18]=s("label",null,"Refusal Words:",-1)),s("span",ri,_(v.value.refusalWords.join(", ")),1)])):P("",!0),v.value.rejectRefusalWords!==void 0?(d(),m("div",oi,[l[19]||(l[19]=s("label",null,"Reject on Refusal:",-1)),s("span",ii,_(v.value.rejectRefusalWords?"Yes":"No"),1)])):P("",!0),h.value?P("",!0):(d(),m("div",li,l[20]||(l[20]=[s("span",{class:"no-config-message"},"No extraction configuration set for this trial",-1)])))])]),g.value&&g.value.enabled?(d(),m("div",ui,[l[29]||(l[29]=s("h4",null,"Post-Processing Configuration",-1)),s("div",di,[s("div",ci,[l[23]||(l[23]=s("label",null,"Status:",-1)),s("span",pi,[C(D,{color:"processing"},{default:x(()=>l[22]||(l[22]=[L("Enabled")])),_:1,__:[22]})])]),g.value.outputType?(d(),m("div",fi,[l[24]||(l[24]=s("label",null,"Output Type:",-1)),s("span",mi,_(g.value.outputType),1)])):P("",!0),g.value.extractPattern?(d(),m("div",vi,[l[25]||(l[25]=s("label",null,"Extract Pattern:",-1)),s("span",gi,_(g.value.extractPattern),1)])):P("",!0),g.value.refusalWords&&g.value.refusalWords.length>0?(d(),m("div",hi,[l[26]||(l[26]=s("label",null,"Refusal Words:",-1)),s("span",yi,_(g.value.refusalWords.join(", ")),1)])):P("",!0),g.value.rejectRefusalWords!==void 0?(d(),m("div",bi,[l[27]||(l[27]=s("label",null,"Reject on Refusal:",-1)),s("span",_i,_(g.value.rejectRefusalWords?"Yes":"No"),1)])):P("",!0),g.value.updatedAt?(d(),m("div",Ti,[l[28]||(l[28]=s("label",null,"Last Updated:",-1)),s("span",ki,_(V(g.value.updatedAt)),1)])):P("",!0)])])):P("",!0),f.apiCall.result.usage?(d(),m("div",Ci,[l[34]||(l[34]=s("h4",null,"Token Usage",-1)),s("div",$i,[s("div",wi,[l[30]||(l[30]=s("label",null,"Prompt Tokens:",-1)),s("span",null,_(f.apiCall.result.usage.prompt_tokens||0),1)]),s("div",Si,[l[31]||(l[31]=s("label",null,"Completion Tokens:",-1)),s("span",null,_(f.apiCall.result.usage.completion_tokens||0),1)]),s("div",Ii,[l[32]||(l[32]=s("label",null,"Total Tokens:",-1)),s("span",null,_(f.apiCall.result.usage.total_tokens||0),1)]),p.value?(d(),m("div",Ei,[l[33]||(l[33]=s("label",null,"Cost:",-1)),s("span",null,"$"+_(p.value.toFixed(4)),1)])):P("",!0)])])):P("",!0)])):P("",!0)])):P("",!0),C(A,{ghost:""},{default:x(()=>[C(o,{key:"raw",header:"Raw Data"},{default:x(()=>[s("div",Ri,[l[36]||(l[36]=s("h4",null,"HTTP Request",-1)),s("pre",Pi,_(c.value),1),f.apiCall.response?(d(),m("h4",Fi,"Full API Response")):P("",!0),f.apiCall.response?(d(),m("pre",xi,_(b.value),1)):P("",!0),f.apiCall.result?(d(),m("h4",Ai,"Processed Result")):P("",!0),f.apiCall.result?(d(),m("pre",Oi,_(w.value),1)):P("",!0)])]),_:1})]),_:1})]),s("div",Vi,[C($,{onClick:S,size:"large"},{default:x(()=>l[37]||(l[37]=[L(" Close ")])),_:1,__:[37]}),C($,{type:"primary",onClick:j,size:"large"},{default:x(()=>[C(z(ft)),l[38]||(l[38]=L(" Copy Details "))]),_:1,__:[38]})])]),_:1},8,["open"])}}}),es=ae(Di,[["__scopeId","data-v-72b861dc"]]),Ni={class:"post-processing-modal"},Li={key:2,class:"current-extraction"},Mi={class:"parser-info"},Ui={class:"parser-name"},ji={key:0,class:"test-results"},Bi={key:1,class:"statistics"},zi={class:"stat-item"},Wi={class:"stat-value"},Hi={class:"stat-item"},Gi={class:"stat-value"},qi={class:"stat-item"},Ji={class:"stat-value"},Xi={class:"stat-item"},Ki={class:"stat-value"},Yi={class:"modal-actions"},Qi=ne({__name:"PostProcessingModalV2",props:{visible:{type:Boolean},trial:{}},emits:["close"],setup(i,{emit:e}){const t=i,a=e,n=He(),r=ia(),u=q(t.visible),p=q(!1),c=q(!1),v=q(!1),h=q(null),g=q({enabled:!1,postParserId:null}),b=q([]),w=q(null),T=[{title:"Variables",dataIndex:"variables",key:"variables",width:200,customRender:({text:A})=>Object.entries(A).map(([$,E])=>`${$}: ${E}`).join(", ")},{title:"Original",dataIndex:"original",key:"original",slots:{customRender:"original"}},{title:"Post-Processed",dataIndex:"postProcessed",key:"postProcessed",slots:{customRender:"postProcessed"}},{title:"Changed",dataIndex:"changed",key:"changed",width:100,slots:{customRender:"changed"}}],k=U(()=>t.trial.parserId?r.parsers.find(A=>A.id===t.trial.parserId):null);function V(A){switch(A){case"regex":return"blue";case"javascript":return"orange";case"python":return"green";default:return"default"}}function H(A){return A===void 0?"(no match)":A===null?"null":typeof A=="string"&&A.length>50?A.substring(0,50)+"...":String(A)}function N(A){A||(b.value=[],w.value=null)}function R(){c.value=!0}function S(A){h.value=A,v.value=!0}async function j(A,$){if(!A||!$){b.value=[],w.value=null;return}await f($),await l($)}async function f(A){const $=n.apiCalls.value.filter(G=>G.result?.content).slice(0,10),E=[];for(const G of $){const O=await gt.executeParser(G.result.content,A);E.push({id:G.id,variables:G.variables,original:G.result.parsedContent,postProcessed:O.success?O.value:null,changed:O.success&&O.value!==G.result.parsedContent})}b.value=E}async function l(A){if(!n.apiCalls.value.length){w.value=null;return}const $=n.apiCalls.value,E=$.length,G=$.filter(y=>y.result?.content).length;let O=0,Y=0;for(const y of $){if(!y.result?.content)continue;const B=await gt.executeParser(y.result.content,A);B.success&&B.value!==void 0&&(O++,B.value!==y.result.parsedContent&&Y++)}w.value={total:E,withContent:G,matches:O,changed:Y}}async function D(){p.value=!0;try{const A=await bt.updatePostParserId(t.trial.id,null,!1);if(A.ok)g.value.enabled=!1,g.value.postParserId=null,Z.success("Post-processing disabled"),await n.refreshFromDatabase(t.trial.id);else throw A.error}catch(A){F.error("Failed to reset post-processing:",A),Z.error("Failed to reset post-processing")}finally{p.value=!1}}async function I(){if(!g.value.enabled){Z.warning("Please enable post-processing");return}if(!g.value.postParserId){Z.warning("Please select a parser");return}p.value=!0;try{const A=n.apiCalls.value.some(G=>G.status==="completed"&&G.result?.content),$=A&&await new Promise(G=>{G(A?confirm("Apply post-processing to existing completed calls?"):!1)}),E=await bt.updatePostParserId(t.trial.id,g.value.postParserId,$);if(E.ok)Z.success($?"Post-processing applied to all calls":"Post-processing will apply to future calls"),await n.refreshFromDatabase(t.trial.id),o();else throw E.error}catch(A){F.error("Failed to apply post-processing:",A),Z.error("Failed to apply post-processing")}finally{p.value=!1}}function o(){a("close")}return fe(async()=>{if(await r.initialize(),t.trial.postParserId){g.value.enabled=!0,g.value.postParserId=t.trial.postParserId;const A=r.parsers.find($=>$.id===t.trial.postParserId);A&&(await f(A),await l(A))}else t.trial.postProcessingConfig?.enabled&&(g.value.enabled=!0,Z.info("Legacy post-processing config detected. Please select a parser to continue."))}),re(()=>t.visible,A=>{u.value=A}),re(u,A=>{A||a("close")}),(A,$)=>{const E=ze,G=mt,O=Ys,Y=Ks,y=Qs,B=ea,J=Zs,X=me,oe=Xs,ce=Ce;return d(),K(ce,{visible:u.value,"onUpdate:visible":$[2]||($[2]=pe=>u.value=pe),title:"Post-Process Extraction",width:"80%",footer:null,onCancel:o},{default:x(()=>[s("div",Ni,[A.trial.status==="running"?(d(),K(E,{key:0,message:"Trial is currently running",description:"Post-processing will apply to all completed calls and future results as they arrive.",type:"info","show-icon":"",style:{"margin-bottom":"20px"}})):A.trial.status==="draft"?(d(),K(E,{key:1,message:"Trial not started",description:"Configure post-processing now. It will apply when the trial runs.",type:"warning","show-icon":"",style:{"margin-bottom":"20px"}})):P("",!0),k.value?(d(),m("div",Li,[$[3]||($[3]=s("h4",null,"Current Primary Parser",-1)),s("div",Mi,[s("span",Ui,_(k.value.name),1),C(G,{color:V(k.value.type)},{default:x(()=>[L(_(k.value.type),1)]),_:1},8,["color"]),C(G,null,{default:x(()=>[L(_(k.value.outputType),1)]),_:1})])])):P("",!0),C(oe,{model:g.value,layout:"vertical",onFinish:I},{default:x(()=>[C(Y,{label:"Enable Post-Processing"},{default:x(()=>[C(O,{checked:g.value.enabled,"onUpdate:checked":$[0]||($[0]=pe=>g.value.enabled=pe),onChange:N},{checkedChildren:x(()=>$[4]||($[4]=[L("ON")])),unCheckedChildren:x(()=>$[5]||($[5]=[L("OFF")])),_:1},8,["checked"])]),_:1}),C(Y,{label:"Post-Processing Parser",disabled:!g.value.enabled},{default:x(()=>[C(oa,{modelValue:g.value.postParserId,"onUpdate:modelValue":$[1]||($[1]=pe=>g.value.postParserId=pe),disabled:!g.value.enabled,"allow-create":!0,"show-preview":!0,placeholder:"Select or create a parser for post-processing",onCreate:R,onTest:S,onChange:j},null,8,["modelValue","disabled"])]),_:1},8,["disabled"]),b.value.length>0&&g.value.enabled?(d(),m("div",ji,[$[6]||($[6]=s("h4",null,"Preview Results (First 10 calls)",-1)),C(y,{columns:T,"data-source":b.value,pagination:!1,size:"small",scroll:{x:800}},{original:x(({text:pe})=>[s("code",null,_(H(pe)),1)]),postProcessed:x(({text:pe,record:Je})=>[s("code",{class:se({"value-changed":Je.changed})},_(H(pe)),3)]),changed:x(({text:pe})=>[C(G,{color:pe?"green":"default"},{default:x(()=>[L(_(pe?"Changed":"Same"),1)]),_:2},1032,["color"])]),_:1},8,["data-source"])])):P("",!0),w.value&&g.value.enabled?(d(),m("div",Bi,[C(J,{gutter:16},{default:x(()=>[C(B,{span:6},{default:x(()=>[s("div",zi,[$[7]||($[7]=s("div",{class:"stat-label"},"Total Calls",-1)),s("div",Wi,_(w.value.total),1)])]),_:1}),C(B,{span:6},{default:x(()=>[s("div",Hi,[$[8]||($[8]=s("div",{class:"stat-label"},"With Content",-1)),s("div",Gi,_(w.value.withContent),1)])]),_:1}),C(B,{span:6},{default:x(()=>[s("div",qi,[$[9]||($[9]=s("div",{class:"stat-label"},"Matches",-1)),s("div",Ji,_(w.value.matches),1)])]),_:1}),C(B,{span:6},{default:x(()=>[s("div",Xi,[$[10]||($[10]=s("div",{class:"stat-label"},"Changed",-1)),s("div",Ki,_(w.value.changed),1)])]),_:1})]),_:1})])):P("",!0),s("div",Yi,[C(X,{onClick:D,disabled:!g.value.enabled},{default:x(()=>$[11]||($[11]=[L(" Reset ")])),_:1,__:[11]},8,["disabled"]),C(X,{onClick:o},{default:x(()=>$[12]||($[12]=[L(" Cancel ")])),_:1,__:[12]}),C(X,{type:"primary","html-type":"submit",loading:p.value,disabled:!g.value.enabled||!g.value.postParserId},{default:x(()=>$[13]||($[13]=[L(" Apply Post-Processing ")])),_:1,__:[13]},8,["loading","disabled"])])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),Zi=ae(Qi,[["__scopeId","data-v-2ab953e4"]]),el={class:"trial-results-table"},tl={class:"table-container"},sl={class:"results-table"},al={key:0,class:"col-status"},nl={key:1,class:"col-configuration"},rl={key:2,class:"col-repeat"},ol={key:3,class:"col-variables"},il={key:4,class:"col-response"},ll={key:5,class:"col-parsed"},ul={key:6,class:"col-post-processed"},dl={key:0,class:"post-process-indicator"},cl={key:7,class:"col-length"},pl={key:8,class:"col-latency"},fl={class:"results-table"},ml=["onClick"],vl={key:0,class:"col-status"},gl={class:"status-cell"},hl={class:"status-time"},yl={key:1,class:"col-configuration"},bl={key:2,class:"col-repeat"},_l={key:3,class:"col-variables"},Tl={class:"variable-tags"},kl={key:0,class:"var-item"},Cl={key:1,class:"var-item"},$l={key:2},wl={key:3},Sl={key:4,class:"col-response"},Il={class:"response-content"},El={key:5,class:"col-parsed"},Rl={key:6,class:"col-post-processed"},Pl={key:7,class:"col-length"},Fl={key:8,class:"col-latency"},xl={key:1,class:"results-table"},Al={key:0,class:"col-status"},Ol={key:1,class:"col-configuration"},Vl={key:2,class:"col-repeat"},Dl={key:3,class:"col-variables"},Nl={key:4,class:"col-response"},Ll={key:5,class:"col-parsed"},Ml={key:6,class:"col-post-processed"},Ul={key:0,class:"post-process-indicator"},jl={key:7,class:"col-length"},Bl={key:8,class:"col-latency"},zl=["onClick"],Wl={key:0,class:"col-status"},Hl={class:"status-cell"},Gl={class:"status-time"},ql={key:1,class:"col-configuration"},Jl={key:2,class:"col-repeat"},Xl={key:3,class:"col-variables"},Kl={class:"variable-tags"},Yl={key:0,class:"var-item"},Ql={key:1,class:"var-item"},Zl={key:2},eu={key:3},tu={key:4,class:"col-response"},su={class:"response-content"},au={key:5,class:"col-parsed"},nu={key:6,class:"col-post-processed"},ru={key:7,class:"col-length"},ou={key:8,class:"col-latency"},iu={key:0},lu=["colspan"],uu={key:0},du={key:1},$t="trial-results-visible-columns",cu=ne({__name:"TrialResultsTableV3",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(i){const e=i,t=q("all"),a=q([]),n=q(""),r=q(["status","configuration","variables","response","parsedResponse","postProcessedResponse","length","latency"]),u=q(null),p=q(!1),c=He(),v=U(()=>c.apiCalls?.value||[]),h=U(()=>e.apiCalls||v.value);re(h,($,E)=>{const G=performance.now();F.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 calls data changed from ${E?.length||0} to ${$.length} calls`),setTimeout(()=>{const O=performance.now();F.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 reactive update completed in ${(O-G).toFixed(1)}ms`)},0)});const g=$=>{if(!n.value)return $;const E=n.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),G=new RegExp(`(${E})`,"gi");return $.replace(G,"<mark>$1</mark>")},b=U(()=>{const $=performance.now();if(!(t.value!=="all"||a.value.length>0||n.value))return performance.now()-$>5&&F.info(`V4_OPTIMIZE: No filtering needed, returning ${h.value.length} calls directly`),h.value;let G=h.value.filter(Y=>{if(t.value!=="all"&&Y.status!==t.value||a.value.length>0&&!a.value.includes(String(Y.configurationIndex)))return!1;if(n.value){const y=n.value.toLowerCase();if(!(Y.prompt?.toLowerCase().includes(y)||Y.result?.content?.toLowerCase().includes(y)||Y.result?.error?.toLowerCase().includes(y)))return!1}return!0});const O=performance.now();return O-$>10&&F.info(`V4_OPTIMIZE: Filtered ${h.value.length} → ${G.length} calls in ${(O-$).toFixed(1)}ms`),G});re(b,($,E)=>{const G=performance.now();F.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls changed from ${E?.length||0} to ${$.length} items`),setTimeout(()=>{const O=performance.now();F.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 filteredCalls render completed in ${(O-G).toFixed(1)}ms`)},0)});const w=U(()=>h.value),T=U(()=>h.value.length),k=U(()=>e.trial.configurations.some($=>$.repeatCount>1)),V=U(()=>60);function H($){}function N($){const E=e.trial.configurations[$];return E?E.modelSnapshot?.displayName||`${E.modelId}`:`Config ${$+1}`}function R($){return $.status==="pending"?"Waiting...":$.status==="running"?"Processing...":$.status==="failed"?$.result?.errorType==="refusal_detected"||$.result?.error==="REFUSED"?$.result?.content||"REFUSED":$.result?.error||"Error occurred":$.result?.content||""}function S($){if(!$.result)return"";if($.result.parsedContent!==void 0){const E=$.result.parsedContent;return E===null?"null":typeof E=="string"?E:typeof E=="number"||typeof E=="boolean"?String(E):JSON.stringify(E)}return""}function j($){if(!$.result||$.result.postParsedContent===void 0)return"";const E=$.result.postParsedContent;return E===null?"null":E==="REFUSED"||$.result.postRefused?"REFUSED":typeof E=="string"?E:typeof E=="number"||typeof E=="boolean"?String(E):JSON.stringify(E)}function f($){const E=$.result?.content||"";if(!E)return"";const G=E.length;return G>1e3?`${(G/1e3).toFixed(1)}k chars`:`${G} chars`}function l($){return $?$<1e3?`${$}ms`:`${($/1e3).toFixed(1)}s`:""}function D($){let E;switch($.status){case"completed":case"failed":E=$.completed;break;case"running":E=$.started;break;case"pending":case"cancelled":E=$.created;break}if(!E)return"";const G=new Date(E),O=G.getHours().toString().padStart(2,"0"),Y=G.getMinutes().toString().padStart(2,"0"),y=G.getSeconds().toString().padStart(2,"0");return`  ${O}:${Y}:${y}`}function I($){return $?$<1e3?"latency-fast":$<5e3?"latency-medium":"latency-slow":""}function o($){return g($)}function A($){u.value=$}return re(r,$=>{localStorage.setItem($t,JSON.stringify($))},{deep:!0}),fe(()=>{const $=performance.now();F.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 MOUNTED with ${h.value.length} calls`);const E=localStorage.getItem($t);if(E)try{r.value=JSON.parse(E)}catch{}ke(()=>{const G=performance.now();F.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 DOM ready in ${(G-$).toFixed(1)}ms`),setTimeout(()=>{const O=performance.now();F.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 virtual scrolling ready in ${(O-$).toFixed(1)}ms`)},100)}),setTimeout(()=>{const G=performance.now();F.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 mount completed in ${(G-$).toFixed(1)}ms`)},0)}),Fe(()=>{F.info(`V4_TRIAL_SWITCH: TrialResultsTableV3 ACTIVATED (cache hit) with ${h.value.length} calls`)}),xe(()=>{F.info("V4_TRIAL_SWITCH: TrialResultsTableV3 DEACTIVATED (cached)")}),be(()=>{F.info("V4_TRIAL_SWITCH: TrialResultsTableV3 UNMOUNTED (evicted)")}),($,E)=>{const G=Ft("dompurify-html");return d(),m("div",el,[C(vo,{"status-filter":t.value,"onUpdate:statusFilter":E[0]||(E[0]=O=>t.value=O),"config-filter":a.value,"onUpdate:configFilter":E[1]||(E[1]=O=>a.value=O),"search-query":n.value,"onUpdate:searchQuery":E[2]||(E[2]=O=>n.value=O),"visible-columns":r.value,"onUpdate:visibleColumns":E[3]||(E[3]=O=>r.value=O),configurations:$.trial.configurations,"api-calls":w.value,"show-repeat-column":k.value,onOpenPostProcessing:E[4]||(E[4]=O=>p.value=!0)},null,8,["status-filter","config-filter","search-query","visible-columns","configurations","api-calls","show-repeat-column"]),s("div",tl,[T.value>100?(d(),K(z(qe),{key:0,class:"results-scroller",items:Array.from(b.value),"item-size":V.value,"key-field":"id",buffer:10,onVisibleRange:H},{before:x(()=>[s("table",sl,[s("thead",null,[s("tr",null,[r.value.includes("status")?(d(),m("th",al,"Status")):P("",!0),r.value.includes("configuration")?(d(),m("th",nl,"Configuration")):P("",!0),r.value.includes("repeat")&&k.value?(d(),m("th",rl,"Repeat")):P("",!0),r.value.includes("variables")?(d(),m("th",ol,"Variables")):P("",!0),r.value.includes("response")?(d(),m("th",il,"Response")):P("",!0),r.value.includes("parsedResponse")?(d(),m("th",ll,"Parsed Response")):P("",!0),r.value.includes("postProcessedResponse")?(d(),m("th",ul,[E[7]||(E[7]=L(" Post-Processed ")),$.trial.postProcessingConfig?.enabled?(d(),m("span",dl,"✨")):P("",!0)])):P("",!0),r.value.includes("length")?(d(),m("th",cl,"Length")):P("",!0),r.value.includes("latency")?(d(),m("th",pl,"Latency")):P("",!0)])])])]),default:x(({item:O})=>[s("table",fl,[s("tbody",null,[s("tr",{class:se(["result-row",`status-${O.status}`]),onClick:Y=>A(O)},[r.value.includes("status")?(d(),m("td",vl,[s("div",gl,[s("span",{class:se(["status-tag",`status-${O.status}`])},_(O.status.toUpperCase()),3),s("span",hl,_(D(O)),1)])])):P("",!0),r.value.includes("configuration")?(d(),m("td",yl,_(N(O.configurationIndex)),1)):P("",!0),r.value.includes("repeat")&&k.value?(d(),m("td",bl," #"+_((O.repeatIndex||0)+1),1)):P("",!0),r.value.includes("variables")?(d(),m("td",_l,[s("div",Tl,[(d(!0),m(ee,null,te(Object.entries(O.variables),([Y,y],B)=>(d(),m(ee,{key:Y},[E[9]||(E[9]=s("span",{class:"var-bullet"},"• ",-1)),Object.keys(O.variables).length<=2?(d(),m("span",kl,_(Y)+": "+_(y),1)):(d(),m("span",Cl,_(y),1)),Object.keys(O.variables).length===2&&B===0?(d(),m("span",$l,E[8]||(E[8]=[s("br",null,null,-1)]))):B<Object.keys(O.variables).length-1?(d(),m("span",wl,_("  "))):P("",!0)],64))),128))])])):P("",!0),r.value.includes("response")?(d(),m("td",Sl,[Se(s("div",Il,null,512),[[G,o(R(O)),"apiResponse"]])])):P("",!0),r.value.includes("parsedResponse")?(d(),m("td",El,_(S(O)),1)):P("",!0),r.value.includes("postProcessedResponse")?(d(),m("td",Rl,_(j(O)),1)):P("",!0),r.value.includes("length")?(d(),m("td",Pl,_(f(O)),1)):P("",!0),r.value.includes("latency")?(d(),m("td",Fl,[s("span",{class:se(I(O.response?.latencyMs))},_(l(O.response?.latencyMs)),3)])):P("",!0)],10,ml)])])]),_:1},8,["items","item-size"])):(d(),m("table",xl,[s("thead",null,[s("tr",null,[r.value.includes("status")?(d(),m("th",Al,"Status")):P("",!0),r.value.includes("configuration")?(d(),m("th",Ol,"Configuration")):P("",!0),r.value.includes("repeat")&&k.value?(d(),m("th",Vl,"Repeat")):P("",!0),r.value.includes("variables")?(d(),m("th",Dl,"Variables")):P("",!0),r.value.includes("response")?(d(),m("th",Nl,"Response")):P("",!0),r.value.includes("parsedResponse")?(d(),m("th",Ll,"Parsed Response")):P("",!0),r.value.includes("postProcessedResponse")?(d(),m("th",Ml,[E[10]||(E[10]=L(" Post-Processed ")),$.trial.postProcessingConfig?.enabled?(d(),m("span",Ul,"✨")):P("",!0)])):P("",!0),r.value.includes("length")?(d(),m("th",jl,"Length")):P("",!0),r.value.includes("latency")?(d(),m("th",Bl,"Latency")):P("",!0)])]),s("tbody",null,[(d(!0),m(ee,null,te(b.value,O=>(d(),m("tr",{key:O.id,class:se(["result-row",`status-${O.status}`]),onClick:Y=>A(O)},[r.value.includes("status")?(d(),m("td",Wl,[s("div",Hl,[s("span",{class:se(["status-tag",`status-${O.status}`])},_(O.status.toUpperCase()),3),s("span",Gl,_(D(O)),1)])])):P("",!0),r.value.includes("configuration")?(d(),m("td",ql,_(N(O.configurationIndex)),1)):P("",!0),r.value.includes("repeat")&&k.value?(d(),m("td",Jl," #"+_((O.repeatIndex||0)+1),1)):P("",!0),r.value.includes("variables")?(d(),m("td",Xl,[s("div",Kl,[(d(!0),m(ee,null,te(O.variables,(Y,y,B)=>(d(),m(ee,{key:y},[E[12]||(E[12]=s("span",{class:"var-bullet"},"• ",-1)),Object.keys(O.variables).length<=2?(d(),m("span",Yl,_(y)+": "+_(Y),1)):(d(),m("span",Ql,_(Y),1)),Object.keys(O.variables).length===2&&B===0?(d(),m("span",Zl,E[11]||(E[11]=[s("br",null,null,-1)]))):B<Object.keys(O.variables).length-1?(d(),m("span",eu,_("  "))):P("",!0)],64))),128))])])):P("",!0),r.value.includes("response")?(d(),m("td",tu,[Se(s("div",su,null,512),[[G,o(R(O)),"apiResponse"]])])):P("",!0),r.value.includes("parsedResponse")?(d(),m("td",au,_(S(O)),1)):P("",!0),r.value.includes("postProcessedResponse")?(d(),m("td",nu,_(j(O)),1)):P("",!0),r.value.includes("length")?(d(),m("td",ru,_(f(O)),1)):P("",!0),r.value.includes("latency")?(d(),m("td",ou,[s("span",{class:se(I(O.response?.latencyMs))},_(l(O.response?.latencyMs)),3)])):P("",!0)],10,zl))),128)),b.value.length===0?(d(),m("tr",iu,[s("td",{colspan:r.value.length,class:"empty-state"},[v.value.length===0?(d(),m("div",uu," No API calls yet. Start the trial to begin execution. ")):(d(),m("div",du," No results match your filters. "))],8,lu)])):P("",!0)])]))]),u.value?(d(),K(es,{key:0,visible:!!u.value,"api-call":u.value,trial:$.trial,"onUpdate:visible":E[5]||(E[5]=O=>u.value=null)},null,8,["visible","api-call","trial"])):P("",!0),p.value?(d(),K(Zi,{key:1,visible:p.value,trial:$.trial,onClose:E[6]||(E[6]=O=>p.value=!1)},null,8,["visible","trial"])):P("",!0)])}}}),pu=ae(cu,[["__scopeId","data-v-a566786b"]]),fu={class:"trial-analysis-view"},mu=ne({__name:"TrialAnalysisView",props:{trial:{},progress:{},isExecuting:{type:Boolean},apiCalls:{},isStreaming:{type:Boolean},isLoading:{type:Boolean}},setup(i){const e=i;return fe(()=>{const t=performance.now();F.info(`V4_TRIAL_SWITCH: TrialAnalysisView MOUNTED for trial ${e.trial.id}`),ke(()=>{const a=performance.now();F.info(`V4_TRIAL_SWITCH: TrialAnalysisView DOM ready in ${(a-t).toFixed(1)}ms`)}),setTimeout(()=>{const a=performance.now();F.info(`V4_TRIAL_SWITCH: TrialAnalysisView mount completed in ${(a-t).toFixed(1)}ms`)},0)}),Fe(()=>{F.info(`V4_TRIAL_SWITCH: TrialAnalysisView ACTIVATED (cache hit) for trial ${e.trial.id}`)}),xe(()=>{F.info(`V4_TRIAL_SWITCH: TrialAnalysisView DEACTIVATED (cached) for trial ${e.trial.id}`)}),be(()=>{F.info(`V4_TRIAL_SWITCH: TrialAnalysisView UNMOUNTED (evicted) for trial ${e.trial.id}`)}),(t,a)=>(d(),m("div",fu,[C(pu,{trial:t.trial,progress:t.progress,"is-executing":t.isExecuting,"api-calls":t.apiCalls,"is-streaming":t.isStreaming,"is-loading":t.isLoading},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])]))}}),vu=ae(mu,[["__scopeId","data-v-602f5d5a"]]);function gu(i,e){const t=new Set,a=new Set,n=new Set;i.forEach(h=>{h.variables&&Object.keys(h.variables).forEach(g=>t.add(g)),h.variableAttributes&&Object.values(h.variableAttributes).forEach(g=>{g&&Object.keys(g).forEach(b=>a.add(b))})});const r=Array.from(t).sort(),u=Array.from(a).sort(),p=Array.from(n).sort(),c=[],v=["success","refused","parsed_response",...c,...p];return{categorical:[...r,...u,"model","status","error_type"],numeric:["response_time","total_tokens","prompt_tokens","completion_tokens",...c].sort(),extracted:v}}function Le(i,e,t){switch(e){case"model":return t&&i.configurationIndex<t.configurations.length&&t.configurations[i.configurationIndex].modelId||"Unknown";case"status":return i.status;case"response_time":return i.response?.latencyMs||0;case"total_tokens":if(i.response?.body?.usage){const a=i.response.body.usage;return a.total_tokens||a.prompt_tokens+a.completion_tokens||0}return 0;case"prompt_tokens":return i.response?.body?.usage?.prompt_tokens||i.response?.body?.usage?.input_tokens||0;case"completion_tokens":return i.response?.body?.usage?.completion_tokens||i.response?.body?.usage?.output_tokens||0;case"error_type":return i.result?.errorType||(i.result?.success===!1?"api_error":"success");case"success":return i.result?.success?1:0;case"refused":return i.result?.refused?1:0;case"parsed_response":if(i.result?.parsedContent!==void 0){const a=i.result.parsedContent;return typeof a=="object"?JSON.stringify(a):a}return null}if(i.variables?.[e]!==void 0)return i.variables[e];if(i.variableAttributes)for(const a of Object.keys(i.variableAttributes)){const n=i.variableAttributes[a];if(n&&n[e]!==void 0)return n[e]}return null}const Ae={count:{label:"Count",calculate:i=>i.length,format:i=>i.toString(),needsNumeric:!1},sum:{label:"Sum",calculate:i=>{const e=i.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0):null},format:i=>i?.toFixed(2)||"-",needsNumeric:!0},mean:{label:"Mean",calculate:i=>{const e=i.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?e.reduce((t,a)=>t+a,0)/e.length:null},format:i=>i?.toFixed(2)||"-",needsNumeric:!0},median:{label:"Median",calculate:i=>{const e=i.map(n=>typeof n=="number"?n:null).filter(n=>n!==null);if(e.length===0)return null;const t=[...e].sort((n,r)=>n-r),a=Math.floor(t.length/2);return t.length%2===0?(t[a-1]+t[a])/2:t[a]},format:i=>i?.toFixed(2)||"-",needsNumeric:!0},mode:{label:"Mode",calculate:i=>{if(i.length===0)return null;const e=new Map;i.forEach(n=>e.set(n,(e.get(n)||0)+1));let t=0,a=null;return e.forEach((n,r)=>{n>t&&(t=n,a=r)}),{value:a,count:t,total:i.length}},format:i=>i?`${i.value} (${i.count}/${i.total})`:"-",needsNumeric:!1},variance:{label:"Variance",calculate:i=>{const e=i.map(n=>typeof n=="number"?n:null).filter(n=>n!==null);if(e.length<=1)return null;const t=e.reduce((n,r)=>n+r,0)/e.length;return e.reduce((n,r)=>n+Math.pow(r-t,2),0)/(e.length-1)},format:i=>i?.toFixed(3)||"-",needsNumeric:!0},std_dev:{label:"Std Dev",calculate:i=>{const e=Ae.variance.calculate(i);return e!==null?Math.sqrt(e):null},format:i=>i?.toFixed(3)||"-",needsNumeric:!0},min:{label:"Min",calculate:i=>{const e=i.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.min(...e):null},format:i=>i?.toFixed(2)||"-",needsNumeric:!0},max:{label:"Max",calculate:i=>{const e=i.map(t=>typeof t=="number"?t:null).filter(t=>t!==null);return e.length>0?Math.max(...e):null},format:i=>i?.toFixed(2)||"-",needsNumeric:!0},success_rate:{label:"Success Rate",calculate:(i,e)=>{const t=e.filter(a=>a.result?.success).length;return e.length>0?t/e.length:0},format:i=>`${Math.round(i*100)}%`,needsNumeric:!1,usesApiCalls:!0},refusal_rate:{label:"Refusal Rate",calculate:(i,e)=>{const t=e.filter(a=>a.result?.refused).length;return e.length>0?t/e.length:0},format:i=>`${Math.round(i*100)}%`,needsNumeric:!1,usesApiCalls:!0},avg_time:{label:"Avg Time (ms)",calculate:(i,e)=>{const t=e.filter(a=>a.response?.latencyMs).map(a=>a.response.latencyMs);return t.length>0?t.reduce((a,n)=>a+n,0)/t.length:null},format:i=>i?`${Math.round(i)}ms`:"-",needsNumeric:!1,usesApiCalls:!0}};function wt(i,e,t){const a=performance.now(),n=new Map,r=new Set,u=new Set,p=new Map,c=(R,S)=>{p.has(S)||p.set(S,new Map);const j=p.get(S);return j.has(R)||j.set(R,Le(R,S,t)),j.get(R)};for(const R of i){const S=String(c(R,e.rowField)||"Unknown"),j=String(c(R,e.columnField)||"Unknown");r.add(S),u.add(j),n.has(S)||n.set(S,new Map);const f=n.get(S);f.has(j)||f.set(j,[]),f.get(j).push(R)}const v=performance.now()-a;v>50&&`${i.length}${v.toFixed(1)}`;const h=R=>R.every(j=>!isNaN(Number(j))&&j.trim()!=="")?R.sort((j,f)=>Number(j)-Number(f)):R.sort(),g=(R,S)=>(t&&(t.type,t.type),h(R)),b=e.rowSort==="original"?g(Array.from(r),e.rowField):h(Array.from(r)),w=e.columnSort==="original"?g(Array.from(u),e.columnField):h(Array.from(u)),T=Ae[e.aggregation];function k(R,S=!1){const j=S?R.map(I=>c(I,e.valueField)):R.map(I=>Le(I,e.valueField,t));if(!T||typeof T.calculate!="function")return F.error("Invalid aggregation function:",e.aggregation,T),{value:null,count:R.length,apiCalls:R,rawValues:j,error:"Invalid aggregation function"};const f={nonNumeric:0,nullUndefined:0};return T.needsNumeric&&(f.nonNumeric=j.filter(I=>typeof I!="number").length),f.nullUndefined=j.filter(I=>I==null).length,{value:T.usesApiCalls?T.calculate(j,R):T.calculate(j),count:R.length,apiCalls:R,rawValues:j,excludedCounts:f}}const V=b.map(R=>{const S=[],j=[];return w.forEach(f=>{const l=n.get(R)?.get(f)||[];S.push(l.length>0?k(l,!0):null),j.push(...l)}),{label:R,cells:S,total:k(j,!0)}}),H=w.map(R=>{const S=[];return b.forEach(j=>{const f=n.get(j)?.get(R)||[];S.push(...f)}),k(S,!0)}),N=performance.now()-a;return N>100&&`${N.toFixed(1)}${i.length}`,{rows:V,columns:w,totals:H,grandTotal:k(i,!0)}}function _e(i,e){return!i||i.value===null?"-":Ae[e].format(i.value)}function hu(i){if(!i||Object.keys(i).length===0)return"";const e=[];return i.temperature!==void 0&&e.push(`T:${i.temperature}`),i.max_tokens!==void 0?e.push(`${i.max_tokens}t`):i.maxTokens!==void 0?e.push(`${i.maxTokens}t`):i.num_predict!==void 0&&e.push(`${i.num_predict}t`),i.top_p!==void 0&&e.push(`p:${i.top_p}`),i.top_k!==void 0&&e.push(`k:${i.top_k}`),e.length>0?`(${e.join(", ")})`:""}function yu(i,e,t,a=q({}),n={}){const{debounceMs:r=100}=n,u=q({rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}}),p=q({categorical:[],numeric:[],extracted:[]}),c=q(!1),v=q(0),h=U(()=>{const T=a.value;return Object.values(T).some(V=>V!=="")?i.value.filter(V=>{if(T.model&&T.model!==""){if(!t.value||V.configurationIndex>=t.value.configurations.length)return!1;const H=t.value.configurations[V.configurationIndex],N=H.modelId||"Unknown",R=hu(H.parameters);if((R?`${N} ${R}`:N)!==T.model)return!1}if(T.status&&T.status!==""&&V.status!==T.status)return!1;for(const[H,N]of Object.entries(T))if(N&&N!==""&&H!=="model"&&H!=="status"&&V.variables?.[H]!==N)return!1;return!0}):i.value}),g=Ke(()=>{if(h.value.length===0){u.value={rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}};return}c.value=!0;const T=performance.now();try{u.value=wt(h.value,e.value,t.value);const k=performance.now()-T;v.value=k,F.debug("Pivot data computed (config change)",{apiCallCount:h.value.length,computeTimeMs:k,rowCount:u.value.rows.length,columnCount:u.value.columns.length})}catch(k){F.error("Error computing pivot data",k)}finally{c.value=!1}},r),b=Ke(()=>{if(h.value.length===0){u.value={rows:[],columns:[],totals:[],grandTotal:{value:0,count:0,apiCalls:[],rawValues:[]}};return}c.value=!0;const T=performance.now();try{u.value=wt(h.value,e.value,t.value);const k=performance.now()-T;v.value=k,F.debug("Pivot data computed (stream update)",{apiCallCount:h.value.length,computeTimeMs:k,rowCount:u.value.rows.length,columnCount:u.value.columns.length})}catch(k){F.error("Error computing pivot data",k)}finally{c.value=!1}},100),w=Ke(()=>{p.value=gu(i.value,t.value)},200);return re([e],()=>{g()},{deep:!0}),re(h,(T,k)=>{const V=typeof window<"u"?window.__trialDataStoreV4?.():null;if(V&&V.activeTab?.value!=="pivot"){`${V.activeTab?.value}`;return}const H=k?.length||0,N=T.length;(H!==N||N>0)&&b()},{immediate:!0}),re([i,t],()=>{`${i.value.length}`,w()},{immediate:!0}),w(),{pivotData:U(()=>u.value),availableFields:U(()=>p.value),isComputing:U(()=>c.value),lastComputeTime:U(()=>v.value),formatCellValue:_e,extractFieldValue:Le,aggregationFunctions:Ae}}const bu={class:"pivot-config-v3"},_u={class:"config-row"},Tu={class:"config-group"},ku=["value","aria-label"],Cu={label:"Categorical"},$u=["value"],wu={class:"config-group sort-group"},Su=["value","aria-label"],Iu={class:"config-group"},Eu=["value","aria-label"],Ru={label:"Categorical"},Pu=["value"],Fu={class:"config-group sort-group"},xu=["value","aria-label"],Au={class:"config-group"},Ou=["value","aria-label"],Vu={label:"Extracted Values"},Du=["value"],Nu={label:"Numeric Fields"},Lu=["value"],Mu={class:"config-group"},Uu=["value","aria-label"],ju=ne({__name:"PivotConfigurationV3",props:{config:{},availableFields:{}},emits:["update-config"],setup(i,{emit:e}){const t=e;function a(r,u){t("update-config",r,u)}function n(r){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[r]||r.replace(/_/g," ").replace(/\b\w/g,p=>p.toUpperCase())}return(r,u)=>(d(),m("div",bu,[s("div",_u,[s("div",Tu,[u[6]||(u[6]=s("label",{for:"pivot-row-field"},"Rows (Group by):",-1)),s("select",{id:"pivot-row-field",value:r.config.rowField,"aria-label":"Group rows by "+n(r.config.rowField),onChange:u[0]||(u[0]=p=>a("rowField",p.target.value))},[s("optgroup",Cu,[(d(!0),m(ee,null,te(r.availableFields.categorical,p=>(d(),m("option",{key:p,value:p},_(n(p)),9,$u))),128))])],40,ku)]),s("div",wu,[u[8]||(u[8]=s("label",{for:"pivot-row-sort"},"Sort Rows:",-1)),s("select",{id:"pivot-row-sort",value:r.config.rowSort||"original","aria-label":"Sort rows by "+(r.config.rowSort||"original")+" order",onChange:u[1]||(u[1]=p=>a("rowSort",p.target.value))},u[7]||(u[7]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,Su)]),s("div",Iu,[u[9]||(u[9]=s("label",{for:"pivot-column-field"},"Columns (Group by):",-1)),s("select",{id:"pivot-column-field",value:r.config.columnField,"aria-label":"Group columns by "+n(r.config.columnField),onChange:u[2]||(u[2]=p=>a("columnField",p.target.value))},[s("optgroup",Ru,[(d(!0),m(ee,null,te(r.availableFields.categorical,p=>(d(),m("option",{key:p,value:p},_(n(p)),9,Pu))),128))])],40,Eu)]),s("div",Fu,[u[11]||(u[11]=s("label",{for:"pivot-column-sort"},"Sort Columns:",-1)),s("select",{id:"pivot-column-sort",value:r.config.columnSort||"original","aria-label":"Sort columns by "+(r.config.columnSort||"original")+" order",onChange:u[3]||(u[3]=p=>a("columnSort",p.target.value))},u[10]||(u[10]=[s("option",{value:"original"},"Original",-1),s("option",{value:"alpha"},"Alphabetical",-1)]),40,xu)]),s("div",Au,[u[12]||(u[12]=s("label",{for:"pivot-value-field"},"Values (Aggregate):",-1)),s("select",{id:"pivot-value-field",value:r.config.valueField,"aria-label":"Aggregate "+r.config.valueField+" values",onChange:u[4]||(u[4]=p=>a("valueField",p.target.value))},[s("optgroup",Vu,[(d(!0),m(ee,null,te(r.availableFields.extracted,p=>(d(),m("option",{key:p,value:p},_(p),9,Du))),128))]),s("optgroup",Nu,[(d(!0),m(ee,null,te(r.availableFields.numeric,p=>(d(),m("option",{key:p,value:p},_(n(p)),9,Lu))),128))])],40,Ou)]),s("div",Mu,[u[14]||(u[14]=s("label",{for:"pivot-aggregation"},"Aggregation:",-1)),s("select",{id:"pivot-aggregation",value:r.config.aggregation,"aria-label":"Aggregation method: "+r.config.aggregation,onChange:u[5]||(u[5]=p=>a("aggregation",p.target.value))},u[13]||(u[13]=[xt('<optgroup label="Statistical" data-v-0d3a0d50><option value="mean" data-v-0d3a0d50>Mean</option><option value="median" data-v-0d3a0d50>Median</option><option value="variance" data-v-0d3a0d50>Variance</option><option value="std_dev" data-v-0d3a0d50>Std Dev</option><option value="min" data-v-0d3a0d50>Min</option><option value="max" data-v-0d3a0d50>Max</option><option value="sum" data-v-0d3a0d50>Sum</option></optgroup><optgroup label="Frequency" data-v-0d3a0d50><option value="count" data-v-0d3a0d50>Count</option><option value="mode" data-v-0d3a0d50>Mode</option></optgroup><optgroup label="Performance" data-v-0d3a0d50><option value="success_rate" data-v-0d3a0d50>Success Rate</option><option value="refusal_rate" data-v-0d3a0d50>Refusal Rate</option><option value="avg_time" data-v-0d3a0d50>Avg Time</option></optgroup>',3)]),40,Uu)])])]))}}),Bu=ae(ju,[["__scopeId","data-v-0d3a0d50"]]),zu={class:"heatmap-controls-v3"},Wu={class:"color-scale-selector"},Hu=["value","aria-label"],Gu={class:"gradient-mode-selector"},qu={class:"gradient-toggle",role:"group","aria-label":"Gradient mode selector"},Ju=["aria-pressed"],Xu=["aria-pressed"],Ku=["aria-pressed"],Yu=["title","aria-label"],Qu=ne({__name:"PivotHeatmapV3",props:{selectedColorScale:{},gradientMode:{},isFullscreen:{type:Boolean}},emits:["update-color-scale","update-gradient-mode","toggle-fullscreen"],setup(i,{emit:e}){const t=e;function a(r){const u=r.target.value;t("update-color-scale",u)}function n(r){t("update-gradient-mode",r)}return(r,u)=>(d(),m("div",zu,[s("div",Wu,[u[5]||(u[5]=s("label",{for:"heatmap-color-scale"},"Color Scale:",-1)),s("select",{id:"heatmap-color-scale",value:r.selectedColorScale,"aria-label":"Color scale: "+r.selectedColorScale,onChange:a},u[4]||(u[4]=[xt('<option value="blue-subtle" data-v-dcb6369b>Blue (Subtle)</option><option value="green-red" data-v-dcb6369b>Green-Red (Success)</option><option value="blue-yellow" data-v-dcb6369b>Blue-Yellow (Performance)</option><option value="purple-orange" data-v-dcb6369b>Purple-Orange (General)</option><option value="viridis" data-v-dcb6369b>Viridis</option><option value="inferno" data-v-dcb6369b>Inferno</option><option value="magma" data-v-dcb6369b>Magma</option><option value="plasma" data-v-dcb6369b>Plasma</option><option value="grayscale" data-v-dcb6369b>Grayscale</option>',9)]),40,Hu)]),s("div",Gu,[u[6]||(u[6]=s("label",null,"Gradient Mode:",-1)),s("div",qu,[s("button",{type:"button",class:se(["toggle-btn",{active:r.gradientMode==="global"}]),"aria-pressed":r.gradientMode==="global",onClick:u[0]||(u[0]=p=>n("global"))}," Global ",10,Ju),s("button",{type:"button",class:se(["toggle-btn",{active:r.gradientMode==="column"}]),"aria-pressed":r.gradientMode==="column",onClick:u[1]||(u[1]=p=>n("column"))}," Per Column ",10,Xu),s("button",{type:"button",class:se(["toggle-btn",{active:r.gradientMode==="row"}]),"aria-pressed":r.gradientMode==="row",onClick:u[2]||(u[2]=p=>n("row"))}," Per Row ",10,Ku)])]),s("button",{type:"button",class:"fullscreen-btn",title:r.isFullscreen?"Exit Fullscreen":"Enter Fullscreen","aria-label":r.isFullscreen?"Exit fullscreen mode":"Enter fullscreen mode",onClick:u[3]||(u[3]=p=>r.$emit("toggle-fullscreen"))},_(r.isFullscreen?"⊟":"⊞"),9,Yu)]))}}),Zu=ae(Qu,[["__scopeId","data-v-dcb6369b"]]),ed={class:"pivot-filters-v3"},td={class:"filters-row"},sd={key:0,class:"filter-group"},ad=["value"],nd=["value"],rd=["for"],od=["id","value","aria-label","onChange"],id={value:""},ld=["value"],ud={key:1,class:"filter-group"},dd=["value"],cd=["value"],pd=ne({__name:"PivotFiltersV3",props:{apiCalls:{},trial:{},activeFilters:{}},emits:["update-filters","clear-filters"],setup(i,{emit:e}){const t=i,a=e,n=q({});let r=0;const u=()=>{if(t.apiCalls.length===0){n.value={};return}const b={};t.apiCalls.forEach(T=>{if(t.trial&&T.configurationIndex<t.trial.configurations.length){const k=t.trial.configurations[T.configurationIndex],V=k.modelId||"Unknown",H=v(k.parameters),N=H?`${V} ${H}`:V;b.model||(b.model=new Set),b.model.add(N)}T.status&&(b.status||(b.status=new Set),b.status.add(T.status)),T.variables&&Object.entries(T.variables).forEach(([k,V])=>{V&&String(V).trim()&&(b[k]||(b[k]=new Set),b[k].add(String(V)))})});const w={};Object.entries(b).forEach(([T,k])=>{w[T]=Array.from(k).sort()}),n.value=w};re(()=>t.apiCalls.length,b=>{(b===0||r===0||b-r>=5)&&(u(),r=b)},{immediate:!0});const p=U(()=>{const{model:b,status:w,...T}=n.value;return T}),c=U(()=>Object.values(t.activeFilters).some(b=>b!==""));function v(b){if(!b||Object.keys(b).length===0)return"";const w=[];return b.temperature!==void 0&&w.push(`T:${b.temperature}`),b.max_tokens!==void 0?w.push(`${b.max_tokens}t`):b.maxTokens!==void 0?w.push(`${b.maxTokens}t`):b.num_predict!==void 0&&w.push(`${b.num_predict}t`),b.top_p!==void 0&&w.push(`p:${b.top_p}`),b.top_k!==void 0&&w.push(`k:${b.top_k}`),w.length>0?`(${w.join(", ")})`:""}function h(b){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",extracted_value:"Extracted Value"}[b]||b.replace(/_/g," ").replace(/\b\w/g,T=>T.toUpperCase())}function g(b,w){const T={...t.activeFilters};w===""?delete T[b]:T[b]=w,a("update-filters",T)}return(b,w)=>(d(),m("div",ed,[s("div",td,[n.value.model&&n.value.model.length>1?(d(),m("div",sd,[w[4]||(w[4]=s("label",{for:"filter-model",class:"filter-label"},"Model:",-1)),s("select",{id:"filter-model",value:b.activeFilters.model||"",class:"filter-select","aria-label":"Filter by model",onChange:w[0]||(w[0]=T=>g("model",T.target.value))},[w[3]||(w[3]=s("option",{value:""},"All Models",-1)),(d(!0),m(ee,null,te(n.value.model,T=>(d(),m("option",{key:T,value:T},_(T),9,nd))),128))],40,ad)])):P("",!0),(d(!0),m(ee,null,te(p.value,(T,k)=>(d(),m("div",{key:k,class:"filter-group"},[s("label",{for:`filter-${k}`,class:"filter-label"},_(h(String(k)))+": ",9,rd),s("select",{id:`filter-${k}`,value:b.activeFilters[k]||"",class:"filter-select","aria-label":`Filter by ${h(String(k))}`,onChange:V=>g(String(k),V.target.value)},[s("option",id,"All "+_(h(String(k))),1),(d(!0),m(ee,null,te(T,V=>(d(),m("option",{key:V,value:V},_(V),9,ld))),128))],40,od)]))),128)),n.value.status&&n.value.status.length>1?(d(),m("div",ud,[w[6]||(w[6]=s("label",{for:"filter-status",class:"filter-label"},"Status:",-1)),s("select",{id:"filter-status",value:b.activeFilters.status||"",class:"filter-select","aria-label":"Filter by status",onChange:w[1]||(w[1]=T=>g("status",T.target.value))},[w[5]||(w[5]=s("option",{value:""},"All Statuses",-1)),(d(!0),m(ee,null,te(n.value.status,T=>(d(),m("option",{key:T,value:T},_(T),9,cd))),128))],40,dd)])):P("",!0),c.value?(d(),m("button",{key:2,type:"button",class:"clear-filters-btn",title:"Clear all filters","aria-label":"Clear all filters",onClick:w[2]||(w[2]=T=>b.$emit("clear-filters"))}," Clear Filters ")):P("",!0)])]))}}),fd=ae(pd,[["__scopeId","data-v-d5848163"]]),md={class:"collapse-icon"},vd={class:"options-content"},gd={class:"controls-row"},hd={key:0,class:"performance-info"},yd={class:"table-view"},bd={key:0,class:"empty-state","data-testid":"empty-data-message"},_d={key:1,class:"error-state","data-testid":"invalid-aggregation-error"},Td={key:2,class:"loading-state","data-testid":"computing-state"},kd={key:3,class:"pivot-table-container"},Cd={class:"pivot-table-grid responsive-table",role:"table"},$d={role:"row"},wd={class:"corner-cell",role:"columnheader"},Sd={key:0,class:"total-header",role:"columnheader"},Id={class:"row-header",role:"rowheader"},Ed=["data-testid","title","aria-label","role","onClick","onKeydown"],Rd={key:0,class:"cell-content"},Pd=["title"],Fd={class:"cell-value"},xd={class:"error-message"},Ad={key:1},Od=ne({__name:"PivotTableV3",props:{apiCalls:{},trial:{default:null},config:{},maxTableRows:{default:1e4},showTotals:{type:Boolean,default:!0},showPerformanceInfo:{type:Boolean,default:!1}},emits:["config-change","cell-click"],setup(i,{emit:e}){const t=i,a=e,n=q(!1),r=q("blue-yellow"),u=q("global"),p=q(!1),c=q({rowField:t.config?.rowField||"",columnField:t.config?.columnField||"",valueField:t.config?.valueField||"",aggregation:t.config?.aggregation||"mean",rowSort:t.config?.rowSort||"original",columnSort:t.config?.columnSort||"original"});re(()=>t.config,y=>{y&&Object.assign(c.value,y)},{deep:!0});const v=q({}),h=He(),g=U(()=>h.apiCalls?h.apiCalls.value||[]:t.apiCalls||[]),b=g,w=U(()=>t.trial),{pivotData:T,availableFields:k,isComputing:V,lastComputeTime:H}=yu(b,c,w,v,{debounceMs:750});re(T,(y,B)=>{const J=performance.now(),X=y?.rows?.length||0,oe=y?.columns?.length||0;F.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData computed: ${X}x${oe} matrix`),setTimeout(()=>{const ce=performance.now();F.info(`V4_TRIAL_SWITCH: PivotTableV3 pivotData render completed in ${(ce-J).toFixed(1)}ms`)},0)}),re(V,y=>{y?F.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING STARTED with ${g.value.length} API calls`):F.info(`V4_TRIAL_SWITCH: PivotTableV3 COMPUTING FINISHED in ${H.value.toFixed(1)}ms`)}),re(g,(y,B)=>{const J=performance.now();F.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls changed from ${B?.length||0} to ${y.length} calls`),setTimeout(()=>{const X=performance.now();F.info(`V4_TRIAL_SWITCH: PivotTableV3 apiCalls prop update completed in ${(X-J).toFixed(1)}ms`)},0)});const N=U(()=>T.value.rows.slice(0,t.maxTableRows)),R=U(()=>Object.values(v.value).some(B=>B!=="")?g.value.filter(B=>{if(v.value.model&&v.value.model!==""){if(!t.trial||B.configurationIndex>=t.trial.configurations.length)return!1;const J=t.trial.configurations[B.configurationIndex],X=J.modelId||"Unknown",oe=l(J.parameters);if((oe?`${X} ${oe}`:X)!==v.value.model)return!1}if(v.value.status&&v.value.status!==""&&B.status!==v.value.status)return!1;for(const[J,X]of Object.entries(v.value))if(X&&X!==""&&J!=="model"&&J!=="status"&&B.variables?.[J]!==X)return!1;return!0}).length:g.value.length),{getCellStyle:S,getSummaryStyle:j,styleKey:f}=ca(T,r,u);function l(y){if(!y||Object.keys(y).length===0)return"";const B=[];return y.temperature!==void 0&&B.push(`T:${y.temperature}`),y.max_tokens!==void 0?B.push(`${y.max_tokens}t`):y.maxTokens!==void 0?B.push(`${y.maxTokens}t`):y.num_predict!==void 0&&B.push(`${y.num_predict}t`),y.top_p!==void 0&&B.push(`p:${y.top_p}`),y.top_k!==void 0&&B.push(`k:${y.top_k}`),B.length>0?`(${B.join(", ")})`:""}function D(y){return{model:"Model",status:"Status",response_time:"Response Time (ms)",total_tokens:"Total Tokens",prompt_tokens:"Prompt Tokens",completion_tokens:"Completion Tokens",error_type:"Error Type",success:"Success",refused:"Refused",parsed_response:"Parsed Response"}[y]||y.replace(/_/g," ").replace(/\b\w/g,J=>J.toUpperCase())}function I(y,B,J){if(!J)return`${y} × ${B}: No data`;const X=_e(J,c.value.aggregation);let oe=`${y} × ${B}: ${X} (${J.count} calls)`;if(J.excludedCounts){const ce=[];J.excludedCounts.nonNumeric>0&&ce.push(`${J.excludedCounts.nonNumeric} non-numeric responses excluded`),J.excludedCounts.nullUndefined>0&&ce.push(`${J.excludedCounts.nullUndefined} null/empty responses`),ce.length>0&&(oe+=` | ${ce.join(", ")}`)}return J.error&&(oe+=` - ERROR: ${J.error}`),oe}function o(y,B,J){if(!J)return`${y} by ${B}: No data`;const X=_e(J,c.value.aggregation);return J.error?`${y} by ${B}: ${X} with data integrity error: ${J.error}`:`${y} by ${B}: ${X} from ${J.count} API calls`}function A(y,B){(y==="rowField"||y==="columnField"||y==="valueField"||y==="aggregation"||y==="rowSort"||y==="columnSort")&&(c.value[y]=B),a("config-change",{...c.value})}function $(y){v.value={...y}}function E(){v.value={}}function G(y,B,J){J&&a("cell-click",{row:y,column:B,cell:J})}function O(){p.value=!p.value}function Y(){n.value=!n.value,n.value?document.body.style.overflow="hidden":document.body.style.overflow=""}return fe(()=>{const y=performance.now();F.info(`V4_TRIAL_SWITCH: PivotTableV3 MOUNTED for trial ${t.trial?.id||"unknown"} with ${g.value.length} calls`),ke(()=>{const B=performance.now();F.info(`V4_TRIAL_SWITCH: PivotTableV3 DOM ready in ${(B-y).toFixed(1)}ms`)}),setTimeout(()=>{const B=performance.now();F.info(`V4_TRIAL_SWITCH: PivotTableV3 mount completed in ${(B-y).toFixed(1)}ms`)},0)}),Fe(()=>{F.info(`V4_TRIAL_SWITCH: PivotTableV3 ACTIVATED (cache hit) for trial ${t.trial?.id||"unknown"} with ${g.value.length} calls`)}),xe(()=>{F.info(`V4_TRIAL_SWITCH: PivotTableV3 DEACTIVATED (cached) for trial ${t.trial?.id||"unknown"}`)}),be(()=>{F.info(`V4_TRIAL_SWITCH: PivotTableV3 UNMOUNTED (evicted) for trial ${t.trial?.id||"unknown"}`),n.value&&(document.body.style.overflow="")}),re([k,g],([y])=>{if(g.value.length>0&&(!c.value.rowField||c.value.rowField==="")&&y.categorical.length>0){if(c.value.rowField=y.categorical.find(B=>B!=="model"&&B!=="status"&&B!=="error_type")||y.categorical[0]||"model",c.value.columnField=c.value.columnField||"model",c.value.valueField=c.value.valueField||"parsed_response",!c.value.aggregation||c.value.aggregation===""){const B=g.value.slice(0,3).map(X=>Le(X,c.value.valueField,t.trial)).filter(X=>X!=null),J=B.length>0&&B.every(X=>typeof X=="number");c.value.aggregation=J?"mean":"mode"}a("config-change",{...c.value})}},{immediate:!0}),(y,B)=>(d(),m("div",{class:se(["pivot-table-v3",{fullscreen:n.value}])},[s("div",{class:se(["pivot-options-container",{collapsed:p.value}])},[s("div",{class:"options-header",onClick:O},[B[3]||(B[3]=s("span",{class:"options-title"},"Pivot Table Options",-1)),s("span",md,_(p.value?"▶":"▼"),1)]),Se(s("div",vd,[Ss([z(k),c.value],()=>(d(),m("div",null,[C(Bu,{config:c.value,"available-fields":z(k),onUpdateConfig:A},null,8,["config","available-fields"])])),B,0),s("div",gd,[g.value.length>0?(d(),K(fd,{key:0,"api-calls":g.value,trial:y.trial,"active-filters":v.value,onUpdateFilters:$,onClearFilters:E},null,8,["api-calls","trial","active-filters"])):P("",!0),C(Zu,{"selected-color-scale":r.value,"gradient-mode":u.value,"is-fullscreen":n.value,onUpdateColorScale:B[1]||(B[1]=J=>r.value=J),onUpdateGradientMode:B[2]||(B[2]=J=>u.value=J),onToggleFullscreen:Y},null,8,["selected-color-scale","gradient-mode","is-fullscreen"])])],512),[[At,!p.value]])],2),y.showPerformanceInfo?(d(),m("div",hd,[s("span",null,"Computing: "+_(z(V)?"Yes":"No"),1),s("span",null,"Last Compute: "+_(z(H).toFixed(1))+"ms",1),s("span",null,"API Calls: "+_(g.value.length),1),s("span",null,"Filtered: "+_(R.value),1)])):P("",!0),s("div",yd,[g.value.length===0?(d(),m("div",bd,B[4]||(B[4]=[s("p",null,"No data available for pivot table analysis.",-1)]))):c.value.aggregation in z(Ae)?z(V)?(d(),m("div",Td,B[6]||(B[6]=[s("p",null,"Computing pivot table...",-1)]))):(d(),m("div",kd,[s("table",Cd,[s("thead",null,[s("tr",$d,[s("th",wd,_(D(c.value.rowField)||"Items")+" / "+_(D(c.value.columnField)||"Aggregated"),1),(d(!0),m(ee,null,te(z(T).columns,J=>(d(),m("th",{key:J,class:"column-header",role:"columnheader"},_(J),1))),128)),c.value.columnField&&y.showTotals?(d(),m("th",Sd," Total ")):P("",!0)])]),s("tbody",null,[(d(!0),m(ee,null,te(N.value,J=>(d(),m("tr",{key:`${J.label}-${z(f)}`,class:"data-row",role:"row"},[s("td",Id,_(J.label),1),(d(!0),m(ee,null,te(J.cells,(X,oe)=>(d(),m("td",{key:`${oe}-${z(f)}`,class:se(["data-cell",{"error-cell":X?.error}]),"data-testid":X?.error?"pivot-cell-error":"pivot-cell",style:ye(z(S)(X,J.label,oe)),title:I(J.label,z(T).columns[oe],X),"aria-label":o(J.label,z(T).columns[oe],X),role:X?.error?"alert":"cell",tabindex:"0",onClick:ce=>G(J.label,z(T).columns[oe],X),onKeydown:[et(ce=>G(J.label,z(T).columns[oe],X),["enter"]),et(Ot(ce=>G(J.label,z(T).columns[oe],X),["prevent"]),["space"])]},[X?.error?(d(),m("div",Rd,[s("span",{class:"error-indicator",title:X.error},"⚠️",8,Pd),s("span",Fd,_(X?z(_e)(X,c.value.aggregation):"-"),1),s("div",xd,_(X.error),1)])):(d(),m("span",Ad,_(X?z(_e)(X,c.value.aggregation):"-"),1))],46,Ed))),128)),c.value.columnField&&y.showTotals?(d(),m("td",{key:0,class:"total-cell",style:ye(z(j)(J.total)),role:"cell"},_(z(_e)(J.total,c.value.aggregation)),5)):P("",!0)]))),128)),c.value.rowField&&y.showTotals?(d(),m("tr",{key:`totals-${z(f)}`,class:"total-row",role:"row"},[B[7]||(B[7]=s("td",{class:"row-header",role:"rowheader"},"Total",-1)),(d(!0),m(ee,null,te(z(T).totals,(J,X)=>(d(),m("td",{key:`total-${X}-${z(f)}`,class:"total-cell",style:ye(z(j)(J)),role:"cell"},_(z(_e)(J,c.value.aggregation)),5))),128)),c.value.columnField?(d(),m("td",{key:0,class:"grand-total-cell",style:ye(z(j)(z(T).grandTotal)),role:"cell"},_(z(_e)(z(T).grandTotal,c.value.aggregation)),5)):P("",!0)])):P("",!0)])])])):(d(),m("div",_d,[s("p",null,"Invalid aggregation function: "+_(c.value.aggregation),1),B[5]||(B[5]=s("p",null,"Please select a valid aggregation method.",-1))]))])],2))}}),Vd=ae(Od,[["__scopeId","data-v-edba4039"]]),Dd={class:"modal-content"},Nd={class:"modal-header"},Ld={class:"modal-title"},Md={class:"summary-row"},Ud={key:0},jd={key:0,class:"filter-row"},Bd=["onUpdate:modelValue","aria-label"],zd={value:""},Wd=["value"],Hd={class:"table-container"},Gd={class:"api-calls-table"},qd=["onClick"],Jd=["title"],Xd=["title"],Kd=ne({__name:"PivotCellDetailV3",props:{visible:{type:Boolean},row:{},column:{},apiCalls:{},trial:{},value:{}},emits:["close"],setup(i){const e=i,t=Is({}),a=q(null),{formatSingleCost:n}=We(),r=U(()=>{const l=new Set;return e.apiCalls.forEach(D=>{D.variables&&Object.keys(D.variables).forEach(I=>l.add(I)),D.attributedVariables&&Object.entries(D.attributedVariables).forEach(([I,o])=>{o&&typeof o=="object"&&Object.keys(o).forEach(A=>{l.add(`${I}.${A}`)})})}),Array.from(l).sort()}),u=U(()=>r.value.map(l=>({title:l,dataIndex:`var_${l}`,key:`var_${l}`,width:150}))),p=[{title:"Status",dataIndex:"status",key:"status",width:100},{title:"Model",dataIndex:"model",key:"model",width:150}],c=[{title:"Response",dataIndex:"response",key:"response",width:300},{title:"Parsed Content",dataIndex:"parsedContent",key:"parsedContent",width:150},{title:"Duration",dataIndex:"duration",key:"duration",width:100},{title:"Cost",dataIndex:"cost",key:"cost",width:100}],v=U(()=>[...p,...u.value,...c]),h=U(()=>`${e.row} × ${e.column} - ${e.apiCalls.length} API Calls`),g=U(()=>e.apiCalls.map(l=>{const D={id:l.id,status:l.status,model:l.modelName||"-",response:l.result?.content||l.result?.error||"-",parsedContent:H(l.result?.parsedContent),duration:l.duration!==void 0?`${l.duration}ms`:"-",cost:l.cost!==void 0?l.cost:"-"};return r.value.forEach(I=>{if(I.includes(".")){const[o,A]=I.split("."),$=l.attributedVariables?.[o]?.[A];D[`var_${I}`]=$!==void 0?String($):"-"}else D[`var_${I}`]=l.variables?.[I]||"-"}),D})),b=U(()=>Object.values(t).some(l=>l!==void 0&&l!=="")),w=U(()=>b.value?g.value.filter(l=>Object.entries(t).every(([D,I])=>I?l[D]===I:!0)):g.value),T=U(()=>{const l=e.apiCalls.filter(D=>D.status==="completed").length;return Math.round(l/e.apiCalls.length*100)}),k=U(()=>{const l=e.apiCalls.filter(D=>D.duration).map(D=>D.duration);return l.length===0?0:Math.round(l.reduce((D,I)=>D+I,0)/l.length)}),V=U(()=>{const l=e.apiCalls.filter(D=>D.cost!==void 0).map(D=>D.cost);if(l.length!==0)return l.reduce((D,I)=>D+I,0)});function H(l){if(l==null)return"-";if(typeof l=="string")return l;if(typeof l=="number"||typeof l=="boolean")return String(l);if(typeof l=="object")try{return JSON.stringify(l,null,2).substring(0,100)}catch{return"[Object]"}return String(l)}function N(l){switch(l){case"completed":return"status-success";case"failed":return"status-error";case"pending":return"status-warning";case"running":return"status-processing";default:return"status-default"}}function R(l,D=200){if(!l)return"";if(l.length<=D)return l;const I=l.slice(0,100),o=l.slice(-100);return`${I} [...TRUNCATED...] ${o}`}function S(l){const D=new Set;return g.value.forEach(I=>{const o=I[l];o&&o!=="-"&&D.add(o)}),Array.from(D).sort()}function j(){Object.keys(t).forEach(l=>{delete t[l]})}function f(l){const D=e.apiCalls.find(I=>I.id===l.id);D&&(a.value=D)}return(l,D)=>(d(),m(ee,null,[s("div",{class:se(["pivot-cell-detail-modal-v3",{visible:l.visible}]),onClick:D[1]||(D[1]=Ot(I=>l.$emit("close"),["self"]))},[s("div",Dd,[s("div",Nd,[s("h3",Ld,_(h.value),1),s("button",{type:"button",class:"close-btn","aria-label":"Close modal",onClick:D[0]||(D[0]=I=>l.$emit("close"))}," × ")]),s("div",Md,[s("span",null,[D[3]||(D[3]=s("b",null,"Total:",-1)),L(" "+_(l.apiCalls.length),1)]),s("span",null,[D[4]||(D[4]=s("b",null,"Success Rate:",-1)),L(" "+_(T.value)+"%",1)]),s("span",null,[D[5]||(D[5]=s("b",null,"Avg Duration:",-1)),L(" "+_(k.value)+"ms",1)]),V.value!==void 0?(d(),m("span",Ud,[D[6]||(D[6]=s("b",null,"Total Cost:",-1)),L(" "+_(z(n)(V.value)),1)])):P("",!0)]),u.value.length>0?(d(),m("div",jd,[(d(!0),m(ee,null,te(u.value,I=>(d(),m("div",{key:I.key,class:"variable-filter"},[Se(s("select",{"onUpdate:modelValue":o=>t[I.key]=o,"aria-label":`Filter ${I.title}`,class:"filter-select"},[s("option",zd,"All "+_(I.title),1),(d(!0),m(ee,null,te(S(I.key),o=>(d(),m("option",{key:o,value:o},_(o),9,Wd))),128))],8,Bd),[[Es,t[I.key]]])]))),128)),b.value?(d(),m("button",{key:0,type:"button",class:"clear-filters-btn",onClick:j}," Clear Filters ")):P("",!0)])):P("",!0),s("div",Hd,[s("table",Gd,[s("thead",null,[s("tr",null,[(d(!0),m(ee,null,te(v.value,I=>(d(),m("th",{key:I.key,class:"table-header",style:ye({width:I.width?`${I.width}px`:"auto"})},_(I.title),5))),128))])]),s("tbody",null,[(d(!0),m(ee,null,te(w.value,I=>(d(),m("tr",{key:I.id,class:"table-row clickable-row",onClick:o=>f(I)},[(d(!0),m(ee,null,te(v.value,o=>(d(),m("td",{key:o.key,class:se(["table-cell",{"status-cell":o.key==="status"}])},[o.key==="status"?(d(),m("span",{key:0,class:se(["status-tag",N(I.status)])},_(I.status),3)):o.key==="response"?(d(),m("span",{key:1,class:"response-cell",title:I.response},_(R(I.response)),9,Jd)):o.key==="cost"?(d(),m(ee,{key:2},[L(_(I.cost==="-"?"-":z(n)(I.cost)),1)],64)):o.key.startsWith("var_")?(d(),m("span",{key:3,class:"variable-cell",title:I[o.key]},_(I[o.key]||"-"),9,Xd)):(d(),m(ee,{key:4},[L(_(I[o.key]||"-"),1)],64))],2))),128))],8,qd))),128))])])])])],2),a.value?(d(),K(es,{key:0,visible:!!a.value,"api-call":a.value,trial:l.trial,"onUpdate:visible":D[2]||(D[2]=I=>a.value=null)},null,8,["visible","api-call","trial"])):P("",!0)],64))}}),Yd=ae(Kd,[["__scopeId","data-v-ddbda380"]]),Qd={class:"trial-tab-content"},Zd={class:"tab-pane-content"},ec={class:"tab-pane-content"},tc={key:0,class:"no-data-message"},sc={class:"tab-pane-content"},St="trial-details-active-tab",ac=ne({__name:"TrialTabContentV3",props:{trial:{},progress:{},isLeader:{type:Boolean},executionState:{}},setup(i){const e=i,t=Vt(),a=Be(),n=He(),r=U(()=>n.apiCalls?.value||[]),u=U(()=>n.isStreaming?.value||!1);re(r,(N,R)=>{const S=performance.now();F.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls changed from ${R?.length||0} to ${N.length} calls`),setTimeout(()=>{const j=performance.now();F.info(`V4_TRIAL_SWITCH: TrialTabContentV3 apiCalls reactive update completed in ${(j-S).toFixed(1)}ms`)},0)});const p=U(()=>!1),v=q((()=>{const N=t.query.tab;return N==="status"?"details":N&&["details","tasks","pivot"].includes(N)?N:"tasks"})()),h=q(!1);re(v,N=>{n.setActiveTab(N)},{immediate:!0});const g=q(!1),b=q({row:"",column:"",apiCalls:[],value:null}),w=U(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial.id),T=U(()=>e.trial.progress.completed>0);function k(){localStorage.setItem(St,v.value);const N={...t.query};N.tab=v.value,t.query.tab!==v.value&&(a.replace({query:N}),`${v.value}`)}function V(){const N=localStorage.getItem(St);N==="status"?v.value="details":N&&["details","tasks","pivot"].includes(N)&&(v.value=N)}function H(N){!N.cell||!N.cell.apiCalls.length||(b.value={row:N.row,column:N.column,apiCalls:N.cell.apiCalls,value:N.cell.value},g.value=!0)}return re(v,()=>{k()}),re(()=>t.query.tab,N=>{if(N&&typeof N=="string"){let R=N==="status"?"details":N;["details","tasks","pivot"].includes(R)&&v.value!==R&&(v.value=R)}}),fe(()=>{const N=performance.now();if(F.info(`V4_TRIAL_SWITCH: TrialTabContentV3 MOUNTED for trial ${e.trial.id}`),!t.query.tab){const R={...t.query};R.tab=v.value,a.replace({query:R}),`${v.value}`}V(),setTimeout(()=>{const R=performance.now();F.info(`V4_TRIAL_SWITCH: TrialTabContentV3 mount completed in ${(R-N).toFixed(1)}ms`)},0)}),Fe(()=>{F.info(`V4_TRIAL_SWITCH: TrialTabContentV3 ACTIVATED (cache hit) for trial ${e.trial.id}`)}),xe(()=>{F.info(`V4_TRIAL_SWITCH: TrialTabContentV3 DEACTIVATED (cached) for trial ${e.trial.id}`)}),be(()=>{F.info(`V4_TRIAL_SWITCH: TrialTabContentV3 UNMOUNTED (evicted) for trial ${e.trial.id}`)}),(N,R)=>{const S=sa,j=ta;return d(),m("div",Qd,[C(j,{activeKey:v.value,"onUpdate:activeKey":R[1]||(R[1]=f=>v.value=f),type:"card",class:"trial-tabs"},{default:x(()=>[C(S,{key:"tasks",tab:"Task View"},{default:x(()=>[s("div",Zd,[(d(),K(tt,null,[C(vu,{trial:N.trial,progress:N.progress,"is-executing":w.value,"api-calls":r.value,"is-streaming":u.value,"is-loading":p.value},null,8,["trial","progress","is-executing","api-calls","is-streaming","is-loading"])],1024))])]),_:1}),C(S,{key:"pivot",tab:"Pivot Table"},{default:x(()=>[s("div",ec,[(d(),K(tt,null,[T.value&&r.value.length>0?(d(),K(Vd,{key:0,"api-calls":r.value,trial:N.trial,"show-performance-info":!1,onCellClick:H},null,8,["api-calls","trial"])):P("",!0)],1024)),T.value&&r.value.length>0?P("",!0):(d(),m("div",tc,R[3]||(R[3]=[s("p",null,"No completed API calls available for pivot analysis.",-1),s("p",null,"Run the trial to see pivot table data.",-1)])))])]),_:1}),C(S,{key:"details",tab:"Details"},{default:x(()=>[s("div",sc,[C(co,{trial:N.trial,"is-collapsed":h.value,onToggleCollapse:R[0]||(R[0]=f=>h.value=!h.value)},null,8,["trial","is-collapsed"])])]),_:1})]),_:1},8,["activeKey"]),g.value?(d(),K(Yd,{key:0,visible:g.value,row:b.value.row,column:b.value.column,"api-calls":b.value.apiCalls,trial:N.trial,value:b.value.value,onClose:R[2]||(R[2]=f=>g.value=!1)},null,8,["visible","row","column","api-calls","trial","value"])):P("",!0)])}}}),nc=ae(ac,[["__scopeId","data-v-743ec3c1"]]);class ie extends Error{constructor(t,a,n){super(a);$e(this,"code");$e(this,"details");this.name="ExportError",this.code=t,this.details=n}}function Me(i){return typeof TextEncoder<"u"?new TextEncoder().encode(i).length:typeof Buffer<"u"?Buffer.byteLength(i,"utf8"):unescape(encodeURIComponent(i)).length}const ue=class ue{async loadTrialForExport(e){try{const t=this.getCachedData(e);if(t)return{ok:!0,value:t};const a=await Ie.trials.get(e);if(!a)return{ok:!1,error:new ie("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})};const n=await Ie.apiCalls.where("trialId").equals(e).toArray(),r={trial:a,apiCalls:n,fieldDefinitions:[],parameterFields:[],totalRecords:n.length};return this.setCachedData(e,r),{ok:!0,value:r}}catch(t){return{ok:!1,error:new ie("GENERATION_FAILED",`Failed to load trial data: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateTrialForExport(e){try{return await Ie.trials.get(e)?await Ie.apiCalls.where("trialId").equals(e).count()===0?{ok:!1,error:new ie("GENERATION_FAILED","Trial has no API calls to export",{trialId:e,apiCallCount:0})}:{ok:!0,value:!0}:{ok:!1,error:new ie("TRIAL_NOT_FOUND",`Trial with ID ${e} not found`,{trialId:e})}}catch(t){return{ok:!1,error:new ie("GENERATION_FAILED",`Failed to validate trial: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async getApiCallCount(e){try{return await Ie.apiCalls.where("trialId").equals(e).count()}catch(t){return F.warn(`Failed to get API call count for trial ${e}:`,t),0}}clearCache(e){ue.cache.delete(e),ue.cacheExpiry.delete(e)}clearAllCache(){ue.cache.clear(),ue.cacheExpiry.clear()}getCachedData(e){const t=ue.cacheExpiry.get(e);return!t||Date.now()>t?(ue.cache.delete(e),ue.cacheExpiry.delete(e),null):ue.cache.get(e)||null}setCachedData(e,t){ue.cache.set(e,t),ue.cacheExpiry.set(e,Date.now()+ue.CACHE_TTL)}};$e(ue,"cache",new Map),$e(ue,"cacheExpiry",new Map),$e(ue,"CACHE_TTL",6e4);let ot=ue;const Ee=new ot;class rc{discoverAllParameters(e){const t=new Map;return e.configurations.forEach((a,n)=>{!a.parameters||typeof a.parameters!="object"||Object.entries(a.parameters).forEach(([r,u])=>{const p=`param_${r}`;t.has(p)||t.set(p,{parameterName:r,fieldId:p,usedByConfigurations:[],dataType:this.inferDataType(u),sampleValues:[]});const c=t.get(p);c.usedByConfigurations.push(n),c.sampleValues.length<3&&!c.sampleValues.includes(u)&&c.sampleValues.push(u)})}),Array.from(t.values()).map(a=>this.createParameterFieldDefinition(a,e)).sort((a,n)=>a.id.localeCompare(n.id))}getParameterUsageStats(e){const t=this.discoverAllParameters(e),a={},n=[],r=[];e.configurations.forEach((p,c)=>{const v=p.provider;a[v]||(a[v]=[]),t.forEach(h=>{h.usedByConfigurations.includes(c)&&(a[v].includes(h.parameterName)||a[v].push(h.parameterName))})});const u=Object.keys(a);return t.forEach(p=>{u.filter(v=>a[v].includes(p.parameterName)).length>1?n.push(p.parameterName):r.push(p.parameterName)}),{totalUniqueParameters:t.length,parametersByProvider:a,sharedParameters:n.sort(),providerSpecificParameters:r.sort()}}validateParameterFields(e,t){const n=this.discoverAllParameters(e).map(c=>c.id),r=t.filter(c=>c.startsWith("param_")),u=[],p=[];return r.forEach(c=>{n.includes(c)?u.push(c):p.push(c)}),{validFields:u,invalidFields:p,availableFields:n}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}createParameterFieldDefinition(e,t){const a=e.usedByConfigurations.map(r=>t.configurations[r]?.provider||"unknown").filter((r,u,p)=>p.indexOf(r)===u).sort(),n=this.generateParameterDescription(e,a);return{id:e.fieldId,name:e.parameterName,description:n,group:"parameters",dataType:e.dataType,isRequired:!1,parameterName:e.parameterName,usedByConfigurations:e.usedByConfigurations}}generateParameterDescription(e,t){const a=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(r=>JSON.stringify(r)).join(", ")})`:"";return`${t.length===1?`Used by ${t[0]}`:`Used by ${t.join(", ")}`}${a}. Empty for configurations that don't use this parameter.`}}const Ue=new rc;class oc{discoverAllVariables(e,t){e.id,t.length;const a=new Map,n=new Map;t.forEach(h=>{h.variables&&typeof h.variables=="object"&&Object.entries(h.variables).forEach(([g,b])=>{const w=`var_${g}`;a.has(w)||a.set(w,{variableName:g,fieldId:w,usedByCallCount:0,dataType:this.inferDataType(b),sampleValues:[]});const T=a.get(w);T.usedByCallCount++,T.sampleValues.length<3&&!T.sampleValues.includes(b)&&T.sampleValues.push(b)}),h.variableAttributes&&typeof h.variableAttributes=="object"&&Object.entries(h.variableAttributes).forEach(([g,b])=>{!b||typeof b!="object"||Object.entries(b).forEach(([w,T])=>{const k=`attr_${g}_${w}`;n.has(k)||n.set(k,{attributeName:w,fieldId:k,usedByCallCount:0,dataType:this.inferDataType(T),sampleValues:[]});const V=n.get(k);V.usedByCallCount++,V.sampleValues.length<3&&!V.sampleValues.includes(T)&&V.sampleValues.push(T)})})});const r=Array.from(a.values()).map(h=>this.createVariableFieldDefinition(h,t.length)),u=Array.from(n.values()).map(h=>this.createAttributeFieldDefinition(h,t.length)),p=[];t.some(h=>h.variableIndices&&Object.keys(h.variableIndices).length>0)&&Array.from(a.values()).forEach(h=>{const g=h.variableName;p.push({id:`source_${g}_list`,name:`${g} Source List`,description:`Name of the list that provided the value for ${g}`,group:"source",dataType:"string",isRequired:!1}),p.push({id:`source_${g}_index`,name:`${g} Source Index`,description:`Position in the list (0-based) for ${g}`,group:"source",dataType:"number",isRequired:!1})});const v=[...r,...u,...p].sort((h,g)=>h.id.localeCompare(g.id));return r.length,u.length,p.length,v.length,r.map(h=>h.id),u.map(h=>h.id),v}getVariableUsageStats(e,t){const a=this.discoverAllVariables(e,t),n={};a.forEach(p=>{const c=p.name,v=this.getVariableInfo(c,t);n[c]=v.usedByCallCount});const r=Object.entries(n).sort(([,p],[,c])=>c-p).map(([p])=>p),u=t.filter(p=>p.variables&&typeof p.variables=="object"&&Object.keys(p.variables).length>0).length;return{totalUniqueVariables:a.length,variableUsageCounts:n,mostCommonVariables:r.slice(0,10),totalCallsWithVariables:u}}validateVariableFields(e,t,a){const r=this.discoverAllVariables(e,t).map(v=>v.id),u=a.filter(v=>v.startsWith("var_")),p=[],c=[];return u.forEach(v=>{r.includes(v)?p.push(v):c.push(v)}),{validFields:p,invalidFields:c,availableFields:r}}inferDataType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":"json"}getVariableInfo(e,t){let a=0;const n=[];return t.forEach(r=>{if(r.variables&&r.variables[e]!==void 0){a++;const u=r.variables[e];n.length<3&&!n.includes(u)&&n.push(u)}}),{attributeName:e,fieldId:`attr_${e}`,usedByCallCount:a,dataType:n.length>0?this.inferDataType(n[0]):"string",sampleValues:n}}createVariableFieldDefinition(e,t){const a=this.generateVariableDescription(e,t);return{id:e.fieldId,name:e.variableName,description:a,group:"content",dataType:e.dataType,isRequired:!1}}createAttributeFieldDefinition(e,t){const a=this.generateAttributeDescription(e,t),n=e.fieldId.replace("attr_","").split("_"),r=n[0],u=n.slice(1).join("_"),p=`${r} attr ${u}`;return{id:e.fieldId,name:p,description:a,group:"content",dataType:e.dataType,isRequired:!1}}generateVariableDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),n=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(r=>JSON.stringify(r)).join(", ")})`:"";return`Template variable used in ${e.usedByCallCount}/${t} calls (${a}%)${n}. Empty for calls that don't use this variable.`}generateAttributeDescription(e,t){const a=Math.round(e.usedByCallCount/t*100),n=e.sampleValues.length>0?` (e.g., ${e.sampleValues.slice(0,2).map(r=>JSON.stringify(r)).join(", ")})`:"";return`Variable attribute used in ${e.usedByCallCount}/${t} calls (${a}%)${n}. Empty for calls that don't use this attribute.`}}const ts=new oc;class ic{isAuthField(e){return e==="request"}sanitizeFieldValue(e,t,a,n){return!t||t.length===0?t:(t.length,this.isAuthField(e),a.id,e==="request"?this.sanitizeRequestField(t,a,n):t)}sanitizeRequestField(e,t,a){try{const n=JSON.parse(e),r=this.getProviderIdForCall(t,a);if(!r)return t.id,this.sanitizeGenericRequest(e);t.id;const u=ys(n,r);return JSON.stringify(u,null,2)}catch(n){return n instanceof Error?n.message:String(n),t.id,"[MALFORMED_REQUEST_JSON_REDACTED_FOR_SAFETY]"}}sanitizeGenericRequest(e){try{const t=JSON.parse(e);if(t.headers){const a={...t.headers},n=["authorization","api-key","x-api-key","bearer","x-auth-token"];for(const[r,u]of Object.entries(a)){const p=r.toLowerCase();n.some(c=>p.includes(c))&&(a[r]=`${String(u).substring(0,8)}...REDACTED`)}t.headers=a}return JSON.stringify(t,null,2)}catch(t){return t instanceof Error?t.message:String(t),"[REQUEST_JSON_PARSE_FAILED_REDACTED]"}}getProviderIdForCall(e,t){try{return t.configurations[e.configurationIndex]?.provider||null}catch(a){return a instanceof Error?a.message:String(a),e.id,null}}getFieldsRequiringSanitization(){return["request"]}createSanitizationSummary(e){const t=e.filter(a=>this.isAuthField(a));return{sanitizationEnabled:t.length>0,sanitizedFields:t}}}const It=new ic;class lc{extractFieldValue(e,t,a){if(t.startsWith("param_"))return this.extractParameterValue(e,t,a);if(t.startsWith("var_"))return e.id,e.variables,this.extractVariableValue(e,t);if(t.startsWith("attr_")){e.id,e.variableAttributes;const r=this.extractAttributeValue(e,t);return e.id,r}if(t.startsWith("source_"))return this.extractSourceValue(e,t,a);const n=this.extractRawFieldValue(e,t,a);return It.isAuthField(t)?(e.id,It.sanitizeFieldValue(t,n,e,a)):n}extractRawFieldValue(e,t,a){switch(t){case"id":return e.id;case"order":return String(e.order);case"status":return e.status;case"created":return e.created.toISOString();case"completed":return e.completed?.toISOString()||"";case"configuration":return this.getConfigurationName(e,a);case"provider":return a.configurations[e.configurationIndex]?.provider||"";case"modelId":return a.configurations[e.configurationIndex]?.modelId||"";case"parameters":return this.getParametersJson(e,a);case"prompt":return e.prompt;case"variables":return JSON.stringify(e.variables||{});case"response":return e.result?.content||"";case"parsedResponse":return JSON.stringify(e.result?.parsedContent||{});case"latency":return String(e.response?.latencyMs||e.result?.latency||"");case"promptTokens":return String(e.result?.usage?.prompt_tokens||"");case"completionTokens":return String(e.result?.usage?.completion_tokens||"");case"totalTokens":return String(e.result?.usage?.total_tokens||"");case"request":return JSON.stringify(e.request||{});case"response_raw":return JSON.stringify(e.response||{});case"error":return e.result?.error||"";case"repeatIndex":return String(e.repeatIndex||"");case"cost":return e.cost!==void 0?String(e.cost):this.calculateCost(e,a);default:return`UNKNOWN_FIELD: ${t}`}}extractMultipleFields(e,t,a){const n={};return t.forEach(r=>{n[r]=this.extractFieldValue(e,r,a)}),n}getFieldDefinitions(e,t){const a=this.getStandardFieldDefinitions(),n=Ue.discoverAllParameters(e),r=t?ts.discoverAllVariables(e,t):[];return[...a,...n,...r]}getStandardFieldDefinitions(){return[{id:"id",name:"Call ID",description:"Unique identifier for the API call",group:"basic",dataType:"string",isRequired:!0},{id:"order",name:"Order",description:"Execution order of the API call within the trial",group:"basic",dataType:"number",isRequired:!0},{id:"status",name:"Status",description:"Current status of the API call (pending, running, completed, failed, cancelled)",group:"basic",dataType:"string",isRequired:!0},{id:"created",name:"Created Time",description:"When the API call was created (ISO timestamp)",group:"basic",dataType:"date",isRequired:!0},{id:"completed",name:"Completed Time",description:"When the API call was completed (ISO timestamp, empty if not completed)",group:"basic",dataType:"date",isRequired:!1},{id:"configuration",name:"Configuration",description:"Configuration name or model ID used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"provider",name:"Provider",description:"LLM provider used (e.g., openai-chat, anthropic, ollama)",group:"configuration",dataType:"string",isRequired:!0},{id:"modelId",name:"Model ID",description:"Specific model identifier used for this call",group:"configuration",dataType:"string",isRequired:!0},{id:"prompt",name:"Prompt",description:"The input prompt sent to the model",group:"content",dataType:"string",isRequired:!0},{id:"response",name:"Response",description:"The text response from the model",group:"content",dataType:"string",isRequired:!1},{id:"parsedResponse",name:"Parsed Response",description:"Structured/parsed response data (JSON)",group:"content",dataType:"json",isRequired:!1},{id:"latency",name:"Latency (ms)",description:"Response time in milliseconds",group:"performance",dataType:"number",isRequired:!1},{id:"promptTokens",name:"Prompt Tokens",description:"Number of tokens in the input prompt",group:"performance",dataType:"number",isRequired:!1},{id:"completionTokens",name:"Completion Tokens",description:"Number of tokens in the model response",group:"performance",dataType:"number",isRequired:!1},{id:"totalTokens",name:"Total Tokens",description:"Total tokens used (prompt + completion)",group:"performance",dataType:"number",isRequired:!1},{id:"request",name:"Full Request",description:"Complete API request sent to the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"response_raw",name:"Raw Response",description:"Full API response from the provider (JSON)",group:"technical",dataType:"json",isRequired:!1},{id:"error",name:"Error Details",description:"Error message if the call failed",group:"technical",dataType:"string",isRequired:!1},{id:"repeatIndex",name:"Repeat Index",description:"Index for repeated calls (empty for single calls)",group:"technical",dataType:"number",isRequired:!1},{id:"cost",name:"Cost (USD)",description:"Calculated cost of the API call based on token usage",group:"performance",dataType:"number",isRequired:!1}]}validateFields(e,t){const n=this.getFieldDefinitions(e).map(p=>p.id),r=[],u=[];return t.forEach(p=>{n.includes(p)?r.push(p):u.push(p)}),{validFields:r,invalidFields:u,availableFields:n}}extractParameterValue(e,t,a){const n=t.replace("param_",""),r=a.configurations[e.configurationIndex];if(!r||!r.parameters)return"";const u=r.parameters[n];return u==null?"":typeof u=="object"?JSON.stringify(u):String(u)}getConfigurationName(e,t){const a=t.configurations[e.configurationIndex];return a?a.modelId||`Config ${e.configurationIndex+1}`:`Config ${e.configurationIndex+1}`}getParametersJson(e,t){const a=t.configurations[e.configurationIndex];return!a||!a.parameters?"{}":JSON.stringify(a.parameters)}extractVariableValue(e,t){const a=t.replace("var_","");if(!e.variables||typeof e.variables!="object")return"";const n=e.variables[a];return n==null?"":typeof n=="object"?JSON.stringify(n):String(n)}extractAttributeValue(e,t){const a=t.replace("attr_","").split("_");if(a.length<2)return"";const n=a[0],r=a.slice(1).join("_");if(!e.variableAttributes||typeof e.variableAttributes!="object")return"";const u=e.variableAttributes[n];if(!u||typeof u!="object")return"";const p=u[r];return p==null?"":typeof p=="object"?JSON.stringify(p):String(p)}extractSourceValue(e,t,a){const n=t.replace("source_","").split("_");if(n.length<2)return"";const r=n[n.length-1],u=n.slice(0,-1).join("_");if(!e.variableIndices||typeof e.variableIndices!="object")return"";const p=e.variableIndices[u];if(p==null)return"";if(r==="index")return String(p);if(r==="list"){if(a.type==="template"&&a.templateConfig?.variables){const c=a.templateConfig.variables[u];if(c&&"snapshot"in c&&c.snapshot?.source?.listName)return c.snapshot.source.listName;if(c?.listId)return c.listId}return""}return""}calculateCost(e,t){if(!e.result?.usage)return"0";const a=t.configurations[e.configurationIndex];if(!a)return"0";const n=a.modelSnapshot;if(!n||!n.capabilities?.inputCostPerToken&&!n.capabilities?.outputCostPerToken)return"0";const r=e.result.usage.prompt_tokens||0,u=e.result.usage.completion_tokens||0,p=r*(n.capabilities.inputCostPerToken||0),c=u*(n.capabilities.outputCostPerToken||0),v=p+c;return v===0?"0":v<1e-4?v.toFixed(8):v<.01?v.toFixed(6):v<1?v.toFixed(4):v.toFixed(2)}}const he=new lc;class uc{getMimeType(e){switch(e){case"csv":return"text/csv";case"excel":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"tsv":return"text/tab-separated-values";case"json":return"application/json";case"jsonl":return"application/x-jsonlines";case"python":return"text/x-python";case"zip":return"application/zip";default:return"application/octet-stream"}}getFileExtension(e){switch(e){case"csv":return"csv";case"excel":return"xlsx";case"tsv":return"tsv";case"json":return"json";case"jsonl":return"jsonl";case"python":return"py";case"zip":return"zip";default:return"bin"}}generateFilename(e,t,a){const n=this.sanitizeFilename(e),u=(a||new Date).toISOString().split("T")[0],p=this.getFileExtension(t);return`${n}_${t}_${u}.${p}`}estimateFileSize(e,t,a,n=50){let r=e*t*n;switch(a){case"json":r*=2.5;break;case"jsonl":r*=2.2;break;case"csv":r*=1.3;break;case"excel":r*=.8;break;case"tsv":r*=1.1;break;case"python":r=Math.max(r*1.5,5e3);break}return Math.round(r)}formatFileSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:`${(e/(1024*1024*1024)).toFixed(1)} GB`}createDownloadBlob(e,t,a=!1){let n=e;return a&&(n="\uFEFF"+n),new Blob([n],{type:t})}createDownloadBlobFromBase64(e,t){const a=atob(e),n=new Uint8Array(a.length);for(let r=0;r<a.length;r++)n[r]=a.charCodeAt(r);return new Blob([n],{type:t})}triggerDownload(e,t){const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>URL.revokeObjectURL(a),100)}downloadFile(e,t,a,n=!1){const r=this.getMimeType(t),u=this.generateFilename(a,t);let p;t==="excel"?p=this.createDownloadBlobFromBase64(e,r):p=this.createDownloadBlob(e,r,n),this.triggerDownload(p,u)}sanitizeFilename(e){return e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").replace(/_+/g,"_").substring(0,50).replace(/^_+|_+$/g,"")||"trial"}}const de=new uc;class dc{validateFormat(e){const t=["csv","tsv","excel","json","jsonl","python"];return t.includes(e)?{isValid:!0,errors:[],warnings:[]}:{isValid:!1,errors:[`Invalid format: ${e}. Supported formats: ${t.join(", ")}`],warnings:[]}}validateFields(e,t,a){if(!t||t.length===0)return{isValid:!1,errors:["No fields selected for export"],warnings:[],unknownFields:[],supportedFields:he.getFieldDefinitions(e,a).map(v=>v.id)};const n=he.validateFields(e,t),r=n.invalidFields.filter(v=>!v.startsWith("var_")&&!v.startsWith("attr_")),u={isValid:r.length===0,errors:[],warnings:[],unknownFields:r,supportedFields:n.availableFields};r.length>0&&u.errors.push(`Unknown fields requested: ${r.join(", ")}`),(t.includes("request")||t.includes("response_raw"))&&u.warnings.push("Technical fields (request, response_raw) contain large JSON objects and may significantly increase file size");const p=t.filter(v=>v.startsWith("param_"));p.length>10&&u.warnings.push(`Large number of parameter fields selected (${p.length}). This may result in a very wide export file with many empty cells.`);const c=t.filter(v=>v.startsWith("var_"));return c.length>10&&u.warnings.push(`Large number of variable fields selected (${c.length}). This may result in a very wide export file with many empty cells.`),u}validateExportSize(e,t,a){const n=de.estimateFileSize(e,t,a),r=n/(1024*1024),u={isValid:!0,errors:[],warnings:[]};return r>500?(u.isValid=!1,u.errors.push(`Export too large: ${de.formatFileSize(n)}. Maximum allowed: 500MB. Consider reducing the number of fields or using filters.`)):r>100&&u.warnings.push(`Large export: ${de.formatFileSize(n)}. This may take several minutes to generate and download.`),e>1e5&&u.warnings.push(`Large number of records: ${e.toLocaleString()}. Export generation may take several minutes.`),t>50&&u.warnings.push(`Large number of fields: ${t}. Resulting file will be very wide and may be difficult to work with in spreadsheet applications.`),u}validateExportOptions(e,t,a){const n=[],r=[],u=this.validateFormat(t.format);if(u.isValid||n.push(...u.errors),t.fields){const p=this.validateFields(e,t.fields,a);p.isValid||n.push(...p.errors),r.push(...p.warnings);const c=this.validateExportSize(e.progress?.total||0,t.fields.length,t.format);c.isValid||n.push(...c.errors),r.push(...c.warnings)}return t.format==="python"&&t.fields&&t.fields.length>0&&r.push("Field selection is ignored for Python exports. Python scripts include all available data."),{isValid:n.length===0,errors:n,warnings:r}}getRecommendedFields(e){const t=["order","status","configuration","prompt","response","latency"],a=he.getFieldDefinitions(e).filter(u=>u.group==="parameters").map(u=>u.id),n=["param_temperature","param_max_tokens","param_top_p"],r=a.filter(u=>n.includes(u));return[...t,...r]}}const Ze=new dc;class Oe{validateOptions(e){const t=[],a=[];e.fields&&e.fields.length===0&&t.push("At least one field must be selected");const n=this.getFormatInfo();return e.includeHeaders&&!n.supportsHeaders&&a.push(`${n.name} format does not support headers - ignoring includeHeaders option`),e.addBOM&&!n.supportsBOM&&a.push(`${n.name} format does not support BOM - ignoring addBOM option`),{isValid:t.length===0,errors:t,warnings:a}}prepareFieldList(e,t){if(t&&t.length>0){const p=t.filter(g=>g.startsWith("var_")),c=t.filter(g=>g.startsWith("attr_")),v=t.filter(g=>!g.startsWith("var_")&&!g.startsWith("attr_")),h=he.validateFields(e,v);return h.invalidFields.length>0&&F.warn("Invalid fields requested:",h.invalidFields),[...h.validFields,...p,...c]}const a=["id","order","status","configuration","provider","modelId","prompt","response","latency"],n=Ue.discoverAllParameters(e),r=["param_temperature","param_max_tokens","param_top_p"],u=n.filter(p=>r.includes(p.id)).map(p=>p.id);return[...a,...u]}prepareDataRows(e,t,a){return e.map(n=>t.map(r=>he.extractFieldValue(n,r,a)))}prepareHeaderRow(e){return e.map(t=>t.startsWith("param_")?`param_${t.replace("param_","")}`:t.replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase()).trim())}hasParameterFields(e){return e.some(t=>t.startsWith("param_"))}escapeFieldValue(e){return e==null?"":String(e)}}class cc extends Oe{async generate(e,t,a){const n=this.prepareFieldList(t,a.fields),r=[];if(a.includeHeaders!==!1){const v=this.prepareHeaderRow(n).map(h=>this.escapeCSVValue(h)).join(",");r.push(v)}this.prepareDataRows(e,n,t).forEach(c=>{const v=c.map(h=>this.escapeCSVValue(h)).join(",");r.push(v)});let p=r.join(`
`);return a.addBOM&&(p="\uFEFF"+p),p}getFormatInfo(){return{name:"CSV",description:"Comma-separated values format, compatible with Excel and other spreadsheet applications",mimeType:"text/csv",extension:"csv",supportsHeaders:!0,supportsBOM:!0}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];if(e.fields&&e.fields.length>30&&a.push("Large number of columns may make the CSV difficult to work with in spreadsheet applications"),e.fields){const n=["variables","parsedResponse","request","response_raw"];e.fields.some(u=>n.includes(u))&&a.push("JSON fields (variables, parsedResponse, request, response_raw) may not display well in spreadsheet applications")}return{...t,warnings:a}}escapeCSVValue(e){if(e==null)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes(`
`)||t.includes("\r")?`"${t.replace(/"/g,'""')}"`:t}}class pc extends Oe{async generate(e,t,a){const n=this.prepareFieldList(t,a.fields),r=[];if(a.includeHeaders!==!1){const c=this.prepareHeaderRow(n).map(v=>this.escapeTSVValue(v)).join("	");r.push(c)}return this.prepareDataRows(e,n,t).forEach(p=>{const c=p.map(v=>this.escapeTSVValue(v)).join("	");r.push(c)}),r.join(`
`)}getFormatInfo(){return{name:"TSV",description:"Tab-separated values format, useful for data analysis tools and database imports",mimeType:"text/tab-separated-values",extension:"tsv",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return a.push("TSV format may not be directly supported by all spreadsheet applications"),{...t,warnings:a}}escapeTSVValue(e){return e==null?"":String(e).replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}}class fc extends Oe{async generate(e,t,a){const n=this.prepareFieldList(t,a.fields),r=Ye.book_new(),u=[];if(a.includeHeaders!==!1){const g=this.prepareHeaderRow(n);u.push(g)}const p=this.prepareDataRows(e,n,t);u.push(...p);const c=Ye.aoa_to_sheet(u),v=this.calculateColumnWidths(u);return c["!cols"]=v,Ye.book_append_sheet(r,c,"Export Data"),pa(r,{type:"base64",bookType:"xlsx",compression:!0})}getFormatInfo(){return{name:"Excel",description:"Microsoft Excel .xlsx format with proper formatting and auto-sized columns",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",extension:"xlsx",supportsHeaders:!0,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.fields&&e.fields.length>16384&&a.push("Excel has a limit of 16,384 columns - some fields may not display correctly"),e.addBOM&&a.push("Excel .xlsx format is binary - ignoring addBOM option"),a.push("Excel format provides native spreadsheet functionality with auto-sized columns"),{...t,warnings:a}}calculateColumnWidths(e){if(e.length===0)return[];const t=Math.max(...e.map(n=>n.length)),a=[];for(let n=0;n<t;n++){let r=10;for(const u of e)if(u[n]!==void 0){const p=String(u[n]).length;r=Math.max(r,Math.min(p*1.2,50))}a.push({wch:r})}return a}}class mc extends Oe{async generate(e,t,a){const n=this.prepareFieldList(t,a.fields),r={metadata:{trialId:t.id,trialName:t.name,trialType:t.type,exportDate:new Date().toISOString(),recordCount:e.length,fieldCount:n.length,hasParameterFields:this.hasParameterFields(n)},trial:{id:t.id,name:t.name,description:t.description,type:t.type,status:t.status,created:t.created.toISOString(),configurations:t.configurations.map((u,p)=>({index:p,provider:u.provider,modelId:u.modelId,parameters:u.parameters||{}}))},fields:n.map(u=>{const p=he.getFieldDefinitions(t).find(c=>c.id===u);return{id:u,name:p?.name||u,description:p?.description||"",group:p?.group||"unknown",dataType:p?.dataType||"string"}}),apiCalls:e.map(u=>{const p={};return n.forEach(c=>{const v=he.extractFieldValue(u,c,t);p[c]=this.parseJSONValue(v,c)}),p})};return JSON.stringify(r,null,2)}getFormatInfo(){return{name:"JSON",description:"JavaScript Object Notation format with complete trial metadata and structured data",mimeType:"application/json",extension:"json",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSON format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSON format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("Large number of fields in JSON format may result in large file sizes and memory usage"),{...t,warnings:a}}parseJSONValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const r=Number(e);return isNaN(r)?null:r}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const r=Number(e);if(!isNaN(r))return r;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return e}}class vc extends Oe{async generate(e,t,a){const n=this.prepareFieldList(t,a.fields),r=[];return e.forEach(u=>{const p={};n.forEach(c=>{const v=he.extractFieldValue(u,c,t);p[c]=this.parseJSONLValue(v,c)}),r.push(JSON.stringify(p))}),r.join(`
`)}getFormatInfo(){return{name:"JSONL",description:"JSON Lines format with one JSON object per line, ideal for streaming and big data processing",mimeType:"application/x-jsonlines",extension:"jsonl",supportsHeaders:!1,supportsBOM:!1}}validateOptions(e){const t=super.validateOptions(e),a=[...t.warnings];return e.includeHeaders!==void 0&&a.push("JSONL format is self-describing - ignoring includeHeaders option"),e.addBOM&&a.push("JSONL format typically does not use BOM - ignoring addBOM option"),e.fields&&e.fields.length>50&&a.push("JSONL format handles large datasets well, but many fields may impact readability"),{...t,warnings:a}}parseJSONLValue(e,t){if(e===""||e===null||e===void 0)return null;if(["variables","parsedResponse","request","response_raw"].includes(t))try{return JSON.parse(e)}catch{return e}if(["order","latency","promptTokens","completionTokens","totalTokens","repeatIndex"].includes(t)){const u=Number(e);return isNaN(u)?null:u}if(e==="true")return!0;if(e==="false")return!1;if(t.startsWith("param_")){const u=Number(e);if(!isNaN(u))return u;if(e==="true")return!0;if(e==="false")return!1;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch{}}return["created","completed"].includes(t),e}}function gc(i){switch(i){case"csv":return new cc;case"tsv":return new pc;case"excel":return new fc;case"json":return new mc;case"jsonl":return new vc;default:throw new Error(`Unsupported format: ${i}`)}}class hc{async exportTrialData(e,t){const a=Date.now();t.format;try{const n=await Ee.loadTrialForExport(e);if(!n.ok){const T=n.error;return{ok:!1,error:new ie("GENERATION_FAILED",`Failed to load trial data: ${T.message}`,{trialId:e,originalError:T})}}const{trial:r,apiCalls:u}=n.value;t.format;const p=await this.validateExportOptions(e,t,u);if(!p.ok){const T=p.error;return{ok:!1,error:new ie("GENERATION_FAILED",`Validation failed: ${T.message}`,{trialId:e,options:t,originalError:T})}}if(!p.value.isValid)return{ok:!1,error:new ie("INVALID_FIELDS",`Export validation failed: ${p.value.errors.join(", ")}`,{errors:p.value.errors})};t.format;const c=gc(t.format);t.format,u.length,t.fields?.length,t.fields,t.fields?.filter(T=>T.startsWith("param_")),t.fields?.filter(T=>T.startsWith("var_")),t.fields?.filter(T=>T.startsWith("attr_"));const v=Date.now(),h=await c.generate(u,r,t);Date.now()-v,h.length,Me(h);const g=t.fields||[],b=Date.now()-a,w={filename:de.generateFilename(r.name,t.format),mimeType:c.getFormatInfo().mimeType,data:h,metadata:{trialName:r.name,trialId:r.id,exportDate:new Date,callCount:u.length,fieldCount:g.length,format:t.format,estimatedSizeBytes:Me(h)},format:t.format,recordCount:u.length,fieldCount:g.length,hasParameterFields:g.some(T=>T.startsWith("param_")),generationTimeMs:b};return t.format,w.filename,w.metadata.estimatedSizeBytes,w.generationTimeMs,{ok:!0,value:w}}catch(n){const r=n instanceof Error?n:new Error(String(n));return r.message,r.stack,r.name,r.constructor.name,t.format,Date.now()-a,{ok:!1,error:new ie("GENERATION_FAILED",`Export generation failed: ${r.message}`,{trialId:e,options:t,originalError:n,generationTimeMs:Date.now()-a})}}}async previewExport(e,t){try{const a=await Ee.loadTrialForExport(e);if(!a.ok){const b=a.error;return{ok:!1,error:new ie("GENERATION_FAILED",`Failed to load trial data: ${b.message}`,{trialId:e,originalError:b})}}const{trial:n,apiCalls:r}=a.value,u=he.getFieldDefinitions(n),p=Ue.discoverAllParameters(n),c=t.fields||this.getDefaultFields(n),v=t.format||"csv",h=de.estimateFileSize(r.length,c.length,v);return{ok:!0,value:{fieldCount:c.length,recordCount:r.length,estimatedSizeBytes:h,availableFields:u,parameterFields:p}}}catch(a){return{ok:!1,error:new ie("GENERATION_FAILED",`Preview generation failed: ${a instanceof Error?a.message:"Unknown error"}`,{trialId:e,options:t,originalError:a})}}}async getAvailableFields(e){try{const t=await Ee.loadTrialForExport(e);if(!t.ok){const v=t.error;return{ok:!1,error:new ie("GENERATION_FAILED",`Failed to load trial data: ${v.message}`,{trialId:e,originalError:v})}}const{trial:a,apiCalls:n}=t.value,r=he.getStandardFieldDefinitions(),u=Ue.discoverAllParameters(a),p=ts.discoverAllVariables(a,n),c=Ze.getRecommendedFields(a);return{ok:!0,value:{standardFields:r,parameterFields:u,variableFields:p,recommendedFields:c}}}catch(t){return{ok:!1,error:new ie("GENERATION_FAILED",`Field discovery failed: ${t instanceof Error?t.message:"Unknown error"}`,{trialId:e,originalError:t})}}}async validateExportOptions(e,t,a){try{const n=await Ee.loadTrialForExport(e);if(!n.ok){const p=n.error;return{ok:!1,error:new ie("GENERATION_FAILED",`Failed to load trial data: ${p.message}`,{trialId:e,originalError:p})}}const{trial:r}=n.value;return{ok:!0,value:Ze.validateExportOptions(r,t,a)}}catch(n){return{ok:!1,error:new ie("GENERATION_FAILED",`Validation failed: ${n instanceof Error?n.message:"Unknown error"}`,{trialId:e,options:t,originalError:n})}}}getDefaultFields(e){return Ze.getRecommendedFields(e)}}const it=new hc;let lt=null,ut=null,je=!1;try{typeof window<"u"&&("__TAURI__"in window||"__TAURI_INTERNALS__"in window)&&(je=!0)}catch{}async function yc(){if(!je)return!1;try{return lt||(lt=await Re(()=>import("./tauri-vendor-DvKxkFnM.js").then(i=>i.b),[])),ut||(ut=await Re(()=>import("./tauri-vendor-DvKxkFnM.js").then(i=>i.c),[])),!0}catch(i){return F.warn("Failed to load Tauri modules:",i),je=!1,!1}}class bc{async downloadFile(e,t,a,n=!1){await this.useTauriSaveDialog(e,t,a,n)||this.useBrowserDownload(e,t,a,n)}async useTauriSaveDialog(e,t,a,n){if(!await yc())return!1;try{const r=de.generateFilename(a,t),u=de.getFileExtension(t),p=await lt.save({defaultPath:r,filters:[{name:this.getFilterName(t),extensions:[u]}],title:`Save ${this.getFilterName(t)} File`});if(!p)return!0;let c;if(typeof e=="string"){const v=n?"\uFEFF"+e:e;c=new TextEncoder().encode(v)}else c=e;return await ut.writeFile(p,c),`${p}`,!0}catch(r){return F.error("Tauri save dialog error:",r),!1}}useBrowserDownload(e,t,a,n){if(e instanceof Uint8Array&&(t==="zip"||t==="excel")){const g=de.getMimeType(t),b=de.generateFilename(a,t),w=new Blob([e],{type:g}),T=window.URL.createObjectURL(w),k=document.createElement("a");k.href=T,k.download=b,document.body.appendChild(k),k.click(),document.body.removeChild(k),window.URL.revokeObjectURL(T);return}e instanceof Uint8Array&&(e=new TextDecoder().decode(e));const r=de.getMimeType(t),u=de.generateFilename(a,t),p=n?"\uFEFF"+e:e,c=new Blob([p],{type:r}),v=window.URL.createObjectURL(c),h=document.createElement("a");h.href=v,h.download=u,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(v)}async downloadExcelFile(e,t){const a=atob(e),n=new Uint8Array(a.length);for(let r=0;r<a.length;r++)n[r]=a.charCodeAt(r);await this.downloadFile(n,"excel",t,!1)}getFilterName(e){switch(e){case"csv":return"CSV";case"excel":return"Excel";case"tsv":return"TSV";case"json":return"JSON";case"jsonl":return"JSON Lines";case"python":return"Python Script";case"zip":return"ZIP Archive";default:return"Binary"}}isInTauri(){return je}generateFilename(e,t,a){return de.generateFilename(e,t,a)}getMimeType(e){return de.getMimeType(e)}getFileExtension(e){return de.getFileExtension(e)}estimateFileSize(e,t,a,n=50){return de.estimateFileSize(e,t,a,n)}formatFileSize(e){return de.formatFileSize(e)}}const Ne=new bc,_c={class:"export-content"},Tc={class:"section"},kc={key:0,class:"section"},Cc={class:"bundle-info"},$c={key:0},wc={key:1,class:"section"},Sc={class:"field-actions"},Ic={class:"field-groups"},Ec={class:"field-group"},Rc={class:"field-list"},Pc={class:"field-group"},Fc={class:"field-list"},xc={class:"field-group"},Ac={class:"field-list"},Oc={class:"field-group"},Vc={class:"field-list"},Dc={class:"field-group"},Nc={class:"field-list"},Lc={key:0,class:"field-group"},Mc={class:"field-list"},Uc={key:1,class:"field-group"},jc={class:"field-list"},Bc={class:"section"},zc={class:"preview-info"},Wc={class:"info-item"},Hc={class:"value"},Gc={class:"info-item"},qc={class:"value"},Jc={class:"info-item"},Xc={class:"value"},Kc={class:"export-actions"},Yc=ne({__name:"ExportDataModalV3",props:{visible:{type:Boolean},trial:{}},emits:["update:visible"],setup(i,{emit:e}){const t=i,a=e,n=q("csv"),r=q(["order","status","configuration","prompt","response","latency"]),u=q(!1),p=q("draft"),c=q({}),v=q([]),h=q([]),g=q([]),b=["order","status","configuration","prompt","response","latency"],w=q([]),T=["id","order","status","created","completed","configuration","provider","modelId","parameters","prompt","variables","response","parsedResponse","latency","promptTokens","completionTokens","totalTokens","cost","request","response_raw","error","repeatIndex"],k=U(()=>{const I=t.trial.progress?.completed||0,o=t.trial.progress?.failed||0;return I+o}),V=U(()=>{const o=r.value.length*50*k.value;return o<1024?`${o} B`:o<1024*1024?`${(o/1024).toFixed(1)} KB`:`${(o/(1024*1024)).toFixed(1)} MB`});function H(){w.value.length,w.value.forEach(A=>{c.value[A]=!1}),b.forEach(A=>{c.value[A]=!0});const I=h.value.map(A=>A.id),o=g.value.map(A=>A.id);I.forEach(A=>{c.value[A]=!0}),o.forEach(A=>{c.value[A]=!0}),b.length,I.length,o.length,b.length+I.length+o.length,N()}function N(){r.value=w.value.filter(I=>c.value[I])}function R(I,o){c.value[I]=o,N()}function S(){w.value.forEach(I=>{c.value[I]=!0}),N()}function j(){w.value.forEach(A=>{c.value[A]=!1}),b.forEach(A=>{c.value[A]=!0});const I=h.value.map(A=>A.id),o=g.value.map(A=>A.id);I.forEach(A=>{c.value[A]=!0}),o.forEach(A=>{c.value[A]=!0}),N()}function f(){w.value.forEach(I=>{c.value[I]=!1}),N()}function l(){a("update:visible",!1)}async function D(){if(n.value==="bundle"){u.value=!0;try{const{trialBundleExportService:I}=await Re(async()=>{const{trialBundleExportService:$}=await import("./trial-bundle.service-CFPPZYp4.js");return{trialBundleExportService:$}},__vite__mapDeps([0,1,2,3,4,5,6])),o=p.value==="completed",A=await I.exportTrialBundle(t.trial.id,{includeResults:o,includeApiCalls:o,format:"json"});A.ok?(Z.success(`Trial bundle exported: ${A.value.filename}`),a("update:visible",!1)):Z.error(`Bundle export failed: ${A.error.message}`)}catch(I){Z.error(`Bundle export failed: ${I instanceof Error?I.message:"Unknown error"}`)}finally{u.value=!1}return}if(r.value.length===0){Z.warning("Please select at least one field to export");return}u.value=!0;try{const I={format:n.value,fields:r.value,includeHeaders:!0,addBOM:n.value==="excel"||n.value==="csv"},o=await it.exportTrialData(t.trial.id,I);o.ok?(await Ne.downloadFile(o.value.data,I.format,o.value.metadata.trialName,I.addBOM),Z.success("Export completed successfully"),a("update:visible",!1)):Z.error(`Export failed: ${o.error.message}`)}catch(I){Z.error("Export failed: "+I.message)}finally{u.value=!1}}return fe(async()=>{t.trial.id;const I=await it.getAvailableFields(t.trial.id);if(I.ok){v.value=I.value.standardFields,h.value=I.value.parameterFields,g.value=(I.value.variableFields||[]).filter(E=>!E.id.startsWith("source_"));const o=I.value.standardFields.map(E=>E.id).filter(E=>E!=="parameters"&&E!=="variables"),A=I.value.parameterFields.map(E=>E.id),$=g.value.map(E=>E.id);w.value=[...o,...A,...$],I.value.standardFields.length,I.value.parameterFields.length,(I.value.variableFields||[]).length,w.value.length,I.value.parameterFields.map(E=>E.id),(I.value.variableFields||[]).map(E=>E.id),w.value}else I.error,w.value=[...T];H()}),(I,o)=>{const A=aa,$=Gt,E=qt,G=me,O=Wt,Y=Ce;return d(),K(Y,{visible:I.visible,"onUpdate:visible":o[46]||(o[46]=y=>I.$emit("update:visible",y)),title:"Export Trial Data",width:800,footer:null,"destroy-on-close":!0,class:"export-data-modal"},{default:x(()=>[s("div",_c,[s("div",Tc,[o[53]||(o[53]=s("h4",null,"Export Format",-1)),C($,{value:n.value,"onUpdate:value":o[0]||(o[0]=y=>n.value=y),class:"format-options"},{default:x(()=>[C(A,{value:"csv"},{default:x(()=>o[47]||(o[47]=[L("CSV")])),_:1,__:[47]}),C(A,{value:"tsv"},{default:x(()=>o[48]||(o[48]=[L("TSV")])),_:1,__:[48]}),C(A,{value:"excel"},{default:x(()=>o[49]||(o[49]=[L("Excel")])),_:1,__:[49]}),C(A,{value:"json"},{default:x(()=>o[50]||(o[50]=[L("JSON")])),_:1,__:[50]}),C(A,{value:"jsonl"},{default:x(()=>o[51]||(o[51]=[L("JSONL")])),_:1,__:[51]}),C(A,{value:"bundle"},{default:x(()=>o[52]||(o[52]=[L("Bundle 📦")])),_:1,__:[52]})]),_:1},8,["value"])]),n.value==="bundle"?(d(),m("div",kc,[o[62]||(o[62]=s("h4",null,"Bundle Export Options",-1)),s("div",Cc,[C($,{value:p.value,"onUpdate:value":o[1]||(o[1]=y=>p.value=y),style:{"margin-bottom":"16px"}},{default:x(()=>[C(E,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:x(()=>o[54]||(o[54]=[s("strong",null,"Export as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Configuration only - recipient can run fresh experiment ",-1)])),_:1,__:[54]}),C(E,{value:"completed",style:{display:"block"}},{default:x(()=>o[55]||(o[55]=[s("strong",null,"Export with Results",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Include all execution results for review/analysis ",-1)])),_:1,__:[55]})]),_:1},8,["value"]),o[61]||(o[61]=s("p",null,"The bundle will include:",-1)),s("ul",null,[o[56]||(o[56]=s("li",null,"✅ Complete trial configuration",-1)),o[57]||(o[57]=s("li",null,"✅ Template with metadata",-1)),o[58]||(o[58]=s("li",null,"✅ All variable lists",-1)),o[59]||(o[59]=s("li",null,"✅ Model configurations",-1)),p.value==="completed"?(d(),m("li",$c,"✅ Execution results and API calls")):P("",!0),o[60]||(o[60]=s("li",null,"✅ Variable index tracking for lineage",-1))]),s("p",null,[s("strong",null,_(p.value==="draft"?"Ready to run fresh experiment":"Complete historical record"),1)])])])):(d(),m("div",wc,[o[95]||(o[95]=s("h4",null,"Fields to Export",-1)),s("div",Sc,[C(G,{size:"small",onClick:S},{default:x(()=>o[63]||(o[63]=[L("Select All")])),_:1,__:[63]}),C(G,{size:"small",onClick:j},{default:x(()=>o[64]||(o[64]=[L("Select Defaults")])),_:1,__:[64]}),C(G,{size:"small",onClick:f},{default:x(()=>o[65]||(o[65]=[L("Clear All")])),_:1,__:[65]})]),s("div",Ic,[s("div",Ec,[o[71]||(o[71]=s("h5",null,"Basic Information",-1)),s("div",Rc,[C(O,{checked:c.value.id,"onUpdate:checked":o[2]||(o[2]=y=>c.value.id=y),onChange:o[3]||(o[3]=y=>R("id",y.target.checked))},{default:x(()=>o[66]||(o[66]=[L("Call ID")])),_:1,__:[66]},8,["checked"]),C(O,{checked:c.value.order,"onUpdate:checked":o[4]||(o[4]=y=>c.value.order=y),onChange:o[5]||(o[5]=y=>R("order",y.target.checked))},{default:x(()=>o[67]||(o[67]=[L("Order")])),_:1,__:[67]},8,["checked"]),C(O,{checked:c.value.status,"onUpdate:checked":o[6]||(o[6]=y=>c.value.status=y),onChange:o[7]||(o[7]=y=>R("status",y.target.checked))},{default:x(()=>o[68]||(o[68]=[L("Status")])),_:1,__:[68]},8,["checked"]),C(O,{checked:c.value.created,"onUpdate:checked":o[8]||(o[8]=y=>c.value.created=y),onChange:o[9]||(o[9]=y=>R("created",y.target.checked))},{default:x(()=>o[69]||(o[69]=[L("Created Time")])),_:1,__:[69]},8,["checked"]),C(O,{checked:c.value.completed,"onUpdate:checked":o[10]||(o[10]=y=>c.value.completed=y),onChange:o[11]||(o[11]=y=>R("completed",y.target.checked))},{default:x(()=>o[70]||(o[70]=[L("Completed Time")])),_:1,__:[70]},8,["checked"])])]),s("div",Pc,[o[76]||(o[76]=s("h5",null,"Configuration",-1)),s("div",Fc,[C(O,{checked:c.value.configuration,"onUpdate:checked":o[12]||(o[12]=y=>c.value.configuration=y),onChange:o[13]||(o[13]=y=>R("configuration",y.target.checked))},{default:x(()=>o[72]||(o[72]=[L("Configuration Name")])),_:1,__:[72]},8,["checked"]),C(O,{checked:c.value.provider,"onUpdate:checked":o[14]||(o[14]=y=>c.value.provider=y),onChange:o[15]||(o[15]=y=>R("provider",y.target.checked))},{default:x(()=>o[73]||(o[73]=[L("Provider")])),_:1,__:[73]},8,["checked"]),C(O,{checked:c.value.modelId,"onUpdate:checked":o[16]||(o[16]=y=>c.value.modelId=y),onChange:o[17]||(o[17]=y=>R("modelId",y.target.checked))},{default:x(()=>o[74]||(o[74]=[L("Model ID")])),_:1,__:[74]},8,["checked"]),C(O,{checked:c.value.parameters,"onUpdate:checked":o[18]||(o[18]=y=>c.value.parameters=y),onChange:o[19]||(o[19]=y=>R("parameters",y.target.checked))},{default:x(()=>o[75]||(o[75]=[L("Parameters")])),_:1,__:[75]},8,["checked"])])]),s("div",xc,[o[81]||(o[81]=s("h5",null,"Content",-1)),s("div",Ac,[C(O,{checked:c.value.prompt,"onUpdate:checked":o[20]||(o[20]=y=>c.value.prompt=y),onChange:o[21]||(o[21]=y=>R("prompt",y.target.checked))},{default:x(()=>o[77]||(o[77]=[L("Prompt")])),_:1,__:[77]},8,["checked"]),C(O,{checked:c.value.variables,"onUpdate:checked":o[22]||(o[22]=y=>c.value.variables=y),onChange:o[23]||(o[23]=y=>R("variables",y.target.checked))},{default:x(()=>o[78]||(o[78]=[L("Variables")])),_:1,__:[78]},8,["checked"]),C(O,{checked:c.value.response,"onUpdate:checked":o[24]||(o[24]=y=>c.value.response=y),onChange:o[25]||(o[25]=y=>R("response",y.target.checked))},{default:x(()=>o[79]||(o[79]=[L("Response")])),_:1,__:[79]},8,["checked"]),C(O,{checked:c.value.parsedResponse,"onUpdate:checked":o[26]||(o[26]=y=>c.value.parsedResponse=y),onChange:o[27]||(o[27]=y=>R("parsedResponse",y.target.checked))},{default:x(()=>o[80]||(o[80]=[L("Parsed Response")])),_:1,__:[80]},8,["checked"])])]),s("div",Oc,[o[87]||(o[87]=s("h5",null,"Performance",-1)),s("div",Vc,[C(O,{checked:c.value.latency,"onUpdate:checked":o[28]||(o[28]=y=>c.value.latency=y),onChange:o[29]||(o[29]=y=>R("latency",y.target.checked))},{default:x(()=>o[82]||(o[82]=[L("Latency (ms)")])),_:1,__:[82]},8,["checked"]),C(O,{checked:c.value.promptTokens,"onUpdate:checked":o[30]||(o[30]=y=>c.value.promptTokens=y),onChange:o[31]||(o[31]=y=>R("promptTokens",y.target.checked))},{default:x(()=>o[83]||(o[83]=[L("Prompt Tokens")])),_:1,__:[83]},8,["checked"]),C(O,{checked:c.value.completionTokens,"onUpdate:checked":o[32]||(o[32]=y=>c.value.completionTokens=y),onChange:o[33]||(o[33]=y=>R("completionTokens",y.target.checked))},{default:x(()=>o[84]||(o[84]=[L("Completion Tokens")])),_:1,__:[84]},8,["checked"]),C(O,{checked:c.value.totalTokens,"onUpdate:checked":o[34]||(o[34]=y=>c.value.totalTokens=y),onChange:o[35]||(o[35]=y=>R("totalTokens",y.target.checked))},{default:x(()=>o[85]||(o[85]=[L("Total Tokens")])),_:1,__:[85]},8,["checked"]),C(O,{checked:c.value.cost,"onUpdate:checked":o[36]||(o[36]=y=>c.value.cost=y),onChange:o[37]||(o[37]=y=>R("cost",y.target.checked))},{default:x(()=>o[86]||(o[86]=[L("Cost (USD)")])),_:1,__:[86]},8,["checked"])])]),s("div",Dc,[o[92]||(o[92]=s("h5",null,"Technical Details",-1)),s("div",Nc,[C(O,{checked:c.value.request,"onUpdate:checked":o[38]||(o[38]=y=>c.value.request=y),onChange:o[39]||(o[39]=y=>R("request",y.target.checked))},{default:x(()=>o[88]||(o[88]=[L("Full Request")])),_:1,__:[88]},8,["checked"]),C(O,{checked:c.value.response_raw,"onUpdate:checked":o[40]||(o[40]=y=>c.value.response_raw=y),onChange:o[41]||(o[41]=y=>R("response_raw",y.target.checked))},{default:x(()=>o[89]||(o[89]=[L("Raw Response")])),_:1,__:[89]},8,["checked"]),C(O,{checked:c.value.error,"onUpdate:checked":o[42]||(o[42]=y=>c.value.error=y),onChange:o[43]||(o[43]=y=>R("error",y.target.checked))},{default:x(()=>o[90]||(o[90]=[L("Error Details")])),_:1,__:[90]},8,["checked"]),C(O,{checked:c.value.repeatIndex,"onUpdate:checked":o[44]||(o[44]=y=>c.value.repeatIndex=y),onChange:o[45]||(o[45]=y=>R("repeatIndex",y.target.checked))},{default:x(()=>o[91]||(o[91]=[L("Repeat Index")])),_:1,__:[91]},8,["checked"])])]),h.value.length>0?(d(),m("div",Lc,[o[93]||(o[93]=s("h5",null,"Parameters (Individual Columns)",-1)),s("div",Mc,[(d(!0),m(ee,null,te(h.value,y=>(d(),K(O,{key:y.id,checked:c.value[y.id],"onUpdate:checked":B=>c.value[y.id]=B,onChange:B=>R(y.id,B.target.checked)},{default:x(()=>[L(_(y.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):P("",!0),g.value.length>0?(d(),m("div",Uc,[o[94]||(o[94]=s("h5",null,"Attributes (Individual Columns)",-1)),s("div",jc,[(d(!0),m(ee,null,te(g.value,y=>(d(),K(O,{key:y.id,checked:c.value[y.id],"onUpdate:checked":B=>c.value[y.id]=B,onChange:B=>R(y.id,B.target.checked)},{default:x(()=>[L(_(y.name),1)]),_:2},1032,["checked","onUpdate:checked","onChange"]))),128))])])):P("",!0)])])),s("div",Bc,[o[99]||(o[99]=s("h4",null,"Export Preview",-1)),s("div",zc,[s("div",Wc,[o[96]||(o[96]=s("span",{class:"label"},"Records:",-1)),s("span",Hc,_(k.value),1)]),s("div",Gc,[o[97]||(o[97]=s("span",{class:"label"},"Fields:",-1)),s("span",qc,_(r.value.length),1)]),s("div",Jc,[o[98]||(o[98]=s("span",{class:"label"},"Estimated Size:",-1)),s("span",Xc,_(V.value),1)])])]),s("div",Kc,[C(G,{onClick:l},{default:x(()=>o[100]||(o[100]=[L("Cancel")])),_:1,__:[100]}),C(G,{type:"primary",onClick:D,loading:u.value,disabled:r.value.length===0},{default:x(()=>[C(z(na)),o[101]||(o[101]=L(" Export "))]),_:1,__:[101]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),Qc=ae(Yc,[["__scopeId","data-v-1fc3d8ba"]]),Zc={class:"trial-details-panel"},ep={key:0,class:"loading-state"},tp={key:1,class:"error-state"},sp={class:"error-actions"},ap=ne({__name:"TrialDetailsPanelV3",props:{trial:{},isLeader:{type:Boolean},executionState:{},progress:{}},emits:["start-trial","pause-trial","resume-trial","cancel-trial","duplicate-trial","edit-trial","delete-trial","export-data","export-python"],setup(i){const e=i,t=Be(),a=q(!1),n=q(null),r=q(!1),u=Xt(),p=U(()=>e.executionState?.status==="executing"&&e.executionState?.currentTrialId===e.trial?.id);function c(){n.value=null}function v(){t.push("/trials")}function h(){r.value=!0}async function g(){if(e.trial){`${e.trial.id}`;try{u.isActive&&u.currentTrialId===e.trial.id&&u.stopStreaming(),await u.loadHistoricalData(e.trial.id),`${e.trial.id}`,(e.trial.status==="running"||e.trial.status==="paused")&&await u.startStreaming(e.trial.id)}catch(b){F.error("REFRESH: Failed to refresh trial data:",b)}}}return re(()=>e.trial,(b,w)=>{b&&b.id!==w?.id&&(n.value=null,F.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 switching from ${w?.id} to ${b.id}`))}),fe(()=>{const b=e.trial?.id;F.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 MOUNTED for trial ${b}`)}),Fe(()=>{const b=e.trial?.id;F.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 ACTIVATED (cache hit) for trial ${b}`)}),xe(()=>{const b=e.trial?.id;F.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 DEACTIVATED (cached) for trial ${b}`)}),be(()=>{const b=e.trial?.id;F.info(`V4_TRIAL_SWITCH: TrialDetailsPanelV3 UNMOUNTED (evicted) for trial ${b}`)}),(b,w)=>{const T=me;return d(),m("div",Zc,[a.value?(d(),m("div",ep,[C(z(Ut),{class:"loading-spinner",spin:""}),w[9]||(w[9]=s("span",null,"Loading trial details...",-1))])):n.value?(d(),m("div",tp,[C(z(Pe),{class:"error-icon"}),w[12]||(w[12]=s("h3",null,"Failed to load trial",-1)),s("p",null,_(n.value),1),s("div",sp,[C(T,{onClick:c},{default:x(()=>w[10]||(w[10]=[L("Retry")])),_:1,__:[10]}),C(T,{type:"link",onClick:v},{default:x(()=>w[11]||(w[11]=[L("Go Back")])),_:1,__:[11]})])])):b.trial?(d(),m(ee,{key:2},[C(Hn,{trial:b.trial,progress:b.progress,"is-executing":p.value},null,8,["trial","progress","is-executing"]),C(Yn,{trial:b.trial,"is-leader":b.isLeader,"execution-state":b.executionState,onStart:w[0]||(w[0]=k=>b.$emit("start-trial")),onPause:w[1]||(w[1]=k=>b.$emit("pause-trial")),onResume:w[2]||(w[2]=k=>b.$emit("resume-trial")),onCancel:w[3]||(w[3]=k=>b.$emit("cancel-trial")),onDuplicate:w[4]||(w[4]=k=>b.$emit("duplicate-trial",b.trial.id)),onEdit:w[5]||(w[5]=k=>b.$emit("edit-trial",b.trial.id)),onDelete:w[6]||(w[6]=k=>b.$emit("delete-trial",b.trial.id)),onExportData:h,onExportPython:w[7]||(w[7]=k=>b.$emit("export-python",b.trial.id)),onRefresh:g},null,8,["trial","is-leader","execution-state"]),b.trial&&r.value?(d(),K(Qc,{key:0,visible:r.value,trial:b.trial,"onUpdate:visible":w[8]||(w[8]=k=>r.value=!1)},null,8,["visible","trial"])):P("",!0),C(nc,{trial:b.trial,progress:b.progress,"is-leader":b.isLeader,"execution-state":b.executionState},null,8,["trial","progress","is-leader","execution-state"])],64)):P("",!0)])}}}),np=ae(ap,[["__scopeId","data-v-081db72e"]]),rp={class:"import-content"},op={class:"upload-section"},ip={class:"ant-upload-drag-icon"},lp={key:0,class:"preview-section"},up={class:"bundle-details"},dp={class:"detail-row"},cp={class:"value"},pp={class:"detail-row"},fp={class:"value"},mp={class:"detail-row"},vp={class:"value"},gp={class:"detail-row"},hp={class:"value"},yp={key:0,style:{color:"green","margin-left":"8px"}},bp={key:1,style:{color:"orange","margin-left":"8px"}},_p={key:0,class:"detail-row"},Tp={class:"value"},kp={class:"detail-row"},Cp={class:"value"},$p={class:"import-options"},wp={key:0,style:{"margin-bottom":"12px"}},Sp={key:1,style:{"margin-bottom":"12px",padding:"8px",background:"#f0f0f0","border-radius":"4px"}},Ip={key:0,class:"warnings"},Ep={class:"modal-actions"},Rp=ne({__name:"ImportTrialDialog",props:{visible:{type:Boolean}},emits:["update:visible","trial-imported"],setup(i,{emit:e}){const t=i,a=e,n=Be(),r=q([]),u=q(null),p=q(!1),c=q([]),v=q({mode:"draft",namePrefix:"Imported: "}),h=U({get:()=>t.visible,set:R=>a("update:visible",R)}),g=U(()=>u.value?.execution?.apiCalls&&u.value.execution.apiCalls.length>0);function b(R){return!1}async function w(R){const S=R.file.originFileObj||R.file;if(S)try{const j=await T(S),f=JSON.parse(j);c.value=k(f),u.value=f,f.execution?.apiCalls&&f.execution.apiCalls.length>0,v.value.mode="draft"}catch{Z.error("Failed to read bundle file: Invalid JSON format"),u.value=null}}function T(R){return new Promise((S,j)=>{const f=new FileReader;f.onload=l=>S(l.target?.result),f.onerror=j,f.readAsText(R)})}function k(R){const S=[];return R.version||S.push("Bundle version is missing"),R.configuration?.trial||S.push("Trial configuration is missing"),(!R.configuration?.variableLists||R.configuration.variableLists.length===0)&&S.push("No variable lists found in bundle"),R.version!=="1.0"&&S.push(`Bundle version ${R.version} may not be fully compatible`),S}function V(R){return new Date(R).toLocaleString()}function H(){r.value=[],u.value=null,c.value=[],h.value=!1}async function N(){if(!u.value){Z.error("No bundle to import");return}p.value=!0;try{const{trialBundleImportService:R}=await Re(async()=>{const{trialBundleImportService:f}=await import("./trial-bundle.service-CFPPZYp4.js");return{trialBundleImportService:f}},__vite__mapDeps([0,1,2,3,4,5,6])),S=g.value&&v.value.mode==="completed",j=await R.importTrialBundle(JSON.stringify(u.value),{importResults:S,importAsCompleted:S,namePrefix:v.value.namePrefix||void 0});j.ok?(Z.success("Trial imported successfully!"),n.push(`/trials?trialId=${j.value.trialId}`),a("trial-imported",j.value.trialId),H()):Z.error(`Import failed: ${j.error.message}`)}catch(R){Z.error(`Import failed: ${R instanceof Error?R.message:"Unknown error"}`)}finally{p.value=!1}}return(R,S)=>{const j=ra,f=qt,l=Gt,D=zt,I=ze,o=me,A=Ce;return d(),K(A,{visible:h.value,"onUpdate:visible":S[3]||(S[3]=$=>h.value=$),title:"Import Trial Bundle",width:600,footer:null,"destroy-on-close":!0,class:"import-trial-modal"},{default:x(()=>[s("div",rp,[s("div",op,[C(j,{fileList:r.value,"onUpdate:fileList":S[0]||(S[0]=$=>r.value=$),"before-upload":b,"max-count":1,accept:".json",onChange:w},{default:x(()=>[s("p",ip,[C(z(Mt))]),S[4]||(S[4]=s("p",{class:"ant-upload-text"},"Click or drag trial bundle file here",-1)),S[5]||(S[5]=s("p",{class:"ant-upload-hint"}," Supports .json files exported from trials ",-1))]),_:1,__:[4,5]},8,["fileList"])]),u.value?(d(),m("div",lp,[S[17]||(S[17]=s("h3",null,"Bundle Contents",-1)),s("div",up,[s("div",dp,[S[6]||(S[6]=s("span",{class:"label"},"Trial Name:",-1)),s("span",cp,_(u.value.metadata.trialName),1)]),s("div",pp,[S[7]||(S[7]=s("span",{class:"label"},"Export Date:",-1)),s("span",fp,_(V(u.value.metadata.exportDate)),1)]),s("div",mp,[S[8]||(S[8]=s("span",{class:"label"},"Status:",-1)),s("span",vp,_(u.value.metadata.trialStatus),1)]),s("div",gp,[S[9]||(S[9]=s("span",{class:"label"},"API Calls:",-1)),s("span",hp,[L(_(u.value.metadata.apiCallCount)+" ",1),g.value?(d(),m("span",yp," (with results) ")):(d(),m("span",bp," (configuration only) "))])]),u.value.configuration.template?(d(),m("div",_p,[S[10]||(S[10]=s("span",{class:"label"},"Template:",-1)),s("span",Tp,_(u.value.configuration.template.name),1)])):P("",!0),s("div",kp,[S[11]||(S[11]=s("span",{class:"label"},"Variable Lists:",-1)),s("span",Cp,_(u.value.configuration.variableLists?.length||0),1)])]),s("div",$p,[S[16]||(S[16]=s("h4",null,"Import Options",-1)),g.value?(d(),m("div",wp,[C(l,{value:v.value.mode,"onUpdate:value":S[1]||(S[1]=$=>v.value.mode=$),style:{display:"block"}},{default:x(()=>[C(f,{value:"draft",style:{display:"block","margin-bottom":"8px"}},{default:x(()=>S[12]||(S[12]=[s("strong",null,"Import as Draft",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Create fresh trial ready to run new experiment ",-1)])),_:1,__:[12]}),C(f,{value:"completed",style:{display:"block"}},{default:x(()=>S[13]||(S[13]=[s("strong",null,"Import as Completed",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px","margin-left":"24px"}}," Preserve historical results for review/analysis ",-1)])),_:1,__:[13]})]),_:1},8,["value"])])):(d(),m("div",Sp,S[14]||(S[14]=[s("strong",null,"Draft Trial",-1),s("div",{style:{color:"var(--color-text-secondary)","font-size":"12px"}}," This bundle contains configuration only - will import as draft ready to run ",-1)]))),C(D,{value:v.value.namePrefix,"onUpdate:value":S[2]||(S[2]=$=>v.value.namePrefix=$),placeholder:"Name prefix (optional)",style:{"margin-top":"8px"}},{prefix:x(()=>S[15]||(S[15]=[L("Name:")])),_:1},8,["value"])]),c.value.length>0?(d(),m("div",Ip,[C(I,{message:"Import Warnings",type:"warning","show-icon":""},{description:x(()=>[s("ul",null,[(d(!0),m(ee,null,te(c.value,$=>(d(),m("li",{key:$},_($),1))),128))])]),_:1})])):P("",!0)])):P("",!0),s("div",Ep,[C(o,{onClick:H},{default:x(()=>S[18]||(S[18]=[L("Cancel")])),_:1,__:[18]}),C(o,{type:"primary",onClick:N,loading:p.value,disabled:!u.value},{default:x(()=>[C(z(Lt)),S[19]||(S[19]=L(" Import Trial "))]),_:1,__:[19]},8,["loading","disabled"])])])]),_:1},8,["visible"])}}}),Pp=ae(Rp,[["__scopeId","data-v-1d9366d6"]]);class ss{getTemplate(){return{id:"minimal",name:"Minimal Experiment Script",description:"Minimal Python script with clear experimental design and pre-built requests",pythonVersion:"3.8",requiredImports:["json","requests","itertools","csv"],templateCode:"MINIMAL_TEMPLATE",supportsAnalysis:!1,supportsVisualization:!1}}generateScript(e,t,a={}){const{includeComments:n=!0}=a,r=this.buildResolvedConfigurations(e);return[this.generateHeader(e,n),this.generateImports(),this.generateExperimentSection(e,n),this.generateResolvedConfigsSection(r,n),this.generateMinimalUtilities(),this.generateExecutionSection(e,n)].filter(Boolean).join(`

`)}buildResolvedConfigurations(e){const t=[];for(const[a,n]of e.configurations.entries())t.push(this.buildResolvedConfig(n,a));return t}buildResolvedConfig(e,t){const a=e.providerSnapshot;if(!a)return this.buildFallbackConfig(e,t);const n=a.api?.baseUrl||"https://api.example.com",r=a.api?.endpoint||"/v1/api",u={"Content-Type":"application/json",...a.headers};a.auth?.type==="bearer"?u.Authorization="Bearer {{API_KEY}}":a.auth?.type==="header"&&a.auth.header&&(u[a.auth.header]="{{API_KEY}}");const p={model:e.modelId},c=a.requestTransform;if(c?.promptKey?c.wrapPrompt?p[c.promptKey]=[{role:c.messageRole||"user",content:"{{PROMPT}}"}]:p[c.promptKey]="{{PROMPT}}":p.prompt="{{PROMPT}}",c?.nestParams){const h=c.rootLevelParams||[],g={},b={};for(const[w,T]of Object.entries(e.parameters))h.includes(w)?b[w]=T:g[w]=T;Object.keys(g).length>0&&(p[c.nestParams]=g),Object.assign(p,b)}else Object.assign(p,e.parameters);if(a.requestTransforms){for(const h of a.requestTransforms)if(h.type==="field_transform"&&h.config){const{field:g,transform:b,transformConfig:w}=h.config;g in p&&b==="string_to_object"&&w?.objectWrapper&&typeof p[g]=="string"&&(p[g]={[w.objectWrapper]:p[g]})}}const v=e.provider.split("-")[0];return{index:t,name:e.modelSnapshot?.displayName||e.modelId,provider:e.provider,providerGroup:v,url:n+r,headers:u,bodyTemplate:p,responsePath:this.getResponsePath(e)}}getResponsePath(e){const t=e.providerSnapshot;if(!t)return"response";const a=t.responseModes?.text;if(!a)return"response";const n=a.responseTransform;if(!n)return"response";const r=[];return n.contentPath&&r.push(n.contentPath),n.fallbackPaths&&Array.isArray(n.fallbackPaths)&&r.push(...n.fallbackPaths),r.length>0?r:"response"}buildFallbackConfig(e,t){const a=e.providerSnapshot,n=a?.api?.baseUrl||"https://api.example.com",r=a?.api?.endpoint||"/v1/api",u=e.provider.split("-")[0];return{index:t,name:e.modelSnapshot?.displayName||e.modelId,provider:e.provider,providerGroup:u,url:n+r,headers:{"Content-Type":"application/json",Authorization:"{{API_KEY}}"},bodyTemplate:{model:e.modelId,prompt:"{{PROMPT}}",...e.parameters},responsePath:"response"}}generateHeader(e,t){const a="#!/usr/bin/env python3";return t?`${a}
"""
Minimal Experiment Script - ${e.name}
Generated: ${new Date().toISOString()}

This script contains ONLY what's needed for your specific experiment.
No generic boilerplate, no unused provider functions.
"""`:a}generateImports(){return`import json
import requests
import itertools
import csv
import sys
import os
import argparse
from datetime import datetime
from typing import Dict, List, Any, Optional`}generateExperimentSection(e,t){const a=t?`# === EXPERIMENTAL DESIGN ===
`:"";if(e.type!=="template"||!e.templateConfig)return`${a}# Non-template trial - no factorial design`;const{template:n,variables:r}=e.templateConfig,u={};for(const[p,c]of Object.entries(r))"snapshot"in c&&c.snapshot?u[p]=c.snapshot.items.map(v=>v.value):c.type==="value"&&c.values&&(u[p]=[...c.values]);return`${a}# Template with variables
template = ${JSON.stringify(n)}

# Variables (${Object.keys(u).length} dimensions)
variables = ${this.toPythonJson(u)}`}generateResolvedConfigsSection(e,t){return`${t?`# === MODEL CONFIGURATIONS ===
# Pre-built requests with all transforms applied
`:""}model_configs = ${this.toPythonJson(e)}`}generateExecutionSection(e,t){const a=t?`# === EXECUTION ===
`:"";if(e.type!=="template")return`${a}# Non-template execution not yet implemented`;const n=new Set;for(const u of e.configurations){const p=u.provider.split("-")[0];n.add(p)}const r=[];for(const u of n){const p=`${u.toUpperCase()}_API_KEY`;u==="ollama"?r.push(`    "${u}": "",  # No key needed for local`):r.push(`    "${u}": os.getenv("${p}", "")`)}return`${a}# Parse command line arguments
parser = argparse.ArgumentParser(description='Run LLM experiment')
parser.add_argument('--replace', action='store_true', help='Replace existing results file')
parser.add_argument('--output', default='experiment_results.jsonl', help='Output file path')
parser.add_argument('--api-keys-file', help='JSON file with API keys')
args = parser.parse_args()

# Output file handling
output_file = args.output
checkpoint_file = output_file.replace('.jsonl', '_checkpoint.json')

# Check for existing results
completed_calls = set()
if os.path.exists(output_file) and not args.replace:
    print(f"Resuming from existing results in {output_file}")
    with open(output_file, 'r') as f:
        for line in f:
            try:
                result = json.loads(line)
                # Use the same ID format as new calls
                config_idx = result.get('config_index', 0)
                call_idx = result.get('call_index', '')
                call_id = f"config{config_idx}_call{call_idx}"
                completed_calls.add(call_id)
            except:
                pass
    print(f"Found {len(completed_calls)} completed calls")
    mode = 'a'  # Append mode
else:
    if os.path.exists(output_file):
        print(f"Replacing existing results file: {output_file}")
    mode = 'w'  # Write mode
    completed_calls = set()

# API Keys (for all providers used in this experiment)
API_KEYS = {
${r.join(`,
`)}
}

# Load API keys from file if provided
if args.api_keys_file and os.path.exists(args.api_keys_file):
    with open(args.api_keys_file, 'r') as f:
        API_KEYS.update(json.load(f))

# Calculate total calls
total_combinations = list(itertools.product(*[variables[k] for k in variables]))
total_calls = len(model_configs) * len(total_combinations)
print(f"\\nTotal API calls to make: {total_calls}")

# Open output file for writing/appending
with open(output_file, mode) as f:
    call_index = 0
    
    # Factorial execution
    for config in model_configs:
        for combination in total_combinations:
            # Build call identifier
            call_index += 1
            call_id = f"config{config['index']}_call{call_index}"
            
            # Skip if already completed
            if call_id in completed_calls:
                print(f"[{call_index}/{total_calls}] Skipping completed: {call_id}")
                continue
            
            # Build variable dictionary
            var_names = list(variables.keys())
            var_dict = dict(zip(var_names, combination))
            
            # Substitute variables in template
            prompt = template
            for var_name, var_value in var_dict.items():
                prompt = prompt.replace(f"{{{{{var_name}}}}}", str(var_value))
            
            # Build request from pre-built template (safe replacement)
            request_body = safe_json_replace(
                config['bodyTemplate'],
                {'{{PROMPT}}': prompt}
            )
            
            # Get API key for this provider (use explicit provider group)
            provider_group = config.get('providerGroup', config['provider'].split('-')[0])
            api_key = API_KEYS.get(provider_group, '')
            
            headers = {}
            for key, value in config['headers'].items():
                headers[key] = value.replace('{{API_KEY}}', api_key)
            
            # Prepare result record
            result = {
                'timestamp': datetime.now().isoformat(),
                'call_index': call_index,
                'config_index': config['index'],  # Store config index for resume
                'model': config['name'],
                'provider': config['provider'],
                **var_dict,
                'prompt': prompt,
                'request': {
                    'url': config['url'],
                    'headers': {k: v if k != 'Authorization' and not k.endswith('-key') else '***' for k, v in headers.items()},
                    'body': request_body
                }
            }
            
            # Make API call
            print(f"[{call_index}/{total_calls}] Calling {config['name']} with {var_dict}...")
            
            try:
                response = requests.post(
                    config['url'],
                    headers=headers,
                    json=request_body,
                    timeout=90
                )
                
                # Store full response
                result['response_status'] = response.status_code
                result['response_headers'] = dict(response.headers)
                
                try:
                    response_json = response.json()
                    result['response_body'] = response_json
                    
                    if response.ok:
                        # Extract content using pre-determined path
                        content = extract_at_path(response_json, config['responsePath'])
                        result['success'] = True
                        result['extracted_content'] = content
                        print(f"  ✓ Success: {str(content)[:100]}...")
                    else:
                        result['success'] = False
                        result['error'] = f"HTTP {response.status_code}"
                        result['error_details'] = response_json
                        print(f"  ✗ HTTP {response.status_code}: {response_json}")
                        
                except json.JSONDecodeError as e:
                    result['success'] = False
                    result['error'] = 'Invalid JSON response'
                    result['response_text'] = response.text[:1000]
                    print(f"  ✗ Invalid JSON: {response.text[:200]}...")
                    
            except requests.exceptions.Timeout:
                result['success'] = False
                result['error'] = 'Request timeout'
                print(f"  ✗ Timeout after 90 seconds")
                
            except requests.exceptions.RequestException as e:
                result['success'] = False
                result['error'] = str(e)
                print(f"  ✗ Request failed: {e}")
                
            except Exception as e:
                result['success'] = False
                result['error'] = str(e)
                result['error_type'] = type(e).__name__
                print(f"  ✗ Unexpected error: {e}")
            
            # Write result immediately (flush to disk)
            json.dump(result, f)
            f.write('\\n')
            f.flush()
            
            # Save checkpoint
            checkpoint = {
                'last_call_index': call_index,
                'completed': call_index,
                'total': total_calls,
                'timestamp': datetime.now().isoformat()
            }
            with open(checkpoint_file, 'w') as cf:
                json.dump(checkpoint, cf, indent=2)

print(f"\\nExperiment complete! Results saved to {output_file}")

# Show summary
show_summary(output_file)`}generateMinimalUtilities(){return`# === UTILITIES ===

def safe_json_replace(obj, replacements):
    """Safely replace placeholders in a nested object structure.
    
    This avoids JSON injection vulnerabilities by replacing in the object,
    not in the JSON string representation.
    """
    if isinstance(obj, dict):
        return {k: safe_json_replace(v, replacements) for k, v in obj.items()}
    elif isinstance(obj, list):
        return [safe_json_replace(item, replacements) for item in obj]
    elif isinstance(obj, str):
        result = obj
        for key, value in replacements.items():
            result = result.replace(key, value)
        return result
    else:
        return obj

def extract_at_path(data: Dict, paths) -> Any:
    """Extract value from nested dict using path(s) like 'choices[0].message.content'
    
    Args:
        data: The response dictionary
        paths: Either a single path string or a list of paths to try
    
    Returns:
        The extracted value from the first successful path, or None
    """
    if not paths or not data:
        return data if not paths else None
    
    # Handle both single path and list of paths
    if isinstance(paths, str):
        paths = [paths]
    
    # Try each path until one works
    for path in paths:
        if not path:
            continue
            
        parts = path.replace('[', '.').replace(']', '').split('.')
        current = data
        
        try:
            for part in parts:
                if part.isdigit():
                    part = int(part)
                current = current[part]
            
            # If we got here without exception and have a non-None value, return it
            if current is not None:
                return current
        except (KeyError, IndexError, TypeError):
            # Try next path
            continue
    
    return None

def show_summary(results_file):
    """Show a simple summary of results."""
    if not os.path.exists(results_file):
        return
    
    results = []
    with open(results_file, 'r') as f:
        for line in f:
            try:
                results.append(json.loads(line))
            except:
                pass
    
    if not results:
        return
    
    total = len(results)
    successful = sum(1 for r in results if r.get('success'))
    failed = total - successful
    
    print(f"\\n{'='*50}")
    print(f"SUMMARY: {successful}/{total} successful ({successful/total*100:.1f}%)")
    if failed > 0:
        print(f"Failed: {failed} calls")
    
    # Group by configuration index
    by_config = {}
    for r in results:
        config_idx = r.get('config_index', 'unknown')
        model = r.get('model', 'unknown')
        provider = r.get('provider', 'unknown')
        key = (config_idx, model, provider)
        if key not in by_config:
            by_config[key] = {'success': 0, 'fail': 0}
        if r.get('success'):
            by_config[key]['success'] += 1
        else:
            by_config[key]['fail'] += 1
    
    print(f"\\nBy Configuration Index:")
    for (idx, model, provider), stats in sorted(by_config.items()):
        total_config = stats['success'] + stats['fail']
        success_rate = stats['success']/total_config*100 if total_config > 0 else 0
        print(f"  [{idx}] {model} via {provider}: {stats['success']}/{total_config} ({success_rate:.1f}%)")
    print(f"{'='*50}\\n")`}toPythonJson(e){return JSON.stringify(e,null,4).replace(/: false/g,": False").replace(/: true/g,": True").replace(/: null/g,": None")}}function Et(i){switch(i){case"minimal":case"basic":case"reproduction":case"analysis":return new ss;default:throw new Error(`Unknown template: ${i}`)}}function Fp(){return[new ss().getTemplate()]}class xp{async generateScript(e,t={}){const a=Date.now();t.template;try{const n=await Ee.loadTrialForExport(e);if(!n.ok){const V=n.error;return{ok:!1,error:new ie("GENERATION_FAILED",`Failed to load trial data: ${V.message}`,{trialId:e,originalError:V})}}const{trial:r,apiCalls:u}=n.value,p=this.validateCodeGenOptions(t);if(!p.isValid)return{ok:!1,error:new ie("INVALID_FIELDS",`Code generation validation failed: ${p.errors.join(", ")}`,{errors:p.errors})};const c=t.template||"minimal",v=Et(c),h=v.getTemplate();u.length;const g=Date.now(),b=v.generateScript(r,u,{includeComments:t.includeComments!==!1});Date.now()-g,b.length,Me(b);const w=Date.now()-a,k={filename:this.generateScriptFilename(r.name,c),mimeType:"text/x-python",data:b,metadata:{trialName:r.name,trialId:r.id,exportDate:new Date,callCount:u.length,fieldCount:0,format:"python",estimatedSizeBytes:Me(b)},template:c,pythonVersion:h.pythonVersion,requiredPackages:this.extractRequiredPackages(h,t),codeLength:b.length,generationTimeMs:w};return k.filename,k.codeLength,k.generationTimeMs,k.requiredPackages,{ok:!0,value:k}}catch(n){const r=n instanceof Error?n:new Error(String(n));return t.template,Date.now()-a,{ok:!1,error:new ie("GENERATION_FAILED",`Python script generation failed: ${r.message}`,{trialId:e,options:t,originalError:n,generationTimeMs:Date.now()-a})}}}getAvailableTemplates(){return Fp()}validateCodeGenOptions(e){const t=[],a=[];if(e.template){const n=this.getAvailableTemplates().map(r=>r.id);n.includes(e.template)||t.push(`Invalid template: ${e.template}. Available templates: ${n.join(", ")}`)}if(e.pythonVersion){const n=["3.8","3.9","3.10","3.11"];n.includes(e.pythonVersion)||a.push(`Python version ${e.pythonVersion} not explicitly supported. Supported versions: ${n.join(", ")}`)}if(e.includeVisualization){const n=e.template||"minimal";Et(n).getTemplate().supportsVisualization||a.push(`Template '${n}' does not support built-in visualization. You can add your own visualization code to the exported script.`)}return{isValid:t.length===0,errors:t,warnings:a}}generateScriptFilename(e,t){const a=e.replace(/[^a-zA-Z0-9\s-_]/g,"").replace(/\s+/g,"_").toLowerCase().substring(0,30).replace(/^_+|_+$/g,"")||"trial",n=t==="minimal"?"":`_${t}`,r=new Date().toISOString().split("T")[0];return`${a}${n}_${r}.py`}extractRequiredPackages(e,t){return["json","requests","itertools","csv"]}}const Rt=new xp,Ap={class:"trials-view-v3"},Op={key:0,class:"provider-warning-banner"},Vp={class:"banner-content"},Dp={key:1,class:"observer-mode-banner"},Np={class:"banner-content"},Lp={key:1,class:"loading-left-pane"},Mp={key:0,class:"no-selection"},Up={key:0,class:"observer-note"},jp=ne({__name:"TrialsViewV3",setup(i){const e=fa(),{trials:t}=la(),{enabledModels:a}=ma(),{duplicateTrial:n,deleteTrial:r}=ua(),u=Xt(),p=Vt(),c=Be(),v=q(),h=q(!0),g=q(null),b=q(""),w=q("all"),T=q(-1),k=q(!1),V=q(!1),H=q(!1),N=U(()=>a.value.length>0),R=U(()=>!N.value&&!H.value),S=e.isLeader,j=e.execution,{trial:f}=da(g),l=U(()=>{const M=f.value?.progress;return M?{trialId:g.value||"",...M,lastUpdated:new Date}:null}),D=U(()=>{let M=t.value;if(b.value){const W=b.value.toLowerCase();M=M.filter(Q=>{const ve=Q.name.toLowerCase().includes(W),ge=Q.templateConfig?.template?.toLowerCase().includes(W),le=Q.configurations.some(Te=>Te.modelId.toLowerCase().includes(W)||Te.provider.toLowerCase().includes(W));return ve||ge||le})}return w.value!=="all"&&(M=M.filter(W=>W.status===w.value)),M});async function I(){const M=p.query;if(M.duplicate){const W=M.duplicate,Q=await n(W);Q.ok?await c.push({path:"/trials/create",query:{duplicate:Q.value,edit:M.edit==="true"?"true":void 0}}):Z.error(`Failed to duplicate trial: ${Q.error?.message||"Unknown error"}`),await c.replace({query:{}});return}if(M.designId||M.promptSource){await c.push({path:"/trials/create",query:M});return}if(p.query.trialId){const W=p.query.trialId;A(W)}}function o(){if(g.value||t.value.length===0)return;const M=t.value.find(W=>W.status==="running");if(M){A(M.id);return}A(t.value[0].id)}async function A(M){const W=performance.now();F.info(`V4_TRIAL_SWITCH: Starting trial selection: ${M}`),g.value=M;const Q=performance.now();if(F.info(`V4_TRIAL_SWITCH: UI updated in ${(Q-W).toFixed(1)}ms`),t.value.length>0){const le=D.value.findIndex(Te=>Te.id===M);le>=0&&(T.value=le)}const ve=performance.now();if(F.info(`V4_TRIAL_SWITCH: Starting stream manager for trial ${M} at ${(ve-W).toFixed(1)}ms`),u.startStreaming(M).catch(le=>{F.error(`V4_TRIAL_SWITCH: Failed to start streaming for trial ${M}`,le)}),p.query.trialId!==M){const le={...p.query};le.trialId=M,le.tab||(le.tab="status"),c.push({path:"/trials",query:le}),F.info(`V4_TRIAL_SWITCH: URL updated to preserve tab '${le.tab}' at ${(performance.now()-W).toFixed(1)}ms`)}v.value&&v.value.closeMobileOverlay();const ge=performance.now();F.info(`V4_TRIAL_SWITCH: selectTrial() completed in ${(ge-W).toFixed(1)}ms`)}function $(M){b.value=M,T.value=-1}function E(M){w.value=M,T.value=-1}async function G(){Z.info("Refreshing trial list...")}function O(M){const W=D.value;if(W.length!==0){if((M.metaKey||M.ctrlKey)&&M.key==="k"){M.preventDefault(),window.dispatchEvent(new CustomEvent("focus-trial-search"));return}(M.key==="j"||M.key==="ArrowDown")&&(M.preventDefault(),T.value=Math.min(T.value+1,W.length-1),T.value>=0&&(A(W[T.value].id),Y(W[T.value].id))),(M.key==="k"||M.key==="ArrowUp")&&(M.preventDefault(),T.value=Math.max(T.value-1,0),A(W[T.value].id),Y(W[T.value].id)),M.key==="Enter"&&g.value,M.key==="Escape"&&(b.value="",g.value=null,T.value=-1)}}function Y(M){ke(()=>{const W=document.querySelector(`[data-trial-id="${M}"]`);W&&W.scrollIntoView({behavior:"smooth",block:"nearest"})})}function y(M){F.debug("Trial list panel resized",{width:M})}function B(M){F.debug("Mobile overlay changed",{visible:M})}function J(){H.value=!0}async function X(){await c.push("/trials/create")}function oe(){V.value=!0}function ce(M){G(),A(M)}async function pe(){if(g.value&&!k.value){k.value=!0,e.execution?.value,e.execution?.value?.status;try{g.value;const M=await e.startTrialWithStreaming(g.value);if(!M.ok){Z.error(M.error?.message||"Unknown error");return}await u.startStreaming(g.value);const W={...p.query};W.tab="tasks",c.replace({query:W})}finally{k.value=!1}}}async function Je(){`${g.value}`,`${g.value}`,`${e.execution.value.status}`,`${e.isLeader.value}`;const M=await e.pauseExecution();M?.ok,M.ok?`${e.execution.value.status}`:(M.error.message,Z.error(M.error?.message||"Unknown error"))}async function as(){if(!g.value)return;`${g.value}`,`${g.value}`,`${e.execution.value.status}`,`${e.isLeader.value}`;const M=e.execution.value?.status||"idle",W=e.execution.value?.currentTrialId;if(M==="paused"&&W===g.value){`${g.value}`;const Q=await e.resumeExecution(g.value);Q.ok||(Q.error.message,Z.error(Q.error.message))}else{const Q=await e.startTrialWithStreaming(g.value);Q.ok?await u.startStreaming(g.value):(Q.error.message,Z.error(Q.error?.message||"Unknown error"))}}async function ns(){const M=await e.cancelExecution();M.ok||Z.error(M.error?.message||"Unknown error")}async function rs(M){const W=await n(M);W.ok?(Z.success("Trial duplicated"),W.value&&A(W.value)):Z.error(W.error?.message||"Unknown error")}async function os(M){await c.push({path:"/trials/create",query:{duplicate:M,edit:"true"}})}async function is(M){const W=await r(M);W.ok?(Z.success("Trial deleted"),g.value===M&&(g.value=null)):Z.error(W.error?.message||"Unknown error")}async function ls(M,W){const Q=await it.exportTrialData(M,{format:W,fields:void 0,includeHeaders:!0,addBOM:W==="excel"||W==="csv"});Q.ok?(await Ne.downloadFile(Q.value.data,W,Q.value.metadata.trialName,W==="excel"||W==="csv"),Z.success(`Exported ${Q.value.recordCount} API calls to ${Q.value.filename}`)):Z.error(Q.error?.message||"Unknown error")}function us(M){ds(M,"minimal")}async function ds(M,W="classic"){if(W==="bundle"){const{usePythonBundleManagement:Q}=await Re(async()=>{const{usePythonBundleManagement:le}=await import("./python-bundle-management-BCaDt2ES.js");return{usePythonBundleManagement:le}},__vite__mapDeps([7,1,2,3,4,5,0,6])),{exportPythonBundle:ve}=Q(),ge=await ve(M,{includeApiKeys:!0,showProgress:!0});ge.ok||Z.error(ge.error?.message||"Bundle export failed")}else if(W==="minimal"){const Q=await Rt.generateScript(M,{template:"minimal",includeComments:!0});Q.ok?(await Ne.downloadFile(Q.value.data,"python",Q.value.metadata.trialName,!1),Z.success("Minimal Python script exported")):Z.error(Q.error?.message||"Minimal export failed")}else{const Q=await Rt.generateScript(M,{template:"minimal",includeComments:!0});Q.ok?(await Ne.downloadFile(Q.value.data,"python",Q.value.metadata.trialName,!1),Z.success("Python script exported")):Z.error(Q.error?.message||"Classic export failed")}}return re(()=>p.query.trialId,M=>{M&&M!==g.value&&A(M)}),re(h,(M,W)=>{const Q=performance.now();F.info(`V4_TRIAL_SWITCH: isLoadingInitial changed from ${W} to ${M} at ${Q}`),M||F.info("V4_TRIAL_SWITCH: Both panes should now be VISIBLE (no longer loading initial)")},{immediate:!0}),re(t,(M,W)=>{const Q=performance.now();F.info(`V4_TRIAL_SWITCH: trials array changed from ${W?.length||0} to ${M.length} trials at ${Q}`)},{immediate:!0}),fe(async()=>{const M=performance.now();F.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() ENTRY at ${M}`);const W=performance.now();F.info(`V4_TRIAL_SWITCH: Starting V4 execution system initialization at ${(W-M).toFixed(1)}ms`);try{await e.initialize();const Xe=performance.now();F.info(`V4_TRIAL_SWITCH: V4 execution system initialized in ${(Xe-W).toFixed(1)}ms`)}catch(Xe){const ms=performance.now();F.error(`V4_TRIAL_SWITCH: V4 initialization failed in ${(ms-W).toFixed(1)}ms:`,Xe)}const Q=performance.now();window.addEventListener("keydown",O),F.info(`V4_TRIAL_SWITCH: Keyboard listener added in ${(Q-M).toFixed(1)}ms`);const ve=performance.now();F.info(`V4_TRIAL_SWITCH: Starting nextTick wait at ${(ve-M).toFixed(1)}ms`),await ke();const ge=performance.now();F.info(`V4_TRIAL_SWITCH: nextTick completed in ${(ge-ve).toFixed(1)}ms`);const le=performance.now();h.value=!1,F.info(`V4_TRIAL_SWITCH: isLoadingInitial set to false at ${(le-M).toFixed(1)}ms`);const Te=performance.now();F.info(`V4_TRIAL_SWITCH: Starting URL parameter processing at ${(Te-M).toFixed(1)}ms`),await I();const cs=performance.now();F.info(`V4_TRIAL_SWITCH: URL parameter processing completed in ${(cs-Te).toFixed(1)}ms`);const vt=performance.now();F.info(`V4_TRIAL_SWITCH: Starting auto-selection at ${(vt-M).toFixed(1)}ms`),o();const ps=performance.now();F.info(`V4_TRIAL_SWITCH: Auto-selection completed in ${(ps-vt).toFixed(1)}ms`);const fs=performance.now();F.info(`V4_TRIAL_SWITCH: TrialsViewV3 onMounted() TOTAL: ${(fs-M).toFixed(1)}ms`)}),be(()=>{window.removeEventListener("keydown",O),u.destroy()}),(M,W)=>{const Q=Pt("router-link"),ve=me;return d(),m("div",Ap,[R.value?(d(),m("div",Op,[s("div",Vp,[C(z(Pe),{class:"warning-icon"}),W[2]||(W[2]=s("span",null,"No LLM providers configured. Please add API keys in Settings to run trials.",-1)),C(Q,{to:"/settings",class:"settings-link"},{default:x(()=>W[1]||(W[1]=[L("Go to Settings")])),_:1,__:[1]}),C(z(Nt),{class:"close-icon",onClick:J})]),W[3]||(W[3]=s("div",{class:"banner-note"},"Note: Ollama doesn't require API keys",-1))])):P("",!0),z(S)?P("",!0):(d(),m("div",Dp,[s("div",Np,[C(z(Bt),{class:"observer-icon"}),W[4]||(W[4]=s("span",null,[s("strong",null,"Observer Mode: Multiple Tabs Detected")],-1)),W[5]||(W[5]=s("div",{class:"leader-hint"}," You can only open one Auditomatic tab at a time. Close other tabs, or refresh if this is your only tab. Your templates and trials are safely saved. ",-1))])])),C(ha,{ref_key:"splitPanel",ref:v,"storage-key":"trial-list-width","default-width":250,"min-width":200,"max-width":600,onResize:y,onMobileOverlayChange:B},{left:x(()=>[h.value?(d(),m("div",Lp," Loading trials... ")):(d(),K(Rn,{key:0,trials:z(t),"selected-trial-id":g.value,"search-query":b.value,"filter-status":w.value,onSelectTrial:A,onCreateTrial:X,onImportTrial:oe,onUpdateSearch:$,onUpdateFilter:E,onRefresh:G},null,8,["trials","selected-trial-id","search-query","filter-status"]))]),right:x(()=>[(d(),K(tt,{max:5},[g.value?(d(),K(np,{key:g.value,trial:z(f),"is-leader":z(S),"execution-state":z(j),progress:l.value,onStartTrial:pe,onPauseTrial:Je,onResumeTrial:as,onCancelTrial:ns,onDuplicateTrial:rs,onEditTrial:os,onDeleteTrial:is,onExportData:ls,onExportPython:us},null,8,["trial","is-leader","execution-state","progress"])):P("",!0)],1024)),!g.value||!z(f)?Se((d(),m("div",Mp,[C(z(Ht),{class:"empty-icon"}),W[7]||(W[7]=s("h3",null,"Select a trial to view details",-1)),W[8]||(W[8]=s("p",null,"Choose from the list or create a new one",-1)),C(ve,{type:"primary",size:"large",disabled:!z(S),onClick:X},{default:x(()=>W[6]||(W[6]=[L(" Create New Trial ")])),_:1,__:[6]},8,["disabled"]),z(S)?P("",!0):(d(),m("div",Up," Close other tabs to enable trial creation "))],512)),[[At,!h.value]]):P("",!0)]),_:1},512),C(Pp,{visible:V.value,"onUpdate:visible":W[0]||(W[0]=ge=>V.value=ge),onTrialImported:ce},null,8,["visible"])])}}}),af=ae(jp,[["__scopeId","data-v-f2ce2e14"]]);export{af as default};
