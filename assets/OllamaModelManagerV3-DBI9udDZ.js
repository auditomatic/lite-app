import{F as ge}from"./FilterOutlined-DlRFXCLD.js";import{e as _,I as fe,f as K,c as Q,h as u,j as a,i as z,y as O,x as v,z as C,A as b,F as D,C as W,B as p,G as h,v as x,k as J,ac as Z,au as A,aj as re,L as pe,aD as me,r as V,D as ne,a as ve,w as ye,E as ue,t as _e,H as ze,as as he,N as ke}from"./index-8if2tzRy.js";import{ollamaFetch as de,checkOllamaConnection as we,deleteOllamaModel as be,fetchOllamaModels as $e}from"./ollama-fetch-C87Es6LB.js";import{U as Me}from"./UnorderedListOutlined-BreZGnGi.js";var Ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zM464 544H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H212V612h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200z"}}]},name:"appstore",theme:"outlined"};function ce(G){for(var s=1;s<arguments.length;s++){var $=arguments[s]!=null?Object(arguments[s]):{},T=Object.keys($);typeof Object.getOwnPropertySymbols=="function"&&(T=T.concat(Object.getOwnPropertySymbols($).filter(function(y){return Object.getOwnPropertyDescriptor($,y).enumerable}))),T.forEach(function(y){Te(G,y,$[y])})}return G}function Te(G,s,$){return s in G?Object.defineProperty(G,s,{value:$,enumerable:!0,configurable:!0,writable:!0}):G[s]=$,G}var oe=function(s,$){var T=ce({},s,$.attrs);return _(fe,ce({},T,{icon:Ce}),null)};oe.displayName="AppstoreOutlined";oe.inheritAttrs=!1;const Se={class:"search-section"},Be={class:"search-controls"},Oe={class:"size-filter"},xe={class:"size-controls"},Ge={class:"size-presets"},Pe={key:0,class:"size-filter-indicator"},Ie={class:"quantized-filter"},Fe={class:"filter-description"},Le={class:"category-filters"},Qe=K({__name:"OllamaSearchFilters",props:{searchQuery:{},sortBy:{},selectedCategories:{},maxSizeGB:{},showQuantized:{type:Boolean},categories:{}},emits:["update:searchQuery","update:sortBy","update:maxSizeGB","update:showQuantized","toggle-category"],setup(G,{emit:s}){const $=G,T=s,y=Q({get:()=>$.searchQuery,set:d=>T("update:searchQuery",d)}),S=Q({get:()=>$.sortBy,set:d=>T("update:sortBy",d)}),B=Q({get:()=>$.maxSizeGB,set:d=>T("update:maxSizeGB",d)}),F=Q({get:()=>$.showQuantized,set:d=>T("update:showQuantized",d)}),m=[{label:"1GB",value:1},{label:"2GB",value:2},{label:"4GB",value:4},{label:"8GB",value:8},{label:"16GB",value:16},{label:"None",value:999}];return(d,f)=>{const H=O("a-input-search"),q=O("a-select-option"),i=O("a-select"),n=O("a-input-number"),l=O("a-button"),P=O("a-tag");return a(),u("div",Se,[z("div",Be,[_(H,{value:y.value,"onUpdate:value":f[0]||(f[0]=t=>y.value=t),placeholder:"Search models by name or description...","allow-clear":"",size:"large",class:"search-input"},null,8,["value"]),_(i,{value:S.value,"onUpdate:value":f[1]||(f[1]=t=>S.value=t),placeholder:"Sort by",style:{width:"180px"},size:"large"},{default:v(()=>[_(q,{value:"popularity"},{default:v(()=>f[4]||(f[4]=[C("Popularity")])),_:1,__:[4]}),_(q,{value:"lastUpdated"},{default:v(()=>f[5]||(f[5]=[C("Last Updated")])),_:1,__:[5]}),_(q,{value:"name"},{default:v(()=>f[6]||(f[6]=[C("Name")])),_:1,__:[6]}),_(q,{value:"tagCount"},{default:v(()=>f[7]||(f[7]=[C("Tag Count")])),_:1,__:[7]})]),_:1},8,["value"])]),z("div",Oe,[z("div",xe,[f[8]||(f[8]=z("span",{class:"filter-label"},"Filter to models smaller than:",-1)),_(n,{value:B.value,"onUpdate:value":f[2]||(f[2]=t=>B.value=t),min:1,max:999,step:1,size:"small",class:"size-input","addon-after":"GB"},null,8,["value"]),z("div",Ge,[(a(),u(D,null,W(m,t=>_(l,{key:t.value,size:"small",type:B.value===t.value?"primary":"default",onClick:e=>B.value=t.value,class:"preset-button"},{default:v(()=>[C(p(t.label),1)]),_:2},1032,["type","onClick"])),64))])]),B.value<999?(a(),u("span",Pe," â‰¤"+p(B.value)+"GB filter active ",1)):b("",!0)]),z("div",Ie,[_(l,{type:F.value?"default":"primary",size:"small",onClick:f[3]||(f[3]=t=>F.value=!F.value)},{icon:v(()=>[_(h(ge))]),default:v(()=>[C(" "+p(F.value?"Hide":"Show")+" Quantized Versions ",1)]),_:1},8,["type"]),z("span",Fe,p(F.value?"Showing all versions":"Hiding q2_K, q3_K, q4_0, q5_1, q6_K, q8_0, fp16..."),1)]),z("div",Le,[(a(!0),u(D,null,W(d.categories,t=>(a(),x(P,{key:t,color:d.selectedCategories.includes(t)?"blue":"default",checkable:!0,checked:d.selectedCategories.includes(t),onClick:e=>d.$emit("toggle-category",t),class:"category-tag"},{default:v(()=>[C(p(t),1)]),_:2},1032,["color","checked","onClick"]))),128))])])}}}),Ve=J(Qe,[["__scopeId","data-v-a03d8794"]]),De={key:0,class:"downloads-section"},He={class:"download-items"},qe={class:"download-info"},Ue={class:"download-tag"},Ee={class:"download-status"},je=K({__name:"OllamaDownloadProgress",props:{pullProgress:{}},setup(G){return(s,$)=>{const T=O("a-progress");return Object.keys(s.pullProgress).length>0?(a(),u("div",De,[$[0]||($[0]=z("h4",null,"Active Downloads",-1)),z("div",He,[(a(!0),u(D,null,W(s.pullProgress,(y,S)=>(a(),u("div",{key:S,class:"download-item"},[z("div",qe,[z("code",Ue,p(S),1),z("span",Ee,p(y.message),1)]),_(T,{percent:y.percent,status:y.status==="success"?"success":"active",size:"small",class:"download-progress"},null,8,["percent","status"])]))),128))])])):b("",!0)}}}),Ae=J(je,[["__scopeId","data-v-88ba3f68"]]),Re={class:"model-info"},Ne={class:"model-name"},We={key:0},Ke={class:"model-description"},Je={class:"model-actions"},Xe={key:0,class:"button-size-info"},Ye={key:0,class:"tags-preview"},Ze={class:"preview-tags"},et=["onClick","title"],tt={key:1,class:"tag-actual"},at={class:"tag-size"},st={key:0,class:"more-tags"},lt={key:1,class:"tags-expanded"},nt={key:0,class:"tag-name"},ot={key:2},it={key:1,class:"text-secondary"},rt=K({__name:"OllamaModelCard",props:{model:{},expanded:{type:Boolean},pullingModels:{},pullProgress:{},installedModels:{},maxSizeGB:{},showQuantized:{type:Boolean},isQuantizedTag:{type:Function},parseSizeToGB:{type:Function},getSizeClass:{type:Function},getLatestTagInfo:{type:Function}},emits:["toggle-expand","pull-model"],setup(G){const s=G,$=[{title:"Tag",key:"name",width:200},{title:"Size",key:"size",width:100,align:"right"},{title:"Context",key:"context",width:100,align:"center"},{title:"Status",key:"status",width:80,align:"center"},{title:"Action",key:"actions",width:80,align:"center"}],T=Q(()=>s.installedModels.some(t=>t.startsWith(s.model.name))),y=Q(()=>s.installedModels.filter(t=>t.startsWith(s.model.name+":")).length),S=Q(()=>i(`${s.model.name}:latest`)||i(s.model.name)),B=Q(()=>s.pullingModels.has(`${s.model.name}:latest`)),F=Q(()=>s.pullProgress[`${s.model.name}:latest`]),m=Q(()=>s.getLatestTagInfo(s.model)),d=Q(()=>s.maxSizeGB<999||!s.showQuantized),f=Q(()=>s.model.tags?Object.entries(s.model.tags).map(([t,e])=>({...e,name:t})).filter(t=>!(s.maxSizeGB<999&&s.parseSizeToGB(t.size||"0GB")>s.maxSizeGB||!s.showQuantized&&s.isQuantizedTag(t.name))).sort((t,e)=>t.name.localeCompare(e.name)):[]),H=Q(()=>f.value.length),q=Q(()=>f.value.sort((e,r)=>{const w=["latest","instruct","8b","7b","3b","1b"],k=w.indexOf(e.name),o=w.indexOf(r.name);return k!==-1&&o!==-1?k-o:k!==-1?-1:o!==-1?1:e.name.localeCompare(r.name)}).slice(0,5));function i(t){return s.installedModels.includes(t)}function n(t){return s.pullingModels.has(t)}function l(t){return s.pullProgress[t]}const P=Q(()=>{const t=m.value;return t?{actualTag:t.actualTag||"",size:t.size||""}:null});return(t,e)=>{const r=O("a-tag"),w=O("a-button"),k=O("a-table");return a(),u("div",{class:Z(["model-item",{expanded:t.expanded}])},[z("div",{class:"model-header",onClick:e[2]||(e[2]=o=>t.$emit("toggle-expand"))},[z("div",Re,[z("div",Ne,[z("h4",null,p(t.model.name),1),_(r,{size:"small",color:"blue"},{default:v(()=>[C(p(t.model.pullCount||"0")+" pulls",1)]),_:1}),_(r,{size:"small",color:"green"},{default:v(()=>[C(p(H.value)+" ",1),d.value?(a(),u("span",We,"/"+p(t.model.tagCount||0),1)):b("",!0),e[3]||(e[3]=C(" versions "))]),_:1,__:[3]}),T.value?(a(),x(r,{key:0,size:"small",color:"success",class:"installed-tag"},{icon:v(()=>[_(h(A))]),default:v(()=>[C(" "+p(y.value)+" installed ",1)]),_:1})):b("",!0)]),z("p",Ke,p(t.model.description||"No description available"),1)]),z("div",Je,[_(w,{type:S.value?"default":"primary",size:"small",onClick:e[0]||(e[0]=re(o=>t.$emit("pull-model",t.model.name,"latest"),["stop"])),loading:B.value,disabled:S.value},{default:v(()=>[F.value?(a(),u(D,{key:0},[C(p(Math.round(F.value.percent))+"% ",1)],64)):S.value?(a(),u(D,{key:1},[_(h(A)),e[4]||(e[4]=C(" Installed "))],64)):(a(),u(D,{key:2},[e[5]||(e[5]=C(" Pull Latest ")),P.value?(a(),u("span",Xe," ("+p(P.value.actualTag?P.value.actualTag+", ":"")+p(P.value.size)+") ",1)):b("",!0)],64))]),_:1},8,["type","loading","disabled"]),_(w,{type:"text",size:"small",onClick:e[1]||(e[1]=re(o=>t.$emit("toggle-expand"),["stop"]))},{icon:v(()=>[t.expanded?(a(),x(h(me),{key:1})):(a(),x(h(pe),{key:0}))]),default:v(()=>[C(" "+p(t.expanded?"Hide versions":"See all versions"),1)]),_:1})])]),t.expanded?b("",!0):(a(),u("div",Ye,[z("div",Ze,[(a(!0),u(D,null,W(q.value,o=>(a(),u("span",{key:o.name,class:Z(["tag-chip",[t.getSizeClass(o.size),{installed:i(o.fullTag)}]]),onClick:M=>i(o.fullTag)?null:t.$emit("pull-model",t.model.name,o.name),title:`${o.fullTag} - ${o.size}${i(o.fullTag)?" (Installed)":""}`},[i(o.fullTag)?(a(),x(h(A),{key:0,class:"installed-icon"})):b("",!0),C(" "+p(o.name)+" ",1),o.name==="latest"&&P.value?(a(),u("span",tt," ("+p(P.value.actualTag)+") ",1)):b("",!0),z("span",at,p(o.size),1)],10,et))),128)),H.value>5?(a(),u("span",st," +"+p(H.value-5)+" more versions ",1)):b("",!0)])])),t.expanded?(a(),u("div",lt,[_(k,{columns:$,"data-source":f.value,pagination:!1,size:"small",scroll:{y:300},class:"tags-table"},{bodyCell:v(({column:o,record:M})=>[o.key==="name"?(a(),u("code",nt,p(M.name),1)):b("",!0),o.key==="size"?(a(),u("span",{key:1,class:Z(["tag-size",t.getSizeClass(M.size)])},p(M.size),3)):b("",!0),o.key==="context"?(a(),u("span",ot,p(M.contextWindow),1)):b("",!0),o.key==="status"?(a(),u(D,{key:3},[i(M.fullTag)?(a(),x(r,{key:0,size:"small",color:"success"},{default:v(()=>[_(h(A)),e[6]||(e[6]=C(" Installed "))]),_:1,__:[6]})):(a(),u("span",it,"-"))],64)):b("",!0),o.key==="actions"?(a(),x(w,{key:4,type:i(M.fullTag)?"default":"primary",size:"small",onClick:U=>t.$emit("pull-model",t.model.name,M.name),loading:n(M.fullTag),disabled:i(M.fullTag)},{default:v(()=>[l(M.fullTag)?(a(),u(D,{key:0},[C(p(Math.round(l(M.fullTag).percent))+"% ",1)],64)):i(M.fullTag)?(a(),u(D,{key:1},[_(h(A)),e[7]||(e[7]=C(" Installed "))],64)):(a(),u(D,{key:2},[C(" Pull ")],64))]),_:2},1032,["type","onClick","loading","disabled"])):b("",!0)]),_:1},8,["data-source"])])):b("",!0)],2)}}}),ut=J(rt,[["__scopeId","data-v-83727817"]]),dt={class:"list-view"},ct={class:"expanded-tags-container"},pt={class:"expanded-tags-grid"},mt={class:"tag-name"},gt={key:0,class:"tag-actual"},ft={class:"tag-size"},vt={class:"tag-context"},yt={key:0,class:"model-name-cell"},_t={key:1,class:"description-cell"},zt={key:2,class:"stats-cell"},ht={class:"stat-item"},kt={class:"stat-item"},wt={key:0},bt={key:3,class:"size-range"},$t=K({__name:"OllamaModelList",props:{models:{},expandedModels:{},pullingModels:{},pullProgress:{},installedModels:{},maxSizeGB:{},showQuantized:{type:Boolean},isQuantizedTag:{type:Function},parseSizeToGB:{type:Function},getSizeClass:{type:Function},getLatestTagInfo:{type:Function},getModelSizeRange:{type:Function}},emits:["toggle-model","pull-model","expand"],setup(G){const s=G,$=[{title:"Model",key:"name",width:200,fixed:"left"},{title:"Description",key:"description",ellipsis:!0},{title:"Stats",key:"stats",width:200},{title:"Size Range",key:"sizeRange",width:120,align:"center"},{title:"Actions",key:"actions",width:220,align:"center",fixed:"right"}];function T(m){return m.tags?Object.entries(m.tags).map(([d,f])=>({...f,name:d})).filter(d=>!(s.maxSizeGB<999&&s.parseSizeToGB(d.size||"0GB")>s.maxSizeGB||!s.showQuantized&&s.isQuantizedTag(d.name))).sort((d,f)=>d.name.localeCompare(f.name)):[]}function y(m){return m.tags?Object.entries(m.tags).filter(([d,f])=>!(s.maxSizeGB<999&&s.parseSizeToGB(f.size||"0GB")>s.maxSizeGB||!s.showQuantized&&s.isQuantizedTag(d))).length:0}function S(m){return s.installedModels.some(d=>d.startsWith(m))}function B(m){return s.installedModels.includes(m)}function F(m){return s.installedModels.filter(d=>d.startsWith(m+":"))}return(m,d)=>{const f=O("a-tag"),H=O("a-button"),q=O("a-space"),i=O("a-table");return a(),u("div",dt,[_(i,{"data-source":m.models,columns:$,pagination:!1,"row-key":n=>n.name,size:"small",scroll:{y:"calc(100% - 48px)"},"expanded-row-keys":m.expandedModels,"expand-row-by-click":!1,onExpand:d[0]||(d[0]=(n,l)=>m.$emit("expand",n,l)),class:"models-list-table"},{expandedRowRender:v(({record:n})=>[z("div",ct,[z("div",pt,[(a(!0),u(D,null,W(T(n),l=>{var P;return a(),u("div",{key:l.fullTag,class:Z(["expanded-tag-item",m.getSizeClass(l.size)])},[z("span",mt,p(l.name),1),l.name==="latest"&&m.getLatestTagInfo(n)?(a(),u("span",gt," ("+p((P=m.getLatestTagInfo(n))==null?void 0:P.actualTag)+") ",1)):b("",!0),z("span",ft,p(l.size),1),z("span",vt,p(l.contextWindow||"-"),1),B(l.fullTag)?(a(),x(f,{key:1,size:"small",color:"success"},{default:v(()=>[_(h(A)),d[1]||(d[1]=C(" Installed "))]),_:1,__:[1]})):(a(),x(H,{key:2,type:"primary",size:"small",loading:m.pullingModels.has(l.fullTag),onClick:t=>m.$emit("pull-model",n.name,l.name)},{default:v(()=>[m.pullProgress[l.fullTag]?(a(),u(D,{key:0},[C(p(Math.round(m.pullProgress[l.fullTag].percent))+"% ",1)],64)):(a(),u(D,{key:1},[C(" Pull ")],64))]),_:2},1032,["loading","onClick"]))],2)}),128))])])]),bodyCell:v(({column:n,record:l})=>[n.key==="name"?(a(),u("div",yt,[z("code",null,p(l.name),1),S(l.name)?(a(),x(f,{key:0,size:"small",color:"success"},{default:v(()=>[_(h(A)),C(" "+p(F(l.name).length)+" installed ",1)]),_:2},1024)):b("",!0)])):b("",!0),n.key==="description"?(a(),u("span",_t,p(l.description||"No description"),1)):b("",!0),n.key==="stats"?(a(),u("div",zt,[z("span",ht,p(l.pullCount||"0")+" pulls",1),d[3]||(d[3]=z("span",{class:"stat-divider"},"â€¢",-1)),z("span",kt,[C(p(y(l))+" ",1),m.maxSizeGB<999||!m.showQuantized?(a(),u("span",wt,"/"+p(l.tagCount||0),1)):b("",!0),d[2]||(d[2]=C(" versions "))])])):b("",!0),n.key==="sizeRange"?(a(),u("span",bt,p(m.getModelSizeRange(l)),1)):b("",!0),n.key==="actions"?(a(),x(q,{key:4,size:"small"},{default:v(()=>[_(H,{type:"text",size:"small",onClick:P=>m.$emit("toggle-model",l.name)},{icon:v(()=>[m.expandedModels.includes(l.name)?(a(),x(h(me),{key:1})):(a(),x(h(pe),{key:0}))]),default:v(()=>[C(" "+p(m.expandedModels.includes(l.name)?"Hide":"See")+" Versions ",1)]),_:2},1032,["onClick"]),_(H,{type:B(`${l.name}:latest`)||B(l.name)?"default":"primary",size:"small",onClick:P=>m.$emit("pull-model",l.name,"latest"),loading:m.pullingModels.has(`${l.name}:latest`),disabled:B(`${l.name}:latest`)||B(l.name)},{default:v(()=>[m.pullProgress[`${l.name}:latest`]?(a(),u(D,{key:0},[C(p(Math.round(m.pullProgress[`${l.name}:latest`].percent))+"% ",1)],64)):B(`${l.name}:latest`)||B(l.name)?(a(),x(h(A),{key:1})):(a(),u(D,{key:2},[C(" Pull Latest ")],64))]),_:2},1032,["type","onClick","loading","disabled"])]),_:2},1024)):b("",!0)]),_:1},8,["data-source","row-key","expanded-row-keys"])])}}}),Mt=J($t,[["__scopeId","data-v-7d1c26f3"]]);function Ct(){const G=V(null),s=V(!1),$=V(""),T=V(new Set),y=V({}),S=V([]);async function B(){s.value=!0,$.value="";try{const e=await fetch("https://ollama.models.auditomatic.org/models.json");if(!e.ok)throw new Error(`Failed to fetch models: ${e.statusText}`);G.value=await e.json(),await F()}catch(e){$.value=`Failed to load model library: ${e instanceof Error?e.message:"Unknown error"}`}finally{s.value=!1}}async function F(){try{const e=await de("/api/tags");if(e.ok){const r=await e.json();S.value=(r.models||[]).map(w=>w.name)}}catch(e){const r=e;r.type==="cors"&&r.isHttps&&ve.debug("Cannot access Ollama from HTTPS site"),S.value=[]}}async function m(e,r,w){var o;const k=r==="latest"?e:`${e}:${r}`;if(!T.value.has(k)){T.value.add(k),y.value[k]={percent:0,status:"active",message:"Starting download..."};try{const M=await de("/api/pull",{method:"POST",body:JSON.stringify({name:k,stream:!0})});if(!M.ok)throw new Error(`Failed to pull model: ${M.statusText}`);const U=(o=M.body)==null?void 0:o.getReader();if(!U)throw new Error("Unable to read response stream");let E=0,Y=0;for(;;){const{done:X,value:ee}=await U.read();if(X)break;const ae=new TextDecoder().decode(ee).split(`
`).filter(R=>R.trim());for(const R of ae)try{const g=JSON.parse(R);g.total&&(E=g.total),g.completed&&(Y=g.completed);const c=E>0?Math.round(Y/E*100):0;if(y.value[k]={status:g.status==="success"?"success":"active",percent:c,message:g.status||"Downloading..."},g.status==="success"){ne.success(`Successfully pulled ${k}`),await F(),w==null||w(),setTimeout(()=>{delete y.value[k]},3e3);return}}catch{}}}catch(M){const U=M;let E=M instanceof Error?M.message:"Unknown error";U.type==="cors"&&U.isHttps&&(E="Cannot access Ollama from HTTPS site. Please use the desktop app or run locally."),ne.error(`Failed to pull ${k}: ${E}`),y.value[k]={status:"exception",percent:0,message:"Download failed"},setTimeout(()=>{delete y.value[k]},5e3)}finally{T.value.delete(k)}}}function d(e){const r=parseFloat(e.replace(/[^\d.]/g,""))||0,w=e.replace(/[\d.]/g,"").trim().toUpperCase();return w.includes("MB")?r/1e3:w.includes("TB")?r*1e3:(w.includes("GB"),r)}function f(e){return/-q\d{1,2}_|-fp\d+/.test(e)}function H(e){return S.value.some(r=>r.startsWith(e))}function q(e){return S.value.includes(e)}function i(e){return S.value.filter(r=>r.startsWith(e+":"))}function n(e){return e<1?`${Math.round(e*1e3)}MB`:`${e.toFixed(1)}GB`}function l(e){const r=d(e);return r<5?"size-small":r<20?"size-medium":"size-large"}function P(e){if(!e.tags)return"N/A";const r=Object.values(e.tags).map(o=>d(o.size||"0GB")).filter(o=>o>0);if(r.length===0)return"N/A";const w=Math.min(...r),k=Math.max(...r);return w===k?n(w):`${n(w)} - ${n(k)}`}function t(e){if(!e.tags||!e.tags.latest)return null;const r=e.tags.latest,w=Object.entries(e.tags).find(([k,o])=>k!=="latest"&&o.modelHash===r.modelHash);return w?{actualTag:w[0],size:w[1].size||r.size}:{actualTag:"",size:r.size}}return{modelsData:G,loading:s,error:$,pullingModels:T,pullProgress:y,installedModels:S,fetchModels:B,fetchInstalledModels:F,pullModel:m,parseSizeToGB:d,isQuantizedTag:f,isModelInstalled:H,isTagInstalled:q,getInstalledTagsForModel:i,formatSizeGB:n,getSizeClass:l,getModelSizeRange:P,getLatestTagInfo:t}}const Tt={class:"modal-content"},St={class:"stats-bar"},Bt={class:"view-controls"},Ot={key:0,class:"loading-text"},xt={class:"models-container"},Gt=K({__name:"OllamaModelLibraryModalV3",props:{modelValue:{type:Boolean}},emits:["update:modelValue","models-updated"],setup(G,{emit:s}){const $=G,T=s,{modelsData:y,loading:S,error:B,pullingModels:F,pullProgress:m,installedModels:d,fetchModels:f,pullModel:H,parseSizeToGB:q,isQuantizedTag:i,getSizeClass:n,getModelSizeRange:l,getLatestTagInfo:P}=Ct(),t=V(""),e=V("popularity"),r=V([]),w=V(8),k=V(!1),o=V("card"),M=V(new Set),U=Q({get:()=>$.modelValue,set:g=>T("update:modelValue",g)}),E=Q(()=>{var g;return((g=y.value)==null?void 0:g.totalModels)||0}),Y=Q(()=>{var g;return((g=y.value)==null?void 0:g.categories)||[]}),X=Q(()=>{if(!y.value)return[];let g=Object.entries(y.value.models).map(([c,I])=>({...I,name:c}));if(t.value){const c=t.value.toLowerCase();g=g.filter(I=>I.name.toLowerCase().includes(c)||I.description.toLowerCase().includes(c))}switch(r.value.length>0&&(g=g.filter(c=>r.value.some(I=>(c.categories||[]).includes(I)))),w.value<999&&(g=g.filter(c=>c.tags?Object.values(c.tags).some(I=>q(I.size||"0GB")<=w.value):!0)),e.value){case"popularity":g.sort((c,I)=>{const j=c.pullCount||"0",N=I.pullCount||"0",se=parseFloat(j.replace(/[^\d.]/g,""))||0,le=parseFloat(N.replace(/[^\d.]/g,""))||0,L=j.includes("M")?1e6:j.includes("K")?1e3:1,ie=N.includes("M")?1e6:N.includes("K")?1e3:1;return le*ie-se*L});break;case"lastUpdated":g.sort((c,I)=>{const j=c.lastUpdated?new Date(c.lastUpdated).getTime():0;return(I.lastUpdated?new Date(I.lastUpdated).getTime():0)-j});break;case"name":g.sort((c,I)=>c.name.localeCompare(I.name));break;case"tagCount":g.sort((c,I)=>(I.tagCount||0)-(c.tagCount||0));break}return g});function ee(g){const c=r.value.indexOf(g);c===-1?r.value.push(g):r.value.splice(c,1)}function te(g){M.value.has(g)?M.value.delete(g):M.value.add(g)}function ae(g,c){g?M.value.add(c.name):M.value.delete(c.name)}async function R(g,c){await H(g,c,()=>T("models-updated"))}return ye(U,g=>{g&&!y.value&&f(),g||(M.value.clear(),t.value="",r.value=[],w.value=8,k.value=!1,B.value="")}),(g,c)=>{const I=O("a-button"),j=O("a-button-group"),N=O("a-spin"),se=O("a-alert"),le=O("a-modal");return a(),x(le,{open:U.value,"onUpdate:open":c[7]||(c[7]=L=>U.value=L),title:"Ollama Model Library",width:"95vw",footer:null,destroyOnClose:!0,"wrap-class-name":"ollama-library-modal-full",class:"ollama-library-modal"},{default:v(()=>[z("div",Tt,[_(Ve,{"search-query":t.value,"onUpdate:searchQuery":c[0]||(c[0]=L=>t.value=L),"sort-by":e.value,"onUpdate:sortBy":c[1]||(c[1]=L=>e.value=L),"max-size-g-b":w.value,"onUpdate:maxSizeGB":c[2]||(c[2]=L=>w.value=L),"show-quantized":k.value,"onUpdate:showQuantized":c[3]||(c[3]=L=>k.value=L),"selected-categories":r.value,categories:Y.value,onToggleCategory:ee},null,8,["search-query","sort-by","max-size-g-b","show-quantized","selected-categories","categories"]),z("div",St,[z("span",null,"Showing "+p(X.value.length)+" of "+p(E.value)+" models",1),z("div",Bt,[_(j,{size:"small"},{default:v(()=>[_(I,{type:o.value==="card"?"primary":"default",onClick:c[4]||(c[4]=L=>o.value="card"),icon:ue(h(oe)),title:"Card View"},null,8,["type","icon"]),_(I,{type:o.value==="list"?"primary":"default",onClick:c[5]||(c[5]=L=>o.value="list"),icon:ue(h(Me)),title:"List View"},null,8,["type","icon"])]),_:1}),h(S)?(a(),u("span",Ot,"Loading...")):b("",!0)])]),_(Ae,{"pull-progress":h(m)},null,8,["pull-progress"]),z("div",xt,[_(N,{spinning:h(S),size:"large"},{default:v(()=>[o.value==="card"?(a(!0),u(D,{key:0},W(X.value,L=>(a(),x(ut,{key:L.name,model:L,expanded:M.value.has(L.name),"pulling-models":h(F),"pull-progress":h(m),"installed-models":h(d),"max-size-g-b":w.value,"show-quantized":k.value,"is-quantized-tag":h(i),"parse-size-to-g-b":h(q),"get-size-class":h(n),"get-latest-tag-info":h(P),onToggleExpand:ie=>te(L.name),onPullModel:R},null,8,["model","expanded","pulling-models","pull-progress","installed-models","max-size-g-b","show-quantized","is-quantized-tag","parse-size-to-g-b","get-size-class","get-latest-tag-info","onToggleExpand"]))),128)):b("",!0),o.value==="list"?(a(),x(Mt,{key:1,models:X.value,"expanded-models":Array.from(M.value),"pulling-models":h(F),"pull-progress":h(m),"installed-models":h(d),"max-size-g-b":w.value,"show-quantized":k.value,"is-quantized-tag":h(i),"parse-size-to-g-b":h(q),"get-size-class":h(n),"get-latest-tag-info":h(P),"get-model-size-range":h(l),onToggleModel:te,onPullModel:R,onExpand:ae},null,8,["models","expanded-models","pulling-models","pull-progress","installed-models","max-size-g-b","show-quantized","is-quantized-tag","parse-size-to-g-b","get-size-class","get-latest-tag-info","get-model-size-range"])):b("",!0)]),_:1},8,["spinning"])]),h(B)?(a(),x(se,{key:0,type:"error",message:h(B),closable:"",onClose:c[6]||(c[6]=L=>B.value=""),class:"error-alert"},null,8,["message"])):b("",!0)])]),_:1},8,["open"])}}}),Pt=J(Gt,[["__scopeId","data-v-96287dbe"]]),It={class:"ollama-model-manager"},Ft={class:"action-bar"},Lt={class:"models-section"},Qt={key:0,class:"model-name"},Vt={key:1,class:"model-size"},Dt={key:2,class:"model-date"},Ht=K({__name:"OllamaModelManagerV3",setup(G){const s=V([]),$=V(!1),T=V(new Set),y=V(""),S=V(!1),B=[{title:"Model Name",key:"name",width:"40%"},{title:"Size",key:"size",width:"20%",align:"right"},{title:"Modified",key:"modified",width:"25%"},{title:"Actions",key:"actions",width:"15%",align:"center"}];async function F(){const i=await we();return!i.available&&i.error&&(i.error.type==="cors"&&i.error.isHttps?y.value=i.error.details||"Cannot connect to Ollama from HTTPS site":y.value=i.error.message),i.available}async function m(){try{const i=await $e();s.value=i.models||[]}catch(i){const n=i;n.type==="cors"&&n.isHttps?y.value=n.details||"Cannot access Ollama from HTTPS site":y.value=`Failed to fetch models: ${i instanceof Error?i.message:"Unknown error"}`,s.value=[]}}async function d(i){T.value.add(i),y.value="";try{await be(i),ne.success(`Successfully removed ${i}`),await f()}catch(n){const l=n;l.type==="cors"&&l.isHttps?y.value=l.details||"Cannot access Ollama from HTTPS site":y.value=`Failed to remove model: ${n instanceof Error?n.message:"Unknown error"}`}finally{T.value.delete(i)}}async function f(){$.value=!0,await m(),$.value=!1}function H(i){if(!i)return"0 B";const n=["B","KB","MB","GB","TB"],l=Math.floor(Math.log(i)/Math.log(1024));return`${(i/Math.pow(1024,l)).toFixed(1)} ${n[l]}`}function q(i){try{return new Date(i).toLocaleDateString()}catch{return"Unknown"}}return _e(async()=>{await F()?await f():y.value="Cannot connect to Ollama. Make sure Ollama is running on localhost:11434"}),(i,n)=>{const l=O("a-button"),P=O("a-tag"),t=O("a-popconfirm"),e=O("a-table"),r=O("a-empty"),w=O("a-alert");return a(),u("div",It,[z("div",Ft,[_(l,{type:"primary",onClick:n[0]||(n[0]=k=>S.value=!0)},{icon:v(()=>[_(h(ze))]),default:v(()=>[n[3]||(n[3]=C(" Download Ollama Models "))]),_:1,__:[3]}),_(l,{onClick:f,loading:$.value},{icon:v(()=>[_(h(he))]),default:v(()=>[n[4]||(n[4]=C(" Refresh "))]),_:1,__:[4]},8,["loading"])]),z("div",Lt,[n[7]||(n[7]=z("h4",{class:"section-title"},"Installed Models",-1)),_(e,{columns:B,"data-source":s.value,pagination:!1,size:"small",loading:$.value,"row-key":"name",class:"models-table"},{bodyCell:v(({column:k,record:o})=>{var M;return[k.key==="name"?(a(),u("div",Qt,[z("code",null,p(o.name),1),(M=o.details)!=null&&M.family?(a(),x(P,{key:0,size:"small",color:"blue"},{default:v(()=>[C(p(o.details.family),1)]),_:2},1024)):b("",!0)])):b("",!0),k.key==="size"?(a(),u("span",Vt,p(H(o.size)),1)):b("",!0),k.key==="modified"?(a(),u("span",Dt,p(q(o.modified_at)),1)):b("",!0),k.key==="actions"?(a(),x(t,{key:3,title:"Are you sure you want to delete this model?",description:`This will permanently remove ${o.name} from your system.`,"ok-text":"Delete","cancel-text":"Cancel",onConfirm:U=>d(o.name)},{default:v(()=>[_(l,{type:"text",danger:"",size:"small",loading:T.value.has(o.name)},{icon:v(()=>[_(h(ke))]),default:v(()=>[n[5]||(n[5]=C(" Remove "))]),_:2,__:[5]},1032,["loading"])]),_:2},1032,["description","onConfirm"])):b("",!0)]}),_:1},8,["data-source","loading"]),!$.value&&s.value.length===0?(a(),x(r,{key:0,description:"No Ollama models installed",class:"empty-state"},{image:v(()=>n[6]||(n[6]=[z("div",{class:"empty-icon"},"ðŸ“¦",-1)])),_:1})):b("",!0)]),y.value?(a(),x(w,{key:0,type:"error",message:y.value,closable:"",onClose:n[1]||(n[1]=k=>y.value=""),class:"error-alert"},null,8,["message"])):b("",!0),_(Pt,{modelValue:S.value,"onUpdate:modelValue":n[2]||(n[2]=k=>S.value=k),onModelsUpdated:f},null,8,["modelValue"])])}}}),At=J(Ht,[["__scopeId","data-v-9a88ecb1"]]);export{At as O};
