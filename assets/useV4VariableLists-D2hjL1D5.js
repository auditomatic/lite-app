import{a as b,l as V,d as w}from"./index-B2WA5V93.js";import{u as B}from"./useV4LiveQuery-CfOiSnL_.js";import{b as I,c as r}from"./vue-vendor-BZxY9vkr.js";const E="v4-data-updates";let d=null;function v(){return d||(d=new BroadcastChannel(E),b.info("V4 Cross-tab communication initialized")),d}function x(a,o){try{const s=v(),i={type:"data-changed",table:a,operation:o,timestamp:Date.now()};s.postMessage(i),b.info("V4 Cross-tab broadcast sent:",i)}catch(s){b.warn("V4 Cross-tab broadcast failed:",s)}}function P(a){const o=v(),s=i=>{b.info("V4 Cross-tab message received:",i.data),a(i.data)};return o.addEventListener("message",s),I(()=>{o.removeEventListener("message",s)}),{channel:o,cleanup:()=>o.removeEventListener("message",s)}}function A(){const{data:a,loading:o,error:s}=B(()=>V(()=>w.variableLists.orderBy("updated").reverse().toArray()),e=>Object.freeze(e.map(t=>Object.freeze(t))),{initialValue:[]});P(e=>{e.table==="variableLists"&&b.info("V4 Cross-tab update received for variableLists:",e.operation)});const i=r(()=>a.value),y=r(()=>Object.freeze(a.value.filter(e=>e.category==="simple"))),L=r(()=>Object.freeze(a.value.filter(e=>e.category==="attributed"))),C=r(()=>Object.freeze(a.value.filter(e=>e.category==="refusal"))),p=r(()=>Object.freeze(a.value.filter(e=>e.category==="tabular")));function z(e){return r(()=>{const t=a.value.find(n=>n.id===e);return t?Object.freeze(t):null})}function h(e){return r(()=>Object.freeze(a.value.filter(t=>t.category===e)))}function j(e){return r(()=>{if(!e.trim())return a.value;const t=e.toLowerCase(),n=a.value.filter(c=>{var f;return c.name.toLowerCase().includes(t)||((f=c.description)==null?void 0:f.toLowerCase().includes(t))||c.category.toLowerCase().includes(t)});return Object.freeze(n)})}const O=r(()=>{const e=a.value,t=e.length;if(t===0)return Object.freeze({total:0,byCategory:{simple:0,attributed:0,refusal:0,tabular:0},totalItems:0,avgItemsPerList:0,mostPopularCategory:null});const n=e.reduce((l,u)=>(l[u.category]=(l[u.category]||0)+1,l),{}),c={simple:n.simple||0,attributed:n.attributed||0,refusal:n.refusal||0,tabular:n.tabular||0},f=e.reduce((l,u)=>l+(u.itemCount||0),0);let m=null,g=0;for(const[l,u]of Object.entries(c))u>g&&(g=u,m=l);return Object.freeze({total:t,byCategory:Object.freeze(c),totalItems:f,avgItemsPerList:t>0?Math.round(f/t):0,mostPopularCategory:m})});return{variableLists:i,simpleLists:y,attributedLists:L,refusalLists:C,tabularLists:p,loading:r(()=>o.value),error:r(()=>s.value),getListById:z,getListsByCategory:h,searchLists:j,stats:O}}export{A as a,x as b,P as u};
