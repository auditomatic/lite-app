import{d as e,i as t,Y as a,r as l,b as s,e as i,f as n,g as r,F as o,D as u,t as c,m as d,V as v,W as m,w as b,B as p,Z as y,I as f,O as g,o as k,X as h,p as _}from"./vendor-DdqHZeTC.js";import{u as C}from"./variableLists-DHcTMwnX.js";import{s as w}from"./safeJson-BfKuju6h.js";import{_ as V}from"./index-Bz5Ugese.js";import"./db-ftwlfnxb.js";const I={class:"attributed-values-editor"},S={class:"editor-header"},L={class:"attribute-columns"},x={class:"add-row"},U=["onUpdate:modelValue","placeholder"],A={class:"bulk-import"},E={key:0,class:"items-list"},D={class:"item-value"},K=["onClick"],N={key:1,class:"no-items"},O={class:"modal-content"},j={class:"modal-header"},$={class:"modal-body"},J={class:"modal-footer"},F=V(e({__name:"AttributedValuesEditor",props:{attributeKeys:{},modelValue:{}},emits:["update:modelValue"],setup(e,{emit:p}){const y=e,f=p,g=t({get:()=>y.modelValue,set:e=>f("update:modelValue",e)}),k=a({value:"",attributes:{}}),h=l(!1),_=l("");function C(){if(!k.value.trim())return;const e={value:k.value.trim(),attributes:{...k.attributes}};g.value=[...g.value,e],k.value="",y.attributeKeys.forEach(e=>{k.attributes[e]=""})}function V(){const e=_.value.trim();if(e)try{if(e.startsWith("[")||e.startsWith("{")){const t=w(e);if(null===t)throw new SyntaxError("Invalid JSON format in imported data");const a=(Array.isArray(t)?t:[t]).map(e=>({value:String(e.value||e.name||""),attributes:y.attributeKeys.reduce((t,a)=>(t[a]=String(e[a]||e.attributes?.[a]||""),t),{})})).filter(e=>e.value);g.value=[...g.value,...a]}else{const t=e.split("\n").map(e=>e.trim()).filter(Boolean);if(t.length<2)return;const a=t[0].split(",").map(e=>e.trim()),l=a.findIndex(e=>"value"===e.toLowerCase()||"name"===e.toLowerCase());if(-1===l)return void alert('CSV must have a "value" or "name" column');const s=t.slice(1).map(e=>{const t=e.split(",").map(e=>e.trim()),s={value:t[l]||"",attributes:{}};return y.attributeKeys.forEach(e=>{const l=a.findIndex(t=>t===e);-1!==l&&(s.attributes[e]=t[l]||"")}),s}).filter(e=>e.value);g.value=[...g.value,...s]}_.value="",h.value=!1}catch(t){alert("Failed to parse import data. Please check the format.")}}return y.attributeKeys.forEach(e=>{k.attributes[e]=""}),(e,t)=>(i(),s("div",I,[n("div",S,[t[8]||(t[8]=n("h4",null,"Add Values with Attributes",-1)),n("div",L,[t[6]||(t[6]=n("span",null,"Value",-1)),(i(!0),s(o,null,u(e.attributeKeys,e=>(i(),s("span",{key:e},c(e),1))),128)),t[7]||(t[7]=n("span",null,null,-1))])]),n("div",x,[d(n("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>k.value=e),placeholder:"Enter value",class:"form-control",onKeyup:m(C,["enter"])},null,544),[[v,k.value]]),(i(!0),s(o,null,u(e.attributeKeys,e=>d((i(),s("input",{key:e,"onUpdate:modelValue":t=>k.attributes[e]=t,placeholder:e,class:"form-control",onKeyup:m(C,["enter"])},null,40,U)),[[v,k.attributes[e]]])),128)),n("button",{class:"btn btn-primary",onClick:C}," Add ")]),n("div",A,[n("button",{class:"btn btn-secondary",onClick:t[1]||(t[1]=e=>h.value=!0)}," Import CSV/JSON ")]),g.value.length>0?(i(),s("div",E,[(i(!0),s(o,null,u(g.value,(t,a)=>(i(),s("div",{key:a,class:"item-row"},[n("span",D,c(t.value),1),(i(!0),s(o,null,u(e.attributeKeys,e=>(i(),s("span",{key:e,class:"item-attribute"},c(t.attributes[e]||"-"),1))),128)),n("button",{class:"remove-btn",onClick:e=>function(e){g.value=g.value.filter((t,a)=>a!==e)}(a)}," × ",8,K)]))),128))])):(i(),s("div",N," No items added yet. Add values with their attributes above. ")),h.value?(i(),s("div",{key:2,class:"modal-overlay",onClick:t[5]||(t[5]=b(e=>h.value=!1,["self"]))},[n("div",O,[n("div",j,[t[9]||(t[9]=n("h4",null,"Import Items",-1)),n("button",{class:"close-btn",onClick:t[2]||(t[2]=e=>h.value=!1)}," × ")]),n("div",$,[n("p",null,"Paste CSV or JSON data. For CSV, first row should be headers: value,"+c(e.attributeKeys.join(",")),1),d(n("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>_.value=e),class:"form-control",rows:"15",placeholder:'CSV Example:\nvalue,race_signal,gender_signal\nJohn Smith,White,Male\nMaria Garcia,Hispanic,Female\n\nJSON Example:\n[\n  { "value": "John Smith", "race_signal": "White", "gender_signal": "Male" },\n  { "value": "Maria Garcia", "race_signal": "Hispanic", "gender_signal": "Female" }\n]'},null,512),[[v,_.value]])]),n("div",J,[n("button",{class:"btn btn-secondary",onClick:t[4]||(t[4]=e=>h.value=!1)}," Cancel "),n("button",{class:"btn btn-primary",onClick:V}," Import ")])])])):r("",!0)]))}}),[["__scopeId","data-v-73025a80"]]),M={class:"modal-content"},P={class:"modal-header"},T={class:"modal-body"},W={class:"form-group"},R={class:"form-group"},B={class:"form-group"},G={class:"category-radio-group"},H={class:"radio-label"},Z={class:"radio-label"},q={key:0,class:"form-group"},z={class:"attribute-keys-editor"},X={class:"attribute-input-group"},Y={key:0,class:"attribute-keys-list"},Q=["onClick"],ee={key:1,class:"no-values"},te={class:"form-group"},ae={key:0,class:"values-editor"},le={class:"value-input-group"},se={class:"paste-section"},ie={key:0,class:"values-list"},ne=["onClick"],re={key:1,class:"no-values"},oe={key:2,class:"no-values"},ue={class:"modal-footer"},ce=["disabled"],de={class:"modal-content paste-modal"},ve={class:"modal-header"},me={class:"modal-body"},be={class:"modal-footer"},pe=V(e({__name:"VariableListEditorModal",props:{list:{}},emits:["close","save"],setup(e,{emit:k}){const h=e,_=k,C=a({name:"",description:"",values:[],category:"general",attribute_keys:[],attributedItems:[]}),w=l(""),V=l(!1),I=l(""),S=l("");p(()=>h.list,e=>{e?(C.name=e.name,C.description=e.description||"",C.values=[...e.values],C.category=e.category||"general",C.attribute_keys=e.attribute_keys?[...e.attribute_keys]:[],"attributed"===e.category&&e.attributed_items?C.attributedItems=e.attributed_items.map(e=>({value:e.value,attributes:{...e.attributes}})):C.attributedItems=[]):(C.name="",C.description="",C.values=[],C.category="general",C.attribute_keys=[],C.attributedItems=[])},{immediate:!0});const L=t(()=>!!C.name.trim()&&("general"===C.category?C.values.length>0:C.attribute_keys.length>0&&C.attributedItems.length>0));function x(){const e=w.value.trim();e&&!C.values.includes(e)&&(C.values.push(e),w.value="")}function U(){const e=I.value.trim();if(!e)return;const t=e.split(/[\n,\t]+/).map(e=>e.trim()).filter(e=>e&&!C.values.includes(e));C.values.push(...t),I.value="",V.value=!1}function A(){const e=S.value.trim();e&&!C.attribute_keys.includes(e)&&(C.attribute_keys.push(e),S.value="")}function E(){if(!L.value)return;const e={name:C.name.trim(),description:C.description.trim(),values:"general"===C.category?[...C.values]:[],category:C.category};"attributed"===C.category&&C.attribute_keys.length>0&&(e.attribute_keys=[...C.attribute_keys],e.attributed_items=C.attributedItems.map(e=>({value:e.value,attributes:{...e.attributes}}))),_("save",e)}return(e,t)=>(i(),s("div",{class:"modal-overlay",onClick:t[14]||(t[14]=b(t=>e.$emit("close"),["self"]))},[n("div",M,[n("div",P,[n("h3",null,c(e.list?"Edit":"Create")+" Variable List",1),n("button",{class:"close-btn",onClick:t[0]||(t[0]=t=>e.$emit("close"))}," × ")]),n("div",T,[n("div",W,[t[15]||(t[15]=n("label",{for:"list-name"},"Name",-1)),d(n("input",{id:"list-name","onUpdate:modelValue":t[1]||(t[1]=e=>C.name=e),type:"text",class:"form-control",placeholder:"Enter list name",required:""},null,512),[[v,C.name]])]),n("div",R,[t[16]||(t[16]=n("label",{for:"list-description"},"Description",-1)),d(n("textarea",{id:"list-description","onUpdate:modelValue":t[2]||(t[2]=e=>C.description=e),class:"form-control",rows:"3",placeholder:"Optional description"},null,512),[[v,C.description]])]),n("div",B,[t[21]||(t[21]=n("label",null,"Category",-1)),n("div",G,[n("label",H,[d(n("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>C.category=e),type:"radio",value:"general"},null,512),[[y,C.category]]),t[17]||(t[17]=n("span",null,"General",-1)),t[18]||(t[18]=n("small",null,"Simple list of values",-1))]),n("label",Z,[d(n("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>C.category=e),type:"radio",value:"attributed"},null,512),[[y,C.category]]),t[19]||(t[19]=n("span",null,"Attributed",-1)),t[20]||(t[20]=n("small",null,"Values with associated attributes (e.g., demographics)",-1))])])]),"attributed"===C.category?(i(),s("div",q,[t[22]||(t[22]=n("label",null,"Attribute Keys",-1)),n("div",z,[n("div",X,[d(n("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>S.value=e),type:"text",class:"form-control",placeholder:"e.g., race_signal, gender_signal",onKeyup:m(A,["enter"])},null,544),[[v,S.value]]),n("button",{class:"btn btn-primary",onClick:A}," Add ")]),C.attribute_keys.length>0?(i(),s("div",Y,[(i(!0),s(o,null,u(C.attribute_keys,(e,t)=>(i(),s("div",{key:t,class:"attribute-key-item"},[n("span",null,c(e),1),n("button",{class:"remove-btn",onClick:e=>function(e){C.attribute_keys.splice(e,1)}(t)}," × ",8,Q)]))),128))])):(i(),s("div",ee," No attribute keys defined yet "))])])):r("",!0),n("div",te,[t[23]||(t[23]=n("label",null,"Values",-1)),"general"===C.category?(i(),s("div",ae,[n("div",le,[d(n("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>w.value=e),type:"text",class:"form-control",placeholder:"Add a value",onKeyup:m(x,["enter"])},null,544),[[v,w.value]]),n("button",{class:"btn btn-primary",onClick:x}," Add ")]),n("div",se,[n("button",{class:"btn btn-secondary",onClick:t[7]||(t[7]=e=>V.value=!0)}," Paste Multiple Values ")]),C.values.length>0?(i(),s("div",ie,[(i(!0),s(o,null,u(C.values,(e,t)=>(i(),s("div",{key:t,class:"value-item"},[n("span",null,c(e),1),n("button",{class:"remove-btn",onClick:e=>function(e){C.values.splice(e,1)}(t)}," × ",8,ne)]))),128))])):(i(),s("div",re," No values added yet "))])):"attributed"===C.category&&C.attribute_keys.length>0?(i(),f(F,{key:1,modelValue:C.attributedItems,"onUpdate:modelValue":t[8]||(t[8]=e=>C.attributedItems=e),"attribute-keys":C.attribute_keys,style:g({"--attr-count":C.attribute_keys.length})},null,8,["modelValue","attribute-keys","style"])):"attributed"===C.category?(i(),s("div",oe," Please define attribute keys first ")):r("",!0)])]),n("div",ue,[n("button",{class:"btn btn-secondary",onClick:t[9]||(t[9]=t=>e.$emit("close"))}," Cancel "),n("button",{class:"btn btn-primary",disabled:!L.value,onClick:E},c(e.list?"Update":"Create"),9,ce)])]),V.value?(i(),s("div",{key:0,class:"modal-overlay",onClick:t[13]||(t[13]=b(e=>V.value=!1,["self"]))},[n("div",de,[n("div",ve,[t[24]||(t[24]=n("h4",null,"Paste Multiple Values",-1)),n("button",{class:"close-btn",onClick:t[10]||(t[10]=e=>V.value=!1)}," × ")]),n("div",me,[t[25]||(t[25]=n("p",null,"Paste values separated by newlines, commas, or tabs:",-1)),d(n("textarea",{"onUpdate:modelValue":t[11]||(t[11]=e=>I.value=e),class:"form-control",rows:"10",placeholder:"value1\nvalue2\nvalue3"},null,512),[[v,I.value]])]),n("div",be,[n("button",{class:"btn btn-secondary",onClick:t[12]||(t[12]=e=>V.value=!1)}," Cancel "),n("button",{class:"btn btn-primary",onClick:U}," Add Values ")])])])):r("",!0)]))}}),[["__scopeId","data-v-248929cd"]]),ye={class:"variables-view"},fe={class:"page-header"},ge={class:"header-actions"},ke={key:0,class:"empty-state"},he={key:1,class:"lists-container"},_e={class:"sort-controls"},Ce={class:"lists-table"},we={class:"list-main"},Ve={class:"list-info"},Ie={class:"list-header"},Se={class:"list-name"},Le={class:"list-category"},xe={class:"list-meta"},Ue={key:0},Ae={key:1,class:"list-description"},Ee={class:"list-actions"},De=["onClick"],Ke=["onClick"],Ne=["onClick"],Oe=["onClick"],je=V(e({__name:"VariablesView",setup(e){const a=C(),v=l([]),m=l(!1),b=l(null),p=l("updated_at"),y=l("desc"),g=t(()=>[...v.value].sort((e,t)=>{let a,l;switch(p.value){case"name":a=e.name.toLowerCase(),l=t.name.toLowerCase();break;case"created_at":a=new Date(e.created_at||0).getTime(),l=new Date(t.created_at||0).getTime();break;case"updated_at":a=new Date(e.updated_at||e.created_at||0).getTime(),l=new Date(t.updated_at||t.created_at||0).getTime();break;case"items_count":a=e.values?.length||0,l=t.values?.length||0;break;default:return 0}return a<l?"asc"===y.value?-1:1:a>l?"asc"===y.value?1:-1:0}));async function V(){v.value=await a.loadVariableLists()}async function I(e){if("attributed"===e.category){const{attributedItems:t,...l}=e,s={...l,values:t?.map(e=>e.value)||[]};b.value?.id?await a.updateList(b.value.id,s):await a.createList(s)}else b.value?.id?await a.updateList(b.value.id,e):await a.createList(e);await V(),S()}function S(){m.value=!1,b.value=null}function L(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{const t=e.target.files?.[0];if(t)try{const e=await t.text(),s=w(e);if(null===s)throw new SyntaxError("Invalid JSON format in imported file");let i=[];if(Array.isArray(s))i=s;else{if(!s.name||!s.items)throw new Error("Invalid file format - expected variable list(s)");i=[s]}const n=i.length,r=`Import ${n} variable list${n>1?"s":""}? This will not affect existing lists.`;if(!confirm(r))return;let o=0;for(const t of i)try{const{id:e,created_at:l,updated_at:s,items:i,...n}=t,r=(i?.map(e=>{const{id:t,list_id:a,created_at:l,...s}=e;return{value:s.value,attributes_json:s.attributes_json||s.attributes||{}}})||[]).map(e=>e.value);await a.createList({...n,values:r,category:n.category||"general"}),o++}catch(l){console.error("Failed to import list:",t.name,l)}await V(),o>0&&alert(`Successfully imported ${o} variable list${o>1?"s":""}`)}catch(l){console.error("Import error:",l),alert("Failed to import variable lists. Please check the file format.")}},e.click()}function x(){}function U(){y.value="asc"===y.value?"desc":"asc"}function A(e){return e?new Date(e).toLocaleDateString():"N/A"}return k(async()=>{await V()}),(e,t)=>(i(),s("div",ye,[n("div",fe,[t[2]||(t[2]=n("h2",null,"Variable Lists",-1)),n("div",ge,[n("button",{class:"btn btn-secondary",onClick:L}," Import Lists "),n("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=e=>m.value=!0)}," New Variable List ")])]),0===v.value.length?(i(),s("div",ke,t[3]||(t[3]=[n("p",null,"No variable lists yet. Create reusable lists of values for your designs!",-1)]))):(i(),s("div",he,[n("div",_e,[t[5]||(t[5]=n("label",null,"Sort by:",-1)),d(n("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>p.value=e),onChange:x},t[4]||(t[4]=[n("option",{value:"updated_at"}," Last Edited ",-1),n("option",{value:"name"}," Name ",-1),n("option",{value:"created_at"}," Created Date ",-1),n("option",{value:"items_count"}," Item Count ",-1)]),544),[[h,p.value]]),n("button",{class:"sort-toggle",onClick:U},c("desc"===y.value?"↓":"↑"),1)]),n("div",Ce,[(i(!0),s(o,null,u(g.value,e=>(i(),s("div",{key:e.id,class:"list-row"},[n("div",we,[n("div",Ve,[n("div",Ie,[n("h3",Se,c(e.name),1),n("span",Le,c(e.category||"simple"),1)]),n("p",xe,[_(c(e.values?.length||0)+" items • Created "+c(A(e.created_at))+" ",1),e.updated_at&&e.updated_at!==e.created_at?(i(),s("span",Ue," • Updated "+c(A(e.updated_at)),1)):r("",!0),e.description?(i(),s("span",Ae," • "+c(e.description),1)):r("",!0)])]),n("div",Ee,[n("button",{class:"btn btn-secondary btn-small",onClick:t=>function(e){b.value=e}(e)}," Edit ",8,De),n("button",{class:"btn btn-secondary btn-small",onClick:t=>function(e){const t={...e,id:void 0,name:`${e.name} (Copy)`,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};b.value=t}(e)}," Copy ",8,Ke),n("button",{class:"btn btn-secondary btn-small",onClick:t=>function(e){const t={exported_at:(new Date).toISOString(),variable_list:e},a=JSON.stringify(t,null,2),l=new Blob([a],{type:"application/json"}),s=URL.createObjectURL(l),i=document.createElement("a");i.href=s,i.download=`variable_list_${e.name.replace(/[^a-zA-Z0-9]/g,"_")}_${(new Date).toISOString().split("T")[0]}.json`,i.click(),URL.revokeObjectURL(s)}(e)}," Export ",8,Ne),n("button",{class:"btn btn-danger btn-small",onClick:t=>async function(e){confirm("Are you sure you want to delete this variable list?")&&(await a.deleteList(e),await V())}(e.id)}," Delete ",8,Oe)])])]))),128))])])),m.value||b.value?(i(),f(pe,{key:2,list:b.value,onSave:I,onClose:S},null,8,["list"])):r("",!0)]))}}),[["__scopeId","data-v-bd76d325"]]);export{je as default};
