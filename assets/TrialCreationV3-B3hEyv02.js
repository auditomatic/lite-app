import{f as j,c as R,d as Y,o as ne,b as Ce,w as K,R as h,a0 as ae,_ as z,n as be,k as r,S as t,Z as k,U as y,q as he,a3 as ke,F as Q,W as X,Y as m,G as V,u as P,$ as J,r as $e,y as Te,e as we,z as Ie,p as Se,a1 as Pe,X as xe}from"./vue-vendor-C9mtdEbx.js";import{e as de,a as U,d as De,k as G,f as Me,c as Ee}from"./index-D335VTKO.js";import{u as Ve}from"./useV4Templates-D5A0L-hJ.js";import{u as me}from"./useV4VariableLists-BqEqZk9G.js";import{u as oe}from"./useV4Models-8nYyZjwR.js";import{u as ie,a as Ne}from"./useV4TrialCommands-DfeIhQHr.js";import{u as Ae}from"./execution-control-v4-ernfOr5a.js";import{n as Z,T as le,aG as ve,R as Le,Y as Oe,F as ce,a4 as fe,aH as pe,O as ze,P as ee,aI as Re,a7 as je,a2 as Be,a3 as Fe,G as Ue,aj as qe,H as He,q as Je,o as We,w as Ke,aJ as Ye,J as Ge,x as ge,ad as Ze,ag as _e,X as Qe,I as Xe,ao as et,$ as tt,Z as at,N as te}from"./ui-vendor-CYb6WBrN.js";import{G as st}from"./GenericModelSelectorModalV3-4MsnGxCH.js";import{u as re}from"./useCostEstimation-CWNhpoK8.js";import"./utils-vendor-CivCAYE9.js";import"./tauri-vendor-1uBLmS9u.js";import"./useV4LiveQuery-C9sjeLWI.js";import"./useV4CrossTab-BjHd-JkW.js";import"./useV4ProviderParameters-B-zjDfSb.js";function nt(q){const{templates:D}=Ve(),{variableLists:n}=me(),{enabledModels:I}=oe(),{runningTrials:d}=ie(),S=Ae(),{createTrial:g}=Ne(),c=j(null),v=j(""),C=j(""),$=j(1),x=j([]),B=j(!1),O=j(!1),A=R(()=>D.value||[]),f=R(()=>[]),o=R(()=>{if(!c.value)return 0;if(c.value.type==="template"){const i=c.value;if(!i.variables)return 1;let w=1;for(const[,E]of Object.entries(i.variables))if(E.type==="value"&&E.values)w*=E.values.length;else if(E.type==="list"&&E.listId){const H=n.value.find(W=>W.id===E.listId);H&&(H.category==="simple"?w*=H.values?.length||0:H.category==="attributed"?w*=H.items?.length||0:H.category==="tabular"&&(w*=H.itemCount||0))}return w}else return 0}),M=R(()=>o.value*x.value.length*$.value),L=R(()=>{let i=0;for(const w of x.value){const E=u(w);i+=E*o.value*$.value}return i}),F=R(()=>c.value!==null&&x.value.length>0&&v.value.trim()!=="");function T(i){c.value=i,v.value=N(i)}function N(i){const w=i||c.value;if(!w)return"New Trial";const E=new Date().toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return`${w.name} - ${E}`}function u(i){if(!c.value)return 0;const w=I.value.find(ue=>ue.provider===i.provider&&ue.modelId===i.modelId);if(!w?.capabilities)return 0;const E=e(),H=i.parameters?.max_tokens||i.parameters?.maxTokens||256,W=de(E,w.capabilities.inputCostPerToken)||0,ye=de(H,w.capabilities.outputCostPerToken)||0;return W+ye}function e(){return c.value&&c.value.type==="template"?150:100}function a(i){x.value.push(i)}function s(i){x.value.splice(i,1)}async function l(){if(F.value){B.value=!0;try{const i=JSON.parse(JSON.stringify(c.value)),w={name:v.value,description:"",type:i.type,configurations:JSON.parse(JSON.stringify(x.value)),repeatCount:$.value,templateConfig:i.type==="template"?{template:i.template,variables:i.variables,parserId:i.parserId,refusalWords:i.refusalWords,refusalMode:i.refusalMode,rejectRefusalWords:i.rejectRefusalWords}:void 0,spreadsheetConfig:i.type==="spreadsheet"?{promptPattern:i.promptPattern,datasetId:i.datasetId,parserId:i.parserId}:void 0},E=await g(w);if(E.ok)return E.value;throw E.error}finally{B.value=!1}}}async function _(){const i=await l();if(i)return d.value.length>0?{trialId:i,needsConfirmation:!0,runningTrial:d.value[0]}:await b(i)}async function b(i){U.info("V4: Creation view starting trial via V4 execution control",i);const w=await S.startTrialWithStreaming(i);if(w.ok){U.info("V4: Trial started successfully via V4 execution control");const E=w.value.progress$.subscribe({next:W=>{U.info("V4: Creation view received progress update:",W.type)},error:W=>{U.error("V4: Creation view stream error:",W)}}),H=w.value.calls$.subscribe({next:W=>{U.info("V4: Creation view received batch of",W.length,"calls")},error:W=>{U.error("V4: Creation view calls stream error:",W)}});return U.info("V4: Creation view subscribed to BOTH streams, execution started, navigating to trials view"),setTimeout(()=>{E.unsubscribe(),H.unsubscribe(),U.info("V4: Creation view unsubscribed from streams after navigation")},1e3),{trialId:i,needsConfirmation:!1}}else throw w.error}async function p(){try{await S.initialize(),U.info("V4: Execution control initialized in creation view")}catch(i){U.error("V4: Failed to initialize execution control in creation view:",i)}if(q.value.type==="duplicate"&&q.value.sourceTrialId){const i=await De.trials.get(q.value.sourceTrialId);if(i){if(v.value=`Copy of ${i.name}`,$.value=i.repeatCount||1,i.configurations&&(x.value=i.configurations.map(w=>({name:w.modelSnapshot?.displayName||w.modelId,provider:w.provider,modelId:w.modelId,parameters:w.parameters||{}}))),i.type==="template"&&i.templateConfig?.template){const w=A.value.find(E=>E.template===i.templateConfig?.template);w&&T(w)}else if(i.type==="spreadsheet"&&i.spreadsheetConfig?.datasetId){const w=f.value.find(E=>E.datasetId===i.spreadsheetConfig?.datasetId);w&&T(w)}}}}return{selectedPrompt:c,trialName:v,description:C,repeatCount:$,configurations:x,creating:B,showModelSelector:O,templates:A,spreadsheets:f,variableLists:n,enabledModels:I,runningTrials:d,totalCombinations:o,totalExperiments:M,totalCost:L,canProceed:F,selectPrompt:T,generateTrialName:N,addConfiguration:a,removeConfiguration:s,getConfigCostPerCall:u,createTrialAsDraft:l,createAndStartTrial:_,initialize:p}}const ot={key:0,class:"preview-controls"},it={class:"template-name"},lt={key:0,class:"cycle-info"},rt={key:1,class:"variable-legend"},ut={class:"variable-value"},dt=Y({__name:"TemplatePreviewV3",props:{template:{},variableLists:{default:()=>[]},cycling:{type:Boolean,default:!0},cyclingSpeed:{default:1e3},showControls:{type:Boolean,default:!1},displayMode:{default:"block"},showLegend:{type:Boolean,default:!1},maxLines:{default:0}},emits:["update:paused","back-to-select"],setup(q,{emit:D}){const n=q,I=D,d=j(0),S=j(!1);let g=null;const c=["variable-highlight-blue","variable-highlight-green","variable-highlight-purple","variable-highlight-orange","variable-highlight-pink","variable-highlight-teal"],v=R(()=>n.template.type==="template"?n.template.template:n.template.type==="spreadsheet"?n.template.promptPattern:""),C=R(()=>{if(n.template.type==="spreadsheet"){const a=n.template,s=n.variableLists.find(l=>l.id===a.datasetId);return s?.category==="tabular"&&s.tabularData?.rows?s.tabularData.rows.map(l=>{const _={};return Object.keys(l).forEach(b=>{let p=b.replace(/[^a-zA-Z0-9_]/g,"_");/^[a-zA-Z]/.test(p)||(p="col_"+p),p=p.replace(/_+/g,"_").replace(/_+$/,""),_[p]=String(l[b]||"")}),_}):[]}const T=[];if(n.template.variables){for(const[a,s]of Object.entries(n.template.variables))if(s.type==="value"&&s.values)T.push({name:a,values:[...s.values]});else if(s.type==="list"&&s.listId){const l=n.variableLists.find(_=>_.id===s.listId);l&&(l.category==="simple"&&l.values?T.push({name:a,values:[...l.values]}):l.category==="attributed"&&l.items&&T.push({name:a,values:l.items.map(_=>_.value)}))}}if(T.length===0)return[];const N=a=>a.reduce((s,l)=>s.flatMap(_=>l.map(b=>[..._,b])),[[]]),u=T.map(a=>a.values);return N(u).map(a=>{const s={};return T.forEach((l,_)=>{s[l.name]=a[_]}),s})}),$=R(()=>C.value.length),x=R(()=>C.value.length===0?null:C.value[d.value]||C.value[0]),B=R(()=>{const T=v.value;if(!T)return"";const N=x.value;if(!N||Object.keys(N).length===0)return f(T).replace(/\n/g,"<br>");let u=f(T);if(Object.keys(N).sort((a,s)=>s.length-a.length).forEach((a,s)=>{const l=N[a],_=f(l),b=A(s),p=new RegExp(`{{\\s*${o(a)}\\s*}}`,"g");u=u.replace(p,`<span class="${b} variable-value">${_}</span>`)}),u=u.replace(/\n/g,"<br>"),n.maxLines>0){const a=u.split("<br>");a.length>n.maxLines&&(u=a.slice(0,n.maxLines).join("<br>")+'<br><span class="line-clamp-indicator">...</span>')}return u}),O=R(()=>n.displayMode==="inline"&&n.maxLines>0?{display:"-webkit-box","-webkit-line-clamp":n.maxLines,"-webkit-box-orient":"vertical",overflow:"hidden"}:{});function A(T){return c[T%c.length]}function f(T){const N=document.createElement("div");return N.textContent=T,N.innerHTML}function o(T){return T.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function M(){S.value=!S.value,I("update:paused",S.value)}function L(){!n.cycling||S.value||$.value<=1||(g=setInterval(()=>{d.value=(d.value+1)%$.value},n.cyclingSpeed))}function F(){g&&(clearInterval(g),g=null)}return ne(()=>{n.cycling&&!S.value&&L()}),Ce(()=>{F()}),K(()=>S.value,T=>{T||!n.cycling?F():L()}),K(()=>n.cycling,T=>{T?S.value||L():(F(),d.value=0)}),K(()=>n.cyclingSpeed,()=>{n.cycling&&!S.value&&(F(),L())}),K($,()=>{d.value=0}),(T,N)=>{const u=Z,e=le,a=he("dompurify-html");return m(),h("div",{class:ae(["template-preview",[`preview-${T.displayMode}`,{"preview-cycling":T.cycling&&!S.value}]])},[T.showControls?(m(),h("div",ot,[r(u,{type:"link",onClick:N[0]||(N[0]=s=>T.$emit("back-to-select")),class:"back-to-select"},{default:k(()=>[r(P(ve)),N[1]||(N[1]=V(" Back to Select Template "))]),_:1,__:[1]}),t("h3",it,y(n.template.name),1),r(u,{onClick:M,size:"small",type:S.value?"default":"primary",disabled:!T.cycling||$.value<=1},{default:k(()=>[V(y(S.value?"Start":"Pause")+" Variable Selection ",1)]),_:1},8,["type","disabled"]),T.cycling&&$.value>1?(m(),h("span",lt,y(d.value+1)+" / "+y($.value),1)):z("",!0),r(e,{color:n.template.type==="template"?"blue":"green",class:"source-badge"},{default:k(()=>[V(y(n.template.type==="template"?"Prompt Design":"Spreadsheet Design"),1)]),_:1},8,["color"])])):z("",!0),be(t("div",{class:"preview-content",style:ke(O.value)},null,4),[[a,B.value,"template"]]),T.showLegend&&x.value&&Object.keys(x.value).length>0?(m(),h("div",rt,[(m(!0),h(Q,null,X(x.value,(s,l,_)=>(m(),h("div",{key:l,class:"legend-item"},[t("span",{class:ae(A(_))},y(l),3),t("span",ut,y(s),1)]))),128))])):z("",!0)],2)}}}),se=G(dt,[["__scopeId","data-v-499c064e"]]),ct={class:"design-selection"},pt={class:"design-selector","data-testid":"template-design-selector"},mt={class:"design-controls"},vt={key:0,class:"no-designs-state"},ft={class:"no-designs-content"},gt={key:1,class:"no-designs-state"},_t={class:"no-designs-content"},yt={key:2,class:"design-list","data-testid":"design-list"},Ct=["data-template-id","data-template-name","onClick"],bt={class:"design-header"},ht={class:"design-title-section"},kt={class:"design-name"},$t={key:0,class:"design-inline-description"},Tt={class:"design-date"},wt={class:"design-stats"},It={class:"stat-item"},St={class:"stat-value"},Pt={class:"stat-item"},xt={class:"stat-value"},Dt={class:"stat-item"},Mt={class:"stat-value"},Et={class:"design-selector","data-testid":"spreadsheet-design-selector"},Vt={key:0,class:"no-designs-state"},Nt={class:"no-designs-content"},At={key:1,class:"design-list","data-testid":"design-list"},Lt=["data-spreadsheet-id","data-spreadsheet-name","onClick"],Ot={class:"design-header"},zt={class:"design-title-section"},Rt={class:"design-name"},jt={key:0,class:"design-inline-description"},Bt={class:"design-date"},Ft={class:"design-stats"},Ut={class:"stat-item"},qt={class:"stat-value"},Ht={class:"stat-item"},Jt={class:"stat-value"},Wt={class:"stat-item"},Kt={class:"stat-value"},Yt=Y({__name:"TrialDesignSelectionV3",props:{templates:{},spreadsheets:{},variableLists:{}},emits:["select","create-template","create-spreadsheet"],setup(q){const D=Me(),n=q,I=j("template"),d=j(""),S=j(""),g=j(!0),c=R(()=>{if(!d.value)return n.templates;const f=d.value.toLowerCase();return n.templates.filter(o=>o.name.toLowerCase().includes(f)||(o.description||"").toLowerCase().includes(f))}),v=R(()=>{if(!S.value)return n.spreadsheets;const f=S.value.toLowerCase();return n.spreadsheets.filter(o=>o.name.toLowerCase().includes(f)||(o.description||"").toLowerCase().includes(f))});function C(f){const o=typeof f=="string"?new Date(f):f,L=new Date().getTime()-o.getTime(),F=Math.floor(L/(1e3*60*60*24));if(F===0){const T=Math.floor(L/36e5);if(T===0){const N=Math.floor(L/6e4);return N<=1?"just now":`${N} min ago`}return T===1?"1 hour ago":`${T} hours ago`}else return F===1?"yesterday":F<7?`${F} days ago`:o.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function $(f){return f.variables?Object.keys(f.variables).length:0}function x(f){if(!f.variables)return 1;let o=1;for(const[,M]of Object.entries(f.variables))if(M.type==="value"&&M.values)o*=M.values.length;else if(M.type==="list"&&M.listId){const L=n.variableLists.find(F=>F.id===M.listId);L&&(L.category==="simple"?o*=L.values?.length||0:L.category==="attributed"?o*=L.items?.length||0:L.category==="tabular"&&(o*=L.itemCount||0))}return o}function B(f){return n.variableLists.find(M=>M.id===f.datasetId)?.itemCount||0}function O(f){const o=n.variableLists.find(M=>M.id===f.datasetId);return o?.category==="tabular"&&o.tabularData?.columns?o.tabularData.columns.length:0}function A(f){if(!f)return"???";try{if("template"in f&&f.template)return`~${D.estimateTokens(f.template)}`;if("promptPattern"in f&&f.promptPattern)return`~${D.estimateTokens(f.promptPattern)}`}catch(o){U.warn("Failed to estimate tokens:",o)}return"???"}return(f,o)=>{const M=Z,L=fe,F=ze,T=le,N=Oe,u=Le;return m(),h("div",ct,[r(u,{activeKey:I.value,"onUpdate:activeKey":o[7]||(o[7]=e=>I.value=e),size:"large"},{default:k(()=>[r(N,{key:"template",tab:"Template Designs (one API call per combination)"},{default:k(()=>[t("div",pt,[t("div",mt,[r(M,{size:"large",onClick:o[0]||(o[0]=e=>g.value=!g.value),type:g.value?"default":"text"},{icon:k(()=>[r(P(ce))]),default:k(()=>[V(" "+y(g.value?"Hide":"Show")+" Template Prompts ",1)]),_:1},8,["type"]),r(L,{value:d.value,"onUpdate:value":o[1]||(o[1]=e=>d.value=e),placeholder:"Search template designs...",size:"large",class:"design-search","data-testid":"input-template-search",allowClear:""},{prefix:k(()=>[r(P(pe))]),_:1},8,["value"])]),!f.templates||f.templates.length===0?(m(),h("div",vt,[t("div",ft,[r(F,{size:"large",tip:"Loading templates..."})])])):c.value.length===0?(m(),h("div",gt,[t("div",_t,[o[9]||(o[9]=t("p",null,"No template designs found",-1)),r(M,{type:"primary",onClick:o[2]||(o[2]=e=>f.$emit("create-template"))},{default:k(()=>[r(P(ce)),o[8]||(o[8]=V(" Create Prompt Design "))]),_:1,__:[8]})])])):(m(),h("div",yt,[(m(!0),h(Q,null,X(c.value,e=>(m(),h("div",{key:e.id,class:"design-item","data-testid":"template-item","data-template-id":e.id,"data-template-name":e.name,onClick:a=>f.$emit("select",e)},[t("div",bt,[t("div",ht,[t("h4",kt,[V(y(e.name)+" ",1),e.description&&g.value?(m(),h("span",$t,"- "+y(e.description),1)):z("",!0)])]),t("span",Tt,y(C(e.updated)),1)]),g.value?(m(),J(se,{key:0,template:e,"variable-lists":f.variableLists,cycling:!0,"show-controls":!1,"display-mode":"inline","max-lines":7,class:"design-preview"},null,8,["template","variable-lists"])):z("",!0),t("div",wt,[r(T,{size:"small",color:"blue",class:"output-type-tag"},{default:k(()=>[V(y(e.outputType||"text"),1)]),_:2},1024),t("span",It,[t("span",St,y($(e)),1),o[10]||(o[10]=t("span",{class:"stat-label"},"vars",-1))]),o[13]||(o[13]=t("span",{class:"stat-divider"},"•",-1)),t("span",Pt,[t("span",xt,y(x(e)),1),o[11]||(o[11]=t("span",{class:"stat-label"},"combos",-1))]),o[14]||(o[14]=t("span",{class:"stat-divider"},"•",-1)),t("span",Dt,[t("span",Mt,y(A(e)),1),o[12]||(o[12]=t("span",{class:"stat-label"},"tokens",-1))])])],8,Ct))),128)),t("div",{class:"design-item design-item-create","data-testid":"btn-create-design",onClick:o[3]||(o[3]=e=>f.$emit("create-template"))},[r(P(ee),{style:{"font-size":"24px"}}),o[15]||(o[15]=t("span",null,"Create New Design",-1))])]))])]),_:1}),r(N,{key:"spreadsheet",tab:"Spreadsheet Designs (one API call per row)"},{default:k(()=>[t("div",Et,[r(L,{value:S.value,"onUpdate:value":o[4]||(o[4]=e=>S.value=e),placeholder:"Search spreadsheet designs...",size:"large",class:"design-search","data-testid":"input-spreadsheet-search",allowClear:""},{prefix:k(()=>[r(P(pe))]),_:1},8,["value"]),v.value.length===0?(m(),h("div",Vt,[t("div",Nt,[o[17]||(o[17]=t("p",null,"No spreadsheet designs found",-1)),r(M,{type:"primary",onClick:o[5]||(o[5]=e=>f.$emit("create-spreadsheet"))},{default:k(()=>[r(P(Re)),o[16]||(o[16]=V(" Create Spreadsheet Design "))]),_:1,__:[16]})])])):(m(),h("div",At,[(m(!0),h(Q,null,X(v.value,e=>(m(),h("div",{key:e.id,class:"design-item","data-testid":"spreadsheet-item","data-spreadsheet-id":e.id,"data-spreadsheet-name":e.name,onClick:a=>f.$emit("select",e)},[t("div",Ot,[t("div",zt,[t("h4",Rt,[V(y(e.name)+" ",1),e.description?(m(),h("span",jt,"- "+y(e.description),1)):z("",!0)])]),t("span",Bt,y(C(e.updated)),1)]),r(se,{template:e,"variable-lists":f.variableLists,cycling:!0,"show-controls":!1,"display-mode":"inline","max-lines":5,class:"design-preview"},null,8,["template","variable-lists"]),t("div",Ft,[r(T,{size:"small",color:"green",class:"output-type-tag"},{default:k(()=>[V(y(e.outputType||"text"),1)]),_:2},1024),t("span",Ut,[t("span",qt,y(B(e)),1),o[18]||(o[18]=t("span",{class:"stat-label"},"rows",-1))]),o[21]||(o[21]=t("span",{class:"stat-divider"},"•",-1)),t("span",Ht,[t("span",Jt,y(O(e)),1),o[19]||(o[19]=t("span",{class:"stat-label"},"cols",-1))]),o[22]||(o[22]=t("span",{class:"stat-divider"},"•",-1)),t("span",Wt,[t("span",Kt,y(A(e)),1),o[20]||(o[20]=t("span",{class:"stat-label"},"tokens",-1))])])],8,Lt))),128)),t("div",{class:"design-item design-item-create","data-testid":"btn-create-spreadsheet",onClick:o[6]||(o[6]=e=>f.$emit("create-spreadsheet"))},[r(P(ee),{style:{"font-size":"24px"}}),o[23]||(o[23]=t("span",null,"Create New Spreadsheet Design",-1))])]))])]),_:1})]),_:1},8,["activeKey"])])}}}),Gt=G(Yt,[["__scopeId","data-v-3aef0381"]]),Zt={class:"trial-metadata-form"},Qt=Y({__name:"TrialMetadataV3",props:{name:{},repeatCount:{default:1},description:{default:""},totalCombinations:{default:0}},emits:["update:name","update:repeatCount","update:description"],setup(q,{emit:D}){const n=q,I=D,d=$e({name:n.name,repeatCount:n.repeatCount,description:n.description||""}),S=R(()=>{if(n.totalCombinations>0&&d.repeatCount>1){const c=n.totalCombinations*d.repeatCount;return`Each prompt will be run ${d.repeatCount} times (${c} total calls)`}return"Number of times to run each prompt"});function g(){I("update:name",d.name),I("update:repeatCount",d.repeatCount),I("update:description",d.description)}return K(()=>n.name,c=>{d.name=c}),K(()=>n.repeatCount,c=>{d.repeatCount=c}),K(()=>n.description,c=>{d.description=c||""}),(c,v)=>{const C=fe,$=Ue,x=Fe,B=qe,O=Be,A=He,f=je;return m(),h("div",Zt,[r(f,{layout:"vertical",model:d},{default:k(()=>[r(O,{gutter:24},{default:k(()=>[r(x,{span:18},{default:k(()=>[r($,{label:"Trial Name",rules:[{required:!0,message:"Please enter a trial name"}]},{default:k(()=>[r(C,{value:d.name,"onUpdate:value":v[0]||(v[0]=o=>d.name=o),size:"large",placeholder:"e.g., GPT-4 Performance Test",onChange:g},null,8,["value"])]),_:1})]),_:1}),r(x,{span:6},{default:k(()=>[r($,{label:"Repeat Count",help:S.value},{default:k(()=>[r(B,{value:d.repeatCount,"onUpdate:value":v[1]||(v[1]=o=>d.repeatCount=o),min:1,max:100,size:"large",style:{width:"100%"},onChange:g},null,8,["value"])]),_:1},8,["help"])]),_:1})]),_:1}),r($,{label:"Description (Optional)"},{default:k(()=>[r(A,{value:d.description,"onUpdate:value":v[2]||(v[2]=o=>d.description=o),placeholder:"Add any notes about this trial...",rows:2,onChange:g},null,8,["value"])]),_:1})]),_:1},8,["model"])])}}}),Xt=G(Qt,[["__scopeId","data-v-b945eb57"]]),ea={class:"model-configuration"},ta={key:0,class:"quick-add-section"},aa={class:"quick-add-models"},sa={class:"provider-name"},na={class:"model-name"},oa={key:0,class:"param-info"},ia={class:"configuration-table"},la={class:"table-header"},ra={style:{display:"inline-flex","align-items":"center",gap:"0"}},ua={key:0,class:"model-name-cell"},da={class:"model-name"},ca={class:"model-id"},pa={key:1,class:"parameter-tags"},ma={key:2,class:"cost-cell"},va={class:"cost-value"},fa={key:0,class:"cost-summary"},ga={class:"cost-summary-item"},_a={class:"cost-summary-item"},ya={class:"total-cost"},Ca=Y({__name:"ModelConfigurationV3",props:{configurations:{},totalCombinations:{},repeatCount:{},tokenData:{}},emits:["add-configuration","remove-configuration"],setup(q,{emit:D}){const n=q,I=D,{models:d}=oe(),{trials:S}=ie(),{estimateTotalCost:g,multiplyEstimate:c}=re(),v=j(!1),C=R(()=>{const e=new Map;if(S.value&&S.value.length>0){const b=S.value.filter(p=>p.status!=="draft").slice(0,10);for(const p of b)if(p.configurations){for(const i of p.configurations){const w=JSON.stringify(i.parameters||{}),E=`${i.provider}-${i.modelId}-${w}`;if(e.has(E)||e.set(E,i),e.size>=15)break}if(e.size>=15)break}}const a=new Set(n.configurations.map(b=>{const p=JSON.stringify(b.parameters||{});return`${b.provider}-${b.modelId}-${p}`})),s=Array.from(e.values()).filter(b=>{const p=JSON.stringify(b.parameters||{}),i=`${b.provider}-${b.modelId}-${p}`;if(a.has(i))return!1;const w=d.value?.find(E=>E.provider===b.provider&&E.modelId===b.modelId);return!(!w||!w.enabled)}),l=[{provider:"openai-chat",modelId:"gpt-4o-mini",params:{temperature:0,max_completion_tokens:1e3}},{provider:"openai-chat",modelId:"gpt-4.1-nano",params:{temperature:0,max_completion_tokens:500}},{provider:"anthropic",modelId:"claude-3-5-haiku-latest",params:{temperature:0,max_tokens:1e3}},{provider:"openrouter",modelId:"meta-llama/llama-4-maverick",params:{temperature:.8,max_tokens:2e3,provider:{require_parameters:!0}}},{provider:"openrouter",modelId:"mistralai/mistral-nemo",params:{temperature:.7,max_tokens:1500,provider:{require_parameters:!0}}},{provider:"ollama-generate",modelId:"qwen2.5:0.5b",params:{temperature:0,num_predict:500,stream:!1}},{provider:"ollama-generate",modelId:"llama3.2:1b",params:{temperature:0,num_predict:1e3,stream:!1}}],_=[];for(const b of l){const p=JSON.stringify(b.params),i=`${b.provider}-${b.modelId}-${p}`;if(!a.has(i)&&!e.has(i)){const w=d.value?.find(E=>E.provider===b.provider&&E.modelId===b.modelId);w&&w.enabled&&_.push({provider:b.provider,modelId:b.modelId,parameters:b.params,providerSnapshot:{},modelSnapshot:w})}}return[...s,..._].slice(0,10)}),$=[{title:"Model",key:"name",width:"35%"},{title:"Parameters",key:"parameters",width:"35%"},{title:"Cost",key:"cost",width:"20%"},{title:"",key:"actions",width:"10%"}],x=R(()=>n.configurations.map((e,a)=>({key:`${e.provider}-${e.modelId}-${a}`,...e}))),B=R(()=>n.totalCombinations*n.configurations.length*n.repeatCount),O=R(()=>n.tokenData?n.configurations.reduce((e,a)=>{const s=d.value?.find(b=>b.provider===a.provider&&b.modelId===a.modelId);if(!s)return e;const l=g(n.tokenData.totalTokens,n.tokenData.combinationCount,s,a.parameters),_=n.repeatCount>1?c(l,n.repeatCount):l;return e+_.cost.total.expected},0):0);function A(e){if(!n.tokenData)return"?? (no token data)";const a=d.value?.find(i=>i.provider===e.provider&&i.modelId===e.modelId);if(!a)return"?? (model not found)";const s=g(n.tokenData.totalTokens,n.tokenData.combinationCount,a,e.parameters);if(!s.meta.hasValidCost||s.cost.total.expected===-1)return"?? (no pricing data)";const l=n.repeatCount>1?c(s,n.repeatCount):s,_=l.cost.total.min,b=l.cost.total.max,p=l.cost.total.expected;return Math.abs(b-_)<1e-4?`$${f(p)}`:`$${f(_)}-$${f(b)}`}function f(e){if(e===0)return"0.00";if(e<.01){let a=2,s=e;for(;s<.1;)s*=10,a++;return e.toFixed(a)}return e<1?e.toFixed(3):e<10?e.toFixed(2):e<100?e.toFixed(1):Math.round(e).toLocaleString()}function o(e){const a={},s=["temperature","max_tokens","max_completion_tokens","num_predict","maxTokens","top_p","top_k","reasoning_effort"];for(const l of s)e[l]!==void 0&&e[l]!==null&&(a[l]=e[l]);for(const[l,_]of Object.entries(e))_!=null&&!s.includes(l)&&(a[l]=_);return a}function M(e){return e.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}function L(e){if(!e||Object.keys(e).length===0)return"";const a=[];return e.temperature!==void 0&&a.push(`T:${e.temperature}`),e.max_tokens!==void 0?a.push(`${e.max_tokens}t`):e.maxTokens!==void 0?a.push(`${e.maxTokens}t`):e.num_predict!==void 0&&a.push(`${e.num_predict}t`),e.top_p!==void 0&&a.push(`p:${e.top_p}`),a.length>0?`(${a.join(", ")})`:""}function F(e){const a=Ee.validateParameters(e.provider,e.modelId,e.parameters||{});if(!a.valid){U.error("Quick Add validation failed:",{provider:e.provider,modelId:e.modelId,parameters:e.parameters,errors:a.errors}),alert(`Cannot add model configuration: ${a.errors?.join(", ")||"Invalid parameters"}`);return}const s={name:e.modelSnapshot?.displayName||e.modelId,provider:e.provider,modelId:e.modelId,parameters:{...e.parameters}};I("add-configuration",s),N()}function T(e){I("add-configuration",e),v.value=!1,N()}async function N(){await Te(),requestAnimationFrame(()=>{const e=[".step-content",".creation-content",".trial-configuration",".trial-creation-content"];let a=!1;for(const s of e){const l=document.querySelector(s);if(l&&l.scrollHeight>l.clientHeight){U.info(`Scrolling ${s} to bottom: scrollHeight=${l.scrollHeight}`),l.scrollTop=l.scrollHeight,a=!0;break}}a||setTimeout(()=>{const s=document.querySelector(".step-content")||document.querySelector(".creation-content");s?(U.info(`Fallback scroll: scrollHeight=${s.scrollHeight}`),s.scrollTop=s.scrollHeight):U.warn("No scrollable container found")},100)})}function u(e){I("remove-configuration",e)}return(e,a)=>{const s=Z,l=Je,_=le,b=We;return m(),h("div",ea,[C.value.length>0?(m(),h("div",ta,[a[2]||(a[2]=t("h4",null,"Quick Add Recent Models",-1)),t("div",aa,[(m(!0),h(Q,null,X(C.value,p=>(m(),J(s,{key:`${p.provider}-${p.modelId}-${JSON.stringify(p.parameters)}`,size:"small",onClick:i=>F(p),class:"quick-add-button",title:`Add ${p.modelSnapshot?.displayName||p.modelId} (${p.provider}) with recent parameters`},{default:k(()=>[r(P(ee)),t("span",sa,y(p.provider)+"/",1),t("span",na,y(p.modelSnapshot?.displayName||p.modelId),1),L(p.parameters)?(m(),h("span",oa,y(L(p.parameters)),1)):z("",!0)]),_:2},1032,["onClick","title"]))),128))])])):z("",!0),t("div",ia,[t("div",la,[t("h3",ra,[r(l,{placement:"topLeft"},{title:k(()=>a[3]||(a[3]=[V(" Add models to test with your template and configure their parameters like temperature, max tokens, etc. ")])),default:k(()=>[a[4]||(a[4]=t("span",null,"Model Configurations to Test",-1))]),_:1,__:[4]}),a[6]||(a[6]=t("span",null,"  ",-1)),r(s,{type:"primary",size:"small",onClick:a[0]||(a[0]=p=>v.value=!0)},{default:k(()=>[r(P(ee)),a[5]||(a[5]=V(" Add Model "))]),_:1,__:[5]})])]),r(b,{columns:$,"data-source":x.value,pagination:!1,locale:{emptyText:"No models configured. Add at least one model to proceed."},"row-key":"key"},{bodyCell:k(({column:p,record:i,index:w})=>[p.key==="name"?(m(),h("div",ua,[t("span",da,y(i.name),1),t("span",ca,y(i.provider)+":"+y(i.modelId),1)])):p.key==="parameters"?(m(),h("div",pa,[(m(!0),h(Q,null,X(o(i.parameters),(E,H)=>(m(),J(_,{key:H},{default:k(()=>[V(y(M(H))+": "+y(E),1)]),_:2},1024))),128))])):p.key==="cost"?(m(),h("div",ma,[t("span",va,y(A(i)),1),a[7]||(a[7]=t("span",{class:"cost-label"},"total trial cost",-1))])):p.key==="actions"?(m(),J(s,{key:3,type:"text",danger:"",size:"small",onClick:E=>u(w)},{default:k(()=>[r(P(Ke))]),_:2},1032,["onClick"])):z("",!0)]),_:1},8,["data-source"]),e.configurations.length>0?(m(),h("div",fa,[t("div",ga,[a[8]||(a[8]=t("span",null,"Total experiments:",-1)),t("strong",null,y(B.value),1)]),t("div",_a,[a[9]||(a[9]=t("span",null,"Estimated total cost:",-1)),t("strong",ya,"$"+y(f(O.value)),1)])])):z("",!0)]),r(st,{visible:v.value,"onUpdate:visible":a[1]||(a[1]=p=>v.value=p),mode:"trial","trial-context":{totalCombinations:e.totalCombinations,tokenData:e.tokenData??null},"existing-configurations":e.configurations,onAddConfiguration:T},null,8,["visible","trial-context","existing-configurations"])])}}}),ba=G(Ca,[["__scopeId","data-v-67e13ee2"]]),ha={class:"trial-configuration"},ka={class:"configuration-sections"},$a={class:"config-section"},Ta={class:"config-section"},wa=["aria-expanded"],Ia={class:"section-title"},Sa={class:"expand-hint"},Pa={key:0,class:"design-info"},xa={class:"design-stats"},Da={class:"stat"},Ma={class:"stat-value"},Ea={class:"stat"},Va={class:"stat-value"},Na={class:"config-section"},Aa=Y({__name:"TrialConfiguration",setup(q){const D=we("trialCreation"),{calculateTemplateTokens:n,calculatePromptTokens:I}=re(),d=j(!1),S=j(!1),g=R(()=>D.selectedPrompt.value),c=R(()=>{const v=g.value;if(!v)return null;try{if(v.type==="template"){const C=v.template,$=v.variables,x=D.variableLists?.value;return C?n(C,$||{},x||[]):null}else if(v.type==="spreadsheet"){const C=v.promptPattern;if(!C)return null;const $=I(C),x=D.totalCombinations.value;return{totalTokens:$*x,combinationCount:x,perCallAverage:$}}else return null}catch(C){return U.error("Error calculating tokenData:",C),null}});return(v,C)=>(m(),h("div",ha,[t("div",ka,[t("section",$a,[C[6]||(C[6]=t("h2",{class:"section-title"},"Trial Details",-1)),r(Xt,{name:P(D).trialName.value,"repeat-count":P(D).repeatCount.value,description:P(D).description?.value||"","total-combinations":P(D).totalCombinations.value,"onUpdate:name":C[0]||(C[0]=$=>P(D).trialName.value=$),"onUpdate:repeatCount":C[1]||(C[1]=$=>P(D).repeatCount.value=$),"onUpdate:description":C[2]||(C[2]=$=>P(D).description.value=$)},null,8,["name","repeat-count","description","total-combinations"])]),t("section",Ta,[t("button",{class:"collapsible-header",onClick:C[3]||(C[3]=$=>d.value=!d.value),"aria-expanded":d.value},[r(P(Ye),{class:ae([{expanded:d.value},"expand-icon"])},null,8,["class"]),t("h2",Ia,[C[7]||(C[7]=V("Selected Design Preview ")),t("span",Sa,"(click to "+y(d.value?"collapse":"expand")+")",1)])],8,wa),d.value?(m(),h("div",Pa,[r(se,{template:g.value,"variable-lists":P(D).variableLists.value,cycling:S.value,"show-controls":!0,"display-mode":"block","show-legend":!0,"onUpdate:paused":C[4]||(C[4]=$=>S.value=!$),onBackToSelect:C[5]||(C[5]=$=>v.$emit("back"))},null,8,["template","variable-lists","cycling"]),t("div",xa,[t("div",Da,[C[8]||(C[8]=t("span",{class:"stat-label"},"Total Combinations:",-1)),t("span",Ma,y(P(D).totalCombinations.value),1)]),t("div",Ea,[C[9]||(C[9]=t("span",{class:"stat-label"},"Total Input Tokens:",-1)),t("span",Va,y(c.value!==null?`${c.value.totalTokens.toLocaleString()} total (${c.value.combinationCount.toLocaleString()} calls)`:"??"),1)])])])):z("",!0)]),t("section",Na,[C[10]||(C[10]=t("h2",{class:"section-title"},"Add Models and Set Parameters",-1)),r(ba,{configurations:P(D).configurations.value,"total-combinations":P(D).totalCombinations.value,"repeat-count":P(D).repeatCount.value,"token-data":c.value,onAddConfiguration:P(D).addConfiguration,onRemoveConfiguration:P(D).removeConfiguration},null,8,["configurations","total-combinations","repeat-count","token-data","onAddConfiguration","onRemoveConfiguration"])])])]))}}),La=G(Aa,[["__scopeId","data-v-794621cc"]]),Oa={class:"trial-submission"},za={class:"review-section"},Ra={class:"summary-card"},ja={class:"summary-item"},Ba={class:"value"},Fa={class:"summary-item"},Ua={class:"value"},qa={class:"summary-item"},Ha={class:"value"},Ja={key:0,class:"summary-item"},Wa={class:"value"},Ka={key:1,class:"summary-item"},Ya={class:"value"},Ga={class:"summary-item"},Za={class:"value"},Qa={key:2,class:"summary-item"},Xa={class:"value"},es={class:"summary-item"},ts={class:"value highlight"},as={key:3,class:"summary-item"},ss={key:0,class:"value highlight"},ns={key:1,class:"value"},os={class:"configurations-review"},is={class:"config-header"},ls={class:"config-name"},rs={class:"config-model"},us={class:"config-params"},ds={key:0,class:"running-trials-warning"},cs={class:"action-buttons"},ps={key:0},ms={key:1},vs={key:2},fs=Y({__name:"TrialSubmission",props:{trialConfig:{},design:{}},emits:["back","create-draft","create-and-start","export-python"],setup(q,{emit:D}){const n=q,I=D,{runningTrials:d}=ie(),{variableLists:S}=me(),{models:g}=oe(),{calculateTemplateTokens:c,calculatePromptTokens:v,estimateTotalCost:C,sumEstimates:$}=re(),x=j(null),B=j(!1),O=j(!1),A=R(()=>d.value.length>0),f=R(()=>d.value.length),o=R(()=>{if(!n.trialConfig.configurations)return 0;let a=1;if(n.design.type==="template"&&n.design.variables)for(const[,l]of Object.entries(n.design.variables)){const _=l;if(_.type==="value"&&_.values)a*=_.values.length;else if(_.type==="list"&&_.listId){const b=S.value?.find(p=>p.id===_.listId);b&&(b.category==="simple"?a*=b.values?.length||0:b.category==="attributed"?a*=b.items?.length||0:b.category==="tabular"&&(a*=b.itemCount||0))}}else n.design.type==="spreadsheet"&&(a=S.value?.find(_=>_.id===n.design.datasetId)?.itemCount||0);const s=n.trialConfig.repeatCount||1;return a*n.trialConfig.configurations.length*s}),M=R(()=>{if(!n.trialConfig.configurations||n.trialConfig.configurations.length===0)return-1;let a=null;if(n.design.type==="template"){const _=n.trialConfig.templateConfig?.template||n.design.template||"",b=n.trialConfig.templateConfig?.variables||n.design.variables||{};a=c(_,b,S.value)}else if(n.design.type==="spreadsheet"){const _=n.trialConfig.spreadsheetConfig?.promptPattern||n.design.promptPattern||"",b=v(_),p=o.value/n.trialConfig.configurations.length;a={totalTokens:b*p,combinationCount:p,perCallAverage:b}}if(!a||a.totalTokens===0)return U.error("TrialSubmission: No prompt content found for cost estimation",{type:n.design.type,hasTemplate:!!n.trialConfig.templateConfig?.template||!!n.design.template,hasPromptPattern:!!n.trialConfig.spreadsheetConfig?.promptPattern||!!n.design.promptPattern}),-1;const s=n.trialConfig.configurations.map(_=>{const b=g.value?.find(p=>p.provider===_.provider&&p.modelId===_.modelId);return b?C(a.totalTokens,a.combinationCount,b,_.parameters):null}).filter(Boolean);return s.length===0?-1:$(s).cost.total.expected});function L(a){const s=[];"temperature"in a&&s.push(`temperature=${a.temperature}`),"max_tokens"in a&&s.push(`max_tokens=${a.max_tokens}`),"top_p"in a&&s.push(`top_p=${a.top_p}`);const l=Object.keys(a).length-s.length;return l>0&&s.push(`+${l} more`),s.join(", ")}function F(){return{name:n.trialConfig.name||"",description:n.trialConfig.description,type:n.design.type,configurations:n.trialConfig.configurations||[],repeatCount:n.trialConfig.repeatCount||1,templateConfig:n.trialConfig.templateConfig,spreadsheetConfig:n.trialConfig.spreadsheetConfig}}async function T(){x.value="draft";try{const a=F();I("create-draft",a)}finally{x.value=null}}async function N(){B.value=!0;try{const a=F();I("export-python",a)}finally{B.value=!1}}function u(){A.value||M.value>10&&M.value!==-1?O.value=!0:e()}async function e(){O.value=!1,x.value="start";try{const a=F();I("create-and-start",a)}finally{x.value=null}}return(a,s)=>{const l=Z,_=Ge,b=ge;return m(),h("div",Oa,[r(l,{type:"link",onClick:s[0]||(s[0]=p=>a.$emit("back")),class:"back-button"},{default:k(()=>[r(P(Ze)),s[3]||(s[3]=V(" Back to Configuration "))]),_:1,__:[3]}),t("div",za,[s[15]||(s[15]=t("h2",null,"Review & Create Trial",-1)),t("div",Ra,[s[13]||(s[13]=t("h3",null,"Trial Summary",-1)),t("div",ja,[s[4]||(s[4]=t("span",{class:"label"},"Name:",-1)),t("span",Ba,y(a.trialConfig.name),1)]),t("div",Fa,[s[5]||(s[5]=t("span",{class:"label"},"Type:",-1)),t("span",Ua,y(a.design.type==="template"?"Template":"Spreadsheet"),1)]),t("div",qa,[s[6]||(s[6]=t("span",{class:"label"},"Design:",-1)),t("span",Ha,y(a.design.name),1)]),a.design.type==="template"?(m(),h("div",Ja,[s[7]||(s[7]=t("span",{class:"label"},"Variables:",-1)),t("span",Wa,y(Object.keys(a.design.variables||{}).length)+" variables configured ",1)])):z("",!0),a.design.type==="spreadsheet"?(m(),h("div",Ka,[s[8]||(s[8]=t("span",{class:"label"},"Dataset:",-1)),t("span",Ya,y(a.design.rowCount)+" rows",1)])):z("",!0),t("div",Ga,[s[9]||(s[9]=t("span",{class:"label"},"Model Configurations:",-1)),t("span",Za,y(a.trialConfig.configurations?.length||0)+" models",1)]),a.trialConfig.repeatCount&&a.trialConfig.repeatCount>1?(m(),h("div",Qa,[s[10]||(s[10]=t("span",{class:"label"},"Repeat Count:",-1)),t("span",Xa,y(a.trialConfig.repeatCount)+" times per prompt",1)])):z("",!0),t("div",es,[s[11]||(s[11]=t("span",{class:"label"},"Total API Calls:",-1)),t("span",ts,y(o.value),1)]),M.value!==-1?(m(),h("div",as,[s[12]||(s[12]=t("span",{class:"label"},"Estimated Cost:",-1)),M.value>0?(m(),h("span",ss,"$"+y(M.value.toFixed(4)),1)):(m(),h("span",ns,"Unable to estimate (no prompt content)"))])):z("",!0)]),t("div",os,[s[14]||(s[14]=t("h3",null,"Model Configurations",-1)),(m(!0),h(Q,null,X(a.trialConfig.configurations,(p,i)=>(m(),h("div",{key:`review-config-${i}`,class:"config-review-item"},[t("div",is,[t("span",ls,y(p.name||p.modelId),1),t("span",rs,y(p.provider)+":"+y(p.modelId),1)]),t("div",us,y(L(p.parameters)),1)]))),128))]),A.value?(m(),h("div",ds,[r(_,{message:"Running Trials Detected",description:`You have ${f.value} trial(s) currently running. Starting a new trial may affect performance.`,type:"warning","show-icon":""},null,8,["description"])])):z("",!0)]),t("div",cs,[r(l,{size:"large",onClick:T,loading:x.value==="draft"},{default:k(()=>[r(P(_e)),s[16]||(s[16]=V(" Create as Draft "))]),_:1,__:[16]},8,["loading"]),r(l,{size:"large",onClick:N,loading:B.value},{default:k(()=>[r(P(Qe)),s[17]||(s[17]=V(" Export to Python "))]),_:1,__:[17]},8,["loading"]),r(l,{type:"primary",size:"large",onClick:u,loading:x.value==="start"},{default:k(()=>[r(P(Xe)),s[18]||(s[18]=V(" Create and Start "))]),_:1,__:[18]},8,["loading"])]),r(b,{visible:O.value,"onUpdate:visible":s[1]||(s[1]=p=>O.value=p),title:"Confirm Trial Creation",onOk:e,onCancel:s[2]||(s[2]=p=>O.value=!1)},{default:k(()=>[s[19]||(s[19]=t("p",null,"You are about to create and start a trial with:",-1)),t("ul",null,[t("li",null,y(o.value)+" API calls",1),M.value>0?(m(),h("li",ps,"Estimated cost: $"+y(M.value.toFixed(4)),1)):M.value===-1?(m(),h("li",ms,"Cost estimation unavailable")):z("",!0),A.value?(m(),h("li",vs,y(f.value)+" other trial(s) running",1)):z("",!0)]),s[20]||(s[20]=t("p",null,"Do you want to proceed?",-1))]),_:1,__:[19,20]},8,["visible"])])}}}),gs=G(fs,[["__scopeId","data-v-b8e71998"]]),_s={class:"conflict-content"},ys={class:"warning-section"},Cs={class:"warning-text"},bs={class:"trial-info"},hs={class:"summary-grid"},ks={class:"summary-item"},$s={class:"value"},Ts={class:"summary-item"},ws={class:"value"},Is={key:0,class:"summary-item"},Ss={class:"value"},Ps={class:"modal-footer"},xs=Y({__name:"TrialConflictModal",props:{visible:{type:Boolean},runningTrial:{},trialConfig:{},totalApiCalls:{},estimatedCost:{}},emits:["update:visible","cancel","create-draft"],setup(q,{emit:D}){const n=q,I=D,d=j(!1);function S(){I("update:visible",!1),I("cancel")}async function g(){if(n.trialConfig){d.value=!0;try{I("create-draft",n.trialConfig),I("update:visible",!1)}finally{d.value=!1}}}return(c,v)=>{const C=Z,$=ge;return m(),J($,{visible:c.visible,title:"Running Trial Detected",closable:!1,"mask-closable":!1,width:"600px",onCancel:S},{footer:k(()=>[t("div",Ps,[r(C,{onClick:S,disabled:d.value},{default:k(()=>v[8]||(v[8]=[V(" Cancel ")])),_:1,__:[8]},8,["disabled"]),r(C,{type:"primary",onClick:g,loading:d.value},{default:k(()=>[r(P(_e)),v[9]||(v[9]=V(" Create Draft "))]),_:1,__:[9]},8,["loading"])])]),default:k(()=>[t("div",_s,[t("div",ys,[r(P(et),{class:"warning-icon"}),t("div",Cs,[v[2]||(v[2]=t("h3",null,"Another trial is currently running",-1)),t("p",null,[v[0]||(v[0]=V(' The trial "')),t("strong",null,y(c.runningTrial?.name),1),v[1]||(v[1]=V('" is currently executing. You can only run one trial at a time. '))])])]),v[7]||(v[7]=t("div",{class:"message-section"},[t("p",null,"You can only run one trial at a time. Your new trial will be saved as a draft and you can start it manually after the current trial finishes, or you can pause or cancel the running trial, then start your new draft trial.")],-1)),t("div",bs,[v[6]||(v[6]=t("h4",null,"New Trial Summary:",-1)),t("div",hs,[t("div",ks,[v[3]||(v[3]=t("span",{class:"label"},"Name:",-1)),t("span",$s,y(c.trialConfig?.name),1)]),t("div",Ts,[v[4]||(v[4]=t("span",{class:"label"},"API Calls:",-1)),t("span",ws,y(c.totalApiCalls),1)]),c.estimatedCost>0?(m(),h("div",Is,[v[5]||(v[5]=t("span",{class:"label"},"Estimated Cost:",-1)),t("span",Ss,"$"+y(c.estimatedCost.toFixed(4)),1)])):z("",!0)])])])]),_:1},8,["visible"])}}}),Ds=G(xs,[["__scopeId","data-v-6c2d242e"]]),Ms={class:"trial-creation-content"},Es={class:"step-content"},Vs={key:1,class:"modal-footer"},Ns={key:2,class:"create-actions"},As={key:2,class:"view-footer"},Ls={key:0,class:"validation-errors"},Os={class:"create-actions"},zs=Y({__name:"TrialCreationContent",props:{mode:{},initialData:{}},emits:["cancel","create-template","create-spreadsheet","created","created-and-started","export-python"],setup(q,{expose:D,emit:n}){const I=q,d=n,S=R(()=>({type:I.initialData?.type||"create",sourceTrialId:I.initialData?.sourceTrialId})),g=nt(Ie(S));Se("trialCreation",g);const c=j(0),v=j(!1),C=j(null),$=j(null),x=j(null);D({currentStep:c});const B=R(()=>{if(I.mode==="view")return g.selectedPrompt.value!==null&&g.canProceed.value&&g.configurations.value.length>0;switch(c.value){case 0:return g.selectedPrompt.value!==null;case 1:return g.canProceed.value;default:return!0}}),O=R(()=>{const u=[];return g.selectedPrompt.value||u.push("Select a template or spreadsheet"),g.configurations.value.length===0&&u.push("Add at least one model configuration"),g.trialName.value.trim()===""&&u.push("Enter a trial name"),u.join(" • ")});function A(){const u=JSON.parse(JSON.stringify(g.selectedPrompt.value));return{name:g.trialName.value,description:g.description?.value||"",type:u.type,configurations:JSON.parse(JSON.stringify(g.configurations.value)),repeatCount:g.repeatCount.value,templateConfig:u.type==="template"?{template:u.template,variables:u.variables,parserId:u.parserId,outputType:u.outputType,extractPattern:u.extractPattern,refusalWords:u.refusalWords,refusalMode:u.refusalMode,rejectRefusalWords:u.rejectRefusalWords}:void 0,spreadsheetConfig:u.type==="spreadsheet"?{promptPattern:u.promptPattern,datasetId:u.datasetId}:void 0}}function f(u){g.selectPrompt(u),I.mode==="view"&&(c.value=1)}async function o(){try{const u=await g.createTrialAsDraft();u&&d("created",u)}catch(u){U.error("Failed to create draft trial:",u)}}async function M(){try{const u=await g.createAndStartTrial();u&&(u.needsConfirmation?(C.value=A(),$.value=u.trialId,x.value="runningTrial"in u?u.runningTrial:null,v.value=!0):d("created-and-started",u.trialId))}catch(u){U.error("Failed to create and start trial:",u)}}async function L(){d("export-python",A())}function F(){N()}async function T(){try{$.value&&d("created",$.value),N()}catch(u){U.error("Failed to handle draft creation:",u)}}function N(){v.value=!1,C.value=null,$.value=null,x.value=null}return ne(async()=>{if(await g.initialize(),I.initialData?.templateId&&I.initialData?.promptSource==="template"){const u=()=>{const e=g.templates.value.find(a=>a.id===I.initialData?.templateId);return e?(g.selectPrompt(e),c.value=1,!0):!1};if(!u()){const e=K(()=>g.templates.value,()=>{u()&&e()},{immediate:!0});setTimeout(()=>e(),3e3)}}}),K(c,()=>{I.mode==="view"&&window.scrollTo(0,0)}),(u,e)=>{const a=at,s=tt,l=Z;return m(),h("div",Ms,[u.mode==="modal"?(m(),J(s,{key:0,current:c.value,class:"creation-steps"},{default:k(()=>[r(a,{title:"Select Design"}),r(a,{title:"Configure Trial"}),r(a,{title:"Review & Create"})]),_:1},8,["current"])):z("",!0),t("div",Es,[c.value===0?(m(),J(Gt,{key:0,templates:P(g).templates.value,spreadsheets:P(g).spreadsheets.value,"variable-lists":P(g).variableLists.value,onSelect:f,onCreateTemplate:e[0]||(e[0]=_=>u.$emit("create-template")),onCreateSpreadsheet:e[1]||(e[1]=_=>u.$emit("create-spreadsheet"))},null,8,["templates","spreadsheets","variable-lists"])):c.value===1?(m(),J(La,{key:1,onBack:e[2]||(e[2]=_=>c.value--)})):c.value===2?(m(),J(gs,{key:2,"trial-config":A(),design:P(g).selectedPrompt.value,onBack:e[3]||(e[3]=_=>c.value--),onCreateDraft:o,onCreateAndStart:M,onExportPython:L},null,8,["trial-config","design"])):z("",!0)]),I.mode==="modal"?(m(),h("div",Vs,[r(l,{onClick:e[4]||(e[4]=_=>u.$emit("cancel"))},{default:k(()=>e[8]||(e[8]=[V("Cancel")])),_:1,__:[8]}),c.value>0?(m(),J(l,{key:0,onClick:e[5]||(e[5]=_=>c.value--)},{default:k(()=>e[9]||(e[9]=[V(" Back ")])),_:1,__:[9]})):z("",!0),c.value<2?(m(),J(l,{key:1,type:"primary",disabled:!B.value,onClick:e[6]||(e[6]=_=>c.value++)},{default:k(()=>e[10]||(e[10]=[V(" Next ")])),_:1,__:[10]},8,["disabled"])):z("",!0),c.value===2?(m(),h("div",Ns,[r(l,{type:"primary",disabled:!B.value,onClick:o},{default:k(()=>e[11]||(e[11]=[V(" Create Draft ")])),_:1,__:[11]},8,["disabled"]),r(l,{type:"primary",disabled:!B.value,onClick:M},{default:k(()=>e[12]||(e[12]=[V(" Create & Start ")])),_:1,__:[12]},8,["disabled"])])):z("",!0)])):z("",!0),I.mode==="view"?(m(),h("div",As,[B.value?z("",!0):(m(),h("div",Ls,y(O.value),1)),t("div",Os,[r(l,{size:"large",disabled:!B.value,onClick:L},{default:k(()=>e[13]||(e[13]=[V(" Export Python ")])),_:1,__:[13]},8,["disabled"]),r(l,{type:"primary",size:"large",disabled:!B.value,onClick:o},{default:k(()=>e[14]||(e[14]=[V(" Create Draft ")])),_:1,__:[14]},8,["disabled"]),r(l,{type:"primary",size:"large",disabled:!B.value,onClick:M},{default:k(()=>e[15]||(e[15]=[V(" Create & Start ")])),_:1,__:[15]},8,["disabled"])])])):z("",!0),r(Ds,{visible:v.value,"onUpdate:visible":e[7]||(e[7]=_=>v.value=_),"running-trial":x.value,"trial-config":C.value,"total-api-calls":P(g).totalExperiments.value,"estimated-cost":P(g).totalCost.value,onCancel:F,onCreateDraft:T},null,8,["visible","running-trial","trial-config","total-api-calls","estimated-cost"])])}}}),Rs=G(zs,[["__scopeId","data-v-951de972"]]),js={class:"trial-creation-view"},Bs={class:"creation-header"},Fs={class:"header-title"},Us={class:"creation-content"},qs=Y({__name:"TrialCreationV3",setup(q){const D=Pe(),n=xe(),I=j(),d=j(null);async function S(){const O=D.query;if(O.duplicate){const A=O.duplicate;I.value={type:"duplicate",sourceTrialId:A}}else O.designId&&O.promptSource==="template"&&(I.value={type:"create",templateId:O.designId,promptSource:"template"})}function g(){n.push("/trials")}function c(){d.value&&(d.value.currentStep=0)}async function v(O){te.success("Trial created as draft"),n.push({path:"/trials",query:{trialId:O,tab:"details"}})}async function C(O){te.success("Trial created and started"),n.push({path:"/trials",query:{trialId:O,tab:"tasks"}})}async function $(){te.info("Python export not yet implemented")}function x(){n.push("/templates/new")}function B(){n.push("/spreadsheet")}return ne(()=>{S()}),(O,A)=>{const f=Z;return m(),h("div",js,[t("div",Bs,[t("div",Fs,[A[1]||(A[1]=t("h1",null,"Create New Trial",-1)),d.value?.currentStep===1?(m(),J(f,{key:0,type:"link",class:"back-button",onClick:c},{default:k(()=>[r(P(ve)),A[0]||(A[0]=V(" Back to Select Template "))]),_:1,__:[0]})):z("",!0)]),r(f,{onClick:g},{default:k(()=>A[2]||(A[2]=[V("Cancel")])),_:1,__:[2]})]),t("div",Us,[r(Rs,{ref_key:"creationContentRef",ref:d,mode:"view","initial-data":I.value,onCancel:g,onCreated:v,onCreatedAndStarted:C,onExportPython:$,onCreateTemplate:x,onCreateSpreadsheet:B},null,8,["initial-data"])])])}}}),ln=G(qs,[["__scopeId","data-v-38a5dd3b"]]);export{ln as default};
