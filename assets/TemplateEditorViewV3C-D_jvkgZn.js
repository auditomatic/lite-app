import{e as J,u as me,a as ae}from"./index-mQWFZhQt.js";import{d as X,f as S,c as A,w as Z,V as v,_ as o,W as a,a5 as fe,q as G,v as be,a6 as ge,n as De,a2 as P,k as f,X as y,F as j,Y as O,a7 as le,a1 as T,a0 as _,G as $,$ as q,a8 as de,B as Oe,b as Ke,u as Y,a4 as qe,o as He,Z as Ze}from"./vue-vendor-BZxY9vkr.js";import{u as Ye}from"./useV4Templates-2HA_dy9N.js";import{u as Ge}from"./useV4TemplateCommands-FA8L_ABk.js";import{a as Je}from"./useV4VariableLists-BVdJZQeX.js";import{u as Xe,n as Qe,v as ye,s as et,k as ve}from"./ui-vendor-DgwC-sRC.js";import"./utils-vendor-X1Ah6TN4.js";import"./data-vendor-CllpzWXw.js";import"./useV4LiveQuery-CfOiSnL_.js";const tt={class:"template-editor"},at=["placeholder","rows","data-testid","aria-label"],lt=X({__name:"TemplateEditorV3C",props:{modelValue:{},label:{},placeholder:{default:"Enter your prompt template..."},required:{type:Boolean},rows:{default:4},variables:{default:()=>[]},variableColors:{default:()=>({})}},emits:["update:modelValue"],setup(K,{expose:D,emit:b}){const F=K,W=b,g=S(),x=S(),B=S(!1),I=A({get:()=>F.modelValue,set:u=>W("update:modelValue",u)}),L=A(()=>{let u=s(I.value);return u=u.replace(/\{\{(\w+)\}\}/g,(m,i)=>{const n=/^\w+$/.test(i),C=F.variableColors[i];return n&&C?`<span class="variable-highlight" style="background-color: ${C.bg}; box-shadow: 0 0 0 1px ${C.bg};">${s(m)}</span>`:n?`<span class="variable-highlight">${s(m)}</span>`:`<span class="variable-error">${s(m)}</span>`}),u=u.replace(/\n/g,"<br>"),u=u.replace(/  /g," &nbsp;"),u.endsWith("<br>")||(u+="<br>"),u});function s(u){const m=document.createElement("div");return m.textContent=u,m.innerHTML}function k(){!g.value||!x.value||(x.value.scrollTop=g.value.scrollTop,x.value.scrollLeft=g.value.scrollLeft)}return Z(I,async()=>{await De(),k()}),D({focus:()=>{var u;return(u=g.value)==null?void 0:u.focus()}}),(u,m)=>{const i=be("dompurify-html");return o(),v("div",tt,[a("div",{class:fe(["editor-container",{focused:B.value}])},[G(a("div",{ref_key:"highlightRef",ref:x,class:"editor-highlight","aria-hidden":"true"},null,512),[[i,L.value,"template"]]),G(a("textarea",{ref_key:"textareaRef",ref:g,"onUpdate:modelValue":m[0]||(m[0]=n=>I.value=n),class:"editor-textarea",placeholder:u.placeholder,rows:u.rows,"data-testid":u.$attrs["data-testid"]||"textarea-template-editor","aria-label":u.$attrs["aria-label"]||"Template editor textarea",onFocus:m[1]||(m[1]=n=>B.value=!0),onBlur:m[2]||(m[2]=n=>B.value=!1),onScroll:k},null,40,at),[[ge,I.value]])],2)])}}}),st=J(lt,[["__scopeId","data-v-da627e6e"]]),it={class:"variable-chip-input"},nt={key:0,class:"attributed-list-display"},ot={class:"list-header"},rt={class:"source-name"},ut={key:0,class:"attribute-breakdown"},dt={key:0,class:"separator"},vt={class:"total-conditions"},ct={class:"attributed-chips-container"},pt={class:"item-name"},mt={key:0,class:"attributes-wrapper"},ft={key:1,class:"direct-values"},bt={key:0,class:"simple-list-display"},gt={class:"list-header"},yt={class:"source-name"},_t={class:"tag-input-wrapper"},ht={class:"custom-tag-input"},kt={class:"tag-container tag-container-readonly"},wt=["title"],$t={key:0,class:"readonly-hint"},Ct={key:0,class:"helper-text"},Vt={key:1,class:"tag-input-wrapper"},xt={class:"custom-tag-input"},Lt={class:"tag-container"},Tt={class:"floating-actions"},Rt=["title"],Et=["onClick","data-testid","aria-label"],St=["placeholder","aria-label","onKeydown"],Pt={key:0,class:"helper-text"},It=X({__name:"VariableChipInputV3C",props:{values:{},listRef:{},listName:{},source:{},placeholder:{},attributedSamples:{},attributeBreakdown:{},attributeKeys:{},previewValues:{},totalCount:{}},emits:["update:values","clear-source","clear-list","select-list"],setup(K,{emit:D}){const b=K,F=D,W=S(""),g=S();function x(){return[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}]}function B(i){return b.attributeKeys?Object.entries(i).map(([n,C])=>{const t=b.attributeKeys.indexOf(n)%5;return{value:C,colorIndex:t}}):[]}function I(i){F("update:values",i),b.source&&F("clear-source")}function L(){const i=W.value.trim();i&&(b.values.includes(i)||I([...b.values,i]),W.value="")}function s(i){var t;i.preventDefault();const C=(((t=i.clipboardData)==null?void 0:t.getData("text"))||"").split(/\r?\n/).map(c=>c.trim()).filter(c=>c.length>0);if(C.length>0){const c=new Set(b.values),V=C.filter(U=>!c.has(U));V.length>0&&I([...b.values,...V]),W.value=""}}function k(i){const n=[...b.values];n.splice(i,1),I(n)}function u(){if(W.value===""&&b.values.length>0){const i=[...b.values];i.pop(),I(i)}}function m(){I([]),b.source&&F("clear-source")}return(i,n)=>{const C=T("a-button");return o(),v("div",it,[i.listRef&&i.attributedSamples?(o(),v("div",nt,[a("div",ot,[n[6]||(n[6]=a("span",{class:"source-label"},"From list:",-1)),a("span",rt,y(i.listName||"Unknown List"),1),i.attributeBreakdown&&i.attributeBreakdown.parts.length>0?(o(),v("div",ut,[(o(!0),v(j,null,O(i.attributeBreakdown.parts,(t,c)=>(o(),v(j,{key:`part-${t.text}-${c}`},[a("span",{class:"attribute-part",style:le({backgroundColor:x()[t.colorIndex].bg,color:x()[t.colorIndex].text})},y(t.text),5),c<i.attributeBreakdown.parts.length-1?(o(),v("span",dt," × ")):P("",!0)],64))),128)),n[4]||(n[4]=a("span",{class:"arrow"}," → ",-1)),a("span",vt,y(i.attributeBreakdown.totalItems)+" conditions",1)])):P("",!0),f(C,{size:"small",danger:"",onClick:n[0]||(n[0]=t=>i.$emit("clear-list")),"data-testid":"btn-remove-list","aria-label":"Remove linked variable list"},{default:_(()=>n[5]||(n[5]=[$(" Remove List ")])),_:1,__:[5]})]),a("div",ct,[n[9]||(n[9]=a("span",{class:"sample-hint"},"Sample values:",-1)),(o(!0),v(j,null,O(i.attributedSamples,t=>(o(),v("div",{key:t.value,class:"attributed-item-chip"},[a("span",pt,y(t.value),1),t.attributes?(o(),v("span",mt,[n[7]||(n[7]=$(" (")),(o(!0),v(j,null,O(B(t.attributes),(c,V)=>(o(),v("span",{key:`attr-${c.value}-${V}`,class:"attribute-value",style:le({backgroundColor:x()[c.colorIndex].bg,color:x()[c.colorIndex].text})},y(c.value),5))),128)),n[8]||(n[8]=$(") "))])):P("",!0)]))),128))])])):(o(),v("div",ft,[i.source?(o(),v("div",bt,[a("div",gt,[n[12]||(n[12]=a("span",{class:"source-label"},"From list:",-1)),a("span",yt,y(i.source.listName),1),n[13]||(n[13]=a("span",{class:"edit-hint"},"(Unlink list to edit)",-1)),f(C,{size:"small",type:"primary",onClick:n[1]||(n[1]=t=>i.$emit("clear-source")),"data-testid":"btn-unlink-list","aria-label":"Unlink list and edit values directly"},{default:_(()=>n[10]||(n[10]=[$(" Unlink List and Edit Directly ")])),_:1,__:[10]}),f(C,{size:"small",danger:"",onClick:m,"data-testid":"btn-clear-values","aria-label":"Remove all values from list"},{default:_(()=>n[11]||(n[11]=[$(" Remove List ")])),_:1,__:[11]})]),a("div",_t,[a("div",ht,[a("div",kt,[(o(!0),v(j,null,O(i.values,(t,c)=>(o(),v("div",{key:`${t}-${c}`,class:"tag tag-readonly"},[a("span",{class:"tag-text",title:t.length>100?t:""},y(t.length>100?t.substring(0,100)+"...":t),9,wt)]))),128)),i.values.length===0?(o(),v("span",$t," Values from linked list will appear here ")):P("",!0)]),i.values.length>0?(o(),v("div",Ct,y(i.values.length)+" values ",1)):P("",!0)])])])):P("",!0),i.source?P("",!0):(o(),v("div",Vt,[a("div",xt,[a("div",Lt,[a("div",Tt,[i.values.length>0?(o(),q(C,{key:0,size:"small",danger:"",onClick:m,"data-testid":"btn-clear-all","aria-label":"Clear all values"},{default:_(()=>n[14]||(n[14]=[$(" Clear ")])),_:1,__:[14]})):P("",!0),f(C,{size:"small",onClick:n[2]||(n[2]=t=>i.$emit("select-list")),"data-testid":"btn-select-list","aria-label":"Replace values with a variable list"},{default:_(()=>n[15]||(n[15]=[$(" Replace with List ")])),_:1,__:[15]})]),(o(!0),v(j,null,O(i.values,(t,c)=>(o(),v("div",{key:`${t}-${c}`,class:"tag"},[a("span",{class:"tag-text",title:t.length>100?t:""},y(t.length>100?t.substring(0,100)+"...":t),9,Rt),a("button",{type:"button",class:"tag-remove",onClick:V=>k(c),"data-testid":`btn-remove-tag-${c}`,"aria-label":`Remove value ${t}`}," × ",8,Et)]))),128)),G(a("input",{ref_key:"inputField",ref:g,"onUpdate:modelValue":n[3]||(n[3]=t=>W.value=t),placeholder:i.placeholder,class:"tag-input-field","data-testid":"input-variable-value","aria-label":i.placeholder||"Enter variable value",onKeydown:[de(Oe(L,["prevent"]),["enter"]),de(u,["backspace"])],onPaste:s},null,40,St),[[ge,W.value]])]),i.values.length>0?(o(),v("div",Pt,y(i.values.length)+" values ",1)):P("",!0)])]))]))])}}}),ce=J(It,[["__scopeId","data-v-33f1ece4"]]),Wt={class:"variable-preview-cycler"},Bt={class:"preview-controls"},Ft={key:0,class:"cycle-info","data-testid":"cycle-info",role:"status","aria-live":"polite"},Ut=["aria-label"],Nt={key:0,class:"preview-content"},At={key:0,class:"no-variables"},zt={key:1,class:"single-preview","data-testid":"single-preview"},jt={class:"preview-template","data-testid":"preview-template",role:"region","aria-label":"Preview of filled-in prompt"},Mt={key:2,class:"cycling-preview","data-testid":"cycling-preview"},Dt={class:"preview-template","data-testid":"preview-template-cycling",role:"region","aria-label":"Preview of filled-in prompt with cycling variables"},Ot={class:"variable-legend"},Kt=["data-testid"],qt={class:"variable-value"},Ht=X({__name:"VariablePreviewCyclerV3C",props:{template:{},variableBindings:{},variables:{},variableListRefs:{}},emits:["toggle-preview"],setup(K,{emit:D}){const b=K,F=D,W=me(),g=S(!1),x=S(0);let B=null;const I=["variable-highlight-blue","variable-highlight-green","variable-highlight-purple","variable-highlight-orange","variable-highlight-pink","variable-highlight-teal"],L=A(()=>{let t=[];if(b.variableBindings?t=Object.keys(b.variableBindings):b.variables&&(t=Object.keys(b.variables)),b.variableListRefs){const c=Object.keys(b.variableListRefs);t=[...new Set([...t,...c])]}return t}),s=A(()=>{if(L.value.length===0)return[];const t=[],c=W.variableLists.value;for(const w of L.value){let R=[];if(b.variableBindings){const E=b.variableBindings[w];if(E.type==="value"&&E.values)R=[...E.values];else if(E.type==="list"&&E.listId){const h=c.find(M=>M.id===E.listId);h&&(h.category==="simple"&&h.values?R=[...h.values]:h.category==="attributed"&&h.items&&(R=h.items.map(M=>M.value)))}}else if(b.variables&&b.variables[w]&&b.variables[w].length>0)R=[...b.variables[w]];else if(b.variableListRefs&&b.variableListRefs[w]){const E=b.variableListRefs[w],h=c.find(M=>M.id===E);h&&(h.category==="simple"&&h.values?R=[...h.values]:h.category==="attributed"&&h.items&&(R=h.items.map(M=>M.value)))}R.length>0&&t.push({name:w,values:R})}if(t.length===0)return[];function V(w){return w.reduce((R,E)=>R.flatMap(h=>E.map(M=>[...h,M])),[[]])}const U=t.map(w=>w.values);return V(U).map(w=>{const R={};return t.forEach((E,h)=>{R[E.name]=w[h]}),R})});function k(){g.value=!g.value,F("toggle-preview",g.value),g.value&&s.value.length>1?u():m()}function u(){m(),B=setInterval(()=>{x.value=(x.value+1)%s.value.length},1e3)}function m(){B&&(clearInterval(B),B=null)}function i(t){return I[t%I.length]}function n(t){let c=C(b.template);return L.value.forEach((V,U)=>{if(t[V]!==void 0){const N=C(V),w=new RegExp(`\\{\\{\\s*${N}\\s*\\}\\}`,"g"),E=`<span class="${i(U)}">${C(String(t[V]))}</span>`;c=c.replace(w,E)}}),c}function C(t){const c=document.createElement("div");return c.textContent=t,c.innerHTML}return Z(()=>b.template,()=>{x.value=0}),Z(s,t=>{t.length===0?m():g.value&&t.length>1&&u(),x.value>=t.length&&(x.value=0)}),Ke(()=>{m()}),(t,c)=>{const V=T("a-button"),U=be("dompurify-html");return o(),v("div",Wt,[a("div",Bt,[f(V,{type:g.value?"default":"primary",ghost:!g.value,onClick:k,class:"toggle-button","data-testid":"btn-toggle-preview-mode","aria-label":g.value?"Return to editor mode":"Preview filled-in prompts","aria-pressed":g.value},{default:_(()=>[g.value?(o(),q(Y(Qe),{key:1})):(o(),q(Y(Xe),{key:0})),$(" "+y(g.value?"Return to Editor Mode":"Preview Filled-In Prompts"),1)]),_:1},8,["type","ghost","aria-label","aria-pressed"]),g.value&&s.value.length>1?(o(),v("div",Ft,[a("span",{class:"cycle-counter","data-testid":"cycle-counter","aria-label":`Showing combination ${x.value+1} of ${s.value.length}`},y(x.value+1)+" / "+y(s.value.length),9,Ut),c[0]||(c[0]=a("span",{class:"cycle-hint"},"Auto-cycling every second",-1))])):P("",!0)]),g.value?(o(),v("div",Nt,[s.value.length===0?(o(),v("div",At,[f(Y(ye)),c[1]||(c[1]=a("span",null,"No variables detected in template",-1))])):s.value.length===1?(o(),v("div",zt,[G(a("div",jt,null,512),[[U,n(s.value[0]),"template"]])])):(o(),v("div",Mt,[G(a("div",Dt,null,512),[[U,n(s.value[x.value]),"template"]]),a("div",Ot,[(o(!0),v(j,null,O(L.value,(N,w)=>(o(),v("div",{key:N,class:"legend-item","data-testid":`legend-item-${N}`},[a("span",{class:fe(i(w))},y(N),3),a("span",qt,y(s.value[x.value][N]),1)],8,Kt))),128))])]))])):P("",!0)])}}}),Zt=J(Ht,[["__scopeId","data-v-2f9c69f3"]]),Yt={class:"list-selector"},Gt={key:0,class:"loading-container"},Jt={key:0,class:"list-grid"},Xt=["onClick"],Qt={class:"list-header"},ea={class:"item-count"},ta={key:0,class:"list-description"},aa={class:"list-preview"},la={key:0,class:"preview-more"},sa={key:1,class:"attributed-badge"},ia={key:1,class:"empty-state"},na=X({__name:"ListSelectorV3C",props:{modelValue:{type:Boolean},listType:{}},emits:["update:modelValue","select"],setup(K,{emit:D}){const b=K,F=D,W=me(),g=A(()=>W.variableLists.value),x=A(()=>!1),B=A(()=>null),I=A(()=>{if(!g.value)return[];let k=[];return b.listType==="all"?k=g.value.filter(u=>u.category!=="tabular"):b.listType==="simple"?k=g.value.filter(u=>u.category==="simple"):b.listType==="refusal"&&(k=g.value.filter(u=>u.category==="refusal")),k}),L=k=>{var u;return k.category==="attributed"&&k.items?k.items.slice(0,5).map(m=>m.value):((u=k.values)==null?void 0:u.slice(0,5))??[]},s=k=>{F("select",k),F("update:modelValue",!1)};return(k,u)=>{const m=T("a-spin"),i=T("a-alert"),n=T("a-button"),C=T("a-modal");return o(),q(C,{open:k.modelValue,title:"Select List",width:"80vw",style:{maxWidth:"800px"},"onUpdate:open":u[1]||(u[1]=t=>k.$emit("update:modelValue",t)),onCancel:u[2]||(u[2]=t=>k.$emit("update:modelValue",!1))},{footer:_(()=>[f(n,{onClick:u[0]||(u[0]=t=>k.$emit("update:modelValue",!1))},{default:_(()=>u[3]||(u[3]=[$(" Cancel ")])),_:1,__:[3]})]),default:_(()=>[a("div",Yt,[x.value?(o(),v("div",Gt,[f(m,{size:"large",tip:"Loading lists..."})])):B.value?(o(),q(i,{key:1,type:"error",message:B.value.message||"Failed to load lists",class:"error-alert"},null,8,["message"])):(o(),v(j,{key:2},[I.value.length>0?(o(),v("div",Jt,[(o(!0),v(j,null,O(I.value,t=>(o(),v("div",{key:t.id,class:"list-option",onClick:c=>s(t)},[a("div",Qt,[a("h4",null,y(t.name),1),a("span",ea,y(t.itemCount)+" items",1)]),t.description?(o(),v("p",ta,y(t.description),1)):P("",!0),a("div",aa,[(o(!0),v(j,null,O(L(t),(c,V)=>(o(),v("span",{key:`${t.id}-preview-${V}-${c}`,class:"preview-value"},y(c),1))),128)),t.itemCount>5?(o(),v("span",la," +"+y(t.itemCount-5)+" more ",1)):P("",!0)]),t.category==="attributed"?(o(),v("div",sa," Attributed List ")):P("",!0)],8,Xt))),128))])):(o(),v("div",ia," No "+y(k.listType)+" lists available ",1))],64))])]),_:1},8,["open"])}}}),pe=J(na,[["__scopeId","data-v-9aca871d"]]),oa={class:"template-editor-page"},ra={class:"header-content"},ua={class:"page-title"},da={class:"design-form-container"},va={key:0,class:"loading-container"},ca={class:"name-desc-row"},pa={key:0,class:"variable-hint"},ma={key:0,class:"variables-container"},fa={class:"variable-label"},ba={class:"variable-content"},ga={class:"output-row"},ya={class:"refusal-row"},_a={class:"refusal-content"},ha={class:"footer-content"},ka={class:"stats"},wa={class:"actions"},$a={class:"pricing-content"},Ca={key:0,class:"token-stats"},Va={class:"stats-grid"},xa={class:"pricing-placeholder"},La=X({__name:"TemplateEditorViewV3C",setup(K){const D=qe(),b=Ze(),{templates:F,loading:W}=Ye(),{variableLists:g}=Je(),{createTemplate:x,updateTemplate:B,isExecuting:I}=Ge(),L=A(()=>D.params.id),s=S({name:"",description:"",template:"",outputType:"text",extractPattern:"",refusalWords:[],refusalWordsListRef:"",refusalWordsSource:null,rejectRefusalWords:!1}),k=A(()=>W.value||I.value),u=S([]),m=S({}),i=S({}),n=S({}),C=S(!1),t=S(!1),c=S("all"),V=S(""),U=S(!1),N=S(null),w=S(null),R=[{label:"First Number",value:"(\\d+(?:\\.\\d+)?)"},{label:"Last Number",value:".*\\b(\\d+(?:\\.\\d+)?)\\b"},{label:"First Dollar Value",value:"\\$([\\d,]+(?:\\.\\d{2})?)"},{label:"Last Dollar Value",value:".*\\$([\\d,]+(?:\\.\\d{2})?)"},{label:"Number After =",value:"=\\s*(\\d+(?:\\.\\d+)?)"},{label:"First Word",value:"\\b(\\w+)\\b"},{label:"Last Word",value:".*\\b(\\w+)\\b"},{label:"First Phrase",value:"^([^.!?]+)"},{label:"Last Phrase",value:"([^.!?]+)[.!?]?$"},{label:"Extract Email",value:"/([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,})/i"},{label:"Extract URL",value:"(https?:\\/\\/[^\\s]+)"},{label:"Extract Yes/No",value:"/\\b(yes|no)\\b/i"},{label:"Extract JSON",value:"(\\{[^}]*\\})"}],E=[{bg:"#E8D5F2",text:"#6B21A8"},{bg:"#D5F2E8",text:"#047857"},{bg:"#FFE4D6",text:"#C2410C"},{bg:"#D6E4FF",text:"#1E40AF"},{bg:"#F3E8D5",text:"#92400E"}],h=A(()=>{if(!s.value.template)return[];const l=/\{\{([^}]+)\}\}/g,e=new Set;let r;for(;(r=l.exec(s.value.template))!==null;){const p=r[1].trim();/^\w+$/.test(p)&&e.add(p)}return Array.from(e)}),M=A(()=>{const l={};return h.value.forEach((e,r)=>{l[e]=E[r%E.length]}),l}),se=A(()=>{let l=1;for(const e of h.value){const r=m.value[e]||[],p=i.value[e];if(p){const z=g.value.find(H=>H.id===p);z&&(l*=z.itemCount||1)}else r.length>0&&(l*=r.length)}return{total:l,formatted:l.toLocaleString()}});function ie(l){const e=h.value.indexOf(l);return E[e%E.length]}function _e(l){return`{{${l}}}`}function he(l){ae.info("Preview mode toggled",{isPreviewMode:l})}function ke(l){const e=i.value[l];if(!e)return;const r=g.value.find(p=>p.id===e);return r==null?void 0:r.name}function we(l){const e=i.value[l];if(!e)return;const r=g.value.find(p=>p.id===e);return r==null?void 0:r.itemCount}function $e(l){const e=i.value[l];if(!e)return;const r=g.value.find(p=>p.id===e);if(!(!r||r.category!=="attributed"||!r.items))return r.items.slice(0,10)}function Ce(l){const e=i.value[l];if(!e)return;const r=g.value.find(z=>z.id===e);if(!r||r.category!=="attributed")return;const p=[];return r.attributeKeys&&p.push(...r.attributeKeys.map((z,H)=>({text:z,colorIndex:H%5}))),{parts:p,totalItems:r.itemCount||0}}function Ve(l){const e=i.value[l];if(!e)return;const r=g.value.find(p=>p.id===e);return r!=null&&r.attributeKeys?[...r.attributeKeys]:void 0}function xe(l){var p;const e=i.value[l];if(!e)return;const r=g.value.find(z=>z.id===e);if(!(!r||r.category!=="simple"))return(p=r.values)==null?void 0:p.slice(0,10)}function Le(l,e){m.value[l]=e}function Te(l){n.value[l]=null}function Re(l){i.value[l]="",m.value[l]=[]}function Ee(l){V.value=l,c.value="all",C.value=!0}function Se(l){V.value&&(l.category==="simple"?(m.value[V.value]=[...l.values||[]],i.value[V.value]="",n.value[V.value]={listId:l.id,listName:l.name}):(i.value[V.value]=l.id,m.value[V.value]=[],n.value[V.value]=null)),C.value=!1}function Pe(){if(!s.value.refusalWordsListRef)return;const l=g.value.find(e=>e.id===s.value.refusalWordsListRef);return l==null?void 0:l.name}function Ie(){s.value.refusalWordsListRef="",s.value.refusalWords=[]}function We(l){(l.category==="simple"||l.category==="refusal")&&l.values&&(s.value.refusalWords=[...l.values],s.value.refusalWordsListRef="",s.value.refusalWordsSource=null),t.value=!1}function Be(){s.value.extractPattern=N.value}Z(()=>s.value.extractPattern,l=>{const e=R.find(r=>r.value===l);N.value=e?e.value:null});function ne(){b.push({name:"templates"})}async function oe(){var l;try{if(u.value=[],!s.value.name.trim()){u.value.push("Template name is required");return}if(!s.value.template.trim()){u.value.push("Template content is required");return}const e={};for(const p of h.value)i.value[p]?e[p]={type:"list",listId:i.value[p]}:((l=m.value[p])==null?void 0:l.length)>0&&(e[p]={type:"value",values:[...m.value[p]]});const r={name:s.value.name,description:s.value.description,template:s.value.template,variables:e,category:"Custom",tags:[],outputType:s.value.outputType,extractPattern:s.value.extractPattern,refusalWords:s.value.refusalWords.length>0?[...s.value.refusalWords]:void 0,rejectRefusalWords:s.value.rejectRefusalWords};if(L.value){const p=await B(L.value,r);if(p.ok)ve.success("Template updated successfully");else{u.value=[p.error.message];return}}else{const p=await x(r);if(p.ok)ve.success("Template created successfully");else{u.value=[p.error.message];return}}b.push({name:"templates"})}catch(e){ae.error("Failed to save template:",e),u.value=[e instanceof Error?e.message:"Failed to save template"]}}function re(){if(!L.value)return;const l=F.value.find(e=>e.id===L.value);if(!l){W.value||(u.value=["Template not found"]);return}s.value.name=l.name,s.value.description=l.description||"",s.value.template=l.template,s.value.outputType=l.outputType||"text",s.value.extractPattern=l.extractPattern||"",s.value.refusalWords=l.refusalWords?[...l.refusalWords]:[],s.value.rejectRefusalWords=l.rejectRefusalWords||!1,m.value={},i.value={},n.value={};for(const[e,r]of Object.entries(l.variables))if(r.type==="list"&&r.listId){const p=g.value.find(z=>z.id===r.listId);p&&(p.category==="simple"||p.category==="refusal"?(m.value[e]=[...p.values||[]],i.value[e]="",n.value[e]={listId:p.id,listName:p.name}):(i.value[e]=r.listId,m.value[e]=[],n.value[e]=null))}else r.type==="value"&&r.values&&(m.value[e]=[...r.values])}return Z(()=>s.value.extractPattern,l=>{const e=R.find(r=>r.value===l);N.value=e?e.value:null},{immediate:!0}),Z(U,async l=>{l&&!w.value&&(w.value={promptTokens:Math.ceil(s.value.template.length/4),totalEstimate:Math.ceil(s.value.template.length/3),variableTokens:{}})}),He(()=>{ae.info("TemplateEditorViewV3C mounted with V4 real-time data",{templateId:L.value,isEdit:!!L.value}),L.value&&re();const l=R.find(e=>e.value===s.value.extractPattern);N.value=l?l.value:null}),Z([()=>D.params.id,F,g],()=>{L.value&&re()},{immediate:!0}),(l,e)=>{const r=T("a-button"),p=T("a-layout-header"),z=T("a-spin"),H=T("a-input"),te=T("a-form-item"),Q=T("a-select-option"),ue=T("a-select"),Fe=T("a-checkbox"),Ue=T("a-alert"),Ne=T("a-form"),Ae=T("a-layout-content"),ze=T("a-layout-footer"),je=T("a-layout"),Me=T("a-modal");return o(),v("div",oa,[f(je,null,{default:_(()=>[f(p,{class:"editor-header"},{default:_(()=>[a("div",ra,[f(r,{type:"text",onClick:ne,class:"back-button","data-testid":"btn-back-to-templates"},{icon:_(()=>[f(Y(et))]),default:_(()=>[e[16]||(e[16]=$(" Back to Templates "))]),_:1,__:[16]}),a("h1",ua,y(L.value?"Edit Template":"Create Template"),1)])]),_:1}),f(Ae,{class:"editor-content"},{default:_(()=>[a("div",da,[k.value?(o(),v("div",va,[f(z,{size:"large",tip:"Loading template..."})])):(o(),q(Ne,{key:1,model:s.value,layout:"vertical",onFinish:oe},{default:_(()=>[a("div",ca,[e[17]||(e[17]=a("label",{class:"inline-field-label"},"Name",-1)),f(te,{name:"name",rules:[{required:!0,message:"Required"}],class:"name-field"},{default:_(()=>[f(H,{value:s.value.name,"onUpdate:value":e[0]||(e[0]=d=>s.value.name=d),placeholder:"Enter template name",size:"large","data-testid":"input-template-name","aria-label":"Template name"},null,8,["value"])]),_:1}),e[18]||(e[18]=a("label",{class:"inline-field-label"},"Description",-1)),f(te,{name:"description",class:"desc-field"},{default:_(()=>[f(H,{value:s.value.description,"onUpdate:value":e[1]||(e[1]=d=>s.value.description=d),placeholder:"Optional description",size:"large","data-testid":"input-template-description","aria-label":"Template description"},null,8,["value"])]),_:1})]),f(te,{label:"Template",name:"template",rules:[{required:!0,message:"Required"}],class:"template-form-item"},{default:_(()=>[h.value.length===0?(o(),v("div",pa,[f(Y(ye)),e[19]||(e[19]=a("span",null,[$("Type a prompt and use double curly braces to add a variable with conditions to vary, like "),a("code",null,"{{name}}"),$(" or "),a("code",null,"{{system_prompt}}"),$(". Variable names cannot contain spaces or punctuation except underscores (_).")],-1))])):P("",!0),f(st,{modelValue:s.value.template,"onUpdate:modelValue":e[2]||(e[2]=d=>s.value.template=d),placeholder:"Enter your prompt template... Use {{variable}} for variables",rows:7,variables:h.value,"variable-colors":M.value,"data-testid":"template-editor","aria-label":"Prompt template editor"},null,8,["modelValue","variables","variable-colors"]),h.value.length>0&&s.value.template?(o(),q(Zt,{key:1,template:s.value.template,variables:m.value,"variable-list-refs":i.value,onTogglePreview:he},null,8,["template","variables","variable-list-refs"])):P("",!0)]),_:1}),h.value.length>0?(o(),v("div",ma,[(o(!0),v(j,null,O(h.value,d=>(o(),v("div",{key:d,class:"variable-row"},[a("div",fa,[e[20]||(e[20]=a("span",{class:"variable-text"},"Variable:",-1)),a("span",{style:le({backgroundColor:ie(d).bg,color:ie(d).text}),class:"variable-badge"},y(_e(d)),5)]),a("div",ba,[f(ce,{values:m.value[d]||[],"list-ref":i.value[d],"list-name":ke(d),source:n.value[d]||null,placeholder:`Enter a value for {{${d}}} and hit enter`,"attributed-samples":$e(d),"attribute-breakdown":Ce(d),"attribute-keys":Ve(d),"preview-values":xe(d),"total-count":we(d),"onUpdate:values":ee=>Le(d,ee),onClearSource:ee=>Te(d),onClearList:ee=>Re(d),onSelectList:ee=>Ee(d)},null,8,["values","list-ref","list-name","source","placeholder","attributed-samples","attribute-breakdown","attribute-keys","preview-values","total-count","onUpdate:values","onClearSource","onClearList","onSelectList"])])]))),128))])):P("",!0),a("div",ga,[e[24]||(e[24]=a("label",{class:"row-label"},"Output Format",-1)),f(ue,{value:s.value.outputType,"onUpdate:value":e[3]||(e[3]=d=>s.value.outputType=d),size:"large",style:{width:"calc(var(--spacing-xl) * 7.5)"},"data-testid":"select-output-format","aria-label":"Select output format type"},{default:_(()=>[f(Q,{value:"text"},{default:_(()=>e[21]||(e[21]=[$("Text")])),_:1,__:[21]}),f(Q,{value:"number"},{default:_(()=>e[22]||(e[22]=[$("Number")])),_:1,__:[22]}),f(Q,{value:"boolean"},{default:_(()=>e[23]||(e[23]=[$("Boolean")])),_:1,__:[23]})]),_:1},8,["value"]),e[25]||(e[25]=a("label",{class:"inline-label"},"Parse Preset",-1)),f(ue,{value:N.value,"onUpdate:value":e[4]||(e[4]=d=>N.value=d),size:"large",style:{flex:"1"},placeholder:"Custom regex",onChange:Be,"data-testid":"select-parse-preset","aria-label":"Select parsing preset"},{default:_(()=>[(o(),v(j,null,O(R,d=>f(Q,{key:d.value,value:d.value},{default:_(()=>[$(y(d.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),e[26]||(e[26]=a("label",{class:"inline-label"},"Regex Extract",-1)),f(H,{value:s.value.extractPattern,"onUpdate:value":e[5]||(e[5]=d=>s.value.extractPattern=d),placeholder:"Leave blank for full response",size:"large",style:{flex:"1"},"data-testid":"input-regex-extract","aria-label":"Regular expression extraction pattern"},null,8,["value"])]),a("div",ya,[e[28]||(e[28]=a("label",{class:"row-label"},"Parse Refusals",-1)),a("div",_a,[f(ce,{values:s.value.refusalWords,"list-ref":s.value.refusalWordsListRef,"list-name":Pe(),source:s.value.refusalWordsSource||null,placeholder:"Enter a refusal word and hit enter (e.g., cannot, unable, refuse)","onUpdate:values":e[6]||(e[6]=d=>s.value.refusalWords=d),onClearSource:e[7]||(e[7]=d=>s.value.refusalWordsSource=null),onClearList:e[8]||(e[8]=d=>Ie()),onSelectList:e[9]||(e[9]=d=>t.value=!0)},null,8,["values","list-ref","list-name","source"])]),f(Fe,{checked:s.value.rejectRefusalWords,"onUpdate:checked":e[10]||(e[10]=d=>s.value.rejectRefusalWords=d),class:"reject-checkbox","data-testid":"checkbox-reject-refusals","aria-label":"Reject responses containing refusal words"},{default:_(()=>e[27]||(e[27]=[$(" Reject on match ")])),_:1,__:[27]},8,["checked"])]),u.value.length>0?(o(),q(Ue,{key:1,type:"error","show-icon":"",class:"error-alert"},{message:_(()=>[$(y(u.value.join(", ")),1)]),_:1})):P("",!0)]),_:1},8,["model"]))])]),_:1}),f(ze,{class:"editor-footer"},{default:_(()=>[a("div",ha,[a("div",ka,y(h.value.length)+" variables • "+y(se.value.formatted)+" combinations ",1),a("div",wa,[f(r,{size:"large",onClick:e[11]||(e[11]=d=>U.value=!0),"data-testid":"btn-calculate-pricing","aria-label":"Calculate pricing for this template"},{default:_(()=>e[29]||(e[29]=[$(" Calculate Pricing ")])),_:1,__:[29]}),f(r,{size:"large",onClick:ne,"data-testid":"btn-cancel-template","aria-label":"Cancel and go back to templates"},{default:_(()=>e[30]||(e[30]=[$(" Cancel ")])),_:1,__:[30]}),f(r,{size:"large",type:"primary",onClick:oe,"data-testid":"btn-save-template","aria-label":"Save template and go back to templates"},{default:_(()=>e[31]||(e[31]=[$(" Save ")])),_:1,__:[31]})])])]),_:1})]),_:1}),f(pe,{modelValue:C.value,"onUpdate:modelValue":e[12]||(e[12]=d=>C.value=d),"list-type":c.value,onSelect:Se},null,8,["modelValue","list-type"]),f(pe,{modelValue:t.value,"onUpdate:modelValue":e[13]||(e[13]=d=>t.value=d),"list-type":"refusal",onSelect:We},null,8,["modelValue"]),f(Me,{open:U.value,"onUpdate:open":e[15]||(e[15]=d=>U.value=d),title:"Cost Estimation",width:"90vw",style:{maxWidth:"1000px"}},{footer:_(()=>[f(r,{onClick:e[14]||(e[14]=d=>U.value=!1)},{default:_(()=>e[37]||(e[37]=[$("Close")])),_:1,__:[37]})]),default:_(()=>[a("div",$a,[w.value?(o(),v("div",Ca,[e[32]||(e[32]=a("h4",null,"Token Analysis",-1)),a("div",Va,[a("div",null,"Min: "+y(w.value.promptTokens),1),a("div",null,"Max: "+y(w.value.totalEstimate),1),a("div",null,"Avg: "+y(Math.round((w.value.promptTokens+w.value.totalEstimate)/2)),1),a("div",null,"Variables: "+y(Object.keys(w.value.variableTokens).length),1)])])):P("",!0),a("div",xa,[e[36]||(e[36]=a("p",null,"Pricing calculation will be implemented with V3 backend integration.",-1)),a("p",null,[e[33]||(e[33]=$("Template: ")),a("strong",null,y(s.value.name||"Untitled"),1)]),a("p",null,[e[34]||(e[34]=$("Variables: ")),a("strong",null,y(h.value.length),1)]),a("p",null,[e[35]||(e[35]=$("Combinations: ")),a("strong",null,y(se.value.formatted),1)])])])]),_:1},8,["open"])])}}}),Ua=J(La,[["__scopeId","data-v-94dbdd98"]]);export{Ua as default};
